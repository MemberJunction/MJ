{
  "name": "VelocityHeatmap",
  "location": "embedded",
  "code": "@file:../code/deal-velocity-metrics-velocity-heatmap.js",
  "description": "Displays deal velocity by stage in an interactive ECharts heatmap visualization",
  "category": "Deals",
  "type": "chart",
  "libraries": [
    {
      "name": "echarts",
      "version": "5.4.3",
      "globalVariable": "echarts"
    },
    {
      "name": "simple-statistics",
      "version": "7.8.3",
      "globalVariable": "ss"
    }
  ],
  "dataRequirements": {
    "mode": "views",
    "entities": [
      {
        "name": "Deals",
        "displayFields": ["ID", "Stage", "ActualCloseDate", "CloseDate"],
        "filterFields": ["Stage"],
        "sortFields": ["CloseDate"]
      }
    ]
  },
  "properties": [
    {
      "name": "deals",
      "type": "array",
      "description": "Array of deal objects with stage information",
      "required": true
    },
    {
      "name": "stages",
      "type": "array",
      "description": "Array of stage names in pipeline order",
      "required": true
    },
    {
      "name": "onDrillDown",
      "type": "function",
      "description": "Callback when a stage cell is clicked, receives deals and title",
      "required": true
    },
    {
      "name": "styles",
      "type": "object",
      "description": "Style utilities and theme configuration",
      "required": true
    },
    {
      "name": "utilities",
      "type": "object",
      "description": "MemberJunction utilities for data access",
      "required": true
    },
    {
      "name": "components",
      "type": "object",
      "description": "Registry of available components",
      "required": true
    }
  ],
  "events": [
    {
      "name": "onDrillDown",
      "description": "Fired when a heatmap cell is clicked",
      "parameters": [
        {
          "name": "stageDeals",
          "type": "array",
          "description": "Deals filtered to the clicked stage"
        },
        {
          "name": "title",
          "type": "string",
          "description": "Title for the drill-down panel"
        }
      ]
    }
  ],
  "usageExample": "```javascript\n<VelocityHeatmap\n  deals={deals}\n  stages={['Prospecting', 'Qualification', 'Proposal', 'Negotiation', 'Closed Won', 'Closed Lost']}\n  onDrillDown={(stageDeals, title) => {\n    setDrillDownDeals(stageDeals);\n    setDrillDownTitle(title);\n  }}\n/>\n```",
  "functionalRequirements": "- Calculate average days in each stage\n- Display velocity data as color-coded heatmap\n- Show statistics (average, min, max, count) in tooltips\n- Support drill-down to view deals in a specific stage\n- Dispose chart properly on unmount\n- Handle empty data gracefully",
  "technicalDesign": "Uses ECharts heatmap series with visual mapping (green=fast, red=slow). Calculates velocity statistics using simple-statistics library. Handles chart initialization, updates, and disposal via useEffect. Click handler filters deals by stage and invokes onDrillDown callback."
}
