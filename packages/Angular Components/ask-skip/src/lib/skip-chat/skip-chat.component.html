<div class = "chat-container" mjFillContainer>
    <div class="conversation-history" *ngIf="ShowConversationList">
        <button kendoButton *ngIf="AllowNewConversations" (click)="CreateNewConversation()" >+ New Chat</button>
        <kendo-listview
            class="conversation-list"
            [data]="Conversations"
            [style.height.px]="280"
            [itemClass]="{ 'item-border': true }" 
            mjFillContainer 
            [fillWidth]="false"
            #conversationList
            >
            <ng-template kendoListViewItemTemplate let-dataItem="dataItem">
                <div class="conversation-item" 
                     [ngClass]="SelectedConversation?.ID === dataItem.ID ? 'conversation-item-selected' : ''"
                     [title]="dataItem.Name" 
                     (click)="SelectConversation(dataItem)"> 
                    <kendo-svgicon *ngIf="!IsSkipProcessing(dataItem)" [icon]="sharedService.kendoSVGIcon('comment')" name="comment" svgIcon="conversation-icon"></kendo-svgicon>
                    <kendo-svgicon *ngIf="SelectedConversation && IsSkipProcessing(dataItem)" [icon]="sharedService.kendoSVGIcon('clock')" name="clock" class="conversation-icon"></kendo-svgicon>
                    <div class="text-container">
                        <span *ngIf="dataItem.ID !== SelectedConversation?.ID || !ConversationEditMode">{{ dataItem.Name }}</span>
                        <textarea *ngIf="dataItem.ID === SelectedConversation?.ID && ConversationEditMode" [(ngModel)]="dataItem.Name" maxlength="100"></textarea>
                    </div>
                    <div *ngIf="SelectedConversation?.ID === dataItem.ID" class="edit-conversation-panel">
                        <kendo-svgicon *ngIf="!ConversationEditMode" [icon]="sharedService.kendoSVGIcon('pencil')" name="edit" class="edit-icon" (click)="editConvo(dataItem)"></kendo-svgicon>
                        <kendo-svgicon *ngIf="!ConversationEditMode" [icon]="sharedService.kendoSVGIcon('trash')" name="delete" class="delete-icon" (click)="deleteConvo(dataItem)"></kendo-svgicon>    
                        <kendo-svgicon *ngIf="ConversationEditMode" [icon]="sharedService.kendoSVGIcon('check')" name="check" class="save-icon" (click)="saveConvoName(dataItem)" ></kendo-svgicon>
                        <kendo-svgicon *ngIf="ConversationEditMode" [icon]="sharedService.kendoSVGIcon('close')" name="close" class="cancel-edit-icon" (click)="cancelConvoEdit(dataItem)"></kendo-svgicon>
                    </div>
                </div>
            </ng-template>
        </kendo-listview>
    </div>
    <div class="conversation-wrapper" mjFillContainer>
        <div #AskSkipPanel class="messages" mjContainer>
            <div *ngFor="let message of Messages">  
                <div class="message-row" [ngClass]="message.Role.trim().toLowerCase() === 'ai' ? 'ai-message' : message.Role.trim().toLowerCase() === 'error' ? 'error-message' : 'user-message'" >
                    <div class="message-image">
                        <img src="{{message.Role.trim().toLowerCase() === 'ai' || message.Role.trim().toLowerCase() === 'error' ? 'assets/Skip - Mark Only - Small.png' : userImage()}}" class="avatar" />
                    </div>
                    <div class="message" mjContainer [id]="'skip_message_' + message.ID">
                        <div class="message-user-name">{{message.Role.trim().toLowerCase() === 'ai' ? 'Skip' : (this.SelectedConversationUser ? this.SelectedConversationUser.FirstName + ' ' + this.SelectedConversationUser.LastName : 'You')}}</div>
                        <div>{{this.createDetailHtml(message)}}</div> 
                    </div>
                </div>
            </div>
            <div class="waiting-for-ai" *ngIf="SelectedConversation && IsSkipProcessing(SelectedConversation)">
                <div class="waiting-for-ai-message">{{this.WaitingMessage}}</div>
                <kendo-loader></kendo-loader>
            </div>
        </div>
        <div class="input-area">
            <textarea
                    #AskSkipInput 
                    [disabled]="SelectedConversation && IsSkipProcessing(SelectedConversation)" 
                    (keyup.enter)="onEnter($event)" 
                    (input)="onInputChange($event)"
                    type="text" 
                    placeholder="Ask Skip a question"></textarea>
            <button [disabled]="SelectedConversation !== undefined && IsSkipProcessing(SelectedConversation)" (click)="sendSkipMessage()"><i class="fas fa-solid fa-arrow-up"></i></button>
            <kendo-svgicon *ngIf="ShowDataContextButton" [icon]="sharedService.kendoSVGIcon('gearIcon')" name="gear" svgIcon="gear-icon" (click)="showDataContext()"></kendo-svgicon>
        </div>
    </div>
</div>     

<div *ngIf="isDataContextDialogVisible">
    <mj-data-context-dialog [dataContextId]="DataContextID" (dialogClosed)="closeDataContextDialog()"></mj-data-context-dialog>
</div>