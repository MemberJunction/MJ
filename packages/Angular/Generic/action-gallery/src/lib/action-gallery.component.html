<div class="action-gallery" [class.dark-theme]="config.theme === 'dark'" [class.selection-mode]="config.selectionMode">
  <!-- Gallery Header -->
  <div class="gallery-header" *ngIf="config.showSearch">
    <div class="header-content">
      <div class="search-section">
        <kendo-textbox 
          #searchInput
          [formControl]="searchControl" 
          placeholder="Search actions by name, description, or category..."
          class="search-input"
          [clearButton]="true">
          <ng-template kendoTextBoxPrefixTemplate>
            <i class="fa-solid fa-search"></i>
          </ng-template>
        </kendo-textbox>
      </div>
      
      <div class="header-actions">
        <div class="view-toggle">
          <button kendoButton 
                  [toggleable]="true" 
                  [selected]="(viewMode$ | async) === 'grid'"
                  (click)="toggleViewMode()"
                  size="small"
                  kendoTooltip
                  [title]="(viewMode$ | async) === 'grid' ? 'Switch to list view' : 'Switch to grid view'">
            <i class="fa-solid" [class.fa-th]="(viewMode$ | async) === 'grid'" [class.fa-list]="(viewMode$ | async) === 'list'"></i>
          </button>
        </div>
        <div class="stats">
          <span class="stat-item">
            <i class="fa-solid fa-bolt"></i>
            {{ (filteredActions$ | async)?.length }} of {{ totalActions }} actions
          </span>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="gallery-content" [class.no-categories]="!config.showCategories">
    <!-- Category Sidebar -->
    <div class="category-sidebar" *ngIf="config.showCategories">
      <div class="category-tree">
        <ng-container *ngFor="let category of categoryTree$ | async">
          <div class="category-item" 
               [class.selected]="(selectedCategory$ | async) === category.id"
               [class.has-children]="category.children && category.children.length > 0"
               (click)="selectCategory(category.id)">
            
            <div class="category-header">
              <i class="category-icon" [ngClass]="['fa-solid', category.icon]"></i>
              <span class="category-name">{{ category.name }}</span>
              <span class="category-count">{{ category.count }}</span>
              <i class="fa-solid fa-chevron-right expand-icon" 
                 *ngIf="category.children && category.children.length > 0"
                 [class.expanded]="expandedCategories.has(category.id)"
                 (click)="toggleCategoryExpanded(category.id); $event.stopPropagation()"></i>
            </div>
            
            <!-- Sub-categories -->
            <div class="sub-categories" *ngIf="category.children && expandedCategories.has(category.id)">
              <div class="category-item sub-category" 
                   *ngFor="let subCategory of category.children"
                   [class.selected]="(selectedCategory$ | async) === subCategory.id"
                   (click)="selectCategory(subCategory.id); $event.stopPropagation()">
                <div class="category-header">
                  <i class="category-icon" [ngClass]="['fa-solid', subCategory.icon]"></i>
                  <span class="category-name">{{ subCategory.name }}</span>
                  <span class="category-count">{{ subCategory.count }}</span>
                </div>
              </div>
            </div>
          </div>
        </ng-container>
      </div>
    </div>

    <!-- Actions Display -->
    <div class="actions-container">
      <!-- Loading State -->
      <div class="loading-state" *ngIf="isLoading$ | async">
        <kendo-loader size="large"></kendo-loader>
        <p>Loading actions...</p>
      </div>

      <!-- Empty State -->
      <div class="empty-state" *ngIf="!(isLoading$ | async) && (filteredActions$ | async)?.length === 0">
        <i class="fa-solid fa-search-minus"></i>
        <h3>No actions found</h3>
        <p>Try adjusting your search criteria or selecting a different category</p>
        <button kendoButton (click)="clearSearch()">Clear Search</button>
      </div>

      <!-- Grid View -->
      <div class="actions-grid" 
           *ngIf="!(isLoading$ | async) && (viewMode$ | async) === 'grid' && (filteredActions$ | async) && (filteredActions$ | async)!.length > 0"
           [style.grid-template-columns]="'repeat(' + (config.gridColumns || 3) + ', 1fr)'">
        
        <div class="action-card" 
             *ngFor="let action of filteredActions$ | async"
             [class.expanded]="action.expanded"
             [class.selected]="action.selected"
             [class.animate]="animateCards"
             [class.hover]="hoveredAction === action.ID"
             (mouseenter)="hoveredAction = action.ID"
             (mouseleave)="hoveredAction = null"
             (click)="toggleActionSelection(action)">
          
          <!-- Card Header -->
          <div class="card-header" (click)="toggleActionExpanded(action); $event.stopPropagation()">
            <div class="action-icon">
              <i class="fa-solid {{ getActionIcon(action) }}"></i>
            </div>
            <div class="action-info">
              <h3 class="action-name">{{ action.Name }}</h3>
              <div class="action-meta">
                <span class="category-badge" *ngIf="action.Category">
                  <i class="fa-solid fa-folder"></i>
                  {{ action.Category }}
                </span>
              </div>
            </div>
            <div class="card-actions">
              <button kendoButton 
                      look="flat" 
                      size="small"
                      icon="play"
                      (click)="testAction(action, $event)"
                      *ngIf="config.enableQuickTest"
                      kendoTooltip
                      title="Test this action">
              </button>
              <i class="fa-solid expand-indicator"
                 [class.fa-chevron-down]="!action.expanded"
                 [class.fa-chevron-up]="action.expanded"></i>
            </div>
          </div>
          
          <!-- Card Body -->
          <div class="card-body">
            <p class="action-description">{{ action.Description || 'No description available' }}</p>
            
            <!-- Quick Stats -->
            <div class="action-stats">
              <span class="stat" *ngIf="action.parameters?.length">
                <i class="fa-solid fa-sliders"></i>
                {{ action.parameters?.length || 0 }} params
              </span>
              <span class="stat" *ngIf="action.resultCodes?.length">
                <i class="fa-solid fa-code-branch"></i>
                {{ action.resultCodes?.length || 0 }} results
              </span>
              <span class="stat" *ngIf="action.Type">
                <i class="fa-solid fa-tag"></i>
                {{ action.Type }}
              </span>
            </div>
          </div>
          
          <!-- Expanded Details -->
          <div class="card-details" *ngIf="action.expanded">
            <!-- Parameters -->
            <div class="detail-section" *ngIf="action.parameters && action.parameters.length > 0">
              <h4>
                <i class="fa-solid fa-sliders"></i>
                Parameters
              </h4>
              <div class="parameters-list">
                <div class="parameter-item" *ngFor="let param of action.parameters">
                  <span class="param-name">{{ param.Name }}</span>
                  <span class="param-type">{{ param.Type }}</span>
                  <span class="param-required" *ngIf="param.IsRequired">Required</span>
                </div>
              </div>
            </div>
            
            <!-- Result Codes -->
            <div class="detail-section" *ngIf="action.resultCodes && action.resultCodes.length > 0">
              <h4>
                <i class="fa-solid fa-code-branch"></i>
                Result Codes
              </h4>
              <div class="result-codes-list">
                <div class="result-code-item" *ngFor="let code of action.resultCodes">
                  <span class="code-value">{{ code.ResultCode }}</span>
                  <span class="code-desc">{{ code.Description }}</span>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Selection Indicator -->
          <div class="selection-indicator" *ngIf="config.selectionMode">
            <i class="fa-solid" [class.fa-check-circle]="action.selected" [class.fa-circle]="!action.selected"></i>
          </div>
        </div>
      </div>

      <!-- List View -->
      <div class="actions-list" 
           *ngIf="!(isLoading$ | async) && (viewMode$ | async) === 'list' && (filteredActions$ | async) && (filteredActions$ | async)!.length > 0">
        
        <div class="list-header">
          <span class="col-name">Name</span>
          <span class="col-category">Category</span>
          <span class="col-type">Type</span>
          <span class="col-params">Parameters</span>
          <span class="col-actions">Actions</span>
        </div>
        
        <div class="list-item" 
             *ngFor="let action of filteredActions$ | async"
             [class.selected]="action.selected"
             (click)="toggleActionSelection(action)">
          
          <span class="col-name">
            <i class="fa-solid {{ getActionIcon(action) }} action-icon"></i>
            {{ action.Name }}
          </span>
          <span class="col-category">{{ action.Category || '-' }}</span>
          <span class="col-type">{{ action.Type || '-' }}</span>
          <span class="col-params">{{ action.parameters?.length || 0 }}</span>
          <span class="col-actions">
            <button kendoButton 
                    look="flat" 
                    size="small"
                    icon="play"
                    (click)="testAction(action, $event)"
                    *ngIf="config.enableQuickTest"
                    kendoTooltip
                    title="Test this action">
            </button>
          </span>
          
          <!-- Selection Indicator -->
          <div class="selection-indicator" *ngIf="config.selectionMode">
            <i class="fa-solid" [class.fa-check-circle]="action.selected" [class.fa-circle]="!action.selected"></i>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

