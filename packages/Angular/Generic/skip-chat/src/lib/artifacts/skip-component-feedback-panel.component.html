@if (isVisible) {
  <div class="feedback-panel-overlay" (click)="closePanel()">
    <div class="feedback-panel" (click)="$event.stopPropagation()">
      <!-- Header -->
      <div class="panel-header">
        <div class="panel-title">
          <i class="fa-solid fa-comment-dots"></i>
          <span>Component Feedback</span>
        </div>
        <button kendoButton class="close-button" (click)="closePanel()" fillMode="flat">
          <i class="fa-solid fa-times"></i>
        </button>
      </div>
      <!-- Content -->
      <div class="panel-content">
        <!-- Component Tree Section -->
        <div class="tree-section">
          <div class="section-header">
            <i class="fa-solid fa-sitemap"></i>
            <span>Select Component</span>
          </div>
          @if (rootComponent) {
            <div class="component-tree">
              @for (item of getTreeItems(); track item.node.name) {
                <div
                  class="tree-item"
                  [class.selected]="isComponentSelected(item.node)"
                  [style.padding-left]="getNodeIndentation(item.depth)"
                  (click)="selectComponent(item.node, $event)">
                  <!-- Expand/Collapse Icon -->
                  @if (item.hasChildren) {
                    <i
                      class="tree-toggle"
                      [class.fa-solid]="true"
                      [class.fa-chevron-right]="!isNodeExpanded(item.node)"
                      [class.fa-chevron-down]="isNodeExpanded(item.node)"
                      (click)="toggleNode(item.node); $event.stopPropagation()">
                    </i>
                  } @else {
                    <span class="tree-spacer"></span>
                  }
                  <!-- Component Icon -->
                  <i class="fa-solid fa-cube component-icon"></i>
                  <!-- Component Name -->
                  <div class="component-info">
                    <span class="component-name">{{ item.node.title || item.node.name }}</span>
                    @if (item.node.location === 'registry') {
                      <span class="component-badge registry">Registry</span>
                    }
                  </div>
                </div>
              }
            </div>
          } @else {
            <div class="empty-state">
              <i class="fa-solid fa-info-circle"></i>
              <span>No component hierarchy available</span>
            </div>
          }
        </div>
        <!-- Feedback Form Section -->
        <div class="feedback-section">
          @if (selectedComponent) {
            <div class="selected-component-info">
              <div class="section-header">
                <i class="fa-solid fa-star"></i>
                <span>Rate: {{ selectedComponent.title || selectedComponent.name }}</span>
              </div>
              @if (selectedComponent.description) {
                <p class="component-description">{{ selectedComponent.description }}</p>
              }
              <!-- Star Rating -->
              <div class="star-rating-container">
                <label class="rating-label">Your Rating</label>
                <div class="star-rating">
                  @for (star of [1, 2, 3, 4, 5]; track star) {
                    <i
                      class="star"
                      [class.fa-solid]="isStarFilled(star)"
                      [class.fa-regular]="!isStarFilled(star)"
                      [class.fa-star]="true"
                      (click)="setRating(star)"
                      (mouseenter)="setHoverRating(star)"
                      (mouseleave)="clearHoverRating()">
                    </i>
                  }
                </div>
                @if (starRating > 0) {
                  <span class="rating-text">{{ starRating }} out of 5 stars</span>
                } @else {
                  <span class="rating-text placeholder">Click to rate</span>
                }
              </div>
              <!-- Comment Input -->
              <div class="comment-container">
                <label class="comment-label">
                  Comments
                  <span class="optional-label">(optional)</span>
                </label>
                <textarea
                  class="comment-input"
                  [(ngModel)]="feedbackComment"
                  placeholder="Share your thoughts about this component..."
                  rows="4"
                  maxlength="1000">
                </textarea>
                @if (feedbackComment.length > 0) {
                  <span class="char-count">{{ feedbackComment.length }}/1000</span>
                }
              </div>
              <!-- Submit Button -->
              <div class="submit-container">
                <button
                  kendoButton
                  [themeColor]="'primary'"
                  [disabled]="!canSubmit()"
                  (click)="submitFeedback()"
                  class="submit-button">
                  @if (isSubmitting) {
                    <i class="fa-solid fa-spinner fa-spin"></i>
                    <span>Submitting...</span>
                  } @else {
                    <i class="fa-solid fa-paper-plane"></i>
                    <span>Submit Feedback</span>
                  }
                </button>
              </div>
              <!-- Success/Error Messages -->
              @if (submitSuccess) {
                <div class="message success-message">
                  <i class="fa-solid fa-check-circle"></i>
                  <span>Feedback submitted successfully!</span>
                </div>
              }
              @if (submitError) {
                <div class="message error-message">
                  <i class="fa-solid fa-exclamation-circle"></i>
                  <span>{{ submitError }}</span>
                </div>
              }
            </div>
          } @else {
            <div class="no-selection-message">
              <i class="fa-solid fa-hand-pointer"></i>
              <p>Select a component from the tree to provide feedback</p>
            </div>
          }
        </div>
      </div>
    </div>
  </div>
}
