<!-- Query Data Grid Component -->
<div class="query-data-grid-container" [style.height]="height">
    <!-- Toolbar -->
    <div class="grid-toolbar" *ngIf="showToolbar">
        <div class="toolbar-left">
            <!-- Row count -->
            <span class="row-count" *ngIf="showRowCount">
                <i class="fa-solid fa-table-list"></i>
                {{ rowCount | number }} {{ rowCount === 1 ? 'row' : 'rows' }}
            </span>

            <!-- Selection count -->
            <span class="selection-count" *ngIf="showSelectionCount && selectionCount > 0">
                <i class="fa-solid fa-check-square"></i>
                {{ selectionCount }} selected
                <button class="clear-selection-btn" (click)="clearSelection()" title="Clear selection">
                    <i class="fa-solid fa-times"></i>
                </button>
            </span>
        </div>

        <div class="toolbar-right">
            <!-- Refresh button -->
            <button *ngIf="showRefresh"
                    (click)="refresh()"
                    [disabled]="isLoading"
                    title="Refresh data"
                    class="toolbar-btn">
                <i class="fa-solid fa-refresh" [class.fa-spin]="isLoading"></i>
            </button>

            <!-- Export button -->
            <button *ngIf="showExport"
                    [disabled]="rowCount === 0"
                    title="Export data"
                    class="toolbar-btn"
                    (click)="openExportDialog()">
                <i class="fa-solid fa-file-export"></i>
                Export
            </button>
        </div>
    </div>

    <!-- Loading overlay -->
    <div class="loading-overlay" *ngIf="isLoading" @fadeIn>
        <mj-loading text="Loading query results..."></mj-loading>
    </div>

    <!-- AG Grid -->
    <div class="grid-wrapper" [class.loading]="isLoading">
        <ag-grid-angular
            class="query-grid"
            [theme]="theme"
            [rowData]="data"
            [columnDefs]="columnDefs"
            [defaultColDef]="defaultColDef"
            [gridOptions]="gridOptions"
            [rowSelection]="getRowSelectionConfig()"
            [getRowId]="getRowId"
            (gridReady)="onGridReady($event)"
            (rowClicked)="onRowClicked($event)"
            (rowDoubleClicked)="onRowDoubleClicked($event)"
            (selectionChanged)="onSelectionChanged($event)"
            (sortChanged)="onSortChanged($event)"
            (columnResized)="onColumnResized($event)"
            (columnMoved)="onColumnMoved($event)">
        </ag-grid-angular>
    </div>

    <!-- Empty state -->
    <div class="empty-state" *ngIf="!isLoading && rowCount === 0" @fadeIn>
        <i class="fa-solid fa-database empty-icon"></i>
        <p class="empty-message">No results</p>
        <p class="empty-hint">Run the query to see results</p>
    </div>
</div>

<!-- Export Dialog -->
<mj-export-dialog
    [visible]="showExportDialog"
    [config]="exportDialogConfig"
    (closed)="onExportDialogClosed($event)">
</mj-export-dialog>
