<div>
    <kendo-dialog-titlebar>
        <div style="font-size: 18px;">
        <i class="fa-solid fa-save"></i> Save Component to Artifact
        </div>
    </kendo-dialog-titlebar>

    <div class="artifact-selection-content">
        <!-- Search and Filters -->
        <div class="filters-section">
            <!-- Search -->
            <kendo-textbox 
                [(value)]="searchTerm"
                (valueChange)="filterArtifacts()"
                placeholder="Search artifacts by name or description..."
                [clearButton]="true"
                style="width: 100%; margin-bottom: 15px;">
                <ng-template kendoTextBoxPrefixTemplate>
                    <i class="fa-solid fa-search"></i>
                </ng-template>
            </kendo-textbox>
            
            <!-- Filters Row -->
            <div class="filter-row" >
                <!-- Artifact Type -->
                <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: 500; color: #555; font-size: 13px;">Artifact Type</label>
                    <kendo-dropdownlist
                        [data]="artifactTypes"
                        (valueChange)="filterArtifacts()"
                        textField="text"
                        valueField="value"
                        style="width: 100%;">
                    </kendo-dropdownlist>
                </div>
                
                <!-- User Email -->
                <div  >
                    <label style="display: block; margin-bottom: 5px; font-weight: 500; color: #555; font-size: 13px;">Filter by User</label>
                    <kendo-textbox 
                        [(value)]="userEmail"
                        (valueChange)="filterArtifacts()"
                        placeholder="Enter user email..."
                        [clearButton]="true"
                        style="width: 100%;">
                        <ng-template kendoTextBoxPrefixTemplate>
                            <i class="fa-solid fa-user"></i>
                        </ng-template>
                    </kendo-textbox>
                </div>
            </div>
        </div>

        <!-- Existing Artifacts Section -->
        <div class="existing-artifacts-section">
            <!-- Paging Controls -->
            <div class="paging-controls" >
                <button kendoButton 
                    (click)="previousPage()" 
                    [disabled]="!canGoPrevious()"
                    [themeColor]="'base'">
                    <i class="fa-solid fa-chevron-left"></i> Previous
                </button>
                <span class="page-info">
                    Page {{ currentPage + 1 }} of {{ getTotalPages() }}
                    ({{ totalArtifacts }} total items)
                </span>
                <button kendoButton 
                    (click)="nextPage()" 
                    [disabled]="!canGoNext()"
                    [themeColor]="'base'">
                    Next <i class="fa-solid fa-chevron-right"></i>
                </button>
            </div>

            <!-- Existing Artifacts -->
            <div class="artifacts-list">
                @if (isLoading) {
                    <div class="loading">
                        <i class="fa-solid fa-spinner fa-spin"></i> Loading artifacts...
                    </div>
                } 
                @else if (artifacts.length === 0) {
                    <div class="no-artifacts">
                        <i class="fa-solid fa-inbox"></i>
                        <p>No artifacts found</p>
                    </div>
                } 
                @else {
                    @for (artifact of artifacts; track artifact.ID) {
                        <div class="artifact-item" 
                            [class.selected]="selectedArtifact?.ID === artifact.ID"
                            (click)="selectArtifact(artifact)">
                            <div class="artifact-header">
                                <div class="artifact-name">
                                    <i class="fa-solid fa-file-code"></i>
                                    {{ artifact.Name }}
                                </div>
                                <div class="artifact-meta">
                                    <span class="artifact-type">{{ artifact.ArtifactType }}</span>
                                    <span class="artifact-date">{{ artifact.__mj_UpdatedAt | date:'short' }}</span>
                                </div>
                            </div>
                            @if (artifact.Description) {
                                <div class="artifact-description">
                                {{ artifact.Description }}
                                </div>
                            }
                        
                            <!-- Version Selection (shown when artifact is selected) -->
                            @if (selectedArtifact?.ID === artifact.ID && artifactVersions.length > 0) {
                                <div class="version-section">
                                    <h4>Select Version Action:</h4>
                                    <div class="version-options">
                                        <label class="version-option">
                                        <input type="radio" 
                                            name="versionAction" 
                                            value="new"
                                            [(ngModel)]="versionAction"
                                            (change)="selectedVersion = null">
                                        <span>Create New Version (v{{ getNextVersionNumber() }})</span>
                                        </label>
                                        
                                        <label class="version-option">
                                        <input type="radio" 
                                            name="versionAction" 
                                            value="update"
                                            [(ngModel)]="versionAction">
                                        <span>Update Existing Version</span>
                                        </label>
                                        
                                        @if (versionAction === 'update') {
                                            <div class="version-list">
                                                @for (version of artifactVersions; track version.ID) {
                                                    <label class="version-item">
                                                        <input type="radio" 
                                                        name="selectedVersion"
                                                        [value]="version"
                                                        [(ngModel)]="selectedVersion">
                                                        <span>
                                                        Version {{ version.Version }}
                                                        <small>({{ version.__mj_UpdatedAt | date:'short' }})</small>
                                                        </span>
                                                    </label>
                                                }
                                            </div>
                                            
                                            @if (selectedVersion) {
                                                <div class="update-warning">
                                                    <i class="fa-solid fa-exclamation-triangle"></i>
                                                    <span>Warning: This will overwrite version {{ selectedVersion.Version }}</span>
                                                </div>
                                            }
                                        }
                                    </div>
                                </div>
                            }
                        </div>
                    }
                }
            </div>
        </div>
        
        <!-- Create New Artifact Section (at bottom) -->
        <div class="create-new-section">
            <div class="divider">
                <span>OR CREATE NEW ARTIFACT</span>
            </div>
            
            <button kendoButton 
            (click)="selectCreateNew()"
            [themeColor]="'primary'"
            style="width: 100%;">
            <i class="fa-solid fa-plus"></i> Create New Artifact
            </button>
            
            @if (showNewArtifactForm) {
            <div class="new-artifact-form">
                <kendo-textbox 
                [(value)]="newArtifactName"
                placeholder="Artifact name..."
                style="width: 100%; margin: 10px 0;">
                </kendo-textbox>
                <kendo-textarea 
                [(value)]="newArtifactDescription"
                placeholder="Description (optional)..."
                style="width: 100%; height: 60px;">
                </kendo-textarea>
            </div>
            }
        </div>
    </div>

    <kendo-dialog-actions>
        <button kendoButton 
            [themeColor]="'primary'" 
            (click)="save()"
            [disabled]="!canSave()">
            <i class="fa-solid fa-save"></i> 
            {{ getSaveButtonText() }}
        </button>
        <button kendoButton (click)="cancel()">Cancel</button>
    </kendo-dialog-actions>
</div>
