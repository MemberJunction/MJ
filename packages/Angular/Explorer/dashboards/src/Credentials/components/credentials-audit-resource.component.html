<div class="audit-container">
    <mj-loading *ngIf="isLoading" text="Loading audit logs..."></mj-loading>

    <ng-container *ngIf="!isLoading">
        <!-- Stats Row -->
        <div class="stats-row">
            <div class="stat-card">
                <div class="stat-value">{{auditLogs.length}}</div>
                <div class="stat-label">Total Access Events</div>
            </div>
            <div class="stat-card success">
                <div class="stat-value">{{getSuccessCount()}}</div>
                <div class="stat-label">Successful</div>
            </div>
            <div class="stat-card failed">
                <div class="stat-value">{{getFailedCount()}}</div>
                <div class="stat-label">Failed</div>
            </div>
        </div>

        <!-- Toolbar -->
        <div class="toolbar">
            <div class="filters">
                <select
                    class="filter-select"
                    [value]="selectedStatus"
                    (change)="onStatusFilterChange($any($event.target).value)"
                >
                    <option value="">All Statuses</option>
                    <option value="Success">Success</option>
                    <option value="Failed">Failed</option>
                </select>

                <select
                    class="filter-select"
                    [value]="dateRange"
                    (change)="onDateRangeChange($any($event.target).value)"
                >
                    <option value="1">Last 24 hours</option>
                    <option value="7">Last 7 days</option>
                    <option value="30">Last 30 days</option>
                    <option value="90">Last 90 days</option>
                </select>

                <button class="refresh-btn" (click)="refresh()" title="Refresh">
                    <i class="fa-solid fa-refresh"></i>
                </button>
            </div>

            <div class="results-info">
                {{filteredLogs.length}} of {{auditLogs.length}} events
            </div>
        </div>

        <!-- Audit Log Table -->
        <div class="audit-table-container" *ngIf="filteredLogs.length > 0">
            <table class="audit-table">
                <thead>
                    <tr>
                        <th>Timestamp</th>
                        <th>User</th>
                        <th>Operation</th>
                        <th>Description</th>
                        <th>Subsystem</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let log of filteredLogs">
                        <td class="timestamp">{{formatDate(log.__mj_CreatedAt)}}</td>
                        <td class="user">{{log.User || 'Unknown'}}</td>
                        <td class="operation">
                            <span class="operation-badge">{{getOperationType(log)}}</span>
                        </td>
                        <td class="description">{{log.Description || '-'}}</td>
                        <td class="subsystem">{{getSubsystem(log) || '-'}}</td>
                        <td class="status">
                            <span class="status-badge" [ngClass]="getStatusClass(log.Status)">
                                <i [class]="log.Status === 'Success' ? 'fa-solid fa-check' : 'fa-solid fa-times'"></i>
                                {{log.Status}}
                            </span>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Empty State -->
        <div class="empty-state" *ngIf="filteredLogs.length === 0">
            <i class="fa-solid fa-clipboard-list"></i>
            <h3>No Audit Logs</h3>
            <p *ngIf="selectedStatus">No events matching the selected filters</p>
            <p *ngIf="!selectedStatus">No credential access events in the selected time range</p>
        </div>
    </ng-container>
</div>
