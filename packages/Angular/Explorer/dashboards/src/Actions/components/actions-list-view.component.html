<div class="actions-list-view" >
  <!-- Header with filters -->
  <div class="list-header">
    <div class="header-title">
      <h2><i class="fa-solid fa-cogs"></i> Actions</h2>
      <div class="results-count">{{ filteredActions.length }} of {{ actions.length }} actions</div>
    </div>
    
    <div class="filters-row">
      <div class="search-container">
        <kendo-textbox 
          placeholder="Search actions..." 
          [value]="searchTerm$.value"
          (valueChange)="onSearchChange($event)">
          <ng-template kendoTextBoxPrefixTemplate>
            <i class="fa-solid fa-search"></i>
          </ng-template>
        </kendo-textbox>
      </div>
      
      <div class="filter-group">
        <kendo-dropdownlist 
          [data]="statusOptions"
          textField="text"
          valueField="value"
          [valuePrimitive]="true"
          [value]="selectedStatus$.value"
          (valueChange)="onStatusFilterChange($event)">
        </kendo-dropdownlist>
        
        <kendo-dropdownlist 
          [data]="typeOptions"
          textField="text"
          valueField="value"
          [valuePrimitive]="true"
          [value]="selectedType$.value"
          (valueChange)="onTypeFilterChange($event)">
        </kendo-dropdownlist>
        
        <button kendoButton
          [fillMode]="'outline'"
          (click)="toggleCategoryTree()"
          class="category-filter-button">
          <i class="fa-solid fa-folder-tree"></i>
          @if (selectedCategory$.value === 'all') {
            All Categories
          } @else {
            {{ getCategoryName(selectedCategory$.value) }}
          }
          <span class="badge">{{ getCategoryActionCount(selectedCategory$.value) }}</span>
        </button>
      </div>
    </div>
  </div>
  
  <!-- Category Tree View Panel -->
  @if (showCategoryTree) {
    <div class="category-tree-panel">
      <div class="tree-header">
        <h3>Select Category</h3>
        <button kendoButton
          [fillMode]="'flat'"
          [size]="'small'"
          (click)="toggleCategoryTree()">
          <i class="fa-solid fa-times"></i>
        </button>
      </div>
      
      <div class="tree-actions">
        <button kendoButton
          [fillMode]="'flat'"
          [size]="'small'"
          (click)="selectCategory('all')"
          [class.selected]="selectedCategory$.value === 'all'">
          <i class="fa-solid fa-folder-open"></i>
          All Categories
          <span class="badge">{{ actions.length }}</span>
        </button>
      </div>
      
      <div class="tree-content">
        <ng-container *ngTemplateOutlet="categoryTreeTemplate; context: { nodes: categoryTree }"></ng-container>
      </div>
      
      <ng-template #categoryTreeTemplate let-nodes="nodes">
        @for (node of nodes; track node.category.ID) {
          <div class="tree-node" [style.padding-left.px]="node.level * 20">
            <button kendoButton
              [fillMode]="'flat'"
              [size]="'small'"
              class="tree-node-button"
              [class.selected]="selectedCategory$.value === node.category.ID"
              (click)="selectCategory(node.category.ID)">
              
              @if (node.children.length > 0) {
                <button kendoButton
                  [fillMode]="'flat'"
                  [size]="'small'"
                  class="expand-button"
                  (click)="toggleCategoryExpanded(node.category.ID); $event.stopPropagation()">
                  @if (isCategoryExpanded(node.category.ID)) {
                    <i class="fa-solid fa-chevron-down"></i>
                  } @else {
                    <i class="fa-solid fa-chevron-right"></i>
                  }
                </button>
              } @else {
                <span class="no-expand"></span>
              }
              
              <i class="fa-solid fa-folder"></i>
              {{ node.category.Name }}
              <span class="badge">{{ getCategoryActionCount(node.category.ID) }}</span>
            </button>
            
            @if (node.children.length > 0 && isCategoryExpanded(node.category.ID)) {
              <ng-container *ngTemplateOutlet="categoryTreeTemplate; context: { nodes: node.children }"></ng-container>
            }
          </div>
        }
      </ng-template>
    </div>
  }

  <!-- Actions List -->
  <div class="actions-list">
    @if (filteredActions.length > 0) {
      @for (action of filteredActions; track action.ID) {
        <div class="action-card" (click)="openAction(action)">
          <div class="action-icon">
            <i [class]="getActionIcon(action)"></i>
          </div>
          
          <div class="action-main">
            <div class="action-header">
              <h3 class="action-name">{{ action.Name }}</h3>
              <div class="action-badges">
                <kendo-chip 
                  [themeColor]="getStatusColor(action.Status)"
                  [size]="'small'">
                  {{ action.Status }}
                </kendo-chip>
                @if (action.Type === 'Generated') {
                  <kendo-chip 
                    themeColor="info"
                    [size]="'small'">
                    <i class="fa-solid fa-robot"></i> AI Generated
                  </kendo-chip>
                }
              </div>
            </div>
            
            <div class="action-description">
              {{ action.Description || 'No description available' }}
            </div>
            
            <div class="action-details">
              <div class="detail-item">
                <i class="fa-solid fa-folder"></i>
                <span>{{ getCategoryName(action.CategoryID) }}</span>
              </div>
              @if (action.__mj_UpdatedAt) {
                <div class="detail-item">
                  <i class="fa-solid fa-clock"></i>
                  <span>Updated {{ action.__mj_UpdatedAt | date:'MMM d, yyyy' }}</span>
                </div>
              }
              @if (action.CodeApprovalStatus && action.Type === 'Generated') {
                <div class="detail-item">
                  <i class="fa-solid fa-check-circle"></i>
                  <span>{{ action.CodeApprovalStatus }}</span>
                </div>
              }
            </div>
          </div>
          
          <div class="action-actions">
            <button kendoButton 
              [fillMode]="'flat'"
              (click)="$event.stopPropagation()">
              <i class="fa-solid fa-ellipsis-vertical"></i>
            </button>
          </div>
        </div>
      }
    } @else if (!isLoading) {
      <div class="empty-state">
        <i class="fa-solid fa-search"></i>
        <h3>No actions found</h3>
        <p>Try adjusting your search or filter criteria</p>
      </div>
    }
  </div>

  @if (isLoading) {
    <div class="loading-overlay">
      <mj-loading [showText]="false" size="medium"></mj-loading>
    </div>
  }
</div>