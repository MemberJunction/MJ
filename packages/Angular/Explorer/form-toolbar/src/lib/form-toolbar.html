
<div class="toolbar-container" [class.disabled]="CurrentlyDisabled">
    @if (!form.EditMode) {
        @if (form.UserCanEdit) {
            <button kendoButton (click)="form.StartEditMode()" title="Edit this Record">
                <span class="fa-solid fa-pen-to-square"></span>
            </button> 
        }
        @if(form.UserCanDelete){
            <button kendoButton (click)="toggleDeleteDialog(true)" title="Delete this Record">
                <span class="fa-regular fa-trash-can"></span>
            </button> 
        }
        @if (form.FavoriteInitDone) {
            @if (form.IsFavorite) {
                <button kendoButton (click)="form.RemoveFavorite()" title="Remove Favorite">
                    <span class="fa-solid fa-star"></span>
                </button> 
            }
            @else {
                <button kendoButton (click)="form.MakeFavorite()" title="Make Favorite">
                    <span class="fa-regular fa-star"></span>
                </button> 
            }
        }
    }
    @else {
        <button kendoButton (mouseup)="saveExistingRecord($event)" title="Save Record">
            <span class="fa-solid fa-floppy-disk"></span>
            <span class="button-text">Save</span>
        </button> 
        @if (form.record.IsSaved) {
            <!-- Only show the cancel button if the record has already been saved - don't show for a new record. -->
            <button kendoButton (click)="form.CancelEdit()" title="Cancel Edit">
                <span class="fa-solid fa-rotate-left"></span>
                <span class="button-text">Cancel</span>
            </button>     
        }
        @if (form.record.Dirty) {
            <button kendoButton (click)="form.ShowChanges()" title="Fields you have changed">
                <span class="fa-solid fa-clipboard-list"></span>
                <span class="button-text">Changes</span>
            </button> 
        }
    }
    @if (form.EntityInfo?.TrackRecordChanges && !form.EditMode) {
        <button kendoButton (click)="form.handleHistoryDialog()" title="Show History">
            <span class="fa-solid fa-clock-rotate-left"></span>
        </button>
    }
    <!-- 
    ************************************************************
    ************************************************************
    ************************************************************
    ************************************************************
    ************************************************************
    ************************************************************
         REPLACE THIS WITH GENERIC CHAT LATER in 3.0 LIFECYCLE - TO-Do TODO 
    ************************************************************
    ************************************************************
    ************************************************************
    ************************************************************
    ************************************************************
    ************************************************************
    -->
    <!-- @if (ShowSkipChatButton && !form.EditMode) {
        <button kendoButton (click)="ShowSkipChat()" title="Discuss this record with Skip">
            <span class="fa-regular fa-comment-dots"></span>
        </button> 
    } -->
    <!-- @if (form.EntityInfo) {
        <mj-skip-chat-with-record-window
            [LinkedEntityID]="form.EntityInfo.ID"
            [LinkedEntityPrimaryKey]="LinkedEntityPrimaryKey"            
            #mjChat
            [WindowOpened]="_skipChatDialogVisible" 
            (WindowClosed)="ShowSkipChat()"
        >
        </mj-skip-chat-with-record-window>
    } -->
    <!-- 
    ************************************************************
    ************************************************************
    ************************************************************
    ************************************************************
    ************************************************************
    ************************************************************
         REPLACE THIS WITH GENERIC CHAT LATER in 3.0 LIFECYCLE - TO-Do TODO 
    ************************************************************
    ************************************************************
    ************************************************************
    ************************************************************
    ************************************************************
    ************************************************************
    -->



    @if (form.isHistoryDialogOpen) {
        <mj-record-changes [record]="form.record" (dialogClosed)="form.handleHistoryDialog()"></mj-record-changes>
    }
    @if(!form.EditMode){
        <button kendoButton (click)="toggleListDialog(true)"
                [title]="recordListCount > 0 ? 'Member of ' + recordListCount + ' list(s) - Click to manage' : 'Add this record to a list'"
                class="list-button">
            <span class="fa-solid fa-rectangle-list"></span>
            @if (recordListCount > 0) {
                <span class="list-count-badge">{{ recordListCount }}</span>
            }
        </button>
    }

    <!-- Slot for additional controls (section controls) - no separator needed with right-align -->
    <ng-content select="[toolbar-additional-controls]"></ng-content>

    <kendo-dialog 
    [minWidth]="450"
    [width]="650"
    class="dialog-wrapper" 
    title="Confirm" 
    *ngIf="_deleteDialogVisible" 
    (close)="toggleDeleteDialog(false)">
      <p class="k-m-7.5 k-text-center">
        Are you sure you want to delete this record?
      </p>
      <kendo-dialog-actions class="popup-actions-btn">
        <button class="cancel-btn" (click)="deleteRecord()" kendoButton themeColor="info">
          Yes, Delete
        </button>
        <button class="yes-btn" (click)="toggleDeleteDialog(false)" kendoButton fillMode="outline" themeColor="info">
          No, Cancel
        </button>
      </kendo-dialog-actions>
    </kendo-dialog>

    <!-- Legacy List Dialog (fallback when useEnhancedListDialog is false) -->
    <kendo-dialog
    class="dialog-wrapper"
    title="Select List to Add Record To"
    *ngIf="listDialogVisible && !useEnhancedListDialog"
    (close)="toggleListDialog(false)"
    [minWidth]="250"
    [width]="650"
    [height]="550"
    >
    <hr>
    @for(list of availableLists; track list){
        <div class="overflow-y-scroll">
            <div class="list-item">
                <div class="list-text">
                    {{list.Name}}
                </div>
                <button kendoButton class="btn-no-border" (click)="addRecordToList(list)">
                    <div class="btn-margin-right">
                        <span class="fa-solid fa-plus"></span>
                        Add
                    </div>
                </button>
            </div>
            <hr>
        </div>
    }
    <kendo-dialog-actions class="popup-actions-btn">
        <button  class="yes-btn" (click)="toggleListDialog(false)" kendoButton fillMode="outline" themeColor="info">
            Close
        </button>
    </kendo-dialog-actions>
</kendo-dialog>

    <!-- Enhanced List Management Dialog -->
    @if (showEnhancedListDialog && listManagementConfig) {
        <mj-list-management-dialog
            [config]="listManagementConfig"
            [visible]="showEnhancedListDialog"
            (complete)="onEnhancedListDialogComplete($event)"
            (cancel)="onEnhancedListDialogCancel()">
        </mj-list-management-dialog>
    }
</div>