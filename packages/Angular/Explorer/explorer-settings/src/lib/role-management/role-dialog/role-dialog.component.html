@if (visible) {
  <div
    class="modal-backdrop"
    (click)="onCancel()"
    role="dialog"
    aria-modal="true"
    aria-labelledby="role-dialog-title"
  >
    <div class="modal-dialog" (click)="$event.stopPropagation()">
      <!-- Dialog Header -->
      <div class="modal-header">
        <div class="dialog-header">
          <h2 class="dialog-title" id="role-dialog-title">
            <i class="fa-solid fa-shield-halved" aria-hidden="true"></i>
            {{ isEditMode ? 'Edit Role' : 'Create New Role' }}
          </h2>
          <p class="dialog-subtitle">
            {{ isEditMode ? 'Update role information and permissions' : 'Add a new role to the system' }}
          </p>
        </div>
        <button
          class="modal-close"
          (click)="onCancel()"
          aria-label="Close dialog"
        >
          <i class="fa-solid fa-times" aria-hidden="true"></i>
        </button>
      </div>

      <!-- Dialog Content -->
      <div class="modal-body">
        <form [formGroup]="roleForm" (ngSubmit)="onSubmit()">

          @if (error) {
            <div class="alert alert-error" role="alert">
              <i class="fa-solid fa-exclamation-triangle" aria-hidden="true"></i>
              <div>{{ error }}</div>
            </div>
          }

          <!-- Basic Information Section -->
          <div class="form-section">
            <div class="section-header">
              <h3 class="section-title">
                <i class="fa-solid fa-shield-halved" aria-hidden="true"></i>
                Role Information
              </h3>
              <p class="section-description">Define the role's basic properties and purpose</p>
            </div>

            <div class="form-grid">
              <div class="form-field">
                <label class="field-label required" for="role-name">Role Name</label>
                <input
                  id="role-name"
                  type="text"
                  class="field-input"
                  formControlName="name"
                  placeholder="Sales Manager"
                  [class.error]="roleForm.get('name')?.invalid && roleForm.get('name')?.touched"
                  [attr.aria-invalid]="roleForm.get('name')?.invalid && roleForm.get('name')?.touched"
                  aria-describedby="role-name-error"
                />
                @if (roleForm.get('name')?.invalid && roleForm.get('name')?.touched) {
                  <div class="field-error" id="role-name-error" role="alert">
                    <i class="fa-solid fa-exclamation-circle" aria-hidden="true"></i>
                    @if (roleForm.get('name')?.errors?.['required']) {
                      Role name is required
                    }
                    @if (roleForm.get('name')?.errors?.['maxlength']) {
                      Role name cannot exceed 50 characters
                    }
                  </div>
                }
              </div>

              <div class="form-field">
                <label class="field-label" for="role-description">Description</label>
                <textarea
                  id="role-description"
                  class="field-textarea"
                  formControlName="description"
                  placeholder="Describe the role's purpose and responsibilities..."
                  rows="4"
                  aria-describedby="role-description-hint"
                ></textarea>
                <div class="field-hint" id="role-description-hint">
                  Provide a clear description of what this role is for and what permissions it should have.
                </div>
              </div>

              @if (isEditMode) {
                <div class="form-field">
                  <label class="field-label" for="role-directory-id">Directory ID</label>
                  <input
                    id="role-directory-id"
                    type="text"
                    class="field-input"
                    formControlName="directoryId"
                    placeholder="External directory identifier"
                    aria-describedby="role-directory-hint"
                  />
                  <div class="field-hint" id="role-directory-hint">
                    External directory identifier for syncing with Active Directory or other systems.
                  </div>
                </div>
              }
            </div>
          </div>

          <!-- Role Type Section -->
          <div class="form-section">
            <div class="section-header">
              <h3 class="section-title">
                <i class="fa-solid fa-cog" aria-hidden="true"></i>
                Role Type
              </h3>
              <p class="section-description">System or custom role classification</p>
            </div>

            <div class="form-grid">
              @if (isSystemRole) {
                <div class="alert alert-warning" role="status">
                  <i class="fa-solid fa-shield-halved" aria-hidden="true"></i>
                  <div>
                    <strong>System Role</strong>
                    <p>This is a system-defined role. Some properties may be limited for editing to maintain system integrity.</p>
                  </div>
                </div>
              } @else {
                <div class="alert alert-info" role="status">
                  <i class="fa-solid fa-user-tag" aria-hidden="true"></i>
                  <div>
                    <strong>Custom Role</strong>
                    <p>This is a custom role that can be fully configured and modified.</p>
                  </div>
                </div>
              }
            </div>
          </div>

          <!-- Permissions Preview Section -->
          @if (isEditMode) {
            <div class="form-section">
              <div class="section-header">
                <h3 class="section-title">
                  <i class="fa-solid fa-key" aria-hidden="true"></i>
                  Permissions
                </h3>
                <p class="section-description">Manage role permissions and access rights</p>
              </div>

              <div class="form-grid">
                <div class="alert alert-info" role="note">
                  <i class="fa-solid fa-info-circle" aria-hidden="true"></i>
                  <div>
                    <strong>Permission Management</strong>
                    <p>Role permissions can be managed in the <strong>Permissions</strong> tab of the settings dashboard. Use that interface to configure specific access rights for this role.</p>
                  </div>
                </div>
              </div>
            </div>
          }
        </form>
      </div>

      <!-- Dialog Footer -->
      <div class="modal-footer">
        <button
          type="button"
          class="mj-btn mj-btn-primary"
          (click)="onSubmit()"
          [disabled]="roleForm.invalid || isLoading"
        >
          @if (isLoading) {
            <i class="fa-solid fa-spinner fa-spin" aria-hidden="true"></i>
            Saving...
          } @else {
            <i class="fa-solid fa-save" aria-hidden="true"></i>
            {{ isEditMode ? 'Update Role' : 'Create Role' }}
          }
        </button>
        <button type="button" class="mj-btn mj-btn-secondary" (click)="onCancel()">
          Cancel
        </button>
      </div>
    </div>
  </div>
}
