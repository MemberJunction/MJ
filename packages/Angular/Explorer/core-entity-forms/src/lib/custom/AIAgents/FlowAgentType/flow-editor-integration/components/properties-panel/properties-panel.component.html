<div class="properties-panel">
  <div class="properties-header">
    <h3 class="properties-title">
      <i class="fa-solid fa-cog"></i> Properties
    </h3>
  </div>
  
  <div class="properties-content">
    <!-- Empty State -->
    <div *ngIf="!selectedStep" class="empty-state">
      <i class="fa-solid fa-info-circle"></i>
      <p>Select a step to view its properties</p>
    </div>
    
    <!-- Step Properties -->
    <div *ngIf="selectedStep">
      <div class="property-field">
        <label for="step-name">Step Name</label>
        <input 
          id="step-name"
          type="text" 
          [value]="selectedStep.name" 
          (input)="onStepNameChange($any($event.target).value)"
          class="form-input">
      </div>
      
      <!-- Show editable name for prompts -->
      <div class="property-field" *ngIf="selectedStep.type === 'prompt' && selectedStep.selectedOption">
        <label for="prompt-name">
          Prompt Display Name
          <span class="edit-indicator">Editable</span>
        </label>
        <div class="editable-field">
          <input 
            id="prompt-name"
            type="text" 
            [(ngModel)]="selectedStep.name" 
            (blur)="onStepNameChange(selectedStep.name)"
            (keyup.enter)="onStepNameChange(selectedStep.name)"
            class="form-input"
            placeholder="Enter prompt name...">
        </div>
      </div>
      
      <div class="property-field">
        <label for="step-type">Step Type</label>
        <input 
          id="step-type"
          type="text" 
          [value]="selectedStep.config.name" 
          readonly 
          class="form-input"
          disabled>
      </div>
      
      <div class="property-field">
        <label for="step-id">Step ID</label>
        <input 
          id="step-id"
          type="text" 
          [value]="selectedStep.id" 
          readonly 
          class="form-input"
          disabled>
      </div>
      
      <div class="divider"></div>
      
      <div class="property-field">
        <label for="step-option">Selected Option</label>
        <div class="option-select-container">
          <select 
            id="step-option"
            class="form-input"
            [value]="selectedStep.selectedOption || ''"
            (change)="onStepOptionChange($any($event.target).value)">
            <option value="" disabled>Select {{ selectedStep.config.name }}...</option>
            <option 
              *ngFor="let option of availableOptions; let i = index" 
              [value]="option.value"
              [class.new-prompt-option]="option.value === 'new_custom_prompt'"
              [class.custom-prompt-option]="option.value.startsWith('custom_')"
              [class.separator-after]="i === 0 && availableOptions.length > 1">
              {{ option.value === 'new_custom_prompt' ? 'âž• ' + option.name : option.name }}
            </option>
          </select>
        </div>
      </div>
      
      <div class="divider"></div>
      
      <!-- Dynamic properties based on selected option -->
      <div *ngIf="selectedStep.selectedOption && getOptionProperties().length > 0" 
           class="editable-properties-section">
        <h4 class="section-title">
          {{ selectedStep.selectedOption.startsWith('custom_') ? 'Custom Prompt Configuration' : getSelectedOption()?.name + ' Properties' }}
          <span class="edit-indicator">All properties are editable</span>
        </h4>
        
        <div *ngFor="let property of getOptionProperties()" class="property-field">
          <label [for]="'prop-' + property.key">
            {{ property.label }}
          </label>
          
          <!-- Text input -->
          <input 
            *ngIf="property.type === 'text'"
            [id]="'prop-' + property.key"
            type="text"
            [placeholder]="property.placeholder || ''"
            [value]="getPropertyValue(property.key)"
            (input)="onPropertyChange(property.key, $any($event.target).value)"
            class="form-input">
          
          <!-- Number input -->
          <input 
            *ngIf="property.type === 'number'"
            [id]="'prop-' + property.key"
            type="number"
            [min]="property.min"
            [max]="property.max"
            [step]="property.step || 1"
            [placeholder]="property.placeholder || ''"
            [value]="getPropertyValue(property.key)"
            (input)="onPropertyChange(property.key, +$any($event.target).value)"
            class="form-input">
          
          <!-- Select dropdown -->
          <select 
            *ngIf="property.type === 'select'"
            [id]="'prop-' + property.key"
            [value]="getPropertyValue(property.key)"
            (change)="onPropertyChange(property.key, $any($event.target).value)"
            class="form-input">
            <option *ngFor="let option of property.options" [value]="option.value">
              {{ option.label }}
            </option>
          </select>
          
          <!-- Textarea -->
          <div *ngIf="property.type === 'textarea' || property.type === 'json'" class="textarea-wrapper">
            <textarea 
              [id]="'prop-' + property.key"
              [placeholder]="property.placeholder || ''"
              [rows]="property.rows || 3"
              [value]="getPropertyValue(property.key)"
              (input)="onPropertyChange(property.key, $any($event.target).value)"
              class="form-input editable-textarea">
            </textarea>
          </div>
          
          <!-- Checkbox -->
          <label *ngIf="property.type === 'checkbox'" class="checkbox-label">
            <input 
              type="checkbox"
              [checked]="getPropertyValue(property.key)"
              (change)="onPropertyChange(property.key, $any($event.target).checked)">
            {{ property.label }}
          </label>
        </div>
      </div>
      
      <!-- Message when no option is selected -->
      <div *ngIf="selectedStep.selectedOption && getOptionProperties().length === 0" class="empty-state">
        <p>No additional properties for this option</p>
      </div>
      
      <div *ngIf="!selectedStep.selectedOption" class="empty-state">
        <p>Select an option above to configure properties</p>
      </div>
      
      <div class="step-info">
        <div class="info-badge" [style.background-color]="selectedStep.config.color + '20'" [style.color]="selectedStep.config.color">
          <i class="fas" [ngClass]="selectedStep.config.icon"></i>
          {{ selectedStep.config.name }}
        </div>
      </div>
    </div>
  </div>
</div>

