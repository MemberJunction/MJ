<mj-record-form-container [record]="record" [formComponent]="this">

    <!-- ========================================
         FIELD PANELS
         ======================================== -->
    <!-- Linking & Core Info Section -->
    <mj-collapsible-panel slot="field-panels"
        sectionKey="linkingCoreInfo"
        sectionName="Linking & Core Info"
        icon="fa fa-link"
        [form]="this"
        [formContext]="formContext">
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="CompanyID"
            Type="textbox"
            [EditMode]="EditMode"
            [formContext]="formContext"
            LinkType="Record"
            LinkComponentType="Search"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="IntegrationID"
            Type="textbox"
            [EditMode]="EditMode"
            [formContext]="formContext"
            LinkType="Record"
            LinkComponentType="Search"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="IsActive"
            Type="checkbox"
            [EditMode]="EditMode"
            [formContext]="formContext"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="IsExternalSystemReadOnly"
            Type="checkbox"
            [EditMode]="EditMode"
            [formContext]="formContext"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="Name"
            Type="textarea"
            [EditMode]="EditMode"
            [formContext]="formContext"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="Company"
            Type="textbox"
            [EditMode]="EditMode"
            [formContext]="formContext"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="Integration"
            Type="textbox"
            [EditMode]="EditMode"
            [formContext]="formContext"
        ></mj-form-field>

    </mj-collapsible-panel>

    <!-- Credentials & Tokens Section -->
    <mj-collapsible-panel slot="field-panels"
        sectionKey="credentialsTokens"
        sectionName="Credentials & Tokens"
        icon="fa fa-key"
        [form]="this"
        [formContext]="formContext">
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="AccessToken"
            Type="textarea"
            [EditMode]="EditMode"
            [formContext]="formContext"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="RefreshToken"
            Type="textarea"
            [EditMode]="EditMode"
            [formContext]="formContext"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="TokenExpirationDate"
            Type="datepicker"
            [EditMode]="EditMode"
            [formContext]="formContext"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="APIKey"
            Type="textarea"
            [EditMode]="EditMode"
            [formContext]="formContext"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="ClientID"
            Type="textarea"
            [EditMode]="EditMode"
            [formContext]="formContext"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="ClientSecret"
            Type="textarea"
            [EditMode]="EditMode"
            [formContext]="formContext"
        ></mj-form-field>

    </mj-collapsible-panel>

    <!-- External System Mapping Section -->
    <mj-collapsible-panel slot="field-panels"
        sectionKey="externalSystemMapping"
        sectionName="External System Mapping"
        icon="fa fa-external-link-alt"
        [form]="this"
        [formContext]="formContext">
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="ExternalSystemID"
            Type="textbox"
            [EditMode]="EditMode"
            [formContext]="formContext"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="CustomAttribute1"
            Type="textarea"
            [EditMode]="EditMode"
            [formContext]="formContext"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="DriverClassName"
            Type="textbox"
            [EditMode]="EditMode"
            [formContext]="formContext"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="DriverImportPath"
            Type="textbox"
            [EditMode]="EditMode"
            [formContext]="formContext"
        ></mj-form-field>

    </mj-collapsible-panel>

    <!-- Run History & Monitoring Section -->
    <mj-collapsible-panel slot="field-panels"
        sectionKey="runHistoryMonitoring"
        sectionName="Run History & Monitoring"
        icon="fa fa-history"
        [form]="this"
        [formContext]="formContext">
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="LastRunID"
            Type="textbox"
            [EditMode]="EditMode"
            [formContext]="formContext"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="LastRunStartedAt"
            Type="textbox"
            [EditMode]="EditMode"
            [formContext]="formContext"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="LastRunEndedAt"
            Type="textbox"
            [EditMode]="EditMode"
            [formContext]="formContext"
        ></mj-form-field>

    </mj-collapsible-panel>

    <!-- System Metadata Section -->
    <mj-collapsible-panel slot="field-panels"
        sectionKey="systemMetadata"
        sectionName="System Metadata"
        icon="fa fa-cog"
        [form]="this"
        [formContext]="formContext">
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="__mj_CreatedAt"
            Type="textbox"
            [EditMode]="EditMode"
            [formContext]="formContext"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="__mj_UpdatedAt"
            Type="textbox"
            [EditMode]="EditMode"
            [formContext]="formContext"
        ></mj-form-field>

    </mj-collapsible-panel>
    <!-- ========================================
         RELATED ENTITY PANELS - AFTER
         ======================================== -->

    <!-- Company Integration Record Maps Section -->
    <mj-collapsible-panel slot="after-panels"
        sectionKey="companyIntegrationRecordMaps"
        sectionName="Company Integration Record Maps"
        icon="fa fa-sync"
        variant="related-entity"
        [form]="this"
        [formContext]="formContext"
        [badgeCount]="GetSectionRowCount('companyIntegrationRecordMaps')"
        [defaultExpanded]="false">
        <div *ngIf="record.IsSaved">
            <mj-explorer-entity-data-grid
                [Params]="BuildRelationshipViewParamsByEntityName('Company Integration Record Maps','CompanyIntegrationID')"
                [NewRecordValues]="NewRecordValues('Company Integration Record Maps')"
                [AllowLoad]="IsSectionExpanded('companyIntegrationRecordMaps')"
                [ShowToolbar]="false"
                (AfterDataLoad)="SetSectionRowCount('companyIntegrationRecordMaps', $event.totalRowCount)"
                >
            </mj-explorer-entity-data-grid>
        </div>
    </mj-collapsible-panel>

    <!-- Company Integration Runs Section -->
    <mj-collapsible-panel slot="after-panels"
        sectionKey="companyIntegrationRuns"
        sectionName="Company Integration Runs"
        icon="fa fa-briefcase"
        variant="related-entity"
        [form]="this"
        [formContext]="formContext"
        [badgeCount]="GetSectionRowCount('companyIntegrationRuns')"
        [defaultExpanded]="false">
        <div *ngIf="record.IsSaved">
            <mj-explorer-entity-data-grid
                [Params]="BuildRelationshipViewParamsByEntityName('Company Integration Runs','CompanyIntegrationID')"
                [NewRecordValues]="NewRecordValues('Company Integration Runs')"
                [AllowLoad]="IsSectionExpanded('companyIntegrationRuns')"
                [ShowToolbar]="false"
                (AfterDataLoad)="SetSectionRowCount('companyIntegrationRuns', $event.totalRowCount)"
                >
            </mj-explorer-entity-data-grid>
        </div>
    </mj-collapsible-panel>

    <!-- Employee Company Integrations Section -->
    <mj-collapsible-panel slot="after-panels"
        sectionKey="employeeCompanyIntegrations"
        sectionName="Employee Company Integrations"
        icon="fa fa-link"
        variant="related-entity"
        [form]="this"
        [formContext]="formContext"
        [badgeCount]="GetSectionRowCount('employeeCompanyIntegrations')"
        [defaultExpanded]="false">
        <div *ngIf="record.IsSaved">
            <mj-explorer-entity-data-grid
                [Params]="BuildRelationshipViewParamsByEntityName('Employee Company Integrations','CompanyIntegrationID')"
                [NewRecordValues]="NewRecordValues('Employee Company Integrations')"
                [AllowLoad]="IsSectionExpanded('employeeCompanyIntegrations')"
                [ShowToolbar]="false"
                (AfterDataLoad)="SetSectionRowCount('employeeCompanyIntegrations', $event.totalRowCount)"
                >
            </mj-explorer-entity-data-grid>
        </div>
    </mj-collapsible-panel>

    <!-- Lists Section -->
    <mj-collapsible-panel slot="after-panels"
        sectionKey="lists"
        sectionName="Lists"
        icon="fa fa-list-ul"
        variant="related-entity"
        [form]="this"
        [formContext]="formContext"
        [badgeCount]="GetSectionRowCount('lists')"
        [defaultExpanded]="false">
        <div *ngIf="record.IsSaved">
            <mj-explorer-entity-data-grid
                [Params]="BuildRelationshipViewParamsByEntityName('Lists','CompanyIntegrationID')"
                [NewRecordValues]="NewRecordValues('Lists')"
                [AllowLoad]="IsSectionExpanded('lists')"
                [ShowToolbar]="false"
                (AfterDataLoad)="SetSectionRowCount('lists', $event.totalRowCount)"
                >
            </mj-explorer-entity-data-grid>
        </div>
    </mj-collapsible-panel>
</mj-record-form-container>
        