<div class="record-form-container">
    <form *ngIf="record" class="record-form" #form="ngForm">
        <mj-form-toolbar [form]="this"></mj-form-toolbar>

        <div class="form-section-controls">
            <div class="control-group">
                <button (click)="expandAllSections()" title="Expand all sections">
                    <i class="fa fa-expand-alt"></i>Expand All
                </button>
                <button (click)="collapseAllSections()" title="Collapse all sections">
                    <i class="fa fa-compress-alt"></i>Collapse All
                </button>
            </div>
            <input type="text"
                   class="section-search"
                   placeholder="Search sections..."
                   (input)="filterSections($event)"
                   #sectionSearch>
            <span class="section-count">
                <span class="section-count-badge">{{getExpandedCount()}}</span> of 8 expanded
            </span>
        </div>
        <div class="form-panels-container">
<!-- Identification & Versioning Section -->
        <div class="form-card collapsible-card" data-section-name="identification & versioning" data-field-names="namespace name version versionsequence version sequence title type status">
            <div class="collapsible-header" (click)="toggleSection('identificationVersioning')" role="button" tabindex="0">
                <div class="collapsible-title">
                    <i class="fa fa-tag"></i>
                    <h3><span class="section-name">Identification & Versioning</span></h3>
                </div>
                <div class="collapse-icon">
                    <i [class]="sectionsExpanded.identificationVersioning ? 'fa fa-chevron-up' : 'fa fa-chevron-down'"></i>
                </div>
            </div>
            <div class="collapsible-body" [class.collapsed]="!sectionsExpanded.identificationVersioning">
                <div class="form-body">
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="Namespace"
            Type="textarea"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="Name"
            Type="textarea"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="Version"
            Type="textbox"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="VersionSequence"
            Type="numerictextbox"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="Title"
            Type="textarea"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="Type"
            Type="dropdownlist"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="Status"
            Type="dropdownlist"
            [EditMode]="EditMode"
        ></mj-form-field>

                </div>
            </div>
        </div>

        <!-- Specification & Design Section -->
        <div class="form-card collapsible-card" data-section-name="specification & design" data-field-names="description specification functionalrequirements functional requirements technicaldesign technical design functionalrequirementsvector functional requirements vector technicaldesignvector technical design vector hascustomprops has custom props hascustomevents has custom events requiresdata requires data dependencycount dependency count technicaldesignvectorembeddingmodelid technical design vector embedding model id functionalrequirementsvectorembeddingmodelid functional requirements vector embedding model id hasrequiredcustomprops has required custom props">
            <div class="collapsible-header" (click)="toggleSection('specificationDesign')" role="button" tabindex="0">
                <div class="collapsible-title">
                    <i class="fa fa-file-code"></i>
                    <h3><span class="section-name">Specification & Design</span></h3>
                </div>
                <div class="collapse-icon">
                    <i [class]="sectionsExpanded.specificationDesign ? 'fa fa-chevron-up' : 'fa fa-chevron-down'"></i>
                </div>
            </div>
            <div class="collapsible-body" [class.collapsed]="!sectionsExpanded.specificationDesign">
                <div class="form-body">
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="Description"
            Type="textarea"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="Specification"
            Type="textarea"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="FunctionalRequirements"
            Type="textarea"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="TechnicalDesign"
            Type="textarea"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="FunctionalRequirementsVector"
            Type="textarea"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="TechnicalDesignVector"
            Type="textarea"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="HasCustomProps"
            Type="checkbox"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="HasCustomEvents"
            Type="checkbox"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="RequiresData"
            Type="checkbox"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="DependencyCount"
            Type="numerictextbox"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="TechnicalDesignVectorEmbeddingModelID"
            Type="textarea"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="FunctionalRequirementsVectorEmbeddingModelID"
            Type="textarea"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="HasRequiredCustomProps"
            Type="checkbox"
            [EditMode]="EditMode"
        ></mj-form-field>

                </div>
            </div>
        </div>

        <!-- Developer & Ownership Section -->
        <div class="form-card collapsible-card" data-section-name="developer & ownership" data-field-names="developername developer name developeremail developer email developerorganization developer organization">
            <div class="collapsible-header" (click)="toggleSection('developerOwnership')" role="button" tabindex="0">
                <div class="collapsible-title">
                    <i class="fa fa-user"></i>
                    <h3><span class="section-name">Developer & Ownership</span></h3>
                </div>
                <div class="collapse-icon">
                    <i [class]="sectionsExpanded.developerOwnership ? 'fa fa-chevron-up' : 'fa fa-chevron-down'"></i>
                </div>
            </div>
            <div class="collapsible-body" [class.collapsed]="!sectionsExpanded.developerOwnership">
                <div class="form-body">
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="DeveloperName"
            Type="textarea"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="DeveloperEmail"
            Type="textarea"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="DeveloperOrganization"
            Type="textarea"
            [EditMode]="EditMode"
        ></mj-form-field>

                </div>
            </div>
        </div>

        <!-- Registry & Synchronization Section -->
        <div class="form-card collapsible-card" data-section-name="registry & synchronization" data-field-names="sourceregistryid source registry id replicatedat replicated at lastsyncedat last synced at sourceregistry source registry">
            <div class="collapsible-header" (click)="toggleSection('registrySynchronization')" role="button" tabindex="0">
                <div class="collapsible-title">
                    <i class="fa fa-sync"></i>
                    <h3><span class="section-name">Registry & Synchronization</span></h3>
                </div>
                <div class="collapse-icon">
                    <i [class]="sectionsExpanded.registrySynchronization ? 'fa fa-chevron-up' : 'fa fa-chevron-down'"></i>
                </div>
            </div>
            <div class="collapsible-body" [class.collapsed]="!sectionsExpanded.registrySynchronization">
                <div class="form-body">
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="SourceRegistryID"
            Type="textbox"
            [EditMode]="EditMode"
            LinkType="Record"
            LinkComponentType="Search"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="ReplicatedAt"
            Type="datepicker"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="LastSyncedAt"
            Type="datepicker"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="SourceRegistry"
            Type="textbox"
            [EditMode]="EditMode"
        ></mj-form-field>

                </div>
            </div>
        </div>

        <!-- System Metadata Section -->
        <div class="form-card collapsible-card" data-section-name="system metadata" data-field-names="__mj_createdat created at __mj_updatedat updated at">
            <div class="collapsible-header" (click)="toggleSection('systemMetadata')" role="button" tabindex="0">
                <div class="collapsible-title">
                    <i class="fa fa-cog"></i>
                    <h3><span class="section-name">System Metadata</span></h3>
                </div>
                <div class="collapse-icon">
                    <i [class]="sectionsExpanded.systemMetadata ? 'fa fa-chevron-up' : 'fa fa-chevron-down'"></i>
                </div>
            </div>
            <div class="collapsible-body" [class.collapsed]="!sectionsExpanded.systemMetadata">
                <div class="form-body">
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="__mj_CreatedAt"
            Type="textbox"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="__mj_UpdatedAt"
            Type="textbox"
            [EditMode]="EditMode"
        ></mj-form-field>

                </div>
            </div>
        </div>
        <div class="related-entity-grid">

        <!-- MJ: Component Dependencies Section -->
        <div class="form-card collapsible-card related-entity" data-section-name="mj: component dependencies" data-field-names="mj: component dependencies" data-section-key="mJComponentDependencies">
            <div class="collapsible-header" (click)="toggleSection('mJComponentDependencies')" role="button" tabindex="0">
                <div class="collapsible-title">
                    <i class="fa fa-sitemap"></i>
                    <h3>
                        <span class="section-name">MJ: Component Dependencies</span>
                        <span class="row-count-badge" *ngIf="sectionRowCounts?.['mJComponentDependencies']">{{sectionRowCounts['mJComponentDependencies']}}</span>
                    </h3>
                </div>
                <div class="collapse-icon">
                    <i [class]="sectionsExpanded.mJComponentDependencies ? 'fa fa-chevron-up' : 'fa fa-chevron-down'"></i>
                </div>
            </div>
            <div class="collapsible-body" [class.collapsed]="!sectionsExpanded.mJComponentDependencies" *ngIf="record.IsSaved">
                <div class="form-body">
                    <mj-user-view-grid
                        [Params]="BuildRelationshipViewParamsByEntityName('MJ: Component Dependencies','DependencyComponentID')"
                        [NewRecordValues]="NewRecordValues('MJ: Component Dependencies')"
                        [AllowLoad]="IsCurrentSection('mJComponentDependencies')"
                        [EditMode]="GridEditMode()"
                        (dataLoaded)="sectionRowCounts['mJComponentDependencies'] = $event.totalRowCount"
                        >
                    </mj-user-view-grid>
                </div>
            </div>
        </div>

        <!-- MJ: Component Library Links Section -->
        <div class="form-card collapsible-card related-entity" data-section-name="mj: component library links" data-field-names="mj: component library links" data-section-key="mJComponentLibraryLinks">
            <div class="collapsible-header" (click)="toggleSection('mJComponentLibraryLinks')" role="button" tabindex="0">
                <div class="collapsible-title">
                    <i class="fa fa-plug"></i>
                    <h3>
                        <span class="section-name">MJ: Component Library Links</span>
                        <span class="row-count-badge" *ngIf="sectionRowCounts?.['mJComponentLibraryLinks']">{{sectionRowCounts['mJComponentLibraryLinks']}}</span>
                    </h3>
                </div>
                <div class="collapse-icon">
                    <i [class]="sectionsExpanded.mJComponentLibraryLinks ? 'fa fa-chevron-up' : 'fa fa-chevron-down'"></i>
                </div>
            </div>
            <div class="collapsible-body" [class.collapsed]="!sectionsExpanded.mJComponentLibraryLinks" *ngIf="record.IsSaved">
                <div class="form-body">
                    <mj-user-view-grid
                        [Params]="BuildRelationshipViewParamsByEntityName('MJ: Component Library Links','ComponentID')"
                        [NewRecordValues]="NewRecordValues('MJ: Component Library Links')"
                        [AllowLoad]="IsCurrentSection('mJComponentLibraryLinks')"
                        [EditMode]="GridEditMode()"
                        (dataLoaded)="sectionRowCounts['mJComponentLibraryLinks'] = $event.totalRowCount"
                        >
                    </mj-user-view-grid>
                </div>
            </div>
        </div>

        <!-- MJ: Component Dependencies Section -->
        <div class="form-card collapsible-card related-entity" data-section-name="mj: component dependencies" data-field-names="mj: component dependencies" data-section-key="mJComponentDependencies">
            <div class="collapsible-header" (click)="toggleSection('mJComponentDependencies')" role="button" tabindex="0">
                <div class="collapsible-title">
                    <i class="fa fa-sitemap"></i>
                    <h3>
                        <span class="section-name">MJ: Component Dependencies</span>
                        <span class="row-count-badge" *ngIf="sectionRowCounts?.['mJComponentDependencies']">{{sectionRowCounts['mJComponentDependencies']}}</span>
                    </h3>
                </div>
                <div class="collapse-icon">
                    <i [class]="sectionsExpanded.mJComponentDependencies ? 'fa fa-chevron-up' : 'fa fa-chevron-down'"></i>
                </div>
            </div>
            <div class="collapsible-body" [class.collapsed]="!sectionsExpanded.mJComponentDependencies" *ngIf="record.IsSaved">
                <div class="form-body">
                    <mj-user-view-grid
                        [Params]="BuildRelationshipViewParamsByEntityName('MJ: Component Dependencies','ComponentID')"
                        [NewRecordValues]="NewRecordValues('MJ: Component Dependencies')"
                        [AllowLoad]="IsCurrentSection('mJComponentDependencies')"
                        [EditMode]="GridEditMode()"
                        (dataLoaded)="sectionRowCounts['mJComponentDependencies'] = $event.totalRowCount"
                        >
                    </mj-user-view-grid>
                </div>
            </div>
        </div>
        </div>
        </div>
    </form>
</div>
        