<div class="record-form-container">
    <form *ngIf="record" class="record-form" #form="ngForm">
        <mj-form-toolbar [form]="this"></mj-form-toolbar>

        <div class="form-section-controls">
            <div class="control-group">
                <button (click)="expandAllSections()" title="Expand all sections">
                    <i class="fa fa-expand-alt"></i>Expand All
                </button>
                <button (click)="collapseAllSections()" title="Collapse all sections">
                    <i class="fa fa-compress-alt"></i>Collapse All
                </button>
            </div>
            <input type="text"
                   class="section-search"
                   placeholder="Search sections..."
                   (input)="filterSections($event)"
                   #sectionSearch>
            <span class="section-count">
                <span class="section-count-badge">{{getExpandedCount()}}</span> of 7 expanded
            </span>
        </div>
        <div class="form-panels-container">
<!-- Report Details Section -->
        <div class="form-card collapsible-card" data-section-name="report details" data-field-names="name description categoryid category id sharingscope sharing scope thumbnail environmentid environment id category environment">
            <div class="collapsible-header" (click)="toggleSection('reportDetails')" role="button" tabindex="0">
                <div class="collapsible-title">
                    <i class="fa fa-file-alt"></i>
                    <h3><span class="section-name">Report Details</span></h3>
                </div>
                <div class="collapse-icon">
                    <i [class]="sectionsExpanded.reportDetails ? 'fa fa-chevron-up' : 'fa fa-chevron-down'"></i>
                </div>
            </div>
            <div class="collapsible-body" [class.collapsed]="!sectionsExpanded.reportDetails">
                <div class="form-body">
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="Name"
            Type="textarea"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="Description"
            Type="textarea"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="CategoryID"
            Type="textbox"
            [EditMode]="EditMode"
            LinkType="Record"
            LinkComponentType="Search"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="SharingScope"
            Type="dropdownlist"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="Thumbnail"
            Type="textarea"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="EnvironmentID"
            Type="textbox"
            [EditMode]="EditMode"
            LinkType="Record"
            LinkComponentType="Search"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="Category"
            Type="textbox"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="Environment"
            Type="textbox"
            [EditMode]="EditMode"
        ></mj-form-field>

                </div>
            </div>
        </div>

        <!-- Data Context & Relationships Section -->
        <div class="form-card collapsible-card" data-section-name="data context & relationships" data-field-names="userid user id conversationid conversation id conversationdetailid conversation detail id datacontextid data context id outputworkflowid output workflow id user conversation datacontext data context outputworkflow output workflow">
            <div class="collapsible-header" (click)="toggleSection('dataContextRelationships')" role="button" tabindex="0">
                <div class="collapsible-title">
                    <i class="fa fa-sitemap"></i>
                    <h3><span class="section-name">Data Context & Relationships</span></h3>
                </div>
                <div class="collapse-icon">
                    <i [class]="sectionsExpanded.dataContextRelationships ? 'fa fa-chevron-up' : 'fa fa-chevron-down'"></i>
                </div>
            </div>
            <div class="collapsible-body" [class.collapsed]="!sectionsExpanded.dataContextRelationships">
                <div class="form-body">
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="UserID"
            Type="textbox"
            [EditMode]="EditMode"
            LinkType="Record"
            LinkComponentType="Search"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="ConversationID"
            Type="textbox"
            [EditMode]="EditMode"
            LinkType="Record"
            LinkComponentType="Search"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="ConversationDetailID"
            Type="textbox"
            [EditMode]="EditMode"
            LinkType="Record"
            LinkComponentType="Search"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="DataContextID"
            Type="textbox"
            [EditMode]="EditMode"
            LinkType="Record"
            LinkComponentType="Search"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="OutputWorkflowID"
            Type="textbox"
            [EditMode]="EditMode"
            LinkType="Record"
            LinkComponentType="Search"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="User"
            Type="textbox"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="Conversation"
            Type="textbox"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="DataContext"
            Type="textbox"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="OutputWorkflow"
            Type="textbox"
            [EditMode]="EditMode"
        ></mj-form-field>

                </div>
            </div>
        </div>

        <!-- Output & Scheduling Section -->
        <div class="form-card collapsible-card" data-section-name="output & scheduling" data-field-names="configuration outputtriggertypeid output trigger type id outputformattypeid output format type id outputdeliverytypeid output delivery type id outputfrequency output frequency outputtargetemail output target email outputtriggertype output trigger type outputformattype output format type outputdeliverytype output delivery type">
            <div class="collapsible-header" (click)="toggleSection('outputScheduling')" role="button" tabindex="0">
                <div class="collapsible-title">
                    <i class="fa fa-calendar"></i>
                    <h3><span class="section-name">Output & Scheduling</span></h3>
                </div>
                <div class="collapse-icon">
                    <i [class]="sectionsExpanded.outputScheduling ? 'fa fa-chevron-up' : 'fa fa-chevron-down'"></i>
                </div>
            </div>
            <div class="collapsible-body" [class.collapsed]="!sectionsExpanded.outputScheduling">
                <div class="form-body">
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="Configuration"
            Type="textarea"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="OutputTriggerTypeID"
            Type="textbox"
            [EditMode]="EditMode"
            LinkType="Record"
            LinkComponentType="Search"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="OutputFormatTypeID"
            Type="textbox"
            [EditMode]="EditMode"
            LinkType="Record"
            LinkComponentType="Search"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="OutputDeliveryTypeID"
            Type="textbox"
            [EditMode]="EditMode"
            LinkType="Record"
            LinkComponentType="Search"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="OutputFrequency"
            Type="textbox"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="OutputTargetEmail"
            Type="textarea"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="OutputTriggerType"
            Type="textbox"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="OutputFormatType"
            Type="textbox"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="OutputDeliveryType"
            Type="textbox"
            [EditMode]="EditMode"
        ></mj-form-field>

                </div>
            </div>
        </div>

        <!-- System Metadata Section -->
        <div class="form-card collapsible-card" data-section-name="system metadata" data-field-names="__mj_createdat created at __mj_updatedat updated at">
            <div class="collapsible-header" (click)="toggleSection('systemMetadata')" role="button" tabindex="0">
                <div class="collapsible-title">
                    <i class="fa fa-cog"></i>
                    <h3><span class="section-name">System Metadata</span></h3>
                </div>
                <div class="collapse-icon">
                    <i [class]="sectionsExpanded.systemMetadata ? 'fa fa-chevron-up' : 'fa fa-chevron-down'"></i>
                </div>
            </div>
            <div class="collapsible-body" [class.collapsed]="!sectionsExpanded.systemMetadata">
                <div class="form-body">
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="__mj_CreatedAt"
            Type="textbox"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="__mj_UpdatedAt"
            Type="textbox"
            [EditMode]="EditMode"
        ></mj-form-field>

                </div>
            </div>
        </div>
        <div class="related-entity-grid">

        <!-- Report Snapshots Section -->
        <div class="form-card collapsible-card related-entity" data-section-name="report snapshots" data-field-names="report snapshots" data-section-key="reportSnapshots">
            <div class="collapsible-header" (click)="toggleSection('reportSnapshots')" role="button" tabindex="0">
                <div class="collapsible-title">
                    <i class="fa fa-camera"></i>
                    <h3>
                        <span class="section-name">Report Snapshots</span>
                        <span class="row-count-badge"
                              *ngIf="sectionRowCounts?.['reportSnapshots'] !== undefined"
                              [class.zero-rows]="sectionRowCounts['reportSnapshots'] === 0">
                            {{sectionRowCounts['reportSnapshots']}}
                        </span>
                    </h3>
                </div>
                <div class="collapse-icon">
                    <i [class]="sectionsExpanded.reportSnapshots ? 'fa fa-chevron-up' : 'fa fa-chevron-down'"></i>
                </div>
            </div>
            <div class="collapsible-body" [class.collapsed]="!sectionsExpanded.reportSnapshots" *ngIf="record.IsSaved">
                <div class="form-body">
                    <mj-user-view-grid
                        [Params]="BuildRelationshipViewParamsByEntityName('Report Snapshots','ReportID')"
                        [NewRecordValues]="NewRecordValues('Report Snapshots')"
                        [AllowLoad]="IsCurrentSection('reportSnapshots')"
                        [EditMode]="GridEditMode()"
                        (dataLoaded)="sectionRowCounts['reportSnapshots'] = $event.totalRowCount"
                        >
                    </mj-user-view-grid>
                </div>
            </div>
        </div>

        <!-- MJ: Report Versions Section -->
        <div class="form-card collapsible-card related-entity" data-section-name="mj: report versions" data-field-names="mj: report versions" data-section-key="mJReportVersions">
            <div class="collapsible-header" (click)="toggleSection('mJReportVersions')" role="button" tabindex="0">
                <div class="collapsible-title">
                    <i class="fa fa-file-alt"></i>
                    <h3>
                        <span class="section-name">MJ: Report Versions</span>
                        <span class="row-count-badge"
                              *ngIf="sectionRowCounts?.['mJReportVersions'] !== undefined"
                              [class.zero-rows]="sectionRowCounts['mJReportVersions'] === 0">
                            {{sectionRowCounts['mJReportVersions']}}
                        </span>
                    </h3>
                </div>
                <div class="collapse-icon">
                    <i [class]="sectionsExpanded.mJReportVersions ? 'fa fa-chevron-up' : 'fa fa-chevron-down'"></i>
                </div>
            </div>
            <div class="collapsible-body" [class.collapsed]="!sectionsExpanded.mJReportVersions" *ngIf="record.IsSaved">
                <div class="form-body">
                    <mj-user-view-grid
                        [Params]="BuildRelationshipViewParamsByEntityName('MJ: Report Versions','ReportID')"
                        [NewRecordValues]="NewRecordValues('MJ: Report Versions')"
                        [AllowLoad]="IsCurrentSection('mJReportVersions')"
                        [EditMode]="GridEditMode()"
                        (dataLoaded)="sectionRowCounts['mJReportVersions'] = $event.totalRowCount"
                        >
                    </mj-user-view-grid>
                </div>
            </div>
        </div>

        <!-- MJ: Report User States Section -->
        <div class="form-card collapsible-card related-entity" data-section-name="mj: report user states" data-field-names="mj: report user states" data-section-key="mJReportUserStates">
            <div class="collapsible-header" (click)="toggleSection('mJReportUserStates')" role="button" tabindex="0">
                <div class="collapsible-title">
                    <i class="fa fa-chart-line"></i>
                    <h3>
                        <span class="section-name">MJ: Report User States</span>
                        <span class="row-count-badge"
                              *ngIf="sectionRowCounts?.['mJReportUserStates'] !== undefined"
                              [class.zero-rows]="sectionRowCounts['mJReportUserStates'] === 0">
                            {{sectionRowCounts['mJReportUserStates']}}
                        </span>
                    </h3>
                </div>
                <div class="collapse-icon">
                    <i [class]="sectionsExpanded.mJReportUserStates ? 'fa fa-chevron-up' : 'fa fa-chevron-down'"></i>
                </div>
            </div>
            <div class="collapsible-body" [class.collapsed]="!sectionsExpanded.mJReportUserStates" *ngIf="record.IsSaved">
                <div class="form-body">
                    <mj-user-view-grid
                        [Params]="BuildRelationshipViewParamsByEntityName('MJ: Report User States','ReportID')"
                        [NewRecordValues]="NewRecordValues('MJ: Report User States')"
                        [AllowLoad]="IsCurrentSection('mJReportUserStates')"
                        [EditMode]="GridEditMode()"
                        (dataLoaded)="sectionRowCounts['mJReportUserStates'] = $event.totalRowCount"
                        >
                    </mj-user-view-grid>
                </div>
            </div>
        </div>
        </div>
        </div>
    </form>
</div>
        