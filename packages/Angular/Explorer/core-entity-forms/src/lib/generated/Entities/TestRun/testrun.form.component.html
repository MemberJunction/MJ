<mj-record-form-container [record]="record" [formComponent]="this">

    <!-- ========================================
         FIELD PANELS
         ======================================== -->
    <!-- Test & Target Info Section -->
    <mj-collapsible-panel slot="field-panels"
        sectionKey="testTargetInfo"
        sectionName="Test & Target Info"
        icon="fa fa-bullseye"
        [form]="this"
        [formContext]="formContext">
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="TestID"
            Type="textbox"
            [EditMode]="EditMode"
            [formContext]="formContext"
            LinkType="Record"
            LinkComponentType="Search"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="RunByUserID"
            Type="textbox"
            [EditMode]="EditMode"
            [formContext]="formContext"
            LinkType="Record"
            LinkComponentType="Search"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="TargetType"
            Type="textbox"
            [EditMode]="EditMode"
            [formContext]="formContext"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="TargetLogID"
            Type="textbox"
            [EditMode]="EditMode"
            [formContext]="formContext"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="RunByUserName"
            Type="textarea"
            [EditMode]="EditMode"
            [formContext]="formContext"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="RunByUserEmail"
            Type="textarea"
            [EditMode]="EditMode"
            [formContext]="formContext"
            LinkType="Email"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="TargetLogEntityID"
            Type="textbox"
            [EditMode]="EditMode"
            [formContext]="formContext"
            LinkType="Record"
            LinkComponentType="Search"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="ResolvedVariables"
            Type="textarea"
            [EditMode]="EditMode"
            [formContext]="formContext"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="Test"
            Type="textbox"
            [EditMode]="EditMode"
            [formContext]="formContext"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="RunByUser"
            Type="textbox"
            [EditMode]="EditMode"
            [formContext]="formContext"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="TargetLogEntity"
            Type="textbox"
            [EditMode]="EditMode"
            [formContext]="formContext"
        ></mj-form-field>

    </mj-collapsible-panel>

    <!-- Run Metadata Section -->
    <mj-collapsible-panel slot="field-panels"
        sectionKey="runMetadata"
        sectionName="Run Metadata"
        icon="fa fa-clock"
        [form]="this"
        [formContext]="formContext">
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="TestSuiteRunID"
            Type="textbox"
            [EditMode]="EditMode"
            [formContext]="formContext"
            LinkType="Record"
            LinkComponentType="Search"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="Sequence"
            Type="numerictextbox"
            [EditMode]="EditMode"
            [formContext]="formContext"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="Status"
            Type="dropdownlist"
            [EditMode]="EditMode"
            [formContext]="formContext"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="StartedAt"
            Type="datepicker"
            [EditMode]="EditMode"
            [formContext]="formContext"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="CompletedAt"
            Type="datepicker"
            [EditMode]="EditMode"
            [formContext]="formContext"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="DurationSeconds"
            Type="numerictextbox"
            [EditMode]="EditMode"
            [formContext]="formContext"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="Tags"
            Type="textarea"
            [EditMode]="EditMode"
            [formContext]="formContext"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="MachineName"
            Type="textarea"
            [EditMode]="EditMode"
            [formContext]="formContext"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="MachineID"
            Type="textarea"
            [EditMode]="EditMode"
            [formContext]="formContext"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="RunContextDetails"
            Type="textarea"
            [EditMode]="EditMode"
            [formContext]="formContext"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="TestSuiteRun"
            Type="textbox"
            [EditMode]="EditMode"
            [formContext]="formContext"
        ></mj-form-field>

    </mj-collapsible-panel>

    <!-- Input & Expected Output Section -->
    <mj-collapsible-panel slot="field-panels"
        sectionKey="inputExpectedOutput"
        sectionName="Input & Expected Output"
        icon="fa fa-database"
        [form]="this"
        [formContext]="formContext">
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="InputData"
            Type="textarea"
            [EditMode]="EditMode"
            [formContext]="formContext"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="ExpectedOutputData"
            Type="textarea"
            [EditMode]="EditMode"
            [formContext]="formContext"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="ActualOutputData"
            Type="textarea"
            [EditMode]="EditMode"
            [formContext]="formContext"
        ></mj-form-field>

    </mj-collapsible-panel>

    <!-- Result Analysis Section -->
    <mj-collapsible-panel slot="field-panels"
        sectionKey="resultAnalysis"
        sectionName="Result Analysis"
        icon="fa fa-chart-line"
        [form]="this"
        [formContext]="formContext">
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="PassedChecks"
            Type="numerictextbox"
            [EditMode]="EditMode"
            [formContext]="formContext"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="FailedChecks"
            Type="numerictextbox"
            [EditMode]="EditMode"
            [formContext]="formContext"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="TotalChecks"
            Type="numerictextbox"
            [EditMode]="EditMode"
            [formContext]="formContext"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="Score"
            Type="numerictextbox"
            [EditMode]="EditMode"
            [formContext]="formContext"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="CostUSD"
            Type="numerictextbox"
            [EditMode]="EditMode"
            [formContext]="formContext"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="ErrorMessage"
            Type="textarea"
            [EditMode]="EditMode"
            [formContext]="formContext"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="ResultDetails"
            Type="textarea"
            [EditMode]="EditMode"
            [formContext]="formContext"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="Log"
            Type="textarea"
            [EditMode]="EditMode"
            [formContext]="formContext"
        ></mj-form-field>

    </mj-collapsible-panel>

    <!-- System Metadata Section -->
    <mj-collapsible-panel slot="field-panels"
        sectionKey="systemMetadata"
        sectionName="System Metadata"
        icon="fa fa-cog"
        [form]="this"
        [formContext]="formContext">
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="__mj_CreatedAt"
            Type="textbox"
            [EditMode]="EditMode"
            [formContext]="formContext"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="__mj_UpdatedAt"
            Type="textbox"
            [EditMode]="EditMode"
            [formContext]="formContext"
        ></mj-form-field>

    </mj-collapsible-panel>
    <!-- ========================================
         RELATED ENTITY PANELS - AFTER
         ======================================== -->

    <!-- MJ: Test Run Feedbacks Section -->
    <mj-collapsible-panel slot="after-panels"
        sectionKey="mJTestRunFeedbacks"
        sectionName="MJ: Test Run Feedbacks"
        icon="fa fa-clipboard-check"
        variant="related-entity"
        [form]="this"
        [formContext]="formContext"
        [badgeCount]="GetSectionRowCount('mJTestRunFeedbacks')"
        [defaultExpanded]="false">
        <div *ngIf="record.IsSaved">
            <mj-explorer-entity-data-grid
                [Params]="BuildRelationshipViewParamsByEntityName('MJ: Test Run Feedbacks','TestRunID')"
                [NewRecordValues]="NewRecordValues('MJ: Test Run Feedbacks')"
                [AllowLoad]="IsSectionExpanded('mJTestRunFeedbacks')"
                [ShowToolbar]="false"
                (AfterDataLoad)="SetSectionRowCount('mJTestRunFeedbacks', $event.totalRowCount)"
                >
            </mj-explorer-entity-data-grid>
        </div>
    </mj-collapsible-panel>

    <!-- MJ: AI Prompt Runs Section -->
    <mj-collapsible-panel slot="after-panels"
        sectionKey="mJAIPromptRuns"
        sectionName="MJ: AI Prompt Runs"
        icon="fa fa-robot"
        variant="related-entity"
        [form]="this"
        [formContext]="formContext"
        [badgeCount]="GetSectionRowCount('mJAIPromptRuns')"
        [defaultExpanded]="false">
        <div *ngIf="record.IsSaved">
            <mj-explorer-entity-data-grid
                [Params]="BuildRelationshipViewParamsByEntityName('MJ: AI Prompt Runs','TestRunID')"
                [NewRecordValues]="NewRecordValues('MJ: AI Prompt Runs')"
                [AllowLoad]="IsSectionExpanded('mJAIPromptRuns')"
                [ShowToolbar]="false"
                (AfterDataLoad)="SetSectionRowCount('mJAIPromptRuns', $event.totalRowCount)"
                >
            </mj-explorer-entity-data-grid>
        </div>
    </mj-collapsible-panel>

    <!-- MJ: AI Agent Runs Section -->
    <mj-collapsible-panel slot="after-panels"
        sectionKey="mJAIAgentRuns"
        sectionName="MJ: AI Agent Runs"
        icon="fa fa-robot"
        variant="related-entity"
        [form]="this"
        [formContext]="formContext"
        [badgeCount]="GetSectionRowCount('mJAIAgentRuns')"
        [defaultExpanded]="false">
        <div *ngIf="record.IsSaved">
            <mj-explorer-entity-data-grid
                [Params]="BuildRelationshipViewParamsByEntityName('MJ: AI Agent Runs','TestRunID')"
                [NewRecordValues]="NewRecordValues('MJ: AI Agent Runs')"
                [AllowLoad]="IsSectionExpanded('mJAIAgentRuns')"
                [ShowToolbar]="false"
                (AfterDataLoad)="SetSectionRowCount('mJAIAgentRuns', $event.totalRowCount)"
                >
            </mj-explorer-entity-data-grid>
        </div>
    </mj-collapsible-panel>

    <!-- Conversations Section -->
    <mj-collapsible-panel slot="after-panels"
        sectionKey="conversations"
        sectionName="Conversations"
        icon="fa-regular fa-comments"
        variant="related-entity"
        [form]="this"
        [formContext]="formContext"
        [badgeCount]="GetSectionRowCount('conversations')"
        [defaultExpanded]="false">
        <div *ngIf="record.IsSaved">
            <mj-explorer-entity-data-grid
                [Params]="BuildRelationshipViewParamsByEntityName('Conversations','TestRunID')"
                [NewRecordValues]="NewRecordValues('Conversations')"
                [AllowLoad]="IsSectionExpanded('conversations')"
                [ShowToolbar]="false"
                (AfterDataLoad)="SetSectionRowCount('conversations', $event.totalRowCount)"
                >
            </mj-explorer-entity-data-grid>
        </div>
    </mj-collapsible-panel>

    <!-- Conversation Details Section -->
    <mj-collapsible-panel slot="after-panels"
        sectionKey="conversationDetails"
        sectionName="Conversation Details"
        icon="fa fa-comments"
        variant="related-entity"
        [form]="this"
        [formContext]="formContext"
        [badgeCount]="GetSectionRowCount('conversationDetails')"
        [defaultExpanded]="false">
        <div *ngIf="record.IsSaved">
            <mj-explorer-entity-data-grid
                [Params]="BuildRelationshipViewParamsByEntityName('Conversation Details','TestRunID')"
                [NewRecordValues]="NewRecordValues('Conversation Details')"
                [AllowLoad]="IsSectionExpanded('conversationDetails')"
                [ShowToolbar]="false"
                (AfterDataLoad)="SetSectionRowCount('conversationDetails', $event.totalRowCount)"
                >
            </mj-explorer-entity-data-grid>
        </div>
    </mj-collapsible-panel>
</mj-record-form-container>
        