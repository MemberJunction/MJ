<div class="record-form-container">
    <form *ngIf="record" class="record-form" #form="ngForm">
        <mj-form-toolbar [form]="this"></mj-form-toolbar>

        <div class="form-section-controls">
            <div class="control-group">
                <button (click)="expandAllSections()" title="Expand all sections">
                    <i class="fa fa-expand-alt"></i>Expand All
                </button>
                <button (click)="collapseAllSections()" title="Collapse all sections">
                    <i class="fa fa-compress-alt"></i>Collapse All
                </button>
            </div>
            <input type="text"
                   class="section-search"
                   placeholder="Search sections..."
                   (input)="filterSections($event)"
                   #sectionSearch>
            <span class="section-count">
                <span class="section-count-badge">{{getExpandedCount()}}</span> of 7 expanded
            </span>
        </div>
        <div class="form-panels-container">
<!-- Job Details Section -->
        <div class="form-card collapsible-card" data-section-name="job details" data-field-names="jobtypeid job type id name description configuration concurrencymode concurrency mode jobtype job type">
            <div class="collapsible-header" (click)="toggleSection('jobDetails')" role="button" tabindex="0">
                <div class="collapsible-title">
                    <i class="fa fa-clipboard-list"></i>
                    <h3><span class="section-name">Job Details</span></h3>
                </div>
                <div class="collapse-icon">
                    <i [class]="sectionsExpanded.jobDetails ? 'fa fa-chevron-up' : 'fa fa-chevron-down'"></i>
                </div>
            </div>
            <div class="collapsible-body" [class.collapsed]="!sectionsExpanded.jobDetails">
                <div class="form-body">
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="JobTypeID"
            Type="textbox"
            [EditMode]="EditMode"
            LinkType="Record"
            LinkComponentType="Search"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="Name"
            Type="textarea"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="Description"
            Type="textarea"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="Configuration"
            Type="textarea"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="ConcurrencyMode"
            Type="dropdownlist"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="JobType"
            Type="textbox"
            [EditMode]="EditMode"
        ></mj-form-field>

                </div>
            </div>
        </div>

        <!-- Schedule & Timing Section -->
        <div class="form-card collapsible-card" data-section-name="schedule & timing" data-field-names="cronexpression cron expression timezone startat start at endat end at lastrunat last run at nextrunat next run at expectedcompletionat expected completion at">
            <div class="collapsible-header" (click)="toggleSection('scheduleTiming')" role="button" tabindex="0">
                <div class="collapsible-title">
                    <i class="fa fa-clock"></i>
                    <h3><span class="section-name">Schedule & Timing</span></h3>
                </div>
                <div class="collapse-icon">
                    <i [class]="sectionsExpanded.scheduleTiming ? 'fa fa-chevron-up' : 'fa fa-chevron-down'"></i>
                </div>
            </div>
            <div class="collapsible-body" [class.collapsed]="!sectionsExpanded.scheduleTiming">
                <div class="form-body">
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="CronExpression"
            Type="textarea"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="Timezone"
            Type="textbox"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="StartAt"
            Type="datepicker"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="EndAt"
            Type="datepicker"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="LastRunAt"
            Type="datepicker"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="NextRunAt"
            Type="datepicker"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="ExpectedCompletionAt"
            Type="datepicker"
            [EditMode]="EditMode"
        ></mj-form-field>

                </div>
            </div>
        </div>

        <!-- Execution Metrics Section -->
        <div class="form-card collapsible-card" data-section-name="execution metrics" data-field-names="status runcount run count successcount success count failurecount failure count">
            <div class="collapsible-header" (click)="toggleSection('executionMetrics')" role="button" tabindex="0">
                <div class="collapsible-title">
                    <i class="fa fa-chart-line"></i>
                    <h3><span class="section-name">Execution Metrics</span></h3>
                </div>
                <div class="collapse-icon">
                    <i [class]="sectionsExpanded.executionMetrics ? 'fa fa-chevron-up' : 'fa fa-chevron-down'"></i>
                </div>
            </div>
            <div class="collapsible-body" [class.collapsed]="!sectionsExpanded.executionMetrics">
                <div class="form-body">
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="Status"
            Type="dropdownlist"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="RunCount"
            Type="numerictextbox"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="SuccessCount"
            Type="numerictextbox"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="FailureCount"
            Type="numerictextbox"
            [EditMode]="EditMode"
        ></mj-form-field>

                </div>
            </div>
        </div>

        <!-- Notification Settings Section -->
        <div class="form-card collapsible-card" data-section-name="notification settings" data-field-names="owneruserid owner user id notifyonsuccess notify on success notifyonfailure notify on failure notifyuserid notify user id notifyviaemail notify via email notifyviainapp notify via in app owneruser owner user notifyuser notify user">
            <div class="collapsible-header" (click)="toggleSection('notificationSettings')" role="button" tabindex="0">
                <div class="collapsible-title">
                    <i class="fa fa-bell"></i>
                    <h3><span class="section-name">Notification Settings</span></h3>
                </div>
                <div class="collapse-icon">
                    <i [class]="sectionsExpanded.notificationSettings ? 'fa fa-chevron-up' : 'fa fa-chevron-down'"></i>
                </div>
            </div>
            <div class="collapsible-body" [class.collapsed]="!sectionsExpanded.notificationSettings">
                <div class="form-body">
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="OwnerUserID"
            Type="textbox"
            [EditMode]="EditMode"
            LinkType="Record"
            LinkComponentType="Search"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="NotifyOnSuccess"
            Type="checkbox"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="NotifyOnFailure"
            Type="checkbox"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="NotifyUserID"
            Type="textbox"
            [EditMode]="EditMode"
            LinkType="Record"
            LinkComponentType="Search"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="NotifyViaEmail"
            Type="checkbox"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="NotifyViaInApp"
            Type="checkbox"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="OwnerUser"
            Type="textbox"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="NotifyUser"
            Type="textbox"
            [EditMode]="EditMode"
        ></mj-form-field>

                </div>
            </div>
        </div>

        <!-- Distributed Locking Section -->
        <div class="form-card collapsible-card" data-section-name="distributed locking" data-field-names="locktoken lock token lockedat locked at lockedbyinstance locked by instance">
            <div class="collapsible-header" (click)="toggleSection('distributedLocking')" role="button" tabindex="0">
                <div class="collapsible-title">
                    <i class="fa fa-lock"></i>
                    <h3><span class="section-name">Distributed Locking</span></h3>
                </div>
                <div class="collapse-icon">
                    <i [class]="sectionsExpanded.distributedLocking ? 'fa fa-chevron-up' : 'fa fa-chevron-down'"></i>
                </div>
            </div>
            <div class="collapsible-body" [class.collapsed]="!sectionsExpanded.distributedLocking">
                <div class="form-body">
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="LockToken"
            Type="textbox"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="LockedAt"
            Type="datepicker"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="LockedByInstance"
            Type="textarea"
            [EditMode]="EditMode"
        ></mj-form-field>

                </div>
            </div>
        </div>

        <!-- System Metadata Section -->
        <div class="form-card collapsible-card" data-section-name="system metadata" data-field-names="__mj_createdat created at __mj_updatedat updated at">
            <div class="collapsible-header" (click)="toggleSection('systemMetadata')" role="button" tabindex="0">
                <div class="collapsible-title">
                    <i class="fa fa-database"></i>
                    <h3><span class="section-name">System Metadata</span></h3>
                </div>
                <div class="collapse-icon">
                    <i [class]="sectionsExpanded.systemMetadata ? 'fa fa-chevron-up' : 'fa fa-chevron-down'"></i>
                </div>
            </div>
            <div class="collapsible-body" [class.collapsed]="!sectionsExpanded.systemMetadata">
                <div class="form-body">
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="__mj_CreatedAt"
            Type="textbox"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="__mj_UpdatedAt"
            Type="textbox"
            [EditMode]="EditMode"
        ></mj-form-field>

                </div>
            </div>
        </div>
        <div class="related-entity-grid">

        <!-- MJ: Scheduled Job Runs Section -->
        <div class="form-card collapsible-card related-entity" data-section-name="mj: scheduled job runs" data-field-names="mj: scheduled job runs" data-section-key="mJScheduledJobRuns">
            <div class="collapsible-header" (click)="toggleSection('mJScheduledJobRuns')" role="button" tabindex="0">
                <div class="collapsible-title">
                    <i class="fa fa-tasks"></i>
                    <h3>
                        <span class="section-name">MJ: Scheduled Job Runs</span>
                        <span class="row-count-badge"
                              *ngIf="sectionRowCounts?.['mJScheduledJobRuns'] !== undefined"
                              [class.zero-rows]="sectionRowCounts['mJScheduledJobRuns'] === 0">
                            {{sectionRowCounts['mJScheduledJobRuns']}}
                        </span>
                    </h3>
                </div>
                <div class="collapse-icon">
                    <i [class]="sectionsExpanded.mJScheduledJobRuns ? 'fa fa-chevron-up' : 'fa fa-chevron-down'"></i>
                </div>
            </div>
            <div class="collapsible-body" [class.collapsed]="!sectionsExpanded.mJScheduledJobRuns" *ngIf="record.IsSaved">
                <div class="form-body">
                    <mj-user-view-grid
                        [Params]="BuildRelationshipViewParamsByEntityName('MJ: Scheduled Job Runs','ScheduledJobID')"
                        [NewRecordValues]="NewRecordValues('MJ: Scheduled Job Runs')"
                        [AllowLoad]="IsCurrentSection('mJScheduledJobRuns')"
                        [EditMode]="GridEditMode()"
                        (dataLoaded)="sectionRowCounts['mJScheduledJobRuns'] = $event.totalRowCount"
                        >
                    </mj-user-view-grid>
                </div>
            </div>
        </div>
        </div>
        </div>
    </form>
</div>
        