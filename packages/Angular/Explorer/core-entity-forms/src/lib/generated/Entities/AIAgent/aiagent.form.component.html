<div class="record-form-container">
    <form *ngIf="record" class="record-form" #form="ngForm">
        <mj-form-toolbar [form]="this"></mj-form-toolbar>

        <div class="form-section-controls">
            <div class="control-group">
                <button (click)="expandAllSections()" title="Expand all sections">
                    <i class="fa fa-expand-alt"></i>Expand All
                </button>
                <button (click)="collapseAllSections()" title="Collapse all sections">
                    <i class="fa fa-compress-alt"></i>Collapse All
                </button>
            </div>
            <input type="text"
                   class="section-search"
                   placeholder="Search sections..."
                   (input)="filterSections($event)"
                   #sectionSearch>
            <span class="section-count">
                <span class="section-count-badge">{{getExpandedCount()}}</span> of 21 expanded
            </span>
        </div>
        <div class="form-panels-container">
<!-- Details Section -->
        <div class="form-card collapsible-card" data-section-name="details" data-field-names="name description logourl logo url __mj_createdat created at __mj_updatedat updated at parentid parent id exposeasaction expose as action executionorder execution order executionmode execution mode enablecontextcompression enable context compression contextcompressionmessagethreshold context compression message threshold contextcompressionpromptid context compression prompt id contextcompressionmessageretentioncount context compression message retention count typeid type id status driverclass driver class iconclass icon class modelselectionmode model selection mode payloaddownstreampaths payload downstream paths payloadupstreampaths payload upstream paths payloadselfreadpaths payload self read paths payloadselfwritepaths payload self write paths payloadscope payload scope finalpayloadvalidation final payload validation finalpayloadvalidationmode final payload validation mode finalpayloadvalidationmaxretries final payload validation max retries maxcostperrun max cost per run maxtokensperrun max tokens per run maxiterationsperrun max iterations per run maxtimeperrun max time per run minexecutionsperrun min executions per run maxexecutionsperrun max executions per run startingpayloadvalidation starting payload validation startingpayloadvalidationmode starting payload validation mode defaultprompteffortlevel default prompt effort level chathandlingoption chat handling option defaultartifacttypeid default artifact type id owneruserid owner user id invocationmode invocation mode artifactcreationmode artifact creation mode functionalrequirements functional requirements technicaldesign technical design injectnotes inject notes maxnotestoinject max notes to inject noteinjectionstrategy note injection strategy injectexamples inject examples maxexamplestoinject max examples to inject exampleinjectionstrategy example injection strategy isrestricted is restricted messagemode message mode maxmessages max messages parent contextcompressionprompt context compression prompt type defaultartifacttype default artifact type owneruser owner user rootparentid root parent id">
            <div class="collapsible-header" (click)="toggleSection('details')" role="button" tabindex="0">
                <div class="collapsible-title">
                    <i class="fa fa-align-left"></i>
                    <h3><span class="section-name">Details</span></h3>
                </div>
                <div class="collapse-icon">
                    <i [class]="sectionsExpanded.details ? 'fa fa-chevron-up' : 'fa fa-chevron-down'"></i>
                </div>
            </div>
            <div class="collapsible-body" [class.collapsed]="!sectionsExpanded.details">
                <div class="form-body">
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="Name"
            Type="textarea"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="Description"
            Type="textarea"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="LogoURL"
            Type="textarea"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="__mj_CreatedAt"
            Type="textbox"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="__mj_UpdatedAt"
            Type="textbox"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="ParentID"
            Type="textbox"
            [EditMode]="EditMode"
            LinkType="Record"
            LinkComponentType="Search"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="ExposeAsAction"
            Type="checkbox"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="ExecutionOrder"
            Type="numerictextbox"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="ExecutionMode"
            Type="dropdownlist"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="EnableContextCompression"
            Type="checkbox"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="ContextCompressionMessageThreshold"
            Type="numerictextbox"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="ContextCompressionPromptID"
            Type="textbox"
            [EditMode]="EditMode"
            LinkType="Record"
            LinkComponentType="Search"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="ContextCompressionMessageRetentionCount"
            Type="numerictextbox"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="TypeID"
            Type="textbox"
            [EditMode]="EditMode"
            LinkType="Record"
            LinkComponentType="Search"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="Status"
            Type="dropdownlist"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="DriverClass"
            Type="textarea"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="IconClass"
            Type="textbox"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="ModelSelectionMode"
            Type="dropdownlist"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="PayloadDownstreamPaths"
            Type="textarea"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="PayloadUpstreamPaths"
            Type="textarea"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="PayloadSelfReadPaths"
            Type="textarea"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="PayloadSelfWritePaths"
            Type="textarea"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="PayloadScope"
            Type="textarea"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="FinalPayloadValidation"
            Type="textarea"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="FinalPayloadValidationMode"
            Type="dropdownlist"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="FinalPayloadValidationMaxRetries"
            Type="numerictextbox"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="MaxCostPerRun"
            Type="numerictextbox"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="MaxTokensPerRun"
            Type="numerictextbox"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="MaxIterationsPerRun"
            Type="numerictextbox"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="MaxTimePerRun"
            Type="numerictextbox"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="MinExecutionsPerRun"
            Type="numerictextbox"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="MaxExecutionsPerRun"
            Type="numerictextbox"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="StartingPayloadValidation"
            Type="textarea"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="StartingPayloadValidationMode"
            Type="dropdownlist"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="DefaultPromptEffortLevel"
            Type="numerictextbox"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="ChatHandlingOption"
            Type="dropdownlist"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="DefaultArtifactTypeID"
            Type="textbox"
            [EditMode]="EditMode"
            LinkType="Record"
            LinkComponentType="Search"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="OwnerUserID"
            Type="textbox"
            [EditMode]="EditMode"
            LinkType="Record"
            LinkComponentType="Search"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="InvocationMode"
            Type="dropdownlist"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="ArtifactCreationMode"
            Type="dropdownlist"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="FunctionalRequirements"
            Type="textarea"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="TechnicalDesign"
            Type="textarea"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="InjectNotes"
            Type="checkbox"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="MaxNotesToInject"
            Type="numerictextbox"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="NoteInjectionStrategy"
            Type="dropdownlist"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="InjectExamples"
            Type="checkbox"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="MaxExamplesToInject"
            Type="numerictextbox"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="ExampleInjectionStrategy"
            Type="dropdownlist"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="IsRestricted"
            Type="checkbox"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="MessageMode"
            Type="dropdownlist"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="MaxMessages"
            Type="numerictextbox"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="Parent"
            Type="textbox"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="ContextCompressionPrompt"
            Type="textbox"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="Type"
            Type="textbox"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="DefaultArtifactType"
            Type="textbox"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="OwnerUser"
            Type="textbox"
            [EditMode]="EditMode"
        ></mj-form-field>
        <mj-form-field 
            [record]="record"
            [ShowLabel]="true"
            FieldName="RootParentID"
            Type="textbox"
            [EditMode]="EditMode"
        ></mj-form-field>

                </div>
            </div>
        </div>
        <div class="related-entity-grid">

        <!-- AIAgent Actions Section -->
        <div class="form-card collapsible-card related-entity" data-section-name="aiagent actions" data-field-names="ai agent actions" data-section-key="aIAgentActions">
            <div class="collapsible-header" (click)="toggleSection('aIAgentActions')" role="button" tabindex="0">
                <div class="collapsible-title">
                    <i class="fa fa-table"></i>
                    <h3>
                        <span class="section-name">AIAgent Actions</span>
                        <span class="row-count-badge" *ngIf="sectionRowCounts?.['aIAgentActions']">{{sectionRowCounts['aIAgentActions']}}</span>
                    </h3>
                </div>
                <div class="collapse-icon">
                    <i [class]="sectionsExpanded.aIAgentActions ? 'fa fa-chevron-up' : 'fa fa-chevron-down'"></i>
                </div>
            </div>
            <div class="collapsible-body" [class.collapsed]="!sectionsExpanded.aIAgentActions" *ngIf="record.IsSaved">
                <div class="form-body">
                    <mj-user-view-grid
                        [Params]="BuildRelationshipViewParamsByEntityName('AI Agent Actions','AgentID')"
                        [NewRecordValues]="NewRecordValues('AI Agent Actions')"
                        [AllowLoad]="IsCurrentSection('aIAgentActions')"
                        [EditMode]="GridEditMode()"
                        (dataLoaded)="sectionRowCounts['aIAgentActions'] = $event.totalRowCount"
                        >
                    </mj-user-view-grid>
                </div>
            </div>
        </div>

        <!-- AIAgent Learning Cycles Section -->
        <div class="form-card collapsible-card related-entity" data-section-name="aiagent learning cycles" data-field-names="ai agent learning cycles" data-section-key="aIAgentLearningCycles">
            <div class="collapsible-header" (click)="toggleSection('aIAgentLearningCycles')" role="button" tabindex="0">
                <div class="collapsible-title">
                    <i class="fa fa-table"></i>
                    <h3>
                        <span class="section-name">AIAgent Learning Cycles</span>
                        <span class="row-count-badge" *ngIf="sectionRowCounts?.['aIAgentLearningCycles']">{{sectionRowCounts['aIAgentLearningCycles']}}</span>
                    </h3>
                </div>
                <div class="collapse-icon">
                    <i [class]="sectionsExpanded.aIAgentLearningCycles ? 'fa fa-chevron-up' : 'fa fa-chevron-down'"></i>
                </div>
            </div>
            <div class="collapsible-body" [class.collapsed]="!sectionsExpanded.aIAgentLearningCycles" *ngIf="record.IsSaved">
                <div class="form-body">
                    <mj-user-view-grid
                        [Params]="BuildRelationshipViewParamsByEntityName('AI Agent Learning Cycles','AgentID')"
                        [NewRecordValues]="NewRecordValues('AI Agent Learning Cycles')"
                        [AllowLoad]="IsCurrentSection('aIAgentLearningCycles')"
                        [EditMode]="GridEditMode()"
                        (dataLoaded)="sectionRowCounts['aIAgentLearningCycles'] = $event.totalRowCount"
                        >
                    </mj-user-view-grid>
                </div>
            </div>
        </div>

        <!-- AIAgent Models Section -->
        <div class="form-card collapsible-card related-entity" data-section-name="aiagent models" data-field-names="ai agent models" data-section-key="aIAgentModels">
            <div class="collapsible-header" (click)="toggleSection('aIAgentModels')" role="button" tabindex="0">
                <div class="collapsible-title">
                    <i class="fa fa-table"></i>
                    <h3>
                        <span class="section-name">AIAgent Models</span>
                        <span class="row-count-badge" *ngIf="sectionRowCounts?.['aIAgentModels']">{{sectionRowCounts['aIAgentModels']}}</span>
                    </h3>
                </div>
                <div class="collapse-icon">
                    <i [class]="sectionsExpanded.aIAgentModels ? 'fa fa-chevron-up' : 'fa fa-chevron-down'"></i>
                </div>
            </div>
            <div class="collapsible-body" [class.collapsed]="!sectionsExpanded.aIAgentModels" *ngIf="record.IsSaved">
                <div class="form-body">
                    <mj-user-view-grid
                        [Params]="BuildRelationshipViewParamsByEntityName('AI Agent Models','AgentID')"
                        [NewRecordValues]="NewRecordValues('AI Agent Models')"
                        [AllowLoad]="IsCurrentSection('aIAgentModels')"
                        [EditMode]="GridEditMode()"
                        (dataLoaded)="sectionRowCounts['aIAgentModels'] = $event.totalRowCount"
                        >
                    </mj-user-view-grid>
                </div>
            </div>
        </div>

        <!-- AI Agent Requests Section -->
        <div class="form-card collapsible-card related-entity" data-section-name="ai agent requests" data-field-names="ai agent requests" data-section-key="aIAgentRequests">
            <div class="collapsible-header" (click)="toggleSection('aIAgentRequests')" role="button" tabindex="0">
                <div class="collapsible-title">
                    <i class="fa fa-table"></i>
                    <h3>
                        <span class="section-name">AI Agent Requests</span>
                        <span class="row-count-badge" *ngIf="sectionRowCounts?.['aIAgentRequests']">{{sectionRowCounts['aIAgentRequests']}}</span>
                    </h3>
                </div>
                <div class="collapse-icon">
                    <i [class]="sectionsExpanded.aIAgentRequests ? 'fa fa-chevron-up' : 'fa fa-chevron-down'"></i>
                </div>
            </div>
            <div class="collapsible-body" [class.collapsed]="!sectionsExpanded.aIAgentRequests" *ngIf="record.IsSaved">
                <div class="form-body">
                    <mj-user-view-grid
                        [Params]="BuildRelationshipViewParamsByEntityName('AI Agent Requests','AgentID')"
                        [NewRecordValues]="NewRecordValues('AI Agent Requests')"
                        [AllowLoad]="IsCurrentSection('aIAgentRequests')"
                        [EditMode]="GridEditMode()"
                        (dataLoaded)="sectionRowCounts['aIAgentRequests'] = $event.totalRowCount"
                        >
                    </mj-user-view-grid>
                </div>
            </div>
        </div>

        <!-- MJ: AI Agent Artifact Types Section -->
        <div class="form-card collapsible-card related-entity" data-section-name="mj: ai agent artifact types" data-field-names="mj: ai agent artifact types" data-section-key="mJAIAgentArtifactTypes">
            <div class="collapsible-header" (click)="toggleSection('mJAIAgentArtifactTypes')" role="button" tabindex="0">
                <div class="collapsible-title">
                    <i class="fa fa-table"></i>
                    <h3>
                        <span class="section-name">MJ: AI Agent Artifact Types</span>
                        <span class="row-count-badge" *ngIf="sectionRowCounts?.['mJAIAgentArtifactTypes']">{{sectionRowCounts['mJAIAgentArtifactTypes']}}</span>
                    </h3>
                </div>
                <div class="collapse-icon">
                    <i [class]="sectionsExpanded.mJAIAgentArtifactTypes ? 'fa fa-chevron-up' : 'fa fa-chevron-down'"></i>
                </div>
            </div>
            <div class="collapsible-body" [class.collapsed]="!sectionsExpanded.mJAIAgentArtifactTypes" *ngIf="record.IsSaved">
                <div class="form-body">
                    <mj-user-view-grid
                        [Params]="BuildRelationshipViewParamsByEntityName('MJ: AI Agent Artifact Types','AgentID')"
                        [NewRecordValues]="NewRecordValues('MJ: AI Agent Artifact Types')"
                        [AllowLoad]="IsCurrentSection('mJAIAgentArtifactTypes')"
                        [EditMode]="GridEditMode()"
                        (dataLoaded)="sectionRowCounts['mJAIAgentArtifactTypes'] = $event.totalRowCount"
                        >
                    </mj-user-view-grid>
                </div>
            </div>
        </div>

        <!-- MJ: AI Agent Data Sources Section -->
        <div class="form-card collapsible-card related-entity" data-section-name="mj: ai agent data sources" data-field-names="mj: ai agent data sources" data-section-key="mJAIAgentDataSources">
            <div class="collapsible-header" (click)="toggleSection('mJAIAgentDataSources')" role="button" tabindex="0">
                <div class="collapsible-title">
                    <i class="fa fa-table"></i>
                    <h3>
                        <span class="section-name">MJ: AI Agent Data Sources</span>
                        <span class="row-count-badge" *ngIf="sectionRowCounts?.['mJAIAgentDataSources']">{{sectionRowCounts['mJAIAgentDataSources']}}</span>
                    </h3>
                </div>
                <div class="collapse-icon">
                    <i [class]="sectionsExpanded.mJAIAgentDataSources ? 'fa fa-chevron-up' : 'fa fa-chevron-down'"></i>
                </div>
            </div>
            <div class="collapsible-body" [class.collapsed]="!sectionsExpanded.mJAIAgentDataSources" *ngIf="record.IsSaved">
                <div class="form-body">
                    <mj-user-view-grid
                        [Params]="BuildRelationshipViewParamsByEntityName('MJ: AI Agent Data Sources','AgentID')"
                        [NewRecordValues]="NewRecordValues('MJ: AI Agent Data Sources')"
                        [AllowLoad]="IsCurrentSection('mJAIAgentDataSources')"
                        [EditMode]="GridEditMode()"
                        (dataLoaded)="sectionRowCounts['mJAIAgentDataSources'] = $event.totalRowCount"
                        >
                    </mj-user-view-grid>
                </div>
            </div>
        </div>

        <!-- MJ: AI Agent Permissions Section -->
        <div class="form-card collapsible-card related-entity" data-section-name="mj: ai agent permissions" data-field-names="mj: ai agent permissions" data-section-key="mJAIAgentPermissions">
            <div class="collapsible-header" (click)="toggleSection('mJAIAgentPermissions')" role="button" tabindex="0">
                <div class="collapsible-title">
                    <i class="fa fa-table"></i>
                    <h3>
                        <span class="section-name">MJ: AI Agent Permissions</span>
                        <span class="row-count-badge" *ngIf="sectionRowCounts?.['mJAIAgentPermissions']">{{sectionRowCounts['mJAIAgentPermissions']}}</span>
                    </h3>
                </div>
                <div class="collapse-icon">
                    <i [class]="sectionsExpanded.mJAIAgentPermissions ? 'fa fa-chevron-up' : 'fa fa-chevron-down'"></i>
                </div>
            </div>
            <div class="collapsible-body" [class.collapsed]="!sectionsExpanded.mJAIAgentPermissions" *ngIf="record.IsSaved">
                <div class="form-body">
                    <mj-user-view-grid
                        [Params]="BuildRelationshipViewParamsByEntityName('MJ: AI Agent Permissions','AgentID')"
                        [NewRecordValues]="NewRecordValues('MJ: AI Agent Permissions')"
                        [AllowLoad]="IsCurrentSection('mJAIAgentPermissions')"
                        [EditMode]="GridEditMode()"
                        (dataLoaded)="sectionRowCounts['mJAIAgentPermissions'] = $event.totalRowCount"
                        >
                    </mj-user-view-grid>
                </div>
            </div>
        </div>

        <!-- MJ: AI Agent Relationships Section -->
        <div class="form-card collapsible-card related-entity" data-section-name="mj: ai agent relationships" data-field-names="mj: ai agent relationships" data-section-key="mJAIAgentRelationships">
            <div class="collapsible-header" (click)="toggleSection('mJAIAgentRelationships')" role="button" tabindex="0">
                <div class="collapsible-title">
                    <i class="fa fa-table"></i>
                    <h3>
                        <span class="section-name">MJ: AI Agent Relationships</span>
                        <span class="row-count-badge" *ngIf="sectionRowCounts?.['mJAIAgentRelationships']">{{sectionRowCounts['mJAIAgentRelationships']}}</span>
                    </h3>
                </div>
                <div class="collapse-icon">
                    <i [class]="sectionsExpanded.mJAIAgentRelationships ? 'fa fa-chevron-up' : 'fa fa-chevron-down'"></i>
                </div>
            </div>
            <div class="collapsible-body" [class.collapsed]="!sectionsExpanded.mJAIAgentRelationships" *ngIf="record.IsSaved">
                <div class="form-body">
                    <mj-user-view-grid
                        [Params]="BuildRelationshipViewParamsByEntityName('MJ: AI Agent Relationships','AgentID')"
                        [NewRecordValues]="NewRecordValues('MJ: AI Agent Relationships')"
                        [AllowLoad]="IsCurrentSection('mJAIAgentRelationships')"
                        [EditMode]="GridEditMode()"
                        (dataLoaded)="sectionRowCounts['mJAIAgentRelationships'] = $event.totalRowCount"
                        >
                    </mj-user-view-grid>
                </div>
            </div>
        </div>

        <!-- MJ: AI Agent Steps Section -->
        <div class="form-card collapsible-card related-entity" data-section-name="mj: ai agent steps" data-field-names="mj: ai agent steps" data-section-key="mJAIAgentSteps">
            <div class="collapsible-header" (click)="toggleSection('mJAIAgentSteps')" role="button" tabindex="0">
                <div class="collapsible-title">
                    <i class="fa fa-table"></i>
                    <h3>
                        <span class="section-name">MJ: AI Agent Steps</span>
                        <span class="row-count-badge" *ngIf="sectionRowCounts?.['mJAIAgentSteps']">{{sectionRowCounts['mJAIAgentSteps']}}</span>
                    </h3>
                </div>
                <div class="collapse-icon">
                    <i [class]="sectionsExpanded.mJAIAgentSteps ? 'fa fa-chevron-up' : 'fa fa-chevron-down'"></i>
                </div>
            </div>
            <div class="collapsible-body" [class.collapsed]="!sectionsExpanded.mJAIAgentSteps" *ngIf="record.IsSaved">
                <div class="form-body">
                    <mj-user-view-grid
                        [Params]="BuildRelationshipViewParamsByEntityName('MJ: AI Agent Steps','AgentID')"
                        [NewRecordValues]="NewRecordValues('MJ: AI Agent Steps')"
                        [AllowLoad]="IsCurrentSection('mJAIAgentSteps')"
                        [EditMode]="GridEditMode()"
                        (dataLoaded)="sectionRowCounts['mJAIAgentSteps'] = $event.totalRowCount"
                        >
                    </mj-user-view-grid>
                </div>
            </div>
        </div>

        <!-- AIAgent Notes Section -->
        <div class="form-card collapsible-card related-entity" data-section-name="aiagent notes" data-field-names="ai agent notes" data-section-key="aIAgentNotes">
            <div class="collapsible-header" (click)="toggleSection('aIAgentNotes')" role="button" tabindex="0">
                <div class="collapsible-title">
                    <i class="fa fa-table"></i>
                    <h3>
                        <span class="section-name">AIAgent Notes</span>
                        <span class="row-count-badge" *ngIf="sectionRowCounts?.['aIAgentNotes']">{{sectionRowCounts['aIAgentNotes']}}</span>
                    </h3>
                </div>
                <div class="collapse-icon">
                    <i [class]="sectionsExpanded.aIAgentNotes ? 'fa fa-chevron-up' : 'fa fa-chevron-down'"></i>
                </div>
            </div>
            <div class="collapsible-body" [class.collapsed]="!sectionsExpanded.aIAgentNotes" *ngIf="record.IsSaved">
                <div class="form-body">
                    <mj-user-view-grid
                        [Params]="BuildRelationshipViewParamsByEntityName('AI Agent Notes','AgentID')"
                        [NewRecordValues]="NewRecordValues('AI Agent Notes')"
                        [AllowLoad]="IsCurrentSection('aIAgentNotes')"
                        [EditMode]="GridEditMode()"
                        (dataLoaded)="sectionRowCounts['aIAgentNotes'] = $event.totalRowCount"
                        >
                    </mj-user-view-grid>
                </div>
            </div>
        </div>

        <!-- MJ: AI Agent Examples Section -->
        <div class="form-card collapsible-card related-entity" data-section-name="mj: ai agent examples" data-field-names="mj: ai agent examples" data-section-key="mJAIAgentExamples">
            <div class="collapsible-header" (click)="toggleSection('mJAIAgentExamples')" role="button" tabindex="0">
                <div class="collapsible-title">
                    <i class="fa fa-table"></i>
                    <h3>
                        <span class="section-name">MJ: AI Agent Examples</span>
                        <span class="row-count-badge" *ngIf="sectionRowCounts?.['mJAIAgentExamples']">{{sectionRowCounts['mJAIAgentExamples']}}</span>
                    </h3>
                </div>
                <div class="collapse-icon">
                    <i [class]="sectionsExpanded.mJAIAgentExamples ? 'fa fa-chevron-up' : 'fa fa-chevron-down'"></i>
                </div>
            </div>
            <div class="collapsible-body" [class.collapsed]="!sectionsExpanded.mJAIAgentExamples" *ngIf="record.IsSaved">
                <div class="form-body">
                    <mj-user-view-grid
                        [Params]="BuildRelationshipViewParamsByEntityName('MJ: AI Agent Examples','AgentID')"
                        [NewRecordValues]="NewRecordValues('MJ: AI Agent Examples')"
                        [AllowLoad]="IsCurrentSection('mJAIAgentExamples')"
                        [EditMode]="GridEditMode()"
                        (dataLoaded)="sectionRowCounts['mJAIAgentExamples'] = $event.totalRowCount"
                        >
                    </mj-user-view-grid>
                </div>
            </div>
        </div>

        <!-- MJ: AI Agent Prompts Section -->
        <div class="form-card collapsible-card related-entity" data-section-name="mj: ai agent prompts" data-field-names="mj: ai agent prompts" data-section-key="mJAIAgentPrompts">
            <div class="collapsible-header" (click)="toggleSection('mJAIAgentPrompts')" role="button" tabindex="0">
                <div class="collapsible-title">
                    <i class="fa fa-table"></i>
                    <h3>
                        <span class="section-name">MJ: AI Agent Prompts</span>
                        <span class="row-count-badge" *ngIf="sectionRowCounts?.['mJAIAgentPrompts']">{{sectionRowCounts['mJAIAgentPrompts']}}</span>
                    </h3>
                </div>
                <div class="collapse-icon">
                    <i [class]="sectionsExpanded.mJAIAgentPrompts ? 'fa fa-chevron-up' : 'fa fa-chevron-down'"></i>
                </div>
            </div>
            <div class="collapsible-body" [class.collapsed]="!sectionsExpanded.mJAIAgentPrompts" *ngIf="record.IsSaved">
                <div class="form-body">
                    <mj-user-view-grid
                        [Params]="BuildRelationshipViewParamsByEntityName('MJ: AI Agent Prompts','AgentID')"
                        [NewRecordValues]="NewRecordValues('MJ: AI Agent Prompts')"
                        [AllowLoad]="IsCurrentSection('mJAIAgentPrompts')"
                        [EditMode]="GridEditMode()"
                        (dataLoaded)="sectionRowCounts['mJAIAgentPrompts'] = $event.totalRowCount"
                        >
                    </mj-user-view-grid>
                </div>
            </div>
        </div>

        <!-- MJ: AI Agent Relationships Section -->
        <div class="form-card collapsible-card related-entity" data-section-name="mj: ai agent relationships" data-field-names="mj: ai agent relationships" data-section-key="mJAIAgentRelationships">
            <div class="collapsible-header" (click)="toggleSection('mJAIAgentRelationships')" role="button" tabindex="0">
                <div class="collapsible-title">
                    <i class="fa fa-table"></i>
                    <h3>
                        <span class="section-name">MJ: AI Agent Relationships</span>
                        <span class="row-count-badge" *ngIf="sectionRowCounts?.['mJAIAgentRelationships']">{{sectionRowCounts['mJAIAgentRelationships']}}</span>
                    </h3>
                </div>
                <div class="collapse-icon">
                    <i [class]="sectionsExpanded.mJAIAgentRelationships ? 'fa fa-chevron-up' : 'fa fa-chevron-down'"></i>
                </div>
            </div>
            <div class="collapsible-body" [class.collapsed]="!sectionsExpanded.mJAIAgentRelationships" *ngIf="record.IsSaved">
                <div class="form-body">
                    <mj-user-view-grid
                        [Params]="BuildRelationshipViewParamsByEntityName('MJ: AI Agent Relationships','SubAgentID')"
                        [NewRecordValues]="NewRecordValues('MJ: AI Agent Relationships')"
                        [AllowLoad]="IsCurrentSection('mJAIAgentRelationships')"
                        [EditMode]="GridEditMode()"
                        (dataLoaded)="sectionRowCounts['mJAIAgentRelationships'] = $event.totalRowCount"
                        >
                    </mj-user-view-grid>
                </div>
            </div>
        </div>

        <!-- MJ: AI Agent Runs Section -->
        <div class="form-card collapsible-card related-entity" data-section-name="mj: ai agent runs" data-field-names="mj: ai agent runs" data-section-key="mJAIAgentRuns">
            <div class="collapsible-header" (click)="toggleSection('mJAIAgentRuns')" role="button" tabindex="0">
                <div class="collapsible-title">
                    <i class="fa fa-table"></i>
                    <h3>
                        <span class="section-name">MJ: AI Agent Runs</span>
                        <span class="row-count-badge" *ngIf="sectionRowCounts?.['mJAIAgentRuns']">{{sectionRowCounts['mJAIAgentRuns']}}</span>
                    </h3>
                </div>
                <div class="collapse-icon">
                    <i [class]="sectionsExpanded.mJAIAgentRuns ? 'fa fa-chevron-up' : 'fa fa-chevron-down'"></i>
                </div>
            </div>
            <div class="collapsible-body" [class.collapsed]="!sectionsExpanded.mJAIAgentRuns" *ngIf="record.IsSaved">
                <div class="form-body">
                    <mj-user-view-grid
                        [Params]="BuildRelationshipViewParamsByEntityName('MJ: AI Agent Runs','AgentID')"
                        [NewRecordValues]="NewRecordValues('MJ: AI Agent Runs')"
                        [AllowLoad]="IsCurrentSection('mJAIAgentRuns')"
                        [EditMode]="GridEditMode()"
                        (dataLoaded)="sectionRowCounts['mJAIAgentRuns'] = $event.totalRowCount"
                        >
                    </mj-user-view-grid>
                </div>
            </div>
        </div>

        <!-- MJ: AI Agent Steps Section -->
        <div class="form-card collapsible-card related-entity" data-section-name="mj: ai agent steps" data-field-names="mj: ai agent steps" data-section-key="mJAIAgentSteps">
            <div class="collapsible-header" (click)="toggleSection('mJAIAgentSteps')" role="button" tabindex="0">
                <div class="collapsible-title">
                    <i class="fa fa-table"></i>
                    <h3>
                        <span class="section-name">MJ: AI Agent Steps</span>
                        <span class="row-count-badge" *ngIf="sectionRowCounts?.['mJAIAgentSteps']">{{sectionRowCounts['mJAIAgentSteps']}}</span>
                    </h3>
                </div>
                <div class="collapse-icon">
                    <i [class]="sectionsExpanded.mJAIAgentSteps ? 'fa fa-chevron-up' : 'fa fa-chevron-down'"></i>
                </div>
            </div>
            <div class="collapsible-body" [class.collapsed]="!sectionsExpanded.mJAIAgentSteps" *ngIf="record.IsSaved">
                <div class="form-body">
                    <mj-user-view-grid
                        [Params]="BuildRelationshipViewParamsByEntityName('MJ: AI Agent Steps','SubAgentID')"
                        [NewRecordValues]="NewRecordValues('MJ: AI Agent Steps')"
                        [AllowLoad]="IsCurrentSection('mJAIAgentSteps')"
                        [EditMode]="GridEditMode()"
                        (dataLoaded)="sectionRowCounts['mJAIAgentSteps'] = $event.totalRowCount"
                        >
                    </mj-user-view-grid>
                </div>
            </div>
        </div>

        <!-- MJ: Tasks Section -->
        <div class="form-card collapsible-card related-entity" data-section-name="mj: tasks" data-field-names="mj: tasks" data-section-key="mJTasks">
            <div class="collapsible-header" (click)="toggleSection('mJTasks')" role="button" tabindex="0">
                <div class="collapsible-title">
                    <i class="fa fa-table"></i>
                    <h3>
                        <span class="section-name">MJ: Tasks</span>
                        <span class="row-count-badge" *ngIf="sectionRowCounts?.['mJTasks']">{{sectionRowCounts['mJTasks']}}</span>
                    </h3>
                </div>
                <div class="collapse-icon">
                    <i [class]="sectionsExpanded.mJTasks ? 'fa fa-chevron-up' : 'fa fa-chevron-down'"></i>
                </div>
            </div>
            <div class="collapsible-body" [class.collapsed]="!sectionsExpanded.mJTasks" *ngIf="record.IsSaved">
                <div class="form-body">
                    <mj-user-view-grid
                        [Params]="BuildRelationshipViewParamsByEntityName('MJ: Tasks','AgentID')"
                        [NewRecordValues]="NewRecordValues('MJ: Tasks')"
                        [AllowLoad]="IsCurrentSection('mJTasks')"
                        [EditMode]="GridEditMode()"
                        (dataLoaded)="sectionRowCounts['mJTasks'] = $event.totalRowCount"
                        >
                    </mj-user-view-grid>
                </div>
            </div>
        </div>

        <!-- AI Result Cache Section -->
        <div class="form-card collapsible-card related-entity" data-section-name="ai result cache" data-field-names="ai result cache" data-section-key="aIResultCache">
            <div class="collapsible-header" (click)="toggleSection('aIResultCache')" role="button" tabindex="0">
                <div class="collapsible-title">
                    <i class="fa fa-table"></i>
                    <h3>
                        <span class="section-name">AI Result Cache</span>
                        <span class="row-count-badge" *ngIf="sectionRowCounts?.['aIResultCache']">{{sectionRowCounts['aIResultCache']}}</span>
                    </h3>
                </div>
                <div class="collapse-icon">
                    <i [class]="sectionsExpanded.aIResultCache ? 'fa fa-chevron-up' : 'fa fa-chevron-down'"></i>
                </div>
            </div>
            <div class="collapsible-body" [class.collapsed]="!sectionsExpanded.aIResultCache" *ngIf="record.IsSaved">
                <div class="form-body">
                    <mj-user-view-grid
                        [Params]="BuildRelationshipViewParamsByEntityName('AI Result Cache','AgentID')"
                        [NewRecordValues]="NewRecordValues('AI Result Cache')"
                        [AllowLoad]="IsCurrentSection('aIResultCache')"
                        [EditMode]="GridEditMode()"
                        (dataLoaded)="sectionRowCounts['aIResultCache'] = $event.totalRowCount"
                        >
                    </mj-user-view-grid>
                </div>
            </div>
        </div>

        <!-- MJ: AI Prompt Runs Section -->
        <div class="form-card collapsible-card related-entity" data-section-name="mj: ai prompt runs" data-field-names="mj: ai prompt runs" data-section-key="mJAIPromptRuns">
            <div class="collapsible-header" (click)="toggleSection('mJAIPromptRuns')" role="button" tabindex="0">
                <div class="collapsible-title">
                    <i class="fa fa-table"></i>
                    <h3>
                        <span class="section-name">MJ: AI Prompt Runs</span>
                        <span class="row-count-badge" *ngIf="sectionRowCounts?.['mJAIPromptRuns']">{{sectionRowCounts['mJAIPromptRuns']}}</span>
                    </h3>
                </div>
                <div class="collapse-icon">
                    <i [class]="sectionsExpanded.mJAIPromptRuns ? 'fa fa-chevron-up' : 'fa fa-chevron-down'"></i>
                </div>
            </div>
            <div class="collapsible-body" [class.collapsed]="!sectionsExpanded.mJAIPromptRuns" *ngIf="record.IsSaved">
                <div class="form-body">
                    <mj-user-view-grid
                        [Params]="BuildRelationshipViewParamsByEntityName('MJ: AI Prompt Runs','AgentID')"
                        [NewRecordValues]="NewRecordValues('MJ: AI Prompt Runs')"
                        [AllowLoad]="IsCurrentSection('mJAIPromptRuns')"
                        [EditMode]="GridEditMode()"
                        (dataLoaded)="sectionRowCounts['mJAIPromptRuns'] = $event.totalRowCount"
                        >
                    </mj-user-view-grid>
                </div>
            </div>
        </div>

        <!-- Conversation Details Section -->
        <div class="form-card collapsible-card related-entity" data-section-name="conversation details" data-field-names="conversation details" data-section-key="conversationDetails">
            <div class="collapsible-header" (click)="toggleSection('conversationDetails')" role="button" tabindex="0">
                <div class="collapsible-title">
                    <i class="fa fa-table"></i>
                    <h3>
                        <span class="section-name">Conversation Details</span>
                        <span class="row-count-badge" *ngIf="sectionRowCounts?.['conversationDetails']">{{sectionRowCounts['conversationDetails']}}</span>
                    </h3>
                </div>
                <div class="collapse-icon">
                    <i [class]="sectionsExpanded.conversationDetails ? 'fa fa-chevron-up' : 'fa fa-chevron-down'"></i>
                </div>
            </div>
            <div class="collapsible-body" [class.collapsed]="!sectionsExpanded.conversationDetails" *ngIf="record.IsSaved">
                <div class="form-body">
                    <mj-user-view-grid
                        [Params]="BuildRelationshipViewParamsByEntityName('Conversation Details','AgentID')"
                        [NewRecordValues]="NewRecordValues('Conversation Details')"
                        [AllowLoad]="IsCurrentSection('conversationDetails')"
                        [EditMode]="GridEditMode()"
                        (dataLoaded)="sectionRowCounts['conversationDetails'] = $event.totalRowCount"
                        >
                    </mj-user-view-grid>
                </div>
            </div>
        </div>

        <!-- AI Agents Section -->
        <div class="form-card collapsible-card related-entity" data-section-name="ai agents" data-field-names="ai agents" data-section-key="aIAgents">
            <div class="collapsible-header" (click)="toggleSection('aIAgents')" role="button" tabindex="0">
                <div class="collapsible-title">
                    <i class="fa fa-table"></i>
                    <h3>
                        <span class="section-name">AI Agents</span>
                        <span class="row-count-badge" *ngIf="sectionRowCounts?.['aIAgents']">{{sectionRowCounts['aIAgents']}}</span>
                    </h3>
                </div>
                <div class="collapse-icon">
                    <i [class]="sectionsExpanded.aIAgents ? 'fa fa-chevron-up' : 'fa fa-chevron-down'"></i>
                </div>
            </div>
            <div class="collapsible-body" [class.collapsed]="!sectionsExpanded.aIAgents" *ngIf="record.IsSaved">
                <div class="form-body">
                    <mj-user-view-grid
                        [Params]="BuildRelationshipViewParamsByEntityName('AI Agents','ParentID')"
                        [NewRecordValues]="NewRecordValues('AI Agents')"
                        [AllowLoad]="IsCurrentSection('aIAgents')"
                        [EditMode]="GridEditMode()"
                        (dataLoaded)="sectionRowCounts['aIAgents'] = $event.totalRowCount"
                        >
                    </mj-user-view-grid>
                </div>
            </div>
        </div>
        </div>
        </div>
    </form>
</div>
        