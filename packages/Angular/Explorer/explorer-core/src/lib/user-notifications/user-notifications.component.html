<div class="notifications-container">
  <!-- Header Section -->
  <div class="notifications-header">
    <div class="header-top">
      <div class="header-title">
        <div class="title-icon">
          <i class="fa-solid fa-bell"></i>
        </div>
        <h1>Notifications</h1>
      </div>

      <div class="header-actions" *ngIf="AllNotifications.length > 0">
        <button *ngIf="UnreadNotifications.length > 0"
                kendoButton
                class="action-btn action-btn-primary"
                (click)="markAllAsRead()">
          <i class="fa-solid fa-check-double"></i>
          <span class="btn-text">Mark All Read</span>
        </button>
        <button *ngIf="ReadNotifications.length > 0"
                kendoButton
                class="action-btn"
                (click)="markAllAsUnread()">
          <i class="fa-solid fa-envelope"></i>
          <span class="btn-text">Mark All Unread</span>
        </button>
      </div>
    </div>

    <!-- Stats Pills (replaces radio buttons - same functionality) -->
    <div class="header-stats" *ngIf="AllNotifications.length > 0">
      <input #allRadio type="radio" name="UnreadStatus" value="All"
             (change)="onReadRadioChanged($event)" checked class="hidden-radio" />
      <button class="stat-pill"
              [class.active]="radioSelected === 'All'"
              (click)="selectReadOption('All')">
        <span class="stat-label">All</span>
        <span class="stat-count">{{AllNotifications.length}}</span>
      </button>

      <input #unreadRadio type="radio" name="UnreadStatus" value="Unread"
             (change)="onReadRadioChanged($event)" class="hidden-radio" />
      <button class="stat-pill"
              *ngIf="UnreadNotifications.length > 0 || ReadNotifications.length === 0"
              [class.active]="radioSelected === 'Unread'"
              [class.has-unread]="UnreadNotifications.length > 0"
              (click)="selectReadOption('Unread')">
        <span class="stat-label">Unread</span>
        <span class="stat-count" [class.unread-count]="UnreadNotifications.length > 0">
          {{UnreadNotifications.length}}
        </span>
      </button>

      <input #readRadio type="radio" name="UnreadStatus" value="Read"
             (change)="onReadRadioChanged($event)" class="hidden-radio" />
      <button class="stat-pill"
              *ngIf="ReadNotifications.length > 0 || UnreadNotifications.length === 0"
              [class.active]="radioSelected === 'Read'"
              (click)="selectReadOption('Read')">
        <span class="stat-label">Read</span>
        <span class="stat-count">{{ReadNotifications.length}}</span>
      </button>
    </div>

    <!-- Filter Toolbar -->
    <div class="header-toolbar" *ngIf="AllNotifications.length > 0">
      <div class="toolbar-filters">
        <!-- Type Filter Dropdown -->
        <div class="filter-item type-filter" *ngIf="notificationTypes.length > 0">
          <kendo-dropdownlist
            [data]="notificationTypes"
            textField="Name"
            valueField="ID"
            [valuePrimitive]="true"
            [(ngModel)]="selectedTypeFilter"
            (valueChange)="onTypeFilterChange($event)"
            [defaultItem]="{ ID: null, Name: 'All Types' }"
            class="type-dropdown">
          </kendo-dropdownlist>
        </div>

        <!-- Search Filter -->
        <div class="filter-item search-filter">
          <kendo-textbox
            placeholder="Search notifications..."
            (valueChange)="onFilterChanged($event)"
            class="search-input">
            <ng-template kendoTextBoxSuffixTemplate>
              <i class="fa-solid fa-magnifying-glass search-icon"></i>
            </ng-template>
          </kendo-textbox>
        </div>
      </div>

      <div class="toolbar-info" *ngIf="NotificationsToShow.length !== AllNotifications.length">
        <span class="filter-badge">
          <i class="fa-solid fa-filter"></i>
          Showing {{NotificationsToShow.length}} of {{AllNotifications.length}}
        </span>
      </div>
    </div>
  </div>

  <!-- Notifications Content -->
  <div class="notifications-content">
    @if(NotificationsToShow.length === 0 && AllNotifications.length === 0) {
      <div class="empty-state">
        <div class="empty-icon">
          <i class="fa-solid fa-bell-slash"></i>
        </div>
        <h3>No Notifications</h3>
        <p>You're all caught up! New notifications will appear here.</p>
      </div>
    }
    @else if(NotificationsToShow.length === 0) {
      <div class="empty-state">
        <div class="empty-icon">
          <i class="fa-solid fa-filter-circle-xmark"></i>
        </div>
        <h3>No Matching Notifications</h3>
        <p>Try adjusting your filters to see more notifications.</p>
      </div>
    }
    @else {
      <!-- Notifications List -->
      <kendo-listview [data]="NotificationsToShow" class="notifications-list">
        <ng-template kendoListViewItemTemplate let-dataItem="dataItem">
          <div class="notification-card"
               [class.unread]="dataItem.Unread"
               [class.clickable]="isNotificationClickable(dataItem)">

            <!-- Unread Indicator Bar -->
            <div class="card-indicator"></div>

            <!-- Type Icon -->
            <div class="card-icon"
                 [style.background-color]="getTypeColor(dataItem) + '15'">
              <i [class]="'fa-solid ' + getTypeIcon(dataItem)"
                 [style.color]="getTypeColor(dataItem)"></i>
            </div>

            <!-- Content -->
            <div class="card-content" (click)="notificationClicked(dataItem)">
              <div class="card-header">
                <h3 class="card-title" [class.card-title-unread]="dataItem.Unread">
                  {{dataItem.Title}}
                </h3>
                <span class="card-time">
                  <i class="fa-regular fa-clock"></i>
                  {{dataItem.__mj_CreatedAt | date:'MMM d, h:mm a'}}
                </span>
              </div>

              <div class="card-meta">
                <span class="card-type"
                      [style.background-color]="getTypeColor(dataItem) + '15'"
                      [style.color]="getTypeColor(dataItem)">
                  {{getTypeName(dataItem)}}
                </span>
              </div>

              <p class="card-message">{{dataItem.Message}}</p>
            </div>

            <!-- Actions -->
            <div class="card-actions">
              <button kendoButton
                      class="card-action-btn"
                      *ngIf="dataItem.Unread"
                      (click)="markAsRead(dataItem, true, null)"
                      title="Mark as Read">
                <i class="fa-solid fa-check"></i>
                <span class="action-text">Read</span>
              </button>
              <button kendoButton
                      class="card-action-btn"
                      *ngIf="!dataItem.Unread"
                      (click)="markAsRead(dataItem, false, null)"
                      title="Mark as Unread">
                <i class="fa-solid fa-envelope"></i>
                <span class="action-text">Unread</span>
              </button>
            </div>
          </div>
        </ng-template>
      </kendo-listview>
    }
  </div>
</div>
