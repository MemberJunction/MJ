<div class="mj-page-container">
  <!-- Header Section -->
  <div class="mj-header">
    <div class="mj-header-title">
      <div class="title-flex-display">
        @if(CurrentCategoryID) {
          <button class="title-folder" title="Back to Parent" (click)="goToParent()">
            <i class="fa-solid fa-arrow-left"></i>
          </button>
          <i class="fa-regular fa-folder fa-xl" style="color: var(--mj-blue);"></i>
        }
        <h1>{{Title}}</h1>
      </div>
    </div>
    <div class="mj-header-actions">
      @if(ItemOptions.length > 0) {
        <kendo-dropdownbutton 
          class="custom-dropdwn" 
          (itemClick)="onDropdownItemClick($event)" 
          [data]="ItemOptions" 
          textField="Text"
          themeColor="primary">
          <i class="fa-solid fa-plus"></i>
          Create New
        </kendo-dropdownbutton> 
      }
    </div>
  </div>

  <!-- Search and Filter Toolbar -->
  <div class="mj-toolbar">
    <div class="mj-search">
      <kendo-textbox 
        type="text" 
        #searchInput 
        placeholder="Search {{Title}}" 
        (keyup)="onKeyup(searchInput.value)"
        [clearButton]="true"
        size="large"
        rounded="large"
        fillMode="solid"
        class="mj-search-input">
        <ng-template kendoTextBoxPrefixTemplate>
          <i class="fa-solid fa-magnifying-glass mj-search-icon"></i>
        </ng-template>
      </kendo-textbox>
    </div>
    
    <div class="mj-toolbar-actions">
      <div class="filter-wrapper">
        <button kendoButton 
                (click)="changeViewMode('List')" 
                [class.active]="DisplayMode === 'List'"
                class="btn-cmn" 
                title="List View">
          <i class="fa-solid fa-bars"></i>
        </button>
        <button kendoButton 
                (click)="changeViewMode('Tile')" 
                [class.active]="DisplayMode === 'Tile'"
                class="btn-cmn" 
                title="Grid View">
          <i class="fa-solid fa-table-cells-large"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Main Content Area -->
  <div class="main-area">
    @if (IsLoading) {
      <div class="mj-loading">
        <kendo-loader type="converging-spinner"></kendo-loader>
      </div>
    }
    @else {
      @if(DisplayMode === 'List') {
        <!-- List View -->
        <kendo-grid 
          (cellClick)="onCellItemClicked($event)" 
          [kendoGridBinding]="Items"
          class="kendo-grid">
          <kendo-grid-column field="Name" title="Name"></kendo-grid-column>
          <kendo-grid-column field="Description" title="Description"></kendo-grid-column>
          <kendo-grid-column field="Type" title="Type"></kendo-grid-column>
          <kendo-grid-column title="Actions" [width]="120">
            <ng-template kendoGridCellTemplate let-dataItem>
              <div class="grid-wrapper">
                @if(EnableItemEdit && (!dataItem.IsLink || dataItem.LinkPermissionLevel === 'Owner' || dataItem.LinkPermissionLevel === 'Edit')) {
                  <button class="list-btn" (click)="editItem(dataItem)" title="Edit Item">
                    <i class="fa-regular fa-pen-to-square"></i>
                  </button>
                }
                @if(EnableItemDelete && (!dataItem.IsLink || dataItem.LinkPermissionLevel === 'Owner')) {
                  <button class="list-btn" (click)="deleteItem(dataItem)" title="Delete Item">
                    <i class="fa-regular fa-trash-can"></i>
                  </button>  
                }
                @if(EnableRemoveLink && dataItem.IsLink) {
                  <button class="list-btn" (click)="unlinkItem(dataItem)" title="Remove Link">
                    <i class="fa-solid fa-link-slash"></i>
                  </button>                    
                }
              </div>
            </ng-template>
          </kendo-grid-column>
        </kendo-grid>
      }
      @else {
        <!-- Tile View -->
        @if(Items.length === 0) {
          <div class="mj-empty-state">
            <div class="mj-empty-icon">
              <i class="fa-solid fa-folder-open"></i>
            </div>
            <h3>No {{Title}} Found</h3>
            <p>There are no items to display in this category.</p>
            @if(ItemOptions.length > 0) {
              <kendo-dropdownbutton 
                (itemClick)="onDropdownItemClick($event)" 
                [data]="ItemOptions" 
                textField="Text"
                themeColor="primary">
                <i class="fa-solid fa-plus"></i>
                Create New
              </kendo-dropdownbutton>
            }
          </div>
        }
        @else {
          <div class="nav-container">
            @for(item of Items; track item) {
              <div class="nav-item">
                <div class="mj-card-body">
                  <div class="nav-item-icon">
                    @if(item.IsLink) {
                      <i [title]="item.Name + ' (Shared)'" [ngClass]="getIconForResourceType(item)"></i>
                    }
                    @else {
                      <i [title]="item.Name" [ngClass]="getIconForResourceType(item)"></i>
                    }
                  </div>
                  <div class="nav-item-content">
                    <h3 class="nav-item-title" (click)="itemClick(item)">{{item.Name}}</h3>
                    @if(item.Description) {
                      <p class="nav-item-subtitle">{{item.Description}}</p>
                    }
                    <div class="nav-item-edit">
                      @if(EnableItemEdit && (!item.IsLink || item.LinkPermissionLevel === 'Owner' || item.LinkPermissionLevel === 'Edit')) {
                        <button class="list-btn" (click)="editItem(item)" title="Edit Item">
                          <i class="fa-regular fa-pen-to-square"></i>
                        </button>
                      }
                      @if(EnableItemDelete && (!item.IsLink || item.LinkPermissionLevel === 'Owner')) {
                        <button class="list-btn" (click)="deleteItem(item)" title="Delete Item">
                          <i class="fa-regular fa-trash-can"></i>
                        </button>                    
                      }
                      @else if (EnableRemoveLink && item.IsLink) {
                        <button class="list-btn" (click)="unlinkItem(item)" title="Remove Link">
                          <i class="fa-solid fa-link-slash"></i>
                        </button>                    
                      }
                    </div>
                  </div>
                </div>
              </div>
            }
          </div>
        }
      }
    }
  </div>

  <!-- Delete Confirmation Dialog -->
  <kendo-dialog 
    class="dialog-wrapper mj-dialog" 
    title="Confirm Action" 
    *ngIf="deleteDialogOpened" 
    (close)="onConfirmDeleteItem(false)"
    [minWidth]="400"
    [width]="500">
    <div class="mj-dialog-content">
      <p>
        Are you sure you want to {{(selectedItem?.IsLink && selectedItem?.LinkPermissionLevel === 'Owner') || !selectedItem?.IsLink ? 'delete' : 'unlink'}} 
        <strong>{{selectedItem?.Name}}</strong>?
      </p>
    </div>
    <kendo-dialog-actions class="popup-actions-btn">
      <button class="cancel-btn" (click)="onConfirmDeleteItem(true)" kendoButton>
        <i class="fa-solid fa-check"></i>
        Yes
      </button>
      <button class="yes-btn" (click)="onConfirmDeleteItem(false)" kendoButton>
        <i class="fa-solid fa-times"></i>
        No 
      </button>
    </kendo-dialog-actions>
  </kendo-dialog>

  <!-- Folder Creation/Edit Dialog -->
  <kendo-dialog 
    [title]="selectedFolder ? 'Edit Folder' : 'Create New Folder'" 
    *ngIf="upsertFolderDialogVisible" 
    (close)="toggleUpsertFolderView(false, false)"
    class="dialog-wrapper mj-dialog"
    [minWidth]="400"
    [width]="500">
    <div class="mj-dialog-content">
      <div class="mj-form-field">
        <kendo-label text="Name">
          <kendo-textbox 
            [value]="upsertNewFolderName" 
            placeholder="Enter folder name" 
            (valueChange)="onUpsertFolderNameKeyup($event)"/>
        </kendo-label>
      </div>
      <div class="mj-form-field">
        <kendo-label text="Description">
          <kendo-textbox 
            [value]="upsertNewFolderDescription" 
            placeholder="Enter description" 
            (valueChange)="onUpsertFolderDescriptionKeyup($event)"/>
        </kendo-label>
      </div>
    </div>
    <kendo-dialog-actions class="popup-actions-btn">
      @if(selectedFolder) {
        <button class="cancel-btn" (click)="updateFolder()" kendoButton>
          <i class="fa-solid fa-check"></i>
          Update
        </button>
      }
      @else {
        <button class="cancel-btn" (click)="createFolder()" kendoButton>
          <i class="fa-solid fa-plus"></i>
          Create
        </button>
      }
      <button class="yes-btn" (click)="toggleUpsertFolderView(false, false)" kendoButton>
        <i class="fa-solid fa-times"></i>
        Cancel
      </button>
    </kendo-dialog-actions>
  </kendo-dialog>

  <!-- Entity Form Dialog -->
  <mj-entity-form-dialog
    #entityFormDialog
    Mode="complete">
  </mj-entity-form-dialog>
</div>