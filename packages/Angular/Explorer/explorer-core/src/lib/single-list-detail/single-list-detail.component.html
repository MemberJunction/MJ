<div class="list-detail-container">
  <!-- Header -->
  <div class="list-header">
    <h1>{{ listRecord ? listRecord.Name : "List" }}</h1>
    <kendo-dropdownbutton
      class="add-btn"
      (itemClick)="onDropdownItemClick($event)"
      [data]="addOptions"
      textField="Text"
      themeColor="info">
      <span class="fa-solid fa-plus"></span>
      Add to List
    </kendo-dropdownbutton>
  </div>

  <!-- Loading State -->
  @if (showLoader) {
    <div class="loading-container">
      <mj-loading text="Loading list..." size="medium"></mj-loading>
    </div>
  }

  <!-- Grid -->
  @if (!showLoader && listRecord) {
    <div class="grid-container">
      <mj-list-detail-grid
        #listDetailGrid
        [listId]="ListID"
        [listEntity]="listRecord"
        [autoNavigate]="true"
        [height]="'auto'"
        [showToolbar]="true"
        [selectionMode]="'single'"
        (rowClicked)="onRowClicked($event)"
        (rowDoubleClicked)="onRowDoubleClicked($event)">
      </mj-list-detail-grid>
    </div>
  }
</div>

<!-- Add From View Dialog -->
<kendo-dialog
  class="dialog-wrapper"
  title="Select Views to Add"
  *ngIf="showAddDialog"
  (close)="toggleAddFromViewDialog(false)"
  [minWidth]="250"
  [width]="650"
  [height]="550">
  @if (showAddLoader) {
    <mj-loading [showText]="false" size="small"></mj-loading>
    <kendo-progressbar
      [min]="0"
      [max]="recordsToSave"
      [value]="recordsSaved"
      [indeterminate]="fetchingRecordsToSave" />
  } @else {
    <div class="search-header">
      <kendo-textbox
        id="listSearch"
        placeholder="Search Views..."
        kendoTextBox
        [clearButton]="true"
        class="search-bar" />
    </div>
    <hr>
    @for (userView of userViews; track userView.ID) {
      <div class="overflow-y-scroll">
        <div class="list-item">
          <div class="list-text" [ngClass]="{'list-selected': userViewsToAdd.includes(userView)}">
            {{ userView.Name }}
          </div>
          @if (userViewsToAdd.includes(userView)) {
            <button kendoButton class="btn-no-border btn-selected" (click)="removeViewFromSelectedList(userView)">
              <span class="fa-solid fa-minus"></span>
              Remove
            </button>
          } @else {
            <button kendoButton class="btn-no-border" (click)="addViewToSelectedList(userView)">
              <div class="btn-margin-right">
                <span class="fa-solid fa-plus"></span>
                Add
              </div>
            </button>
          }
        </div>
        <hr>
      </div>
    }
  }
  <kendo-dialog-actions class="popup-actions-btn">
    <button class="cancel-btn" (click)="addTolist()" [disabled]="showAddLoader" kendoButton themeColor="info">
      Done
    </button>
    <button class="yes-btn" (click)="toggleAddFromViewDialog(false)" [disabled]="showAddLoader" kendoButton fillMode="outline" themeColor="info">
      Cancel
    </button>
  </kendo-dialog-actions>
</kendo-dialog>

<!-- Add Single Record Dialog -->
<kendo-dialog
  class="dialog-wrapper"
  [title]="'Select ' + (listRecord ? listRecord.Entity : 'Records') + ' to Add to List'"
  *ngIf="showAddSingleRecordsDialog"
  (close)="toggleAddRecordsDialog(false)"
  [minWidth]="250"
  [width]="650"
  [height]="550">
  @if (showDialogLoader) {
    <mj-loading [showText]="false" size="small"></mj-loading>
    <kendo-progressbar
      [min]="0"
      [max]="recordsToSave"
      [value]="recordsSaved"
      [indeterminate]="fetchingRecordsToSave" />
  } @else {
    <div class="search-header">
      <kendo-textbox
        id="listRecordSearch"
        (valueChange)="onListRecordDialogValueChange($event)"
        [placeholder]="'Search ' + (listRecord ? listRecord.Entity : 'Records') + '...'"
        kendoTextBox
        [clearButton]="true"
        class="search-bar" />
    </div>
    <hr>
    @if (fetchingListRecords) {
      <mj-loading [showText]="false" size="small"></mj-loading>
    } @else {
      @for (record of listRecords; track record.ID) {
        <div class="overflow-y-scroll">
          <div class="list-item">
            <div class="list-text">
              {{ record.Name }}
            </div>
            <button kendoButton class="btn-no-border" (click)="addListRecord(record)">
              <div class="btn-margin-right">
                <span class="fa-solid fa-plus"></span>
                Add
              </div>
            </button>
          </div>
          <hr>
        </div>
      }
    }
  }
  <kendo-dialog-actions class="popup-actions-btn">
    <button class="yes-btn" (click)="toggleAddRecordsDialog(false)" [disabled]="showDialogLoader" kendoButton fillMode="outline" themeColor="info">
      Close
    </button>
  </kendo-dialog-actions>
</kendo-dialog>
