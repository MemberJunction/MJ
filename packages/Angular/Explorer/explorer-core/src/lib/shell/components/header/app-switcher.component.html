<div class="app-switcher-container" [class.loading]="isLoading">
  <div class="app-switcher-button"
    (click)="toggleDropdown()">
    <!-- Show spinner when loading, otherwise show app icon -->
    @if (isLoading) {
      <i class="app-icon loading-spinner fa-solid fa-spinner fa-spin"></i>
    }
    @if (!isLoading) {
      <i class="app-icon" [class]="activeApp?.Icon || 'fa-solid fa-cube'"
        [style.color]="activeApp?.GetColor()"
      [style.--active-color]="activeApp?.GetColor()"></i>
    }
    <i class="dropdown-arrow fa-solid fa-chevron-down"></i>
  </div>

  @if (showDropdown) {
    <div class="app-switcher-dropdown">
      @for (app of apps; track app) {
        <div
          class="app-switcher-item"
          [class.active]="app.ID === activeApp?.ID"
          [class.loading]="app.ID === loadingAppId"
          [style.--item-color]="app.GetColor()"
          (click)="selectApp(app)">
          @if (app.ID === loadingAppId) {
            <i class="fa-solid fa-spinner fa-spin"></i>
          }
          @if (app.ID !== loadingAppId) {
            <i [class]="app.Icon || 'fa-solid fa-cube'"></i>
          }
          <span>{{ app.Name }}</span>
        </div>
      }
      <!-- Divider -->
      <div class="app-switcher-divider"></div>
      <!-- Configure option -->
      <div class="app-switcher-item configure-item" (click)="openConfigDialog()">
        <i class="fa-solid fa-gear"></i>
        <span>Configure...</span>
      </div>
    </div>
  }
</div>

<!-- App Configuration Dialog -->
<mj-user-app-config
  #appConfigDialog
  [(showDialog)]="showConfigDialog"
  (configSaved)="onConfigSaved()">
</mj-user-app-config>
