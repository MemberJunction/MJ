<!-- Dashboard Creation/Edit Dialogs -->
<app-add-item-dialog 
  *ngIf="isItemDialogOpened" 
  (onClose)="closeDialog($event)" 
  [selectedResource]="selectedResource">
</app-add-item-dialog>

<div *ngIf="isEditDialogOpened">
  <app-edit-dashboard 
    (onClose)="closeDashboardDialog($event)" 
    (triggerAddItem)="addItem($event)" 
    [items]="items" 
    [config]="config" 
    (onSave)="saveChanges($event)">
  </app-edit-dashboard>
</div>

<app-delete-item-dialog 
  *ngIf="isDeletingDashboardItem" 
  [dashboardItem]="selectedDashboardItem" 
  (removeDashboardItem)="deleteDashboardItem($event)" 
  (onClose)="closeDeleteItemComponent()">
</app-delete-item-dialog>

<!-- Main Dashboard Container -->
<div class="dashboard-container">
  <!-- Dashboard Header -->
  <div class="main-head-dashboard">
    <div class="dashboard-title">
      <!-- Inline Name Edit Mode -->
      <div *ngIf="isEditDashboardNameDialogOpened; else dashboard_name_header" 
           class="dashboard-header">
        <input class="k-textbox k-input k-input-md k-rounded-md k-input-solid" 
               (keydown.enter)="saveDashboardName()" 
               type="text" 
               placeholder="Enter dashboard name" 
               id="txtDashboardName" 
               #dashboardNameInput>
        <button class="mj-btn-primary" (click)="saveDashboardName()">
          <i class="fa-solid fa-check"></i>
          Save
        </button>
        <button class="mj-btn-secondary" (click)="cancelNameChange()">
          <i class="fa-solid fa-times"></i>
          Cancel
        </button>
      </div>
      
      <!-- Dashboard Name Display -->
      <ng-template #dashboard_name_header>
        <i class="fa-solid fa-chart-line"></i>
        <h1 (click)="toggleInlineNameEdit(true)">{{dashboardEntity ? dashboardEntity.Name : 'Dashboard'}}</h1>
      </ng-template>
    </div>
    
    <!-- Dashboard Actions -->
    <div class="dashboard-header">
      <div *ngIf="isEditingDashboard; else edit_dashboard_buttons">
        <button class="mj-btn-primary" (click)="onClickSaveDashboard()">
          <i class="fa-solid fa-check"></i>
          Save Changes
        </button>
        <button class="mj-btn-secondary" (click)="onclickCancelChanges()">
          <i class="fa-solid fa-times"></i>
          Cancel
        </button>
      </div>
      
      <ng-template #edit_dashboard_buttons>
        <button class="mj-btn-primary" (click)="addItem()">
          <i class="fa-solid fa-plus"></i>
          Add Item
        </button>
        <button class="mj-btn-secondary" (click)="toggleEditDashboard(true)">
          <i class="fa-solid fa-gear"></i>
          Edit Dashboard
        </button>
      </ng-template>
    </div>
  </div>

  <!-- Dashboard Content -->
  <div class="tile-resource-container">
    <!-- Empty State -->
    <div *ngIf="items.length === 0 && !isEditingDashboard" class="empty-dashboard">
      <i class="fa-solid fa-chart-line"></i>
      <h3>This dashboard is empty</h3>
      <p>Start building your dashboard by adding reports, charts, or user views</p>
      <button class="mj-btn-primary" (click)="addItem()">
        <i class="fa-solid fa-plus"></i>
        Add Your First Item
      </button>
    </div>
    
    <!-- Dashboard Tile Layout -->
    <kendo-tilelayout
      *ngIf="items.length > 0 || isEditingDashboard"
      [columns]="config.columns"
      [rowHeight]="config.rowHeight"
      [resizable]="allowResize"
      [reorderable]="allowReorder"
      (reorder)="onReorder($event)"
      (resize)="onResize($event)">
      
      @for(item of items; track item.uniqueId) {
        <kendo-tilelayout-item 
          (mouseenter)="onMouseEnter($event)" 
          (mouseleave)="onMouseOut($event)" 
          [ngClass]="[getSelectedComponentStyle(this)]" 
          [col]="item.col" 
          [colSpan]="item.colSpan" 
          [rowSpan]="item.rowSpan" 
          [id]="item.uniqueId">
          
          <!-- Dashboard Item Header -->
          <kendo-tilelayout-item-header 
            [ngClass]="['dashboard-item-header', getIsEditingItemHeaderStyle()]">
            <div class="item-title">
              <i [class]="getResourceIcon(item.ResourceData.ResourceType)"></i>
              {{item.title}}
            </div>
            
            @if(!isEditingDashboard) {
              <div class="btn-wrapper">
                <button kendoButton 
                        title="Edit Dashboard" 
                        (click)="toggleEditDashboard(true)">
                  <i class="fa-solid fa-pen-to-square"></i>
                </button>
                <button kendoButton 
                        title="Remove Item" 
                        (click)="showConfirmDeleteDashboardItem(item)">
                  <i class="fa-solid fa-trash"></i>
                </button>
              </div>
            }
          </kendo-tilelayout-item-header>
          
          <!-- Dashboard Item Body -->
          <kendo-tilelayout-item-body [ngClass]="[getIsEditingItemBodyStyle()]">
            <mj-resource 
              [Data]="item.ResourceData" 
              [isVisible]="true" 
              (ContentLoadingStarted)="loadingStarted($event)" 
              (ContentLoadingComplete)="loadingComplete($event)">
            </mj-resource>
          </kendo-tilelayout-item-body>
        </kendo-tilelayout-item>
      }
    </kendo-tilelayout>
  </div>
</div>