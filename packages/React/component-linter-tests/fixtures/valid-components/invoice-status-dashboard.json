{
  "name": "InvoiceStatusDashboard",
  "namespace": "CRM/Finance",
  "type": "Dashboard",
  "location": "embedded",
  "code": "function InvoiceStatusDashboard({ utilities, styles, components, callbacks, savedUserSettings, onSaveUserSettings }) {\n  // Extract AIInsightsPanel from components\n  const AIInsightsPanel = components?.AIInsightsPanel;\n  const DataExportPanel = components?.DataExportPanel;\n\n  if (!AIInsightsPanel) {\n    console.warn('AIInsightsPanel component not available');\n  }\n\n  const [invoices, setInvoices] = useState([]);\n  const [payments, setPayments] = useState([]);\n  const [accounts, setAccounts] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n  const [selectedData, setSelectedData] = useState(null);\n  const [drillDownType, setDrillDownType] = useState(null);\n  const [isPanelOpen, setIsPanelOpen] = useState(false);\n  const [timePeriod, setTimePeriod] = useState(savedUserSettings?.timePeriod || 'all');\n  const [startDate, setStartDate] = useState(savedUserSettings?.startDate || null);\n  const [endDate, setEndDate] = useState(savedUserSettings?.endDate || null);\n  \n  const statusChartRef = useRef(null);\n  const agingChartRef = useRef(null);\n  const statusChartInstance = useRef(null);\n  const agingChartInstance = useRef(null);\n  \n  // AI Insights state\n  const [aiInsights, setAiInsights] = useState(null);\n  const [loadingInsights, setLoadingInsights] = useState(false);\n  const [insightsError, setInsightsError] = useState(null);\n\n  const getDateFilter = React.useCallback(() => {\n    // If showing all data, return empty filter\n    if (timePeriod === 'all') {\n      return '';\n    }\n\n    // If custom dates are set, use them\n    if (timePeriod === 'custom' && startDate && endDate) {\n      return `InvoiceDate >= '${startDate}' AND InvoiceDate <= '${endDate}'`;\n    }\n\n    const now = new Date();\n    let filterStart, filterEnd;\n\n    switch (timePeriod) {\n      case 'month':\n        filterStart = new Date(now.getFullYear(), now.getMonth(), 1);\n        filterEnd = new Date(now.getFullYear(), now.getMonth() + 1, 0);\n        break;\n      case 'lastMonth':\n        filterStart = new Date(now.getFullYear(), now.getMonth() - 1, 1);\n        filterEnd = new Date(now.getFullYear(), now.getMonth(), 0);\n        break;\n      case 'quarter':\n        const currentQuarter = Math.floor(now.getMonth() / 3);\n        filterStart = new Date(now.getFullYear(), currentQuarter * 3, 1);\n        filterEnd = new Date(now.getFullYear(), currentQuarter * 3 + 3, 0);\n        break;\n      case 'lastQuarter':\n        const lastQuarter = Math.floor(now.getMonth() / 3) - 1;\n        const year = lastQuarter < 0 ? now.getFullYear() - 1 : now.getFullYear();\n        const quarter = lastQuarter < 0 ? 3 : lastQuarter;\n        filterStart = new Date(year, quarter * 3, 1);\n        filterEnd = new Date(year, quarter * 3 + 3, 0);\n        break;\n      case 'year':\n        filterStart = new Date(now.getFullYear(), 0, 1);\n        filterEnd = new Date(now.getFullYear(), 11, 31);\n        break;\n      case 'lastYear':\n        filterStart = new Date(now.getFullYear() - 1, 0, 1);\n        filterEnd = new Date(now.getFullYear() - 1, 11, 31);\n        break;\n      default:\n        return '';\n    }\n    \n    if (filterStart && filterEnd) {\n      return `InvoiceDate >= '${filterStart.toISOString().split('T')[0]}' AND InvoiceDate <= '${filterEnd.toISOString().split('T')[0]}'`;\n    }\n    return '';\n  }, [timePeriod, startDate, endDate]);\n\n  const loadData = React.useCallback(async () => {\n    setLoading(true);\n    setError(null);\n\n    try {\n      const dateFilter = getDateFilter();\n\n      // Check which API is available\n      const runViewsMethod = utilities?.RunViews || utilities?.rv?.RunViews;\n\n      if (!runViewsMethod) {\n        setError('Data loading method not available');\n        return;\n      }\n\n      // Use RunViews for batch loading\n      const results = await runViewsMethod([\n        {\n          EntityName: 'Invoices',\n          ExtraFilter: dateFilter,\n          OrderBy: 'DueDate ASC'\n        },\n        {\n          EntityName: 'Payments',\n          OrderBy: 'PaymentDate DESC',\n          MaxRows: 500\n        },\n        {\n          EntityName: 'Accounts',\n          OrderBy: 'AccountName ASC'\n        }\n      ]);\n\n      if (results && results.length === 3) {\n        const [invoicesResult, paymentsResult, accountsResult] = results;\n\n        if (invoicesResult.Success) {\n          setInvoices(invoicesResult.Results || []);\n        }\n        if (paymentsResult.Success) {\n          setPayments(paymentsResult.Results || []);\n        }\n        if (accountsResult.Success) {\n          setAccounts(accountsResult.Results || []);\n        }\n\n        if (!invoicesResult.Success) {\n          setError('Failed to load invoice data: ' + (invoicesResult.ErrorMessage || 'Unknown error'));\n        }\n      } else {\n        setError('Unexpected data format received');\n      }\n    } catch (err) {\n      setError(err.message);\n    } finally {\n      setLoading(false);\n    }\n  }, [getDateFilter, utilities]);\n\n  // Load data when component mounts or filters change\n  useEffect(() => {\n    loadData();\n  }, [loadData, timePeriod, startDate, endDate]);\n\n  const metrics = React.useMemo(() => {\n    const result = {\n      total: invoices.length,\n      totalAmount: 0,\n      paid: 0,\n      paidAmount: 0,\n      overdue: 0,\n      overdueAmount: 0,\n      pending: 0,\n      pendingAmount: 0,\n      partial: 0,\n      partialAmount: 0\n    };\n    \n    const today = new Date();\n    \n    // Calculate paid amounts from payments\n    const paidByInvoice = {};\n    payments.forEach(payment => {\n      if (!paidByInvoice[payment.InvoiceID]) {\n        paidByInvoice[payment.InvoiceID] = 0;\n      }\n      paidByInvoice[payment.InvoiceID] += payment.Amount || 0;\n    });\n    \n    invoices.forEach(invoice => {\n      const amount = invoice.TotalAmount || 0;\n      const paidAmount = paidByInvoice[invoice.ID] || 0;\n      const remainingAmount = amount - paidAmount;\n      \n      result.totalAmount += amount;\n\n      if (invoice.Status === 'Paid' || remainingAmount <= 0) {\n        result.paid++;\n        result.paidAmount += amount;\n      } else if (invoice.Status === 'Cancelled') {\n        // Skip cancelled invoices\n      } else if (invoice.Status === 'Partial' || (paidAmount > 0 && remainingAmount > 0)) {\n        result.partial++;\n        result.partialAmount += remainingAmount;\n        if (new Date(invoice.DueDate) < today) {\n          result.overdue++;\n          result.overdueAmount += remainingAmount;\n        }\n      } else if (new Date(invoice.DueDate) < today) {\n        result.overdue++;\n        result.overdueAmount += remainingAmount;\n      } else {\n        result.pending++;\n        result.pendingAmount += remainingAmount;\n      }\n    });\n\n    return result;\n  }, [invoices, payments]);\n\n  const openDrillDown = React.useCallback((type, data) => {\n    setDrillDownType(type);\n    setSelectedData(data);\n    setIsPanelOpen(true);\n  }, []);\n  \n  // Generate AI Insights\n  // Format insights text using marked library for proper markdown rendering\n\n  const generateAIInsights = React.useCallback(async () => {\n    setLoadingInsights(true);\n    setInsightsError(null);\n    \n    try {\n      // metrics is already calculated via useMemo\n      \n      // Calculate aging breakdown\n      const aging = { current: 0, '30days': 0, '60days': 0, '90days': 0, 'over90': 0 };\n      const today = new Date();\n      const paidByInvoice = {};\n      payments.forEach(payment => {\n        if (!paidByInvoice[payment.InvoiceID]) {\n          paidByInvoice[payment.InvoiceID] = 0;\n        }\n        paidByInvoice[payment.InvoiceID] += payment.Amount || 0;\n      });\n      \n      invoices.forEach(invoice => {\n        if (invoice.Status !== 'Paid' && invoice.Status !== 'Cancelled') {\n          const paidAmount = paidByInvoice[invoice.ID] || 0;\n          const outstanding = (invoice.TotalAmount || 0) - paidAmount;\n          \n          if (outstanding > 0) {\n            const dueDate = new Date(invoice.DueDate);\n            const daysPastDue = Math.floor((today - dueDate) / (1000 * 60 * 60 * 24));\n            \n            if (daysPastDue <= 0) aging.current += outstanding;\n            else if (daysPastDue <= 30) aging['30days'] += outstanding;\n            else if (daysPastDue <= 60) aging['60days'] += outstanding;\n            else if (daysPastDue <= 90) aging['90days'] += outstanding;\n            else aging.over90 += outstanding;\n          }\n        }\n      });\n      \n      const formatCurrency = (amount) => {\n        if (amount >= 1000000) return `$${(amount / 1000000).toFixed(1)}M`;\n        if (amount >= 1000) return `$${(amount / 1000).toFixed(0)}K`;\n        return `$${amount?.toFixed(0) || 0}`;\n      };\n      \n      const prompt = `Analyze this invoice status and aging data and provide actionable insights:\n\n## Invoice Overview\n- **Time Period:** ${timePeriod === 'custom' ? `${startDate} to ${endDate}` : `Last ${timePeriod}`}\n- **Total Invoices:** ${metrics.total}\n- **Total Amount:** ${formatCurrency(metrics.totalAmount)}\n\n## Status Breakdown\n- **Paid:** ${metrics.paid} invoices (${formatCurrency(metrics.paidAmount)})\n- **Pending:** ${metrics.pending} invoices (${formatCurrency(metrics.pendingAmount)})\n- **Overdue:** ${metrics.overdue} invoices (${formatCurrency(metrics.overdueAmount)})\n- **Partial:** ${metrics.partial} invoices (${formatCurrency(metrics.partialAmount)})\n\n## Aging Analysis\n- **Current (not overdue):** ${formatCurrency(aging.current)}\n- **1-30 days overdue:** ${formatCurrency(aging['30days'])}\n- **31-60 days overdue:** ${formatCurrency(aging['60days'])}\n- **61-90 days overdue:** ${formatCurrency(aging['90days'])}\n- **Over 90 days overdue:** ${formatCurrency(aging.over90)}\n\n## Key Metrics\n- **Total Payments Recorded:** ${payments.length}\n- **Total Customer Accounts:** ${accounts.length}\n- **Collection Rate:** ${metrics.paid > 0 ? ((metrics.paidAmount / metrics.totalAmount) * 100).toFixed(1) : 0}%\n- **Average Days Overdue:** ${metrics.overdue > 0 ? Math.round(invoices.filter(i => i.Status === 'Overdue').reduce((sum, inv) => {\n    const dueDate = new Date(inv.DueDate);\n    const today = new Date();\n    return sum + Math.max(0, Math.floor((today - dueDate) / (1000 * 60 * 60 * 24)));\n  }, 0) / metrics.overdue) : 0} days\n\nBased on this specific data, please provide:\n1. **Cash Flow Analysis** - What is the immediate cash flow situation?\n2. **Risk Assessment** - Which invoices pose the highest collection risk?\n3. **Customer Payment Patterns** - What behaviors are evident?\n4. **Collection Strategy** - Specific recommendations to improve collections\n5. **Action Items** - 3-4 immediate actions to reduce overdue amounts\n6. **Early Warning Indicators** - What metrics should we monitor closely?\n\nUse markdown formatting with headers (##), bullet points, and **bold** text. Reference the actual numbers in your analysis.`;\n      \n      const result = await utilities.ai.ExecutePrompt({\n        systemPrompt: 'You are an expert accounts receivable and cash flow analyst with deep knowledge of invoice management, collections, and customer payment behavior. Provide clear, actionable insights with specific recommendations. Format your response in clear markdown.',\n        messages: prompt,\n        preferredModels: ['GPT-OSS-120B', 'Qwen3 32B'],\n        modelPower: 'high',\n        temperature: 0.7,\n        maxTokens: 1500\n      });\n      \n      if (result?.success && result?.result) {\n        setAiInsights(result.result);\n      } else {\n        setInsightsError('Failed to generate insights. Please try again.');\n      }\n    } catch (error) {\n      setInsightsError(error.message || 'Failed to generate AI insights');\n    } finally {\n      setLoadingInsights(false);\n    }\n  }, [invoices, payments, metrics, utilities.ai]);\n\n  const closeDrillDown = React.useCallback(() => {\n    setIsPanelOpen(false);\n    setTimeout(() => {\n      setSelectedData(null);\n      setDrillDownType(null);\n    }, 300);\n  }, []);\n\n  // Prepare data for export - memoized to prevent re-computation\n  const prepareExportData = React.useMemo(() => {\n    // metrics is already calculated via useMemo\n    const today = new Date();\n    const paidByInvoice = {};\n    payments.forEach(payment => {\n      if (!paidByInvoice[payment.InvoiceID]) {\n        paidByInvoice[payment.InvoiceID] = 0;\n      }\n      paidByInvoice[payment.InvoiceID] += payment.Amount || 0;\n    });\n\n    return invoices.map(invoice => {\n      const paidAmount = paidByInvoice[invoice.ID] || 0;\n      const outstanding = (invoice.TotalAmount || 0) - paidAmount;\n      const dueDate = new Date(invoice.DueDate);\n      const daysPastDue = Math.floor((today - dueDate) / (1000 * 60 * 60 * 24));\n\n      let agingBucket = 'Current';\n      if (daysPastDue > 0) {\n        if (daysPastDue <= 30) agingBucket = '1-30 Days';\n        else if (daysPastDue <= 60) agingBucket = '31-60 Days';\n        else if (daysPastDue <= 90) agingBucket = '61-90 Days';\n        else agingBucket = 'Over 90 Days';\n      }\n\n      return {\n        InvoiceNumber: invoice.InvoiceNumber || '',\n        AccountName: invoice.AccountName || '',\n        InvoiceDate: invoice.InvoiceDate ? new Date(invoice.InvoiceDate).toLocaleDateString() : '',\n        DueDate: invoice.DueDate ? new Date(invoice.DueDate).toLocaleDateString() : '',\n        TotalAmount: `$${(invoice.TotalAmount || 0).toFixed(2)}`,\n        PaidAmount: `$${paidAmount.toFixed(2)}`,\n        Outstanding: `$${outstanding.toFixed(2)}`,\n        Status: invoice.Status || '',\n        DaysPastDue: Math.max(0, daysPastDue),\n        AgingBucket: agingBucket\n      };\n    });\n  }, [invoices, payments, metrics]);\n\n  // Define export columns - memoized to prevent re-creation\n  const getExportColumns = React.useMemo(() => {\n    return [\n      { key: 'InvoiceNumber', label: 'Invoice Number' },\n      { key: 'AccountName', label: 'Account Name' },\n      { key: 'InvoiceDate', label: 'Invoice Date' },\n      { key: 'DueDate', label: 'Due Date' },\n      { key: 'TotalAmount', label: 'Total Amount' },\n      { key: 'PaidAmount', label: 'Paid Amount' },\n      { key: 'Outstanding', label: 'Outstanding' },\n      { key: 'Status', label: 'Status' },\n      { key: 'DaysPastDue', label: 'Days Past Due' },\n      { key: 'AgingBucket', label: 'Aging Bucket' }\n    ];\n  }, []);\n\n  // Status Distribution Chart with click handler\n  useEffect(() => {\n    if (!loading && statusChartRef.current && invoices.length > 0) {\n      // metrics is already calculated via useMemo\n      const ctx = statusChartRef.current.getContext('2d');\n      \n      // Destroy existing chart\n      if (statusChartInstance.current) {\n        statusChartInstance.current.destroy();\n      }\n      \n      statusChartInstance.current = new Chart(ctx, {\n        type: 'doughnut',\n        data: {\n          labels: ['Paid', 'Pending', 'Overdue', 'Partial'],\n          datasets: [{\n            data: [metrics.paid, metrics.pending, metrics.overdue, metrics.partial],\n            backgroundColor: ['#10B981', '#3B82F6', '#EF4444', '#F59E0B'],\n            borderWidth: 0\n          }]\n        },\n        options: {\n          responsive: true,\n          maintainAspectRatio: false,\n          onClick: (event, activeElements) => {\n            if (activeElements.length > 0) {\n              const index = activeElements[0].index;\n              const labels = ['Paid', 'Pending', 'Overdue', 'Partial'];\n              openDrillDown('status', labels[index]);\n            }\n          },\n          plugins: {\n            legend: {\n              position: 'right',\n              labels: {\n                padding: 20,\n                font: { size: 12 }\n              }\n            },\n            tooltip: {\n              callbacks: {\n                label: (context) => {\n                  const value = context.raw;\n                  const total = context.dataset.data.reduce((a, b) => a + b, 0);\n                  const percentage = ((value / total) * 100).toFixed(1);\n                  return `${context.label}: ${value} (${percentage}%)`;\n                }\n              }\n            }\n          }\n        }\n      });\n    }\n    \n    return () => {\n      if (statusChartInstance.current) {\n        statusChartInstance.current.destroy();\n      }\n    };\n  }, [loading, invoices]);\n\n  // Aging Chart with click handler\n  useEffect(() => {\n    if (!loading && agingChartRef.current && invoices.length > 0) {\n      const aging = { current: 0, '30days': 0, '60days': 0, '90days': 0, 'over90': 0 };\n      const agingInvoices = { current: [], '30days': [], '60days': [], '90days': [], 'over90': [] };\n      const today = new Date();\n      \n      // Calculate paid amounts\n      const paidByInvoice = {};\n      payments.forEach(payment => {\n        if (!paidByInvoice[payment.InvoiceID]) {\n          paidByInvoice[payment.InvoiceID] = 0;\n        }\n        paidByInvoice[payment.InvoiceID] += payment.Amount || 0;\n      });\n      \n      invoices.forEach(invoice => {\n        if (invoice.Status !== 'Paid' && invoice.Status !== 'Cancelled') {\n          const paidAmount = paidByInvoice[invoice.ID] || 0;\n          const outstanding = (invoice.TotalAmount || 0) - paidAmount;\n          \n          if (outstanding > 0) {\n            const dueDate = new Date(invoice.DueDate);\n            const daysPastDue = Math.floor((today - dueDate) / (1000 * 60 * 60 * 24));\n            \n            if (daysPastDue <= 0) {\n              aging.current += outstanding;\n              agingInvoices.current.push(invoice);\n            } else if (daysPastDue <= 30) {\n              aging['30days'] += outstanding;\n              agingInvoices['30days'].push(invoice);\n            } else if (daysPastDue <= 60) {\n              aging['60days'] += outstanding;\n              agingInvoices['60days'].push(invoice);\n            } else if (daysPastDue <= 90) {\n              aging['90days'] += outstanding;\n              agingInvoices['90days'].push(invoice);\n            } else {\n              aging.over90 += outstanding;\n              agingInvoices.over90.push(invoice);\n            }\n          }\n        }\n      });\n      \n      const ctx = agingChartRef.current.getContext('2d');\n      \n      if (agingChartInstance.current) {\n        agingChartInstance.current.destroy();\n      }\n      \n      agingChartInstance.current = new Chart(ctx, {\n        type: 'bar',\n        data: {\n          labels: ['Current', '1-30 Days', '31-60 Days', '61-90 Days', 'Over 90'],\n          datasets: [{\n            label: 'Outstanding Amount',\n            data: Object.values(aging),\n            backgroundColor: ['#10B981', '#3B82F6', '#F59E0B', '#FB923C', '#EF4444']\n          }]\n        },\n        options: {\n          responsive: true,\n          maintainAspectRatio: false,\n          onClick: (event, activeElements) => {\n            if (activeElements.length > 0) {\n              const index = activeElements[0].index;\n              const keys = ['current', '30days', '60days', '90days', 'over90'];\n              const labels = ['Current', '1-30 Days Overdue', '31-60 Days Overdue', '61-90 Days Overdue', 'Over 90 Days Overdue'];\n              openDrillDown('aging', { label: labels[index], invoices: agingInvoices[keys[index]] });\n            }\n          },\n          plugins: {\n            legend: { display: false },\n            tooltip: {\n              callbacks: {\n                label: (context) => `$${(context.raw / 1000).toFixed(1)}K`\n              }\n            }\n          },\n          scales: {\n            y: {\n              beginAtZero: true,\n              ticks: {\n                callback: (value) => `$${(value / 1000).toFixed(0)}K`\n              }\n            }\n          }\n        }\n      });\n    }\n    \n    return () => {\n      if (agingChartInstance.current) {\n        agingChartInstance.current.destroy();\n      }\n    };\n  }, [loading, invoices, payments]);\n\n  const CustomerBalances = () => {\n    const customerBalances = {};\n    \n    // Calculate paid amounts from payments\n    const paidByInvoice = {};\n    payments.forEach(payment => {\n      if (!paidByInvoice[payment.InvoiceID]) {\n        paidByInvoice[payment.InvoiceID] = 0;\n      }\n      paidByInvoice[payment.InvoiceID] += payment.Amount || 0;\n    });\n    \n    // Create account lookup map\n    const accountMap = {};\n    accounts.forEach(account => {\n      accountMap[account.ID] = account;\n    });\n    \n    invoices.forEach(invoice => {\n      if (invoice.Status !== 'Paid' && invoice.Status !== 'Cancelled') {\n        const customerId = invoice.AccountID || 'Unknown';\n        if (!customerBalances[customerId]) {\n          const account = accountMap[customerId];\n          customerBalances[customerId] = {\n            id: customerId,\n            name: account ? account.AccountName : `Account #${customerId}`,\n            totalDue: 0,\n            overdueAmount: 0,\n            invoiceCount: 0,\n            invoices: [],\n            oldestDue: null\n          };\n        }\n        \n        const paidAmount = paidByInvoice[invoice.ID] || 0;\n        const outstanding = (invoice.TotalAmount || 0) - paidAmount;\n        \n        if (outstanding > 0) {\n          customerBalances[customerId].totalDue += outstanding;\n          customerBalances[customerId].invoiceCount++;\n          customerBalances[customerId].invoices.push({\n            ...invoice,\n            outstanding,\n            paidAmount\n          });\n          \n          const dueDate = new Date(invoice.DueDate);\n          if (dueDate < new Date()) {\n            customerBalances[customerId].overdueAmount += outstanding;\n          }\n          \n          if (!customerBalances[customerId].oldestDue || dueDate < customerBalances[customerId].oldestDue) {\n            customerBalances[customerId].oldestDue = dueDate;\n          }\n        }\n      }\n    });\n    \n    const topCustomers = Object.values(customerBalances)\n      .sort((a, b) => b.totalDue - a.totalDue)\n      .slice(0, 5);\n    \n    return (\n      <div style={{ backgroundColor: 'white', borderRadius: '8px', padding: '16px' }}>\n        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '16px' }}>\n          <h3 style={{ margin: 0, fontSize: '18px' }}>Top Customer Balances</h3>\n        </div>\n        \n        <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>\n          {topCustomers.map((customer, index) => (\n            <div\n              key={customer.id}\n              style={{\n                padding: '12px',\n                backgroundColor: '#F9FAFB',\n                borderRadius: '6px',\n                cursor: 'pointer',\n                transition: 'all 0.2s',\n                borderLeft: `4px solid ${customer.overdueAmount > 0 ? '#EF4444' : '#3B82F6'}`\n              }}\n              onClick={() => openDrillDown('customer', customer)}\n              onMouseEnter={(e) => {\n                e.currentTarget.style.transform = 'translateX(4px)';\n                e.currentTarget.style.boxShadow = '0 2px 4px rgba(0,0,0,0.1)';\n              }}\n              onMouseLeave={(e) => {\n                e.currentTarget.style.transform = 'translateX(0)';\n                e.currentTarget.style.boxShadow = 'none';\n              }}\n            >\n              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\n                <div>\n                  <div style={{ fontWeight: 'bold', fontSize: '14px' }}>\n                    {customer.name}\n                  </div>\n                  <div style={{ fontSize: '12px', color: '#6B7280' }}>\n                    {customer.invoiceCount} invoice{customer.invoiceCount !== 1 ? 's' : ''} outstanding\n                  </div>\n                </div>\n                <div style={{ textAlign: 'right' }}>\n                  <div style={{ fontSize: '18px', fontWeight: 'bold', color: customer.overdueAmount > 0 ? '#EF4444' : '#111827' }}>\n                    ${(customer.totalDue / 1000).toFixed(1)}K\n                  </div>\n                  {customer.overdueAmount > 0 && (\n                    <div style={{ fontSize: '11px', color: '#EF4444' }}>\n                      ${(customer.overdueAmount / 1000).toFixed(1)}K overdue\n                    </div>\n                  )}\n                </div>\n              </div>\n            </div>\n          ))}\n        </div>\n      </div>\n    );\n  };\n\n  const DrillDownPanel = () => {\n    if (!isPanelOpen || !selectedData) return null;\n    \n    const renderContent = () => {\n      switch (drillDownType) {\n        case 'status':\n          const statusInvoices = invoices.filter(inv => {\n            if (selectedData === 'Overdue') {\n              return inv.Status !== 'Paid' && inv.Status !== 'Cancelled' && new Date(inv.DueDate) < new Date();\n            }\n            if (selectedData === 'Pending') {\n              return inv.Status === 'Sent' || (inv.Status !== 'Paid' && inv.Status !== 'Cancelled' && new Date(inv.DueDate) >= new Date());\n            }\n            return inv.Status === selectedData;\n          });\n          \n          return (\n            <div>\n              <h3 style={{ margin: '0 0 16px 0' }}>{selectedData} Invoices</h3>\n              <div style={{ maxHeight: '500px', overflow: 'auto' }}>\n                {statusInvoices.map(invoice => (\n                  <div key={invoice.ID} style={{ \n                    padding: '12px', \n                    marginBottom: '8px', \n                    backgroundColor: '#F9FAFB', \n                    borderRadius: '6px',\n                    display: 'flex',\n                    justifyContent: 'space-between',\n                    alignItems: 'center'\n                  }}>\n                    <div>\n                      <div style={{ fontWeight: 'bold' }}>#{invoice.InvoiceNumber}</div>\n                      <div style={{ fontSize: '12px', color: '#6B7280' }}>\n                        Due: {new Date(invoice.DueDate).toLocaleDateString()}\n                      </div>\n                    </div>\n                    <div style={{ display: 'flex', gap: '12px', alignItems: 'center' }}>\n                      <div style={{ fontWeight: 'bold' }}>\n                        ${((invoice.TotalAmount || 0) / 1000).toFixed(1)}K\n                      </div>\n                      <button\n                        onClick={() => callbacks.OpenEntityRecord('Invoices', [{ FieldName: 'ID', Value: invoice.ID }])}\n                        style={{\n                          background: 'none',\n                          border: 'none',\n                          color: '#3B82F6',\n                          cursor: 'pointer',\n                          fontSize: '16px'\n                        }}\n                        title=\"Open Invoice\"\n                      >\n                        <i className=\"fa-solid fa-up-right-from-square\"></i>\n                      </button>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </div>\n          );\n          \n        case 'aging':\n          return (\n            <div>\n              <h3 style={{ margin: '0 0 16px 0' }}>{selectedData.label}</h3>\n              <div style={{ maxHeight: '500px', overflow: 'auto' }}>\n                {selectedData.invoices.map(invoice => (\n                  <div key={invoice.ID} style={{ \n                    padding: '12px', \n                    marginBottom: '8px', \n                    backgroundColor: '#F9FAFB', \n                    borderRadius: '6px',\n                    display: 'flex',\n                    justifyContent: 'space-between',\n                    alignItems: 'center'\n                  }}>\n                    <div>\n                      <div style={{ fontWeight: 'bold' }}>#{invoice.InvoiceNumber}</div>\n                      <div style={{ fontSize: '12px', color: '#6B7280' }}>\n                        Due: {new Date(invoice.DueDate).toLocaleDateString()}\n                        {new Date(invoice.DueDate) < new Date() && (\n                          <span style={{ color: '#EF4444', marginLeft: '8px' }}>\n                            ({Math.floor((new Date() - new Date(invoice.DueDate)) / (1000 * 60 * 60 * 24))} days overdue)\n                          </span>\n                        )}\n                      </div>\n                    </div>\n                    <div style={{ display: 'flex', gap: '12px', alignItems: 'center' }}>\n                      <div style={{ fontWeight: 'bold' }}>\n                        ${((invoice.TotalAmount || 0) / 1000).toFixed(1)}K\n                      </div>\n                      <button\n                        onClick={() => callbacks.OpenEntityRecord('Invoices', [{ FieldName: 'ID', Value: invoice.ID }])}\n                        style={{\n                          background: 'none',\n                          border: 'none',\n                          color: '#3B82F6',\n                          cursor: 'pointer',\n                          fontSize: '16px'\n                        }}\n                        title=\"Open Invoice\"\n                      >\n                        <i className=\"fa-solid fa-up-right-from-square\"></i>\n                      </button>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </div>\n          );\n          \n        case 'customer':\n          return (\n            <div>\n              <h3 style={{ margin: '0 0 16px 0' }}>{selectedData.name}</h3>\n              <div style={{ marginBottom: '16px', padding: '12px', backgroundColor: '#F9FAFB', borderRadius: '6px' }}>\n                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '8px' }}>\n                  <div>\n                    <div style={{ fontSize: '12px', color: '#6B7280' }}>Total Outstanding</div>\n                    <div style={{ fontSize: '20px', fontWeight: 'bold' }}>\n                      ${(selectedData.totalDue / 1000).toFixed(1)}K\n                    </div>\n                  </div>\n                  <div>\n                    <div style={{ fontSize: '12px', color: '#6B7280' }}>Overdue Amount</div>\n                    <div style={{ fontSize: '20px', fontWeight: 'bold', color: '#EF4444' }}>\n                      ${(selectedData.overdueAmount / 1000).toFixed(1)}K\n                    </div>\n                  </div>\n                </div>\n              </div>\n              \n              <h4 style={{ margin: '16px 0 8px 0', fontSize: '14px' }}>Outstanding Invoices</h4>\n              <div style={{ maxHeight: '400px', overflow: 'auto' }}>\n                {selectedData.invoices.map(invoice => (\n                  <div key={invoice.ID} style={{ \n                    padding: '12px', \n                    marginBottom: '8px', \n                    backgroundColor: '#F9FAFB', \n                    borderRadius: '6px',\n                    borderLeft: `3px solid ${new Date(invoice.DueDate) < new Date() ? '#EF4444' : '#3B82F6'}`\n                  }}>\n                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\n                      <div>\n                        <div style={{ fontWeight: 'bold' }}>Invoice #{invoice.InvoiceNumber}</div>\n                        <div style={{ fontSize: '12px', color: '#6B7280' }}>\n                          Due: {new Date(invoice.DueDate).toLocaleDateString()}\n                          {new Date(invoice.DueDate) < new Date() && (\n                            <span style={{ color: '#EF4444', marginLeft: '8px' }}>\n                              ({Math.floor((new Date() - new Date(invoice.DueDate)) / (1000 * 60 * 60 * 24))} days overdue)\n                            </span>\n                          )}\n                        </div>\n                      </div>\n                      <div style={{ display: 'flex', gap: '12px', alignItems: 'center' }}>\n                        <div>\n                          <div style={{ fontSize: '11px', color: '#6B7280' }}>Outstanding</div>\n                          <div style={{ fontWeight: 'bold' }}>\n                            ${(invoice.outstanding / 1000).toFixed(1)}K\n                          </div>\n                        </div>\n                        <button\n                          onClick={() => callbacks.OpenEntityRecord('Invoices', [{ FieldName: 'ID', Value: invoice.ID }])}\n                          style={{\n                            background: 'none',\n                            border: 'none',\n                            color: '#3B82F6',\n                            cursor: 'pointer',\n                            fontSize: '16px'\n                          }}\n                          title=\"Open Invoice\"\n                        >\n                          <i className=\"fa-solid fa-up-right-from-square\"></i>\n                        </button>\n                      </div>\n                    </div>\n                    {invoice.paidAmount > 0 && (\n                      <div style={{ marginTop: '8px', fontSize: '11px', color: '#059669' }}>\n                        Partial payment: ${(invoice.paidAmount / 1000).toFixed(1)}K paid\n                      </div>\n                    )}\n                  </div>\n                ))}\n              </div>\n            </div>\n          );\n          \n        default:\n          return null;\n      }\n    };\n    \n    return (\n      <div\n        style={{\n          backgroundColor: 'white',\n          borderRadius: '8px',\n          border: '1px solid #E5E7EB',\n          overflow: 'hidden',\n          boxShadow: '0 4px 6px rgba(0, 0, 0, 0.1)'\n        }}\n      >\n        <div style={{\n          padding: '16px',\n          borderBottom: '1px solid #E5E7EB',\n          background: 'linear-gradient(135deg, #3B82F6, #2563EB)',\n          color: 'white',\n          display: 'flex',\n          justifyContent: 'space-between',\n          alignItems: 'center'\n        }}>\n          <h3 style={{ margin: 0, fontSize: '16px' }}>\n            {drillDownType === 'status' ? `${selectedData} Invoices` : \n             drillDownType === 'aging' ? selectedData.label :\n             'Customer Details'}\n          </h3>\n          <button\n            onClick={closeDrillDown}\n            style={{\n              background: 'rgba(255,255,255,0.2)',\n              border: 'none',\n              color: 'white',\n              fontSize: '20px',\n              cursor: 'pointer',\n              padding: '4px 10px',\n              borderRadius: '4px',\n              transition: 'background 0.2s',\n              lineHeight: '1'\n            }}\n            onMouseEnter={(e) => e.currentTarget.style.background = 'rgba(255,255,255,0.3)'}\n            onMouseLeave={(e) => e.currentTarget.style.background = 'rgba(255,255,255,0.2)'}\n          >\n            Ã—\n          </button>\n        </div>\n        \n        <div style={{ maxHeight: '400px', overflow: 'auto', padding: '16px' }}>\n          {renderContent()}\n        </div>\n      </div>\n    );\n  };\n\n  if (loading) {\n    return (\n      <div style={{ padding: '40px', textAlign: 'center' }}>\n        <div style={{ fontSize: '18px', color: '#6B7280' }}>Loading invoice data...</div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div style={{ padding: '40px', textAlign: 'center' }}>\n        <div style={{ fontSize: '18px', color: '#EF4444' }}>Error: {error}</div>\n      </div>\n    );\n  }\n\n  // metrics is already calculated via useMemo above\n\n  return (\n    <div style={{ padding: '20px', backgroundColor: '#F3F4F6', minHeight: '100%' }}>\n      <style>{`\n        @media (max-width: 1024px) {\n          .invoice-charts {\n            grid-template-columns: 1fr !important;\n          }\n        }\n        @keyframes slideDown {\n          from {\n            opacity: 0;\n            max-height: 0;\n          }\n          to {\n            opacity: 1;\n            max-height: 800px;\n          }\n        }\n      `}</style>\n      \n      <div style={{ marginBottom: '20px', display: 'flex', justifyContent: 'space-between', alignItems: 'center', flexWrap: 'wrap', gap: '12px' }}>\n        <h2 style={{ margin: 0, fontSize: '24px', fontWeight: 'bold' }}>Invoice Status Dashboard</h2>\n        <div style={{ display: 'flex', gap: '8px', alignItems: 'center' }}>\n          <select\n            value={timePeriod}\n            onChange={(e) => {\n              const newPeriod = e.target.value;\n              setTimePeriod(newPeriod);\n              if (newPeriod !== 'custom') {\n                setStartDate(null);\n                setEndDate(null);\n                onSaveUserSettings({ \n                  ...savedUserSettings, \n                  timePeriod: newPeriod,\n                  startDate: null,\n                  endDate: null\n                });\n              } else {\n                onSaveUserSettings({ ...savedUserSettings, timePeriod: newPeriod });\n              }\n            }}\n            style={{\n              padding: '6px 12px',\n              border: '1px solid #D1D5DB',\n              borderRadius: '6px',\n              backgroundColor: 'white',\n              cursor: 'pointer'\n            }}\n          >\n            <option value=\"all\">All Time</option>\n            <option value=\"month\">This Month</option>\n            <option value=\"lastMonth\">Last Month</option>\n            <option value=\"quarter\">This Quarter</option>\n            <option value=\"lastQuarter\">Last Quarter</option>\n            <option value=\"year\">This Year</option>\n            <option value=\"lastYear\">Last Year</option>\n            <option value=\"custom\">Custom Range</option>\n          </select>\n          \n          {timePeriod === 'custom' && (\n            <>\n              <input\n                type=\"date\"\n                value={startDate || ''}\n                onChange={(e) => {\n                  setStartDate(e.target.value);\n                  if (e.target.value && endDate) {\n                    onSaveUserSettings({ \n                      ...savedUserSettings, \n                      startDate: e.target.value,\n                      endDate,\n                      timePeriod: 'custom'\n                    });\n                  }\n                }}\n                style={{\n                  padding: '6px 12px',\n                  border: '1px solid #D1D5DB',\n                  borderRadius: '6px',\n                  backgroundColor: 'white'\n                }}\n              />\n              <span style={{ color: '#6B7280', fontSize: '14px' }}>to</span>\n              <input\n                type=\"date\"\n                value={endDate || ''}\n                onChange={(e) => {\n                  setEndDate(e.target.value);\n                  if (startDate && e.target.value) {\n                    onSaveUserSettings({ \n                      ...savedUserSettings, \n                      startDate,\n                      endDate: e.target.value,\n                      timePeriod: 'custom'\n                    });\n                  }\n                }}\n                style={{\n                  padding: '6px 12px',\n                  border: '1px solid #D1D5DB',\n                  borderRadius: '6px',\n                  backgroundColor: 'white'\n                }}\n              />\n            </>\n          )}\n          \n          {/* Export Button */}\n          {DataExportPanel && (\n            <DataExportPanel\n              key=\"export-panel\"  // Add stable key\n              data={prepareExportData}\n              columns={getExportColumns}\n              filename={`invoice-status-dashboard-${new Date().toISOString().split('T')[0]}`}\n              formats={['csv', 'excel', 'pdf']}\n              buttonStyle=\"dropdown\"\n              buttonText=\"Export\"\n              icon=\"fa-download\"\n              customStyles={{\n                button: {\n                  padding: '6px 12px',\n                  backgroundColor: '#10B981',\n                  color: 'white',\n                  border: 'none',\n                  borderRadius: '6px',\n                  cursor: 'pointer',\n                  fontSize: '14px',\n                  display: 'inline-flex',\n                  alignItems: 'center',\n                  gap: '8px'\n                }\n              }}\n              utilities={utilities}\n              styles={styles}\n              components={components}\n              callbacks={callbacks}\n            />\n          )}\n\n          {/* AI Insights Button */}\n          <button\n            onClick={generateAIInsights}\n            disabled={loadingInsights || loading}\n            style={{\n              padding: '6px 12px',\n              backgroundColor: '#3B82F6',\n              color: 'white',\n              border: 'none',\n              borderRadius: '6px',\n              cursor: loadingInsights || loading ? 'not-allowed' : 'pointer',\n              display: 'flex',\n              alignItems: 'center',\n              gap: '8px',\n              opacity: loadingInsights || loading ? 0.6 : 1\n            }}\n          >\n            <i className={`fa-solid fa-${loadingInsights ? 'spinner fa-spin' : 'wand-magic-sparkles'}`}></i>\n            {loadingInsights ? 'Analyzing...' : 'Get AI Insights'}\n          </button>\n        </div>\n      </div>\n      \n      {/* AI Insights Panel */}\n      <AIInsightsPanel\n        utilities={utilities}\n        styles={styles}\n        components={components}\n        callbacks={callbacks}\n        savedUserSettings={savedUserSettings?.aiInsights}\n        onSaveUserSettings={(settings) => onSaveUserSettings?.({\n          ...savedUserSettings,\n          aiInsights: settings\n        })}\n        insights={aiInsights}\n        loading={loadingInsights}\n        error={insightsError}\n        onGenerate={generateAIInsights}\n        title=\"Invoice Analytics Insights\"\n        icon=\"fa-wand-magic-sparkles\"\n        iconColor={styles?.colors?.primary || '#8B5CF6'}\n        position=\"top\"\n        onClose={() => {\n          setAiInsights(null);\n          setInsightsError(null);\n        }}\n      />\n      \n      {/* Top Metrics Cards - Side by Side */}\n      <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(180px, 1fr))', gap: '16px', marginBottom: '20px' }}>\n        <div \n          style={{ \n            padding: '16px', \n            backgroundColor: 'white', \n            borderRadius: '8px',\n            cursor: 'pointer',\n            transition: 'all 0.2s'\n          }}\n          onClick={() => openDrillDown('status', 'Overdue')}\n          onMouseEnter={(e) => e.currentTarget.style.boxShadow = '0 4px 6px rgba(0,0,0,0.1)'}\n          onMouseLeave={(e) => e.currentTarget.style.boxShadow = 'none'}\n        >\n          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\n            <div>\n              <div style={{ fontSize: '12px', color: '#6B7280', marginBottom: '4px' }}>Overdue</div>\n              <div style={{ fontSize: '24px', fontWeight: 'bold', color: '#EF4444' }}>\n                {metrics.overdue}\n              </div>\n              <div style={{ fontSize: '12px', color: '#6B7280' }}>\n                ${(metrics.overdueAmount / 1000).toFixed(1)}K\n              </div>\n            </div>\n            <div style={{ fontSize: '32px', color: '#FEE2E2' }}>\n              <i className=\"fa-solid fa-exclamation-circle\"></i>\n            </div>\n          </div>\n        </div>\n        \n        <div \n          style={{ \n            padding: '16px', \n            backgroundColor: 'white', \n            borderRadius: '8px',\n            cursor: 'pointer',\n            transition: 'all 0.2s'\n          }}\n          onClick={() => openDrillDown('status', 'Pending')}\n          onMouseEnter={(e) => e.currentTarget.style.boxShadow = '0 4px 6px rgba(0,0,0,0.1)'}\n          onMouseLeave={(e) => e.currentTarget.style.boxShadow = 'none'}\n        >\n          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\n            <div>\n              <div style={{ fontSize: '12px', color: '#6B7280', marginBottom: '4px' }}>Pending</div>\n              <div style={{ fontSize: '24px', fontWeight: 'bold', color: '#3B82F6' }}>\n                {metrics.pending}\n              </div>\n              <div style={{ fontSize: '12px', color: '#6B7280' }}>\n                ${(metrics.pendingAmount / 1000).toFixed(1)}K\n              </div>\n            </div>\n            <div style={{ fontSize: '32px', color: '#DBEAFE' }}>\n              <i className=\"fa-solid fa-clock\"></i>\n            </div>\n          </div>\n        </div>\n        \n        <div \n          style={{ \n            padding: '16px', \n            backgroundColor: 'white', \n            borderRadius: '8px',\n            cursor: 'pointer',\n            transition: 'all 0.2s'\n          }}\n          onClick={() => openDrillDown('status', 'Partial')}\n          onMouseEnter={(e) => e.currentTarget.style.boxShadow = '0 4px 6px rgba(0,0,0,0.1)'}\n          onMouseLeave={(e) => e.currentTarget.style.boxShadow = 'none'}\n        >\n          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\n            <div>\n              <div style={{ fontSize: '12px', color: '#6B7280', marginBottom: '4px' }}>Partial</div>\n              <div style={{ fontSize: '24px', fontWeight: 'bold', color: '#F59E0B' }}>\n                {metrics.partial}\n              </div>\n              <div style={{ fontSize: '12px', color: '#6B7280' }}>\n                ${(metrics.partialAmount / 1000).toFixed(1)}K\n              </div>\n            </div>\n            <div style={{ fontSize: '32px', color: '#FEF3C7' }}>\n              <i className=\"fa-solid fa-chart-pie\"></i>\n            </div>\n          </div>\n        </div>\n        \n        <div \n          style={{ \n            padding: '16px', \n            backgroundColor: 'white', \n            borderRadius: '8px',\n            cursor: 'pointer',\n            transition: 'all 0.2s'\n          }}\n          onClick={() => openDrillDown('status', 'Paid')}\n          onMouseEnter={(e) => e.currentTarget.style.boxShadow = '0 4px 6px rgba(0,0,0,0.1)'}\n          onMouseLeave={(e) => e.currentTarget.style.boxShadow = 'none'}\n        >\n          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\n            <div>\n              <div style={{ fontSize: '12px', color: '#6B7280', marginBottom: '4px' }}>Paid</div>\n              <div style={{ fontSize: '24px', fontWeight: 'bold', color: '#10B981' }}>\n                {metrics.paid}\n              </div>\n              <div style={{ fontSize: '12px', color: '#6B7280' }}>\n                ${(metrics.paidAmount / 1000).toFixed(1)}K\n              </div>\n            </div>\n            <div style={{ fontSize: '32px', color: '#D1FAE5' }}>\n              <i className=\"fa-solid fa-check-circle\"></i>\n            </div>\n          </div>\n        </div>\n        \n        <div style={{ padding: '16px', backgroundColor: 'white', borderRadius: '8px' }}>\n          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\n            <div>\n              <div style={{ fontSize: '12px', color: '#6B7280', marginBottom: '4px' }}>Total</div>\n              <div style={{ fontSize: '24px', fontWeight: 'bold', color: '#6B7280' }}>\n                {metrics.total}\n              </div>\n              <div style={{ fontSize: '12px', color: '#6B7280' }}>\n                ${(metrics.totalAmount / 1000).toFixed(1)}K\n              </div>\n            </div>\n            <div style={{ fontSize: '32px', color: '#E5E7EB' }}>\n              <i className=\"fa-solid fa-file-invoice-dollar\"></i>\n            </div>\n          </div>\n        </div>\n      </div>\n      \n      {/* Charts Row - Side by Side, wider overall */}\n      <div className=\"invoice-charts\" style={{ display: 'grid', gridTemplateColumns: '3fr 2fr', gap: '20px', marginBottom: '20px' }}>\n        <div style={{ backgroundColor: 'white', borderRadius: '8px', padding: '16px' }}>\n          <h3 style={{ margin: '0 0 16px 0', fontSize: '18px' }}>Status Distribution</h3>\n          <div style={{ height: '280px' }}>\n            <canvas ref={statusChartRef} />\n          </div>\n        </div>\n        \n        <div style={{ backgroundColor: 'white', borderRadius: '8px', padding: '16px' }}>\n          <h3 style={{ margin: '0 0 16px 0', fontSize: '18px' }}>Payment Due Timeline</h3>\n          <div style={{ height: '280px' }}>\n            <canvas ref={agingChartRef} />\n          </div>\n        </div>\n      </div>\n      \n      {/* Customer Balances */}\n      <CustomerBalances />\n      \n      {/* Drill-down Panel - below all content */}\n      {isPanelOpen && (\n        <div style={{ \n          marginTop: '20px',\n          animation: 'slideDown 0.3s ease',\n          overflow: 'hidden'\n        }}>\n          <DrillDownPanel />\n        </div>\n      )}\n      \n    </div>\n  );\n}",
  "functionalRequirements": "## Invoice Status Dashboard\n\n### Purpose\nTrack invoice statuses, payment timelines, and accounts receivable aging with actionable insights.\n\n### Core Features\n- **Status Overview**: Pie chart of invoice statuses\n- **Aging Analysis**: Outstanding invoice aging buckets\n- **Payment Timeline**: Calendar view of due dates\n- **Customer Balance**: Top debtors and credit risks\n- **Collection Metrics**: DSO and collection efficiency\n- **Interactive Charts**: Using Plotly for rich visuals\n- **Slide-out Actions**: Quick actions for overdue invoices\n- **Card/List Views**: Multiple display options\n\n### Visualizations\n- Donut chart for status distribution\n- Waterfall chart for cash flow\n- Heatmap calendar for due dates\n- Bar charts for aging analysis",
  "dataRequirements": {
    "mode": "views",
    "entities": [
      {
        "name": "Invoices",
        "displayFields": [
          "InvoiceNumber",
          "AccountID",
          "InvoiceDate",
          "DueDate",
          "TotalAmount",
          "Status",
          "PaidAmount"
        ],
        "filterFields": [
          "Status",
          "DueDate",
          "AccountID"
        ],
        "sortFields": [
          "DueDate",
          "TotalAmount"
        ]
      },
      {
        "name": "Payments",
        "displayFields": [
          "InvoiceID",
          "PaymentDate",
          "Amount",
          "PaymentMethod"
        ],
        "filterFields": [
          "PaymentDate",
          "InvoiceID"
        ],
        "sortFields": [
          "PaymentDate"
        ]
      }
    ]
  },
  "technicalDesign": "## Implementation\n\n### Components\n- Main: InvoiceStatusDashboard\n- Sub-components:\n  - StatusOverview: Pie chart summary\n  - AgingChart: Aging buckets visualization\n  - PaymentCalendar: Due date heatmap\n  - CustomerBalances: Top debtor list\n  - ActionPanel: Quick actions slide-out\n\n### Calculations\n- Days Sales Outstanding (DSO)\n- Aging buckets (0-30, 31-60, 61-90, 90+)\n- Collection rate trends\n- Average payment time",
  "properties": [],
  "events": [
    {
      "name": "OpenEntityRecord",
      "description": "Navigate to invoice details"
    }
  ],
  "dependencies": [
    {
      "name": "AIInsightsPanel",
      "location": "registry",
      "namespace": "Generic/UI/AI",
      "version": "^1.0.0"
    },
    {
      "name": "DataExportPanel",
      "location": "registry",
      "namespace": "Generic/UI/Export",
      "version": "^1.0.0"
    }
  ],
  "libraries": [
    {
      "name": "Plotly",
      "version": "^2.27.1",
      "globalVariable": "Plotly"
    },
    {
      "name": "accounting",
      "version": "^0.4.1",
      "globalVariable": "accounting"
    },
    {
      "name": "Chart.js",
      "version": "^4.4.1",
      "globalVariable": "Chart"
    }
  ]
}
