SELECT mt.Name AS MembershipType, COUNT(m.ID) AS TotalMemberships, SUM(CASE WHEN m.Status = 'Active' OR m.RenewalDate IS NOT NULL THEN 1 ELSE 0 END) AS RenewedCount, SUM(CASE WHEN m.Status = 'Lapsed' THEN 1 ELSE 0 END) AS LapsedCount, SUM(CASE WHEN m.Status = 'Cancelled' THEN 1 ELSE 0 END) AS CancelledCount, SUM(CASE WHEN m.Status IN ('Active', 'Lapsed', 'Cancelled') THEN 1 ELSE 0 END) AS ReachedRenewalPeriod FROM [AssociationDemo].[vwMemberships] m INNER JOIN [AssociationDemo].[vwMembershipTypes] mt ON m.MembershipTypeID = mt.ID WHERE m.EndDate <= {{ asOfDate | sqlDate }} GROUP BY mt.Name ORDER BY TotalMemberships DESC