SELECT c.ID, c.Name AS ChapterName, c.ChapterType, c.Region, c.City, c.State, c.MeetingFrequency, COUNT(cm.ID) AS ActiveMemberCount, c.FoundedDate, c.Website, c.Email FROM [AssociationDemo].[vwChapters] c INNER JOIN [AssociationDemo].[vwChapterMemberships] cm ON c.ID = cm.ChapterID WHERE cm.Status = 'Active' {% if MinMemberCount %}AND (SELECT COUNT(*) FROM [AssociationDemo].[vwChapterMemberships] WHERE ChapterID = c.ID AND Status = 'Active') >= {{ MinMemberCount | sqlNumber }}{% endif %} GROUP BY c.ID, c.Name, c.ChapterType, c.Region, c.City, c.State, c.MeetingFrequency, c.FoundedDate, c.Website, c.Email ORDER BY ActiveMemberCount DESC