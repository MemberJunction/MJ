SELECT TOP (@TopN) m.ID, m.FirstName, m.LastName, m.Email, SUM(ce.CreditsEarned) AS TotalCECredits, COUNT(DISTINCT c.ID) AS ActiveCertificationCount, COUNT(ce.ID) AS CEActivityCount, MIN(ce.CompletionDate) AS EarliestCEDate, MAX(ce.CompletionDate) AS LatestCEDate FROM [AssociationDemo].[vwCertifications] c INNER JOIN [AssociationDemo].[vwContinuingEducations] ce ON c.ID = ce.CertificationID INNER JOIN [AssociationDemo].[vwMembers] m ON c.MemberID = m.ID WHERE c.Status = 'Active' {% if MinCredits %}AND ce.CreditsEarned >= {{ MinCredits | sqlNumber }}{% endif %} {% if StartDate %}AND ce.CompletionDate >= {{ StartDate | sqlDate }}{% endif %} {% if EndDate %}AND ce.CompletionDate <= {{ EndDate | sqlDate }}{% endif %} GROUP BY m.ID, m.FirstName, m.LastName, m.Email HAVING SUM(ce.CreditsEarned) > 0 ORDER BY TotalCECredits DESC