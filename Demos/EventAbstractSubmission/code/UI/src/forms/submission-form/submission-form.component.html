<div class="modern-submission-form">
  <!-- Header with Progress -->
  <div class="form-header">
    <div class="header-content">
      <div class="header-text">
        <h1 class="form-title">
          <span class="title-icon">📝</span>
          {{ isEditing ? 'Edit Submission' : 'Create New Submission' }}
        </h1>
        <p class="form-subtitle">
          {{ isEditing ? 'Update your abstract submission details' : 'Share your expertise with the community' }}
        </p>
      </div>
      <div class="progress-indicator">
        <div class="progress-circle">
          <svg width="60" height="60">
            <circle cx="30" cy="30" r="25" stroke="#e0e0e0" stroke-width="5" fill="none"/>
            <circle cx="30" cy="30" r="25" stroke="#3b82f6" stroke-width="5" fill="none"
                    attr.stroke-dasharray="157" 
                    attr.stroke-dashoffset="{{157 - (157 * formProgress / 100)}}"
                    transform="rotate(-90 30 30)"/>
          </svg>
          <div class="progress-text">{{ formProgress }}%</div>
        </div>
        <div class="progress-label">Complete</div>
      </div>
    </div>
  </div>

  <form [formGroup]="submissionForm" class="submission-form">
    
    <!-- Basic Information Section -->
    <div class="form-section" [class.expanded]="expandedSections.basic">
      <div class="section-header" (click)="toggleSection('basic')">
        <div class="section-info">
          <span class="section-icon">🎯</span>
          <h3 class="section-title">Basic Information</h3>
          <span class="section-description">Title and format of your submission</span>
        </div>
        <div class="section-toggle">
          <span class="toggle-icon" [class.rotated]="expandedSections.basic">▼</span>
        </div>
      </div>
      
      <div class="section-content" [@slideToggle]="expandedSections.basic ? 'open' : 'closed'">
        <div class="form-grid">
          <!-- Title -->
          <div class="form-field full-width">
            <label class="field-label">Submission Title *</label>
            <input kendoTextBox
                   formControlName="SubmissionTitle" 
                   placeholder="Give your submission a compelling title"
                   class="modern-input">
            <div class="field-hint">Make it catchy and descriptive</div>
            <div class="error-message" *ngIf="hasError('SubmissionTitle', 'required')">
              Title is required
            </div>
            <div class="error-message" *ngIf="hasError('SubmissionTitle', 'maxlength')">
              {{ getErrorMessage('SubmissionTitle') }}
            </div>
          </div>

          <!-- Session Format -->
          <div class="form-field full-width">
            <label class="field-label">Session Format *</label>
            <div class="format-grid">
              <div class="format-option" 
                   *ngFor="let format of sessionFormats"
                   [class.selected]="submissionForm.get('SessionFormat')?.value === format.value"
                   (click)="submissionForm.get('SessionFormat')?.setValue(format.value)">
                <div class="format-icon">{{ format.icon }}</div>
                <div class="format-info">
                  <div class="format-name">{{ format.label }}</div>
                  <div class="format-desc">{{ format.description }}</div>
                </div>
              </div>
            </div>
            <div class="error-message" *ngIf="hasError('SessionFormat', 'required')">
              Please select a session format
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Content Section with Tabs -->
    <div class="form-section" [class.expanded]="expandedSections.content">
      <div class="section-header" (click)="toggleSection('content')">
        <div class="section-info">
          <span class="section-icon">📄</span>
          <h3 class="section-title">Content</h3>
          <span class="section-description">Abstract and learning objectives</span>
        </div>
        <div class="section-toggle">
          <span class="toggle-icon" [class.rotated]="expandedSections.content">▼</span>
        </div>
      </div>
      
      <div class="section-content" [@slideToggle]="expandedSections.content ? 'open' : 'closed'">
        <!-- Tab Navigation -->
        <div class="tab-navigation">
          <div class="tab-item" 
               [class.active]="activeContentTab === 'abstract'"
               (click)="activeContentTab = 'abstract'">
            <span class="tab-icon">📝</span>
            Abstract
          </div>
          <div class="tab-item" 
               [class.active]="activeContentTab === 'objectives'"
               (click)="activeContentTab = 'objectives'">
            <span class="tab-icon">🎯</span>
            Learning Objectives
          </div>
        </div>

        <!-- Tab Content -->
        <div class="tab-content">
          <!-- Abstract Tab -->
          <div class="tab-pane" [class.active]="activeContentTab === 'abstract'">
            <div class="markdown-editor">
              <div class="editor-header">
                <div class="editor-title">Abstract *</div>
                <div class="editor-toolbar">
                  <button type="button" 
                          class="toolbar-btn"
                          [class.active]="!abstractPreview"
                          (click)="abstractPreview = false">
                    <span class="btn-icon">✏️</span>
                    Edit
                  </button>
                  <button type="button" 
                          class="toolbar-btn"
                          [class.active]="abstractPreview"
                          (click)="abstractPreview = true">
                    <span class="btn-icon">👁️</span>
                    Preview
                  </button>
                </div>
              </div>
              
              <div class="editor-content" [class.preview-mode]="abstractPreview">
                <textarea kendoTextArea
                          formControlName="SubmissionAbstract" 
                          placeholder="## What's your session about?

### Key Takeaways
- Point 1
- Point 2
- Point 3

### Target Audience
Who will benefit most from this session?

### Prerequisites
What should attendees know beforehand?

**Pro tip:** Use markdown formatting to make your abstract more readable!"
                          [rows]="12"
                          class="markdown-textarea"
                          *ngIf="!abstractPreview">
                </textarea>
                
                <div class="markdown-preview" 
                     [innerHTML]="markdownToHtml(submissionForm.get('SubmissionAbstract')?.value || '')"
                     *ngIf="abstractPreview">
                </div>
              </div>
              
              <div class="editor-footer">
                <div class="word-count">
                  {{ getAbstractWordCount() }} words • {{ getAbstractCharacterCount() }} characters
                </div>
                <div class="markdown-help">
                  <span class="help-text">💡 Supports **bold**, *italic*, `code`, ## headers, and lists</span>
                </div>
              </div>
            </div>
            
            <div class="error-message" *ngIf="hasError('SubmissionAbstract', 'required')">
              Abstract is required
            </div>
            <div class="error-message" *ngIf="hasError('SubmissionAbstract', 'minlength')">
              Abstract must be at least 100 words
            </div>
          </div>

          <!-- Learning Objectives Tab -->
          <div class="tab-pane" [class.active]="activeContentTab === 'objectives'">
            <div class="markdown-editor">
              <div class="editor-header">
                <div class="editor-title">Learning Objectives</div>
                <div class="editor-toolbar">
                  <button type="button" 
                          class="toolbar-btn"
                          [class.active]="!objectivesPreview"
                          (click)="objectivesPreview = false">
                    <span class="btn-icon">✏️</span>
                    Edit
                  </button>
                  <button type="button" 
                          class="toolbar-btn"
                          [class.active]="objectivesPreview"
                          (click)="objectivesPreview = true">
                    <span class="btn-icon">👁️</span>
                    Preview
                  </button>
                </div>
              </div>
              
              <div class="editor-content" [class.preview-mode]="objectivesPreview">
                <textarea kendoTextArea
                          formControlName="LearningObjectives" 
                          placeholder="## What will attendees learn?

After this session, participants will be able to:

- **Understand** key concepts and principles
- **Apply** practical techniques and methods
- **Implement** solutions in their own projects
- **Evaluate** different approaches and trade-offs

### Skill Level
- Beginner | Intermediate | Advanced

### Takeaway Materials
- Code samples and templates
- Documentation and resources
- Follow-up exercises"
                          [rows]="10"
                          class="markdown-textarea"
                          *ngIf="!objectivesPreview">
                </textarea>
                
                <div class="markdown-preview" 
                     [innerHTML]="markdownToHtml(submissionForm.get('LearningObjectives')?.value || '')"
                     *ngIf="objectivesPreview">
                </div>
              </div>
              
              <div class="editor-footer">
                <div class="markdown-help">
                  <span class="help-text">💡 Clearly articulate what participants will gain from your session</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Details Section -->
    <div class="form-section" [class.expanded]="expandedSections.details">
      <div class="section-header" (click)="toggleSection('details')">
        <div class="section-info">
          <span class="section-icon">👥</span>
          <h3 class="section-title">Audience Details</h3>
          <span class="section-description">Target audience and prerequisites</span>
        </div>
        <div class="section-toggle">
          <span class="toggle-icon" [class.rotated]="expandedSections.details">▼</span>
        </div>
      </div>
      
      <div class="section-content" [@slideToggle]="expandedSections.details ? 'open' : 'closed'">
        <div class="form-grid">
          <!-- Target Audience -->
          <div class="form-field">
            <label class="field-label">Target Audience</label>
            <textarea kendoTextArea
                      formControlName="TargetAudience" 
                      placeholder="Who is this session for? (e.g., developers, designers, product managers, skill level)"
                      [rows]="4"
                      class="modern-textarea">
            </textarea>
            <div class="field-hint">Be specific about who will benefit most</div>
          </div>

          <!-- Prerequisites -->
          <div class="form-field">
            <label class="field-label">Prerequisites</label>
            <textarea kendoTextArea
                      formControlName="Prerequisites" 
                      placeholder="What should attendees know or bring? (e.g., basic JavaScript, laptop with specific software)"
                      [rows]="4"
                      class="modern-textarea">
            </textarea>
            <div class="field-hint">List any required knowledge, tools, or preparation</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Additional Information Section -->
    <div class="form-section" [class.expanded]="expandedSections.additional">
      <div class="section-header" (click)="toggleSection('additional')">
        <div class="section-info">
          <span class="section-icon">🏷️</span>
          <h3 class="section-title">Additional Information</h3>
          <span class="section-description">Keywords and extra notes</span>
        </div>
        <div class="section-toggle">
          <span class="toggle-icon" [class.rotated]="expandedSections.additional">▼</span>
        </div>
      </div>
      
      <div class="section-content" [@slideToggle]="expandedSections.additional ? 'open' : 'closed'">
        <div class="form-grid">
          <!-- Keywords -->
          <div class="form-field">
            <label class="field-label">Keywords</label>
            <input kendoTextBox
                   formControlName="Keywords" 
                   placeholder="e.g., JavaScript, React, Performance, UX Design"
                   class="modern-input">
            <div class="field-hint">Separate with commas to help attendees find your session</div>
          </div>

          <!-- Additional Notes -->
          <div class="form-field">
            <label class="field-label">Additional Notes</label>
            <textarea kendoTextArea
                      formControlName="AdditionalNotes" 
                      placeholder="Any other information reviewers should know about your submission"
                      [rows]="3"
                      class="modern-textarea">
            </textarea>
            <div class="field-hint">Optional: special requirements, equipment needs, etc.</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Hidden fields -->
    <input type="hidden" formControlName="SpeakerID">
    <input type="hidden" formControlName="EventID">
    <input type="hidden" formControlName="Status">

  </form>

  <!-- Action Bar -->
  <div class="action-bar">
    <div class="action-content">
      <div class="action-left">
        <button kendoButton 
                type="button" 
                class="action-btn secondary"
                (click)="cancel()"
                [disabled]="isSaving">
          <span class="btn-icon">❌</span>
          Cancel
        </button>
      </div>
      
      <div class="action-right">
        <button kendoButton 
                type="button" 
                class="action-btn primary"
                (click)="saveSubmission()"
                [disabled]="isSaving || submissionForm.invalid">
          <span class="btn-icon" *ngIf="!isSaving">💾</span>
          <span class="btn-icon spinning" *ngIf="isSaving">⏳</span>
          {{ isSaving ? 'Saving...' : (isEditing ? 'Update' : 'Save Draft') }}
        </button>
        
        <button kendoButton 
                type="button" 
                class="action-btn accent"
                (click)="submitForReview()"
                [disabled]="isSaving || submissionForm.invalid">
          <span class="btn-icon" *ngIf="!isSaving">🚀</span>
          <span class="btn-icon spinning" *ngIf="isSaving">⏳</span>
          {{ isSaving ? 'Submitting...' : 'Submit for Review' }}
        </button>
      </div>
    </div>
  </div>
</div>
