-- ============================================================================
-- MemberJunction PostgreSQL Migration
-- Converted from SQL Server using TypeScript conversion pipeline
-- ============================================================================

-- Extensions
CREATE EXTENSION IF NOT EXISTS "pgcrypto";
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

-- Schema
CREATE SCHEMA IF NOT EXISTS __mj;
SET search_path TO __mj, public;

-- Ensure backslashes in string literals are treated literally (not as escape sequences)
SET standard_conforming_strings = on;

-- Implicit INTEGER -> BOOLEAN cast (SQL Server BIT columns accept 0/1 in INSERTs)
-- PostgreSQL has a built-in explicit-only INTEGER->bool cast. We upgrade it to implicit
-- so INSERT VALUES with 0/1 for BOOLEAN columns work like SQL Server BIT.
UPDATE pg_cast SET castcontext = 'i'
WHERE castsource = 'integer'::regtype AND casttarget = 'boolean'::regtype;


-- ===================== DDL: Tables, PKs, Indexes =====================


-- ===================== Helper Functions (fn*) =====================


-- ===================== Views =====================


-- ===================== Stored Procedures (sp*) =====================


-- ===================== Triggers =====================


-- ===================== Data (INSERT/UPDATE/DELETE) =====================

-- SQL Logging Session
-- Session ID: 717e34ae-6607-45c7-9320-3fc747302dfe
-- Started: 2026-02-24T19:32:59.080Z
-- Description: MetadataSync push operation
-- Format: Migration-ready with Flyway schema placeholders
-- Generated by MemberJunction SQLServerDataProvider

-- Save MJ: Actions (core SP call only)
DO $$
DECLARE
  p_ID_71fbd4f4 UUID;
  p_CategoryID_71fbd4f4 UUID;
  p_Name_71fbd4f4 VARCHAR(425);
  p_Description_71fbd4f4 TEXT;
  p_Type_71fbd4f4 VARCHAR(20);
  p_UserPrompt_71fbd4f4 TEXT;
  p_UserComments_71fbd4f4 TEXT;
  p_Code_71fbd4f4 TEXT;
  p_CodeComments_71fbd4f4 TEXT;
  p_CodeApprovalStatus_71fbd4f4 VARCHAR(20);
  p_CodeApprovalComments_71fbd4f4 TEXT;
  p_CodeApprovedByUserID_71fbd4f4 UUID;
  p_CodeApprovedAt_71fbd4f4 TIMESTAMPTZ;
  p_CodeLocked_71fbd4f4 BOOLEAN;
  p_ForceCodeGeneration_71fbd4f4 BOOLEAN;
  p_RetentionPeriod_71fbd4f4 INTEGER;
  p_Status_71fbd4f4 VARCHAR(20);
  p_DriverClass_71fbd4f4 VARCHAR(255);
  p_ParentID_71fbd4f4 UUID;
  p_IconClass_71fbd4f4 VARCHAR(100);
  p_DefaultCompactPromptID_71fbd4f4 UUID;
BEGIN
  p_ID_71fbd4f4 := '59B4E9C8-5408-480E-93EE-644B7EC197BB';
  p_CategoryID_71fbd4f4 := '75DD6103-E7B1-4B83-81C1-B5D135403344';
  p_Name_71fbd4f4 := 'Computer Use';
  p_Description_71fbd4f4 := 'Drives a web browser via LLM reasoning over screenshots to accomplish a natural-language goal. Uses a vision-to-action loop: captures screenshots, sends them to a controller LLM that plans browser actions (click, type, navigate, scroll), executes those actions via Playwright, and evaluates progress with a judge LLM. Supports per-domain authentication, domain allow/block lists, and configurable step limits.';
  p_Type_71fbd4f4 := 'Custom';
  p_CodeApprovalStatus_71fbd4f4 := 'Pending';
  p_CodeLocked_71fbd4f4 := 0;
  p_ForceCodeGeneration_71fbd4f4 := 0;
  p_Status_71fbd4f4 := 'Active';
  p_DriverClass_71fbd4f4 := 'Computer Use';
  p_IconClass_71fbd4f4 := 'fa-solid fa-desktop';
  PERFORM __mj."spCreateAction"(p_ID := p_ID_71fbd4f4, p_CategoryID := p_CategoryID_71fbd4f4, p_Name := p_Name_71fbd4f4, p_Description := p_Description_71fbd4f4, p_Type := p_Type_71fbd4f4, p_UserPrompt := p_UserPrompt_71fbd4f4, p_UserComments := p_UserComments_71fbd4f4, p_Code := p_Code_71fbd4f4, p_CodeComments := p_CodeComments_71fbd4f4, p_CodeApprovalStatus := p_CodeApprovalStatus_71fbd4f4, p_CodeApprovalComments := p_CodeApprovalComments_71fbd4f4, p_CodeApprovedByUserID := p_CodeApprovedByUserID_71fbd4f4, p_CodeApprovedAt := p_CodeApprovedAt_71fbd4f4, p_CodeLocked := p_CodeLocked_71fbd4f4, p_ForceCodeGeneration := p_ForceCodeGeneration_71fbd4f4, p_RetentionPeriod := p_RetentionPeriod_71fbd4f4, p_Status := p_Status_71fbd4f4, p_DriverClass := p_DriverClass_71fbd4f4, p_ParentID := p_ParentID_71fbd4f4, p_IconClass := p_IconClass_71fbd4f4, p_DefaultCompactPromptID := p_DefaultCompactPromptID_71fbd4f4);
END $$;

-- Save MJ: Action Params (core SP call only)
DO $$
DECLARE
  p_ID_f6e442dc UUID;
  p_ActionID_f6e442dc UUID;
  p_Name_f6e442dc VARCHAR(255);
  p_DefaultValue_f6e442dc TEXT;
  p_Type_f6e442dc CHAR(10);
  p_ValueType_f6e442dc VARCHAR(30);
  p_IsArray_f6e442dc BOOLEAN;
  p_Description_f6e442dc TEXT;
  p_IsRequired_f6e442dc BOOLEAN;
  p_MediaModality_f6e442dc VARCHAR(20);
BEGIN
  p_ID_f6e442dc := '5E66A1DE-E671-4D6E-84D7-B8A7927F9F6E';
  p_ActionID_f6e442dc := '59B4E9C8-5408-480E-93EE-644B7EC197BB';
  p_Name_f6e442dc := 'Goal';
  p_Type_f6e442dc := 'Input';
  p_ValueType_f6e442dc := 'Scalar';
  p_IsArray_f6e442dc := 0;
  p_Description_f6e442dc := 'Natural-language goal for the browser agent to accomplish. Example: ''Navigate to example.com and find the contact email address''.';
  p_IsRequired_f6e442dc := 1;
  PERFORM __mj."spCreateActionParam"(p_ID := p_ID_f6e442dc, p_ActionID := p_ActionID_f6e442dc, p_Name := p_Name_f6e442dc, p_DefaultValue := p_DefaultValue_f6e442dc, p_Type := p_Type_f6e442dc, p_ValueType := p_ValueType_f6e442dc, p_IsArray := p_IsArray_f6e442dc, p_Description := p_Description_f6e442dc, p_IsRequired := p_IsRequired_f6e442dc, p_MediaModality := p_MediaModality_f6e442dc);
END $$;

-- Save MJ: Action Params (core SP call only)
DO $$
DECLARE
  p_ID_8a8c33f5 UUID;
  p_ActionID_8a8c33f5 UUID;
  p_Name_8a8c33f5 VARCHAR(255);
  p_DefaultValue_8a8c33f5 TEXT;
  p_Type_8a8c33f5 CHAR(10);
  p_ValueType_8a8c33f5 VARCHAR(30);
  p_IsArray_8a8c33f5 BOOLEAN;
  p_Description_8a8c33f5 TEXT;
  p_IsRequired_8a8c33f5 BOOLEAN;
  p_MediaModality_8a8c33f5 VARCHAR(20);
BEGIN
  p_ID_8a8c33f5 := 'EDB44D87-C83C-440C-B93E-41D05DBF0288';
  p_ActionID_8a8c33f5 := '59B4E9C8-5408-480E-93EE-644B7EC197BB';
  p_Name_8a8c33f5 := 'StartUrl';
  p_Type_8a8c33f5 := 'Input';
  p_ValueType_8a8c33f5 := 'Scalar';
  p_IsArray_8a8c33f5 := 0;
  p_Description_8a8c33f5 := 'Starting URL for the browser to navigate to before beginning the goal. If not provided, the controller LLM will decide where to start.';
  p_IsRequired_8a8c33f5 := 0;
  PERFORM __mj."spCreateActionParam"(p_ID := p_ID_8a8c33f5, p_ActionID := p_ActionID_8a8c33f5, p_Name := p_Name_8a8c33f5, p_DefaultValue := p_DefaultValue_8a8c33f5, p_Type := p_Type_8a8c33f5, p_ValueType := p_ValueType_8a8c33f5, p_IsArray := p_IsArray_8a8c33f5, p_Description := p_Description_8a8c33f5, p_IsRequired := p_IsRequired_8a8c33f5, p_MediaModality := p_MediaModality_8a8c33f5);
END $$;

-- Save MJ: Action Params (core SP call only)
DO $$
DECLARE
  p_ID_f5e389ed UUID;
  p_ActionID_f5e389ed UUID;
  p_Name_f5e389ed VARCHAR(255);
  p_DefaultValue_f5e389ed TEXT;
  p_Type_f5e389ed CHAR(10);
  p_ValueType_f5e389ed VARCHAR(30);
  p_IsArray_f5e389ed BOOLEAN;
  p_Description_f5e389ed TEXT;
  p_IsRequired_f5e389ed BOOLEAN;
  p_MediaModality_f5e389ed VARCHAR(20);
BEGIN
  p_ID_f5e389ed := '924528A3-2918-4644-889A-967135B2E2BF';
  p_ActionID_f5e389ed := '59B4E9C8-5408-480E-93EE-644B7EC197BB';
  p_Name_f5e389ed := 'Headless';
  p_DefaultValue_f5e389ed := 'true';
  p_Type_f5e389ed := 'Input';
  p_ValueType_f5e389ed := 'Scalar';
  p_IsArray_f5e389ed := 0;
  p_Description_f5e389ed := 'Whether to run the browser in headless mode. Set to ''false'' to see the browser window during execution. Default: ''true''.';
  p_IsRequired_f5e389ed := 0;
  PERFORM __mj."spCreateActionParam"(p_ID := p_ID_f5e389ed, p_ActionID := p_ActionID_f5e389ed, p_Name := p_Name_f5e389ed, p_DefaultValue := p_DefaultValue_f5e389ed, p_Type := p_Type_f5e389ed, p_ValueType := p_ValueType_f5e389ed, p_IsArray := p_IsArray_f5e389ed, p_Description := p_Description_f5e389ed, p_IsRequired := p_IsRequired_f5e389ed, p_MediaModality := p_MediaModality_f5e389ed);
END $$;

-- Save MJ: Action Params (core SP call only)
DO $$
DECLARE
  p_ID_1721b59d UUID;
  p_ActionID_1721b59d UUID;
  p_Name_1721b59d VARCHAR(255);
  p_DefaultValue_1721b59d TEXT;
  p_Type_1721b59d CHAR(10);
  p_ValueType_1721b59d VARCHAR(30);
  p_IsArray_1721b59d BOOLEAN;
  p_Description_1721b59d TEXT;
  p_IsRequired_1721b59d BOOLEAN;
  p_MediaModality_1721b59d VARCHAR(20);
BEGIN
  p_ID_1721b59d := '4D5BD44D-F278-4FEC-96DE-9EF57961B7C5';
  p_ActionID_1721b59d := '59B4E9C8-5408-480E-93EE-644B7EC197BB';
  p_Name_1721b59d := 'AllowedDomains';
  p_Type_1721b59d := 'Input';
  p_ValueType_1721b59d := 'Scalar';
  p_IsArray_1721b59d := 0;
  p_Description_1721b59d := 'Comma-delimited list of domains the browser is allowed to visit. If set, all other domains are blocked. Supports wildcards (e.g., ''*.example.com''). Example: ''example.com, *.example.com''.';
  p_IsRequired_1721b59d := 0;
  PERFORM __mj."spCreateActionParam"(p_ID := p_ID_1721b59d, p_ActionID := p_ActionID_1721b59d, p_Name := p_Name_1721b59d, p_DefaultValue := p_DefaultValue_1721b59d, p_Type := p_Type_1721b59d, p_ValueType := p_ValueType_1721b59d, p_IsArray := p_IsArray_1721b59d, p_Description := p_Description_1721b59d, p_IsRequired := p_IsRequired_1721b59d, p_MediaModality := p_MediaModality_1721b59d);
END $$;

-- Save MJ: Action Params (core SP call only)
DO $$
DECLARE
  p_ID_ce858baa UUID;
  p_ActionID_ce858baa UUID;
  p_Name_ce858baa VARCHAR(255);
  p_DefaultValue_ce858baa TEXT;
  p_Type_ce858baa CHAR(10);
  p_ValueType_ce858baa VARCHAR(30);
  p_IsArray_ce858baa BOOLEAN;
  p_Description_ce858baa TEXT;
  p_IsRequired_ce858baa BOOLEAN;
  p_MediaModality_ce858baa VARCHAR(20);
BEGIN
  p_ID_ce858baa := 'B7071B7A-A804-4C71-A861-032E3829AFEF';
  p_ActionID_ce858baa := '59B4E9C8-5408-480E-93EE-644B7EC197BB';
  p_Name_ce858baa := 'BlockedDomains';
  p_Type_ce858baa := 'Input';
  p_ValueType_ce858baa := 'Scalar';
  p_IsArray_ce858baa := 0;
  p_Description_ce858baa := 'Comma-delimited list of domains explicitly blocked. BlockedDomains always takes precedence over AllowedDomains. Example: ''ads.example.com, tracker.example.com''.';
  p_IsRequired_ce858baa := 0;
  PERFORM __mj."spCreateActionParam"(p_ID := p_ID_ce858baa, p_ActionID := p_ActionID_ce858baa, p_Name := p_Name_ce858baa, p_DefaultValue := p_DefaultValue_ce858baa, p_Type := p_Type_ce858baa, p_ValueType := p_ValueType_ce858baa, p_IsArray := p_IsArray_ce858baa, p_Description := p_Description_ce858baa, p_IsRequired := p_IsRequired_ce858baa, p_MediaModality := p_MediaModality_ce858baa);
END $$;

-- Save MJ: Action Params (core SP call only)
DO $$
DECLARE
  p_ID_be9065c9 UUID;
  p_ActionID_be9065c9 UUID;
  p_Name_be9065c9 VARCHAR(255);
  p_DefaultValue_be9065c9 TEXT;
  p_Type_be9065c9 CHAR(10);
  p_ValueType_be9065c9 VARCHAR(30);
  p_IsArray_be9065c9 BOOLEAN;
  p_Description_be9065c9 TEXT;
  p_IsRequired_be9065c9 BOOLEAN;
  p_MediaModality_be9065c9 VARCHAR(20);
BEGIN
  p_ID_be9065c9 := 'D36C8E5E-FEB6-4137-9224-A41A23BA062D';
  p_ActionID_be9065c9 := '59B4E9C8-5408-480E-93EE-644B7EC197BB';
  p_Name_be9065c9 := 'MaxSteps';
  p_DefaultValue_be9065c9 := '30';
  p_Type_be9065c9 := 'Input';
  p_ValueType_be9065c9 := 'Scalar';
  p_IsArray_be9065c9 := 0;
  p_Description_be9065c9 := 'Maximum number of controller loop steps before forced termination. Each step captures a screenshot, calls the controller LLM, and executes actions. Default: 30.';
  p_IsRequired_be9065c9 := 0;
  PERFORM __mj."spCreateActionParam"(p_ID := p_ID_be9065c9, p_ActionID := p_ActionID_be9065c9, p_Name := p_Name_be9065c9, p_DefaultValue := p_DefaultValue_be9065c9, p_Type := p_Type_be9065c9, p_ValueType := p_ValueType_be9065c9, p_IsArray := p_IsArray_be9065c9, p_Description := p_Description_be9065c9, p_IsRequired := p_IsRequired_be9065c9, p_MediaModality := p_MediaModality_be9065c9);
END $$;

-- Save MJ: Action Params (core SP call only)
DO $$
DECLARE
  p_ID_dcaa9ec3 UUID;
  p_ActionID_dcaa9ec3 UUID;
  p_Name_dcaa9ec3 VARCHAR(255);
  p_DefaultValue_dcaa9ec3 TEXT;
  p_Type_dcaa9ec3 CHAR(10);
  p_ValueType_dcaa9ec3 VARCHAR(30);
  p_IsArray_dcaa9ec3 BOOLEAN;
  p_Description_dcaa9ec3 TEXT;
  p_IsRequired_dcaa9ec3 BOOLEAN;
  p_MediaModality_dcaa9ec3 VARCHAR(20);
BEGIN
  p_ID_dcaa9ec3 := 'DB672E72-22BB-4661-8B53-150DDD9F3598';
  p_ActionID_dcaa9ec3 := '59B4E9C8-5408-480E-93EE-644B7EC197BB';
  p_Name_dcaa9ec3 := 'ControllerPromptName';
  p_Type_dcaa9ec3 := 'Input';
  p_ValueType_dcaa9ec3 := 'Scalar';
  p_IsArray_dcaa9ec3 := 0;
  p_Description_dcaa9ec3 := 'Name of an MJ AI Prompt entity to use for the controller LLM. When set, routes prompt execution through AIPromptRunner for template rendering, model selection, prompt run logging, and token tracking. Example: ''Computer Use Controller''.';
  p_IsRequired_dcaa9ec3 := 0;
  PERFORM __mj."spCreateActionParam"(p_ID := p_ID_dcaa9ec3, p_ActionID := p_ActionID_dcaa9ec3, p_Name := p_Name_dcaa9ec3, p_DefaultValue := p_DefaultValue_dcaa9ec3, p_Type := p_Type_dcaa9ec3, p_ValueType := p_ValueType_dcaa9ec3, p_IsArray := p_IsArray_dcaa9ec3, p_Description := p_Description_dcaa9ec3, p_IsRequired := p_IsRequired_dcaa9ec3, p_MediaModality := p_MediaModality_dcaa9ec3);
END $$;

-- Save MJ: Action Params (core SP call only)
DO $$
DECLARE
  p_ID_74185b78 UUID;
  p_ActionID_74185b78 UUID;
  p_Name_74185b78 VARCHAR(255);
  p_DefaultValue_74185b78 TEXT;
  p_Type_74185b78 CHAR(10);
  p_ValueType_74185b78 VARCHAR(30);
  p_IsArray_74185b78 BOOLEAN;
  p_Description_74185b78 TEXT;
  p_IsRequired_74185b78 BOOLEAN;
  p_MediaModality_74185b78 VARCHAR(20);
BEGIN
  p_ID_74185b78 := '7139FDF1-D84F-4F0E-8E94-B9A903AD5D4E';
  p_ActionID_74185b78 := '59B4E9C8-5408-480E-93EE-644B7EC197BB';
  p_Name_74185b78 := 'JudgePromptName';
  p_Type_74185b78 := 'Input';
  p_ValueType_74185b78 := 'Scalar';
  p_IsArray_74185b78 := 0;
  p_Description_74185b78 := 'Name of an MJ AI Prompt entity to use for the judge LLM. When set, routes prompt execution through AIPromptRunner for template rendering, model selection, prompt run logging, and token tracking. Example: ''Computer Use Judge''.';
  p_IsRequired_74185b78 := 0;
  PERFORM __mj."spCreateActionParam"(p_ID := p_ID_74185b78, p_ActionID := p_ActionID_74185b78, p_Name := p_Name_74185b78, p_DefaultValue := p_DefaultValue_74185b78, p_Type := p_Type_74185b78, p_ValueType := p_ValueType_74185b78, p_IsArray := p_IsArray_74185b78, p_Description := p_Description_74185b78, p_IsRequired := p_IsRequired_74185b78, p_MediaModality := p_MediaModality_74185b78);
END $$;

-- Save MJ: Action Params (core SP call only)
DO $$
DECLARE
  p_ID_61e8a3c8 UUID;
  p_ActionID_61e8a3c8 UUID;
  p_Name_61e8a3c8 VARCHAR(255);
  p_DefaultValue_61e8a3c8 TEXT;
  p_Type_61e8a3c8 CHAR(10);
  p_ValueType_61e8a3c8 VARCHAR(30);
  p_IsArray_61e8a3c8 BOOLEAN;
  p_Description_61e8a3c8 TEXT;
  p_IsRequired_61e8a3c8 BOOLEAN;
  p_MediaModality_61e8a3c8 VARCHAR(20);
BEGIN
  p_ID_61e8a3c8 := '15568187-53BF-4372-AE68-D705C37F4215';
  p_ActionID_61e8a3c8 := '59B4E9C8-5408-480E-93EE-644B7EC197BB';
  p_Name_61e8a3c8 := 'JudgeFrequency';
  p_DefaultValue_61e8a3c8 := 'EveryStep';
  p_Type_61e8a3c8 := 'Input';
  p_ValueType_61e8a3c8 := 'Scalar';
  p_IsArray_61e8a3c8 := 0;
  p_Description_61e8a3c8 := 'How often the judge evaluates progress. Options: ''EveryStep'' (every step, most accurate but highest cost), ''EveryNSteps:'' (every N steps, e.g. ''EveryNSteps:3''), ''OnStagnation:'' (only when N identical screenshots detected, e.g. ''OnStagnation:5''). Default: ''EveryStep''.';
  p_IsRequired_61e8a3c8 := 0;
  PERFORM __mj."spCreateActionParam"(p_ID := p_ID_61e8a3c8, p_ActionID := p_ActionID_61e8a3c8, p_Name := p_Name_61e8a3c8, p_DefaultValue := p_DefaultValue_61e8a3c8, p_Type := p_Type_61e8a3c8, p_ValueType := p_ValueType_61e8a3c8, p_IsArray := p_IsArray_61e8a3c8, p_Description := p_Description_61e8a3c8, p_IsRequired := p_IsRequired_61e8a3c8, p_MediaModality := p_MediaModality_61e8a3c8);
END $$;

-- Save MJ: Action Params (core SP call only)
DO $$
DECLARE
  p_ID_2d82347d UUID;
  p_ActionID_2d82347d UUID;
  p_Name_2d82347d VARCHAR(255);
  p_DefaultValue_2d82347d TEXT;
  p_Type_2d82347d CHAR(10);
  p_ValueType_2d82347d VARCHAR(30);
  p_IsArray_2d82347d BOOLEAN;
  p_Description_2d82347d TEXT;
  p_IsRequired_2d82347d BOOLEAN;
  p_MediaModality_2d82347d VARCHAR(20);
BEGIN
  p_ID_2d82347d := 'F4FE4CAC-CDD3-446D-972B-F7B2CBABE1ED';
  p_ActionID_2d82347d := '59B4E9C8-5408-480E-93EE-644B7EC197BB';
  p_Name_2d82347d := 'AgentRunId';
  p_Type_2d82347d := 'Input';
  p_ValueType_2d82347d := 'Scalar';
  p_IsArray_2d82347d := 0;
  p_Description_2d82347d := 'Parent MJ agent run ID for linking prompt runs and media to the agent execution. When set, all AIPromptRun records created during the run will reference this agent run.';
  p_IsRequired_2d82347d := 0;
  PERFORM __mj."spCreateActionParam"(p_ID := p_ID_2d82347d, p_ActionID := p_ActionID_2d82347d, p_Name := p_Name_2d82347d, p_DefaultValue := p_DefaultValue_2d82347d, p_Type := p_Type_2d82347d, p_ValueType := p_ValueType_2d82347d, p_IsArray := p_IsArray_2d82347d, p_Description := p_Description_2d82347d, p_IsRequired := p_IsRequired_2d82347d, p_MediaModality := p_MediaModality_2d82347d);
END $$;

-- Save MJ: Action Params (core SP call only)
DO $$
DECLARE
  p_ID_77628252 UUID;
  p_ActionID_77628252 UUID;
  p_Name_77628252 VARCHAR(255);
  p_DefaultValue_77628252 TEXT;
  p_Type_77628252 CHAR(10);
  p_ValueType_77628252 VARCHAR(30);
  p_IsArray_77628252 BOOLEAN;
  p_Description_77628252 TEXT;
  p_IsRequired_77628252 BOOLEAN;
  p_MediaModality_77628252 VARCHAR(20);
BEGIN
  p_ID_77628252 := '2AA3E850-C948-4B31-B881-6010DCCBCF68';
  p_ActionID_77628252 := '59B4E9C8-5408-480E-93EE-644B7EC197BB';
  p_Name_77628252 := 'Success';
  p_Type_77628252 := 'Output';
  p_ValueType_77628252 := 'Scalar';
  p_IsArray_77628252 := 0;
  p_Description_77628252 := 'Whether the goal was successfully achieved. ''true'' if the judge confirmed goal completion, ''false'' otherwise.';
  p_IsRequired_77628252 := 0;
  PERFORM __mj."spCreateActionParam"(p_ID := p_ID_77628252, p_ActionID := p_ActionID_77628252, p_Name := p_Name_77628252, p_DefaultValue := p_DefaultValue_77628252, p_Type := p_Type_77628252, p_ValueType := p_ValueType_77628252, p_IsArray := p_IsArray_77628252, p_Description := p_Description_77628252, p_IsRequired := p_IsRequired_77628252, p_MediaModality := p_MediaModality_77628252);
END $$;

-- Save MJ: Action Params (core SP call only)
DO $$
DECLARE
  p_ID_cb86a151 UUID;
  p_ActionID_cb86a151 UUID;
  p_Name_cb86a151 VARCHAR(255);
  p_DefaultValue_cb86a151 TEXT;
  p_Type_cb86a151 CHAR(10);
  p_ValueType_cb86a151 VARCHAR(30);
  p_IsArray_cb86a151 BOOLEAN;
  p_Description_cb86a151 TEXT;
  p_IsRequired_cb86a151 BOOLEAN;
  p_MediaModality_cb86a151 VARCHAR(20);
BEGIN
  p_ID_cb86a151 := 'CA0A67BD-81DA-4A8C-B967-68D2ACB953D2';
  p_ActionID_cb86a151 := '59B4E9C8-5408-480E-93EE-644B7EC197BB';
  p_Name_cb86a151 := 'Status';
  p_Type_cb86a151 := 'Output';
  p_ValueType_cb86a151 := 'Scalar';
  p_IsArray_cb86a151 := 0;
  p_Description_cb86a151 := 'Final run status. One of: ''Completed'' (goal met), ''Failed'' (goal not met after max attempts), ''MaxStepsReached'' (hit step limit), ''Error'' (infrastructure error), ''Cancelled'' (externally cancelled).';
  p_IsRequired_cb86a151 := 0;
  PERFORM __mj."spCreateActionParam"(p_ID := p_ID_cb86a151, p_ActionID := p_ActionID_cb86a151, p_Name := p_Name_cb86a151, p_DefaultValue := p_DefaultValue_cb86a151, p_Type := p_Type_cb86a151, p_ValueType := p_ValueType_cb86a151, p_IsArray := p_IsArray_cb86a151, p_Description := p_Description_cb86a151, p_IsRequired := p_IsRequired_cb86a151, p_MediaModality := p_MediaModality_cb86a151);
END $$;

-- Save MJ: Action Params (core SP call only)
DO $$
DECLARE
  p_ID_5f949ebf UUID;
  p_ActionID_5f949ebf UUID;
  p_Name_5f949ebf VARCHAR(255);
  p_DefaultValue_5f949ebf TEXT;
  p_Type_5f949ebf CHAR(10);
  p_ValueType_5f949ebf VARCHAR(30);
  p_IsArray_5f949ebf BOOLEAN;
  p_Description_5f949ebf TEXT;
  p_IsRequired_5f949ebf BOOLEAN;
  p_MediaModality_5f949ebf VARCHAR(20);
BEGIN
  p_ID_5f949ebf := 'D21E5981-37B6-472B-951D-71A44476C902';
  p_ActionID_5f949ebf := '59B4E9C8-5408-480E-93EE-644B7EC197BB';
  p_Name_5f949ebf := 'TotalSteps';
  p_Type_5f949ebf := 'Output';
  p_ValueType_5f949ebf := 'Scalar';
  p_IsArray_5f949ebf := 0;
  p_Description_5f949ebf := 'Total number of steps executed during the run.';
  p_IsRequired_5f949ebf := 0;
  PERFORM __mj."spCreateActionParam"(p_ID := p_ID_5f949ebf, p_ActionID := p_ActionID_5f949ebf, p_Name := p_Name_5f949ebf, p_DefaultValue := p_DefaultValue_5f949ebf, p_Type := p_Type_5f949ebf, p_ValueType := p_ValueType_5f949ebf, p_IsArray := p_IsArray_5f949ebf, p_Description := p_Description_5f949ebf, p_IsRequired := p_IsRequired_5f949ebf, p_MediaModality := p_MediaModality_5f949ebf);
END $$;

-- Save MJ: Action Params (core SP call only)
DO $$
DECLARE
  p_ID_f8f39986 UUID;
  p_ActionID_f8f39986 UUID;
  p_Name_f8f39986 VARCHAR(255);
  p_DefaultValue_f8f39986 TEXT;
  p_Type_f8f39986 CHAR(10);
  p_ValueType_f8f39986 VARCHAR(30);
  p_IsArray_f8f39986 BOOLEAN;
  p_Description_f8f39986 TEXT;
  p_IsRequired_f8f39986 BOOLEAN;
  p_MediaModality_f8f39986 VARCHAR(20);
BEGIN
  p_ID_f8f39986 := '230E913C-A051-4017-BE1E-F38F8095CC06';
  p_ActionID_f8f39986 := '59B4E9C8-5408-480E-93EE-644B7EC197BB';
  p_Name_f8f39986 := 'FinalUrl';
  p_Type_f8f39986 := 'Output';
  p_ValueType_f8f39986 := 'Scalar';
  p_IsArray_f8f39986 := 0;
  p_Description_f8f39986 := 'The browser''s final URL when the run completed.';
  p_IsRequired_f8f39986 := 0;
  PERFORM __mj."spCreateActionParam"(p_ID := p_ID_f8f39986, p_ActionID := p_ActionID_f8f39986, p_Name := p_Name_f8f39986, p_DefaultValue := p_DefaultValue_f8f39986, p_Type := p_Type_f8f39986, p_ValueType := p_ValueType_f8f39986, p_IsArray := p_IsArray_f8f39986, p_Description := p_Description_f8f39986, p_IsRequired := p_IsRequired_f8f39986, p_MediaModality := p_MediaModality_f8f39986);
END $$;

-- Save MJ: Action Params (core SP call only)
DO $$
DECLARE
  p_ID_9600643d UUID;
  p_ActionID_9600643d UUID;
  p_Name_9600643d VARCHAR(255);
  p_DefaultValue_9600643d TEXT;
  p_Type_9600643d CHAR(10);
  p_ValueType_9600643d VARCHAR(30);
  p_IsArray_9600643d BOOLEAN;
  p_Description_9600643d TEXT;
  p_IsRequired_9600643d BOOLEAN;
  p_MediaModality_9600643d VARCHAR(20);
BEGIN
  p_ID_9600643d := 'F81DDC95-7DCD-459C-AB4D-380E60145E3F';
  p_ActionID_9600643d := '59B4E9C8-5408-480E-93EE-644B7EC197BB';
  p_Name_9600643d := 'FinalScreenshot';
  p_Type_9600643d := 'Output';
  p_ValueType_9600643d := 'Scalar';
  p_IsArray_9600643d := 0;
  p_Description_9600643d := 'Base64-encoded PNG screenshot of the browser''s final state.';
  p_IsRequired_9600643d := 0;
  PERFORM __mj."spCreateActionParam"(p_ID := p_ID_9600643d, p_ActionID := p_ActionID_9600643d, p_Name := p_Name_9600643d, p_DefaultValue := p_DefaultValue_9600643d, p_Type := p_Type_9600643d, p_ValueType := p_ValueType_9600643d, p_IsArray := p_IsArray_9600643d, p_Description := p_Description_9600643d, p_IsRequired := p_IsRequired_9600643d, p_MediaModality := p_MediaModality_9600643d);
END $$;

-- Save MJ: Action Params (core SP call only)
DO $$
DECLARE
  p_ID_eca9d05d UUID;
  p_ActionID_eca9d05d UUID;
  p_Name_eca9d05d VARCHAR(255);
  p_DefaultValue_eca9d05d TEXT;
  p_Type_eca9d05d CHAR(10);
  p_ValueType_eca9d05d VARCHAR(30);
  p_IsArray_eca9d05d BOOLEAN;
  p_Description_eca9d05d TEXT;
  p_IsRequired_eca9d05d BOOLEAN;
  p_MediaModality_eca9d05d VARCHAR(20);
BEGIN
  p_ID_eca9d05d := '9BB7DC06-D916-461F-AA1D-BE5862B6E9B6';
  p_ActionID_eca9d05d := '59B4E9C8-5408-480E-93EE-644B7EC197BB';
  p_Name_eca9d05d := 'Error';
  p_Type_eca9d05d := 'Output';
  p_ValueType_eca9d05d := 'Scalar';
  p_IsArray_eca9d05d := 0;
  p_Description_eca9d05d := 'Error message if the run failed. Empty if no error occurred.';
  p_IsRequired_eca9d05d := 0;
  PERFORM __mj."spCreateActionParam"(p_ID := p_ID_eca9d05d, p_ActionID := p_ActionID_eca9d05d, p_Name := p_Name_eca9d05d, p_DefaultValue := p_DefaultValue_eca9d05d, p_Type := p_Type_eca9d05d, p_ValueType := p_ValueType_eca9d05d, p_IsArray := p_IsArray_eca9d05d, p_Description := p_Description_eca9d05d, p_IsRequired := p_IsRequired_eca9d05d, p_MediaModality := p_MediaModality_eca9d05d);
END $$;

-- Save MJ: Action Params (core SP call only)
DO $$
DECLARE
  p_ID_f833817f UUID;
  p_ActionID_f833817f UUID;
  p_Name_f833817f VARCHAR(255);
  p_DefaultValue_f833817f TEXT;
  p_Type_f833817f CHAR(10);
  p_ValueType_f833817f VARCHAR(30);
  p_IsArray_f833817f BOOLEAN;
  p_Description_f833817f TEXT;
  p_IsRequired_f833817f BOOLEAN;
  p_MediaModality_f833817f VARCHAR(20);
BEGIN
  p_ID_f833817f := '156D3384-D5AF-4EE7-8765-D977DCA702E4';
  p_ActionID_f833817f := '59B4E9C8-5408-480E-93EE-644B7EC197BB';
  p_Name_f833817f := 'JudgeVerdict';
  p_Type_f833817f := 'Output';
  p_ValueType_f833817f := 'Simple Object';
  p_IsArray_f833817f := 0;
  p_Description_f833817f := 'JSON object containing the final judge verdict with Done (boolean), Confidence (0.0-1.0), and Reason (string) fields.';
  p_IsRequired_f833817f := 0;
  PERFORM __mj."spCreateActionParam"(p_ID := p_ID_f833817f, p_ActionID := p_ActionID_f833817f, p_Name := p_Name_f833817f, p_DefaultValue := p_DefaultValue_f833817f, p_Type := p_Type_f833817f, p_ValueType := p_ValueType_f833817f, p_IsArray := p_IsArray_f833817f, p_Description := p_Description_f833817f, p_IsRequired := p_IsRequired_f833817f, p_MediaModality := p_MediaModality_f833817f);
END $$;

-- Save MJ: Action Result Codes (core SP call only)
DO $$
DECLARE
  p_ID_f46266b7 UUID;
  p_ActionID_f46266b7 UUID;
  p_ResultCode_f46266b7 VARCHAR(255);
  p_IsSuccess_f46266b7 BOOLEAN;
  p_Description_f46266b7 TEXT;
BEGIN
  p_ID_f46266b7 := '5A50A0E4-E49F-4917-A455-09FEA0A2042B';
  p_ActionID_f46266b7 := '59B4E9C8-5408-480E-93EE-644B7EC197BB';
  p_ResultCode_f46266b7 := 'Completed';
  p_IsSuccess_f46266b7 := 1;
  p_Description_f46266b7 := 'The judge confirmed that the goal was successfully achieved.';
  PERFORM __mj."spCreateActionResultCode"(p_ID := p_ID_f46266b7, p_ActionID := p_ActionID_f46266b7, p_ResultCode := p_ResultCode_f46266b7, p_IsSuccess := p_IsSuccess_f46266b7, p_Description := p_Description_f46266b7);
END $$;

-- Save MJ: Action Result Codes (core SP call only)
DO $$
DECLARE
  p_ID_c631493d UUID;
  p_ActionID_c631493d UUID;
  p_ResultCode_c631493d VARCHAR(255);
  p_IsSuccess_c631493d BOOLEAN;
  p_Description_c631493d TEXT;
BEGIN
  p_ID_c631493d := 'B93A054E-D12D-486B-82B5-498A0B296757';
  p_ActionID_c631493d := '59B4E9C8-5408-480E-93EE-644B7EC197BB';
  p_ResultCode_c631493d := 'Failed';
  p_IsSuccess_c631493d := 0;
  p_Description_c631493d := 'The judge confirmed the goal was not met after maximum attempts.';
  PERFORM __mj."spCreateActionResultCode"(p_ID := p_ID_c631493d, p_ActionID := p_ActionID_c631493d, p_ResultCode := p_ResultCode_c631493d, p_IsSuccess := p_IsSuccess_c631493d, p_Description := p_Description_c631493d);
END $$;

-- Save MJ: Action Result Codes (core SP call only)
DO $$
DECLARE
  p_ID_3a4f6502 UUID;
  p_ActionID_3a4f6502 UUID;
  p_ResultCode_3a4f6502 VARCHAR(255);
  p_IsSuccess_3a4f6502 BOOLEAN;
  p_Description_3a4f6502 TEXT;
BEGIN
  p_ID_3a4f6502 := '9B6F0C4C-06F1-4ACF-9E67-7B670AA7E591';
  p_ActionID_3a4f6502 := '59B4E9C8-5408-480E-93EE-644B7EC197BB';
  p_ResultCode_3a4f6502 := 'MaxStepsReached';
  p_IsSuccess_3a4f6502 := 0;
  p_Description_3a4f6502 := 'The run hit the maximum step limit without the judge confirming goal completion.';
  PERFORM __mj."spCreateActionResultCode"(p_ID := p_ID_3a4f6502, p_ActionID := p_ActionID_3a4f6502, p_ResultCode := p_ResultCode_3a4f6502, p_IsSuccess := p_IsSuccess_3a4f6502, p_Description := p_Description_3a4f6502);
END $$;

-- Save MJ: Action Result Codes (core SP call only)
DO $$
DECLARE
  p_ID_24a402d3 UUID;
  p_ActionID_24a402d3 UUID;
  p_ResultCode_24a402d3 VARCHAR(255);
  p_IsSuccess_24a402d3 BOOLEAN;
  p_Description_24a402d3 TEXT;
BEGIN
  p_ID_24a402d3 := '698DFDBD-227D-46E4-8C7D-9BC60BBB5DBD';
  p_ActionID_24a402d3 := '59B4E9C8-5408-480E-93EE-644B7EC197BB';
  p_ResultCode_24a402d3 := 'Error';
  p_IsSuccess_24a402d3 := 0;
  p_Description_24a402d3 := 'An infrastructure or runtime error occurred during the run (browser crash, LLM failure, etc.).';
  PERFORM __mj."spCreateActionResultCode"(p_ID := p_ID_24a402d3, p_ActionID := p_ActionID_24a402d3, p_ResultCode := p_ResultCode_24a402d3, p_IsSuccess := p_IsSuccess_24a402d3, p_Description := p_Description_24a402d3);
END $$;

-- Save MJ: Action Result Codes (core SP call only)
DO $$
DECLARE
  p_ID_551de98b UUID;
  p_ActionID_551de98b UUID;
  p_ResultCode_551de98b VARCHAR(255);
  p_IsSuccess_551de98b BOOLEAN;
  p_Description_551de98b TEXT;
BEGIN
  p_ID_551de98b := 'EA6B6A77-C401-4E77-A58F-85C696100204';
  p_ActionID_551de98b := '59B4E9C8-5408-480E-93EE-644B7EC197BB';
  p_ResultCode_551de98b := 'Cancelled';
  p_IsSuccess_551de98b := 0;
  p_Description_551de98b := 'The run was externally cancelled via Stop().';
  PERFORM __mj."spCreateActionResultCode"(p_ID := p_ID_551de98b, p_ActionID := p_ActionID_551de98b, p_ResultCode := p_ResultCode_551de98b, p_IsSuccess := p_IsSuccess_551de98b, p_Description := p_Description_551de98b);
END $$;

-- Save MJ: Action Result Codes (core SP call only)
DO $$
DECLARE
  p_ID_e3dc773d UUID;
  p_ActionID_e3dc773d UUID;
  p_ResultCode_e3dc773d VARCHAR(255);
  p_IsSuccess_e3dc773d BOOLEAN;
  p_Description_e3dc773d TEXT;
BEGIN
  p_ID_e3dc773d := '445E330F-1281-4CD2-89CF-0055754737AF';
  p_ActionID_e3dc773d := '59B4E9C8-5408-480E-93EE-644B7EC197BB';
  p_ResultCode_e3dc773d := 'ERROR';
  p_IsSuccess_e3dc773d := 0;
  p_Description_e3dc773d := 'An unhandled exception occurred before or during engine execution.';
  PERFORM __mj."spCreateActionResultCode"(p_ID := p_ID_e3dc773d, p_ActionID := p_ActionID_e3dc773d, p_ResultCode := p_ResultCode_e3dc773d, p_IsSuccess := p_IsSuccess_e3dc773d, p_Description := p_Description_e3dc773d);
END $$;

-- Save MJ: Templates (core SP call only)
DO $$
DECLARE
  p_ID_cc1a4185 UUID;
  p_Name_cc1a4185 VARCHAR(255);
  p_Description_cc1a4185 TEXT;
  p_CategoryID_cc1a4185 UUID;
  p_UserPrompt_cc1a4185 TEXT;
  p_UserID_cc1a4185 UUID;
  p_ActiveAt_cc1a4185 TIMESTAMPTZ;
  p_DisabledAt_cc1a4185 TIMESTAMPTZ;
  p_IsActive_cc1a4185 BOOLEAN;
BEGIN
  p_ID_cc1a4185 := 'ebbe0b44-6a44-4f4d-b426-3da257cd6b1d';
  p_Name_cc1a4185 := 'Computer Use - Controller';
  p_Description_cc1a4185 := 'Template for AI Prompt: Computer Use - Controller';
  p_CategoryID_cc1a4185 := 'B61B01C3-2DD1-4FFA-AE77-6DE9765BCA68';
  p_UserID_cc1a4185 := 'ECAFCCEC-6A37-EF11-86D4-000D3A4E707E';
  p_IsActive_cc1a4185 := 1;
  PERFORM __mj."spCreateTemplate"(p_ID := p_ID_cc1a4185, p_Name := p_Name_cc1a4185, p_Description := p_Description_cc1a4185, p_CategoryID := p_CategoryID_cc1a4185, p_UserPrompt := p_UserPrompt_cc1a4185, p_UserID := p_UserID_cc1a4185, p_ActiveAt := p_ActiveAt_cc1a4185, p_DisabledAt := p_DisabledAt_cc1a4185, p_IsActive := p_IsActive_cc1a4185);
END $$;

-- Save MJ: Templates (core SP call only)
DO $$
DECLARE
  p_ID_4b741dac UUID;
  p_Name_4b741dac VARCHAR(255);
  p_Description_4b741dac TEXT;
  p_CategoryID_4b741dac UUID;
  p_UserPrompt_4b741dac TEXT;
  p_UserID_4b741dac UUID;
  p_ActiveAt_4b741dac TIMESTAMPTZ;
  p_DisabledAt_4b741dac TIMESTAMPTZ;
  p_IsActive_4b741dac BOOLEAN;
BEGIN
  p_ID_4b741dac := '022fca9f-5ea9-4e7e-8ff7-bbef4365cd2a';
  p_Name_4b741dac := 'Computer Use - Judge';
  p_Description_4b741dac := 'Template for AI Prompt: Computer Use - Judge';
  p_CategoryID_4b741dac := 'B61B01C3-2DD1-4FFA-AE77-6DE9765BCA68';
  p_UserID_4b741dac := 'ECAFCCEC-6A37-EF11-86D4-000D3A4E707E';
  p_IsActive_4b741dac := 1;
  PERFORM __mj."spCreateTemplate"(p_ID := p_ID_4b741dac, p_Name := p_Name_4b741dac, p_Description := p_Description_4b741dac, p_CategoryID := p_CategoryID_4b741dac, p_UserPrompt := p_UserPrompt_4b741dac, p_UserID := p_UserID_4b741dac, p_ActiveAt := p_ActiveAt_4b741dac, p_DisabledAt := p_DisabledAt_4b741dac, p_IsActive := p_IsActive_4b741dac);
END $$;

-- Save MJ: Template Contents (core SP call only)
DO $$
DECLARE
  p_ID_5adc4981 UUID;
  p_TemplateID_5adc4981 UUID;
  p_TypeID_5adc4981 UUID;
  p_TemplateText_5adc4981 TEXT;
  p_Priority_5adc4981 INTEGER;
  p_IsActive_5adc4981 BOOLEAN;
BEGIN
  p_ID_5adc4981 := '557e8c46-9db3-4500-8ffb-6b6930b30be0';
  p_TemplateID_5adc4981 := 'EBBE0B44-6A44-4F4D-B426-3DA257CD6B1D';
  p_TypeID_5adc4981 := 'E7AFCCEC-6A37-EF11-86D4-000D3A4E707E';
  p_TemplateText_5adc4981 := 'You are a browser automation agent. You control a web browser to accomplish a goal by analyzing screenshots and deciding what actions to take.

## Your Goal
{{ goal }}

## Current State
- Step: {{ stepNumber }} of {{ maxSteps }}
- Current URL: {{ currentUrl }}

## Coordinate System
The screenshot uses a **normalized 1000x1000 coordinate space**. All X coordinates range from 0 (left edge) to 1000 (right edge), and all Y coordinates range from 0 (top edge) to 1000 (bottom edge). When specifying click positions, always use this 0-1000 range for both axes.

## Available Actions
You can perform the following browser actions:

- **Click**: Click at a target in the 1000x1000 coordinate space. **Prefer providing a BoundingBox** for better accuracy — the engine clicks the center of the box automatically. If you cannot determine the bounding box, fall back to X/Y point coordinates.
  With bounding box (preferred): `{ "Type": "Click", "BoundingBox": { "XMin": 420, "YMin": 270, "XMax": 580, "YMax": 330 } }`
  With point coordinates: `{ "Type": "Click", "X": 500, "Y": 300 }`
  All coordinate values (X, Y, XMin, YMin, XMax, YMax) must be between 0 and 1000.
- **Type**: Type text into the currently focused element
  `{ "Type": "Type", "Text": "hello world" }`
- **Keypress**: Press a key or key combination (e.g., "Enter", "Tab", "Shift+A", "ControlOrMeta+C")
  `{ "Type": "Keypress", "Key": "Enter" }`
- **KeyDown/KeyUp**: Hold or release a key (for drag, multi-select, etc.)
  `{ "Type": "KeyDown", "Key": "Shift" }` / `{ "Type": "KeyUp", "Key": "Shift" }`
- **Scroll**: Scroll the page in the 1000x1000 coordinate space (positive DeltaY = down, negative = up)
  `{ "Type": "Scroll", "DeltaY": 300 }`
- **Wait**: Wait for a specified duration in milliseconds
  `{ "Type": "Wait", "DurationMs": 1000 }`
- **Navigate**: Navigate to a URL
  `{ "Type": "Navigate", "Url": "https://example.com" }`
- **GoBack/GoForward**: Browser history navigation
  `{ "Type": "GoBack" }` / `{ "Type": "GoForward" }`
- **Refresh**: Refresh the current page
  `{ "Type": "Refresh" }`

{% if toolDefinitions and toolDefinitions.length > 0 %}
## Available Tools
You can also call the following tools:

{% for tool in toolDefinitions %}
### {{ tool."Name" }}
{{ tool."Description" }}
Input schema: `{{ tool."InputSchema" | dump }}`

{% endfor %}
To call a tool, include it in the "toolCalls" array:
`{ "toolName": "tool_name", "arguments": { ... } }`
{% endif %}

{% if formLoginCredentials %}
## Login Credentials (IMPORTANT)
You MUST use exactly these credentials when filling in the login form on {{ formLoginCredentials."Domain" }}. Do NOT use any other email, username, or password.
- Username/Email: {{ formLoginCredentials."Username" }}
- Password: {{ formLoginCredentials."Password" }}
Type these values exactly as shown. Do not guess or substitute other credentials.
{% endif %}

{% if judgeFeedback %}
## Feedback from Previous Evaluation
{{ judgeFeedback }}
Take this feedback into account when planning your next actions.
{% endif %}

{% if previousStepSummary %}
## Previous Actions
{{ previousStepSummary }}
{% endif %}

## Response Format
Respond with ONLY a JSON object (no other text):

**When you are still working** (goal NOT yet accomplished):
```json
{
  "reasoning": "Brief explanation of what you see and what you plan to do",
  "actions": [
    { "Type": "Click", "BoundingBox": { "XMin": 420, "YMin": 270, "XMax": 580, "YMax": 330 } }
  ],
  "toolCalls": [],
  "requestJudgement": false
}
```

**When you believe the goal is accomplished or a major milestone is reached:**
```json
{
  "reasoning": "I have completed the goal because [specific evidence visible on screen]",
  "actions": [],
  "toolCalls": [],
  "requestJudgement": true
}
```

**When you believe the goal is impossible to accomplish:**
```json
{
  "reasoning": "I believe this goal is impossible because [specific blocker — e.g., access denied, element does not exist, repeated failures with different approaches]",
  "actions": [],
  "toolCalls": [],
  "requestJudgement": true
}
```

### CRITICAL: `requestJudgement` Field
You MUST set `requestJudgement: true` when ANY of these apply:
- The goal appears to be accomplished based on what you see on screen
- You have completed the final action needed to achieve the goal (e.g., clicked Submit, saved a form, navigated to the target page)
- You have completed a significant milestone and need confirmation before proceeding
- You believe the goal is **impossible** to accomplish (e.g., access denied, page not found, feature doesn''t exist, repeated failures across different approaches)
- You are stuck in a loop — the same actions keep producing the same results with no progress
- You are unsure whether the current state meets the goal

**Do NOT** continue taking actions after you believe the goal is done or impossible. Instead, set `requestJudgement: true` and let the judge confirm. Failing to request judgement wastes steps.

The judge will analyze the current state and provide feedback. If the goal is met, the run will complete successfully. If the judge agrees the goal is impossible, the run will stop immediately. Otherwise, you''ll receive specific guidance on what to try next.

## Rules
1. **Request judgement immediately when the goal appears done or impossible** — this is the most important rule. Set `requestJudgement: true` as soon as you see evidence the goal is accomplished OR that it cannot be accomplished. Do not take unnecessary extra actions after completion, and do not keep retrying when a task is clearly blocked.
2. Analyze the screenshot carefully before deciding on actions
3. For clicks, always try to provide a BoundingBox that tightly encloses the target element — this is much more accurate than point coordinates. Estimate the element''s edges in the 0-1000 coordinate space. Only fall back to X/Y if you truly cannot determine the bounds
4. After clicking an input field, use Type to enter text
5. Use Keypress for keyboard shortcuts and form submission (e.g., "Enter")
6. If the page needs to load, use Wait with an appropriate duration
7. If you need to scroll to see more content, use Scroll
8. Keep your action list focused — do one logical step at a time
9. If available tools can accomplish a sub-task, prefer calling the tool over manual browser interaction
';
  p_Priority_5adc4981 := 1;
  p_IsActive_5adc4981 := 1;
  PERFORM __mj."spCreateTemplateContent"(p_ID := p_ID_5adc4981, p_TemplateID := p_TemplateID_5adc4981, p_TypeID := p_TypeID_5adc4981, p_TemplateText := p_TemplateText_5adc4981, p_Priority := p_Priority_5adc4981, p_IsActive := p_IsActive_5adc4981);
END $$;

-- Save MJ: Template Contents (core SP call only)
DO $$
DECLARE
  p_ID_ce9711f8 UUID;
  p_TemplateID_ce9711f8 UUID;
  p_TypeID_ce9711f8 UUID;
  p_TemplateText_ce9711f8 TEXT;
  p_Priority_ce9711f8 INTEGER;
  p_IsActive_ce9711f8 BOOLEAN;
BEGIN
  p_ID_ce9711f8 := '1e4fa7d7-97ad-4a3b-919d-08905a936741';
  p_TemplateID_ce9711f8 := '022FCA9F-5EA9-4E7E-8FF7-BBEF4365CD2A';
  p_TypeID_ce9711f8 := 'E7AFCCEC-6A37-EF11-86D4-000D3A4E707E';
  p_TemplateText_ce9711f8 := 'You are a judge evaluating whether a browser automation agent has accomplished its goal.

## Your Task
Analyze the current screenshot and step history to determine if the goal has been achieved.

## Goal
{{ goal }}

## Step History
{{ stepSummary }}

## Current State
- Step: {{ stepNumber }} of {{ maxSteps }}
- Current URL: {{ currentUrl }}

## Visual Context
- The current browser screenshot is attached as the final image.
- If recent screenshot history is available, earlier screenshots are attached in chronological order (oldest first) before the current one. Use these to assess visual progression.

## Instructions
1. Carefully examine the current screenshot (and screenshot history if provided)
2. Compare the visible state against the stated goal
3. Consider both the step history and visual progression — is the agent making progress or stuck?
4. If the goal is partially complete, provide specific feedback on what remains
5. Determine if the goal is **impossible** to accomplish given the current state (see below)

## Response Format
Respond with ONLY a JSON object (no other text):

**Goal accomplished:**
```json
{
  "done": true,
  "impossible": false,
  "confidence": 0.95,
  "reason": "The goal has been accomplished — [specific evidence]",
  "feedback": ""
}
```

**Goal not yet accomplished but still achievable:**
```json
{
  "done": false,
  "impossible": false,
  "confidence": 0.7,
  "reason": "The agent is making progress but has not yet completed [specific remaining work]",
  "feedback": "Specific guidance on what the agent should do next"
}
```

**Goal is impossible to accomplish:**
```json
{
  "done": false,
  "impossible": true,
  "confidence": 0.9,
  "reason": "The goal cannot be accomplished because [specific blocker]",
  "feedback": ""
}
```

## Field Definitions
- **"done"**: `true` ONLY if the goal is fully accomplished and visible on screen
- **"impossible"**: `true` when you are confident the goal **cannot** be accomplished regardless of what actions the agent takes. Set this when you observe:
  - Access denied / permission errors that the agent cannot resolve
  - The target page, element, or feature does not exist
  - The agent is stuck in an unrecoverable loop (same actions, same results, no progress)
  - A prerequisite is missing that the agent has no way to fulfill
  - An error message on screen indicates a permanent failure (not a transient/retryable error)
  - The agent has tried multiple distinct approaches and all have failed
- **"confidence"**: how certain you are (0.0 = guessing, 1.0 = absolutely certain)
- **"reason"**: concise explanation of what you see and why you reached your verdict
- **"feedback"**: if not done and not impossible, specific guidance on what the agent should do next. Empty string if done or impossible.

**Important:** Be conservative with `"impossible": true`. Only use it when you are genuinely confident there is no path forward. If the agent has only tried one approach and it failed, suggest an alternative approach instead. Reserve impossibility for situations where all reasonable paths are clearly blocked.
';
  p_Priority_ce9711f8 := 1;
  p_IsActive_ce9711f8 := 1;
  PERFORM __mj."spCreateTemplateContent"(p_ID := p_ID_ce9711f8, p_TemplateID := p_TemplateID_ce9711f8, p_TypeID := p_TypeID_ce9711f8, p_TemplateText := p_TemplateText_ce9711f8, p_Priority := p_Priority_ce9711f8, p_IsActive := p_IsActive_ce9711f8);
END $$;

-- Save MJ: Template Params (core SP call only)
DO $$
DECLARE
  p_ID_a59d9103 UUID;
  p_TemplateID_a59d9103 UUID;
  p_Name_a59d9103 VARCHAR(255);
  p_Description_a59d9103 TEXT;
  p_Type_a59d9103 VARCHAR(20);
  p_DefaultValue_a59d9103 TEXT;
  p_IsRequired_a59d9103 BOOLEAN;
  p_LinkedParameterName_a59d9103 VARCHAR(255);
  p_LinkedParameterField_a59d9103 VARCHAR(500);
  p_ExtraFilter_a59d9103 TEXT;
  p_EntityID_a59d9103 UUID;
  p_RecordID_a59d9103 VARCHAR(2000);
  p_OrderBy_a59d9103 TEXT;
  p_TemplateContentID_a59d9103 UUID;
BEGIN
  p_ID_a59d9103 := '84e1345d-0ca4-4a6f-856b-5090e2a9a9bc';
  p_TemplateID_a59d9103 := '022FCA9F-5EA9-4E7E-8FF7-BBEF4365CD2A';
  p_Name_a59d9103 := 'goal';
  p_Description_a59d9103 := 'The browser-automation goal that the agent is attempting to accomplish';
  p_Type_a59d9103 := 'Scalar';
  p_IsRequired_a59d9103 := 0;
  PERFORM __mj."spCreateTemplateParam"(p_ID := p_ID_a59d9103, p_TemplateID := p_TemplateID_a59d9103, p_Name := p_Name_a59d9103, p_Description := p_Description_a59d9103, p_Type := p_Type_a59d9103, p_DefaultValue := p_DefaultValue_a59d9103, p_IsRequired := p_IsRequired_a59d9103, p_LinkedParameterName := p_LinkedParameterName_a59d9103, p_LinkedParameterField := p_LinkedParameterField_a59d9103, p_ExtraFilter := p_ExtraFilter_a59d9103, p_EntityID := p_EntityID_a59d9103, p_RecordID := p_RecordID_a59d9103, p_OrderBy := p_OrderBy_a59d9103, p_TemplateContentID := p_TemplateContentID_a59d9103);
END $$;

-- Save MJ: Template Params (core SP call only)
DO $$
DECLARE
  p_ID_d3231b3a UUID;
  p_TemplateID_d3231b3a UUID;
  p_Name_d3231b3a VARCHAR(255);
  p_Description_d3231b3a TEXT;
  p_Type_d3231b3a VARCHAR(20);
  p_DefaultValue_d3231b3a TEXT;
  p_IsRequired_d3231b3a BOOLEAN;
  p_LinkedParameterName_d3231b3a VARCHAR(255);
  p_LinkedParameterField_d3231b3a VARCHAR(500);
  p_ExtraFilter_d3231b3a TEXT;
  p_EntityID_d3231b3a UUID;
  p_RecordID_d3231b3a VARCHAR(2000);
  p_OrderBy_d3231b3a TEXT;
  p_TemplateContentID_d3231b3a UUID;
BEGIN
  p_ID_d3231b3a := 'd98d9288-3d0c-42d7-9862-91182a3ade04';
  p_TemplateID_d3231b3a := '022FCA9F-5EA9-4E7E-8FF7-BBEF4365CD2A';
  p_Name_d3231b3a := 'stepSummary';
  p_Description_d3231b3a := 'Summary of the steps the agent has executed so far';
  p_Type_d3231b3a := 'Scalar';
  p_IsRequired_d3231b3a := 0;
  PERFORM __mj."spCreateTemplateParam"(p_ID := p_ID_d3231b3a, p_TemplateID := p_TemplateID_d3231b3a, p_Name := p_Name_d3231b3a, p_Description := p_Description_d3231b3a, p_Type := p_Type_d3231b3a, p_DefaultValue := p_DefaultValue_d3231b3a, p_IsRequired := p_IsRequired_d3231b3a, p_LinkedParameterName := p_LinkedParameterName_d3231b3a, p_LinkedParameterField := p_LinkedParameterField_d3231b3a, p_ExtraFilter := p_ExtraFilter_d3231b3a, p_EntityID := p_EntityID_d3231b3a, p_RecordID := p_RecordID_d3231b3a, p_OrderBy := p_OrderBy_d3231b3a, p_TemplateContentID := p_TemplateContentID_d3231b3a);
END $$;

-- Save MJ: Template Params (core SP call only)
DO $$
DECLARE
  p_ID_a060bd3d UUID;
  p_TemplateID_a060bd3d UUID;
  p_Name_a060bd3d VARCHAR(255);
  p_Description_a060bd3d TEXT;
  p_Type_a060bd3d VARCHAR(20);
  p_DefaultValue_a060bd3d TEXT;
  p_IsRequired_a060bd3d BOOLEAN;
  p_LinkedParameterName_a060bd3d VARCHAR(255);
  p_LinkedParameterField_a060bd3d VARCHAR(500);
  p_ExtraFilter_a060bd3d TEXT;
  p_EntityID_a060bd3d UUID;
  p_RecordID_a060bd3d VARCHAR(2000);
  p_OrderBy_a060bd3d TEXT;
  p_TemplateContentID_a060bd3d UUID;
BEGIN
  p_ID_a060bd3d := '48c082a9-c07f-476d-a589-1cb1a3ca9a27';
  p_TemplateID_a060bd3d := '022FCA9F-5EA9-4E7E-8FF7-BBEF4365CD2A';
  p_Name_a060bd3d := 'stepNumber';
  p_Description_a060bd3d := 'Current step index in the agent’s execution';
  p_Type_a060bd3d := 'Scalar';
  p_IsRequired_a060bd3d := 0;
  PERFORM __mj."spCreateTemplateParam"(p_ID := p_ID_a060bd3d, p_TemplateID := p_TemplateID_a060bd3d, p_Name := p_Name_a060bd3d, p_Description := p_Description_a060bd3d, p_Type := p_Type_a060bd3d, p_DefaultValue := p_DefaultValue_a060bd3d, p_IsRequired := p_IsRequired_a060bd3d, p_LinkedParameterName := p_LinkedParameterName_a060bd3d, p_LinkedParameterField := p_LinkedParameterField_a060bd3d, p_ExtraFilter := p_ExtraFilter_a060bd3d, p_EntityID := p_EntityID_a060bd3d, p_RecordID := p_RecordID_a060bd3d, p_OrderBy := p_OrderBy_a060bd3d, p_TemplateContentID := p_TemplateContentID_a060bd3d);
END $$;

-- Save MJ: Template Params (core SP call only)
DO $$
DECLARE
  p_ID_353bd1f7 UUID;
  p_TemplateID_353bd1f7 UUID;
  p_Name_353bd1f7 VARCHAR(255);
  p_Description_353bd1f7 TEXT;
  p_Type_353bd1f7 VARCHAR(20);
  p_DefaultValue_353bd1f7 TEXT;
  p_IsRequired_353bd1f7 BOOLEAN;
  p_LinkedParameterName_353bd1f7 VARCHAR(255);
  p_LinkedParameterField_353bd1f7 VARCHAR(500);
  p_ExtraFilter_353bd1f7 TEXT;
  p_EntityID_353bd1f7 UUID;
  p_RecordID_353bd1f7 VARCHAR(2000);
  p_OrderBy_353bd1f7 TEXT;
  p_TemplateContentID_353bd1f7 UUID;
BEGIN
  p_ID_353bd1f7 := '705fa3b9-ea14-4ccc-9dff-954036ff9cde';
  p_TemplateID_353bd1f7 := '022FCA9F-5EA9-4E7E-8FF7-BBEF4365CD2A';
  p_Name_353bd1f7 := 'maxSteps';
  p_Description_353bd1f7 := 'Maximum number of steps the agent is allowed to take';
  p_Type_353bd1f7 := 'Scalar';
  p_IsRequired_353bd1f7 := 0;
  PERFORM __mj."spCreateTemplateParam"(p_ID := p_ID_353bd1f7, p_TemplateID := p_TemplateID_353bd1f7, p_Name := p_Name_353bd1f7, p_Description := p_Description_353bd1f7, p_Type := p_Type_353bd1f7, p_DefaultValue := p_DefaultValue_353bd1f7, p_IsRequired := p_IsRequired_353bd1f7, p_LinkedParameterName := p_LinkedParameterName_353bd1f7, p_LinkedParameterField := p_LinkedParameterField_353bd1f7, p_ExtraFilter := p_ExtraFilter_353bd1f7, p_EntityID := p_EntityID_353bd1f7, p_RecordID := p_RecordID_353bd1f7, p_OrderBy := p_OrderBy_353bd1f7, p_TemplateContentID := p_TemplateContentID_353bd1f7);
END $$;

-- Save MJ: Template Params (core SP call only)
DO $$
DECLARE
  p_ID_3157bc53 UUID;
  p_TemplateID_3157bc53 UUID;
  p_Name_3157bc53 VARCHAR(255);
  p_Description_3157bc53 TEXT;
  p_Type_3157bc53 VARCHAR(20);
  p_DefaultValue_3157bc53 TEXT;
  p_IsRequired_3157bc53 BOOLEAN;
  p_LinkedParameterName_3157bc53 VARCHAR(255);
  p_LinkedParameterField_3157bc53 VARCHAR(500);
  p_ExtraFilter_3157bc53 TEXT;
  p_EntityID_3157bc53 UUID;
  p_RecordID_3157bc53 VARCHAR(2000);
  p_OrderBy_3157bc53 TEXT;
  p_TemplateContentID_3157bc53 UUID;
BEGIN
  p_ID_3157bc53 := 'e5acb813-cbbe-4f80-bca7-a92c1c818d4d';
  p_TemplateID_3157bc53 := '022FCA9F-5EA9-4E7E-8FF7-BBEF4365CD2A';
  p_Name_3157bc53 := 'currentUrl';
  p_Description_3157bc53 := 'Current browser URL for visual context';
  p_Type_3157bc53 := 'Scalar';
  p_IsRequired_3157bc53 := 0;
  PERFORM __mj."spCreateTemplateParam"(p_ID := p_ID_3157bc53, p_TemplateID := p_TemplateID_3157bc53, p_Name := p_Name_3157bc53, p_Description := p_Description_3157bc53, p_Type := p_Type_3157bc53, p_DefaultValue := p_DefaultValue_3157bc53, p_IsRequired := p_IsRequired_3157bc53, p_LinkedParameterName := p_LinkedParameterName_3157bc53, p_LinkedParameterField := p_LinkedParameterField_3157bc53, p_ExtraFilter := p_ExtraFilter_3157bc53, p_EntityID := p_EntityID_3157bc53, p_RecordID := p_RecordID_3157bc53, p_OrderBy := p_OrderBy_3157bc53, p_TemplateContentID := p_TemplateContentID_3157bc53);
END $$;

-- Save MJ: AI Prompts (core SP call only)
DO $$
DECLARE
  p_ID_c3c2440a UUID;
  p_Name_c3c2440a VARCHAR(255);
  p_Description_c3c2440a TEXT;
  p_TemplateID_c3c2440a UUID;
  p_CategoryID_c3c2440a UUID;
  p_TypeID_c3c2440a UUID;
  p_Status_c3c2440a VARCHAR(50);
  p_ResponseFormat_c3c2440a VARCHAR(20);
  p_ModelSpecificResponseFormat_c3c2440a TEXT;
  p_AIModelTypeID_c3c2440a UUID;
  p_MinPowerRank_c3c2440a INTEGER;
  p_SelectionStrategy_c3c2440a VARCHAR(20);
  p_PowerPreference_c3c2440a VARCHAR(20);
  p_ParallelizationMode_c3c2440a VARCHAR(20);
  p_ParallelCount_c3c2440a INTEGER;
  p_ParallelConfigParam_c3c2440a VARCHAR(100);
  p_OutputType_c3c2440a VARCHAR(50);
  p_OutputExample_c3c2440a TEXT;
  p_ValidationBehavior_c3c2440a VARCHAR(50);
  p_MaxRetries_c3c2440a INTEGER;
  p_RetryDelayMS_c3c2440a INTEGER;
  p_RetryStrategy_c3c2440a VARCHAR(20);
  p_ResultSelectorPromptID_c3c2440a UUID;
  p_EnableCaching_c3c2440a BOOLEAN;
  p_CacheTTLSeconds_c3c2440a INTEGER;
  p_CacheMatchType_c3c2440a VARCHAR(20);
  p_CacheSimilarityThreshold_c3c2440a DOUBLE PRECISION;
  p_CacheMustMatchModel_c3c2440a BOOLEAN;
  p_CacheMustMatchVendor_c3c2440a BOOLEAN;
  p_CacheMustMatchAgent_c3c2440a BOOLEAN;
  p_CacheMustMatchConfig_c3c2440a BOOLEAN;
  p_PromptRole_c3c2440a VARCHAR(20);
  p_PromptPosition_c3c2440a VARCHAR(20);
  p_Temperature_c3c2440a NUMERIC(3,2);
  p_TopP_c3c2440a NUMERIC(3,2);
  p_TopK_c3c2440a INTEGER;
  p_MinP_c3c2440a NUMERIC(3,2);
  p_FrequencyPenalty_c3c2440a NUMERIC(3,2);
  p_PresencePenalty_c3c2440a NUMERIC(3,2);
  p_Seed_c3c2440a INTEGER;
  p_StopSequences_c3c2440a VARCHAR(1000);
  p_IncludeLogProbs_c3c2440a BOOLEAN;
  p_TopLogProbs_c3c2440a INTEGER;
  p_FailoverStrategy_c3c2440a VARCHAR(50);
  p_FailoverMaxAttempts_c3c2440a INTEGER;
  p_FailoverDelaySeconds_c3c2440a INTEGER;
  p_FailoverModelStrategy_c3c2440a VARCHAR(50);
  p_FailoverErrorScope_c3c2440a VARCHAR(50);
  p_EffortLevel_c3c2440a INTEGER;
BEGIN
  p_ID_c3c2440a := 'DAFE960C-1CDA-4612-965C-A3CD400387E6';
  p_Name_c3c2440a := 'Computer Use - Judge';
  p_Description_c3c2440a := 'System prompt for the Computer Use judge evaluator. Analyzes screenshots and step history to determine whether the browser automation agent has accomplished its stated goal. Returns a structured JSON verdict with done/confidence/reason/feedback fields.';
  p_TemplateID_c3c2440a := '022FCA9F-5EA9-4E7E-8FF7-BBEF4365CD2A';
  p_CategoryID_c3c2440a := '7D2DEF7F-138F-4620-8309-33964A97A997';
  p_TypeID_c3c2440a := 'A6DA423E-F36B-1410-8DAC-00021F8B792E';
  p_Status_c3c2440a := 'Active';
  p_ResponseFormat_c3c2440a := 'JSON';
  p_MinPowerRank_c3c2440a := 0;
  p_SelectionStrategy_c3c2440a := 'Specific';
  p_PowerPreference_c3c2440a := 'Highest';
  p_ParallelizationMode_c3c2440a := 'None';
  p_OutputType_c3c2440a := 'object';
  p_OutputExample_c3c2440a := '{"done":false,"confidence":0.3,"reason":"The agent has navigated to the page but has not yet completed the goal.","feedback":"Try clicking on the search input field next."}';
  p_ValidationBehavior_c3c2440a := 'Warn';
  p_MaxRetries_c3c2440a := 1;
  p_RetryDelayMS_c3c2440a := 1000;
  p_RetryStrategy_c3c2440a := 'Fixed';
  p_EnableCaching_c3c2440a := 0;
  p_CacheMatchType_c3c2440a := 'Exact';
  p_CacheMustMatchModel_c3c2440a := 1;
  p_CacheMustMatchVendor_c3c2440a := 1;
  p_CacheMustMatchAgent_c3c2440a := 0;
  p_CacheMustMatchConfig_c3c2440a := 0;
  p_PromptRole_c3c2440a := 'System';
  p_PromptPosition_c3c2440a := 'First';
  p_IncludeLogProbs_c3c2440a := 0;
  p_FailoverStrategy_c3c2440a := 'SameModelDifferentVendor';
  p_FailoverMaxAttempts_c3c2440a := 3;
  p_FailoverDelaySeconds_c3c2440a := 5;
  p_FailoverModelStrategy_c3c2440a := 'PreferSameModel';
  p_FailoverErrorScope_c3c2440a := 'All';
  PERFORM __mj."spCreateAIPrompt"(p_ID := p_ID_c3c2440a, p_Name := p_Name_c3c2440a, p_Description := p_Description_c3c2440a, p_TemplateID := p_TemplateID_c3c2440a, p_CategoryID := p_CategoryID_c3c2440a, p_TypeID := p_TypeID_c3c2440a, p_Status := p_Status_c3c2440a, p_ResponseFormat := p_ResponseFormat_c3c2440a, p_ModelSpecificResponseFormat := p_ModelSpecificResponseFormat_c3c2440a, p_AIModelTypeID := p_AIModelTypeID_c3c2440a, p_MinPowerRank := p_MinPowerRank_c3c2440a, p_SelectionStrategy := p_SelectionStrategy_c3c2440a, p_PowerPreference := p_PowerPreference_c3c2440a, p_ParallelizationMode := p_ParallelizationMode_c3c2440a, p_ParallelCount := p_ParallelCount_c3c2440a, p_ParallelConfigParam := p_ParallelConfigParam_c3c2440a, p_OutputType := p_OutputType_c3c2440a, p_OutputExample := p_OutputExample_c3c2440a, p_ValidationBehavior := p_ValidationBehavior_c3c2440a, p_MaxRetries := p_MaxRetries_c3c2440a, p_RetryDelayMS := p_RetryDelayMS_c3c2440a, p_RetryStrategy := p_RetryStrategy_c3c2440a, p_ResultSelectorPromptID := p_ResultSelectorPromptID_c3c2440a, p_EnableCaching := p_EnableCaching_c3c2440a, p_CacheTTLSeconds := p_CacheTTLSeconds_c3c2440a, p_CacheMatchType := p_CacheMatchType_c3c2440a, p_CacheSimilarityThreshold := p_CacheSimilarityThreshold_c3c2440a, p_CacheMustMatchModel := p_CacheMustMatchModel_c3c2440a, p_CacheMustMatchVendor := p_CacheMustMatchVendor_c3c2440a, p_CacheMustMatchAgent := p_CacheMustMatchAgent_c3c2440a, p_CacheMustMatchConfig := p_CacheMustMatchConfig_c3c2440a, p_PromptRole := p_PromptRole_c3c2440a, p_PromptPosition := p_PromptPosition_c3c2440a, p_Temperature := p_Temperature_c3c2440a, p_TopP := p_TopP_c3c2440a, p_TopK := p_TopK_c3c2440a, p_MinP := p_MinP_c3c2440a, p_FrequencyPenalty := p_FrequencyPenalty_c3c2440a, p_PresencePenalty := p_PresencePenalty_c3c2440a, p_Seed := p_Seed_c3c2440a, p_StopSequences := p_StopSequences_c3c2440a, p_IncludeLogProbs := p_IncludeLogProbs_c3c2440a, p_TopLogProbs := p_TopLogProbs_c3c2440a, p_FailoverStrategy := p_FailoverStrategy_c3c2440a, p_FailoverMaxAttempts := p_FailoverMaxAttempts_c3c2440a, p_FailoverDelaySeconds := p_FailoverDelaySeconds_c3c2440a, p_FailoverModelStrategy := p_FailoverModelStrategy_c3c2440a, p_FailoverErrorScope := p_FailoverErrorScope_c3c2440a, p_EffortLevel := p_EffortLevel_c3c2440a);
END $$;

-- Save MJ: Template Params (core SP call only)
DO $$
DECLARE
  p_ID_78625134 UUID;
  p_TemplateID_78625134 UUID;
  p_Name_78625134 VARCHAR(255);
  p_Description_78625134 TEXT;
  p_Type_78625134 VARCHAR(20);
  p_DefaultValue_78625134 TEXT;
  p_IsRequired_78625134 BOOLEAN;
  p_LinkedParameterName_78625134 VARCHAR(255);
  p_LinkedParameterField_78625134 VARCHAR(500);
  p_ExtraFilter_78625134 TEXT;
  p_EntityID_78625134 UUID;
  p_RecordID_78625134 VARCHAR(2000);
  p_OrderBy_78625134 TEXT;
  p_TemplateContentID_78625134 UUID;
BEGIN
  p_ID_78625134 := '915667cb-c18b-45e2-a764-16fcd9dcde67';
  p_TemplateID_78625134 := 'EBBE0B44-6A44-4F4D-B426-3DA257CD6B1D';
  p_Name_78625134 := 'goal';
  p_Description_78625134 := 'The browser automation goal to accomplish';
  p_Type_78625134 := 'Scalar';
  p_IsRequired_78625134 := 0;
  PERFORM __mj."spCreateTemplateParam"(p_ID := p_ID_78625134, p_TemplateID := p_TemplateID_78625134, p_Name := p_Name_78625134, p_Description := p_Description_78625134, p_Type := p_Type_78625134, p_DefaultValue := p_DefaultValue_78625134, p_IsRequired := p_IsRequired_78625134, p_LinkedParameterName := p_LinkedParameterName_78625134, p_LinkedParameterField := p_LinkedParameterField_78625134, p_ExtraFilter := p_ExtraFilter_78625134, p_EntityID := p_EntityID_78625134, p_RecordID := p_RecordID_78625134, p_OrderBy := p_OrderBy_78625134, p_TemplateContentID := p_TemplateContentID_78625134);
END $$;

-- Save MJ: Template Params (core SP call only)
DO $$
DECLARE
  p_ID_2c1068b6 UUID;
  p_TemplateID_2c1068b6 UUID;
  p_Name_2c1068b6 VARCHAR(255);
  p_Description_2c1068b6 TEXT;
  p_Type_2c1068b6 VARCHAR(20);
  p_DefaultValue_2c1068b6 TEXT;
  p_IsRequired_2c1068b6 BOOLEAN;
  p_LinkedParameterName_2c1068b6 VARCHAR(255);
  p_LinkedParameterField_2c1068b6 VARCHAR(500);
  p_ExtraFilter_2c1068b6 TEXT;
  p_EntityID_2c1068b6 UUID;
  p_RecordID_2c1068b6 VARCHAR(2000);
  p_OrderBy_2c1068b6 TEXT;
  p_TemplateContentID_2c1068b6 UUID;
BEGIN
  p_ID_2c1068b6 := 'dad41572-2982-4a05-8384-79360e88dabd';
  p_TemplateID_2c1068b6 := 'EBBE0B44-6A44-4F4D-B426-3DA257CD6B1D';
  p_Name_2c1068b6 := 'stepNumber';
  p_Description_2c1068b6 := 'Current step number in the automation sequence';
  p_Type_2c1068b6 := 'Scalar';
  p_IsRequired_2c1068b6 := 0;
  PERFORM __mj."spCreateTemplateParam"(p_ID := p_ID_2c1068b6, p_TemplateID := p_TemplateID_2c1068b6, p_Name := p_Name_2c1068b6, p_Description := p_Description_2c1068b6, p_Type := p_Type_2c1068b6, p_DefaultValue := p_DefaultValue_2c1068b6, p_IsRequired := p_IsRequired_2c1068b6, p_LinkedParameterName := p_LinkedParameterName_2c1068b6, p_LinkedParameterField := p_LinkedParameterField_2c1068b6, p_ExtraFilter := p_ExtraFilter_2c1068b6, p_EntityID := p_EntityID_2c1068b6, p_RecordID := p_RecordID_2c1068b6, p_OrderBy := p_OrderBy_2c1068b6, p_TemplateContentID := p_TemplateContentID_2c1068b6);
END $$;

-- Save MJ: Template Params (core SP call only)
DO $$
DECLARE
  p_ID_431af877 UUID;
  p_TemplateID_431af877 UUID;
  p_Name_431af877 VARCHAR(255);
  p_Description_431af877 TEXT;
  p_Type_431af877 VARCHAR(20);
  p_DefaultValue_431af877 TEXT;
  p_IsRequired_431af877 BOOLEAN;
  p_LinkedParameterName_431af877 VARCHAR(255);
  p_LinkedParameterField_431af877 VARCHAR(500);
  p_ExtraFilter_431af877 TEXT;
  p_EntityID_431af877 UUID;
  p_RecordID_431af877 VARCHAR(2000);
  p_OrderBy_431af877 TEXT;
  p_TemplateContentID_431af877 UUID;
BEGIN
  p_ID_431af877 := '14d5d35b-2a7b-4b94-88cd-99ae787f64dc';
  p_TemplateID_431af877 := 'EBBE0B44-6A44-4F4D-B426-3DA257CD6B1D';
  p_Name_431af877 := 'maxSteps';
  p_Description_431af877 := 'Maximum number of steps allowed for the automation';
  p_Type_431af877 := 'Scalar';
  p_IsRequired_431af877 := 0;
  PERFORM __mj."spCreateTemplateParam"(p_ID := p_ID_431af877, p_TemplateID := p_TemplateID_431af877, p_Name := p_Name_431af877, p_Description := p_Description_431af877, p_Type := p_Type_431af877, p_DefaultValue := p_DefaultValue_431af877, p_IsRequired := p_IsRequired_431af877, p_LinkedParameterName := p_LinkedParameterName_431af877, p_LinkedParameterField := p_LinkedParameterField_431af877, p_ExtraFilter := p_ExtraFilter_431af877, p_EntityID := p_EntityID_431af877, p_RecordID := p_RecordID_431af877, p_OrderBy := p_OrderBy_431af877, p_TemplateContentID := p_TemplateContentID_431af877);
END $$;

-- Save MJ: Template Params (core SP call only)
DO $$
DECLARE
  p_ID_646d9b9d UUID;
  p_TemplateID_646d9b9d UUID;
  p_Name_646d9b9d VARCHAR(255);
  p_Description_646d9b9d TEXT;
  p_Type_646d9b9d VARCHAR(20);
  p_DefaultValue_646d9b9d TEXT;
  p_IsRequired_646d9b9d BOOLEAN;
  p_LinkedParameterName_646d9b9d VARCHAR(255);
  p_LinkedParameterField_646d9b9d VARCHAR(500);
  p_ExtraFilter_646d9b9d TEXT;
  p_EntityID_646d9b9d UUID;
  p_RecordID_646d9b9d VARCHAR(2000);
  p_OrderBy_646d9b9d TEXT;
  p_TemplateContentID_646d9b9d UUID;
BEGIN
  p_ID_646d9b9d := 'f88b1caa-0643-4bb4-b677-138db2dd177c';
  p_TemplateID_646d9b9d := 'EBBE0B44-6A44-4F4D-B426-3DA257CD6B1D';
  p_Name_646d9b9d := 'currentUrl';
  p_Description_646d9b9d := 'Current browser URL';
  p_Type_646d9b9d := 'Scalar';
  p_IsRequired_646d9b9d := 0;
  PERFORM __mj."spCreateTemplateParam"(p_ID := p_ID_646d9b9d, p_TemplateID := p_TemplateID_646d9b9d, p_Name := p_Name_646d9b9d, p_Description := p_Description_646d9b9d, p_Type := p_Type_646d9b9d, p_DefaultValue := p_DefaultValue_646d9b9d, p_IsRequired := p_IsRequired_646d9b9d, p_LinkedParameterName := p_LinkedParameterName_646d9b9d, p_LinkedParameterField := p_LinkedParameterField_646d9b9d, p_ExtraFilter := p_ExtraFilter_646d9b9d, p_EntityID := p_EntityID_646d9b9d, p_RecordID := p_RecordID_646d9b9d, p_OrderBy := p_OrderBy_646d9b9d, p_TemplateContentID := p_TemplateContentID_646d9b9d);
END $$;

-- Save MJ: Template Params (core SP call only)
DO $$
DECLARE
  p_ID_ace0656e UUID;
  p_TemplateID_ace0656e UUID;
  p_Name_ace0656e VARCHAR(255);
  p_Description_ace0656e TEXT;
  p_Type_ace0656e VARCHAR(20);
  p_DefaultValue_ace0656e TEXT;
  p_IsRequired_ace0656e BOOLEAN;
  p_LinkedParameterName_ace0656e VARCHAR(255);
  p_LinkedParameterField_ace0656e VARCHAR(500);
  p_ExtraFilter_ace0656e TEXT;
  p_EntityID_ace0656e UUID;
  p_RecordID_ace0656e VARCHAR(2000);
  p_OrderBy_ace0656e TEXT;
  p_TemplateContentID_ace0656e UUID;
BEGIN
  p_ID_ace0656e := 'ceb22413-2213-44bd-bfb8-c98e7c06216b';
  p_TemplateID_ace0656e := 'EBBE0B44-6A44-4F4D-B426-3DA257CD6B1D';
  p_Name_ace0656e := 'toolDefinitions';
  p_Description_ace0656e := 'List of available tool definitions with name, description, and input schema';
  p_Type_ace0656e := 'Array';
  p_IsRequired_ace0656e := 0;
  PERFORM __mj."spCreateTemplateParam"(p_ID := p_ID_ace0656e, p_TemplateID := p_TemplateID_ace0656e, p_Name := p_Name_ace0656e, p_Description := p_Description_ace0656e, p_Type := p_Type_ace0656e, p_DefaultValue := p_DefaultValue_ace0656e, p_IsRequired := p_IsRequired_ace0656e, p_LinkedParameterName := p_LinkedParameterName_ace0656e, p_LinkedParameterField := p_LinkedParameterField_ace0656e, p_ExtraFilter := p_ExtraFilter_ace0656e, p_EntityID := p_EntityID_ace0656e, p_RecordID := p_RecordID_ace0656e, p_OrderBy := p_OrderBy_ace0656e, p_TemplateContentID := p_TemplateContentID_ace0656e);
END $$;

-- Save MJ: Template Params (core SP call only)
DO $$
DECLARE
  p_ID_e1112545 UUID;
  p_TemplateID_e1112545 UUID;
  p_Name_e1112545 VARCHAR(255);
  p_Description_e1112545 TEXT;
  p_Type_e1112545 VARCHAR(20);
  p_DefaultValue_e1112545 TEXT;
  p_IsRequired_e1112545 BOOLEAN;
  p_LinkedParameterName_e1112545 VARCHAR(255);
  p_LinkedParameterField_e1112545 VARCHAR(500);
  p_ExtraFilter_e1112545 TEXT;
  p_EntityID_e1112545 UUID;
  p_RecordID_e1112545 VARCHAR(2000);
  p_OrderBy_e1112545 TEXT;
  p_TemplateContentID_e1112545 UUID;
BEGIN
  p_ID_e1112545 := '3de5f12f-8bfd-4ef4-abb5-1c161c0aa3d2';
  p_TemplateID_e1112545 := 'EBBE0B44-6A44-4F4D-B426-3DA257CD6B1D';
  p_Name_e1112545 := 'formLoginCredentials';
  p_Description_e1112545 := 'Login credentials object containing domain, username, and password';
  p_Type_e1112545 := 'Object';
  p_IsRequired_e1112545 := 0;
  PERFORM __mj."spCreateTemplateParam"(p_ID := p_ID_e1112545, p_TemplateID := p_TemplateID_e1112545, p_Name := p_Name_e1112545, p_Description := p_Description_e1112545, p_Type := p_Type_e1112545, p_DefaultValue := p_DefaultValue_e1112545, p_IsRequired := p_IsRequired_e1112545, p_LinkedParameterName := p_LinkedParameterName_e1112545, p_LinkedParameterField := p_LinkedParameterField_e1112545, p_ExtraFilter := p_ExtraFilter_e1112545, p_EntityID := p_EntityID_e1112545, p_RecordID := p_RecordID_e1112545, p_OrderBy := p_OrderBy_e1112545, p_TemplateContentID := p_TemplateContentID_e1112545);
END $$;

-- Save MJ: Template Params (core SP call only)
DO $$
DECLARE
  p_ID_2cdab08d UUID;
  p_TemplateID_2cdab08d UUID;
  p_Name_2cdab08d VARCHAR(255);
  p_Description_2cdab08d TEXT;
  p_Type_2cdab08d VARCHAR(20);
  p_DefaultValue_2cdab08d TEXT;
  p_IsRequired_2cdab08d BOOLEAN;
  p_LinkedParameterName_2cdab08d VARCHAR(255);
  p_LinkedParameterField_2cdab08d VARCHAR(500);
  p_ExtraFilter_2cdab08d TEXT;
  p_EntityID_2cdab08d UUID;
  p_RecordID_2cdab08d VARCHAR(2000);
  p_OrderBy_2cdab08d TEXT;
  p_TemplateContentID_2cdab08d UUID;
BEGIN
  p_ID_2cdab08d := 'ffb37f6a-59c7-441e-8e48-f628d1117c19';
  p_TemplateID_2cdab08d := 'EBBE0B44-6A44-4F4D-B426-3DA257CD6B1D';
  p_Name_2cdab08d := 'judgeFeedback';
  p_Description_2cdab08d := 'Feedback from previous evaluation to consider';
  p_Type_2cdab08d := 'Scalar';
  p_IsRequired_2cdab08d := 0;
  PERFORM __mj."spCreateTemplateParam"(p_ID := p_ID_2cdab08d, p_TemplateID := p_TemplateID_2cdab08d, p_Name := p_Name_2cdab08d, p_Description := p_Description_2cdab08d, p_Type := p_Type_2cdab08d, p_DefaultValue := p_DefaultValue_2cdab08d, p_IsRequired := p_IsRequired_2cdab08d, p_LinkedParameterName := p_LinkedParameterName_2cdab08d, p_LinkedParameterField := p_LinkedParameterField_2cdab08d, p_ExtraFilter := p_ExtraFilter_2cdab08d, p_EntityID := p_EntityID_2cdab08d, p_RecordID := p_RecordID_2cdab08d, p_OrderBy := p_OrderBy_2cdab08d, p_TemplateContentID := p_TemplateContentID_2cdab08d);
END $$;

-- Save MJ: Template Params (core SP call only)
DO $$
DECLARE
  p_ID_014a7046 UUID;
  p_TemplateID_014a7046 UUID;
  p_Name_014a7046 VARCHAR(255);
  p_Description_014a7046 TEXT;
  p_Type_014a7046 VARCHAR(20);
  p_DefaultValue_014a7046 TEXT;
  p_IsRequired_014a7046 BOOLEAN;
  p_LinkedParameterName_014a7046 VARCHAR(255);
  p_LinkedParameterField_014a7046 VARCHAR(500);
  p_ExtraFilter_014a7046 TEXT;
  p_EntityID_014a7046 UUID;
  p_RecordID_014a7046 VARCHAR(2000);
  p_OrderBy_014a7046 TEXT;
  p_TemplateContentID_014a7046 UUID;
BEGIN
  p_ID_014a7046 := '6a7fde58-12bf-4992-8e3e-a878bed34c43';
  p_TemplateID_014a7046 := 'EBBE0B44-6A44-4F4D-B426-3DA257CD6B1D';
  p_Name_014a7046 := 'previousStepSummary';
  p_Description_014a7046 := 'Summary of previous actions taken';
  p_Type_014a7046 := 'Scalar';
  p_IsRequired_014a7046 := 0;
  PERFORM __mj."spCreateTemplateParam"(p_ID := p_ID_014a7046, p_TemplateID := p_TemplateID_014a7046, p_Name := p_Name_014a7046, p_Description := p_Description_014a7046, p_Type := p_Type_014a7046, p_DefaultValue := p_DefaultValue_014a7046, p_IsRequired := p_IsRequired_014a7046, p_LinkedParameterName := p_LinkedParameterName_014a7046, p_LinkedParameterField := p_LinkedParameterField_014a7046, p_ExtraFilter := p_ExtraFilter_014a7046, p_EntityID := p_EntityID_014a7046, p_RecordID := p_RecordID_014a7046, p_OrderBy := p_OrderBy_014a7046, p_TemplateContentID := p_TemplateContentID_014a7046);
END $$;

-- Save MJ: AI Prompts (core SP call only)
DO $$
DECLARE
  p_ID_7ef35eab UUID;
  p_Name_7ef35eab VARCHAR(255);
  p_Description_7ef35eab TEXT;
  p_TemplateID_7ef35eab UUID;
  p_CategoryID_7ef35eab UUID;
  p_TypeID_7ef35eab UUID;
  p_Status_7ef35eab VARCHAR(50);
  p_ResponseFormat_7ef35eab VARCHAR(20);
  p_ModelSpecificResponseFormat_7ef35eab TEXT;
  p_AIModelTypeID_7ef35eab UUID;
  p_MinPowerRank_7ef35eab INTEGER;
  p_SelectionStrategy_7ef35eab VARCHAR(20);
  p_PowerPreference_7ef35eab VARCHAR(20);
  p_ParallelizationMode_7ef35eab VARCHAR(20);
  p_ParallelCount_7ef35eab INTEGER;
  p_ParallelConfigParam_7ef35eab VARCHAR(100);
  p_OutputType_7ef35eab VARCHAR(50);
  p_OutputExample_7ef35eab TEXT;
  p_ValidationBehavior_7ef35eab VARCHAR(50);
  p_MaxRetries_7ef35eab INTEGER;
  p_RetryDelayMS_7ef35eab INTEGER;
  p_RetryStrategy_7ef35eab VARCHAR(20);
  p_ResultSelectorPromptID_7ef35eab UUID;
  p_EnableCaching_7ef35eab BOOLEAN;
  p_CacheTTLSeconds_7ef35eab INTEGER;
  p_CacheMatchType_7ef35eab VARCHAR(20);
  p_CacheSimilarityThreshold_7ef35eab DOUBLE PRECISION;
  p_CacheMustMatchModel_7ef35eab BOOLEAN;
  p_CacheMustMatchVendor_7ef35eab BOOLEAN;
  p_CacheMustMatchAgent_7ef35eab BOOLEAN;
  p_CacheMustMatchConfig_7ef35eab BOOLEAN;
  p_PromptRole_7ef35eab VARCHAR(20);
  p_PromptPosition_7ef35eab VARCHAR(20);
  p_Temperature_7ef35eab NUMERIC(3,2);
  p_TopP_7ef35eab NUMERIC(3,2);
  p_TopK_7ef35eab INTEGER;
  p_MinP_7ef35eab NUMERIC(3,2);
  p_FrequencyPenalty_7ef35eab NUMERIC(3,2);
  p_PresencePenalty_7ef35eab NUMERIC(3,2);
  p_Seed_7ef35eab INTEGER;
  p_StopSequences_7ef35eab VARCHAR(1000);
  p_IncludeLogProbs_7ef35eab BOOLEAN;
  p_TopLogProbs_7ef35eab INTEGER;
  p_FailoverStrategy_7ef35eab VARCHAR(50);
  p_FailoverMaxAttempts_7ef35eab INTEGER;
  p_FailoverDelaySeconds_7ef35eab INTEGER;
  p_FailoverModelStrategy_7ef35eab VARCHAR(50);
  p_FailoverErrorScope_7ef35eab VARCHAR(50);
  p_EffortLevel_7ef35eab INTEGER;
BEGIN
  p_ID_7ef35eab := '35FF7A4B-B64A-4052-AD78-9DA8FBCF021A';
  p_Name_7ef35eab := 'Computer Use - Controller';
  p_Description_7ef35eab := 'System prompt for the Computer Use browser automation controller. Instructs the LLM to analyze screenshots of a web browser and decide what actions to take (click, type, navigate, scroll, etc.) to accomplish a stated goal. Outputs structured JSON with reasoning, actions, and optional tool calls.';
  p_TemplateID_7ef35eab := 'EBBE0B44-6A44-4F4D-B426-3DA257CD6B1D';
  p_CategoryID_7ef35eab := '7D2DEF7F-138F-4620-8309-33964A97A997';
  p_TypeID_7ef35eab := 'A6DA423E-F36B-1410-8DAC-00021F8B792E';
  p_Status_7ef35eab := 'Active';
  p_ResponseFormat_7ef35eab := 'JSON';
  p_MinPowerRank_7ef35eab := 0;
  p_SelectionStrategy_7ef35eab := 'Specific';
  p_PowerPreference_7ef35eab := 'Highest';
  p_ParallelizationMode_7ef35eab := 'None';
  p_OutputType_7ef35eab := 'object';
  p_OutputExample_7ef35eab := '{"reasoning":"The page has loaded and I can see the text editor area. I will click on it to focus it.","actions":[{"Type":"Click","BoundingBox":{"XMin":100,"YMin":200,"XMax":900,"YMax":600}}],"toolCalls":[]}';
  p_ValidationBehavior_7ef35eab := 'Warn';
  p_MaxRetries_7ef35eab := 1;
  p_RetryDelayMS_7ef35eab := 1000;
  p_RetryStrategy_7ef35eab := 'Fixed';
  p_EnableCaching_7ef35eab := 0;
  p_CacheMatchType_7ef35eab := 'Exact';
  p_CacheMustMatchModel_7ef35eab := 1;
  p_CacheMustMatchVendor_7ef35eab := 1;
  p_CacheMustMatchAgent_7ef35eab := 0;
  p_CacheMustMatchConfig_7ef35eab := 0;
  p_PromptRole_7ef35eab := 'System';
  p_PromptPosition_7ef35eab := 'First';
  p_IncludeLogProbs_7ef35eab := 0;
  p_FailoverStrategy_7ef35eab := 'SameModelDifferentVendor';
  p_FailoverMaxAttempts_7ef35eab := 3;
  p_FailoverDelaySeconds_7ef35eab := 5;
  p_FailoverModelStrategy_7ef35eab := 'PreferSameModel';
  p_FailoverErrorScope_7ef35eab := 'All';
  PERFORM __mj."spCreateAIPrompt"(p_ID := p_ID_7ef35eab, p_Name := p_Name_7ef35eab, p_Description := p_Description_7ef35eab, p_TemplateID := p_TemplateID_7ef35eab, p_CategoryID := p_CategoryID_7ef35eab, p_TypeID := p_TypeID_7ef35eab, p_Status := p_Status_7ef35eab, p_ResponseFormat := p_ResponseFormat_7ef35eab, p_ModelSpecificResponseFormat := p_ModelSpecificResponseFormat_7ef35eab, p_AIModelTypeID := p_AIModelTypeID_7ef35eab, p_MinPowerRank := p_MinPowerRank_7ef35eab, p_SelectionStrategy := p_SelectionStrategy_7ef35eab, p_PowerPreference := p_PowerPreference_7ef35eab, p_ParallelizationMode := p_ParallelizationMode_7ef35eab, p_ParallelCount := p_ParallelCount_7ef35eab, p_ParallelConfigParam := p_ParallelConfigParam_7ef35eab, p_OutputType := p_OutputType_7ef35eab, p_OutputExample := p_OutputExample_7ef35eab, p_ValidationBehavior := p_ValidationBehavior_7ef35eab, p_MaxRetries := p_MaxRetries_7ef35eab, p_RetryDelayMS := p_RetryDelayMS_7ef35eab, p_RetryStrategy := p_RetryStrategy_7ef35eab, p_ResultSelectorPromptID := p_ResultSelectorPromptID_7ef35eab, p_EnableCaching := p_EnableCaching_7ef35eab, p_CacheTTLSeconds := p_CacheTTLSeconds_7ef35eab, p_CacheMatchType := p_CacheMatchType_7ef35eab, p_CacheSimilarityThreshold := p_CacheSimilarityThreshold_7ef35eab, p_CacheMustMatchModel := p_CacheMustMatchModel_7ef35eab, p_CacheMustMatchVendor := p_CacheMustMatchVendor_7ef35eab, p_CacheMustMatchAgent := p_CacheMustMatchAgent_7ef35eab, p_CacheMustMatchConfig := p_CacheMustMatchConfig_7ef35eab, p_PromptRole := p_PromptRole_7ef35eab, p_PromptPosition := p_PromptPosition_7ef35eab, p_Temperature := p_Temperature_7ef35eab, p_TopP := p_TopP_7ef35eab, p_TopK := p_TopK_7ef35eab, p_MinP := p_MinP_7ef35eab, p_FrequencyPenalty := p_FrequencyPenalty_7ef35eab, p_PresencePenalty := p_PresencePenalty_7ef35eab, p_Seed := p_Seed_7ef35eab, p_StopSequences := p_StopSequences_7ef35eab, p_IncludeLogProbs := p_IncludeLogProbs_7ef35eab, p_TopLogProbs := p_TopLogProbs_7ef35eab, p_FailoverStrategy := p_FailoverStrategy_7ef35eab, p_FailoverMaxAttempts := p_FailoverMaxAttempts_7ef35eab, p_FailoverDelaySeconds := p_FailoverDelaySeconds_7ef35eab, p_FailoverModelStrategy := p_FailoverModelStrategy_7ef35eab, p_FailoverErrorScope := p_FailoverErrorScope_7ef35eab, p_EffortLevel := p_EffortLevel_7ef35eab);
END $$;

-- Save MJ: AI Prompt Models (core SP call only)
DO $$
DECLARE
  p_ID_d85aa8d4 UUID;
  p_PromptID_d85aa8d4 UUID;
  p_ModelID_d85aa8d4 UUID;
  p_VendorID_d85aa8d4 UUID;
  p_ConfigurationID_d85aa8d4 UUID;
  p_Priority_d85aa8d4 INTEGER;
  p_ExecutionGroup_d85aa8d4 INTEGER;
  p_ModelParameters_d85aa8d4 TEXT;
  p_Status_d85aa8d4 VARCHAR(20);
  p_ParallelizationMode_d85aa8d4 VARCHAR(20);
  p_ParallelCount_d85aa8d4 INTEGER;
  p_ParallelConfigParam_d85aa8d4 VARCHAR(100);
  p_EffortLevel_d85aa8d4 INTEGER;
BEGIN
  p_ID_d85aa8d4 := '8C56B221-225D-4AA0-ADDA-6804AEAE332A';
  p_PromptID_d85aa8d4 := '35FF7A4B-B64A-4052-AD78-9DA8FBCF021A';
  p_ModelID_d85aa8d4 := '7B31F48E-EDA3-47B4-9602-D98B7EB1AF45';
  p_VendorID_d85aa8d4 := 'E4A5CCEC-6A37-EF11-86D4-000D3A4E707E';
  p_Priority_d85aa8d4 := 1;
  p_ExecutionGroup_d85aa8d4 := 0;
  p_Status_d85aa8d4 := 'Active';
  p_ParallelizationMode_d85aa8d4 := 'None';
  p_ParallelCount_d85aa8d4 := 1;
  PERFORM __mj."spCreateAIPromptModel"(p_ID := p_ID_d85aa8d4, p_PromptID := p_PromptID_d85aa8d4, p_ModelID := p_ModelID_d85aa8d4, p_VendorID := p_VendorID_d85aa8d4, p_ConfigurationID := p_ConfigurationID_d85aa8d4, p_Priority := p_Priority_d85aa8d4, p_ExecutionGroup := p_ExecutionGroup_d85aa8d4, p_ModelParameters := p_ModelParameters_d85aa8d4, p_Status := p_Status_d85aa8d4, p_ParallelizationMode := p_ParallelizationMode_d85aa8d4, p_ParallelCount := p_ParallelCount_d85aa8d4, p_ParallelConfigParam := p_ParallelConfigParam_d85aa8d4, p_EffortLevel := p_EffortLevel_d85aa8d4);
END $$;

-- Save MJ: AI Prompt Models (core SP call only)
DO $$
DECLARE
  p_ID_4dc0d175 UUID;
  p_PromptID_4dc0d175 UUID;
  p_ModelID_4dc0d175 UUID;
  p_VendorID_4dc0d175 UUID;
  p_ConfigurationID_4dc0d175 UUID;
  p_Priority_4dc0d175 INTEGER;
  p_ExecutionGroup_4dc0d175 INTEGER;
  p_ModelParameters_4dc0d175 TEXT;
  p_Status_4dc0d175 VARCHAR(20);
  p_ParallelizationMode_4dc0d175 VARCHAR(20);
  p_ParallelCount_4dc0d175 INTEGER;
  p_ParallelConfigParam_4dc0d175 VARCHAR(100);
  p_EffortLevel_4dc0d175 INTEGER;
BEGIN
  p_ID_4dc0d175 := '855B1D42-9D3D-4B2B-9AFC-A61DB0993D47';
  p_PromptID_4dc0d175 := 'DAFE960C-1CDA-4612-965C-A3CD400387E6';
  p_ModelID_4dc0d175 := '7B31F48E-EDA3-47B4-9602-D98B7EB1AF45';
  p_VendorID_4dc0d175 := 'E4A5CCEC-6A37-EF11-86D4-000D3A4E707E';
  p_Priority_4dc0d175 := 1;
  p_ExecutionGroup_4dc0d175 := 0;
  p_Status_4dc0d175 := 'Active';
  p_ParallelizationMode_4dc0d175 := 'None';
  p_ParallelCount_4dc0d175 := 1;
  PERFORM __mj."spCreateAIPromptModel"(p_ID := p_ID_4dc0d175, p_PromptID := p_PromptID_4dc0d175, p_ModelID := p_ModelID_4dc0d175, p_VendorID := p_VendorID_4dc0d175, p_ConfigurationID := p_ConfigurationID_4dc0d175, p_Priority := p_Priority_4dc0d175, p_ExecutionGroup := p_ExecutionGroup_4dc0d175, p_ModelParameters := p_ModelParameters_4dc0d175, p_Status := p_Status_4dc0d175, p_ParallelizationMode := p_ParallelizationMode_4dc0d175, p_ParallelCount := p_ParallelCount_4dc0d175, p_ParallelConfigParam := p_ParallelConfigParam_4dc0d175, p_EffortLevel := p_EffortLevel_4dc0d175);
END $$;

-- Save MJ: Template Contents (core SP call only)
DO $$
DECLARE
  p_TemplateID_d5488260 UUID;
  p_TypeID_d5488260 UUID;
  p_TemplateText_d5488260 TEXT;
  p_Priority_d5488260 INTEGER;
  p_IsActive_d5488260 BOOLEAN;
  p_ID_d5488260 UUID;
BEGIN
  p_TemplateID_d5488260 := 'F9F16E70-2C65-46E7-86FC-D9D3026D36E1';
  p_TypeID_d5488260 := 'E7AFCCEC-6A37-EF11-86D4-000D3A4E707E';
  p_TemplateText_d5488260 := '# Query Strategist

You are the **Query Strategist**, a technical sub-agent of the Query Builder. Your job is to translate business requirements into optimized SQL queries, test them, and return structured results to your parent agent.

## CRITICAL: You Are a SUB-AGENT

You are NOT talking to the end user directly. Your chat messages go to the **Query Builder** parent agent, which relays them to the user. You must:

- **NEVER set `terminate: true`** — always return control to the parent agent
- **NEVER complete the conversation** — the parent decides when the conversation ends
- **ALWAYS return your results in the exact payload format specified below**

## CRITICAL: `message` vs `payloadChangeRequest`

You have two output channels. Understand the difference:

- **`message`**: A short text summary of what you did in this pass. The parent agent relays this to the user. Keep it to 1-2 sentences. Example: `"Queried agent runs for the last 30 days, grouped by agent. Found 5 agents with varying activity levels."`
- **`payloadChangeRequest`**: The structured payload change. **ALL plan content, data, and SQL go here — NEVER in `message`.** Remember to use the `replaceElements` wrapper as described in your system prompt — putting data directly in `payloadChangeRequest` without an operation wrapper will silently fail.

## Deciding What To Do

**Read the parent''s message carefully to determine where you are in the workflow:**

1. **New request** (no prior plan mentioned):
   a. Start at Step 1 (Explore the schema)
   b. Assess complexity (see below)
   c. If **simple** → proceed directly through Steps 1 → 3 → 4 → 5 in one pass (skip Step 2)
   d. If **complex/ambiguous** → go to Step 2 (present plan for user approval via payload), then wait

2. **Plan approved** (parent says "looks good", "go ahead", "proceed", "approved") → Skip to Step 3 (Write SQL) then Step 4 (Test) then Step 5 (Return Results)
3. **Plan feedback** (parent says "also add X", "change grouping to Y", "use monthly instead") → Incorporate the feedback, then Steps 3 → 4 → 5. Do NOT re-present the plan — just execute with the changes.
4. **Refinement request on existing results** (parent says "add a filter for X", "break down by week") → Go straight to Step 3 with the modified SQL, then Steps 4 → 5.

**NEVER re-present a plan if the parent''s message indicates a plan was already shown and discussed.** Only present a plan for approval on the first request for a complex/ambiguous query.

### Complexity Assessment

After exploring the schema (Step 1), decide if this is a **simple** or **complex** query:

**Simple** (proceed directly — no plan approval needed):
- Single entity or one obvious JOIN
- Clear metrics/columns requested (e.g., "show me agent runs", "list recent orders")
- Standard filtering (date range, status, top N)
- Unambiguous request with a clear answer

**Complex** (present plan for approval first):
- Multiple entities with non-obvious join paths
- Ambiguous request that could be interpreted multiple ways
- Complex aggregations, window functions, or CTEs
- The user''s request mentions vague concepts that could map to different entities
- Multiple valid approaches exist and the user should choose

**When in doubt, default to simple (one-pass).** Users can always ask for changes after seeing results.

## Workflow

### 1. Explore the Schema
- Use **Get Entity Details** action to inspect entity fields, relationships, and foreign keys
- Use the **ALL_ENTITIES** data source to find relevant entities by name or description
- Identify the right entities and their join paths

### 2. Present Plan for Approval (COMPLEX/AMBIGUOUS QUERIES ONLY)

**Skip this step entirely for simple queries.** Only do this when the complexity assessment says the query is complex or ambiguous.

Present the plan via `payloadChangeRequest` (NOT `message`) so the viewer can display it, along with a `responseForm` for easy approval.

The `plan` field is markdown that renders in a dedicated "Plan" tab. Structure it using this template:

````
## Overview
2-3 sentence summary of what the query will answer and why. Written for a business user.

## Query Logic
```mermaid
flowchart TD
    A[Source: AI Agent Runs] -->|filter| B[Last 30 Days]
    B -->|group by| C[Per Agent]
    C -->|calculate| D[Success Rate · Avg Duration · Total Cost]
    D -->|sort by| E[Most Runs First]
```

## Data Sources

### AI Agents (`[__mj].vwAIAgents`)
- **Name** — Agent display name (used for grouping)

### AI Agent Runs (`[__mj].vwAIAgentRuns`)
- **AgentID** — Links each run to its agent (JOIN key)
- **Status** — Run outcome (`Completed`, `Failed`, etc.)
- **StartedAt** — Execution timestamp (used for date filtering)
- **DurationMS** — Run time in milliseconds
- **TotalCost** — Estimated cost per run

## Relationships
```mermaid
erDiagram
    AIAgents ||--o{ AIAgentRuns : "has runs"
    AIAgents { uuid ID PK string Name }
    AIAgentRuns { uuid ID PK uuid AgentID FK string Status datetime StartedAt }
```

## Filters & Conditions
- Runs filtered to last 30 days (`StartedAt >= DATEADD(DAY, -30, GETDATE())`)
- Grouped by agent name
- Sorted by total runs descending
````

Include all sections. The **Query Logic** flowchart is the most important — business users understand flow diagrams best, so put it right after the overview.

```json
{
  "taskComplete": false,
  "message": "Built a query plan for your review. This one has a few possible approaches so I''d like your input before running it.",
  "payloadChangeRequest": {
    "replaceElements": {
      "source": "query",
      "title": "Descriptive Title",
      "plan": "<plan markdown following the template above>",
      "columns": [],
      "rows": [],
      "metadata": {}
    }
  },
  "responseForm": {
    "questions": [
      {
        "id": "planDecision",
        "label": "How does this plan look?",
        "type": {
          "type": "buttongroup",
          "options": [
            { "value": "approve", "label": "Looks good, run it!" },
            { "value": "modify", "label": "I''d like some changes" }
          ]
        }
      }
    ]
  },
  "nextStep": {
    "type": "Chat"
  }
}
```

**Key points about plan-only payloads:**
- `columns`, `rows` are empty arrays (no results yet)
- `metadata` is an empty object
- The viewer will display the plan content when there are no rows
- `message` is just a short sentence — NOT the plan itself

**Then wait for the parent to relay the user''s decision.** Incorporate any feedback before moving to step 3.

### 3. Write SQL
- Always use **BaseView** names with the correct schema prefix: `SchemaName.vwEntityName`
- **Get the schema from entity metadata**: Each entity has a `SchemaName` property (returned by **Get Entity Details**). Many entities use `__mj`, but entities can live in **any schema** (e.g., `dbo`, `sales`, `hr`, `custom`). **Never assume `__mj`** — always check.
- **Never** use raw table names — always use views
- Use proper JOINs, WHERE clauses, and aggregations
- For parameters, use Nunjucks syntax: `{{paramName}}`
- For optional parameters: `{% if paramName %}AND Field = ''{{paramName}}''{% endif %}`
- Name parameters descriptively: `startDate`, `customerStatus`, `minOrderTotal`

### 4. Test the Query
- Use **Execute Research Query** action to run the SQL and get a **sample** of results
- **Set `MaxRows` to 10** when testing — you only need a small sample to verify correctness. The action defaults to 1000 rows if you don''t specify, which wastes tokens during development.
- Verify the columns, data types, and sample values make sense
- Refine the SQL if results are unexpected
- **Do NOT modify your SQL with TOP** — the action''s `MaxRows` parameter handles row limiting at execution time, keeping your SQL clean for the final result

### 5. Return Results as Payload

Return your response in this exact structure (note: the DataArtifactSpec goes inside `payloadChangeRequest.replaceElements`):

**CRITICAL — String Formatting:**
- **Use real newlines** in `plan`, `metadata.sql`, and all multi-line string values. Do NOT use `\n` escape sequences — they render as literal backslash-n in the UI instead of line breaks.
- Your response is already JSON — the transport layer handles escaping. Just write natural multi-line strings.

```json
{
  "taskComplete": false,
  "message": "Queried agent runs for the last 30 days. Found 5 agents with varying activity levels.",
  "payloadChangeRequest": {
    "replaceElements": {
      "source": "query",
      "title": "Descriptive Title of What This Query Shows",
      "plan": "## Approach\n\n(see plan template in Step 2 — include Overview, Query Logic, Data Sources, Relationships, Filters)",
      "columns": [
        {
          "field": "AgentID",
          "headerName": "Agent ID",
          "sourceEntity": "AI Agents",
          "sourceFieldName": "ID",
          "sqlBaseType": UUID
        },
        {
          "field": "AgentName",
          "headerName": "Agent",
          "sourceEntity": "AI Agents",
          "sourceFieldName": "Name",
          "sqlBaseType": TEXT
        },
        {
          "field": "TotalRuns",
          "headerName": "Total Runs",
          "isComputed": true,
          "isSummary": true,
          "sqlBaseType": INTEGER
        }
      ],
      "rows": [
        { "ColumnName1": "value1", "ColumnName2": 42 },
        { "ColumnName1": "value2", "ColumnName2": 17 }
      ],
      "metadata": {
        "sql": "SELECT a."Name" AS AgentName, COUNT(r."ID") AS TotalRuns FROM [__mj].vwAIAgents a INNER JOIN [__mj].vwAIAgentRuns r ON r."AgentID" = a."ID" GROUP BY a."Name" ORDER BY TotalRuns DESC",
        "rowCount": 2,
        "executionTimeMs": 45
      }
    }
  },
  "nextStep": {
    "type": "Chat"
  }
}
```

**Field requirements:**
- `source`: Always `"query"`
- `title`: Clear, business-friendly description of the query results
- `plan`: **ALWAYS include this field.** Use the plan template from Step 2 (Overview → Query Logic flowchart → Data Sources → Relationships ERD → Filters & Conditions). Even for simple queries, include the plan. It renders in a dedicated "Plan" tab.
- `columns`: Array of ALL columns with enriched metadata (see Column Metadata below)
- `rows`: The actual result data, using the same field names as in `columns`.
- `metadata.sql`: The exact SQL query you ran
- `metadata.rowCount`: Number of rows returned
- `metadata.executionTimeMs`: Execution time from the Execute Research Query result

The `replaceElements` object should have these keys: `source`, `title`, `plan`, `columns`, `rows`, `metadata`.

#### Column Metadata

Each column object in the `columns` array **MUST** include enriched metadata. This enables the grid to render clickable entity links for ID columns, right-align numbers, and format dates.

**Required fields for every column:**
- `field`: The SQL alias (matches keys in `rows`)
- `headerName`: Human-readable display label
- `sqlBaseType`: SQL data type — `INTEGER`, `TEXT`, `UUID`, `datetime`, `decimal`, `bit`, `money`, `float`, `bigint`

**Entity linking fields** (include ONLY for direct, non-aggregated column references):
- `sourceEntity`: The **exact MJ entity name** this column comes from (e.g., `"Members"`, `"MJ: AI Agent Runs"`, `"Event Registrations"`). Must match entity names from ALL_ENTITIES exactly.
- `sourceFieldName`: The original field name in that entity before aliasing (e.g., `"ID"`, `"Name"`, `"Status"`). For JOINed columns, use the entity the field actually belongs to.

**Computation flags** (include when applicable):
- `isComputed`: `true` for any expression — `CASE WHEN`, `CONCAT`, `ROUND()`, `DATEDIFF()`, string concatenation (`+`), etc.
- `isSummary`: `true` for aggregate functions — `SUM()`, `COUNT()`, `AVG()`, `MIN()`, `MAX()`. A column can be both `isComputed` and `isSummary` (e.g., `ROUND(SUM(cost), 2)`).

**How entity linking works:**
- If `sourceFieldName` is a **primary key** (e.g., `"ID"`), the grid renders it as a clickable link to that entity''s record
- If `sourceFieldName` is a **foreign key** (e.g., `"MemberID"`, `"EventID"`), the grid renders it as a clickable link to the related entity
- Columns without `sourceEntity`/`sourceFieldName` display as plain text
- Always provide `sourceEntity` + `sourceFieldName` for ID columns and foreign key columns — this is what makes the grid interactive

**CRITICAL — When to OMIT `sourceEntity`/`sourceFieldName`:**
- **NEVER** set `sourceEntity`/`sourceFieldName` on aggregated or computed columns. These fields mean "this cell contains a direct value from that entity field" — which enables clickable entity links. An aggregate like `COUNT(r."ID")` does NOT contain a record ID, it contains a count. Tagging it with `sourceEntity`/`sourceFieldName` would make the grid try to render "42" as a clickable link to record "42", which is wrong.
- If `isComputed` or `isSummary` is `true`, **omit** `sourceEntity` and `sourceFieldName`
- Only use entity linking on **pass-through columns** — columns that directly output a single field value from one entity row (e.g., `m."ID"`, `m."Name"`, `r."Status"`)

**Examples:**
```
✅ { "field": "MemberID",    "sourceEntity": "Members", "sourceFieldName": "ID" }        — direct PK, clickable
✅ { "field": "MemberName",  "sourceEntity": "Members", "sourceFieldName": "Name" }      — direct field
✅ { "field": "EventID",     "sourceEntity": "Events",  "sourceFieldName": "ID" }        — direct FK, clickable
❌ { "field": "TotalEvents", "sourceEntity": "Event Registrations", "sourceFieldName": "ID", "isSummary": true }  — WRONG! COUNT(er."ID") is not a record ID
✅ { "field": "TotalEvents", "isSummary": true, "sqlBaseType": INTEGER }                   — CORRECT, no entity link
❌ { "field": "AvgCost",     "sourceEntity": "Orders", "sourceFieldName": "TotalCost", "isComputed": true, "isSummary": true }  — WRONG! AVG(o."TotalCost") is not a single order''s cost
✅ { "field": "AvgCost",     "isComputed": true, "isSummary": true, "sqlBaseType": "decimal" }  — CORRECT
```

## SQL Guidelines

### Always Use Views
- Reference `SchemaName.vwEntityName`, never raw tables — e.g., `[__mj].vwMembers`, `dbo.vwOrders`, `sales.vwProducts`
- **Use each entity''s actual `SchemaName`** from Get Entity Details — do NOT assume all entities are in `__mj`
- Views include computed fields and proper joins

### Formatting Standard

Every query you write must follow this formatting standard. Study these examples carefully — this is the quality bar.

**Example 1 — Simple JOIN with aggregation:**
*(Note: These examples use `__mj` because those entities happen to be in that schema. Always check each entity''s `SchemaName` — it could be `dbo`, `sales`, etc.)*
```sql
-- ============================================================
-- Member Event Attendance Summary
-- Which members attend the most events?
-- ============================================================
SELECT
    -- Build display name from first + last
    m."FirstName" + '' '' + m."LastName"       AS MemberName,

    -- Count distinct attended events per member
    COUNT(er."ID")                          AS TotalEventsAttended

FROM [__mj].vwMembers m                    -- SchemaName: __mj

    -- Link to event registrations (one member → many registrations)
    INNER JOIN [__mj].vwEventRegistrations er
        ON m."ID" = er."MemberID"

WHERE
    er."Status" = ''Attended''                -- Only confirmed attendance

GROUP BY
    m."FirstName",
    m."LastName"

ORDER BY
    TotalEventsAttended DESC              -- Most active members first
```

**Example 2 — Multi-table with computed metrics:**
```sql
-- ============================================================
-- AI Agent Performance Dashboard
-- Compare agents by volume, reliability, speed, and cost
-- over the last 30 days
-- ============================================================
SELECT
    a."Name"                                AS AgentName,
    COUNT(r."ID")                           AS TotalRuns,

    -- Success rate: completed runs as a percentage of total
    ROUND(
        100.0 * SUM(
            CASE WHEN r."Status" = ''Completed'' THEN 1 ELSE 0
END
        ) / NULLIF(COUNT(r."ID"), 0),
        1
    )                                     AS SuccessRatePct,

    -- Average duration in seconds (stored as milliseconds)
    ROUND(
        AVG(r."DurationMS") / 1000.0, 1
    )                                     AS AvgDurationSec,

    -- Total estimated cost across all runs
    ROUND(
        SUM(COALESCE(r."TotalCost", 0)), 4
    )                                     AS TotalCost,

    -- Most recent execution timestamp
    MAX(r."StartedAt")                      AS LastRunAt

FROM [__mj].vwAIAgents a

    -- Each agent has zero or more execution runs
    INNER JOIN [__mj].vwAIAgentRuns r
        ON r."AgentID" = a."ID"

WHERE
    r."StartedAt" >= DATEADD(DAY, -30, GETDATE())   -- Last 30 days

GROUP BY
    a."Name"

ORDER BY
    TotalRuns DESC                        -- Most active agents first
```

**Key formatting rules:**
- Header comment block with title and one-line description
- **Do NOT use `TOP N`** — the result grid supports pagination and handles large result sets. Let WHERE/GROUP BY naturally scope the data.
- One column per line, right-aligned `AS` aliases for readability
- Inline comments on computed columns explaining the logic
- JOINs indented under FROM, each with a comment explaining the relationship
- WHERE, GROUP BY, ORDER BY each on their own line with conditions indented
- Trailing comments on filter conditions explaining "why"

### Performance
- **Do NOT use `SELECT TOP N`** for result queries — the viewer grid supports client-side pagination and can handle thousands of rows. Let the query return the full result set scoped by your WHERE clause.
- For exploration queries (schema discovery, sampling), use TOP 50 to keep things fast
- Use appropriate WHERE clauses to scope result sets (date ranges, status filters, etc.)
- Add ORDER BY for predictable output
- Prefer JOINs over subqueries when possible

### Security
- Only SELECT statements — never INSERT, UPDATE, DELETE, or DDL
- Never reference system tables directly
- Use parameterized values, not string concatenation

## Data Sources Available

- **ALL_ENTITIES**: All entity names, descriptions, schemas, base tables, and base views';
  p_Priority_d5488260 := 1;
  p_IsActive_d5488260 := 1;
  p_ID_d5488260 := 'A0A098DF-7F18-43D9-A81F-04BCEB38F5B7';
  PERFORM __mj."spUpdateTemplateContent"(p_TemplateID := p_TemplateID_d5488260, p_TypeID := p_TypeID_d5488260, p_TemplateText := p_TemplateText_d5488260, p_Priority := p_Priority_d5488260, p_IsActive := p_IsActive_d5488260, p_ID := p_ID_d5488260);
END $$;

-- Save MJ: Template Params (core SP call only)
DO $$
DECLARE
  p_ID_73fc9114 UUID;
  p_TemplateID_73fc9114 UUID;
  p_Name_73fc9114 VARCHAR(255);
  p_Description_73fc9114 TEXT;
  p_Type_73fc9114 VARCHAR(20);
  p_DefaultValue_73fc9114 TEXT;
  p_IsRequired_73fc9114 BOOLEAN;
  p_LinkedParameterName_73fc9114 VARCHAR(255);
  p_LinkedParameterField_73fc9114 VARCHAR(500);
  p_ExtraFilter_73fc9114 TEXT;
  p_EntityID_73fc9114 UUID;
  p_RecordID_73fc9114 VARCHAR(2000);
  p_OrderBy_73fc9114 TEXT;
  p_TemplateContentID_73fc9114 UUID;
BEGIN
  p_ID_73fc9114 := 'd7a9d32b-df3c-45f3-a4d9-a94289ca08a4';
  p_TemplateID_73fc9114 := 'F9F16E70-2C65-46E7-86FC-D9D3026D36E1';
  p_Name_73fc9114 := 'taskComplete';
  p_Description_73fc9114 := 'Boolean flag indicating whether the query task is complete';
  p_Type_73fc9114 := 'Scalar';
  p_IsRequired_73fc9114 := 0;
  PERFORM __mj."spCreateTemplateParam"(p_ID := p_ID_73fc9114, p_TemplateID := p_TemplateID_73fc9114, p_Name := p_Name_73fc9114, p_Description := p_Description_73fc9114, p_Type := p_Type_73fc9114, p_DefaultValue := p_DefaultValue_73fc9114, p_IsRequired := p_IsRequired_73fc9114, p_LinkedParameterName := p_LinkedParameterName_73fc9114, p_LinkedParameterField := p_LinkedParameterField_73fc9114, p_ExtraFilter := p_ExtraFilter_73fc9114, p_EntityID := p_EntityID_73fc9114, p_RecordID := p_RecordID_73fc9114, p_OrderBy := p_OrderBy_73fc9114, p_TemplateContentID := p_TemplateContentID_73fc9114);
END $$;

-- Save MJ: Template Params (core SP call only)
DO $$
DECLARE
  p_ID_7ff16a82 UUID;
  p_TemplateID_7ff16a82 UUID;
  p_Name_7ff16a82 VARCHAR(255);
  p_Description_7ff16a82 TEXT;
  p_Type_7ff16a82 VARCHAR(20);
  p_DefaultValue_7ff16a82 TEXT;
  p_IsRequired_7ff16a82 BOOLEAN;
  p_LinkedParameterName_7ff16a82 VARCHAR(255);
  p_LinkedParameterField_7ff16a82 VARCHAR(500);
  p_ExtraFilter_7ff16a82 TEXT;
  p_EntityID_7ff16a82 UUID;
  p_RecordID_7ff16a82 VARCHAR(2000);
  p_OrderBy_7ff16a82 TEXT;
  p_TemplateContentID_7ff16a82 UUID;
BEGIN
  p_ID_7ff16a82 := '5c7ab20f-4c72-41a0-a76f-a0cf2b129b94';
  p_TemplateID_7ff16a82 := 'F9F16E70-2C65-46E7-86FC-D9D3026D36E1';
  p_Name_7ff16a82 := 'message';
  p_Description_7ff16a82 := 'Short text summary of the query results for the user';
  p_Type_7ff16a82 := 'Scalar';
  p_IsRequired_7ff16a82 := 0;
  PERFORM __mj."spCreateTemplateParam"(p_ID := p_ID_7ff16a82, p_TemplateID := p_TemplateID_7ff16a82, p_Name := p_Name_7ff16a82, p_Description := p_Description_7ff16a82, p_Type := p_Type_7ff16a82, p_DefaultValue := p_DefaultValue_7ff16a82, p_IsRequired := p_IsRequired_7ff16a82, p_LinkedParameterName := p_LinkedParameterName_7ff16a82, p_LinkedParameterField := p_LinkedParameterField_7ff16a82, p_ExtraFilter := p_ExtraFilter_7ff16a82, p_EntityID := p_EntityID_7ff16a82, p_RecordID := p_RecordID_7ff16a82, p_OrderBy := p_OrderBy_7ff16a82, p_TemplateContentID := p_TemplateContentID_7ff16a82);
END $$;

-- Save MJ: Template Params (core SP call only)
DO $$
DECLARE
  p_ID_9fac28d6 UUID;
  p_TemplateID_9fac28d6 UUID;
  p_Name_9fac28d6 VARCHAR(255);
  p_Description_9fac28d6 TEXT;
  p_Type_9fac28d6 VARCHAR(20);
  p_DefaultValue_9fac28d6 TEXT;
  p_IsRequired_9fac28d6 BOOLEAN;
  p_LinkedParameterName_9fac28d6 VARCHAR(255);
  p_LinkedParameterField_9fac28d6 VARCHAR(500);
  p_ExtraFilter_9fac28d6 TEXT;
  p_EntityID_9fac28d6 UUID;
  p_RecordID_9fac28d6 VARCHAR(2000);
  p_OrderBy_9fac28d6 TEXT;
  p_TemplateContentID_9fac28d6 UUID;
BEGIN
  p_ID_9fac28d6 := 'ffce5d13-cc6b-49dc-b9cd-05a2d6b915ee';
  p_TemplateID_9fac28d6 := 'F9F16E70-2C65-46E7-86FC-D9D3026D36E1';
  p_Name_9fac28d6 := 'payloadChangeRequest';
  p_Description_9fac28d6 := 'Structured payload containing query results, metadata, and plan';
  p_Type_9fac28d6 := 'Object';
  p_IsRequired_9fac28d6 := 0;
  PERFORM __mj."spCreateTemplateParam"(p_ID := p_ID_9fac28d6, p_TemplateID := p_TemplateID_9fac28d6, p_Name := p_Name_9fac28d6, p_Description := p_Description_9fac28d6, p_Type := p_Type_9fac28d6, p_DefaultValue := p_DefaultValue_9fac28d6, p_IsRequired := p_IsRequired_9fac28d6, p_LinkedParameterName := p_LinkedParameterName_9fac28d6, p_LinkedParameterField := p_LinkedParameterField_9fac28d6, p_ExtraFilter := p_ExtraFilter_9fac28d6, p_EntityID := p_EntityID_9fac28d6, p_RecordID := p_RecordID_9fac28d6, p_OrderBy := p_OrderBy_9fac28d6, p_TemplateContentID := p_TemplateContentID_9fac28d6);
END $$;

-- Save MJ: Template Params (core SP call only)
DO $$
DECLARE
  p_ID_67178810 UUID;
  p_TemplateID_67178810 UUID;
  p_Name_67178810 VARCHAR(255);
  p_Description_67178810 TEXT;
  p_Type_67178810 VARCHAR(20);
  p_DefaultValue_67178810 TEXT;
  p_IsRequired_67178810 BOOLEAN;
  p_LinkedParameterName_67178810 VARCHAR(255);
  p_LinkedParameterField_67178810 VARCHAR(500);
  p_ExtraFilter_67178810 TEXT;
  p_EntityID_67178810 UUID;
  p_RecordID_67178810 VARCHAR(2000);
  p_OrderBy_67178810 TEXT;
  p_TemplateContentID_67178810 UUID;
BEGIN
  p_ID_67178810 := 'c5cebca3-ab8b-412d-8526-f16409d941f5';
  p_TemplateID_67178810 := 'F9F16E70-2C65-46E7-86FC-D9D3026D36E1';
  p_Name_67178810 := 'responseForm';
  p_Description_67178810 := 'Optional form configuration for user interaction';
  p_Type_67178810 := 'Object';
  p_IsRequired_67178810 := 0;
  PERFORM __mj."spCreateTemplateParam"(p_ID := p_ID_67178810, p_TemplateID := p_TemplateID_67178810, p_Name := p_Name_67178810, p_Description := p_Description_67178810, p_Type := p_Type_67178810, p_DefaultValue := p_DefaultValue_67178810, p_IsRequired := p_IsRequired_67178810, p_LinkedParameterName := p_LinkedParameterName_67178810, p_LinkedParameterField := p_LinkedParameterField_67178810, p_ExtraFilter := p_ExtraFilter_67178810, p_EntityID := p_EntityID_67178810, p_RecordID := p_RecordID_67178810, p_OrderBy := p_OrderBy_67178810, p_TemplateContentID := p_TemplateContentID_67178810);
END $$;

-- Save MJ: Template Params (core SP call only)
DO $$
DECLARE
  p_ID_65d88f8a UUID;
  p_TemplateID_65d88f8a UUID;
  p_Name_65d88f8a VARCHAR(255);
  p_Description_65d88f8a TEXT;
  p_Type_65d88f8a VARCHAR(20);
  p_DefaultValue_65d88f8a TEXT;
  p_IsRequired_65d88f8a BOOLEAN;
  p_LinkedParameterName_65d88f8a VARCHAR(255);
  p_LinkedParameterField_65d88f8a VARCHAR(500);
  p_ExtraFilter_65d88f8a TEXT;
  p_EntityID_65d88f8a UUID;
  p_RecordID_65d88f8a VARCHAR(2000);
  p_OrderBy_65d88f8a TEXT;
  p_TemplateContentID_65d88f8a UUID;
BEGIN
  p_ID_65d88f8a := '6ba6fb17-b5e4-41f7-891b-27eb82bcbcd7';
  p_TemplateID_65d88f8a := 'F9F16E70-2C65-46E7-86FC-D9D3026D36E1';
  p_Name_65d88f8a := 'nextStep';
  p_Description_65d88f8a := 'Configuration for the next step in the workflow';
  p_Type_65d88f8a := 'Object';
  p_IsRequired_65d88f8a := 0;
  PERFORM __mj."spCreateTemplateParam"(p_ID := p_ID_65d88f8a, p_TemplateID := p_TemplateID_65d88f8a, p_Name := p_Name_65d88f8a, p_Description := p_Description_65d88f8a, p_Type := p_Type_65d88f8a, p_DefaultValue := p_DefaultValue_65d88f8a, p_IsRequired := p_IsRequired_65d88f8a, p_LinkedParameterName := p_LinkedParameterName_65d88f8a, p_LinkedParameterField := p_LinkedParameterField_65d88f8a, p_ExtraFilter := p_ExtraFilter_65d88f8a, p_EntityID := p_EntityID_65d88f8a, p_RecordID := p_RecordID_65d88f8a, p_OrderBy := p_OrderBy_65d88f8a, p_TemplateContentID := p_TemplateContentID_65d88f8a);
END $$;

-- Save MJ: AI Prompts (core SP call only)
DO $$
DECLARE
  p_Name_16a82bf8 VARCHAR(255);
  p_Description_16a82bf8 TEXT;
  p_TemplateID_16a82bf8 UUID;
  p_CategoryID_16a82bf8 UUID;
  p_TypeID_16a82bf8 UUID;
  p_Status_16a82bf8 VARCHAR(50);
  p_ResponseFormat_16a82bf8 VARCHAR(20);
  p_ModelSpecificResponseFormat_16a82bf8 TEXT;
  p_AIModelTypeID_16a82bf8 UUID;
  p_MinPowerRank_16a82bf8 INTEGER;
  p_SelectionStrategy_16a82bf8 VARCHAR(20);
  p_PowerPreference_16a82bf8 VARCHAR(20);
  p_ParallelizationMode_16a82bf8 VARCHAR(20);
  p_ParallelCount_16a82bf8 INTEGER;
  p_ParallelConfigParam_16a82bf8 VARCHAR(100);
  p_OutputType_16a82bf8 VARCHAR(50);
  p_OutputExample_16a82bf8 TEXT;
  p_ValidationBehavior_16a82bf8 VARCHAR(50);
  p_MaxRetries_16a82bf8 INTEGER;
  p_RetryDelayMS_16a82bf8 INTEGER;
  p_RetryStrategy_16a82bf8 VARCHAR(20);
  p_ResultSelectorPromptID_16a82bf8 UUID;
  p_EnableCaching_16a82bf8 BOOLEAN;
  p_CacheTTLSeconds_16a82bf8 INTEGER;
  p_CacheMatchType_16a82bf8 VARCHAR(20);
  p_CacheSimilarityThreshold_16a82bf8 DOUBLE PRECISION;
  p_CacheMustMatchModel_16a82bf8 BOOLEAN;
  p_CacheMustMatchVendor_16a82bf8 BOOLEAN;
  p_CacheMustMatchAgent_16a82bf8 BOOLEAN;
  p_CacheMustMatchConfig_16a82bf8 BOOLEAN;
  p_PromptRole_16a82bf8 VARCHAR(20);
  p_PromptPosition_16a82bf8 VARCHAR(20);
  p_Temperature_16a82bf8 NUMERIC(3,2);
  p_TopP_16a82bf8 NUMERIC(3,2);
  p_TopK_16a82bf8 INTEGER;
  p_MinP_16a82bf8 NUMERIC(3,2);
  p_FrequencyPenalty_16a82bf8 NUMERIC(3,2);
  p_PresencePenalty_16a82bf8 NUMERIC(3,2);
  p_Seed_16a82bf8 INTEGER;
  p_StopSequences_16a82bf8 VARCHAR(1000);
  p_IncludeLogProbs_16a82bf8 BOOLEAN;
  p_TopLogProbs_16a82bf8 INTEGER;
  p_FailoverStrategy_16a82bf8 VARCHAR(50);
  p_FailoverMaxAttempts_16a82bf8 INTEGER;
  p_FailoverDelaySeconds_16a82bf8 INTEGER;
  p_FailoverModelStrategy_16a82bf8 VARCHAR(50);
  p_FailoverErrorScope_16a82bf8 VARCHAR(50);
  p_EffortLevel_16a82bf8 INTEGER;
  p_ID_16a82bf8 UUID;
BEGIN
  p_Name_16a82bf8 := 'Query Builder - Query Strategist Prompt';
  p_Description_16a82bf8 := 'System prompt for the Query Strategist sub-agent. Handles schema exploration, SQL generation, query testing, and structured result formatting.';
  p_TemplateID_16a82bf8 := 'F9F16E70-2C65-46E7-86FC-D9D3026D36E1';
  p_CategoryID_16a82bf8 := '7D2DEF7F-138F-4620-8309-33964A97A997';
  p_TypeID_16a82bf8 := 'A6DA423E-F36B-1410-8DAC-00021F8B792E';
  p_Status_16a82bf8 := 'Active';
  p_ResponseFormat_16a82bf8 := 'Any';
  p_MinPowerRank_16a82bf8 := 0;
  p_SelectionStrategy_16a82bf8 := 'Default';
  p_PowerPreference_16a82bf8 := 'Highest';
  p_ParallelizationMode_16a82bf8 := 'None';
  p_OutputType_16a82bf8 := 'string';
  p_ValidationBehavior_16a82bf8 := 'Warn';
  p_MaxRetries_16a82bf8 := 0;
  p_RetryDelayMS_16a82bf8 := 0;
  p_RetryStrategy_16a82bf8 := 'Fixed';
  p_EnableCaching_16a82bf8 := 0;
  p_CacheMatchType_16a82bf8 := 'Exact';
  p_CacheMustMatchModel_16a82bf8 := 1;
  p_CacheMustMatchVendor_16a82bf8 := 1;
  p_CacheMustMatchAgent_16a82bf8 := 0;
  p_CacheMustMatchConfig_16a82bf8 := 0;
  p_PromptRole_16a82bf8 := 'System';
  p_PromptPosition_16a82bf8 := 'First';
  p_IncludeLogProbs_16a82bf8 := 0;
  p_FailoverStrategy_16a82bf8 := 'SameModelDifferentVendor';
  p_FailoverMaxAttempts_16a82bf8 := 3;
  p_FailoverDelaySeconds_16a82bf8 := 5;
  p_FailoverModelStrategy_16a82bf8 := 'PreferSameModel';
  p_FailoverErrorScope_16a82bf8 := 'All';
  p_ID_16a82bf8 := '6712859D-9958-416D-A99B-D9517CB00553';
  PERFORM __mj."spUpdateAIPrompt"(p_Name := p_Name_16a82bf8, p_Description := p_Description_16a82bf8, p_TemplateID := p_TemplateID_16a82bf8, p_CategoryID := p_CategoryID_16a82bf8, p_TypeID := p_TypeID_16a82bf8, p_Status := p_Status_16a82bf8, p_ResponseFormat := p_ResponseFormat_16a82bf8, p_ModelSpecificResponseFormat := p_ModelSpecificResponseFormat_16a82bf8, p_AIModelTypeID := p_AIModelTypeID_16a82bf8, p_MinPowerRank := p_MinPowerRank_16a82bf8, p_SelectionStrategy := p_SelectionStrategy_16a82bf8, p_PowerPreference := p_PowerPreference_16a82bf8, p_ParallelizationMode := p_ParallelizationMode_16a82bf8, p_ParallelCount := p_ParallelCount_16a82bf8, p_ParallelConfigParam := p_ParallelConfigParam_16a82bf8, p_OutputType := p_OutputType_16a82bf8, p_OutputExample := p_OutputExample_16a82bf8, p_ValidationBehavior := p_ValidationBehavior_16a82bf8, p_MaxRetries := p_MaxRetries_16a82bf8, p_RetryDelayMS := p_RetryDelayMS_16a82bf8, p_RetryStrategy := p_RetryStrategy_16a82bf8, p_ResultSelectorPromptID := p_ResultSelectorPromptID_16a82bf8, p_EnableCaching := p_EnableCaching_16a82bf8, p_CacheTTLSeconds := p_CacheTTLSeconds_16a82bf8, p_CacheMatchType := p_CacheMatchType_16a82bf8, p_CacheSimilarityThreshold := p_CacheSimilarityThreshold_16a82bf8, p_CacheMustMatchModel := p_CacheMustMatchModel_16a82bf8, p_CacheMustMatchVendor := p_CacheMustMatchVendor_16a82bf8, p_CacheMustMatchAgent := p_CacheMustMatchAgent_16a82bf8, p_CacheMustMatchConfig := p_CacheMustMatchConfig_16a82bf8, p_PromptRole := p_PromptRole_16a82bf8, p_PromptPosition := p_PromptPosition_16a82bf8, p_Temperature := p_Temperature_16a82bf8, p_TopP := p_TopP_16a82bf8, p_TopK := p_TopK_16a82bf8, p_MinP := p_MinP_16a82bf8, p_FrequencyPenalty := p_FrequencyPenalty_16a82bf8, p_PresencePenalty := p_PresencePenalty_16a82bf8, p_Seed := p_Seed_16a82bf8, p_StopSequences := p_StopSequences_16a82bf8, p_IncludeLogProbs := p_IncludeLogProbs_16a82bf8, p_TopLogProbs := p_TopLogProbs_16a82bf8, p_FailoverStrategy := p_FailoverStrategy_16a82bf8, p_FailoverMaxAttempts := p_FailoverMaxAttempts_16a82bf8, p_FailoverDelaySeconds := p_FailoverDelaySeconds_16a82bf8, p_FailoverModelStrategy := p_FailoverModelStrategy_16a82bf8, p_FailoverErrorScope := p_FailoverErrorScope_16a82bf8, p_EffortLevel := p_EffortLevel_16a82bf8, p_ID := p_ID_16a82bf8);
END $$;

-- Save MJ: AI Agents (core SP call only)
DO $$
DECLARE
  p_Name_9fc3b8f0 VARCHAR(255);
  p_Description_9fc3b8f0 TEXT;
  p_LogoURL_9fc3b8f0 VARCHAR(255);
  p_ParentID_9fc3b8f0 UUID;
  p_ExposeAsAction_9fc3b8f0 BOOLEAN;
  p_ExecutionOrder_9fc3b8f0 INTEGER;
  p_ExecutionMode_9fc3b8f0 VARCHAR(20);
  p_EnableContextCompression_9fc3b8f0 BOOLEAN;
  p_ContextCompressionMessageThreshold_9fc3b8f0 INTEGER;
  p_ContextCompressionPromptID_9fc3b8f0 UUID;
  p_ContextCompressionMessageRetentionCount_9fc3b8f0 INTEGER;
  p_TypeID_9fc3b8f0 UUID;
  p_Status_9fc3b8f0 VARCHAR(20);
  p_DriverClass_9fc3b8f0 VARCHAR(255);
  p_IconClass_9fc3b8f0 VARCHAR(100);
  p_ModelSelectionMode_9fc3b8f0 VARCHAR(50);
  p_PayloadDownstreamPaths_9fc3b8f0 TEXT;
  p_PayloadUpstreamPaths_9fc3b8f0 TEXT;
  p_PayloadSelfReadPaths_9fc3b8f0 TEXT;
  p_PayloadSelfWritePaths_9fc3b8f0 TEXT;
  p_PayloadScope_9fc3b8f0 TEXT;
  p_FinalPayloadValidation_9fc3b8f0 TEXT;
  p_FinalPayloadValidationMode_9fc3b8f0 VARCHAR(25);
  p_FinalPayloadValidationMaxRetries_9fc3b8f0 INTEGER;
  p_MaxCostPerRun_9fc3b8f0 NUMERIC(10,4);
  p_MaxTokensPerRun_9fc3b8f0 INTEGER;
  p_MaxIterationsPerRun_9fc3b8f0 INTEGER;
  p_MaxTimePerRun_9fc3b8f0 INTEGER;
  p_MinExecutionsPerRun_9fc3b8f0 INTEGER;
  p_MaxExecutionsPerRun_9fc3b8f0 INTEGER;
  p_StartingPayloadValidation_9fc3b8f0 TEXT;
  p_StartingPayloadValidationMode_9fc3b8f0 VARCHAR(25);
  p_DefaultPromptEffortLevel_9fc3b8f0 INTEGER;
  p_ChatHandlingOption_9fc3b8f0 VARCHAR(30);
  p_DefaultArtifactTypeID_9fc3b8f0 UUID;
  p_OwnerUserID_9fc3b8f0 UUID;
  p_InvocationMode_9fc3b8f0 VARCHAR(20);
  p_ArtifactCreationMode_9fc3b8f0 VARCHAR(20);
  p_FunctionalRequirements_9fc3b8f0 TEXT;
  p_TechnicalDesign_9fc3b8f0 TEXT;
  p_InjectNotes_9fc3b8f0 BOOLEAN;
  p_MaxNotesToInject_9fc3b8f0 INTEGER;
  p_NoteInjectionStrategy_9fc3b8f0 VARCHAR(20);
  p_InjectExamples_9fc3b8f0 BOOLEAN;
  p_MaxExamplesToInject_9fc3b8f0 INTEGER;
  p_ExampleInjectionStrategy_9fc3b8f0 VARCHAR(20);
  p_IsRestricted_9fc3b8f0 BOOLEAN;
  p_MessageMode_9fc3b8f0 VARCHAR(50);
  p_MaxMessages_9fc3b8f0 INTEGER;
  p_AttachmentStorageProviderID_9fc3b8f0 UUID;
  p_AttachmentRootPath_9fc3b8f0 VARCHAR(500);
  p_InlineStorageThresholdBytes_9fc3b8f0 INTEGER;
  p_AgentTypePromptParams_9fc3b8f0 TEXT;
  p_ScopeConfig_9fc3b8f0 TEXT;
  p_NoteRetentionDays_9fc3b8f0 INTEGER;
  p_ExampleRetentionDays_9fc3b8f0 INTEGER;
  p_AutoArchiveEnabled_9fc3b8f0 BOOLEAN;
  p_RerankerConfiguration_9fc3b8f0 TEXT;
  p_ID_9fc3b8f0 UUID;
BEGIN
  p_Name_9fc3b8f0 := 'Query Builder';
  p_Description_9fc3b8f0 := 'Business-friendly orchestrator agent that helps users explore their data and build saved queries. Delegates technical SQL work to the Query Strategist sub-agent. Presents results visually with diagrams and formatted tables, hiding SQL complexity unless the user asks for it.';
  p_ExposeAsAction_9fc3b8f0 := 1;
  p_ExecutionOrder_9fc3b8f0 := 0;
  p_ExecutionMode_9fc3b8f0 := 'Sequential';
  p_EnableContextCompression_9fc3b8f0 := 0;
  p_TypeID_9fc3b8f0 := 'F7926101-5099-4FA5-836A-479D9707C818';
  p_Status_9fc3b8f0 := 'Active';
  p_DriverClass_9fc3b8f0 := 'QueryBuilderAgent';
  p_IconClass_9fc3b8f0 := 'fa-solid fa-hammer';
  p_ModelSelectionMode_9fc3b8f0 := 'Agent';
  p_PayloadDownstreamPaths_9fc3b8f0 := '["*"]';
  p_PayloadUpstreamPaths_9fc3b8f0 := '["*"]';
  p_PayloadSelfWritePaths_9fc3b8f0 := '[
  "source",
  "title",
  "plan",
  "columns.*",
  "rows.*",
  "metadata.*"
]';
  p_FinalPayloadValidation_9fc3b8f0 := '{"source:string:!empty":"query","title:string:!empty":"Descriptive title","plan:string?":"Optional markdown plan","columns:[0+]":[{"field:string:!empty":"ColumnName","headerName?":"Display Name"}],"rows:[0+]":[],"metadata?":{"sql:string?":"SELECT ...","rowCount:number?":0,"executionTimeMs:number?":0}}';
  p_FinalPayloadValidationMode_9fc3b8f0 := 'Retry';
  p_FinalPayloadValidationMaxRetries_9fc3b8f0 := 3;
  p_StartingPayloadValidationMode_9fc3b8f0 := 'Fail';
  p_DefaultArtifactTypeID_9fc3b8f0 := '66E3DA50-3C6B-4B0B-BAD0-8A9CB9A4B1FA';
  p_OwnerUserID_9fc3b8f0 := 'ECAFCCEC-6A37-EF11-86D4-000D3A4E707E';
  p_InvocationMode_9fc3b8f0 := 'Any';
  p_ArtifactCreationMode_9fc3b8f0 := 'Always';
  p_InjectNotes_9fc3b8f0 := 1;
  p_MaxNotesToInject_9fc3b8f0 := 5;
  p_NoteInjectionStrategy_9fc3b8f0 := 'Relevant';
  p_InjectExamples_9fc3b8f0 := 0;
  p_MaxExamplesToInject_9fc3b8f0 := 3;
  p_ExampleInjectionStrategy_9fc3b8f0 := 'Semantic';
  p_IsRestricted_9fc3b8f0 := 0;
  p_MessageMode_9fc3b8f0 := 'None';
  p_NoteRetentionDays_9fc3b8f0 := 90;
  p_ExampleRetentionDays_9fc3b8f0 := 180;
  p_AutoArchiveEnabled_9fc3b8f0 := 1;
  p_ID_9fc3b8f0 := '204FF1D6-A807-4278-B71A-9D692F19E808';
  PERFORM __mj."spUpdateAIAgent"(p_Name := p_Name_9fc3b8f0, p_Description := p_Description_9fc3b8f0, p_LogoURL := p_LogoURL_9fc3b8f0, p_ParentID := p_ParentID_9fc3b8f0, p_ExposeAsAction := p_ExposeAsAction_9fc3b8f0, p_ExecutionOrder := p_ExecutionOrder_9fc3b8f0, p_ExecutionMode := p_ExecutionMode_9fc3b8f0, p_EnableContextCompression := p_EnableContextCompression_9fc3b8f0, p_ContextCompressionMessageThreshold := p_ContextCompressionMessageThreshold_9fc3b8f0, p_ContextCompressionPromptID := p_ContextCompressionPromptID_9fc3b8f0, p_ContextCompressionMessageRetentionCount := p_ContextCompressionMessageRetentionCount_9fc3b8f0, p_TypeID := p_TypeID_9fc3b8f0, p_Status := p_Status_9fc3b8f0, p_DriverClass := p_DriverClass_9fc3b8f0, p_IconClass := p_IconClass_9fc3b8f0, p_ModelSelectionMode := p_ModelSelectionMode_9fc3b8f0, p_PayloadDownstreamPaths := p_PayloadDownstreamPaths_9fc3b8f0, p_PayloadUpstreamPaths := p_PayloadUpstreamPaths_9fc3b8f0, p_PayloadSelfReadPaths := p_PayloadSelfReadPaths_9fc3b8f0, p_PayloadSelfWritePaths := p_PayloadSelfWritePaths_9fc3b8f0, p_PayloadScope := p_PayloadScope_9fc3b8f0, p_FinalPayloadValidation := p_FinalPayloadValidation_9fc3b8f0, p_FinalPayloadValidationMode := p_FinalPayloadValidationMode_9fc3b8f0, p_FinalPayloadValidationMaxRetries := p_FinalPayloadValidationMaxRetries_9fc3b8f0, p_MaxCostPerRun := p_MaxCostPerRun_9fc3b8f0, p_MaxTokensPerRun := p_MaxTokensPerRun_9fc3b8f0, p_MaxIterationsPerRun := p_MaxIterationsPerRun_9fc3b8f0, p_MaxTimePerRun := p_MaxTimePerRun_9fc3b8f0, p_MinExecutionsPerRun := p_MinExecutionsPerRun_9fc3b8f0, p_MaxExecutionsPerRun := p_MaxExecutionsPerRun_9fc3b8f0, p_StartingPayloadValidation := p_StartingPayloadValidation_9fc3b8f0, p_StartingPayloadValidationMode := p_StartingPayloadValidationMode_9fc3b8f0, p_DefaultPromptEffortLevel := p_DefaultPromptEffortLevel_9fc3b8f0, p_ChatHandlingOption := p_ChatHandlingOption_9fc3b8f0, p_DefaultArtifactTypeID := p_DefaultArtifactTypeID_9fc3b8f0, p_OwnerUserID := p_OwnerUserID_9fc3b8f0, p_InvocationMode := p_InvocationMode_9fc3b8f0, p_ArtifactCreationMode := p_ArtifactCreationMode_9fc3b8f0, p_FunctionalRequirements := p_FunctionalRequirements_9fc3b8f0, p_TechnicalDesign := p_TechnicalDesign_9fc3b8f0, p_InjectNotes := p_InjectNotes_9fc3b8f0, p_MaxNotesToInject := p_MaxNotesToInject_9fc3b8f0, p_NoteInjectionStrategy := p_NoteInjectionStrategy_9fc3b8f0, p_InjectExamples := p_InjectExamples_9fc3b8f0, p_MaxExamplesToInject := p_MaxExamplesToInject_9fc3b8f0, p_ExampleInjectionStrategy := p_ExampleInjectionStrategy_9fc3b8f0, p_IsRestricted := p_IsRestricted_9fc3b8f0, p_MessageMode := p_MessageMode_9fc3b8f0, p_MaxMessages := p_MaxMessages_9fc3b8f0, p_AttachmentStorageProviderID := p_AttachmentStorageProviderID_9fc3b8f0, p_AttachmentRootPath := p_AttachmentRootPath_9fc3b8f0, p_InlineStorageThresholdBytes := p_InlineStorageThresholdBytes_9fc3b8f0, p_AgentTypePromptParams := p_AgentTypePromptParams_9fc3b8f0, p_ScopeConfig := p_ScopeConfig_9fc3b8f0, p_NoteRetentionDays := p_NoteRetentionDays_9fc3b8f0, p_ExampleRetentionDays := p_ExampleRetentionDays_9fc3b8f0, p_AutoArchiveEnabled := p_AutoArchiveEnabled_9fc3b8f0, p_RerankerConfiguration := p_RerankerConfiguration_9fc3b8f0, p_ID := p_ID_9fc3b8f0);
END $$;

-- Save MJ: AI Agents (core SP call only)
DO $$
DECLARE
  p_Name_e6a9b4a2 VARCHAR(255);
  p_Description_e6a9b4a2 TEXT;
  p_LogoURL_e6a9b4a2 VARCHAR(255);
  p_ParentID_e6a9b4a2 UUID;
  p_ExposeAsAction_e6a9b4a2 BOOLEAN;
  p_ExecutionOrder_e6a9b4a2 INTEGER;
  p_ExecutionMode_e6a9b4a2 VARCHAR(20);
  p_EnableContextCompression_e6a9b4a2 BOOLEAN;
  p_ContextCompressionMessageThreshold_e6a9b4a2 INTEGER;
  p_ContextCompressionPromptID_e6a9b4a2 UUID;
  p_ContextCompressionMessageRetentionCount_e6a9b4a2 INTEGER;
  p_TypeID_e6a9b4a2 UUID;
  p_Status_e6a9b4a2 VARCHAR(20);
  p_DriverClass_e6a9b4a2 VARCHAR(255);
  p_IconClass_e6a9b4a2 VARCHAR(100);
  p_ModelSelectionMode_e6a9b4a2 VARCHAR(50);
  p_PayloadDownstreamPaths_e6a9b4a2 TEXT;
  p_PayloadUpstreamPaths_e6a9b4a2 TEXT;
  p_PayloadSelfReadPaths_e6a9b4a2 TEXT;
  p_PayloadSelfWritePaths_e6a9b4a2 TEXT;
  p_PayloadScope_e6a9b4a2 TEXT;
  p_FinalPayloadValidation_e6a9b4a2 TEXT;
  p_FinalPayloadValidationMode_e6a9b4a2 VARCHAR(25);
  p_FinalPayloadValidationMaxRetries_e6a9b4a2 INTEGER;
  p_MaxCostPerRun_e6a9b4a2 NUMERIC(10,4);
  p_MaxTokensPerRun_e6a9b4a2 INTEGER;
  p_MaxIterationsPerRun_e6a9b4a2 INTEGER;
  p_MaxTimePerRun_e6a9b4a2 INTEGER;
  p_MinExecutionsPerRun_e6a9b4a2 INTEGER;
  p_MaxExecutionsPerRun_e6a9b4a2 INTEGER;
  p_StartingPayloadValidation_e6a9b4a2 TEXT;
  p_StartingPayloadValidationMode_e6a9b4a2 VARCHAR(25);
  p_DefaultPromptEffortLevel_e6a9b4a2 INTEGER;
  p_ChatHandlingOption_e6a9b4a2 VARCHAR(30);
  p_DefaultArtifactTypeID_e6a9b4a2 UUID;
  p_OwnerUserID_e6a9b4a2 UUID;
  p_InvocationMode_e6a9b4a2 VARCHAR(20);
  p_ArtifactCreationMode_e6a9b4a2 VARCHAR(20);
  p_FunctionalRequirements_e6a9b4a2 TEXT;
  p_TechnicalDesign_e6a9b4a2 TEXT;
  p_InjectNotes_e6a9b4a2 BOOLEAN;
  p_MaxNotesToInject_e6a9b4a2 INTEGER;
  p_NoteInjectionStrategy_e6a9b4a2 VARCHAR(20);
  p_InjectExamples_e6a9b4a2 BOOLEAN;
  p_MaxExamplesToInject_e6a9b4a2 INTEGER;
  p_ExampleInjectionStrategy_e6a9b4a2 VARCHAR(20);
  p_IsRestricted_e6a9b4a2 BOOLEAN;
  p_MessageMode_e6a9b4a2 VARCHAR(50);
  p_MaxMessages_e6a9b4a2 INTEGER;
  p_AttachmentStorageProviderID_e6a9b4a2 UUID;
  p_AttachmentRootPath_e6a9b4a2 VARCHAR(500);
  p_InlineStorageThresholdBytes_e6a9b4a2 INTEGER;
  p_AgentTypePromptParams_e6a9b4a2 TEXT;
  p_ScopeConfig_e6a9b4a2 TEXT;
  p_NoteRetentionDays_e6a9b4a2 INTEGER;
  p_ExampleRetentionDays_e6a9b4a2 INTEGER;
  p_AutoArchiveEnabled_e6a9b4a2 BOOLEAN;
  p_RerankerConfiguration_e6a9b4a2 TEXT;
  p_ID_e6a9b4a2 UUID;
BEGIN
  p_Name_e6a9b4a2 := 'Query Strategist';
  p_Description_e6a9b4a2 := 'Technical sub-agent that handles schema exploration, SQL generation, query testing, and structured result formatting. Translates business requirements from the Query Builder orchestrator into optimized SQL queries.';
  p_ParentID_e6a9b4a2 := '204FF1D6-A807-4278-B71A-9D692F19E808';
  p_ExposeAsAction_e6a9b4a2 := 0;
  p_ExecutionOrder_e6a9b4a2 := 0;
  p_ExecutionMode_e6a9b4a2 := 'Sequential';
  p_EnableContextCompression_e6a9b4a2 := 0;
  p_TypeID_e6a9b4a2 := 'F7926101-5099-4FA5-836A-479D9707C818';
  p_Status_e6a9b4a2 := 'Active';
  p_IconClass_e6a9b4a2 := 'fa-solid fa-database';
  p_ModelSelectionMode_e6a9b4a2 := 'Agent';
  p_PayloadDownstreamPaths_e6a9b4a2 := '[
  "*"
]';
  p_PayloadUpstreamPaths_e6a9b4a2 := '[
  "source",
  "title",
  "plan",
  "columns.*",
  "rows.*",
  "metadata.*"
]';
  p_FinalPayloadValidation_e6a9b4a2 := '{"source:string:!empty":"query","title:string:!empty":"Descriptive title","plan:string?":"Optional markdown plan","columns:[0+]":[{"field:string:!empty":"ColumnName","headerName?":"Display Name"}],"rows:[0+]":[],"metadata?":{"sql:string?":"SELECT ...","rowCount:number?":0,"executionTimeMs:number?":0}}';
  p_FinalPayloadValidationMode_e6a9b4a2 := 'Retry';
  p_FinalPayloadValidationMaxRetries_e6a9b4a2 := 3;
  p_StartingPayloadValidationMode_e6a9b4a2 := 'Fail';
  p_OwnerUserID_e6a9b4a2 := 'ECAFCCEC-6A37-EF11-86D4-000D3A4E707E';
  p_InvocationMode_e6a9b4a2 := 'Sub-Agent';
  p_ArtifactCreationMode_e6a9b4a2 := 'Never';
  p_InjectNotes_e6a9b4a2 := 1;
  p_MaxNotesToInject_e6a9b4a2 := 5;
  p_NoteInjectionStrategy_e6a9b4a2 := 'Relevant';
  p_InjectExamples_e6a9b4a2 := 0;
  p_MaxExamplesToInject_e6a9b4a2 := 3;
  p_ExampleInjectionStrategy_e6a9b4a2 := 'Semantic';
  p_IsRestricted_e6a9b4a2 := 0;
  p_MessageMode_e6a9b4a2 := 'None';
  p_NoteRetentionDays_e6a9b4a2 := 90;
  p_ExampleRetentionDays_e6a9b4a2 := 180;
  p_AutoArchiveEnabled_e6a9b4a2 := 1;
  p_ID_e6a9b4a2 := '17E1C958-909C-41B2-8B52-138AED224108';
  PERFORM __mj."spUpdateAIAgent"(p_Name := p_Name_e6a9b4a2, p_Description := p_Description_e6a9b4a2, p_LogoURL := p_LogoURL_e6a9b4a2, p_ParentID := p_ParentID_e6a9b4a2, p_ExposeAsAction := p_ExposeAsAction_e6a9b4a2, p_ExecutionOrder := p_ExecutionOrder_e6a9b4a2, p_ExecutionMode := p_ExecutionMode_e6a9b4a2, p_EnableContextCompression := p_EnableContextCompression_e6a9b4a2, p_ContextCompressionMessageThreshold := p_ContextCompressionMessageThreshold_e6a9b4a2, p_ContextCompressionPromptID := p_ContextCompressionPromptID_e6a9b4a2, p_ContextCompressionMessageRetentionCount := p_ContextCompressionMessageRetentionCount_e6a9b4a2, p_TypeID := p_TypeID_e6a9b4a2, p_Status := p_Status_e6a9b4a2, p_DriverClass := p_DriverClass_e6a9b4a2, p_IconClass := p_IconClass_e6a9b4a2, p_ModelSelectionMode := p_ModelSelectionMode_e6a9b4a2, p_PayloadDownstreamPaths := p_PayloadDownstreamPaths_e6a9b4a2, p_PayloadUpstreamPaths := p_PayloadUpstreamPaths_e6a9b4a2, p_PayloadSelfReadPaths := p_PayloadSelfReadPaths_e6a9b4a2, p_PayloadSelfWritePaths := p_PayloadSelfWritePaths_e6a9b4a2, p_PayloadScope := p_PayloadScope_e6a9b4a2, p_FinalPayloadValidation := p_FinalPayloadValidation_e6a9b4a2, p_FinalPayloadValidationMode := p_FinalPayloadValidationMode_e6a9b4a2, p_FinalPayloadValidationMaxRetries := p_FinalPayloadValidationMaxRetries_e6a9b4a2, p_MaxCostPerRun := p_MaxCostPerRun_e6a9b4a2, p_MaxTokensPerRun := p_MaxTokensPerRun_e6a9b4a2, p_MaxIterationsPerRun := p_MaxIterationsPerRun_e6a9b4a2, p_MaxTimePerRun := p_MaxTimePerRun_e6a9b4a2, p_MinExecutionsPerRun := p_MinExecutionsPerRun_e6a9b4a2, p_MaxExecutionsPerRun := p_MaxExecutionsPerRun_e6a9b4a2, p_StartingPayloadValidation := p_StartingPayloadValidation_e6a9b4a2, p_StartingPayloadValidationMode := p_StartingPayloadValidationMode_e6a9b4a2, p_DefaultPromptEffortLevel := p_DefaultPromptEffortLevel_e6a9b4a2, p_ChatHandlingOption := p_ChatHandlingOption_e6a9b4a2, p_DefaultArtifactTypeID := p_DefaultArtifactTypeID_e6a9b4a2, p_OwnerUserID := p_OwnerUserID_e6a9b4a2, p_InvocationMode := p_InvocationMode_e6a9b4a2, p_ArtifactCreationMode := p_ArtifactCreationMode_e6a9b4a2, p_FunctionalRequirements := p_FunctionalRequirements_e6a9b4a2, p_TechnicalDesign := p_TechnicalDesign_e6a9b4a2, p_InjectNotes := p_InjectNotes_e6a9b4a2, p_MaxNotesToInject := p_MaxNotesToInject_e6a9b4a2, p_NoteInjectionStrategy := p_NoteInjectionStrategy_e6a9b4a2, p_InjectExamples := p_InjectExamples_e6a9b4a2, p_MaxExamplesToInject := p_MaxExamplesToInject_e6a9b4a2, p_ExampleInjectionStrategy := p_ExampleInjectionStrategy_e6a9b4a2, p_IsRestricted := p_IsRestricted_e6a9b4a2, p_MessageMode := p_MessageMode_e6a9b4a2, p_MaxMessages := p_MaxMessages_e6a9b4a2, p_AttachmentStorageProviderID := p_AttachmentStorageProviderID_e6a9b4a2, p_AttachmentRootPath := p_AttachmentRootPath_e6a9b4a2, p_InlineStorageThresholdBytes := p_InlineStorageThresholdBytes_e6a9b4a2, p_AgentTypePromptParams := p_AgentTypePromptParams_e6a9b4a2, p_ScopeConfig := p_ScopeConfig_e6a9b4a2, p_NoteRetentionDays := p_NoteRetentionDays_e6a9b4a2, p_ExampleRetentionDays := p_ExampleRetentionDays_e6a9b4a2, p_AutoArchiveEnabled := p_AutoArchiveEnabled_e6a9b4a2, p_RerankerConfiguration := p_RerankerConfiguration_e6a9b4a2, p_ID := p_ID_e6a9b4a2);
END $$;

-- Save MJ: Queries (core SP call only)
DO $$
DECLARE
  p_Name_2638b156 VARCHAR(255);
  p_CategoryID_2638b156 UUID;
  p_UserQuestion_2638b156 TEXT;
  p_Description_2638b156 TEXT;
  p_SQL_2638b156 TEXT;
  p_TechnicalDescription_2638b156 TEXT;
  p_OriginalSQL_2638b156 TEXT;
  p_Feedback_2638b156 TEXT;
  p_Status_2638b156 VARCHAR(15);
  p_QualityRank_2638b156 INTEGER;
  p_ExecutionCostRank_2638b156 INTEGER;
  p_UsesTemplate_2638b156 BOOLEAN;
  p_AuditQueryRuns_2638b156 BOOLEAN;
  p_CacheEnabled_2638b156 BOOLEAN;
  p_CacheTTLMinutes_2638b156 INTEGER;
  p_CacheMaxSize_2638b156 INTEGER;
  p_EmbeddingVector_2638b156 TEXT;
  p_EmbeddingModelID_2638b156 UUID;
  p_CacheValidationSQL_2638b156 TEXT;
  p_ID_2638b156 UUID;
BEGIN
  p_Name_2638b156 := 'GetConversationsForMemoryManager';
  p_CategoryID_2638b156 := '5609FBC7-381C-4F9C-9C74-04B52C1FF3DA';
  p_UserQuestion_2638b156 := 'What conversations have new activity that need to be analyzed for memory extraction?';
  p_Description_2638b156 := 'Returns all conversation data needed for memory extraction in a single query: conversations with new activity, their details with ratings, and linked agent runs for scope inheritance. Optimized to replace 4 separate sequential queries.';
  p_SQL_2638b156 := '-- Get Conversations for Memory Manager - Single optimized query
-- Returns all data needed for memory extraction: conversations, details, ratings, and agent runs
-- Uses JSON aggregation to include related data without row multiplication
-- This replaces 4 separate queries with 1 query for better performance
--
-- Parameters:
--   @since (optional): ISO date string - only include conversations with new activity after this date
--   @agentIds: Comma-separated list of agent IDs that have memory enabled

SELECT
    c."ID" as ConversationID,
    c."UserID",

    -- Most recent agent run ID for this conversation (for scope inheritance)
    (
        SELECT TOP 1 ar."ID"
        FROM [__mj].[vwAIAgentRuns] ar
        WHERE ar."ConversationID" = c."ID"
        AND ar."AgentID" IN ({{ agentIds }})
        ORDER BY ar."StartedAt" DESC
    ) as AgentRunID,

    -- Conversation details as JSON array with ratings included
    (
        SELECT
            cd."ID" as id,
            cd."Role" as role,
            cd."Message" as message,
            cd.__mj_CreatedAt as createdAt,
            cdr."Rating" as rating,
            cdr."Comments" as ratingComment
        FROM [__mj].[vwConversationDetails] cd
        LEFT OUTER JOIN [__mj].[vwConversationDetailRatings] cdr
            ON cdr."ConversationDetailID" = cd."ID"
        WHERE cd."ConversationID" = c."ID"
        AND cd."Status" = ''Complete''
        ORDER BY cd.__mj_CreatedAt ASC
        FOR JSON PATH
    ) as MessagesJSON,

    -- Rating summary flags
    CASE WHEN EXISTS (
        SELECT 1 FROM [__mj].[vwConversationDetails] cd
        INNER JOIN [__mj].[vwConversationDetailRatings] cdr ON cdr."ConversationDetailID" = cd."ID"
        WHERE cd."ConversationID" = c."ID" AND cdr."Rating" >= 8
    ) THEN 1 ELSE 0
END as HasPositiveRating,

    CASE WHEN EXISTS (
        SELECT 1 FROM [__mj].[vwConversationDetails] cd
        INNER JOIN [__mj].[vwConversationDetailRatings] cdr ON cdr."ConversationDetailID" = cd."ID"
        WHERE cd."ConversationID" = c."ID" AND cdr."Rating" <= 3
    ) THEN 1 ELSE 0
END as HasNegativeRating,

    CASE WHEN NOT EXISTS (
        SELECT 1 FROM [__mj].[vwConversationDetails] cd
        INNER JOIN [__mj].[vwConversationDetailRatings] cdr ON cdr."ConversationDetailID" = cd."ID"
        WHERE cd."ConversationID" = c."ID"
    ) THEN 1 ELSE 0
END as IsUnrated

FROM [__mj].[vwConversations] c

-- Only include conversations with new activity since last run
WHERE EXISTS (
    SELECT 1 FROM [__mj].[vwConversationDetails] cd_new
    WHERE cd_new."ConversationID" = c."ID"
    {% if since %}
    AND cd_new.__mj_CreatedAt >= ''{{ since }}''
    {% endif %}
)

-- Only include conversations linked to agents that have memory enabled
AND EXISTS (
    SELECT 1 FROM [__mj].[vwAIAgentRuns] ar
    WHERE ar."ConversationID" = c."ID"
    AND ar."AgentID" IN ({{ agentIds }})
)

ORDER BY c.__mj_UpdatedAt DESC
';
  p_TechnicalDescription_2638b156 := 'Single-query optimization that replaces 4 separate RunView calls in Memory Manager (get conversations, get agent runs, get details, get ratings). Uses SQL Server FOR JSON PATH to aggregate conversation details with ratings as JSON arrays. Returns rating summary flags (HasPositiveRating, HasNegativeRating, IsUnrated) and most recent AgentRunID for scope inheritance. Reduces database round trips from 4 to 1.';
  p_Status_2638b156 := 'Approved';
  p_QualityRank_2638b156 := 9;
  p_ExecutionCostRank_2638b156 := 3;
  p_UsesTemplate_2638b156 := 1;
  p_AuditQueryRuns_2638b156 := 0;
  p_CacheEnabled_2638b156 := 0;
  p_EmbeddingVector_2638b156 := '[0.05079127848148346,0.09035059064626694,-0.0241005327552557,0.0002047202578978613,0.007942557334899902,-0.004986656829714775,-0.0040833973325788975,-0.013648014515638351,-0.012232557870447636,-0.016947250813245773,-0.028481926769018173,0.007967942394316196,-0.02684820257127285,0.04656028747558594,-0.052749037742614746,-0.0031639356166124344,0.021843701601028442,-0.00868343934416771,0.024816567078232765,0.024035068228840828,-0.00625630933791399,-0.005105008836835623,0.03923854976892471,-0.03631487116217613,-0.011602414771914482,-0.003479759907349944,-0.04228506609797478,0.019970396533608437,0.03680785372853279,-0.05429837480187416,0.0020721578039228916,0.03860961273312569,-0.063536137342453,0.020076200366020203,0.0000018501910972190672,-0.029065575450658798,-0.04729870334267616,0.016312794759869576,0.0121134789660573,0.033217646181583405,0.06390431523323059,0.010297387838363647,0.04633641615509987,0.013665363192558289,-0.058271877467632294,0.04765554890036583,-0.006883734837174416,-0.06572329252958298,0.046769462525844574,0.02473931387066841,-0.009251734241843224,0.032639279961586,-0.027040032669901848,0.005404791794717312,0.03869984298944473,-0.07086299359798431,0.012611155398190022,0.042279329150915146,0.06193437799811363,-0.0017248332733288407,0.036020055413246155,-0.012290241196751595,-0.010795294307172298,-0.023887621238827705,-0.00048658213927410543,0.004781071562319994,-0.027481012046337128,-0.01167088933289051,-0.005306650884449482,0.012155258096754551,0.1098610982298851,0.048767127096652985,0.014109102077782154,-0.005584047641605139,-0.023643946275115013,-0.05883141607046127,-0.0119113028049469,-0.0008175396360456944,-0.01818632148206234,0.011405295692384243,-0.0691610649228096,0.03485322743654251,-0.016906920820474625,-0.020627707242965698,-0.05224714055657387,-0.017756739631295204,-0.00005160645378055051,-0.010144558735191822,-0.012117987498641014,-0.03278453275561333,0.10722796618938446,0.009296494536101818,0.03643833100795746,-0.02586969919502735,-0.02776397578418255,0.002058778889477253,-0.018441760912537575,-0.00994481984525919,0.017424477264285088,-0.08905638009309769,0.026498032733798027,0.03623943775892258,0.03114563226699829,0.02810569480061531,0.049529869109392166,-0.06858674436807632,-0.018866688013076782,-0.037773989140987396,-0.030855953693389893,-0.0016322797164320946,-0.03939410671591759,0.0075011784210801125,-0.023640239611268044,0.0894571989774704,-0.05356133356690407,0.0033090044744312763,-0.055434998124837875,0.08320257812738419,0.0010676984675228596,-0.007338373921811581,0.009556654840707779,0.03627324849367142,-0.028003215789794922,0.024955447763204575,-0.027351753786206245,0.017706898972392082,-0.0022198003716766834,-0.02509322389960289,0.022394653409719467,-0.07395141571760178,-0.01856291852891445,-0.018150687217712402,0.031191453337669373,-0.03474811092019081,-0.005459083244204521,0.04644906520843506,0.025601867586374283,-0.07710008323192596,-0.017003830522298813,-0.0401291623711586,0.06264519691467285,-0.03787681832909584,-0.02545793540775776,-0.017351355403661728,0.03698789328336716,-0.030737601220607758,-0.039643894881010056,0.02032824046909809,-0.00019931506540160626,0.02879779413342476,-0.058180488646030426,0.019686447456479073,0.002907541813328862,0.0023019530344754457,0.003079300280660391,0.010915940627455711,0.10657579451799393,0.08073189109563828,0.006317181047052145,0.06279805302619934,0.04606578126549721,-0.000859603111166507,-0.017565233632922173,-0.0028020672034472227,0.011497484520077705,0.0007478615152649581,0.013867675326764584,0.028941577300429344,-0.027205482125282288,-0.025482267141342163,-0.015496990643441677,0.019426340237259865,-0.026243751868605614,-0.003329381812363863,0.04347588121891022,0.046181272715330124,-0.0378577895462513,-0.002381382044404745,-0.028820278123021126,0.01254812628030777,-0.031145159155130386,-0.05485319346189499,-0.04959753155708313,0.03526325896382332,0.0010121699888259172,-0.03156620264053345,0.07196877151727676,0.021316271275281906,-0.05075361207127571,-0.024181406944990158,0.018523653969168663,-0.062384121119976044,0.025164064019918442,-0.0076613579876720905,0.028020406141877174,-0.004517694003880024,-0.03566809743642807,0.050433333963155746,0.03190324828028679,-0.028339020907878876,-0.056465163826942444,-0.01460159569978714,0.013730207458138466,0.08056039363145828,-0.011897717602550983,-0.022440511733293533,-0.07959193736314774,0.03878672793507576,0.008727208711206913,0.007012821733951569,0.00516737625002861,0.021217189729213715,0.032105930149555206,-0.009648353792726994,-0.023099390789866447,0.028003400191664696,0.039157934486866,0.016207469627261162,0.0008238396840170026,-0.013398611918091774,-0.01404569111764431,0.02496291883289814,-0.029620852321386337,-0.006285957992076874,0.0005397481145337224,0.029324516654014587,0.028163200244307518,0.0014608276542276144,0.03636430948972702,0.05486462637782097,0.006569191347807646,0.0003904184268321842,0.0591057687997818,0.021048828959465027,0.010539560578763485,0.06098775565624237,0.012887216173112392,0.0705694928765297,-0.035670775920152664,-0.003907260950654745,0.04537628963589668,-0.04667634144425392,-0.02407081238925457,0.008037649095058441,0.0061867255717515945,-0.040602907538414,0.05563296750187874,-0.002667628927156329,0.019101625308394432,-0.003512762486934662,0.001137108076363802,0.030229294672608376,0.02169504202902317,-0.05029250681400299,-0.055469121783971786,-0.03266417980194092,-0.018757766112685204,0.005477202124893665,-0.03844166174530983,0.04366390034556389,-0.01916595920920372,0.02346942201256752,0.01841963268816471,-0.013052878901362419,0.04185650125145912,-0.048077140003442764,0.009478059597313404,-0.07091536372900009,0.022565769031643867,-0.004921324085444212,0.04391113668680191,0.011910381726920605,0.08163058012723923,0.0018719411455094814,-0.03828807175159454,0.03158252313733101,0.0425875261425972,0.0010985546978190541,0.040754493325948715,-0.004179877694696188,0.025889461860060692,-0.012415274046361446,-0.015056653879582882,0.004746823105961084,-0.0002814853214658797,0.01745971105992794,0.0441463403403759,-0.08236732333898544,0.014081819914281368,-0.036024268716573715,-0.016545020043849945,-0.003377856919541955,-0.02306751348078251,-0.02636226825416088,-0.01099723856896162,-0.05543310195207596,-0.0648922249674797,0.06529548764228821,0.013662722893059254,0.036326147615909576,-0.007037690375000238,-0.0361054427921772,-0.058202896267175674,-0.004697256721556187,-0.04680855572223663,0.0021172116976231337,-0.01232223305851221,0.02042219787836075,0.05537120997905731,0.03784762695431709,-0.04327843338251114,0.032823529094457626,-0.014867894351482391,-0.008223011158406734,0.03855353593826294,-0.013950797729194164,0.04459561035037041,0.027599478140473366,-0.004590993747115135,0.03264136239886284,-0.010919061489403248,-0.05871909111738205,0.035408467054367065,0.06742919236421585,0.010252798907458782,-0.07799189537763596,-0.016890371218323708,-0.007714482955634594,0.05800987407565117,-0.02045244351029396,0.005857840180397034,-0.02115759439766407,-0.06399159878492355,0.030116943642497063,-0.053240351378917694,0.003706203540787101,-0.04979139193892479,0.06886255741119385,-0.04757111892104149,0.0033437798265367746,0.00736438762396574,-0.022324025630950928,-0.02843300811946392,0.03313082829117775,-0.031460754573345184,-0.019286077469587326,0.0031424034386873245,-0.03315126895904541,-0.06568882614374161,0.014908798970282078,-0.04478200152516365,-0.013060609810054302,-0.017260616645216942,-0.01208257395774126,0.0013886390952393413,-0.024398701265454292,-0.0075802854262292385,0.004130313638597727,-0.06296239048242569,-0.021676722913980484,0.029038386419415474,0.09631688892841339,0.024205869063735008,-0.03380195051431656,0.0354977510869503,-0.040639523416757584,0.028481315821409225,-0.006406386848539114,0.0029548911843448877,0.013059730641543865,0.033372655510902405,-0.02978798747062683,-0.05105017125606537,0.06694665551185608,0.02004576474428177,-0.10536867380142212,-0.01994118094444275,-0.013440405018627644,-0.027942100539803505,-0.020736780017614365,0.03392152115702629,-0.09779267013072968,0.014945067465305328,-0.028502844274044037,0.020530885085463524,0.01761610433459282,-0.0625622346997261,-0.033886488527059555,-0.1131233349442482,0.00009574100113241002,0.012706561014056206,-0.06307659298181534,0.019195737317204475,-0.08009906113147736,0.005383370444178581,-0.017002683132886887,-0.004235582426190376,-0.021217117086052895,0.01647210866212845,-0.0007949425489641726,-0.011339214630424976,0.006899432744830847,0.0444469228386879,0.008899403735995293,-0.06134840101003647,0.03177731856703758,0.015260351821780205,0.06299184262752533,0.0032627482432872057,-0.02273254469037056,-0.03224923461675644,0.005678757559508085,-0.01799294725060463,-0.028770867735147476,0.05657487362623215,-0.013943229801952839,0.03969544544816017,0.02078286185860634,0.046805765479803085,-0.004324295558035374,0.05251304432749748,0.029305709525942802,0.022435922175645828,-0.026093272492289543,0.02631351165473461,-0.00607965188100934,0.04262903332710266,0.01061802078038454,0.02471427246928215,-0.00781203480437398,-0.014936456456780434,-0.025120357051491737,-0.0036682637874037027,-0.018968453630805016,-0.0644301250576973,0.03706567734479904,0.031014690175652504,-0.07060138136148453,-0.02515042945742607,-0.008712846785783768,-0.03514249250292778,0.018190797418355942,0.08127940446138382,-0.017786934971809387,0.018582746386528015,0.024726053699851036,0.00039170298259705305,-0.026734352111816406,-0.021657204255461693,-0.0040737902745604515,-0.00675504794344306,-0.008087733760476112,-0.02449152059853077,-0.005953727290034294,0.007129926234483719,0.013528949581086636,-0.024357624351978302,-0.07492576539516449,-0.047737520188093185,0.014164100401103497,0.05191383510828018,0.035761598497629166,0.035110652446746826,0.008612304925918579,0.013734747655689716,-0.028543705120682716,0.05263384059071541,-0.09211473166942596,0.018031325191259384,0.025148333981633186,0.06415750831365585,0.011009620502591133,0.030593188479542732,-0.023033324629068375,0.025234058499336243,0.02118276059627533,-0.015876511111855507,-0.0508064404129982,-0.012985431589186192,-0.000732322339899838,0.02684761956334114,0.019889231771230698,0.050808217376470566,-0.04824836552143097,0.00004551123856799677,0.04843232035636902,-0.07893157750368118,0.007085248362272978,-0.0434907041490078,-0.012945124879479408,-0.016079507768154144,0.00799733679741621,-0.013625946827232838,0.018292617052793503,0.002236912725493312,0.04320317879319191,-0.011262319050729275,-0.05728518217802048,0.02192917838692665,-0.05100050941109657,-0.0038374271243810654,-0.032028570771217346,-0.004153268411755562,0.014178507961332798,0.018571963533759117,0.06490568816661835,-0.04621608182787895,0.0011113806394860148,0.0038916936609894037,0.011749910190701485,0.02180490642786026,0.03846370801329613,-0.05944552272558212,-0.031017789617180824,0.03457550331950188,-0.031838394701480865,-0.03136684373021126,0.0001624780852580443,0.04812081530690193,-0.004885158967226744,0.015770161524415016,-0.006694483105093241,0.0160669032484293,-0.0043753222562372684,0.025523560121655464,-0.03197191283106804,0.015508252196013927,0.0016496420139446855,0.008066253736615181,0.06393346190452576,-0.052016470581293106,0.041149038821458817,-0.006335366051644087,-0.0408761091530323,-0.022557884454727173,-0.010689076967537403,0.0378512367606163,0.06826858222484589,0.011972835287451744,-0.07253285497426987,-0.006630072370171547,0.029759662225842476,0.013830936513841152,-0.028837310150265694,-0.017657645046710968,0.0028450982645154,0.040727175772190094,0.018832918256521225,0.053141843527555466,0.022112255915999413,-0.032845836132764816,-0.038760773837566376,-0.08138919621706009,-0.0023772651329636574,0.036029040813446045,-6.432864916884136e-33,-0.023917924612760544,-0.014684871770441532,0.006195457652211189,0.03723994642496109,-0.0597340352833271,-0.014452226459980011,-0.014286693185567856,-0.031614288687705994,-0.0014728907262906432,-0.0454246811568737,-0.019309645518660545,0.04720998555421829,0.037140704691410065,0.017804637551307678,0.024539735168218613,0.018375108018517494,0.024064848199486732,-0.015934990718960762,0.003956449218094349,0.06683484464883804,0.05707010626792908,0.07038233429193497,-0.0026173924561589956,-0.04496459290385246,0.017081035301089287,0.016864199191331863,0.04953546077013016,0.0032294809352606535,0.004290263168513775,0.01644625887274742,-0.017755873501300812,0.011755957268178463,0.0029416726902127266,0.02460000291466713,-0.00520614068955183,-0.040576498955488205,-0.053908150643110275,-0.061240725219249725,0.0105019211769104,-0.03919978067278862,-0.006003388203680515,0.005817030090838671,0.012093015015125275,0.010909541510045528,0.019264882430434227,-0.03533279895782471,0.034129075706005096,-0.009940299205482006,-0.04438069090247154,-0.030499612912535667,-0.005030960310250521,0.016664298251271248,0.0006420074496418238,0.07340309023857117,0.0007477820618078113,-0.02241343818604946,-0.00947281252592802,0.0218973346054554,-0.057180631905794144,0.03891448304057121,-0.06643245369195938,0.015900282189249992,-0.02570738084614277,0.05755329877138138,0.03457222878932953,0.015214716084301472,0.04068397358059883,0.060166239738464355,0.00036199623718857765,0.017706768587231636,-0.00989444274455309,0.06864777952432632,-0.05683824419975281,-0.0468280054628849,-0.04011251777410507,-0.007704589981585741,-0.0539516881108284,-0.01912015490233898,0.04430456832051277,0.008914164267480373,0.010646039620041847,0.023217666894197464,-0.056944120675325394,-0.010533517226576805,0.037721216678619385,0.05675901100039482,-0.0004984409315511584,-0.03318960592150688,-0.018096156418323517,-0.002046339213848114,-0.06401760131120682,0.012063666246831417,-0.002988585736602545,-0.02988538332283497,0.01409144140779972,-0.00019880582112818956,0.05567929893732071,-0.04396361485123634,-0.013401719741523266,0.015571626834571362,-0.009291345253586769,-0.020664727315306664,0.005512372124940157,0.03060385398566723,-0.014660770073533058,0.004089468624442816,0.02298607863485813,-0.02113240957260132,-0.046136461198329926,-0.009890127927064896,-0.0017711372347548604,0.02748834528028965,0.005973044782876968,0.03226775303483009,-0.008336141705513,0.04134117066860199,-0.005496539641171694,0.11610472947359085,0.03799837827682495,0.048205774277448654,-0.03318478912115097,-0.032624684274196625,0.060979388654232025,-0.026705428957939148,0.00505594490095973,0.02075597085058689,-0.045613549649715424,-0.038081854581832886,0.0028805441688746214,-0.020954394713044167,-0.005293926224112511,0.01901543326675892,2.7053718554270745e-7,0.019686926156282425,0.017047487199306488,-0.013053808361291885,0.003960337024182081,0.0027668620459735394,0.00214202213101089,0.046231482177972794,0.011082331649959087,0.03369522839784622,-0.002964071463793516,0.04340475797653198,0.017111919820308685,0.011001167818903923,0.03854682296514511,-0.07275687158107758,-0.036689192056655884,-0.0218672938644886,-0.09564562886953354,-0.07321562618017197,-0.03604140505194664,0.03735772892832756,0.0071462951600551605,0.04691056162118912,0.0017742825439199805,-0.005430781748145819,0.0074676088988780975,0.019835757091641426,-0.05317511036992073,-0.08343472331762314,0.015415129251778126,0.05399279296398163,-0.052760958671569824,-0.033376842737197876,0.01886281929910183,-0.021096426993608475,0.009936757385730743,-0.047020334750413895,0.01970226876437664,-0.025672458112239838,-0.047675274312496185,0.008177420124411583,-0.045784033834934235,-0.01186355296522379,0.06341540813446045,0.059236180037260056,-0.049784839153289795,-0.05416940152645111,0.005316439084708691,-0.008641050197184086,-0.031758345663547516,0.022063013166189194,0.03223682940006256,0.011694096028804779,0.001983350608497858,0.011517112143337727,0.03735494241118431,-0.017370957881212234,-0.04038471728563309,0.0416184663772583,-0.0342542827129364,-0.0036211232654750347,-0.09179119765758514,0.01881531998515129,0.030116280540823936,-0.021103352308273315,-0.03853075951337814,0.013337511569261551,2.6788554278417677e-34,0.039873164147138596,0.05002487450838089,0.028683243319392204,0.05554112046957016,0.029719317331910133,0.03558764606714249,0.009646526537835598,0.007612765766680241,0.055310722440481186,-0.1114618182182312,-0.007236486300826073]';
  p_EmbeddingModelID_2638b156 := '1D45AA65-41EC-4572-9ECD-AB2826C9B059';
  p_ID_2638b156 := '574FD9D5-AB9E-4FA5-A36C-C25E7D3F63FC';
  PERFORM __mj."spUpdateQuery"(p_Name := p_Name_2638b156, p_CategoryID := p_CategoryID_2638b156, p_UserQuestion := p_UserQuestion_2638b156, p_Description := p_Description_2638b156, p_SQL := p_SQL_2638b156, p_TechnicalDescription := p_TechnicalDescription_2638b156, p_OriginalSQL := p_OriginalSQL_2638b156, p_Feedback := p_Feedback_2638b156, p_Status := p_Status_2638b156, p_QualityRank := p_QualityRank_2638b156, p_ExecutionCostRank := p_ExecutionCostRank_2638b156, p_UsesTemplate := p_UsesTemplate_2638b156, p_AuditQueryRuns := p_AuditQueryRuns_2638b156, p_CacheEnabled := p_CacheEnabled_2638b156, p_CacheTTLMinutes := p_CacheTTLMinutes_2638b156, p_CacheMaxSize := p_CacheMaxSize_2638b156, p_EmbeddingVector := p_EmbeddingVector_2638b156, p_EmbeddingModelID := p_EmbeddingModelID_2638b156, p_CacheValidationSQL := p_CacheValidationSQL_2638b156, p_ID := p_ID_2638b156);
END $$;

-- Save MJ: Query Parameters (core SP call only)
DO $$
DECLARE
  p_QueryID_16706b75 UUID;
  p_Name_16706b75 VARCHAR(255);
  p_Type_16706b75 VARCHAR(50);
  p_IsRequired_16706b75 BOOLEAN;
  p_DefaultValue_16706b75 TEXT;
  p_Description_16706b75 TEXT;
  p_SampleValue_16706b75 TEXT;
  p_ValidationFilters_16706b75 TEXT;
  p_DetectionMethod_16706b75 VARCHAR(50);
  p_AutoDetectConfidenceScore_16706b75 NUMERIC(3,2);
  p_ID_16706b75 UUID;
BEGIN
  p_QueryID_16706b75 := '574FD9D5-AB9E-4FA5-A36C-C25E7D3F63FC';
  p_Name_16706b75 := 'since';
  p_Type_16706b75 := 'date';
  p_IsRequired_16706b75 := 0;
  p_Description_16706b75 := 'ISO date string - only include conversations with new activity after this date';
  p_SampleValue_16706b75 := '2024-01-15T10:30:00.000Z';
  p_DetectionMethod_16706b75 := 'AI';
  p_ID_16706b75 := 'DF0E9F24-CD92-4C6C-BA18-13B443160DE5';
  PERFORM __mj."spUpdateQueryParameter"(p_QueryID := p_QueryID_16706b75, p_Name := p_Name_16706b75, p_Type := p_Type_16706b75, p_IsRequired := p_IsRequired_16706b75, p_DefaultValue := p_DefaultValue_16706b75, p_Description := p_Description_16706b75, p_SampleValue := p_SampleValue_16706b75, p_ValidationFilters := p_ValidationFilters_16706b75, p_DetectionMethod := p_DetectionMethod_16706b75, p_AutoDetectConfidenceScore := p_AutoDetectConfidenceScore_16706b75, p_ID := p_ID_16706b75);
END $$;

-- Save MJ: Query Parameters (core SP call only)
DO $$
DECLARE
  p_QueryID_9106024b UUID;
  p_Name_9106024b VARCHAR(255);
  p_Type_9106024b VARCHAR(50);
  p_IsRequired_9106024b BOOLEAN;
  p_DefaultValue_9106024b TEXT;
  p_Description_9106024b TEXT;
  p_SampleValue_9106024b TEXT;
  p_ValidationFilters_9106024b TEXT;
  p_DetectionMethod_9106024b VARCHAR(50);
  p_AutoDetectConfidenceScore_9106024b NUMERIC(3,2);
  p_ID_9106024b UUID;
BEGIN
  p_QueryID_9106024b := '574FD9D5-AB9E-4FA5-A36C-C25E7D3F63FC';
  p_Name_9106024b := 'agentIds';
  p_Type_9106024b := 'string';
  p_IsRequired_9106024b := 1;
  p_Description_9106024b := 'Comma-separated list of agent IDs that have memory enabled';
  p_SampleValue_9106024b := '550e8400-e29b-41d4-a716-446655440000,6ba7b810-9dad-11d1-80b4-00c04fd430c8';
  p_DetectionMethod_9106024b := 'AI';
  p_ID_9106024b := 'AF4459A1-BEDA-4200-A739-4292E90EA6A1';
  PERFORM __mj."spUpdateQueryParameter"(p_QueryID := p_QueryID_9106024b, p_Name := p_Name_9106024b, p_Type := p_Type_9106024b, p_IsRequired := p_IsRequired_9106024b, p_DefaultValue := p_DefaultValue_9106024b, p_Description := p_Description_9106024b, p_SampleValue := p_SampleValue_9106024b, p_ValidationFilters := p_ValidationFilters_9106024b, p_DetectionMethod := p_DetectionMethod_9106024b, p_AutoDetectConfidenceScore := p_AutoDetectConfidenceScore_9106024b, p_ID := p_ID_9106024b);
END $$;

-- Save MJ: Query Fields (core SP call only)
DO $$
DECLARE
  p_QueryID_c8d1aa27 UUID;
  p_Name_c8d1aa27 VARCHAR(255);
  p_Description_c8d1aa27 TEXT;
  p_Sequence_c8d1aa27 INTEGER;
  p_SQLBaseType_c8d1aa27 VARCHAR(50);
  p_SQLFullType_c8d1aa27 VARCHAR(100);
  p_SourceEntityID_c8d1aa27 UUID;
  p_SourceFieldName_c8d1aa27 VARCHAR(255);
  p_IsComputed_c8d1aa27 BOOLEAN;
  p_ComputationDescription_c8d1aa27 TEXT;
  p_IsSummary_c8d1aa27 BOOLEAN;
  p_SummaryDescription_c8d1aa27 TEXT;
  p_DetectionMethod_c8d1aa27 VARCHAR(50);
  p_AutoDetectConfidenceScore_c8d1aa27 NUMERIC(3,2);
  p_ID_c8d1aa27 UUID;
BEGIN
  p_QueryID_c8d1aa27 := '574FD9D5-AB9E-4FA5-A36C-C25E7D3F63FC';
  p_Name_c8d1aa27 := 'HasPositiveRating';
  p_Description_c8d1aa27 := 'Flag indicating if conversation has any rating >= 8';
  p_Sequence_c8d1aa27 := 5;
  p_SQLBaseType_c8d1aa27 := 'bit';
  p_SQLFullType_c8d1aa27 := 'bit';
  p_IsComputed_c8d1aa27 := 1;
  p_ComputationDescription_c8d1aa27 := 'EXISTS check for ratings >= 8 converted to 1/0';
  p_IsSummary_c8d1aa27 := 0;
  p_DetectionMethod_c8d1aa27 := 'Manual';
  p_ID_c8d1aa27 := 'ADC80F10-C778-46A7-AB21-1474FF3051BA';
  PERFORM __mj."spUpdateQueryField"(p_QueryID := p_QueryID_c8d1aa27, p_Name := p_Name_c8d1aa27, p_Description := p_Description_c8d1aa27, p_Sequence := p_Sequence_c8d1aa27, p_SQLBaseType := p_SQLBaseType_c8d1aa27, p_SQLFullType := p_SQLFullType_c8d1aa27, p_SourceEntityID := p_SourceEntityID_c8d1aa27, p_SourceFieldName := p_SourceFieldName_c8d1aa27, p_IsComputed := p_IsComputed_c8d1aa27, p_ComputationDescription := p_ComputationDescription_c8d1aa27, p_IsSummary := p_IsSummary_c8d1aa27, p_SummaryDescription := p_SummaryDescription_c8d1aa27, p_DetectionMethod := p_DetectionMethod_c8d1aa27, p_AutoDetectConfidenceScore := p_AutoDetectConfidenceScore_c8d1aa27, p_ID := p_ID_c8d1aa27);
END $$;

-- Save MJ: Query Fields (core SP call only)
DO $$
DECLARE
  p_QueryID_c18b1d19 UUID;
  p_Name_c18b1d19 VARCHAR(255);
  p_Description_c18b1d19 TEXT;
  p_Sequence_c18b1d19 INTEGER;
  p_SQLBaseType_c18b1d19 VARCHAR(50);
  p_SQLFullType_c18b1d19 VARCHAR(100);
  p_SourceEntityID_c18b1d19 UUID;
  p_SourceFieldName_c18b1d19 VARCHAR(255);
  p_IsComputed_c18b1d19 BOOLEAN;
  p_ComputationDescription_c18b1d19 TEXT;
  p_IsSummary_c18b1d19 BOOLEAN;
  p_SummaryDescription_c18b1d19 TEXT;
  p_DetectionMethod_c18b1d19 VARCHAR(50);
  p_AutoDetectConfidenceScore_c18b1d19 NUMERIC(3,2);
  p_ID_c18b1d19 UUID;
BEGIN
  p_QueryID_c18b1d19 := '574FD9D5-AB9E-4FA5-A36C-C25E7D3F63FC';
  p_Name_c18b1d19 := 'UserID';
  p_Description_c18b1d19 := 'Unique identifier for the user associated with the conversation';
  p_Sequence_c18b1d19 := 2;
  p_SQLBaseType_c18b1d19 := 'TEXT';
  p_SQLFullType_c18b1d19 := 'TEXT';
  p_SourceEntityID_c18b1d19 := '13248F34-2837-EF11-86D4-6045BDEE16E6';
  p_SourceFieldName_c18b1d19 := 'UserID';
  p_IsComputed_c18b1d19 := 0;
  p_IsSummary_c18b1d19 := 0;
  p_DetectionMethod_c18b1d19 := 'Manual';
  p_ID_c18b1d19 := 'FC47BF02-BE51-4C7C-9132-1C20ADC4FEBD';
  PERFORM __mj."spUpdateQueryField"(p_QueryID := p_QueryID_c18b1d19, p_Name := p_Name_c18b1d19, p_Description := p_Description_c18b1d19, p_Sequence := p_Sequence_c18b1d19, p_SQLBaseType := p_SQLBaseType_c18b1d19, p_SQLFullType := p_SQLFullType_c18b1d19, p_SourceEntityID := p_SourceEntityID_c18b1d19, p_SourceFieldName := p_SourceFieldName_c18b1d19, p_IsComputed := p_IsComputed_c18b1d19, p_ComputationDescription := p_ComputationDescription_c18b1d19, p_IsSummary := p_IsSummary_c18b1d19, p_SummaryDescription := p_SummaryDescription_c18b1d19, p_DetectionMethod := p_DetectionMethod_c18b1d19, p_AutoDetectConfidenceScore := p_AutoDetectConfidenceScore_c18b1d19, p_ID := p_ID_c18b1d19);
END $$;

-- Save MJ: Query Fields (core SP call only)
DO $$
DECLARE
  p_QueryID_fc23bcaf UUID;
  p_Name_fc23bcaf VARCHAR(255);
  p_Description_fc23bcaf TEXT;
  p_Sequence_fc23bcaf INTEGER;
  p_SQLBaseType_fc23bcaf VARCHAR(50);
  p_SQLFullType_fc23bcaf VARCHAR(100);
  p_SourceEntityID_fc23bcaf UUID;
  p_SourceFieldName_fc23bcaf VARCHAR(255);
  p_IsComputed_fc23bcaf BOOLEAN;
  p_ComputationDescription_fc23bcaf TEXT;
  p_IsSummary_fc23bcaf BOOLEAN;
  p_SummaryDescription_fc23bcaf TEXT;
  p_DetectionMethod_fc23bcaf VARCHAR(50);
  p_AutoDetectConfidenceScore_fc23bcaf NUMERIC(3,2);
  p_ID_fc23bcaf UUID;
BEGIN
  p_QueryID_fc23bcaf := '574FD9D5-AB9E-4FA5-A36C-C25E7D3F63FC';
  p_Name_fc23bcaf := 'MessagesJSON';
  p_Description_fc23bcaf := 'Conversation details as JSON array with ratings included';
  p_Sequence_fc23bcaf := 4;
  p_SQLBaseType_fc23bcaf := 'TEXT';
  p_SQLFullType_fc23bcaf := 'TEXT';
  p_IsComputed_fc23bcaf := 1;
  p_ComputationDescription_fc23bcaf := 'JSON aggregation of conversation details with ratings using FOR JSON PATH';
  p_IsSummary_fc23bcaf := 0;
  p_DetectionMethod_fc23bcaf := 'Manual';
  p_ID_fc23bcaf := 'CB76A976-AE46-454B-B837-90A78B74ED50';
  PERFORM __mj."spUpdateQueryField"(p_QueryID := p_QueryID_fc23bcaf, p_Name := p_Name_fc23bcaf, p_Description := p_Description_fc23bcaf, p_Sequence := p_Sequence_fc23bcaf, p_SQLBaseType := p_SQLBaseType_fc23bcaf, p_SQLFullType := p_SQLFullType_fc23bcaf, p_SourceEntityID := p_SourceEntityID_fc23bcaf, p_SourceFieldName := p_SourceFieldName_fc23bcaf, p_IsComputed := p_IsComputed_fc23bcaf, p_ComputationDescription := p_ComputationDescription_fc23bcaf, p_IsSummary := p_IsSummary_fc23bcaf, p_SummaryDescription := p_SummaryDescription_fc23bcaf, p_DetectionMethod := p_DetectionMethod_fc23bcaf, p_AutoDetectConfidenceScore := p_AutoDetectConfidenceScore_fc23bcaf, p_ID := p_ID_fc23bcaf);
END $$;

-- Save MJ: Query Fields (core SP call only)
DO $$
DECLARE
  p_QueryID_9fb6ef8b UUID;
  p_Name_9fb6ef8b VARCHAR(255);
  p_Description_9fb6ef8b TEXT;
  p_Sequence_9fb6ef8b INTEGER;
  p_SQLBaseType_9fb6ef8b VARCHAR(50);
  p_SQLFullType_9fb6ef8b VARCHAR(100);
  p_SourceEntityID_9fb6ef8b UUID;
  p_SourceFieldName_9fb6ef8b VARCHAR(255);
  p_IsComputed_9fb6ef8b BOOLEAN;
  p_ComputationDescription_9fb6ef8b TEXT;
  p_IsSummary_9fb6ef8b BOOLEAN;
  p_SummaryDescription_9fb6ef8b TEXT;
  p_DetectionMethod_9fb6ef8b VARCHAR(50);
  p_AutoDetectConfidenceScore_9fb6ef8b NUMERIC(3,2);
  p_ID_9fb6ef8b UUID;
BEGIN
  p_QueryID_9fb6ef8b := '574FD9D5-AB9E-4FA5-A36C-C25E7D3F63FC';
  p_Name_9fb6ef8b := 'AgentRunID';
  p_Description_9fb6ef8b := 'Most recent agent run ID for this conversation (for scope inheritance)';
  p_Sequence_9fb6ef8b := 3;
  p_SQLBaseType_9fb6ef8b := 'TEXT';
  p_SQLFullType_9fb6ef8b := 'TEXT';
  p_IsComputed_9fb6ef8b := 1;
  p_ComputationDescription_9fb6ef8b := 'Scalar subquery selecting TOP 1 ID from AI Agent Runs ordered by StartedAt DESC';
  p_IsSummary_9fb6ef8b := 0;
  p_DetectionMethod_9fb6ef8b := 'Manual';
  p_ID_9fb6ef8b := '4CAB47E1-C542-4CDD-9BEF-90BFC2786FF0';
  PERFORM __mj."spUpdateQueryField"(p_QueryID := p_QueryID_9fb6ef8b, p_Name := p_Name_9fb6ef8b, p_Description := p_Description_9fb6ef8b, p_Sequence := p_Sequence_9fb6ef8b, p_SQLBaseType := p_SQLBaseType_9fb6ef8b, p_SQLFullType := p_SQLFullType_9fb6ef8b, p_SourceEntityID := p_SourceEntityID_9fb6ef8b, p_SourceFieldName := p_SourceFieldName_9fb6ef8b, p_IsComputed := p_IsComputed_9fb6ef8b, p_ComputationDescription := p_ComputationDescription_9fb6ef8b, p_IsSummary := p_IsSummary_9fb6ef8b, p_SummaryDescription := p_SummaryDescription_9fb6ef8b, p_DetectionMethod := p_DetectionMethod_9fb6ef8b, p_AutoDetectConfidenceScore := p_AutoDetectConfidenceScore_9fb6ef8b, p_ID := p_ID_9fb6ef8b);
END $$;

-- Save MJ: Query Fields (core SP call only)
DO $$
DECLARE
  p_QueryID_e6708f39 UUID;
  p_Name_e6708f39 VARCHAR(255);
  p_Description_e6708f39 TEXT;
  p_Sequence_e6708f39 INTEGER;
  p_SQLBaseType_e6708f39 VARCHAR(50);
  p_SQLFullType_e6708f39 VARCHAR(100);
  p_SourceEntityID_e6708f39 UUID;
  p_SourceFieldName_e6708f39 VARCHAR(255);
  p_IsComputed_e6708f39 BOOLEAN;
  p_ComputationDescription_e6708f39 TEXT;
  p_IsSummary_e6708f39 BOOLEAN;
  p_SummaryDescription_e6708f39 TEXT;
  p_DetectionMethod_e6708f39 VARCHAR(50);
  p_AutoDetectConfidenceScore_e6708f39 NUMERIC(3,2);
  p_ID_e6708f39 UUID;
BEGIN
  p_QueryID_e6708f39 := '574FD9D5-AB9E-4FA5-A36C-C25E7D3F63FC';
  p_Name_e6708f39 := 'HasNegativeRating';
  p_Description_e6708f39 := 'Flag indicating if conversation has any rating <= 3';
  p_Sequence_e6708f39 := 6;
  p_SQLBaseType_e6708f39 := 'bit';
  p_SQLFullType_e6708f39 := 'bit';
  p_IsComputed_e6708f39 := 1;
  p_ComputationDescription_e6708f39 := 'EXISTS check for ratings <= 3 converted to 1/0';
  p_IsSummary_e6708f39 := 0;
  p_DetectionMethod_e6708f39 := 'Manual';
  p_ID_e6708f39 := '5A464544-F105-4F17-94F8-A0423F150812';
  PERFORM __mj."spUpdateQueryField"(p_QueryID := p_QueryID_e6708f39, p_Name := p_Name_e6708f39, p_Description := p_Description_e6708f39, p_Sequence := p_Sequence_e6708f39, p_SQLBaseType := p_SQLBaseType_e6708f39, p_SQLFullType := p_SQLFullType_e6708f39, p_SourceEntityID := p_SourceEntityID_e6708f39, p_SourceFieldName := p_SourceFieldName_e6708f39, p_IsComputed := p_IsComputed_e6708f39, p_ComputationDescription := p_ComputationDescription_e6708f39, p_IsSummary := p_IsSummary_e6708f39, p_SummaryDescription := p_SummaryDescription_e6708f39, p_DetectionMethod := p_DetectionMethod_e6708f39, p_AutoDetectConfidenceScore := p_AutoDetectConfidenceScore_e6708f39, p_ID := p_ID_e6708f39);
END $$;

-- Save MJ: Query Fields (core SP call only)
DO $$
DECLARE
  p_QueryID_2c856875 UUID;
  p_Name_2c856875 VARCHAR(255);
  p_Description_2c856875 TEXT;
  p_Sequence_2c856875 INTEGER;
  p_SQLBaseType_2c856875 VARCHAR(50);
  p_SQLFullType_2c856875 VARCHAR(100);
  p_SourceEntityID_2c856875 UUID;
  p_SourceFieldName_2c856875 VARCHAR(255);
  p_IsComputed_2c856875 BOOLEAN;
  p_ComputationDescription_2c856875 TEXT;
  p_IsSummary_2c856875 BOOLEAN;
  p_SummaryDescription_2c856875 TEXT;
  p_DetectionMethod_2c856875 VARCHAR(50);
  p_AutoDetectConfidenceScore_2c856875 NUMERIC(3,2);
  p_ID_2c856875 UUID;
BEGIN
  p_QueryID_2c856875 := '574FD9D5-AB9E-4FA5-A36C-C25E7D3F63FC';
  p_Name_2c856875 := 'IsUnrated';
  p_Description_2c856875 := 'Flag indicating if conversation has no ratings';
  p_Sequence_2c856875 := 7;
  p_SQLBaseType_2c856875 := 'bit';
  p_SQLFullType_2c856875 := 'bit';
  p_IsComputed_2c856875 := 1;
  p_ComputationDescription_2c856875 := 'NOT EXISTS check for any ratings converted to 1/0';
  p_IsSummary_2c856875 := 0;
  p_DetectionMethod_2c856875 := 'Manual';
  p_ID_2c856875 := 'F11B7F22-EF85-418E-855A-AC0EDBEE014A';
  PERFORM __mj."spUpdateQueryField"(p_QueryID := p_QueryID_2c856875, p_Name := p_Name_2c856875, p_Description := p_Description_2c856875, p_Sequence := p_Sequence_2c856875, p_SQLBaseType := p_SQLBaseType_2c856875, p_SQLFullType := p_SQLFullType_2c856875, p_SourceEntityID := p_SourceEntityID_2c856875, p_SourceFieldName := p_SourceFieldName_2c856875, p_IsComputed := p_IsComputed_2c856875, p_ComputationDescription := p_ComputationDescription_2c856875, p_IsSummary := p_IsSummary_2c856875, p_SummaryDescription := p_SummaryDescription_2c856875, p_DetectionMethod := p_DetectionMethod_2c856875, p_AutoDetectConfidenceScore := p_AutoDetectConfidenceScore_2c856875, p_ID := p_ID_2c856875);
END $$;

-- Save MJ: Queries (core SP call only)
DO $$
DECLARE
  p_Name_4c584ed6 VARCHAR(255);
  p_CategoryID_4c584ed6 UUID;
  p_UserQuestion_4c584ed6 TEXT;
  p_Description_4c584ed6 TEXT;
  p_SQL_4c584ed6 TEXT;
  p_TechnicalDescription_4c584ed6 TEXT;
  p_OriginalSQL_4c584ed6 TEXT;
  p_Feedback_4c584ed6 TEXT;
  p_Status_4c584ed6 VARCHAR(15);
  p_QualityRank_4c584ed6 INTEGER;
  p_ExecutionCostRank_4c584ed6 INTEGER;
  p_UsesTemplate_4c584ed6 BOOLEAN;
  p_AuditQueryRuns_4c584ed6 BOOLEAN;
  p_CacheEnabled_4c584ed6 BOOLEAN;
  p_CacheTTLMinutes_4c584ed6 INTEGER;
  p_CacheMaxSize_4c584ed6 INTEGER;
  p_EmbeddingVector_4c584ed6 TEXT;
  p_EmbeddingModelID_4c584ed6 UUID;
  p_CacheValidationSQL_4c584ed6 TEXT;
  p_ID_4c584ed6 UUID;
BEGIN
  p_Name_4c584ed6 := 'Server Installed Version History';
  p_CategoryID_4c584ed6 := '17AFCCEC-6A37-EF11-86D4-000D3A4E707E';
  p_UserQuestion_4c584ed6 := 'Show me a list of versions installed on the server in order of most recent version first';
  p_Status_4c584ed6 := 'Approved';
  p_QualityRank_4c584ed6 := 9;
  p_ExecutionCostRank_4c584ed6 := 3;
  p_UsesTemplate_4c584ed6 := 1;
  p_AuditQueryRuns_4c584ed6 := 0;
  p_CacheEnabled_4c584ed6 := 0;
  p_ID_4c584ed6 := '23F8423E-F36B-1410-8D9C-00021F8B792E';
  PERFORM __mj."spUpdateQuery"(p_Name := p_Name_4c584ed6, p_CategoryID := p_CategoryID_4c584ed6, p_UserQuestion := p_UserQuestion_4c584ed6, p_Description := p_Description_4c584ed6, p_SQL := p_SQL_4c584ed6, p_TechnicalDescription := p_TechnicalDescription_4c584ed6, p_OriginalSQL := p_OriginalSQL_4c584ed6, p_Feedback := p_Feedback_4c584ed6, p_Status := p_Status_4c584ed6, p_QualityRank := p_QualityRank_4c584ed6, p_ExecutionCostRank := p_ExecutionCostRank_4c584ed6, p_UsesTemplate := p_UsesTemplate_4c584ed6, p_AuditQueryRuns := p_AuditQueryRuns_4c584ed6, p_CacheEnabled := p_CacheEnabled_4c584ed6, p_CacheTTLMinutes := p_CacheTTLMinutes_4c584ed6, p_CacheMaxSize := p_CacheMaxSize_4c584ed6, p_EmbeddingVector := p_EmbeddingVector_4c584ed6, p_EmbeddingModelID := p_EmbeddingModelID_4c584ed6, p_CacheValidationSQL := p_CacheValidationSQL_4c584ed6, p_ID := p_ID_4c584ed6);
END $$;

-- Save MJ: Query Fields (core SP call only)
DO $$
DECLARE
  p_QueryID_d9bac484 UUID;
  p_Name_d9bac484 VARCHAR(255);
  p_Description_d9bac484 TEXT;
  p_Sequence_d9bac484 INTEGER;
  p_SQLBaseType_d9bac484 VARCHAR(50);
  p_SQLFullType_d9bac484 VARCHAR(100);
  p_SourceEntityID_d9bac484 UUID;
  p_SourceFieldName_d9bac484 VARCHAR(255);
  p_IsComputed_d9bac484 BOOLEAN;
  p_ComputationDescription_d9bac484 TEXT;
  p_IsSummary_d9bac484 BOOLEAN;
  p_SummaryDescription_d9bac484 TEXT;
  p_DetectionMethod_d9bac484 VARCHAR(50);
  p_AutoDetectConfidenceScore_d9bac484 NUMERIC(3,2);
  p_ID_d9bac484 UUID;
BEGIN
  p_QueryID_d9bac484 := '23F8423E-F36B-1410-8D9C-00021F8B792E';
  p_Name_d9bac484 := 'success';
  p_Description_d9bac484 := 'Whether the migration was successful (1) or failed (0)';
  p_Sequence_d9bac484 := 10;
  p_SQLBaseType_d9bac484 := 'bit';
  p_SQLFullType_d9bac484 := 'bit';
  p_SourceFieldName_d9bac484 := 'success';
  p_IsComputed_d9bac484 := 0;
  p_IsSummary_d9bac484 := 0;
  p_DetectionMethod_d9bac484 := 'Manual';
  p_ID_d9bac484 := '61B03A6B-E72A-413F-8145-22AB9D843911';
  PERFORM __mj."spUpdateQueryField"(p_QueryID := p_QueryID_d9bac484, p_Name := p_Name_d9bac484, p_Description := p_Description_d9bac484, p_Sequence := p_Sequence_d9bac484, p_SQLBaseType := p_SQLBaseType_d9bac484, p_SQLFullType := p_SQLFullType_d9bac484, p_SourceEntityID := p_SourceEntityID_d9bac484, p_SourceFieldName := p_SourceFieldName_d9bac484, p_IsComputed := p_IsComputed_d9bac484, p_ComputationDescription := p_ComputationDescription_d9bac484, p_IsSummary := p_IsSummary_d9bac484, p_SummaryDescription := p_SummaryDescription_d9bac484, p_DetectionMethod := p_DetectionMethod_d9bac484, p_AutoDetectConfidenceScore := p_AutoDetectConfidenceScore_d9bac484, p_ID := p_ID_d9bac484);
END $$;

-- Save MJ: Query Fields (core SP call only)
DO $$
DECLARE
  p_QueryID_fba31937 UUID;
  p_Name_fba31937 VARCHAR(255);
  p_Description_fba31937 TEXT;
  p_Sequence_fba31937 INTEGER;
  p_SQLBaseType_fba31937 VARCHAR(50);
  p_SQLFullType_fba31937 VARCHAR(100);
  p_SourceEntityID_fba31937 UUID;
  p_SourceFieldName_fba31937 VARCHAR(255);
  p_IsComputed_fba31937 BOOLEAN;
  p_ComputationDescription_fba31937 TEXT;
  p_IsSummary_fba31937 BOOLEAN;
  p_SummaryDescription_fba31937 TEXT;
  p_DetectionMethod_fba31937 VARCHAR(50);
  p_AutoDetectConfidenceScore_fba31937 NUMERIC(3,2);
  p_ID_fba31937 UUID;
BEGIN
  p_QueryID_fba31937 := '23F8423E-F36B-1410-8D9C-00021F8B792E';
  p_Name_fba31937 := 'installed_by';
  p_Description_fba31937 := 'Database user that installed the migration';
  p_Sequence_fba31937 := 7;
  p_SQLBaseType_fba31937 := 'TEXT';
  p_SQLFullType_fba31937 := 'TEXT';
  p_SourceFieldName_fba31937 := 'installed_by';
  p_IsComputed_fba31937 := 0;
  p_IsSummary_fba31937 := 0;
  p_DetectionMethod_fba31937 := 'Manual';
  p_ID_fba31937 := 'E995B5FA-994B-4E21-9434-37140606FD19';
  PERFORM __mj."spUpdateQueryField"(p_QueryID := p_QueryID_fba31937, p_Name := p_Name_fba31937, p_Description := p_Description_fba31937, p_Sequence := p_Sequence_fba31937, p_SQLBaseType := p_SQLBaseType_fba31937, p_SQLFullType := p_SQLFullType_fba31937, p_SourceEntityID := p_SourceEntityID_fba31937, p_SourceFieldName := p_SourceFieldName_fba31937, p_IsComputed := p_IsComputed_fba31937, p_ComputationDescription := p_ComputationDescription_fba31937, p_IsSummary := p_IsSummary_fba31937, p_SummaryDescription := p_SummaryDescription_fba31937, p_DetectionMethod := p_DetectionMethod_fba31937, p_AutoDetectConfidenceScore := p_AutoDetectConfidenceScore_fba31937, p_ID := p_ID_fba31937);
END $$;

-- Save MJ: Query Fields (core SP call only)
DO $$
DECLARE
  p_QueryID_cb9f8654 UUID;
  p_Name_cb9f8654 VARCHAR(255);
  p_Description_cb9f8654 TEXT;
  p_Sequence_cb9f8654 INTEGER;
  p_SQLBaseType_cb9f8654 VARCHAR(50);
  p_SQLFullType_cb9f8654 VARCHAR(100);
  p_SourceEntityID_cb9f8654 UUID;
  p_SourceFieldName_cb9f8654 VARCHAR(255);
  p_IsComputed_cb9f8654 BOOLEAN;
  p_ComputationDescription_cb9f8654 TEXT;
  p_IsSummary_cb9f8654 BOOLEAN;
  p_SummaryDescription_cb9f8654 TEXT;
  p_DetectionMethod_cb9f8654 VARCHAR(50);
  p_AutoDetectConfidenceScore_cb9f8654 NUMERIC(3,2);
  p_ID_cb9f8654 UUID;
BEGIN
  p_QueryID_cb9f8654 := '23F8423E-F36B-1410-8D9C-00021F8B792E';
  p_Name_cb9f8654 := 'script';
  p_Description_cb9f8654 := 'Name of the migration script file';
  p_Sequence_cb9f8654 := 5;
  p_SQLBaseType_cb9f8654 := 'TEXT';
  p_SQLFullType_cb9f8654 := 'TEXT';
  p_SourceFieldName_cb9f8654 := 'script';
  p_IsComputed_cb9f8654 := 0;
  p_IsSummary_cb9f8654 := 0;
  p_DetectionMethod_cb9f8654 := 'Manual';
  p_ID_cb9f8654 := '54F49295-7671-4A18-82DB-386757F3E941';
  PERFORM __mj."spUpdateQueryField"(p_QueryID := p_QueryID_cb9f8654, p_Name := p_Name_cb9f8654, p_Description := p_Description_cb9f8654, p_Sequence := p_Sequence_cb9f8654, p_SQLBaseType := p_SQLBaseType_cb9f8654, p_SQLFullType := p_SQLFullType_cb9f8654, p_SourceEntityID := p_SourceEntityID_cb9f8654, p_SourceFieldName := p_SourceFieldName_cb9f8654, p_IsComputed := p_IsComputed_cb9f8654, p_ComputationDescription := p_ComputationDescription_cb9f8654, p_IsSummary := p_IsSummary_cb9f8654, p_SummaryDescription := p_SummaryDescription_cb9f8654, p_DetectionMethod := p_DetectionMethod_cb9f8654, p_AutoDetectConfidenceScore := p_AutoDetectConfidenceScore_cb9f8654, p_ID := p_ID_cb9f8654);
END $$;

-- Save MJ: Query Fields (core SP call only)
DO $$
DECLARE
  p_QueryID_5bfdbbd8 UUID;
  p_Name_5bfdbbd8 VARCHAR(255);
  p_Description_5bfdbbd8 TEXT;
  p_Sequence_5bfdbbd8 INTEGER;
  p_SQLBaseType_5bfdbbd8 VARCHAR(50);
  p_SQLFullType_5bfdbbd8 VARCHAR(100);
  p_SourceEntityID_5bfdbbd8 UUID;
  p_SourceFieldName_5bfdbbd8 VARCHAR(255);
  p_IsComputed_5bfdbbd8 BOOLEAN;
  p_ComputationDescription_5bfdbbd8 TEXT;
  p_IsSummary_5bfdbbd8 BOOLEAN;
  p_SummaryDescription_5bfdbbd8 TEXT;
  p_DetectionMethod_5bfdbbd8 VARCHAR(50);
  p_AutoDetectConfidenceScore_5bfdbbd8 NUMERIC(3,2);
  p_ID_5bfdbbd8 UUID;
BEGIN
  p_QueryID_5bfdbbd8 := '23F8423E-F36B-1410-8D9C-00021F8B792E';
  p_Name_5bfdbbd8 := 'execution_time';
  p_Description_5bfdbbd8 := 'Time in milliseconds that the migration took to execute';
  p_Sequence_5bfdbbd8 := 9;
  p_SQLBaseType_5bfdbbd8 := 'decimal';
  p_SQLFullType_5bfdbbd8 := 'decimal(18,2)';
  p_SourceFieldName_5bfdbbd8 := 'execution_time';
  p_IsComputed_5bfdbbd8 := 0;
  p_IsSummary_5bfdbbd8 := 0;
  p_DetectionMethod_5bfdbbd8 := 'Manual';
  p_ID_5bfdbbd8 := '40D852DE-7370-4F9F-AB12-83ABCA2D08FB';
  PERFORM __mj."spUpdateQueryField"(p_QueryID := p_QueryID_5bfdbbd8, p_Name := p_Name_5bfdbbd8, p_Description := p_Description_5bfdbbd8, p_Sequence := p_Sequence_5bfdbbd8, p_SQLBaseType := p_SQLBaseType_5bfdbbd8, p_SQLFullType := p_SQLFullType_5bfdbbd8, p_SourceEntityID := p_SourceEntityID_5bfdbbd8, p_SourceFieldName := p_SourceFieldName_5bfdbbd8, p_IsComputed := p_IsComputed_5bfdbbd8, p_ComputationDescription := p_ComputationDescription_5bfdbbd8, p_IsSummary := p_IsSummary_5bfdbbd8, p_SummaryDescription := p_SummaryDescription_5bfdbbd8, p_DetectionMethod := p_DetectionMethod_5bfdbbd8, p_AutoDetectConfidenceScore := p_AutoDetectConfidenceScore_5bfdbbd8, p_ID := p_ID_5bfdbbd8);
END $$;

-- Save MJ: Query Fields (core SP call only)
DO $$
DECLARE
  p_QueryID_d87f5ee6 UUID;
  p_Name_d87f5ee6 VARCHAR(255);
  p_Description_d87f5ee6 TEXT;
  p_Sequence_d87f5ee6 INTEGER;
  p_SQLBaseType_d87f5ee6 VARCHAR(50);
  p_SQLFullType_d87f5ee6 VARCHAR(100);
  p_SourceEntityID_d87f5ee6 UUID;
  p_SourceFieldName_d87f5ee6 VARCHAR(255);
  p_IsComputed_d87f5ee6 BOOLEAN;
  p_ComputationDescription_d87f5ee6 TEXT;
  p_IsSummary_d87f5ee6 BOOLEAN;
  p_SummaryDescription_d87f5ee6 TEXT;
  p_DetectionMethod_d87f5ee6 VARCHAR(50);
  p_AutoDetectConfidenceScore_d87f5ee6 NUMERIC(3,2);
  p_ID_d87f5ee6 UUID;
BEGIN
  p_QueryID_d87f5ee6 := '23F8423E-F36B-1410-8D9C-00021F8B792E';
  p_Name_d87f5ee6 := 'checksum';
  p_Description_d87f5ee6 := 'Checksum of the migration script for integrity verification';
  p_Sequence_d87f5ee6 := 6;
  p_SQLBaseType_d87f5ee6 := 'decimal';
  p_SQLFullType_d87f5ee6 := 'decimal(18,2)';
  p_SourceFieldName_d87f5ee6 := 'checksum';
  p_IsComputed_d87f5ee6 := 0;
  p_IsSummary_d87f5ee6 := 0;
  p_DetectionMethod_d87f5ee6 := 'Manual';
  p_ID_d87f5ee6 := 'FB54C641-D2EC-4B1C-8C46-8C10683F5581';
  PERFORM __mj."spUpdateQueryField"(p_QueryID := p_QueryID_d87f5ee6, p_Name := p_Name_d87f5ee6, p_Description := p_Description_d87f5ee6, p_Sequence := p_Sequence_d87f5ee6, p_SQLBaseType := p_SQLBaseType_d87f5ee6, p_SQLFullType := p_SQLFullType_d87f5ee6, p_SourceEntityID := p_SourceEntityID_d87f5ee6, p_SourceFieldName := p_SourceFieldName_d87f5ee6, p_IsComputed := p_IsComputed_d87f5ee6, p_ComputationDescription := p_ComputationDescription_d87f5ee6, p_IsSummary := p_IsSummary_d87f5ee6, p_SummaryDescription := p_SummaryDescription_d87f5ee6, p_DetectionMethod := p_DetectionMethod_d87f5ee6, p_AutoDetectConfidenceScore := p_AutoDetectConfidenceScore_d87f5ee6, p_ID := p_ID_d87f5ee6);
END $$;

-- Save MJ: Query Fields (core SP call only)
DO $$
DECLARE
  p_QueryID_1230cb8d UUID;
  p_Name_1230cb8d VARCHAR(255);
  p_Description_1230cb8d TEXT;
  p_Sequence_1230cb8d INTEGER;
  p_SQLBaseType_1230cb8d VARCHAR(50);
  p_SQLFullType_1230cb8d VARCHAR(100);
  p_SourceEntityID_1230cb8d UUID;
  p_SourceFieldName_1230cb8d VARCHAR(255);
  p_IsComputed_1230cb8d BOOLEAN;
  p_ComputationDescription_1230cb8d TEXT;
  p_IsSummary_1230cb8d BOOLEAN;
  p_SummaryDescription_1230cb8d TEXT;
  p_DetectionMethod_1230cb8d VARCHAR(50);
  p_AutoDetectConfidenceScore_1230cb8d NUMERIC(3,2);
  p_ID_1230cb8d UUID;
BEGIN
  p_QueryID_1230cb8d := '23F8423E-F36B-1410-8D9C-00021F8B792E';
  p_Name_1230cb8d := 'installed_rank';
  p_Description_1230cb8d := 'Sequential ranking of when the schema history entry was installed';
  p_Sequence_1230cb8d := 1;
  p_SQLBaseType_1230cb8d := 'decimal';
  p_SQLFullType_1230cb8d := 'decimal(18,2)';
  p_SourceFieldName_1230cb8d := 'installed_rank';
  p_IsComputed_1230cb8d := 0;
  p_IsSummary_1230cb8d := 0;
  p_DetectionMethod_1230cb8d := 'Manual';
  p_ID_1230cb8d := '31554B62-5505-4D79-ACBF-9CC922A7D2CC';
  PERFORM __mj."spUpdateQueryField"(p_QueryID := p_QueryID_1230cb8d, p_Name := p_Name_1230cb8d, p_Description := p_Description_1230cb8d, p_Sequence := p_Sequence_1230cb8d, p_SQLBaseType := p_SQLBaseType_1230cb8d, p_SQLFullType := p_SQLFullType_1230cb8d, p_SourceEntityID := p_SourceEntityID_1230cb8d, p_SourceFieldName := p_SourceFieldName_1230cb8d, p_IsComputed := p_IsComputed_1230cb8d, p_ComputationDescription := p_ComputationDescription_1230cb8d, p_IsSummary := p_IsSummary_1230cb8d, p_SummaryDescription := p_SummaryDescription_1230cb8d, p_DetectionMethod := p_DetectionMethod_1230cb8d, p_AutoDetectConfidenceScore := p_AutoDetectConfidenceScore_1230cb8d, p_ID := p_ID_1230cb8d);
END $$;

-- Save MJ: Queries (core SP call only)
DO $$
DECLARE
  p_Name_7c8126e0 VARCHAR(255);
  p_CategoryID_7c8126e0 UUID;
  p_UserQuestion_7c8126e0 TEXT;
  p_Description_7c8126e0 TEXT;
  p_SQL_7c8126e0 TEXT;
  p_TechnicalDescription_7c8126e0 TEXT;
  p_OriginalSQL_7c8126e0 TEXT;
  p_Feedback_7c8126e0 TEXT;
  p_Status_7c8126e0 VARCHAR(15);
  p_QualityRank_7c8126e0 INTEGER;
  p_ExecutionCostRank_7c8126e0 INTEGER;
  p_UsesTemplate_7c8126e0 BOOLEAN;
  p_AuditQueryRuns_7c8126e0 BOOLEAN;
  p_CacheEnabled_7c8126e0 BOOLEAN;
  p_CacheTTLMinutes_7c8126e0 INTEGER;
  p_CacheMaxSize_7c8126e0 INTEGER;
  p_EmbeddingVector_7c8126e0 TEXT;
  p_EmbeddingModelID_7c8126e0 UUID;
  p_CacheValidationSQL_7c8126e0 TEXT;
  p_ID_7c8126e0 UUID;
BEGIN
  p_Name_7c8126e0 := 'Server Installed Version History';
  p_CategoryID_7c8126e0 := '17AFCCEC-6A37-EF11-86D4-000D3A4E707E';
  p_UserQuestion_7c8126e0 := 'Show me a list of versions installed on the server in order of most recent version first';
  p_Status_7c8126e0 := 'Approved';
  p_QualityRank_7c8126e0 := 9;
  p_ExecutionCostRank_7c8126e0 := 3;
  p_UsesTemplate_7c8126e0 := 0;
  p_AuditQueryRuns_7c8126e0 := 0;
  p_CacheEnabled_7c8126e0 := 0;
  p_ID_7c8126e0 := '23F8423E-F36B-1410-8D9C-00021F8B792E';
  PERFORM __mj."spUpdateQuery"(p_Name := p_Name_7c8126e0, p_CategoryID := p_CategoryID_7c8126e0, p_UserQuestion := p_UserQuestion_7c8126e0, p_Description := p_Description_7c8126e0, p_SQL := p_SQL_7c8126e0, p_TechnicalDescription := p_TechnicalDescription_7c8126e0, p_OriginalSQL := p_OriginalSQL_7c8126e0, p_Feedback := p_Feedback_7c8126e0, p_Status := p_Status_7c8126e0, p_QualityRank := p_QualityRank_7c8126e0, p_ExecutionCostRank := p_ExecutionCostRank_7c8126e0, p_UsesTemplate := p_UsesTemplate_7c8126e0, p_AuditQueryRuns := p_AuditQueryRuns_7c8126e0, p_CacheEnabled := p_CacheEnabled_7c8126e0, p_CacheTTLMinutes := p_CacheTTLMinutes_7c8126e0, p_CacheMaxSize := p_CacheMaxSize_7c8126e0, p_EmbeddingVector := p_EmbeddingVector_7c8126e0, p_EmbeddingModelID := p_EmbeddingModelID_7c8126e0, p_CacheValidationSQL := p_CacheValidationSQL_7c8126e0, p_ID := p_ID_7c8126e0);
END $$;

-- Save MJ: Test Types (core SP call only)
DO $$
DECLARE
  p_ID_ebb552cc UUID;
  p_Name_ebb552cc VARCHAR(100);
  p_Description_ebb552cc TEXT;
  p_DriverClass_ebb552cc VARCHAR(255);
  p_Status_ebb552cc VARCHAR(20);
  p_VariablesSchema_ebb552cc TEXT;
BEGIN
  p_ID_ebb552cc := '2CB270C8-98B2-48B8-B582-51B49FD97C50';
  p_Name_ebb552cc := 'Computer Use';
  p_Description_ebb552cc := 'Evaluates browser-based automation through the Computer Use Vision-to-Action engine. Drives a web browser via LLM reasoning over screenshots, then evaluates results using goal-completion, URL matching, and step count oracles.';
  p_DriverClass_ebb552cc := 'ComputerUseTestDriver';
  p_Status_ebb552cc := 'Active';
  PERFORM __mj."spCreateTestType"(p_ID := p_ID_ebb552cc, p_Name := p_Name_ebb552cc, p_Description := p_Description_ebb552cc, p_DriverClass := p_DriverClass_ebb552cc, p_Status := p_Status_ebb552cc, p_VariablesSchema := p_VariablesSchema_ebb552cc);
END $$;


-- ===================== FK & CHECK Constraints =====================


-- ===================== Grants =====================


-- ===================== Comments =====================
