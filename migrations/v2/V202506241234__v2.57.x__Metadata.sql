-- SQL Logging Session
-- Session ID: 75cfedbb-36b9-4874-a5d8-677cd40fe059
-- Started: 2025-06-24T17:33:32.972Z
-- Description: MetadataSync push operation
-- Generated by MemberJunction SQLServerDataProvider

-- Save Action Categories (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionCategory 
@ID= '0DC7433E-F36B-1410-8DB6-00021F8B792E',
@Name = 'Business Apps',
@Description = 'Integration actions for business applications including CRM, LMS, and Accounting systems',
@ParentID = NULL,
@Status = 'Active';

-- Save Action Categories (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionCategory 
@ID = '19C7433E-F36B-1410-8DB6-00021F8B792E',
@Name = 'CRM',
@Description = 'Customer Relationship Management system integrations for managing contacts, companies, deals, and sales activities',
@ParentID = '0DC7433E-F36B-1410-8DB6-00021F8B792E',
@Status = 'Active';

-- Save Action Categories (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionCategory 
@ID = '25C7433E-F36B-1410-8DB6-00021F8B792E',
@Name = 'LMS',
@Description = 'Learning Management System integrations for managing users, courses, enrollments, and educational content',
@ParentID = '0DC7433E-F36B-1410-8DB6-00021F8B792E',
@Status = 'Active';

-- Save Action Categories (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionCategory 
@ID = '31C7433E-F36B-1410-8DB6-00021F8B792E',
@Name = 'Accounting',
@Description = 'Accounting and financial system integrations for managing GL accounts, transactions, invoices, and financial reporting',
@ParentID = '0DC7433E-F36B-1410-8DB6-00021F8B792E',
@Status = 'Active';

-- Save Action Categories (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionCategory 
@ID = '3DC7433E-F36B-1410-8DB6-00021F8B792E',
@Name = 'HubSpot',
@Description = 'HubSpot CRM integration for managing contacts, companies, deals, tasks, and sales activities',
@ParentID = '19C7433E-F36B-1410-8DB6-00021F8B792E',
@Status = 'Active';

-- Save Action Categories (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionCategory 
@ID = '49C7433E-F36B-1410-8DB6-00021F8B792E',
@Name = 'LearnWorlds',
@Description = 'LearnWorlds LMS integration for managing online courses, user enrollments, progress tracking, and certificates',
@ParentID = '25C7433E-F36B-1410-8DB6-00021F8B792E',
@Status = 'Active';

-- Save Action Categories (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionCategory 
@ID = '55C7433E-F36B-1410-8DB6-00021F8B792E',
@Name = 'QuickBooks',
@Description = 'QuickBooks accounting integration for managing GL accounts, journal entries, transactions, and financial reporting',
@ParentID = '31C7433E-F36B-1410-8DB6-00021F8B792E',
@Status = 'Active';

-- Save Action Categories (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionCategory 
@ID = '61C7433E-F36B-1410-8DB6-00021F8B792E',
@Name = 'Business Central',
@Description = 'Microsoft Dynamics 365 Business Central integration for enterprise accounting, GL management, and financial operations',
@ParentID = '31C7433E-F36B-1410-8DB6-00021F8B792E',
@Status = 'Active';

-- Save Actions (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAction @CategoryID = '3DC7433E-F36B-1410-8DB6-00021F8B792E',
@Name = 'HubSpot - Create Contact',
@Description = 'Creates a new contact in HubSpot CRM with email, personal details, and optional company association',
@Type = 'Custom',
@UserPrompt = NULL,
@UserComments = NULL,
@Code = NULL,
@CodeComments = NULL,
@CodeApprovalStatus = 'Pending',
@CodeApprovalComments = NULL,
@CodeApprovedByUserID = NULL,
@CodeApprovedAt = NULL,
@CodeLocked = 0,
@ForceCodeGeneration = 0,
@RetentionPeriod = NULL,
@Status = 'Active',
@DriverClass = 'CreateContactAction',
@ParentID = NULL,
@IconClass = 'fa-solid fa-user-plus';

-- Save Actions (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAction @CategoryID = '3DC7433E-F36B-1410-8DB6-00021F8B792E',
@Name = 'HubSpot - Update Contact',
@Description = 'Updates an existing contact in HubSpot CRM by email or ID',
@Type = 'Custom',
@UserPrompt = NULL,
@UserComments = NULL,
@Code = NULL,
@CodeComments = NULL,
@CodeApprovalStatus = 'Pending',
@CodeApprovalComments = NULL,
@CodeApprovedByUserID = NULL,
@CodeApprovedAt = NULL,
@CodeLocked = 0,
@ForceCodeGeneration = 0,
@RetentionPeriod = NULL,
@Status = 'Active',
@DriverClass = 'UpdateContactAction',
@ParentID = NULL,
@IconClass = 'fa-solid fa-user-pen';

-- Save Actions (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAction @CategoryID = '3DC7433E-F36B-1410-8DB6-00021F8B792E',
@Name = 'HubSpot - Delete Contact',
@Description = 'Deletes a contact from HubSpot CRM by email or ID',
@Type = 'Custom',
@UserPrompt = NULL,
@UserComments = NULL,
@Code = NULL,
@CodeComments = NULL,
@CodeApprovalStatus = 'Pending',
@CodeApprovalComments = NULL,
@CodeApprovedByUserID = NULL,
@CodeApprovedAt = NULL,
@CodeLocked = 0,
@ForceCodeGeneration = 0,
@RetentionPeriod = NULL,
@Status = 'Active',
@DriverClass = 'DeleteContactAction',
@ParentID = NULL,
@IconClass = 'fa-solid fa-user-minus';

-- Save Actions (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAction @CategoryID = '3DC7433E-F36B-1410-8DB6-00021F8B792E',
@Name = 'HubSpot - Search Contacts',
@Description = 'Searches for contacts in HubSpot using various filters like email, name, company, or custom properties',
@Type = 'Custom',
@UserPrompt = NULL,
@UserComments = NULL,
@Code = NULL,
@CodeComments = NULL,
@CodeApprovalStatus = 'Pending',
@CodeApprovalComments = NULL,
@CodeApprovedByUserID = NULL,
@CodeApprovedAt = NULL,
@CodeLocked = 0,
@ForceCodeGeneration = 0,
@RetentionPeriod = NULL,
@Status = 'Active',
@DriverClass = 'SearchContactsAction',
@ParentID = NULL,
@IconClass = 'fa-solid fa-magnifying-glass';

-- Save Actions (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAction @CategoryID = '49C7433E-F36B-1410-8DB6-00021F8B792E',
@Name = 'LearnWorlds - Create User',
@Description = 'Creates a new user in LearnWorlds LMS with optional course enrollments',
@Type = 'Custom',
@UserPrompt = NULL,
@UserComments = NULL,
@Code = NULL,
@CodeComments = NULL,
@CodeApprovalStatus = 'Pending',
@CodeApprovalComments = NULL,
@CodeApprovedByUserID = NULL,
@CodeApprovedAt = NULL,
@CodeLocked = 0,
@ForceCodeGeneration = 0,
@RetentionPeriod = NULL,
@Status = 'Active',
@DriverClass = 'CreateUserAction',
@ParentID = NULL,
@IconClass = 'fa-solid fa-user-graduate';

-- Save Actions (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAction @CategoryID = '55C7433E-F36B-1410-8DB6-00021F8B792E',
@Name = 'QuickBooks - Create Journal Entry',
@Description = 'Creates a journal entry in QuickBooks with multiple debit and credit lines',
@Type = 'Custom',
@UserPrompt = NULL,
@UserComments = NULL,
@Code = NULL,
@CodeComments = NULL,
@CodeApprovalStatus = 'Pending',
@CodeApprovalComments = NULL,
@CodeApprovedByUserID = NULL,
@CodeApprovedAt = NULL,
@CodeLocked = 0,
@ForceCodeGeneration = 0,
@RetentionPeriod = NULL,
@Status = 'Active',
@DriverClass = 'CreateJournalEntryAction',
@ParentID = NULL,
@IconClass = 'fa-solid fa-file-invoice';

-- Save Actions (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAction @CategoryID = '3DC7433E-F36B-1410-8DB6-00021F8B792E',
@Name = 'HubSpot - Get Contact',
@Description = 'Retrieves a contact from HubSpot by ID or email',
@Type = 'Custom',
@UserPrompt = NULL,
@UserComments = NULL,
@Code = NULL,
@CodeComments = NULL,
@CodeApprovalStatus = 'Pending',
@CodeApprovalComments = NULL,
@CodeApprovedByUserID = NULL,
@CodeApprovedAt = NULL,
@CodeLocked = 0,
@ForceCodeGeneration = 0,
@RetentionPeriod = NULL,
@Status = 'Active',
@DriverClass = 'GetContactAction',
@ParentID = NULL,
@IconClass = 'fa-solid fa-user';

-- Save Actions (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAction @CategoryID = '3DC7433E-F36B-1410-8DB6-00021F8B792E',
@Name = 'HubSpot - Create Company',
@Description = 'Creates a new company in HubSpot CRM',
@Type = 'Custom',
@UserPrompt = NULL,
@UserComments = NULL,
@Code = NULL,
@CodeComments = NULL,
@CodeApprovalStatus = 'Pending',
@CodeApprovalComments = NULL,
@CodeApprovedByUserID = NULL,
@CodeApprovedAt = NULL,
@CodeLocked = 0,
@ForceCodeGeneration = 0,
@RetentionPeriod = NULL,
@Status = 'Active',
@DriverClass = 'CreateCompanyAction',
@ParentID = NULL,
@IconClass = 'fa-solid fa-building';

-- Save Actions (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAction @CategoryID = '3DC7433E-F36B-1410-8DB6-00021F8B792E',
@Name = 'HubSpot - Update Company',
@Description = 'Updates an existing company in HubSpot CRM',
@Type = 'Custom',
@UserPrompt = NULL,
@UserComments = NULL,
@Code = NULL,
@CodeComments = NULL,
@CodeApprovalStatus = 'Pending',
@CodeApprovalComments = NULL,
@CodeApprovedByUserID = NULL,
@CodeApprovedAt = NULL,
@CodeLocked = 0,
@ForceCodeGeneration = 0,
@RetentionPeriod = NULL,
@Status = 'Active',
@DriverClass = 'UpdateCompanyAction',
@ParentID = NULL,
@IconClass = 'fa-solid fa-building-circle-check';

-- Save Actions (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAction @CategoryID = '3DC7433E-F36B-1410-8DB6-00021F8B792E',
@Name = 'HubSpot - Create Deal',
@Description = 'Creates a new deal in HubSpot CRM with associated contacts and companies',
@Type = 'Custom',
@UserPrompt = NULL,
@UserComments = NULL,
@Code = NULL,
@CodeComments = NULL,
@CodeApprovalStatus = 'Pending',
@CodeApprovalComments = NULL,
@CodeApprovedByUserID = NULL,
@CodeApprovedAt = NULL,
@CodeLocked = 0,
@ForceCodeGeneration = 0,
@RetentionPeriod = NULL,
@Status = 'Active',
@DriverClass = 'CreateDealAction',
@ParentID = NULL,
@IconClass = 'fa-solid fa-handshake';

-- Save Actions (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAction @CategoryID = '3DC7433E-F36B-1410-8DB6-00021F8B792E',
@Name = 'HubSpot - Create Task',
@Description = 'Creates a task in HubSpot associated with contacts, companies, or deals',
@Type = 'Custom',
@UserPrompt = NULL,
@UserComments = NULL,
@Code = NULL,
@CodeComments = NULL,
@CodeApprovalStatus = 'Pending',
@CodeApprovalComments = NULL,
@CodeApprovedByUserID = NULL,
@CodeApprovedAt = NULL,
@CodeLocked = 0,
@ForceCodeGeneration = 0,
@RetentionPeriod = NULL,
@Status = 'Active',
@DriverClass = 'CreateTaskAction',
@ParentID = NULL,
@IconClass = 'fa-solid fa-list-check';

-- Save Actions (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAction @CategoryID = '3DC7433E-F36B-1410-8DB6-00021F8B792E',
@Name = 'HubSpot - Associate Contact to Company',
@Description = 'Associates a contact with a company in HubSpot CRM',
@Type = 'Custom',
@UserPrompt = NULL,
@UserComments = NULL,
@Code = NULL,
@CodeComments = NULL,
@CodeApprovalStatus = 'Pending',
@CodeApprovalComments = NULL,
@CodeApprovedByUserID = NULL,
@CodeApprovedAt = NULL,
@CodeLocked = 0,
@ForceCodeGeneration = 0,
@RetentionPeriod = NULL,
@Status = 'Active',
@DriverClass = 'AssociateContactToCompanyAction',
@ParentID = NULL,
@IconClass = 'fa-solid fa-link';

-- Save Actions (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAction @CategoryID = '3DC7433E-F36B-1410-8DB6-00021F8B792E',
@Name = 'HubSpot - Get Company',
@Description = 'Retrieves company details from HubSpot by ID',
@Type = 'Custom',
@UserPrompt = NULL,
@UserComments = NULL,
@Code = NULL,
@CodeComments = NULL,
@CodeApprovalStatus = 'Pending',
@CodeApprovalComments = NULL,
@CodeApprovedByUserID = NULL,
@CodeApprovedAt = NULL,
@CodeLocked = 0,
@ForceCodeGeneration = 0,
@RetentionPeriod = NULL,
@Status = 'Active',
@DriverClass = 'GetCompanyAction',
@ParentID = NULL,
@IconClass = 'fa-solid fa-building';

-- Save Actions (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAction @CategoryID = '3DC7433E-F36B-1410-8DB6-00021F8B792E',
@Name = 'HubSpot - Merge Contacts',
@Description = 'Merges two contacts in HubSpot, combining their data and associations',
@Type = 'Custom',
@UserPrompt = NULL,
@UserComments = NULL,
@Code = NULL,
@CodeComments = NULL,
@CodeApprovalStatus = 'Pending',
@CodeApprovalComments = NULL,
@CodeApprovedByUserID = NULL,
@CodeApprovedAt = NULL,
@CodeLocked = 0,
@ForceCodeGeneration = 0,
@RetentionPeriod = NULL,
@Status = 'Active',
@DriverClass = 'MergeContactsAction',
@ParentID = NULL,
@IconClass = 'fa-solid fa-code-merge';

-- Save Actions (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAction @CategoryID = '3DC7433E-F36B-1410-8DB6-00021F8B792E',
@Name = 'HubSpot - Search Companies',
@Description = 'Searches for companies in HubSpot using various filters',
@Type = 'Custom',
@UserPrompt = NULL,
@UserComments = NULL,
@Code = NULL,
@CodeComments = NULL,
@CodeApprovalStatus = 'Pending',
@CodeApprovalComments = NULL,
@CodeApprovedByUserID = NULL,
@CodeApprovedAt = NULL,
@CodeLocked = 0,
@ForceCodeGeneration = 0,
@RetentionPeriod = NULL,
@Status = 'Active',
@DriverClass = 'SearchCompaniesAction',
@ParentID = NULL,
@IconClass = 'fa-solid fa-building-magnifying-glass';

-- Save Actions (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAction @CategoryID = '3DC7433E-F36B-1410-8DB6-00021F8B792E',
@Name = 'HubSpot - Get Deal',
@Description = 'Retrieves a specific deal from HubSpot by ID',
@Type = 'Custom',
@UserPrompt = NULL,
@UserComments = NULL,
@Code = NULL,
@CodeComments = NULL,
@CodeApprovalStatus = 'Pending',
@CodeApprovalComments = NULL,
@CodeApprovedByUserID = NULL,
@CodeApprovedAt = NULL,
@CodeLocked = 0,
@ForceCodeGeneration = 0,
@RetentionPeriod = NULL,
@Status = 'Active',
@DriverClass = 'GetDealAction',
@ParentID = NULL,
@IconClass = 'fa-solid fa-handshake';

-- Save Actions (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAction @CategoryID = '3DC7433E-F36B-1410-8DB6-00021F8B792E',
@Name = 'HubSpot - Update Deal',
@Description = 'Updates an existing deal in HubSpot',
@Type = 'Custom',
@UserPrompt = NULL,
@UserComments = NULL,
@Code = NULL,
@CodeComments = NULL,
@CodeApprovalStatus = 'Pending',
@CodeApprovalComments = NULL,
@CodeApprovedByUserID = NULL,
@CodeApprovedAt = NULL,
@CodeLocked = 0,
@ForceCodeGeneration = 0,
@RetentionPeriod = NULL,
@Status = 'Active',
@DriverClass = 'UpdateDealAction',
@ParentID = NULL,
@IconClass = 'fa-solid fa-handshake-angle';

-- Save Actions (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAction @CategoryID = '3DC7433E-F36B-1410-8DB6-00021F8B792E',
@Name = 'HubSpot - Log Activity',
@Description = 'Logs an activity (call, email, meeting, note) in HubSpot',
@Type = 'Custom',
@UserPrompt = NULL,
@UserComments = NULL,
@Code = NULL,
@CodeComments = NULL,
@CodeApprovalStatus = 'Pending',
@CodeApprovalComments = NULL,
@CodeApprovedByUserID = NULL,
@CodeApprovedAt = NULL,
@CodeLocked = 0,
@ForceCodeGeneration = 0,
@RetentionPeriod = NULL,
@Status = 'Active',
@DriverClass = 'LogActivityAction',
@ParentID = NULL,
@IconClass = 'fa-solid fa-clipboard-list';

-- Save Actions (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAction @CategoryID = '3DC7433E-F36B-1410-8DB6-00021F8B792E',
@Name = 'HubSpot - Search Deals',
@Description = 'Searches for deals in HubSpot with various filters',
@Type = 'Custom',
@UserPrompt = NULL,
@UserComments = NULL,
@Code = NULL,
@CodeComments = NULL,
@CodeApprovalStatus = 'Pending',
@CodeApprovalComments = NULL,
@CodeApprovedByUserID = NULL,
@CodeApprovedAt = NULL,
@CodeLocked = 0,
@ForceCodeGeneration = 0,
@RetentionPeriod = NULL,
@Status = 'Active',
@DriverClass = 'SearchDealsAction',
@ParentID = NULL,
@IconClass = 'fa-solid fa-magnifying-glass-dollar';

-- Save Actions (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAction @CategoryID = '3DC7433E-F36B-1410-8DB6-00021F8B792E',
@Name = 'HubSpot - Get Deals by Company',
@Description = 'Retrieves all deals associated with a specific company',
@Type = 'Custom',
@UserPrompt = NULL,
@UserComments = NULL,
@Code = NULL,
@CodeComments = NULL,
@CodeApprovalStatus = 'Pending',
@CodeApprovalComments = NULL,
@CodeApprovedByUserID = NULL,
@CodeApprovedAt = NULL,
@CodeLocked = 0,
@ForceCodeGeneration = 0,
@RetentionPeriod = NULL,
@Status = 'Active',
@DriverClass = 'GetDealsByCompanyAction',
@ParentID = NULL,
@IconClass = 'fa-solid fa-building-circle-arrow-right';

-- Save Actions (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAction @CategoryID = '3DC7433E-F36B-1410-8DB6-00021F8B792E',
@Name = 'HubSpot - Get Deals by Contact',
@Description = 'Retrieves all deals associated with a specific contact',
@Type = 'Custom',
@UserPrompt = NULL,
@UserComments = NULL,
@Code = NULL,
@CodeComments = NULL,
@CodeApprovalStatus = 'Pending',
@CodeApprovalComments = NULL,
@CodeApprovedByUserID = NULL,
@CodeApprovedAt = NULL,
@CodeLocked = 0,
@ForceCodeGeneration = 0,
@RetentionPeriod = NULL,
@Status = 'Active',
@DriverClass = 'GetDealsByContactAction',
@ParentID = NULL,
@IconClass = 'fa-solid fa-user-tie';

-- Save Actions (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAction @CategoryID = '3DC7433E-F36B-1410-8DB6-00021F8B792E',
@Name = 'HubSpot - Get Activities by Contact',
@Description = 'Retrieves all activities (calls, emails, meetings, notes) for a contact',
@Type = 'Custom',
@UserPrompt = NULL,
@UserComments = NULL,
@Code = NULL,
@CodeComments = NULL,
@CodeApprovalStatus = 'Pending',
@CodeApprovalComments = NULL,
@CodeApprovedByUserID = NULL,
@CodeApprovedAt = NULL,
@CodeLocked = 0,
@ForceCodeGeneration = 0,
@RetentionPeriod = NULL,
@Status = 'Active',
@DriverClass = 'GetActivitiesByContactAction',
@ParentID = NULL,
@IconClass = 'fa-solid fa-clock-rotate-left';

-- Save Actions (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAction @CategoryID = '3DC7433E-F36B-1410-8DB6-00021F8B792E',
@Name = 'HubSpot - Update Task',
@Description = 'Updates an existing task in HubSpot',
@Type = 'Custom',
@UserPrompt = NULL,
@UserComments = NULL,
@Code = NULL,
@CodeComments = NULL,
@CodeApprovalStatus = 'Pending',
@CodeApprovalComments = NULL,
@CodeApprovedByUserID = NULL,
@CodeApprovedAt = NULL,
@CodeLocked = 0,
@ForceCodeGeneration = 0,
@RetentionPeriod = NULL,
@Status = 'Active',
@DriverClass = 'UpdateTaskAction',
@ParentID = NULL,
@IconClass = 'fa-solid fa-square-check';

-- Save Actions (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAction @CategoryID = '3DC7433E-F36B-1410-8DB6-00021F8B792E',
@Name = 'HubSpot - Get Upcoming Tasks',
@Description = 'Retrieves upcoming and overdue tasks from HubSpot',
@Type = 'Custom',
@UserPrompt = NULL,
@UserComments = NULL,
@Code = NULL,
@CodeComments = NULL,
@CodeApprovalStatus = 'Pending',
@CodeApprovalComments = NULL,
@CodeApprovedByUserID = NULL,
@CodeApprovedAt = NULL,
@CodeLocked = 0,
@ForceCodeGeneration = 0,
@RetentionPeriod = NULL,
@Status = 'Active',
@DriverClass = 'GetUpcomingTasksAction',
@ParentID = NULL,
@IconClass = 'fa-solid fa-calendar-check';

-- Save Actions (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAction @CategoryID = '49C7433E-F36B-1410-8DB6-00021F8B792E',
@Name = 'LearnWorlds - Enroll User',
@Description = 'Enrolls a user in a LearnWorlds course',
@Type = 'Custom',
@UserPrompt = NULL,
@UserComments = NULL,
@Code = NULL,
@CodeComments = NULL,
@CodeApprovalStatus = 'Pending',
@CodeApprovalComments = NULL,
@CodeApprovedByUserID = NULL,
@CodeApprovedAt = NULL,
@CodeLocked = 0,
@ForceCodeGeneration = 0,
@RetentionPeriod = NULL,
@Status = 'Active',
@DriverClass = 'EnrollUserAction',
@ParentID = NULL,
@IconClass = 'fa-solid fa-user-plus';

-- Save Actions (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAction @CategoryID = '49C7433E-F36B-1410-8DB6-00021F8B792E',
@Name = 'LearnWorlds - Get User Details',
@Description = 'Retrieves detailed information about a LearnWorlds user',
@Type = 'Custom',
@UserPrompt = NULL,
@UserComments = NULL,
@Code = NULL,
@CodeComments = NULL,
@CodeApprovalStatus = 'Pending',
@CodeApprovalComments = NULL,
@CodeApprovedByUserID = NULL,
@CodeApprovedAt = NULL,
@CodeLocked = 0,
@ForceCodeGeneration = 0,
@RetentionPeriod = NULL,
@Status = 'Active',
@DriverClass = 'GetUserDetailsAction',
@ParentID = NULL,
@IconClass = 'fa-solid fa-user';

-- Save Actions (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAction @CategoryID = '49C7433E-F36B-1410-8DB6-00021F8B792E',
@Name = 'LearnWorlds - Get User Enrollments',
@Description = 'Retrieves all course enrollments for a specific user',
@Type = 'Custom',
@UserPrompt = NULL,
@UserComments = NULL,
@Code = NULL,
@CodeComments = NULL,
@CodeApprovalStatus = 'Pending',
@CodeApprovalComments = NULL,
@CodeApprovedByUserID = NULL,
@CodeApprovedAt = NULL,
@CodeLocked = 0,
@ForceCodeGeneration = 0,
@RetentionPeriod = NULL,
@Status = 'Active',
@DriverClass = 'GetUserEnrollmentsAction',
@ParentID = NULL,
@IconClass = 'fa-solid fa-graduation-cap';

-- Save Actions (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAction @CategoryID = '49C7433E-F36B-1410-8DB6-00021F8B792E',
@Name = 'LearnWorlds - Get Courses',
@Description = 'Retrieves available courses from LearnWorlds',
@Type = 'Custom',
@UserPrompt = NULL,
@UserComments = NULL,
@Code = NULL,
@CodeComments = NULL,
@CodeApprovalStatus = 'Pending',
@CodeApprovalComments = NULL,
@CodeApprovedByUserID = NULL,
@CodeApprovedAt = NULL,
@CodeLocked = 0,
@ForceCodeGeneration = 0,
@RetentionPeriod = NULL,
@Status = 'Active',
@DriverClass = 'GetCoursesAction',
@ParentID = NULL,
@IconClass = 'fa-solid fa-book';

-- Save Actions (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAction @CategoryID = '49C7433E-F36B-1410-8DB6-00021F8B792E',
@Name = 'LearnWorlds - Get Course Details',
@Description = 'Retrieves detailed information about a specific course',
@Type = 'Custom',
@UserPrompt = NULL,
@UserComments = NULL,
@Code = NULL,
@CodeComments = NULL,
@CodeApprovalStatus = 'Pending',
@CodeApprovalComments = NULL,
@CodeApprovedByUserID = NULL,
@CodeApprovedAt = NULL,
@CodeLocked = 0,
@ForceCodeGeneration = 0,
@RetentionPeriod = NULL,
@Status = 'Active',
@DriverClass = 'GetCourseDetailsAction',
@ParentID = NULL,
@IconClass = 'fa-solid fa-book-open';

-- Save Actions (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAction @CategoryID = '49C7433E-F36B-1410-8DB6-00021F8B792E',
@Name = 'LearnWorlds - Get User Progress',
@Description = 'Gets a user''s progress in a specific course',
@Type = 'Custom',
@UserPrompt = NULL,
@UserComments = NULL,
@Code = NULL,
@CodeComments = NULL,
@CodeApprovalStatus = 'Pending',
@CodeApprovalComments = NULL,
@CodeApprovedByUserID = NULL,
@CodeApprovedAt = NULL,
@CodeLocked = 0,
@ForceCodeGeneration = 0,
@RetentionPeriod = NULL,
@Status = 'Active',
@DriverClass = 'GetUserProgressAction',
@ParentID = NULL,
@IconClass = 'fa-solid fa-chart-line';

-- Save Actions (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAction @CategoryID = '49C7433E-F36B-1410-8DB6-00021F8B792E',
@Name = 'LearnWorlds - Update User Progress',
@Description = 'Updates a user''s progress in a course',
@Type = 'Custom',
@UserPrompt = NULL,
@UserComments = NULL,
@Code = NULL,
@CodeComments = NULL,
@CodeApprovalStatus = 'Pending',
@CodeApprovalComments = NULL,
@CodeApprovedByUserID = NULL,
@CodeApprovedAt = NULL,
@CodeLocked = 0,
@ForceCodeGeneration = 0,
@RetentionPeriod = NULL,
@Status = 'Active',
@DriverClass = 'UpdateUserProgressAction',
@ParentID = NULL,
@IconClass = 'fa-solid fa-circle-check';

-- Save Actions (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAction @CategoryID = '49C7433E-F36B-1410-8DB6-00021F8B792E',
@Name = 'LearnWorlds - Get Certificates',
@Description = 'Retrieves certificates earned by a user',
@Type = 'Custom',
@UserPrompt = NULL,
@UserComments = NULL,
@Code = NULL,
@CodeComments = NULL,
@CodeApprovalStatus = 'Pending',
@CodeApprovalComments = NULL,
@CodeApprovedByUserID = NULL,
@CodeApprovedAt = NULL,
@CodeLocked = 0,
@ForceCodeGeneration = 0,
@RetentionPeriod = NULL,
@Status = 'Active',
@DriverClass = 'GetCertificatesAction',
@ParentID = NULL,
@IconClass = 'fa-solid fa-certificate';

-- Save Actions (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAction @CategoryID = '49C7433E-F36B-1410-8DB6-00021F8B792E',
@Name = 'LearnWorlds - Get Course Analytics',
@Description = 'Retrieves analytics data for a course including enrollments and completion rates',
@Type = 'Custom',
@UserPrompt = NULL,
@UserComments = NULL,
@Code = NULL,
@CodeComments = NULL,
@CodeApprovalStatus = 'Pending',
@CodeApprovalComments = NULL,
@CodeApprovedByUserID = NULL,
@CodeApprovedAt = NULL,
@CodeLocked = 0,
@ForceCodeGeneration = 0,
@RetentionPeriod = NULL,
@Status = 'Active',
@DriverClass = 'GetCourseAnalyticsAction',
@ParentID = NULL,
@IconClass = 'fa-solid fa-chart-bar';

-- Save Actions (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAction @CategoryID = '49C7433E-F36B-1410-8DB6-00021F8B792E',
@Name = 'LearnWorlds - Get Users',
@Description = 'Retrieves a list of users from LearnWorlds with filtering options',
@Type = 'Custom',
@UserPrompt = NULL,
@UserComments = NULL,
@Code = NULL,
@CodeComments = NULL,
@CodeApprovalStatus = 'Pending',
@CodeApprovalComments = NULL,
@CodeApprovedByUserID = NULL,
@CodeApprovedAt = NULL,
@CodeLocked = 0,
@ForceCodeGeneration = 0,
@RetentionPeriod = NULL,
@Status = 'Active',
@DriverClass = 'GetUsersAction',
@ParentID = NULL,
@IconClass = 'fa-solid fa-users';

-- Save Actions (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAction @CategoryID = '49C7433E-F36B-1410-8DB6-00021F8B792E',
@Name = 'LearnWorlds - Get Quiz Results',
@Description = 'Retrieves quiz results for a user across courses',
@Type = 'Custom',
@UserPrompt = NULL,
@UserComments = NULL,
@Code = NULL,
@CodeComments = NULL,
@CodeApprovalStatus = 'Pending',
@CodeApprovalComments = NULL,
@CodeApprovedByUserID = NULL,
@CodeApprovedAt = NULL,
@CodeLocked = 0,
@ForceCodeGeneration = 0,
@RetentionPeriod = NULL,
@Status = 'Active',
@DriverClass = 'GetQuizResultsAction',
@ParentID = NULL,
@IconClass = 'fa-solid fa-clipboard-check';

-- Save Actions (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAction @CategoryID = '55C7433E-F36B-1410-8DB6-00021F8B792E',
@Name = 'QuickBooks - Get GL Codes',
@Description = 'Retrieves general ledger codes/chart of accounts from QuickBooks',
@Type = 'Custom',
@UserPrompt = NULL,
@UserComments = NULL,
@Code = NULL,
@CodeComments = NULL,
@CodeApprovalStatus = 'Pending',
@CodeApprovalComments = NULL,
@CodeApprovedByUserID = NULL,
@CodeApprovedAt = NULL,
@CodeLocked = 0,
@ForceCodeGeneration = 0,
@RetentionPeriod = NULL,
@Status = 'Active',
@DriverClass = 'GetGLCodesAction',
@ParentID = NULL,
@IconClass = 'fa-solid fa-list-ol';

-- Save Actions (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAction @CategoryID = '55C7433E-F36B-1410-8DB6-00021F8B792E',
@Name = 'QuickBooks - Get Account Balances',
@Description = 'Retrieves account balances from QuickBooks as of a specific date',
@Type = 'Custom',
@UserPrompt = NULL,
@UserComments = NULL,
@Code = NULL,
@CodeComments = NULL,
@CodeApprovalStatus = 'Pending',
@CodeApprovalComments = NULL,
@CodeApprovedByUserID = NULL,
@CodeApprovedAt = NULL,
@CodeLocked = 0,
@ForceCodeGeneration = 0,
@RetentionPeriod = NULL,
@Status = 'Active',
@DriverClass = 'GetAccountBalancesAction',
@ParentID = NULL,
@IconClass = 'fa-solid fa-balance-scale';

-- Save Actions (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAction @CategoryID = '55C7433E-F36B-1410-8DB6-00021F8B792E',
@Name = 'QuickBooks - Get Transactions',
@Description = 'Retrieves transactions from QuickBooks for a date range',
@Type = 'Custom',
@UserPrompt = NULL,
@UserComments = NULL,
@Code = NULL,
@CodeComments = NULL,
@CodeApprovalStatus = 'Pending',
@CodeApprovalComments = NULL,
@CodeApprovedByUserID = NULL,
@CodeApprovedAt = NULL,
@CodeLocked = 0,
@ForceCodeGeneration = 0,
@RetentionPeriod = NULL,
@Status = 'Active',
@DriverClass = 'GetTransactionsAction',
@ParentID = NULL,
@IconClass = 'fa-solid fa-exchange-alt';

-- Save Actions (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAction @CategoryID = '61C7433E-F36B-1410-8DB6-00021F8B792E',
@Name = 'Business Central - Get Customers',
@Description = 'Retrieves customers from Microsoft Dynamics 365 Business Central',
@Type = 'Custom',
@UserPrompt = NULL,
@UserComments = NULL,
@Code = NULL,
@CodeComments = NULL,
@CodeApprovalStatus = 'Pending',
@CodeApprovalComments = NULL,
@CodeApprovedByUserID = NULL,
@CodeApprovedAt = NULL,
@CodeLocked = 0,
@ForceCodeGeneration = 0,
@RetentionPeriod = NULL,
@Status = 'Active',
@DriverClass = 'GetCustomersAction',
@ParentID = NULL,
@IconClass = 'fa-solid fa-users';

-- Save Actions (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAction @CategoryID = '61C7433E-F36B-1410-8DB6-00021F8B792E',
@Name = 'Business Central - Get General Ledger Entries',
@Description = 'Retrieves general ledger entries from Business Central',
@Type = 'Custom',
@UserPrompt = NULL,
@UserComments = NULL,
@Code = NULL,
@CodeComments = NULL,
@CodeApprovalStatus = 'Pending',
@CodeApprovalComments = NULL,
@CodeApprovedByUserID = NULL,
@CodeApprovedAt = NULL,
@CodeLocked = 0,
@ForceCodeGeneration = 0,
@RetentionPeriod = NULL,
@Status = 'Active',
@DriverClass = 'GetGeneralLedgerEntriesAction',
@ParentID = NULL,
@IconClass = 'fa-solid fa-book';

-- Save Actions (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAction @CategoryID = '61C7433E-F36B-1410-8DB6-00021F8B792E',
@Name = 'Business Central - Get GL Accounts',
@Description = 'Retrieves chart of GL accounts from Business Central',
@Type = 'Custom',
@UserPrompt = NULL,
@UserComments = NULL,
@Code = NULL,
@CodeComments = NULL,
@CodeApprovalStatus = 'Pending',
@CodeApprovalComments = NULL,
@CodeApprovedByUserID = NULL,
@CodeApprovedAt = NULL,
@CodeLocked = 0,
@ForceCodeGeneration = 0,
@RetentionPeriod = NULL,
@Status = 'Active',
@DriverClass = 'GetGLAccountsAction',
@ParentID = NULL,
@IconClass = 'fa-solid fa-list';

-- Save Actions (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAction @CategoryID = '61C7433E-F36B-1410-8DB6-00021F8B792E',
@Name = 'Business Central - Get Sales Invoices',
@Description = 'Retrieves sales invoices from Business Central with filtering options',
@Type = 'Custom',
@UserPrompt = NULL,
@UserComments = NULL,
@Code = NULL,
@CodeComments = NULL,
@CodeApprovalStatus = 'Pending',
@CodeApprovalComments = NULL,
@CodeApprovedByUserID = NULL,
@CodeApprovedAt = NULL,
@CodeLocked = 0,
@ForceCodeGeneration = 0,
@RetentionPeriod = NULL,
@Status = 'Active',
@DriverClass = 'GetSalesInvoicesAction',
@ParentID = NULL,
@IconClass = 'fa-solid fa-file-invoice';


-- End of SQL Logging Session
-- Session ID: 75cfedbb-36b9-4874-a5d8-677cd40fe059
-- Completed: 2025-06-24T17:33:34.483Z
-- Duration: 1511ms
-- Total Statements: 50




-- SQL Logging Session
-- Session ID: 6c44ab04-b746-4dff-9bea-5df281519c19
-- Started: 2025-06-24T22:14:06.130Z
-- Description: MetadataSync push operation
-- Generated by MemberJunction SQLServerDataProvider

-- Save Template Contents (core SP call only)
EXEC [__mj].spUpdateTemplateContent @TemplateID = '8E5F83E5-837B-4C53-9171-08272BF605A4',
@TypeID = 'E7AFCCEC-6A37-EF11-86D4-000D3A4E707E',
@TemplateText = N'# Loop Agent Type System Prompt

You are an AI agent operating in a **continuous loop-based execution pattern**. Your role is to iteratively work toward completing the USER''S OVERALL GOAL through multiple cycles of analysis, action, and re-evaluation.      

**CRITICAL**: You must continue looping until the USER''S COMPLETE TASK is accomplished - NOT just when a sub-agent or action completes. Sub-agents and actions are merely tools in your toolkit. After each sub-agent or action returns, you MUST:
1. Analyze what was accomplished.   
2. Compare it to the user''s original goal
3. Determine what still needs to be done
4. Continue working until **EVERYTHING** is complete

This first section of your system prompt tells you about the Agent Type. Following this section you will learn about the specific agent we are running. 
 
## Your Capabilities    

{% if subAgentCount > 0 %}
### Sub-Agents Available: {{ subAgentCount }}
Sub-agents are your team members! Sub-agents have specialized expertise can perform a wide variety of tasks and you may **only execute one sub-agent at a time**. 

**IMPORTANT**: When a sub-agent completes its task, that does NOT mean YOUR task is complete. Sub-agents handle specific subtasks. You must:
- Review the sub-agent''s results
- Integrate them into your overall progress
- Determine if more work is needed to achieve the user''s goal
- Continue with additional sub-agents or actions as needed

The sub-agents available to you are:
 
{{ subAgentDetails | safe }} 

{% endif %}

{% if actionCount > 0 %}
### Actions Available: {{ actionCount }}
An action is a tool you can use to perform a specific task. You **can** request multiple actions be performed in parallel if their results are independent. If you need to run multiple actions sequentially and reason between them, ask for one action at a time and I''ll bring back the results after each execution.

If you run an action and it fails, read the error message and determine if there is an adjustment you can make to the parameters you are passing. Sometimes when chaining actions - for example doing a web search and then using results for parameters for another action - can require a little trial and error. **You may try this up to 3 times for any given action attempt**

#### Available Actions:
{{ actionDetails | safe }}

{% endif %}


## Task Execution

The user''s request and any additional context will be provided below. Your execution follows this pattern:

### On Each Loop Iteration:
1. **Assess Overall Progress**: What percentage of the USER''S COMPLETE GOAL has been achieved?
2. **Identify Remaining Work**: What specific tasks still need to be done?
3. **Choose Next Step**: Select the most appropriate sub-agent or action(s)
4. **Execute and Continue**: After receiving results, LOOP BACK to step 1

### Key Decision Points:
1. **Is the ENTIRE user task completed?** (Not just the last sub-agent/action)
2. If not complete, what is the next most valuable step?
3. Which sub-agent to invoke OR which action(s) to perform?
4. Your reasoning for the decision
5. Any accumulated results to maintain across iterations

**IMPORTANT** - it if okay to stop processing if you determine that you don''t have the tools to do the job. Don''t retry the same actions/sub-agents over and over expecting different outcomes. For example if you have a scenario where you have an action to get a list of data but you don''t have an action to retrieve more details on each element, you really can''t work past that if the details are required for your workflow, so let the user know.

# Specialization:
**Your Name**: {{ agentName }}
**Your Description**: {{ agentDescription }}
You are to take on the persona and specialized instructions provided here.  

## Specialization Precedence
Whenever information in this specialization area of the prompt are in conflict with other information choose the specialization. However, you must
always use our designated response format shown below

## Specialization Details:
{{ agentSpecificPrompt }}


# Response Format
You will be using JSON to respond in compliance with this TypeScript:
```ts
/**
 * Response structure expected from the Loop Agent Type system prompt.
 * This interface matches the JSON schema defined in the loop agent type template.
 * 
 * T is the generic type for the payload, allowing flexibility in the data returned
 * by the agent. This can be any structured data type that the agent needs to return
 * to the user or calling system, defaults to any.
 * 
 * @interface LoopAgentResponse
 */
export interface LoopAgentResponse<T = any> {
    /**
     * Indicates whether the entire task has been completed successfully.
     * When true, the agent loop will terminate and return the final result.
     * When false, processing will continue based on nextStep.
     */
    taskComplete: boolean;
    
    /**
     * A message that provides information to the caller, which is either a human, another computer system, or 
     * a parent agent. This message should be readable, clear and provide insight. The structured
     * details of the result of the agent''s execution should not be here, but rather be included in the @see payload.
     * 
     * This message should include EVERYTHING that you want the user to be able to read, they do not
     * see what is in the payload, so even if this is redundant with the payload, it is important to
     * include it here so that the user can read it.
     *
     * This message is returned regardless of whether taskComplete is true or false, allowing
     * the agent to communicate with its caller.
     * 
     * In the event of taskComplete being false and the nextStep.type is ''chat'', this message
     * will be sent to the user as a chat message.
     * @type {string}
     */
    message: string;

    /**
     * Agent specific payload that contains the result of the task.
     * This can include accumulated results, processed data, or any other
     * information that the agent has gathered during its execution.
     * This payload is returned when taskComplete is true, allowing the agent
     * to return a structured result to the user or calling system.
     * @type {T}
     */
    payload: T;
    
    /**
     * The agent''s internal reasoning about the current state and decision made.
     * This should be a clear, concise explanation of why the agent chose
     * the specific next step or to complete, helping with debugging and transparency.
     */
    reasoning: string;
    
    /**
     * The agent''s confidence level in its decision (0.0 to 1.0).
     * Higher values indicate greater certainty about the chosen action.
     * Can be used for logging, debugging, or conditional logic.
     * @optional
     */
    confidence?: number;

    /**
     * Defines what the agent should do next. Only required when taskComplete is false.
     * The agent must specify exactly one type of next step (action, sub-agent, or chat).
     * @optional
     */
    nextStep?: {
        /**
         * The type of operation to perform next:
         * - ''action'': Execute one or more actions in parallel
         * - ''sub-agent'': Delegate to a single sub-agent
         * - ''chat'': Send a message back to the user
         */
        type: ''action'' | ''sub-agent'' | ''chat'';
        
        /**
         * Array of actions to execute. Required when type is ''action''.
         * All actions in the array will be executed in parallel.
         * @optional
         */
        actions?: Array<{
            /**
             * The unique identifier (UUID) of the action to execute.
             * Must match an action ID from the available actions list.
             */
            id: string;
            
            /**
             * The human-readable name of the action.
             * Should match the name from the available actions list.
             */
            name: string;
            
            /**
             * Parameters to pass to the action.
             * Keys must match the parameter names defined in the action''s schema.
             * Values should match the expected types for each parameter.
             */
            params: Record<string, unknown>;
        }>;
        
        /**
         * Sub-agent to invoke. Required when type is ''sub-agent''.
         * Only one sub-agent can be invoked at a time.
         * @optional
         */
        subAgent?: {
            /**
             * The unique identifier (UUID) of the sub-agent to execute.
             * Must match a sub-agent ID from the available sub-agents list.
             */
            id: string;
            
            /**
             * The human-readable name of the sub-agent.
             * Should match the name from the available sub-agents list.
             */
            name: string;
            
            /**
             * The message to send to the sub-agent to help it understand and complete the task.
             * It is very important that this contains all necessary context for the sub-agent to comprehend
             * and complete it''s task correctly, because the current level conversation history is NOT provided 
             * to the sub-agent. 
             * 
             * Remember, some sub-agents will also define template parameters that you fill in to provide
             * structured context. If you think that additional structured context is helpful/needed for the
             * sub-agent beyond its template parameters, then you should include that here in the message and
             * include the structured info in a separate markdown block to make it easy for the sub-agent to parse.
             * ```json
             *    { "key": "value", "anotherKey": 123 }
             * ```
             */
            message: string;

            /**
             * If the sub-agent''s system prompt includes any template parameters,
             * this object should provide values for those parameters.
             * Keys **MUST** match the parameter names defined by the sub-aget.
             * Values should match the expected types for each parameter.
             * @optional
             */
            templateParameters?: Record<string, any>;
            
            /**
             * Whether to terminate the parent agent after the sub-agent completes.
             * - true: Return sub-agent result directly to user, parent agent stops
             * - false: Return sub-agent result to parent agent for further processing
             */
            terminateAfter: boolean;
        };
    };
}
```
Here is an example of how this JSON might look, but always **refer to the TypeScript shown above as the reference for what to return**.
```json
{{ _OUTPUT_EXAMPLE | safe }}
```

# Important Guidelines
1. **Always return valid JSON** - No additional text outside the JSON structure, no markdown, just JSON
2. **Be decisive** - Choose clear next steps based on available capabilities
3. **Estimate progress** - Provide meaningful progress updates based on the OVERALL goal
4. **Use sub-agents wisely** - Delegate to sub-agents when their specialization matches the need
5. **taskComplete = true ONLY when EVERYTHING is done** - This means the user''s ENTIRE request is fulfilled, not just when a sub-agent finishes. Common mistake: Setting taskComplete=true after a sub-agent returns. Instead, you should:
   - Set taskComplete=false after sub-agent returns
   - Analyze what the sub-agent accomplished
   - Determine next steps to complete the overall goal
   - Continue looping until the FULL task is done
6. **NEVER** stop working until you have completed the ENTIRE objective the user set. Each sub-agent or action completion is just one step in your journey. The only exception to this rule is if you encounter and **absolute** failure condition that prevents you from making progress. We don''t want you to just keep looping forever if you can''t make progress.
7. **After EVERY sub-agent or action**: Ask yourself "Is the user''s COMPLETE request fulfilled?" If not, continue with nextStep.
8. **terminateAfter for sub-agents**: 
   - Set to `false` (default) to continue processing after sub-agent returns
   - Only set to `true` if the sub-agent''s response should be the FINAL output to the user
9. **Accumulate results**: Maintain context and results across loop iterations in your payload field',
@Priority = 1,
@IsActive = 1,
@ID = '1C4B8853-04B8-4BF1-92D6-B102436837D7';
 
-- Save Template Params (core SP call only)
EXEC [__mj].spUpdateTemplateParam @TemplateID = '8E5F83E5-837B-4C53-9171-08272BF605A4',
@Name = N'actionCount',
@Description = N'Number of actions available to the agent',
@Type = N'Scalar',
@DefaultValue = NULL,
@IsRequired = 0,
@LinkedParameterName = NULL,
@LinkedParameterField = NULL,
@ExtraFilter = NULL,
@EntityID = NULL,
@RecordID = NULL,
@OrderBy = NULL,
@TemplateContentID = NULL,
@ID = '647F433E-F36B-1410-8DB6-00021F8B792E';

-- Save Template Params (core SP call only)
EXEC [__mj].spUpdateTemplateParam @TemplateID = '8E5F83E5-837B-4C53-9171-08272BF605A4',
@Name = N'actionDetails',
@Description = N'Details about each available action, rendered as safe HTML',
@Type = N'Scalar',
@DefaultValue = NULL,
@IsRequired = 0,
@LinkedParameterName = NULL,
@LinkedParameterField = NULL,
@ExtraFilter = NULL,
@EntityID = NULL,
@RecordID = NULL,
@OrderBy = NULL,
@TemplateContentID = NULL,
@ID = '687F433E-F36B-1410-8DB6-00021F8B792E';

-- Save Template Params (core SP call only)
EXEC [__mj].spUpdateTemplateParam @TemplateID = '8E5F83E5-837B-4C53-9171-08272BF605A4',
@Name = N'agentDescription',
@Description = N'Description of the current agent''s role and capabilities',
@Type = N'Scalar',
@DefaultValue = NULL,
@IsRequired = 1,
@LinkedParameterName = NULL,
@LinkedParameterField = NULL,
@ExtraFilter = NULL,
@EntityID = NULL,
@RecordID = NULL,
@OrderBy = NULL,
@TemplateContentID = NULL,
@ID = '6C7F433E-F36B-1410-8DB6-00021F8B792E';

-- Save Template Params (core SP call only)
EXEC [__mj].spUpdateTemplateParam @TemplateID = '8E5F83E5-837B-4C53-9171-08272BF605A4',
@Name = N'agentSpecificPrompt',
@Description = N'Additional detailed prompt describing the agent''s specialization',
@Type = N'Scalar',
@DefaultValue = NULL,
@IsRequired = 0,
@LinkedParameterName = NULL,
@LinkedParameterField = NULL,
@ExtraFilter = NULL,
@EntityID = NULL,
@RecordID = NULL,
@OrderBy = NULL,
@TemplateContentID = NULL,
@ID = '747F433E-F36B-1410-8DB6-00021F8B792E';

-- Save Template Params (core SP call only)
EXEC [__mj].spUpdateTemplateParam @TemplateID = '8E5F83E5-837B-4C53-9171-08272BF605A4',
@Name = N'subAgentCount',
@Description = N'Number of sub-agents available to the main agent',
@Type = N'Scalar',
@DefaultValue = NULL,
@IsRequired = 0,
@LinkedParameterName = NULL,
@LinkedParameterField = NULL,
@ExtraFilter = NULL,
@EntityID = NULL,
@RecordID = NULL,
@OrderBy = NULL,
@TemplateContentID = NULL,
@ID = '7C7F433E-F36B-1410-8DB6-00021F8B792E';

-- Save Template Params (core SP call only)
EXEC [__mj].spUpdateTemplateParam @TemplateID = '8E5F83E5-837B-4C53-9171-08272BF605A4',
@Name = N'subAgentDetails',
@Description = N'Details about each available sub-agent, rendered as safe HTML',
@Type = N'Scalar',
@DefaultValue = NULL,
@IsRequired = 0,
@LinkedParameterName = NULL,
@LinkedParameterField = NULL,
@ExtraFilter = NULL,
@EntityID = NULL,
@RecordID = NULL,
@OrderBy = NULL,
@TemplateContentID = NULL,
@ID = '887F433E-F36B-1410-8DB6-00021F8B792E';

-- Save AI Prompts (core SP call only)
EXEC [__mj].spUpdateAIPrompt @Name = N'Loop Agent Type: System Prompt',
@Description = N'Basic control structure for the Loop Agent Type',
@TemplateID = '8E5F83E5-837B-4C53-9171-08272BF605A4',
@CategoryID = 'A19D433E-F36B-1410-8DB1-00021F8B792E',
@TypeID = 'A6DA423E-F36B-1410-8DAC-00021F8B792E',
@Status = N'Active',
@ResponseFormat = N'JSON',
@ModelSpecificResponseFormat = NULL,
@AIModelTypeID = NULL,
@MinPowerRank = 0,
@SelectionStrategy = N'Specific',
@PowerPreference = N'Highest',
@ParallelizationMode = N'None',
@ParallelCount = NULL,
@ParallelConfigParam = NULL,
@OutputType = N'object',
@OutputExample = N'{
  "taskComplete": "[BOOLEAN: true if task is fully complete, false if more steps needed]",
  "message": "[STRING: Human-readable message about current status or final result - this is what the user/caller sees - they do NOT see what is in the payload, so include EVERYTHING here that is important for the user even if it overlaps with the payload]",
  "payload*": {
    "[KEY]": "[VALUE: Your agent-specific data structure goes here]",
    "[EXAMPLE_STRUCTURE]": {
      "resultsFound": "[NUMBER or other data]",
      "processedItems": "[Array of processed data]",
      "customField": "[Any structure your agent needs to return]"
    },
    "[NOTE]": "This payload structure is completely flexible based on your agent''s purpose"
  },
  "reasoning": "[STRING: Your internal explanation of why you made this decision - helps with debugging]",
  "confidence?": "[OPTIONAL NUMBER: 0.0 to 1.0 indicating confidence in this decision]",
  "nextStep?": {
    "type": "[REQUIRED if taskComplete=false: Must be exactly one of: ''action'' | ''sub-agent'' | ''chat'']",
    "actions?": [
      {
        "id": "[UUID: The exact ID from available actions list]",
        "name": "[STRING: The exact name from available actions list]",
        "params*": {
          "[PARAM_NAME]": "[PARAM_VALUE: Must match action''s expected parameters]",
          "[ANOTHER_PARAM]": "[Value matching the action''s parameter type]"
        }
      }
    ],
    "subAgent?": {
      "id": "[UUID: The exact ID from available sub-agents list]",
      "name": "[STRING: The exact name from available sub-agents list]",
      "message": "[STRING: Complete context and instructions for the sub-agent - they don''t see conversation history]",
      "templateParameters*": {
        "[TEMPLATE_PARAM_NAME]": "[VALUE: If sub-agent has template parameters, provide values here]"
      },
      "terminateAfter": "[BOOLEAN: true to end parent agent after sub-agent completes, false to continue]"
    }
  }
}',
@ValidationBehavior = N'Strict',
@MaxRetries = 2,
@RetryDelayMS = 1000,
@RetryStrategy = N'Fixed',
@ResultSelectorPromptID = NULL,
@EnableCaching = 0,
@CacheTTLSeconds = NULL,
@CacheMatchType = N'Exact',
@CacheSimilarityThreshold = NULL,
@CacheMustMatchModel = 1,
@CacheMustMatchVendor = 1,
@CacheMustMatchAgent = 0,
@CacheMustMatchConfig = 0,
@PromptRole = N'System',
@PromptPosition = N'First',
@Temperature = NULL,
@TopP = NULL,
@TopK = NULL,
@MinP = NULL,
@FrequencyPenalty = NULL,
@PresencePenalty = NULL,
@Seed = NULL,
@StopSequences = NULL,
@IncludeLogProbs = 0,
@TopLogProbs = NULL,
@ID = 'FF7D441F-36E1-458A-B548-0FC2208923BE';

-- Save Template Contents (core SP call only)
EXEC [__mj].spUpdateTemplateContent @TemplateID = '33AF5671-077E-46A9-94AB-340783733024',
@TypeID = 'E7AFCCEC-6A37-EF11-86D4-000D3A4E707E',
@TemplateText = N'You are an expert at parsing Nunjucks templates. Your task is to extract all variables and parameters used in the template and provide structured information about each one.

## Template to Analyze: 
{{ templateText }}

## Instructions:
Identify ALL variables used in the template, including:
1. Simple variables: {% raw %}{{ variableName }}{% endraw %}
2. Object properties: {% raw %}{{ user.email }}{% endraw %}, {% raw %}{{ data.items[0].name }}{% endraw %}
3. Variables in conditionals: {% raw %}{% if isActive %}{% endraw %}, {% raw %}{% if user.role == "admin" %}{% endraw %}
4. Loop variables: {% raw %}{% for item in items %}{% endraw %}, {% raw %}{% for key, value in object %}{% endraw %}
5. Variables in filters: {% raw %}{{ name | default(userName) }}{% endraw %}
6. Variables in function calls: {% raw %}{{ formatDate(createdAt) }}{% endraw %}
7. Variables in assignments: {% raw %}{% set total = price * quantity %}{% endraw %}

## **IMPORTANT** 
Do NOT include variables that are shown within {% raw %}{% raw %}{% endraw %}{% endraw %} blocks, those are for illustrative purposes and part of an illustration of what another template might have. Only consider variables that are **NOT** part of raw blocks to be valid for the purpose of this request.

For nested object references (like user.email), extract only the TOP-LEVEL variable name (user).

## Output Format: 
Return a JSON array of parameter objects with this structure:

```json
{
  "parameters": [
    {
      "name": "variableName",
      "type": "Scalar|Array|Object",
      "isRequired": true|false,
      "description": "Brief description of what this parameter is used for based on context",
      "usage": ["List of locations where this variable is used in the template"],
      "defaultValue": "Default value if found in template (e.g., from default filter)"
    }
  ]
}
```

## Rules:
1. Only include each variable ONCE (deduplicate)
2. Ignore Nunjucks built-in variables (loop, super, etc.)
3. For type detection:
   - If used in {% raw %}{% for x in variable %}{% endraw %}  type is "Array"
   - If properties are accessed (variable.property)  type is "Object"
   - Otherwise  type is "Scalar"
4. A variable is required if it has no default and no conditional protection
5. Include meaningful descriptions based on usage context
6. Sort parameters alphabetically by name

## Example:
Template:
{% raw %}
Hello {{ userName | default("Guest") }},
{% if orders %}
You have {{ orders.length }} orders.
{% for order in orders %}
- Order #{{ order.id }}: {{ order.total }}
{% endfor %}
{% endif %}
{% endraw %}

Output:
```json
{
  "parameters": [
    {
      "name": "orders",
      "type": "Array",
      "isRequired": false,
      "description": "List of user orders with id and total properties",
      "usage": ["if condition line 2", "for loop line 4", "length property line 3"],
      "defaultValue": null
    },
    {
      "name": "userName",
      "type": "Scalar",
      "isRequired": false,
      "description": "Name of the user to greet",
      "usage": ["greeting line 1"],
      "defaultValue": "Guest"
    }
  ]
}
```',
@Priority = 1,
@IsActive = 1,
@ID = '87E7401E-1AB6-4A41-A257-20ED3AE2CDA5';

-- Save AI Prompts (core SP call only)
EXEC [__mj].spUpdateAIPrompt @Name = N'Template Parameter Extraction',
@Description = N'Extracts Nunjucks variables and their types from template strings. Analyzes template content to identify all parameters used and infers their expected data types.',
@TemplateID = '33AF5671-077E-46A9-94AB-340783733024',
@CategoryID = '7D2DEF7F-138F-4620-8309-33964A97A997',
@TypeID = 'A6DA423E-F36B-1410-8DAC-00021F8B792E',
@Status = N'Active',
@ResponseFormat = N'JSON',
@ModelSpecificResponseFormat = NULL,
@AIModelTypeID = NULL,
@MinPowerRank = 0,
@SelectionStrategy = N'Specific',
@PowerPreference = N'Highest',
@ParallelizationMode = N'None',
@ParallelCount = NULL,
@ParallelConfigParam = NULL,
@OutputType = N'object',
@OutputExample = N'{
  "parameters": [
    {
      "name": "customerName",
      "type": "Scalar",
      "isRequired": true,
      "description": "The name of the customer",
      "usage": ["greeting header", "personalization"],
      "defaultValue": null
    },
    {
      "name": "orderItems",
      "type": "Array",
      "isRequired": false,
      "description": "List of items in the customer''s order",
      "usage": ["order details section", "item iteration"],
      "defaultValue": null
    },
    {
      "name": "companyInfo",
      "type": "Object",
      "isRequired": true,
      "description": "Company information object containing name, address, and contact details",
      "usage": ["footer section", "contact information"],
      "defaultValue": null
    }
  ]
}',
@ValidationBehavior = N'Strict',
@MaxRetries = 2,
@RetryDelayMS = 1000,
@RetryStrategy = N'Fixed',
@ResultSelectorPromptID = NULL,
@EnableCaching = 0,
@CacheTTLSeconds = NULL,
@CacheMatchType = N'Exact',
@CacheSimilarityThreshold = NULL,
@CacheMustMatchModel = 1,
@CacheMustMatchVendor = 1,
@CacheMustMatchAgent = 0,
@CacheMustMatchConfig = 0,
@PromptRole = N'System',
@PromptPosition = N'First',
@Temperature = NULL,
@TopP = NULL,
@TopK = NULL,
@MinP = NULL,
@FrequencyPenalty = NULL,
@PresencePenalty = NULL,
@Seed = NULL,
@StopSequences = NULL,
@IncludeLogProbs = 0,
@TopLogProbs = NULL,
@ID = 'C1D7FE6B-287B-4B3F-8618-4CDBCF1394BB';


-- End of SQL Logging Session
-- Session ID: 6c44ab04-b746-4dff-9bea-5df281519c19
-- Completed: 2025-06-24T22:14:29.066Z
-- Duration: 22936ms
-- Total Statements: 12
