-- SQL Logging Session
-- Session ID: 41185031-16d8-4a8c-b0d0-901562932f56
-- Started: 2025-12-20T16:40:15.829Z
-- Description: MetadataSync push operation
-- Format: Migration-ready with Flyway schema placeholders
-- Generated by MemberJunction SQLServerDataProvider

-- Save Template Contents (core SP call only)
DECLARE @TemplateID_0cba4ac7 UNIQUEIDENTIFIER,
@TypeID_0cba4ac7 UNIQUEIDENTIFIER,
@TemplateText_0cba4ac7 NVARCHAR(MAX),
@Priority_0cba4ac7 INT,
@IsActive_0cba4ac7 BIT,
@ID_0cba4ac7 UNIQUEIDENTIFIER
SET
  @TemplateID_0cba4ac7 = 'B28D9C1B-A5DF-45C3-97D0-FC483381FF60'
SET
  @TypeID_0cba4ac7 = 'E7AFCCEC-6A37-EF11-86D4-000D3A4E707E'
SET
  @TemplateText_0cba4ac7 = N'# Business Question Generator

You are an expert data analyst helping to generate meaningful business questions that can be answered with SQL queries.

## Entity Group Context

{% for entity in entityGroupMetadata %}
### Entity: {{ entity.entityName }}
- **Schema**: {{ entity.schemaName }}
- **View**: {{ entity.baseView }}
{% if entity.description %}- **Description**: {{ entity.description }}{% endif %}

**Fields**:
{% for field in entity.fields %}
- `{{ field.name }}` ({{ field.type }}){% if field.description %} - {{ field.description }}{% endif %}{% if field.isPrimaryKey %} [PRIMARY KEY]{% endif %}{% if field.isForeignKey %} [FK to {{ field.relatedEntity }}]{% endif %}
{% endfor %}

{% if entity.relationships.length > 0 %}
**Relationships**:
{% for rel in entity.relationships %}
- {{ rel.type }}: {{ rel.relatedEntity }} via `{{ rel.foreignKeyField }}`{% if rel.description %} - {{ rel.description }}{% endif %}
{% endfor %}
{% endif %}

---
{% endfor %}

## Instructions
Generate 1-2 realistic business questions that:
1. Use the available entities and their relationships
2. Are answerable with the data in these tables
3. Are practical questions a business user would ask
4. Vary in complexity (simple aggregations vs. complex joins)
5. Leverage entity descriptions to understand domain context

## Response Format

**CRITICAL INSTRUCTIONS:**
- I am a computer and can **only** read JSON responses
- Your response **must** be pure JSON that starts with `{` and ends with `}`
- **NO leading or trailing text** - no explanations, no markdown code blocks, no commentary
- **NO markdown formatting** like \`\`\`json - just the raw JSON
- Your response **must** match this exact structure:

**IMPORTANT: Entity Names**
- The `entities` array MUST contain the **Entity names** from the "Entity: X" headers above
- DO NOT use view names (e.g., "vwCustomers"), schema names, or table names
- Use ONLY the entity display names (e.g., "Customers", "Orders")
- These names appear after "Entity: " in each section header

Example JSON structure:
```
{
  "questions": [
    {
      "userQuestion": "What are the top 5 customers by order volume?",
      "description": "Identify customers with the most orders",
      "technicalDescription": "Count orders per customer, sort descending, limit 5",
      "complexity": "simple",
      "requiresAggregation": true,
      "requiresJoins": true,
      "entities": ["Customers", "Orders"]
    }
  ]
}
```
'
SET
  @Priority_0cba4ac7 = 1
SET
  @IsActive_0cba4ac7 = 1
SET
  @ID_0cba4ac7 = '64D29528-C48D-462B-8866-E1C08395F1C7'
EXEC [${flyway:defaultSchema}].spUpdateTemplateContent @TemplateID = @TemplateID_0cba4ac7,
  @TypeID = @TypeID_0cba4ac7,
  @TemplateText = @TemplateText_0cba4ac7,
  @Priority = @Priority_0cba4ac7,
  @IsActive = @IsActive_0cba4ac7,
  @ID = @ID_0cba4ac7;

-- Save Template Contents (core SP call only)
DECLARE @TemplateID_99ae84d0 UNIQUEIDENTIFIER,
@TypeID_99ae84d0 UNIQUEIDENTIFIER,
@TemplateText_99ae84d0 NVARCHAR(MAX),
@Priority_99ae84d0 INT,
@IsActive_99ae84d0 BIT,
@ID_99ae84d0 UNIQUEIDENTIFIER
SET
  @TemplateID_99ae84d0 = '6C644A1D-01A7-43E9-B8C9-63636388A937'
SET
  @TypeID_99ae84d0 = 'E7AFCCEC-6A37-EF11-86D4-000D3A4E707E'
SET
  @TemplateText_99ae84d0 = N'# Purpose
You are the world''s greatest expert in Microsoft SQL Server and T-SQL. Your job is to write tight, reusable SQL query templates that solve business questions using the provided entity information.

# Business Question
**User Question**: {{ userQuestion | safe }}
**Description**: {{ description | safe }}
**Technical Description**: {{ technicalDescription | safe }}

{% if validationFeedback %}
# ⚠️ CRITICAL: Previous Attempt Failed Validation
{{ validationFeedback | safe }}

**Please carefully correct the issue mentioned above before generating your response.**
{% endif %}

# Available Entities
The following entities are available for your query. Key rules:
- Always prefix view names with schema names as shown: `[SchemaName].[ViewName]`
- Use T-SQL syntax for SQL Server
- Query from base views (vw*), not base tables
- **CRITICAL**: Only use entities and fields explicitly listed below - DO NOT infer or guess schema
- **VIRTUAL fields** are computed/lookup fields available in the view - use these instead of JOINs when possible

{% for entity in entityMetadata %}
## {{ entity.entityName }}
**Schema.View**: `[{{ entity.schemaName }}].[{{ entity.baseView }}]`
{% if entity.description %}- **Description**: {{ entity.description | safe }}{% endif %}

**Available Fields**:
{% for field in entity.fields %}
- `{{ field.name }}` ({{ field.sqlFullType }}){% if field.description %} - {{ field.description | safe }}{% endif %}{% if field.isPrimaryKey %} [PRIMARY KEY]{% endif %}{% if field.isForeignKey %} [FK to {{ field.relatedEntity }}]{% endif %}{% if field.isVirtual %} [VIRTUAL - computed field]{% endif %}{% if field.allowsNull %} [NULLABLE]{% else %} [NOT NULL]{% endif %}{% if field.defaultValue %} [DEFAULT: {{ field.defaultValue }}]{% endif %}{% if field.possibleValues %} [VALUES: {{ field.possibleValues | join('', '') }}]{% endif %}
{% endfor %}

{% if entity.relationships.length > 0 %}
**Join Information**:
{% for rel in entity.relationships %}
- To `{{ rel.relatedEntity }}`: `{{ rel.description | safe }}`
{% endfor %}
{% endif %}

---
{% endfor %}


# Example Queries (Similar Patterns)
{% for example in fewShotExamples %}
## Example {{ loop.index }}: {{ example.name }}
**Question**: {{ example.userQuestion }}
**Description**: {{ example.description }}

**SQL Template**:
```sql
{{ example.sql | safe }}
```

**Parameters**:
{% if example.parameters.length > 0 %}
{% for param in example.parameters %}
- `{{ param.name }}` ({{ param.type }}){% if param.isRequired %} [REQUIRED]{% endif %} - {{ param.description }}
  - Sample Value: `{{ param.sampleValue }}`
{% endfor %}
{% else %}
No parameters
{% endif %}

**Output Fields**:
{% for field in example.selectClause %}
- `{{ field.name }}` ({{ field.type }}) - {{ field.description }}
{% endfor %}

---
{% endfor %}

# Query Parameterization - Think Like a Programmer

When designing queries, **always consider reusability**. Ask yourself: "If I make this filter value a parameter, could this query be useful in other scenarios?"

## When to Parameterize

**DO parameterize when:**
- The value is a filter condition (state, date range, status, category, threshold)
- The query logic is general-purpose (lists, summaries, reports)
- Similar queries might be needed with different values
- Example: "Members in California" → Create `State` parameter with default value `"CA"`

**DON''T parameterize when:**
- The query embodies specific business logic that shouldn''t vary
- The hardcoded value is part of the business rule definition
- Parameterizing would make the query confusing or overly complex
- Example: "Premium Tier Members (>$10k annual revenue)" → Specific business segment

## Parameter Best Practices

1. **Default Values**: Provide sensible defaults matching the original request
2. **Descriptive Names**: Use clear parameter names (e.g., `State`, `MinRevenue`, `StartDate`)
3. **Documentation**: Include clear descriptions explaining purpose and format
4. **Sample Values**: Provide realistic sample values for testing
5. **Optional Filters**: Use conditional blocks for optional parameters

## Nunjucks Parameter Syntax

Our system uses Nunjucks templating for safe parameterization. Available filters:

- `sqlString` - Safely escapes string values
- `sqlNumber` - Validates and formats numeric values
- `sqlDate` - Formats date/datetime values
- `sqlIn` - Handles arrays for IN clauses

### Parameter Examples:
```sql
-- String parameter
WHERE Country = {% raw %}{{ Country | sqlString }}{% endraw %}

-- Numeric parameter
WHERE Revenue >= {% raw %}{{ MinRevenue | sqlNumber }}{% endraw %}

-- Date parameter
WHERE OrderDate >= {% raw %}{{ StartDate | sqlDate }}{% endraw %}

-- Array parameter for IN clause
WHERE Status IN {% raw %}{{ StatusList | sqlIn }}{% endraw %}

-- Optional conditional parameter
{% raw %}{% if MinJoinDate %}{% endraw %}
AND JoinDate >= {% raw %}{{ MinJoinDate | sqlDate }}{% endraw %}
{% raw %}{% endif %}{% endraw %}
```

# Ground Rules
- Use any valid **read** operations including CTEs (Common Table Expressions)
- **NO** INSERT/UPDATE/DELETE operations
- **NO** stored procedure calls
- **NO** multiple statement batches
- **NO** local variables like `@VariableName` (breaks execution context)
- Result must be a single resultset
- Wrap reserved keywords in brackets: `[RowCount]`, `[User]`, `[Order]`

# SQL Best Practices

# Simplicity and Reusability Principles

**CRITICAL**: These queries will be stored in a library and reused across many business questions and scenarios. Balance simplicity with encoding valuable business logic that can be reused.

## Core Philosophy

Return **raw data** and **simple aggregations** for presentation concerns, BUT **do encode business logic** that defines meaningful business concepts. The goal is to create a reusable query layer that encapsulates domain knowledge.

### Let the UI/Reporting Layer Handle:
- Percentage calculations and ratios
- Formatting (dates, numbers, strings)
- Dynamic display thresholds
- Localization and accessibility

### Encode in the Query (Business Logic):
- Business concept definitions (e.g., "Current Member", "Active Subscription")
- Domain-specific rules and validations
- Multi-table business logic (e.g., checking membership + subscription status)
- Complex categorizations that represent business understanding
- Calculations that define business metrics (e.g., lifetime value, tenure)

## Good Query Characteristics ✅

- Returns raw data columns (names, dates, counts, statuses, amounts)
- Uses simple aggregations (COUNT, SUM, AVG, MIN, MAX)
- Minimal CASE statements (only for essential categorization)
- Uses parameters for filtering (dates, statuses, thresholds, limits)
- Can answer multiple related business questions with different parameters
- Leaves complex calculations to the UI/reporting layer

## Bad Query Characteristics ❌

- Calculates complex derived metrics (retention rates, percentage calculations, ratios)
- Uses nested CASE statements for business rules
- Includes formatting logic (CAST to specific DECIMAL precision, string concatenation)
- Hyper-specific to one exact question with no flexibility
- Assumes domain knowledge without verification (e.g., what "renewed" or "active" means)
- Performs calculations that should be done in the presentation layer

## Practical Examples

### Example 1: Renewal Rate Query

❌ **Bad Approach** (Too Complex):
```sql
CAST(
  CASE WHEN COUNT(*) = 0 THEN 0
  ELSE (CAST(SUM(CASE WHEN RenewalDate IS NOT NULL THEN 1 ELSE 0
END) AS FLOAT)
        / COUNT(*)) * 100
END
AS DECIMAL(5,2)) AS RenewalRatePercentage
```

✅ **Good Approach** (Simple & Reusable):
```sql
COUNT(*) AS TotalMemberships,
SUM(CASE WHEN RenewalDate IS NOT NULL THEN 1 ELSE 0
END) AS RenewedCount
-- UI calculates: (RenewedCount / TotalMemberships) * 100
```

**Why Good?** The UI can format percentages with any precision, localize the display, and even show different metrics (rate vs absolute numbers) based on user preference.

---

### Example 2: Customer Categorization

❌ **Bad Approach** (Hardcoded Business Rules):
```sql
CASE
  WHEN TotalRevenue > 10000 THEN ''Premium''
  WHEN TotalRevenue > 5000 THEN ''Standard''
  ELSE ''Basic''
END AS CustomerTier
```

✅ **Good Approach** (Raw Data):
```sql
TotalRevenue
-- UI applies dynamic tier thresholds based on:
-- - User-configurable rules
-- - Industry standards
-- - Real-time data distribution
```

**Why Good?** Business rules change. Tier thresholds that make sense today might not tomorrow. Raw revenue lets the UI apply current business logic.

---

### Example 3: Date Filtering

❌ **Bad Approach** (Hardcoded Logic):
```sql
WHERE OrderDate >= DATEADD(day, -90, GETDATE())
```

✅ **Good Approach** (Parameterized):
```sql
WHERE OrderDate >= {% raw %}{{ startDate | sqlDate }}{% endraw %}
  AND OrderDate < {% raw %}{{ endDate | sqlDate }}{% endraw %}
```

**Why Good?** Users can analyze any time period (last week, last quarter, fiscal year, custom range) without needing a new query for each scenario.

---

## Trust the UI Layer

Modern UI/reporting layers (like Skip-Brain) excel at:
- **Calculations**: JavaScript is faster than SQL for post-aggregation math
- **Formatting**: Apply user locale, preferences, and accessibility needs
- **Dynamic Logic**: Change business rules without touching the database
- **Interactivity**: Let users toggle between different views of the same data

The query''s job is to **fetch the right data efficiently**, not to format it perfectly.


## Additional Writing Guidance

**When generating queries:**
- Focus on answering the question with the simplest approach
- Return raw counts and aggregations, not percentages or ratios
- Don''t assume domain logic (e.g., what makes something "active" or "renewed")
- Over-engineer with CTEs only when genuinely needed for clarity
- **Use VIRTUAL fields instead of JOINs** - if a field is marked [VIRTUAL], it''s already available in the view
- **Never infer or guess schema** - only query entities/fields explicitly provided in the metadata

## Technical Best Practices
1. **Use Only Available Metadata**: Query ONLY from entities and fields explicitly listed in the metadata above. Do NOT infer, guess, or assume additional tables/views exist.
2. **Prefer VIRTUAL Fields Over JOINs**: If a field is marked `[VIRTUAL - computed field]`, SELECT it directly instead of joining to another table. VIRTUAL fields are already computed for you.
3. **Use Base Views**: Query from `vw*` views with schema prefix: `[SchemaName].[vwEntityName]`
4. **Short Aliases**: Use meaningful short aliases (e.g., `m` for members, `o` for orders)
5. **Handle NULLs**: Use COALESCE or ISNULL for aggregations
6. **Prefer LEFT JOIN**: Avoid losing rows unless INNER JOIN is specifically needed
7. **Add Comments**: Document complex logic with SQL comments
8. **Parameterize Wisely**: Make queries reusable by parameterizing filter values, but don''t over-engineer
9. **Think About Date Logic**: For "active as of date" queries, consider if records need date range overlap checks (StartDate <= Date AND EndDate >= Date), not just StartDate filtering

# Response Format

**CRITICAL INSTRUCTIONS:**
- I am a computer and can **only** read JSON responses
- Your response **must** be pure JSON that starts with `{` and ends with `}`
- **NO leading or trailing text** - no explanations, no markdown code blocks, no commentary
- **NO markdown formatting** like \`\`\`json - just the raw JSON

Your response must match this exact structure:

```
{
  "queryName": "Active Members By Organization",
  "sql": "Complete SQL query template with Nunjucks parameter syntax",
  "parameters": [
    {
      "name": "ParameterName",
      "type": "string | number | date | boolean | array",
      "isRequired": true,
      "description": "Clear description of parameter purpose and expected format",
      "usage": ["WHERE clause filter on Country field"],
      "defaultValue": null,
      "sampleValue": "USA"
    }
  ]
}
```

## Field Definitions

**queryName** (string): Short, descriptive name for this query (3-6 words in title case)
- Focuses on the **result** or **purpose** (not the method)
- Example good names: "Active Members By Organization", "Certifications Expiring Soon", "Most Certified Members"
- Example bad names: "Which Members Have The Most" (truncated), "Query For Getting Data" (generic)

**sql** (string): Complete T-SQL query using Nunjucks syntax for parameters

**parameters** (array): Input parameters for the query (empty array if no parameters needed)
- `name`: Parameter name in camelCase
- `type`: Must be one of: "string", "number", "date", "boolean", "array"
- `isRequired`:
  - `true` if used without conditional guard (e.g., `WHERE State = {% raw %}{{ State | sqlString }}{% endraw %}`)
  - `false` if wrapped in conditional block (e.g., `{% raw %}{% if MinDate %}{% endraw %}AND Date >= {% raw %}{{ MinDate | sqlDate }}{% endraw %}{% raw %}{% endif %}{% endraw %}`)
- `description`: Clear explanation of parameter purpose
- `usage`: Array of strings describing where/how parameter is used in query
- `defaultValue`: Default value if not provided (can be null)
- `sampleValue`: Realistic test value matching the parameter type:
  - `string`: Plain string (e.g., `"CA"`, `"Active"`)
  - `number`: Number without quotes (e.g., `50`, `1000`)
  - `date`: ISO date string (e.g., `"2024-01-01"`)
  - `boolean`: `true` or `false` (no quotes)
  - `array`: JSON array (e.g., `["USA", "Canada"]`, `[1, 2, 3]`) - NOT comma-separated string
'
SET
  @Priority_99ae84d0 = 1
SET
  @IsActive_99ae84d0 = 1
SET
  @ID_99ae84d0 = '6A20633B-9F47-4E7E-BEEA-A77E7C6539C3'
EXEC [${flyway:defaultSchema}].spUpdateTemplateContent @TemplateID = @TemplateID_99ae84d0,
  @TypeID = @TypeID_99ae84d0,
  @TemplateText = @TemplateText_99ae84d0,
  @Priority = @Priority_99ae84d0,
  @IsActive = @IsActive_99ae84d0,
  @ID = @ID_99ae84d0;

-- Save Template Contents (core SP call only)
DECLARE @TemplateID_bd438a5c UNIQUEIDENTIFIER,
@TypeID_bd438a5c UNIQUEIDENTIFIER,
@TemplateText_bd438a5c NVARCHAR(MAX),
@Priority_bd438a5c INT,
@IsActive_bd438a5c BIT,
@ID_bd438a5c UNIQUEIDENTIFIER
SET
  @TemplateID_bd438a5c = '177D2C33-865C-47DA-A134-46019C759A42'
SET
  @TypeID_bd438a5c = 'E7AFCCEC-6A37-EF11-86D4-000D3A4E707E'
SET
  @TemplateText_bd438a5c = N'# Query Refiner

You are an expert SQL developer refining a query based on evaluation feedback.

## Original Business Question

**User Question**: {{ userQuestion | safe }}
**Description**: {{ description | safe }}

## Current Query

```sql
{{ currentSQL | safe }}
```

## Evaluation Feedback

**Answers Question**: {% if evaluationFeedback.answersQuestion %}✅ Yes{% else %}❌ No{% endif %}
**Confidence**: {{ evaluationFeedback.confidence * 100 }}%
**Needs Refinement**: {% if evaluationFeedback.needsRefinement %}Yes{% else %}No{% endif %}

**Reasoning**: {{ evaluationFeedback.reasoning | safe }}

{% if evaluationFeedback.suggestions.length > 0 %}
**Suggestions for Improvement**:
{% for suggestion in evaluationFeedback.suggestions %}
{{ loop.index }}. {{ suggestion | safe }}
{% endfor %}
{% endif %}

# Available Entities
The following entities are available for your query. Key rules:
- Always prefix view names with schema names as shown: `[SchemaName].[ViewName]`
- Use T-SQL syntax for SQL Server
- Query from base views (vw*), not base tables
- **CRITICAL**: Only use entities and fields explicitly listed below - DO NOT infer or guess schema
- **VIRTUAL fields** are computed/lookup fields available in the view - use these instead of JOINs when possible

{% for entity in entityMetadata %}
## {{ entity.entityName }}
**Schema.View**: `[{{ entity.schemaName }}].[{{ entity.baseView }}]`
{% if entity.description %}- **Description**: {{ entity.description | safe }}{% endif %}

**Available Fields**:
{% for field in entity.fields %}
- `{{ field.name }}` ({{ field.sqlFullType }}){% if field.description %} - {{ field.description | safe }}{% endif %}{% if field.isPrimaryKey %} [PRIMARY KEY]{% endif %}{% if field.isForeignKey %} [FK to {{ field.relatedEntity }}]{% endif %}{% if field.isVirtual %} [VIRTUAL - computed field]{% endif %}{% if field.allowsNull %} [NULLABLE]{% else %} [NOT NULL]{% endif %}{% if field.defaultValue %} [DEFAULT: {{ field.defaultValue }}]{% endif %}{% if field.possibleValues %} [VALUES: {{ field.possibleValues | join('', '') }}]{% endif %}
{% endfor %}

{% if entity.relationships.length > 0 %}
**Join Information**:
{% for rel in entity.relationships %}
- To `{{ rel.relatedEntity }}`: `{{ rel.description | safe }}`
{% endfor %}
{% endif %}

---
{% endfor %}


# Simplicity and Reusability Principles

**CRITICAL**: These queries will be stored in a library and reused across many business questions and scenarios. Balance simplicity with encoding valuable business logic that can be reused.

## Core Philosophy

Return **raw data** and **simple aggregations** for presentation concerns, BUT **do encode business logic** that defines meaningful business concepts. The goal is to create a reusable query layer that encapsulates domain knowledge.

### Let the UI/Reporting Layer Handle:
- Percentage calculations and ratios
- Formatting (dates, numbers, strings)
- Dynamic display thresholds
- Localization and accessibility

### Encode in the Query (Business Logic):
- Business concept definitions (e.g., "Current Member", "Active Subscription")
- Domain-specific rules and validations
- Multi-table business logic (e.g., checking membership + subscription status)
- Complex categorizations that represent business understanding
- Calculations that define business metrics (e.g., lifetime value, tenure)

## Good Query Characteristics ✅

- Returns raw data columns (names, dates, counts, statuses, amounts)
- Uses simple aggregations (COUNT, SUM, AVG, MIN, MAX)
- Minimal CASE statements (only for essential categorization)
- Uses parameters for filtering (dates, statuses, thresholds, limits)
- Can answer multiple related business questions with different parameters
- Leaves complex calculations to the UI/reporting layer

## Bad Query Characteristics ❌

- Calculates complex derived metrics (retention rates, percentage calculations, ratios)
- Uses nested CASE statements for business rules
- Includes formatting logic (CAST to specific DECIMAL precision, string concatenation)
- Hyper-specific to one exact question with no flexibility
- Assumes domain knowledge without verification (e.g., what "renewed" or "active" means)
- Performs calculations that should be done in the presentation layer

## Practical Examples

### Example 1: Renewal Rate Query

❌ **Bad Approach** (Too Complex):
```sql
CAST(
  CASE WHEN COUNT(*) = 0 THEN 0
  ELSE (CAST(SUM(CASE WHEN RenewalDate IS NOT NULL THEN 1 ELSE 0
END) AS FLOAT)
        / COUNT(*)) * 100
END
AS DECIMAL(5,2)) AS RenewalRatePercentage
```

✅ **Good Approach** (Simple & Reusable):
```sql
COUNT(*) AS TotalMemberships,
SUM(CASE WHEN RenewalDate IS NOT NULL THEN 1 ELSE 0
END) AS RenewedCount
-- UI calculates: (RenewedCount / TotalMemberships) * 100
```

**Why Good?** The UI can format percentages with any precision, localize the display, and even show different metrics (rate vs absolute numbers) based on user preference.

---

### Example 2: Customer Categorization

❌ **Bad Approach** (Hardcoded Business Rules):
```sql
CASE
  WHEN TotalRevenue > 10000 THEN ''Premium''
  WHEN TotalRevenue > 5000 THEN ''Standard''
  ELSE ''Basic''
END AS CustomerTier
```

✅ **Good Approach** (Raw Data):
```sql
TotalRevenue
-- UI applies dynamic tier thresholds based on:
-- - User-configurable rules
-- - Industry standards
-- - Real-time data distribution
```

**Why Good?** Business rules change. Tier thresholds that make sense today might not tomorrow. Raw revenue lets the UI apply current business logic.

---

### Example 3: Date Filtering

❌ **Bad Approach** (Hardcoded Logic):
```sql
WHERE OrderDate >= DATEADD(day, -90, GETDATE())
```

✅ **Good Approach** (Parameterized):
```sql
WHERE OrderDate >= {% raw %}{{ startDate | sqlDate }}{% endraw %}
  AND OrderDate < {% raw %}{{ endDate | sqlDate }}{% endraw %}
```

**Why Good?** Users can analyze any time period (last week, last quarter, fiscal year, custom range) without needing a new query for each scenario.

---

## Trust the UI Layer

Modern UI/reporting layers (like Skip-Brain) excel at:
- **Calculations**: JavaScript is faster than SQL for post-aggregation math
- **Formatting**: Apply user locale, preferences, and accessibility needs
- **Dynamic Logic**: Change business rules without touching the database
- **Interactivity**: Let users toggle between different views of the same data

The query''s job is to **fetch the right data efficiently**, not to format it perfectly.


## Refinement-Specific Guidance

**When refining queries:**
- Resist the urge to add complexity, even if evaluation feedback suggests it
- If evaluation requests complex calculations, simplify instead - return raw components
- Fix structural issues (JOINs, syntax errors, missing parameters)
- Don''t add formatting logic or nested business rules

**Understanding VIRTUAL Fields:**
- Entities may have VIRTUAL fields (marked `[VIRTUAL - computed field]`)
- These are available directly in SELECT statements without JOINs
- If evaluator says a field "doesn''t exist", check if it''s a VIRTUAL field first
- Example: Use `m.MembershipType` directly instead of joining to vwMembershipTypes

**Don''t "Fix" Valid Queries:**
- If evaluation only mentions "no results" or "empty data", **DO NOT change the query**
- Empty results = data issue, not query issue
- Only refine if there''s an actual SQL error or logical flaw
- Changing filters to "get data" often makes queries less accurate

**If Evaluation Feedback Requests Complexity:**
1. **Simplify Instead**: Return the raw components needed for UI calculations
2. **Add Parameters**: Make filtering flexible, not hardcoded
3. **Trust the UI**: Let the presentation layer handle formatting and calculations
4. **Preserve Reusability**: A simpler query helps more scenarios

## Refinement Task

Refine the query to address the evaluation feedback:

1. **Address Concerns**: Fix issues raised in the evaluation reasoning
2. **Simplify Complexity**: If current query is too complex, simplify it
3. **Implement Simple Improvements**: Add parameters, fix JOINs, correct errors
4. **Maintain Correctness**: Keep query logic sound and performant
5. **Preserve Parameters**: Update parameters only if needed for improvements

## Requirements

1. **Use Base Views**: Query from `vw*` views, not base tables
2. **Maintain Nunjucks Syntax**: Parameters use `{{ ''{{'' }} paramName | sqlFilter {{ ''}}'' }}` syntax
3. **Apply SQL Filters**: Use appropriate filters (sqlString, sqlNumber, sqlDate, sqlIn)
4. **Valid SQL Server**: Ensure query works on SQL Server
5. **Preserve Intent**: Keep the original question''s purpose

## Output Format

Return JSON with three properties:

Example JSON structure:
```
{
  "queryName": "High Revenue Customers With Contact Details",
  "sql": "SELECT ... FROM ... WHERE ...",
  "parameters": [
    {
      "name": "minRevenue",
      "type": "number",
      "isRequired": true,
      "description": "Minimum revenue threshold",
      "usage": ["WHERE clause: Revenue >= {{ ''{{'' }} minRevenue | sqlNumber {{ ''}}'' }}"],
      "defaultValue": null,
      "sampleValue": 10000
    }
  ],
  "improvementsSummary": "Added customer contact columns (Email, Phone) and date range filter (startDate, endDate) as suggested to improve usability and query flexibility"
}
```

### Field Definitions:

**queryName** (string): Short, descriptive name for this query (3-6 words in title case)
- If the query purpose changed during refinement, update the name accordingly
- Otherwise, keep the original name if it''s still accurate
- Example good names: "Active Members By Organization", "Certifications Expiring Soon"
- Example bad names: "Which Members Have The Most" (truncated), "Query For Getting Data" (generic)

**sql** (string): The refined SQL query template using Nunjucks syntax

**parameters** (array): Updated input parameters (add/modify/remove as needed)

**improvementsSummary** (string): Brief description of refinements made

## Important Notes

- Make targeted improvements based on feedback
- Don''t over-engineer - focus on the suggestions
- Preserve working parts of the query
- If adding fields, ensure they come from available entity metadata
- If adding parameters, provide complete metadata including sample values
- Keep the query focused on answering the user''s question

## Response Format

**CRITICAL INSTRUCTIONS:**
- I am a computer and can **only** read JSON responses
- Your response **must** be pure JSON that starts with `{` and ends with `}`
- **NO leading or trailing text** - no explanations, no markdown code blocks, no commentary
- **NO markdown formatting** like \`\`\`json - just the raw JSON
- Your response **must** match the exact structure shown in the "Output Format" section above
'
SET
  @Priority_bd438a5c = 1
SET
  @IsActive_bd438a5c = 1
SET
  @ID_bd438a5c = '25319F0F-4432-4F61-819A-666608A23A91'
EXEC [${flyway:defaultSchema}].spUpdateTemplateContent @TemplateID = @TemplateID_bd438a5c,
  @TypeID = @TypeID_bd438a5c,
  @TemplateText = @TemplateText_bd438a5c,
  @Priority = @Priority_bd438a5c,
  @IsActive = @IsActive_bd438a5c,
  @ID = @ID_bd438a5c;

-- Save Template Contents (core SP call only)
DECLARE @TemplateID_0b238128 UNIQUEIDENTIFIER,
@TypeID_0b238128 UNIQUEIDENTIFIER,
@TemplateText_0b238128 NVARCHAR(MAX),
@Priority_0b238128 INT,
@IsActive_0b238128 BIT,
@ID_0b238128 UNIQUEIDENTIFIER
SET
  @TemplateID_0b238128 = '311AB35A-F04C-4B92-B917-89E23D534A4E'
SET
  @TypeID_0b238128 = 'E7AFCCEC-6A37-EF11-86D4-000D3A4E707E'
SET
  @TemplateText_0b238128 = N'# Entity Group Generator

You are a database analyst helping to identify meaningful entity groupings for business intelligence query generation.

## Task

Given a database schema, identify logical entity groups that make sense for business questions. Each group should represent a coherent business concept or process that users would naturally ask questions about.

## Input Schema

**Schema Name**: {{ schemaName }}

**Entities** ({{ entities.length }} total):

{% for entity in entities %}
### {{ entity.Name }}
- **Description**: {{ entity.Description or ''No description'' }}
- **Schema**: {{ entity.SchemaName }}
- **Fields**: {{ entity.FieldCount }} fields
- **Related Entities**:
  {% for rel in entity.RelatedEntities %}
  - {{ rel.name }} ({{ rel.type }})
  {% endfor %}
{% endfor %}

## Relationship Graph

```
{{ relationshipGraph }}
```

## Guidelines

1. **Business Relevance**: Focus on entity combinations that support real business questions
   - ✅ GOOD: "Customers + Orders" (customer purchasing behavior)
   - ✅ GOOD: "Events + Event Registrations" (event attendance analysis)
   - ❌ BAD: "SystemLogs + UserPreferences + EmailTemplates" (unrelated entities)

2. **Relationship Types**:
   - **Parent-Child**: Natural hierarchies (Customer → Orders, Event → Registrations)
   - **Many-to-Many**: Bridge tables connecting concepts (Products ↔ Categories via ProductCategories)
   - **Transactional Flow**: Process chains (Lead → Opportunity → Quote → Order)

3. **Size Constraints**:
   - Groups must have **{{ minGroupSize }} to {{ maxGroupSize }} entities** (keep groups small and focused)
   - Entities can appear in multiple groups if they fit different business contexts
   - **Do NOT create single-entity groups** - those will be generated separately

4. **Coverage Goal**:
   - Schema has **{{ entities.length }} entities** with an average of **{{ avgDegree }}** relationships per entity
   {% if hubCount > 0 %}
   - Contains **{{ hubCount }} hub entities** with >5 relationships (largest hub: {{ maxHubDegree }} relationships)
   - Hub entities are especially valuable - create multiple groups pairing hubs with different related entities
   {% endif %}
   - Aim for **{{ targetGroupCount }}-{{ targetGroupCount + 5 }}** groups as a rough guideline
   - Focus on business-meaningful combinations - not all possible relationship pairs make sense

5. **Connectivity**: All entities in a group must be connected by foreign key relationships

6. **Quality Over Quantity**: Prioritize groups that support real business questions over achieving full entity coverage

7. **Business Domains**: Common domains include:
   - Sales & Revenue (customers, orders, payments)
   - Inventory & Products (products, categories, suppliers, stock)
   - Marketing (campaigns, leads, conversions)
   - Operations (shipments, fulfillment, logistics)
   - Finance (invoices, payments, accounts)
   - Human Resources (employees, departments, roles)
   - Customer Service (tickets, cases, support)

## Output Format

Return a JSON array of entity groups. Each group MUST include:

```json
{
  "groups": [
    {
      "entities": ["EntityName1", "EntityName2", "EntityName3"],
      "primaryEntity": "EntityName1",
      "businessDomain": "Sales Pipeline Analysis",
      "businessRationale": "Tracks customer journey from lead to closed sale, essential for sales forecasting and conversion analysis",
      "relationshipType": "parent-child",
      "expectedQuestionTypes": ["trend_analysis", "funnel_analysis", "conversion_rates"]
    }
  ]
}
```

**Important**:
- `entities`: Array of exact entity names from the schema (must match exactly)
- `primaryEntity`: The "hub" or most important entity in the group
- `businessDomain`: Clear business domain label (2-5 words)
- `businessRationale`: One sentence explaining why this grouping matters
- `relationshipType`: One of: "parent-child", "many-to-many"
- `expectedQuestionTypes`: Array of question types this group supports

## Example Output

```json
{
  "groups": [
    {
      "entities": ["Customers", "Orders"],
      "primaryEntity": "Customers",
      "businessDomain": "Customer Purchasing Behavior",
      "businessRationale": "Links customers to their purchase history for lifetime value and repeat purchase analysis",
      "relationshipType": "parent-child",
      "expectedQuestionTypes": ["lifetime_value", "repeat_purchase", "customer_retention"]
    },
    {
      "entities": ["Orders", "OrderDetails"],
      "primaryEntity": "Orders",
      "businessDomain": "Order Analysis",
      "businessRationale": "Connects orders with their line items for product mix and basket analysis",
      "relationshipType": "parent-child",
      "expectedQuestionTypes": ["basket_analysis", "product_mix", "order_value"]
    },
    {
      "entities": ["Products", "Categories"],
      "primaryEntity": "Products",
      "businessDomain": "Product Catalog",
      "businessRationale": "Links products to categories for inventory and catalog organization analysis",
      "relationshipType": "parent-child",
      "expectedQuestionTypes": ["product_mix", "category_performance", "inventory_levels"]
    }
  ]
}
```

## Response Format

**CRITICAL INSTRUCTIONS:**
- I am a computer and can **only** read JSON responses
- Your response **must** be pure JSON that starts with `{` and ends with `}`
- **NO leading or trailing text** - no explanations, no markdown code blocks, no commentary
- **NO markdown formatting** like \`\`\`json - just the raw JSON
- Your response **must** match the exact structure shown in the "Output Format" section above

Generate entity groups now as pure JSON only.
'
SET
  @Priority_0b238128 = 1
SET
  @IsActive_0b238128 = 1
SET
  @ID_0b238128 = 'FA8EEBE5-F6BB-4E9E-963A-6745DF50CCD7'
EXEC [${flyway:defaultSchema}].spUpdateTemplateContent @TemplateID = @TemplateID_0b238128,
  @TypeID = @TypeID_0b238128,
  @TemplateText = @TemplateText_0b238128,
  @Priority = @Priority_0b238128,
  @IsActive = @IsActive_0b238128,
  @ID = @ID_0b238128;

-- Save Template Params (core SP call only)
DECLARE @TemplateID_54bf483d UNIQUEIDENTIFIER,
@Name_54bf483d NVARCHAR(255),
@Description_54bf483d NVARCHAR(MAX),
@Type_54bf483d NVARCHAR(20),
@DefaultValue_54bf483d NVARCHAR(MAX),
@IsRequired_54bf483d BIT,
@LinkedParameterName_54bf483d NVARCHAR(255),
@LinkedParameterField_54bf483d NVARCHAR(500),
@ExtraFilter_54bf483d NVARCHAR(MAX),
@EntityID_54bf483d UNIQUEIDENTIFIER,
@RecordID_54bf483d NVARCHAR(2000),
@OrderBy_54bf483d NVARCHAR(MAX),
@TemplateContentID_54bf483d UNIQUEIDENTIFIER,
@ID_54bf483d UNIQUEIDENTIFIER
SET
  @TemplateID_54bf483d = 'B28D9C1B-A5DF-45C3-97D0-FC483381FF60'
SET
  @Name_54bf483d = N'entityGroupMetadata'
SET
  @Description_54bf483d = N'List of entity metadata objects containing schema, view, fields, and relationships'
SET
  @Type_54bf483d = N'Array'
SET
  @IsRequired_54bf483d = 0
SET
  @ID_54bf483d = '404556BD-86A4-49D4-9FC2-AC26F67D3772'
EXEC [${flyway:defaultSchema}].spUpdateTemplateParam @TemplateID = @TemplateID_54bf483d,
  @Name = @Name_54bf483d,
  @Description = @Description_54bf483d,
  @Type = @Type_54bf483d,
  @DefaultValue = @DefaultValue_54bf483d,
  @IsRequired = @IsRequired_54bf483d,
  @LinkedParameterName = @LinkedParameterName_54bf483d,
  @LinkedParameterField = @LinkedParameterField_54bf483d,
  @ExtraFilter = @ExtraFilter_54bf483d,
  @EntityID = @EntityID_54bf483d,
  @RecordID = @RecordID_54bf483d,
  @OrderBy = @OrderBy_54bf483d,
  @TemplateContentID = @TemplateContentID_54bf483d,
  @ID = @ID_54bf483d;

-- Save Template Params (core SP call only)
DECLARE @TemplateID_f8122373 UNIQUEIDENTIFIER,
@Name_f8122373 NVARCHAR(255),
@Description_f8122373 NVARCHAR(MAX),
@Type_f8122373 NVARCHAR(20),
@DefaultValue_f8122373 NVARCHAR(MAX),
@IsRequired_f8122373 BIT,
@LinkedParameterName_f8122373 NVARCHAR(255),
@LinkedParameterField_f8122373 NVARCHAR(500),
@ExtraFilter_f8122373 NVARCHAR(MAX),
@EntityID_f8122373 UNIQUEIDENTIFIER,
@RecordID_f8122373 NVARCHAR(2000),
@OrderBy_f8122373 NVARCHAR(MAX),
@TemplateContentID_f8122373 UNIQUEIDENTIFIER,
@ID_f8122373 UNIQUEIDENTIFIER
SET
  @TemplateID_f8122373 = '6C644A1D-01A7-43E9-B8C9-63636388A937'
SET
  @Name_f8122373 = N'description'
SET
  @Description_f8122373 = N'Description of the business question'
SET
  @Type_f8122373 = N'Scalar'
SET
  @IsRequired_f8122373 = 0
SET
  @ID_f8122373 = '42C2C960-36EE-4664-9C8B-1AB1ACD1ECE2'
EXEC [${flyway:defaultSchema}].spUpdateTemplateParam @TemplateID = @TemplateID_f8122373,
  @Name = @Name_f8122373,
  @Description = @Description_f8122373,
  @Type = @Type_f8122373,
  @DefaultValue = @DefaultValue_f8122373,
  @IsRequired = @IsRequired_f8122373,
  @LinkedParameterName = @LinkedParameterName_f8122373,
  @LinkedParameterField = @LinkedParameterField_f8122373,
  @ExtraFilter = @ExtraFilter_f8122373,
  @EntityID = @EntityID_f8122373,
  @RecordID = @RecordID_f8122373,
  @OrderBy = @OrderBy_f8122373,
  @TemplateContentID = @TemplateContentID_f8122373,
  @ID = @ID_f8122373;

-- Save Template Params (core SP call only)
DECLARE @TemplateID_60175f90 UNIQUEIDENTIFIER,
@Name_60175f90 NVARCHAR(255),
@Description_60175f90 NVARCHAR(MAX),
@Type_60175f90 NVARCHAR(20),
@DefaultValue_60175f90 NVARCHAR(MAX),
@IsRequired_60175f90 BIT,
@LinkedParameterName_60175f90 NVARCHAR(255),
@LinkedParameterField_60175f90 NVARCHAR(500),
@ExtraFilter_60175f90 NVARCHAR(MAX),
@EntityID_60175f90 UNIQUEIDENTIFIER,
@RecordID_60175f90 NVARCHAR(2000),
@OrderBy_60175f90 NVARCHAR(MAX),
@TemplateContentID_60175f90 UNIQUEIDENTIFIER,
@ID_60175f90 UNIQUEIDENTIFIER
SET
  @TemplateID_60175f90 = '6C644A1D-01A7-43E9-B8C9-63636388A937'
SET
  @Name_60175f90 = N'validationFeedback'
SET
  @Description_60175f90 = N'Feedback about validation failures from previous attempts'
SET
  @Type_60175f90 = N'Scalar'
SET
  @IsRequired_60175f90 = 0
SET
  @ID_60175f90 = 'EB5EB4E7-21B2-4319-AD18-292859CF1EAC'
EXEC [${flyway:defaultSchema}].spUpdateTemplateParam @TemplateID = @TemplateID_60175f90,
  @Name = @Name_60175f90,
  @Description = @Description_60175f90,
  @Type = @Type_60175f90,
  @DefaultValue = @DefaultValue_60175f90,
  @IsRequired = @IsRequired_60175f90,
  @LinkedParameterName = @LinkedParameterName_60175f90,
  @LinkedParameterField = @LinkedParameterField_60175f90,
  @ExtraFilter = @ExtraFilter_60175f90,
  @EntityID = @EntityID_60175f90,
  @RecordID = @RecordID_60175f90,
  @OrderBy = @OrderBy_60175f90,
  @TemplateContentID = @TemplateContentID_60175f90,
  @ID = @ID_60175f90;

-- Save Template Params (core SP call only)
DECLARE @TemplateID_5ac6d011 UNIQUEIDENTIFIER,
@Name_5ac6d011 NVARCHAR(255),
@Description_5ac6d011 NVARCHAR(MAX),
@Type_5ac6d011 NVARCHAR(20),
@DefaultValue_5ac6d011 NVARCHAR(MAX),
@IsRequired_5ac6d011 BIT,
@LinkedParameterName_5ac6d011 NVARCHAR(255),
@LinkedParameterField_5ac6d011 NVARCHAR(500),
@ExtraFilter_5ac6d011 NVARCHAR(MAX),
@EntityID_5ac6d011 UNIQUEIDENTIFIER,
@RecordID_5ac6d011 NVARCHAR(2000),
@OrderBy_5ac6d011 NVARCHAR(MAX),
@TemplateContentID_5ac6d011 UNIQUEIDENTIFIER,
@ID_5ac6d011 UNIQUEIDENTIFIER
SET
  @TemplateID_5ac6d011 = '6C644A1D-01A7-43E9-B8C9-63636388A937'
SET
  @Name_5ac6d011 = N'fewShotExamples'
SET
  @Description_5ac6d011 = N'Array of example queries showing similar patterns'
SET
  @Type_5ac6d011 = N'Array'
SET
  @IsRequired_5ac6d011 = 0
SET
  @ID_5ac6d011 = '1E0373D6-A28D-45F6-AA29-82DD0EBAA645'
EXEC [${flyway:defaultSchema}].spUpdateTemplateParam @TemplateID = @TemplateID_5ac6d011,
  @Name = @Name_5ac6d011,
  @Description = @Description_5ac6d011,
  @Type = @Type_5ac6d011,
  @DefaultValue = @DefaultValue_5ac6d011,
  @IsRequired = @IsRequired_5ac6d011,
  @LinkedParameterName = @LinkedParameterName_5ac6d011,
  @LinkedParameterField = @LinkedParameterField_5ac6d011,
  @ExtraFilter = @ExtraFilter_5ac6d011,
  @EntityID = @EntityID_5ac6d011,
  @RecordID = @RecordID_5ac6d011,
  @OrderBy = @OrderBy_5ac6d011,
  @TemplateContentID = @TemplateContentID_5ac6d011,
  @ID = @ID_5ac6d011;

-- Save Template Params (core SP call only)
DECLARE @TemplateID_0d07b708 UNIQUEIDENTIFIER,
@Name_0d07b708 NVARCHAR(255),
@Description_0d07b708 NVARCHAR(MAX),
@Type_0d07b708 NVARCHAR(20),
@DefaultValue_0d07b708 NVARCHAR(MAX),
@IsRequired_0d07b708 BIT,
@LinkedParameterName_0d07b708 NVARCHAR(255),
@LinkedParameterField_0d07b708 NVARCHAR(500),
@ExtraFilter_0d07b708 NVARCHAR(MAX),
@EntityID_0d07b708 UNIQUEIDENTIFIER,
@RecordID_0d07b708 NVARCHAR(2000),
@OrderBy_0d07b708 NVARCHAR(MAX),
@TemplateContentID_0d07b708 UNIQUEIDENTIFIER,
@ID_0d07b708 UNIQUEIDENTIFIER
SET
  @TemplateID_0d07b708 = '6C644A1D-01A7-43E9-B8C9-63636388A937'
SET
  @Name_0d07b708 = N'userQuestion'
SET
  @Description_0d07b708 = N'The user''s business question being asked'
SET
  @Type_0d07b708 = N'Scalar'
SET
  @IsRequired_0d07b708 = 0
SET
  @ID_0d07b708 = '4ED516A7-E3E9-43BC-A58F-B458232762FE'
EXEC [${flyway:defaultSchema}].spUpdateTemplateParam @TemplateID = @TemplateID_0d07b708,
  @Name = @Name_0d07b708,
  @Description = @Description_0d07b708,
  @Type = @Type_0d07b708,
  @DefaultValue = @DefaultValue_0d07b708,
  @IsRequired = @IsRequired_0d07b708,
  @LinkedParameterName = @LinkedParameterName_0d07b708,
  @LinkedParameterField = @LinkedParameterField_0d07b708,
  @ExtraFilter = @ExtraFilter_0d07b708,
  @EntityID = @EntityID_0d07b708,
  @RecordID = @RecordID_0d07b708,
  @OrderBy = @OrderBy_0d07b708,
  @TemplateContentID = @TemplateContentID_0d07b708,
  @ID = @ID_0d07b708;

-- Save Template Params (core SP call only)
DECLARE @TemplateID_5e825efd UNIQUEIDENTIFIER,
@Name_5e825efd NVARCHAR(255),
@Description_5e825efd NVARCHAR(MAX),
@Type_5e825efd NVARCHAR(20),
@DefaultValue_5e825efd NVARCHAR(MAX),
@IsRequired_5e825efd BIT,
@LinkedParameterName_5e825efd NVARCHAR(255),
@LinkedParameterField_5e825efd NVARCHAR(500),
@ExtraFilter_5e825efd NVARCHAR(MAX),
@EntityID_5e825efd UNIQUEIDENTIFIER,
@RecordID_5e825efd NVARCHAR(2000),
@OrderBy_5e825efd NVARCHAR(MAX),
@TemplateContentID_5e825efd UNIQUEIDENTIFIER,
@ID_5e825efd UNIQUEIDENTIFIER
SET
  @TemplateID_5e825efd = '6C644A1D-01A7-43E9-B8C9-63636388A937'
SET
  @Name_5e825efd = N'entityMetadata'
SET
  @Description_5e825efd = N'Array of entity metadata objects containing schema and field information'
SET
  @Type_5e825efd = N'Array'
SET
  @IsRequired_5e825efd = 0
SET
  @ID_5e825efd = '9183EFBB-8DB2-4BD2-9C0F-E44000F4DFD1'
EXEC [${flyway:defaultSchema}].spUpdateTemplateParam @TemplateID = @TemplateID_5e825efd,
  @Name = @Name_5e825efd,
  @Description = @Description_5e825efd,
  @Type = @Type_5e825efd,
  @DefaultValue = @DefaultValue_5e825efd,
  @IsRequired = @IsRequired_5e825efd,
  @LinkedParameterName = @LinkedParameterName_5e825efd,
  @LinkedParameterField = @LinkedParameterField_5e825efd,
  @ExtraFilter = @ExtraFilter_5e825efd,
  @EntityID = @EntityID_5e825efd,
  @RecordID = @RecordID_5e825efd,
  @OrderBy = @OrderBy_5e825efd,
  @TemplateContentID = @TemplateContentID_5e825efd,
  @ID = @ID_5e825efd;

-- Save Template Params (core SP call only)
DECLARE @TemplateID_d36e964d UNIQUEIDENTIFIER,
@Name_d36e964d NVARCHAR(255),
@Description_d36e964d NVARCHAR(MAX),
@Type_d36e964d NVARCHAR(20),
@DefaultValue_d36e964d NVARCHAR(MAX),
@IsRequired_d36e964d BIT,
@LinkedParameterName_d36e964d NVARCHAR(255),
@LinkedParameterField_d36e964d NVARCHAR(500),
@ExtraFilter_d36e964d NVARCHAR(MAX),
@EntityID_d36e964d UNIQUEIDENTIFIER,
@RecordID_d36e964d NVARCHAR(2000),
@OrderBy_d36e964d NVARCHAR(MAX),
@TemplateContentID_d36e964d UNIQUEIDENTIFIER,
@ID_d36e964d UNIQUEIDENTIFIER
SET
  @TemplateID_d36e964d = '177D2C33-865C-47DA-A134-46019C759A42'
SET
  @Name_d36e964d = N'evaluationFeedback'
SET
  @Description_d36e964d = N'Object containing evaluation results including answersQuestion, confidence, needsRefinement, reasoning, and suggestions'
SET
  @Type_d36e964d = N'Object'
SET
  @IsRequired_d36e964d = 0
SET
  @ID_d36e964d = '0697D54D-2444-4E42-9294-183A63C41CC8'
EXEC [${flyway:defaultSchema}].spUpdateTemplateParam @TemplateID = @TemplateID_d36e964d,
  @Name = @Name_d36e964d,
  @Description = @Description_d36e964d,
  @Type = @Type_d36e964d,
  @DefaultValue = @DefaultValue_d36e964d,
  @IsRequired = @IsRequired_d36e964d,
  @LinkedParameterName = @LinkedParameterName_d36e964d,
  @LinkedParameterField = @LinkedParameterField_d36e964d,
  @ExtraFilter = @ExtraFilter_d36e964d,
  @EntityID = @EntityID_d36e964d,
  @RecordID = @RecordID_d36e964d,
  @OrderBy = @OrderBy_d36e964d,
  @TemplateContentID = @TemplateContentID_d36e964d,
  @ID = @ID_d36e964d;

-- Save Template Params (core SP call only)
DECLARE @TemplateID_a7e9ea68 UNIQUEIDENTIFIER,
@Name_a7e9ea68 NVARCHAR(255),
@Description_a7e9ea68 NVARCHAR(MAX),
@Type_a7e9ea68 NVARCHAR(20),
@DefaultValue_a7e9ea68 NVARCHAR(MAX),
@IsRequired_a7e9ea68 BIT,
@LinkedParameterName_a7e9ea68 NVARCHAR(255),
@LinkedParameterField_a7e9ea68 NVARCHAR(500),
@ExtraFilter_a7e9ea68 NVARCHAR(MAX),
@EntityID_a7e9ea68 UNIQUEIDENTIFIER,
@RecordID_a7e9ea68 NVARCHAR(2000),
@OrderBy_a7e9ea68 NVARCHAR(MAX),
@TemplateContentID_a7e9ea68 UNIQUEIDENTIFIER,
@ID_a7e9ea68 UNIQUEIDENTIFIER
SET
  @TemplateID_a7e9ea68 = '177D2C33-865C-47DA-A134-46019C759A42'
SET
  @Name_a7e9ea68 = N'entityMetadata'
SET
  @Description_a7e9ea68 = N'Array of entity metadata objects containing schema, view, fields, and relationship information'
SET
  @Type_a7e9ea68 = N'Array'
SET
  @IsRequired_a7e9ea68 = 0
SET
  @ID_a7e9ea68 = '52F3F662-3846-465D-AEF7-A0DE552B10D5'
EXEC [${flyway:defaultSchema}].spUpdateTemplateParam @TemplateID = @TemplateID_a7e9ea68,
  @Name = @Name_a7e9ea68,
  @Description = @Description_a7e9ea68,
  @Type = @Type_a7e9ea68,
  @DefaultValue = @DefaultValue_a7e9ea68,
  @IsRequired = @IsRequired_a7e9ea68,
  @LinkedParameterName = @LinkedParameterName_a7e9ea68,
  @LinkedParameterField = @LinkedParameterField_a7e9ea68,
  @ExtraFilter = @ExtraFilter_a7e9ea68,
  @EntityID = @EntityID_a7e9ea68,
  @RecordID = @RecordID_a7e9ea68,
  @OrderBy = @OrderBy_a7e9ea68,
  @TemplateContentID = @TemplateContentID_a7e9ea68,
  @ID = @ID_a7e9ea68;

-- Save Template Params (core SP call only)
DECLARE @TemplateID_a3f4024b UNIQUEIDENTIFIER,
@Name_a3f4024b NVARCHAR(255),
@Description_a3f4024b NVARCHAR(MAX),
@Type_a3f4024b NVARCHAR(20),
@DefaultValue_a3f4024b NVARCHAR(MAX),
@IsRequired_a3f4024b BIT,
@LinkedParameterName_a3f4024b NVARCHAR(255),
@LinkedParameterField_a3f4024b NVARCHAR(500),
@ExtraFilter_a3f4024b NVARCHAR(MAX),
@EntityID_a3f4024b UNIQUEIDENTIFIER,
@RecordID_a3f4024b NVARCHAR(2000),
@OrderBy_a3f4024b NVARCHAR(MAX),
@TemplateContentID_a3f4024b UNIQUEIDENTIFIER,
@ID_a3f4024b UNIQUEIDENTIFIER
SET
  @TemplateID_a3f4024b = '177D2C33-865C-47DA-A134-46019C759A42'
SET
  @Name_a3f4024b = N'userQuestion'
SET
  @Description_a3f4024b = N'The original business question asked by the user'
SET
  @Type_a3f4024b = N'Scalar'
SET
  @IsRequired_a3f4024b = 0
SET
  @ID_a3f4024b = '9EF572EB-4672-44E2-BC04-C3CF056D65E5'
EXEC [${flyway:defaultSchema}].spUpdateTemplateParam @TemplateID = @TemplateID_a3f4024b,
  @Name = @Name_a3f4024b,
  @Description = @Description_a3f4024b,
  @Type = @Type_a3f4024b,
  @DefaultValue = @DefaultValue_a3f4024b,
  @IsRequired = @IsRequired_a3f4024b,
  @LinkedParameterName = @LinkedParameterName_a3f4024b,
  @LinkedParameterField = @LinkedParameterField_a3f4024b,
  @ExtraFilter = @ExtraFilter_a3f4024b,
  @EntityID = @EntityID_a3f4024b,
  @RecordID = @RecordID_a3f4024b,
  @OrderBy = @OrderBy_a3f4024b,
  @TemplateContentID = @TemplateContentID_a3f4024b,
  @ID = @ID_a3f4024b;

-- Save Template Params (core SP call only)
DECLARE @TemplateID_49588adf UNIQUEIDENTIFIER,
@Name_49588adf NVARCHAR(255),
@Description_49588adf NVARCHAR(MAX),
@Type_49588adf NVARCHAR(20),
@DefaultValue_49588adf NVARCHAR(MAX),
@IsRequired_49588adf BIT,
@LinkedParameterName_49588adf NVARCHAR(255),
@LinkedParameterField_49588adf NVARCHAR(500),
@ExtraFilter_49588adf NVARCHAR(MAX),
@EntityID_49588adf UNIQUEIDENTIFIER,
@RecordID_49588adf NVARCHAR(2000),
@OrderBy_49588adf NVARCHAR(MAX),
@TemplateContentID_49588adf UNIQUEIDENTIFIER,
@ID_49588adf UNIQUEIDENTIFIER
SET
  @TemplateID_49588adf = '177D2C33-865C-47DA-A134-46019C759A42'
SET
  @Name_49588adf = N'currentSQL'
SET
  @Description_49588adf = N'The current SQL query being refined'
SET
  @Type_49588adf = N'Scalar'
SET
  @IsRequired_49588adf = 0
SET
  @ID_49588adf = '102EA88E-F422-4191-8F3F-FE7FD47A7535'
EXEC [${flyway:defaultSchema}].spUpdateTemplateParam @TemplateID = @TemplateID_49588adf,
  @Name = @Name_49588adf,
  @Description = @Description_49588adf,
  @Type = @Type_49588adf,
  @DefaultValue = @DefaultValue_49588adf,
  @IsRequired = @IsRequired_49588adf,
  @LinkedParameterName = @LinkedParameterName_49588adf,
  @LinkedParameterField = @LinkedParameterField_49588adf,
  @ExtraFilter = @ExtraFilter_49588adf,
  @EntityID = @EntityID_49588adf,
  @RecordID = @RecordID_49588adf,
  @OrderBy = @OrderBy_49588adf,
  @TemplateContentID = @TemplateContentID_49588adf,
  @ID = @ID_49588adf;

-- Save AI Prompts (core SP call only)
DECLARE @Name_af60e672 NVARCHAR(255),
@Description_af60e672 NVARCHAR(MAX),
@TemplateID_af60e672 UNIQUEIDENTIFIER,
@CategoryID_af60e672 UNIQUEIDENTIFIER,
@TypeID_af60e672 UNIQUEIDENTIFIER,
@Status_af60e672 NVARCHAR(50),
@ResponseFormat_af60e672 NVARCHAR(20),
@ModelSpecificResponseFormat_af60e672 NVARCHAR(MAX),
@AIModelTypeID_af60e672 UNIQUEIDENTIFIER,
@MinPowerRank_af60e672 INT,
@SelectionStrategy_af60e672 NVARCHAR(20),
@PowerPreference_af60e672 NVARCHAR(20),
@ParallelizationMode_af60e672 NVARCHAR(20),
@ParallelCount_af60e672 INT,
@ParallelConfigParam_af60e672 NVARCHAR(100),
@OutputType_af60e672 NVARCHAR(50),
@OutputExample_af60e672 NVARCHAR(MAX),
@ValidationBehavior_af60e672 NVARCHAR(50),
@MaxRetries_af60e672 INT,
@RetryDelayMS_af60e672 INT,
@RetryStrategy_af60e672 NVARCHAR(20),
@ResultSelectorPromptID_af60e672 UNIQUEIDENTIFIER,
@EnableCaching_af60e672 BIT,
@CacheTTLSeconds_af60e672 INT,
@CacheMatchType_af60e672 NVARCHAR(20),
@CacheSimilarityThreshold_af60e672 FLOAT(53),
@CacheMustMatchModel_af60e672 BIT,
@CacheMustMatchVendor_af60e672 BIT,
@CacheMustMatchAgent_af60e672 BIT,
@CacheMustMatchConfig_af60e672 BIT,
@PromptRole_af60e672 NVARCHAR(20),
@PromptPosition_af60e672 NVARCHAR(20),
@Temperature_af60e672 DECIMAL(3, 2),
@TopP_af60e672 DECIMAL(3, 2),
@TopK_af60e672 INT,
@MinP_af60e672 DECIMAL(3, 2),
@FrequencyPenalty_af60e672 DECIMAL(3, 2),
@PresencePenalty_af60e672 DECIMAL(3, 2),
@Seed_af60e672 INT,
@StopSequences_af60e672 NVARCHAR(1000),
@IncludeLogProbs_af60e672 BIT,
@TopLogProbs_af60e672 INT,
@FailoverStrategy_af60e672 NVARCHAR(50),
@FailoverMaxAttempts_af60e672 INT,
@FailoverDelaySeconds_af60e672 INT,
@FailoverModelStrategy_af60e672 NVARCHAR(50),
@FailoverErrorScope_af60e672 NVARCHAR(50),
@EffortLevel_af60e672 INT,
@ID_af60e672 UNIQUEIDENTIFIER
SET
  @Name_af60e672 = N'Business Question Generator'
SET
  @Description_af60e672 = N'Generates domain-specific business questions for entity groups'
SET
  @TemplateID_af60e672 = 'B28D9C1B-A5DF-45C3-97D0-FC483381FF60'
SET
  @CategoryID_af60e672 = 'FE112721-A511-4DC3-A75A-50E5E931E940'
SET
  @TypeID_af60e672 = 'A6DA423E-F36B-1410-8DAC-00021F8B792E'
SET
  @Status_af60e672 = N'Active'
SET
  @ResponseFormat_af60e672 = N'JSON'
SET
  @MinPowerRank_af60e672 = 0
SET
  @SelectionStrategy_af60e672 = N'Specific'
SET
  @PowerPreference_af60e672 = N'Highest'
SET
  @ParallelizationMode_af60e672 = N'None'
SET
  @OutputType_af60e672 = N'object'
SET
  @OutputExample_af60e672 = N'{"questions":[{"userQuestion":"What are the top 10 customers by total revenue?","description":"Identifies the customers who have generated the most revenue across all their orders","technicalDescription":"Aggregates order totals by customer, sorts descending by revenue, limits to top 10 results","complexity":"simple","requiresAggregation":true,"requiresJoins":true,"entities":["Customers","Orders"]}]}'
SET
  @ValidationBehavior_af60e672 = N'Strict'
SET
  @MaxRetries_af60e672 = 3
SET
  @RetryDelayMS_af60e672 = 0
SET
  @RetryStrategy_af60e672 = N'Fixed'
SET
  @EnableCaching_af60e672 = 0
SET
  @CacheMatchType_af60e672 = N'Exact'
SET
  @CacheMustMatchModel_af60e672 = 1
SET
  @CacheMustMatchVendor_af60e672 = 1
SET
  @CacheMustMatchAgent_af60e672 = 0
SET
  @CacheMustMatchConfig_af60e672 = 0
SET
  @PromptRole_af60e672 = N'System'
SET
  @PromptPosition_af60e672 = N'First'
SET
  @IncludeLogProbs_af60e672 = 0
SET
  @FailoverStrategy_af60e672 = N'SameModelDifferentVendor'
SET
  @FailoverMaxAttempts_af60e672 = 5
SET
  @FailoverDelaySeconds_af60e672 = 5
SET
  @FailoverModelStrategy_af60e672 = N'PreferSameModel'
SET
  @FailoverErrorScope_af60e672 = N'All'
SET
  @ID_af60e672 = 'FB9B5E4B-BB0E-43AF-B6C3-576999962CF5'
EXEC [${flyway:defaultSchema}].spUpdateAIPrompt @Name = @Name_af60e672,
  @Description = @Description_af60e672,
  @TemplateID = @TemplateID_af60e672,
  @CategoryID = @CategoryID_af60e672,
  @TypeID = @TypeID_af60e672,
  @Status = @Status_af60e672,
  @ResponseFormat = @ResponseFormat_af60e672,
  @ModelSpecificResponseFormat = @ModelSpecificResponseFormat_af60e672,
  @AIModelTypeID = @AIModelTypeID_af60e672,
  @MinPowerRank = @MinPowerRank_af60e672,
  @SelectionStrategy = @SelectionStrategy_af60e672,
  @PowerPreference = @PowerPreference_af60e672,
  @ParallelizationMode = @ParallelizationMode_af60e672,
  @ParallelCount = @ParallelCount_af60e672,
  @ParallelConfigParam = @ParallelConfigParam_af60e672,
  @OutputType = @OutputType_af60e672,
  @OutputExample = @OutputExample_af60e672,
  @ValidationBehavior = @ValidationBehavior_af60e672,
  @MaxRetries = @MaxRetries_af60e672,
  @RetryDelayMS = @RetryDelayMS_af60e672,
  @RetryStrategy = @RetryStrategy_af60e672,
  @ResultSelectorPromptID = @ResultSelectorPromptID_af60e672,
  @EnableCaching = @EnableCaching_af60e672,
  @CacheTTLSeconds = @CacheTTLSeconds_af60e672,
  @CacheMatchType = @CacheMatchType_af60e672,
  @CacheSimilarityThreshold = @CacheSimilarityThreshold_af60e672,
  @CacheMustMatchModel = @CacheMustMatchModel_af60e672,
  @CacheMustMatchVendor = @CacheMustMatchVendor_af60e672,
  @CacheMustMatchAgent = @CacheMustMatchAgent_af60e672,
  @CacheMustMatchConfig = @CacheMustMatchConfig_af60e672,
  @PromptRole = @PromptRole_af60e672,
  @PromptPosition = @PromptPosition_af60e672,
  @Temperature = @Temperature_af60e672,
  @TopP = @TopP_af60e672,
  @TopK = @TopK_af60e672,
  @MinP = @MinP_af60e672,
  @FrequencyPenalty = @FrequencyPenalty_af60e672,
  @PresencePenalty = @PresencePenalty_af60e672,
  @Seed = @Seed_af60e672,
  @StopSequences = @StopSequences_af60e672,
  @IncludeLogProbs = @IncludeLogProbs_af60e672,
  @TopLogProbs = @TopLogProbs_af60e672,
  @FailoverStrategy = @FailoverStrategy_af60e672,
  @FailoverMaxAttempts = @FailoverMaxAttempts_af60e672,
  @FailoverDelaySeconds = @FailoverDelaySeconds_af60e672,
  @FailoverModelStrategy = @FailoverModelStrategy_af60e672,
  @FailoverErrorScope = @FailoverErrorScope_af60e672,
  @EffortLevel = @EffortLevel_af60e672,
  @ID = @ID_af60e672;

-- Save AI Prompts (core SP call only)
DECLARE @Name_e8e4df60 NVARCHAR(255),
@Description_e8e4df60 NVARCHAR(MAX),
@TemplateID_e8e4df60 UNIQUEIDENTIFIER,
@CategoryID_e8e4df60 UNIQUEIDENTIFIER,
@TypeID_e8e4df60 UNIQUEIDENTIFIER,
@Status_e8e4df60 NVARCHAR(50),
@ResponseFormat_e8e4df60 NVARCHAR(20),
@ModelSpecificResponseFormat_e8e4df60 NVARCHAR(MAX),
@AIModelTypeID_e8e4df60 UNIQUEIDENTIFIER,
@MinPowerRank_e8e4df60 INT,
@SelectionStrategy_e8e4df60 NVARCHAR(20),
@PowerPreference_e8e4df60 NVARCHAR(20),
@ParallelizationMode_e8e4df60 NVARCHAR(20),
@ParallelCount_e8e4df60 INT,
@ParallelConfigParam_e8e4df60 NVARCHAR(100),
@OutputType_e8e4df60 NVARCHAR(50),
@OutputExample_e8e4df60 NVARCHAR(MAX),
@ValidationBehavior_e8e4df60 NVARCHAR(50),
@MaxRetries_e8e4df60 INT,
@RetryDelayMS_e8e4df60 INT,
@RetryStrategy_e8e4df60 NVARCHAR(20),
@ResultSelectorPromptID_e8e4df60 UNIQUEIDENTIFIER,
@EnableCaching_e8e4df60 BIT,
@CacheTTLSeconds_e8e4df60 INT,
@CacheMatchType_e8e4df60 NVARCHAR(20),
@CacheSimilarityThreshold_e8e4df60 FLOAT(53),
@CacheMustMatchModel_e8e4df60 BIT,
@CacheMustMatchVendor_e8e4df60 BIT,
@CacheMustMatchAgent_e8e4df60 BIT,
@CacheMustMatchConfig_e8e4df60 BIT,
@PromptRole_e8e4df60 NVARCHAR(20),
@PromptPosition_e8e4df60 NVARCHAR(20),
@Temperature_e8e4df60 DECIMAL(3, 2),
@TopP_e8e4df60 DECIMAL(3, 2),
@TopK_e8e4df60 INT,
@MinP_e8e4df60 DECIMAL(3, 2),
@FrequencyPenalty_e8e4df60 DECIMAL(3, 2),
@PresencePenalty_e8e4df60 DECIMAL(3, 2),
@Seed_e8e4df60 INT,
@StopSequences_e8e4df60 NVARCHAR(1000),
@IncludeLogProbs_e8e4df60 BIT,
@TopLogProbs_e8e4df60 INT,
@FailoverStrategy_e8e4df60 NVARCHAR(50),
@FailoverMaxAttempts_e8e4df60 INT,
@FailoverDelaySeconds_e8e4df60 INT,
@FailoverModelStrategy_e8e4df60 NVARCHAR(50),
@FailoverErrorScope_e8e4df60 NVARCHAR(50),
@EffortLevel_e8e4df60 INT,
@ID_e8e4df60 UNIQUEIDENTIFIER
SET
  @Name_e8e4df60 = N'SQL Query Writer'
SET
  @Description_e8e4df60 = N'Generates Nunjucks SQL query templates from business questions using few-shot learning'
SET
  @TemplateID_e8e4df60 = '6C644A1D-01A7-43E9-B8C9-63636388A937'
SET
  @CategoryID_e8e4df60 = 'FE112721-A511-4DC3-A75A-50E5E931E940'
SET
  @TypeID_e8e4df60 = 'A6DA423E-F36B-1410-8DAC-00021F8B792E'
SET
  @Status_e8e4df60 = N'Active'
SET
  @ResponseFormat_e8e4df60 = N'JSON'
SET
  @MinPowerRank_e8e4df60 = 0
SET
  @SelectionStrategy_e8e4df60 = N'Specific'
SET
  @PowerPreference_e8e4df60 = N'Highest'
SET
  @ParallelizationMode_e8e4df60 = N'None'
SET
  @OutputType_e8e4df60 = N'object'
SET
  @OutputExample_e8e4df60 = N'{"queryName":"Customer Revenue By Date Range","sql":"SELECT c.Name AS CustomerName, SUM(o.Total) AS TotalRevenue FROM [${flyway:defaultSchema}].[vwCustomers] c LEFT JOIN [${flyway:defaultSchema}].[vwOrders] o ON o.CustomerID = c.ID WHERE o.OrderDate >= {{ startDate | sqlDate }} GROUP BY c.Name ORDER BY TotalRevenue DESC","parameters":[{"name":"startDate","type":"date","isRequired":true,"description":"Start date for order filtering","usage":["WHERE clause filter on OrderDate"],"defaultValue":null,"sampleValue":"2024-01-01"}]}'
SET
  @ValidationBehavior_e8e4df60 = N'Strict'
SET
  @MaxRetries_e8e4df60 = 3
SET
  @RetryDelayMS_e8e4df60 = 0
SET
  @RetryStrategy_e8e4df60 = N'Fixed'
SET
  @EnableCaching_e8e4df60 = 0
SET
  @CacheMatchType_e8e4df60 = N'Exact'
SET
  @CacheMustMatchModel_e8e4df60 = 1
SET
  @CacheMustMatchVendor_e8e4df60 = 1
SET
  @CacheMustMatchAgent_e8e4df60 = 0
SET
  @CacheMustMatchConfig_e8e4df60 = 0
SET
  @PromptRole_e8e4df60 = N'System'
SET
  @PromptPosition_e8e4df60 = N'First'
SET
  @IncludeLogProbs_e8e4df60 = 0
SET
  @FailoverStrategy_e8e4df60 = N'SameModelDifferentVendor'
SET
  @FailoverMaxAttempts_e8e4df60 = 5
SET
  @FailoverDelaySeconds_e8e4df60 = 5
SET
  @FailoverModelStrategy_e8e4df60 = N'PreferSameModel'
SET
  @FailoverErrorScope_e8e4df60 = N'All'
SET
  @ID_e8e4df60 = 'FA000A4D-09F5-4557-858F-AC01E19D8238'
EXEC [${flyway:defaultSchema}].spUpdateAIPrompt @Name = @Name_e8e4df60,
  @Description = @Description_e8e4df60,
  @TemplateID = @TemplateID_e8e4df60,
  @CategoryID = @CategoryID_e8e4df60,
  @TypeID = @TypeID_e8e4df60,
  @Status = @Status_e8e4df60,
  @ResponseFormat = @ResponseFormat_e8e4df60,
  @ModelSpecificResponseFormat = @ModelSpecificResponseFormat_e8e4df60,
  @AIModelTypeID = @AIModelTypeID_e8e4df60,
  @MinPowerRank = @MinPowerRank_e8e4df60,
  @SelectionStrategy = @SelectionStrategy_e8e4df60,
  @PowerPreference = @PowerPreference_e8e4df60,
  @ParallelizationMode = @ParallelizationMode_e8e4df60,
  @ParallelCount = @ParallelCount_e8e4df60,
  @ParallelConfigParam = @ParallelConfigParam_e8e4df60,
  @OutputType = @OutputType_e8e4df60,
  @OutputExample = @OutputExample_e8e4df60,
  @ValidationBehavior = @ValidationBehavior_e8e4df60,
  @MaxRetries = @MaxRetries_e8e4df60,
  @RetryDelayMS = @RetryDelayMS_e8e4df60,
  @RetryStrategy = @RetryStrategy_e8e4df60,
  @ResultSelectorPromptID = @ResultSelectorPromptID_e8e4df60,
  @EnableCaching = @EnableCaching_e8e4df60,
  @CacheTTLSeconds = @CacheTTLSeconds_e8e4df60,
  @CacheMatchType = @CacheMatchType_e8e4df60,
  @CacheSimilarityThreshold = @CacheSimilarityThreshold_e8e4df60,
  @CacheMustMatchModel = @CacheMustMatchModel_e8e4df60,
  @CacheMustMatchVendor = @CacheMustMatchVendor_e8e4df60,
  @CacheMustMatchAgent = @CacheMustMatchAgent_e8e4df60,
  @CacheMustMatchConfig = @CacheMustMatchConfig_e8e4df60,
  @PromptRole = @PromptRole_e8e4df60,
  @PromptPosition = @PromptPosition_e8e4df60,
  @Temperature = @Temperature_e8e4df60,
  @TopP = @TopP_e8e4df60,
  @TopK = @TopK_e8e4df60,
  @MinP = @MinP_e8e4df60,
  @FrequencyPenalty = @FrequencyPenalty_e8e4df60,
  @PresencePenalty = @PresencePenalty_e8e4df60,
  @Seed = @Seed_e8e4df60,
  @StopSequences = @StopSequences_e8e4df60,
  @IncludeLogProbs = @IncludeLogProbs_e8e4df60,
  @TopLogProbs = @TopLogProbs_e8e4df60,
  @FailoverStrategy = @FailoverStrategy_e8e4df60,
  @FailoverMaxAttempts = @FailoverMaxAttempts_e8e4df60,
  @FailoverDelaySeconds = @FailoverDelaySeconds_e8e4df60,
  @FailoverModelStrategy = @FailoverModelStrategy_e8e4df60,
  @FailoverErrorScope = @FailoverErrorScope_e8e4df60,
  @EffortLevel = @EffortLevel_e8e4df60,
  @ID = @ID_e8e4df60;

-- Save AI Prompts (core SP call only)
DECLARE @Name_04491a43 NVARCHAR(255),
@Description_04491a43 NVARCHAR(MAX),
@TemplateID_04491a43 UNIQUEIDENTIFIER,
@CategoryID_04491a43 UNIQUEIDENTIFIER,
@TypeID_04491a43 UNIQUEIDENTIFIER,
@Status_04491a43 NVARCHAR(50),
@ResponseFormat_04491a43 NVARCHAR(20),
@ModelSpecificResponseFormat_04491a43 NVARCHAR(MAX),
@AIModelTypeID_04491a43 UNIQUEIDENTIFIER,
@MinPowerRank_04491a43 INT,
@SelectionStrategy_04491a43 NVARCHAR(20),
@PowerPreference_04491a43 NVARCHAR(20),
@ParallelizationMode_04491a43 NVARCHAR(20),
@ParallelCount_04491a43 INT,
@ParallelConfigParam_04491a43 NVARCHAR(100),
@OutputType_04491a43 NVARCHAR(50),
@OutputExample_04491a43 NVARCHAR(MAX),
@ValidationBehavior_04491a43 NVARCHAR(50),
@MaxRetries_04491a43 INT,
@RetryDelayMS_04491a43 INT,
@RetryStrategy_04491a43 NVARCHAR(20),
@ResultSelectorPromptID_04491a43 UNIQUEIDENTIFIER,
@EnableCaching_04491a43 BIT,
@CacheTTLSeconds_04491a43 INT,
@CacheMatchType_04491a43 NVARCHAR(20),
@CacheSimilarityThreshold_04491a43 FLOAT(53),
@CacheMustMatchModel_04491a43 BIT,
@CacheMustMatchVendor_04491a43 BIT,
@CacheMustMatchAgent_04491a43 BIT,
@CacheMustMatchConfig_04491a43 BIT,
@PromptRole_04491a43 NVARCHAR(20),
@PromptPosition_04491a43 NVARCHAR(20),
@Temperature_04491a43 DECIMAL(3, 2),
@TopP_04491a43 DECIMAL(3, 2),
@TopK_04491a43 INT,
@MinP_04491a43 DECIMAL(3, 2),
@FrequencyPenalty_04491a43 DECIMAL(3, 2),
@PresencePenalty_04491a43 DECIMAL(3, 2),
@Seed_04491a43 INT,
@StopSequences_04491a43 NVARCHAR(1000),
@IncludeLogProbs_04491a43 BIT,
@TopLogProbs_04491a43 INT,
@FailoverStrategy_04491a43 NVARCHAR(50),
@FailoverMaxAttempts_04491a43 INT,
@FailoverDelaySeconds_04491a43 INT,
@FailoverModelStrategy_04491a43 NVARCHAR(50),
@FailoverErrorScope_04491a43 NVARCHAR(50),
@EffortLevel_04491a43 INT,
@ID_04491a43 UNIQUEIDENTIFIER
SET
  @Name_04491a43 = N'Query Refiner'
SET
  @Description_04491a43 = N'Refines queries based on evaluation feedback'
SET
  @TemplateID_04491a43 = '177D2C33-865C-47DA-A134-46019C759A42'
SET
  @CategoryID_04491a43 = 'FE112721-A511-4DC3-A75A-50E5E931E940'
SET
  @TypeID_04491a43 = 'A6DA423E-F36B-1410-8DAC-00021F8B792E'
SET
  @Status_04491a43 = N'Active'
SET
  @ResponseFormat_04491a43 = N'JSON'
SET
  @MinPowerRank_04491a43 = 0
SET
  @SelectionStrategy_04491a43 = N'Specific'
SET
  @PowerPreference_04491a43 = N'Highest'
SET
  @ParallelizationMode_04491a43 = N'None'
SET
  @OutputType_04491a43 = N'object'
SET
  @OutputExample_04491a43 = N'{"queryName":"Top Customer Revenue By Region","sql":"SELECT c.Name AS CustomerName, c.Region, SUM(o.Total) AS TotalRevenue FROM [${flyway:defaultSchema}].[vwCustomers] c LEFT JOIN [${flyway:defaultSchema}].[vwOrders] o ON o.CustomerID = c.ID WHERE o.OrderDate >= {{ startDate | sqlDate }} GROUP BY c.Name, c.Region ORDER BY TotalRevenue DESC LIMIT 10","parameters":[{"name":"startDate","type":"date","isRequired":true,"description":"Start date for order filtering","usage":["WHERE clause filter on OrderDate"],"defaultValue":null,"sampleValue":"2024-01-01"}],"improvementsSummary":"Added Region field and LIMIT clause"}'
SET
  @ValidationBehavior_04491a43 = N'Strict'
SET
  @MaxRetries_04491a43 = 3
SET
  @RetryDelayMS_04491a43 = 0
SET
  @RetryStrategy_04491a43 = N'Fixed'
SET
  @EnableCaching_04491a43 = 0
SET
  @CacheMatchType_04491a43 = N'Exact'
SET
  @CacheMustMatchModel_04491a43 = 1
SET
  @CacheMustMatchVendor_04491a43 = 1
SET
  @CacheMustMatchAgent_04491a43 = 0
SET
  @CacheMustMatchConfig_04491a43 = 0
SET
  @PromptRole_04491a43 = N'System'
SET
  @PromptPosition_04491a43 = N'First'
SET
  @IncludeLogProbs_04491a43 = 0
SET
  @FailoverStrategy_04491a43 = N'SameModelDifferentVendor'
SET
  @FailoverMaxAttempts_04491a43 = 5
SET
  @FailoverDelaySeconds_04491a43 = 5
SET
  @FailoverModelStrategy_04491a43 = N'PreferSameModel'
SET
  @FailoverErrorScope_04491a43 = N'All'
SET
  @ID_04491a43 = '06BAFF5F-D131-46BF-B2FB-79CC2067B743'
EXEC [${flyway:defaultSchema}].spUpdateAIPrompt @Name = @Name_04491a43,
  @Description = @Description_04491a43,
  @TemplateID = @TemplateID_04491a43,
  @CategoryID = @CategoryID_04491a43,
  @TypeID = @TypeID_04491a43,
  @Status = @Status_04491a43,
  @ResponseFormat = @ResponseFormat_04491a43,
  @ModelSpecificResponseFormat = @ModelSpecificResponseFormat_04491a43,
  @AIModelTypeID = @AIModelTypeID_04491a43,
  @MinPowerRank = @MinPowerRank_04491a43,
  @SelectionStrategy = @SelectionStrategy_04491a43,
  @PowerPreference = @PowerPreference_04491a43,
  @ParallelizationMode = @ParallelizationMode_04491a43,
  @ParallelCount = @ParallelCount_04491a43,
  @ParallelConfigParam = @ParallelConfigParam_04491a43,
  @OutputType = @OutputType_04491a43,
  @OutputExample = @OutputExample_04491a43,
  @ValidationBehavior = @ValidationBehavior_04491a43,
  @MaxRetries = @MaxRetries_04491a43,
  @RetryDelayMS = @RetryDelayMS_04491a43,
  @RetryStrategy = @RetryStrategy_04491a43,
  @ResultSelectorPromptID = @ResultSelectorPromptID_04491a43,
  @EnableCaching = @EnableCaching_04491a43,
  @CacheTTLSeconds = @CacheTTLSeconds_04491a43,
  @CacheMatchType = @CacheMatchType_04491a43,
  @CacheSimilarityThreshold = @CacheSimilarityThreshold_04491a43,
  @CacheMustMatchModel = @CacheMustMatchModel_04491a43,
  @CacheMustMatchVendor = @CacheMustMatchVendor_04491a43,
  @CacheMustMatchAgent = @CacheMustMatchAgent_04491a43,
  @CacheMustMatchConfig = @CacheMustMatchConfig_04491a43,
  @PromptRole = @PromptRole_04491a43,
  @PromptPosition = @PromptPosition_04491a43,
  @Temperature = @Temperature_04491a43,
  @TopP = @TopP_04491a43,
  @TopK = @TopK_04491a43,
  @MinP = @MinP_04491a43,
  @FrequencyPenalty = @FrequencyPenalty_04491a43,
  @PresencePenalty = @PresencePenalty_04491a43,
  @Seed = @Seed_04491a43,
  @StopSequences = @StopSequences_04491a43,
  @IncludeLogProbs = @IncludeLogProbs_04491a43,
  @TopLogProbs = @TopLogProbs_04491a43,
  @FailoverStrategy = @FailoverStrategy_04491a43,
  @FailoverMaxAttempts = @FailoverMaxAttempts_04491a43,
  @FailoverDelaySeconds = @FailoverDelaySeconds_04491a43,
  @FailoverModelStrategy = @FailoverModelStrategy_04491a43,
  @FailoverErrorScope = @FailoverErrorScope_04491a43,
  @EffortLevel = @EffortLevel_04491a43,
  @ID = @ID_04491a43;

-- Save Template Params (core SP call only)
DECLARE @ID_e8f7992a UNIQUEIDENTIFIER,
@TemplateID_e8f7992a UNIQUEIDENTIFIER,
@Name_e8f7992a NVARCHAR(255),
@Description_e8f7992a NVARCHAR(MAX),
@Type_e8f7992a NVARCHAR(20),
@DefaultValue_e8f7992a NVARCHAR(MAX),
@IsRequired_e8f7992a BIT,
@LinkedParameterName_e8f7992a NVARCHAR(255),
@LinkedParameterField_e8f7992a NVARCHAR(500),
@ExtraFilter_e8f7992a NVARCHAR(MAX),
@EntityID_e8f7992a UNIQUEIDENTIFIER,
@RecordID_e8f7992a NVARCHAR(2000),
@OrderBy_e8f7992a NVARCHAR(MAX),
@TemplateContentID_e8f7992a UNIQUEIDENTIFIER
SET
  @ID_e8f7992a = '3c25c6a0-267e-46e8-ac8a-07c6629cf750'
SET
  @TemplateID_e8f7992a = '311AB35A-F04C-4B92-B917-89E23D534A4E'
SET
  @Name_e8f7992a = N'avgDegree'
SET
  @Description_e8f7992a = N'Average number of relationships per entity in the schema'
SET
  @Type_e8f7992a = N'Scalar'
SET
  @IsRequired_e8f7992a = 0
EXEC [${flyway:defaultSchema}].spCreateTemplateParam @ID = @ID_e8f7992a,
  @TemplateID = @TemplateID_e8f7992a,
  @Name = @Name_e8f7992a,
  @Description = @Description_e8f7992a,
  @Type = @Type_e8f7992a,
  @DefaultValue = @DefaultValue_e8f7992a,
  @IsRequired = @IsRequired_e8f7992a,
  @LinkedParameterName = @LinkedParameterName_e8f7992a,
  @LinkedParameterField = @LinkedParameterField_e8f7992a,
  @ExtraFilter = @ExtraFilter_e8f7992a,
  @EntityID = @EntityID_e8f7992a,
  @RecordID = @RecordID_e8f7992a,
  @OrderBy = @OrderBy_e8f7992a,
  @TemplateContentID = @TemplateContentID_e8f7992a;

-- Save Template Params (core SP call only)
DECLARE @ID_d61aefba UNIQUEIDENTIFIER,
@TemplateID_d61aefba UNIQUEIDENTIFIER,
@Name_d61aefba NVARCHAR(255),
@Description_d61aefba NVARCHAR(MAX),
@Type_d61aefba NVARCHAR(20),
@DefaultValue_d61aefba NVARCHAR(MAX),
@IsRequired_d61aefba BIT,
@LinkedParameterName_d61aefba NVARCHAR(255),
@LinkedParameterField_d61aefba NVARCHAR(500),
@ExtraFilter_d61aefba NVARCHAR(MAX),
@EntityID_d61aefba UNIQUEIDENTIFIER,
@RecordID_d61aefba NVARCHAR(2000),
@OrderBy_d61aefba NVARCHAR(MAX),
@TemplateContentID_d61aefba UNIQUEIDENTIFIER
SET
  @ID_d61aefba = '31177921-e212-48a9-b7ce-003837f2b71f'
SET
  @TemplateID_d61aefba = '311AB35A-F04C-4B92-B917-89E23D534A4E'
SET
  @Name_d61aefba = N'hubCount'
SET
  @Description_d61aefba = N'Number of hub entities with more than 5 relationships'
SET
  @Type_d61aefba = N'Scalar'
SET
  @IsRequired_d61aefba = 0
EXEC [${flyway:defaultSchema}].spCreateTemplateParam @ID = @ID_d61aefba,
  @TemplateID = @TemplateID_d61aefba,
  @Name = @Name_d61aefba,
  @Description = @Description_d61aefba,
  @Type = @Type_d61aefba,
  @DefaultValue = @DefaultValue_d61aefba,
  @IsRequired = @IsRequired_d61aefba,
  @LinkedParameterName = @LinkedParameterName_d61aefba,
  @LinkedParameterField = @LinkedParameterField_d61aefba,
  @ExtraFilter = @ExtraFilter_d61aefba,
  @EntityID = @EntityID_d61aefba,
  @RecordID = @RecordID_d61aefba,
  @OrderBy = @OrderBy_d61aefba,
  @TemplateContentID = @TemplateContentID_d61aefba;

-- Save Template Params (core SP call only)
DECLARE @ID_161be15f UNIQUEIDENTIFIER,
@TemplateID_161be15f UNIQUEIDENTIFIER,
@Name_161be15f NVARCHAR(255),
@Description_161be15f NVARCHAR(MAX),
@Type_161be15f NVARCHAR(20),
@DefaultValue_161be15f NVARCHAR(MAX),
@IsRequired_161be15f BIT,
@LinkedParameterName_161be15f NVARCHAR(255),
@LinkedParameterField_161be15f NVARCHAR(500),
@ExtraFilter_161be15f NVARCHAR(MAX),
@EntityID_161be15f UNIQUEIDENTIFIER,
@RecordID_161be15f NVARCHAR(2000),
@OrderBy_161be15f NVARCHAR(MAX),
@TemplateContentID_161be15f UNIQUEIDENTIFIER
SET
  @ID_161be15f = 'd4fa6400-d03b-46c5-86a2-b554533a2e6e'
SET
  @TemplateID_161be15f = '311AB35A-F04C-4B92-B917-89E23D534A4E'
SET
  @Name_161be15f = N'maxHubDegree'
SET
  @Description_161be15f = N'Number of relationships for the largest hub entity'
SET
  @Type_161be15f = N'Scalar'
SET
  @IsRequired_161be15f = 0
EXEC [${flyway:defaultSchema}].spCreateTemplateParam @ID = @ID_161be15f,
  @TemplateID = @TemplateID_161be15f,
  @Name = @Name_161be15f,
  @Description = @Description_161be15f,
  @Type = @Type_161be15f,
  @DefaultValue = @DefaultValue_161be15f,
  @IsRequired = @IsRequired_161be15f,
  @LinkedParameterName = @LinkedParameterName_161be15f,
  @LinkedParameterField = @LinkedParameterField_161be15f,
  @ExtraFilter = @ExtraFilter_161be15f,
  @EntityID = @EntityID_161be15f,
  @RecordID = @RecordID_161be15f,
  @OrderBy = @OrderBy_161be15f,
  @TemplateContentID = @TemplateContentID_161be15f;

-- Save Template Params (core SP call only)
DECLARE @ID_3a23dc76 UNIQUEIDENTIFIER,
@TemplateID_3a23dc76 UNIQUEIDENTIFIER,
@Name_3a23dc76 NVARCHAR(255),
@Description_3a23dc76 NVARCHAR(MAX),
@Type_3a23dc76 NVARCHAR(20),
@DefaultValue_3a23dc76 NVARCHAR(MAX),
@IsRequired_3a23dc76 BIT,
@LinkedParameterName_3a23dc76 NVARCHAR(255),
@LinkedParameterField_3a23dc76 NVARCHAR(500),
@ExtraFilter_3a23dc76 NVARCHAR(MAX),
@EntityID_3a23dc76 UNIQUEIDENTIFIER,
@RecordID_3a23dc76 NVARCHAR(2000),
@OrderBy_3a23dc76 NVARCHAR(MAX),
@TemplateContentID_3a23dc76 UNIQUEIDENTIFIER
SET
  @ID_3a23dc76 = '2fdbd042-ab3c-45b7-b976-08d96db887d6'
SET
  @TemplateID_3a23dc76 = '311AB35A-F04C-4B92-B917-89E23D534A4E'
SET
  @Name_3a23dc76 = N'targetGroupCount'
SET
  @Description_3a23dc76 = N'Target number of entity groups to generate'
SET
  @Type_3a23dc76 = N'Scalar'
SET
  @IsRequired_3a23dc76 = 0
EXEC [${flyway:defaultSchema}].spCreateTemplateParam @ID = @ID_3a23dc76,
  @TemplateID = @TemplateID_3a23dc76,
  @Name = @Name_3a23dc76,
  @Description = @Description_3a23dc76,
  @Type = @Type_3a23dc76,
  @DefaultValue = @DefaultValue_3a23dc76,
  @IsRequired = @IsRequired_3a23dc76,
  @LinkedParameterName = @LinkedParameterName_3a23dc76,
  @LinkedParameterField = @LinkedParameterField_3a23dc76,
  @ExtraFilter = @ExtraFilter_3a23dc76,
  @EntityID = @EntityID_3a23dc76,
  @RecordID = @RecordID_3a23dc76,
  @OrderBy = @OrderBy_3a23dc76,
  @TemplateContentID = @TemplateContentID_3a23dc76;

-- Save Template Params (core SP call only)
DECLARE @TemplateID_3a9e5d59 UNIQUEIDENTIFIER,
@Name_3a9e5d59 NVARCHAR(255),
@Description_3a9e5d59 NVARCHAR(MAX),
@Type_3a9e5d59 NVARCHAR(20),
@DefaultValue_3a9e5d59 NVARCHAR(MAX),
@IsRequired_3a9e5d59 BIT,
@LinkedParameterName_3a9e5d59 NVARCHAR(255),
@LinkedParameterField_3a9e5d59 NVARCHAR(500),
@ExtraFilter_3a9e5d59 NVARCHAR(MAX),
@EntityID_3a9e5d59 UNIQUEIDENTIFIER,
@RecordID_3a9e5d59 NVARCHAR(2000),
@OrderBy_3a9e5d59 NVARCHAR(MAX),
@TemplateContentID_3a9e5d59 UNIQUEIDENTIFIER,
@ID_3a9e5d59 UNIQUEIDENTIFIER
SET
  @TemplateID_3a9e5d59 = '311AB35A-F04C-4B92-B917-89E23D534A4E'
SET
  @Name_3a9e5d59 = N'relationshipGraph'
SET
  @Description_3a9e5d59 = N'Visual representation of entity relationships in the schema'
SET
  @Type_3a9e5d59 = N'Scalar'
SET
  @IsRequired_3a9e5d59 = 0
SET
  @ID_3a9e5d59 = '30B08299-0536-4EA8-84B7-0B5CC707F901'
EXEC [${flyway:defaultSchema}].spUpdateTemplateParam @TemplateID = @TemplateID_3a9e5d59,
  @Name = @Name_3a9e5d59,
  @Description = @Description_3a9e5d59,
  @Type = @Type_3a9e5d59,
  @DefaultValue = @DefaultValue_3a9e5d59,
  @IsRequired = @IsRequired_3a9e5d59,
  @LinkedParameterName = @LinkedParameterName_3a9e5d59,
  @LinkedParameterField = @LinkedParameterField_3a9e5d59,
  @ExtraFilter = @ExtraFilter_3a9e5d59,
  @EntityID = @EntityID_3a9e5d59,
  @RecordID = @RecordID_3a9e5d59,
  @OrderBy = @OrderBy_3a9e5d59,
  @TemplateContentID = @TemplateContentID_3a9e5d59,
  @ID = @ID_3a9e5d59;

-- Save Template Params (core SP call only)
DECLARE @TemplateID_530bc1a1 UNIQUEIDENTIFIER,
@Name_530bc1a1 NVARCHAR(255),
@Description_530bc1a1 NVARCHAR(MAX),
@Type_530bc1a1 NVARCHAR(20),
@DefaultValue_530bc1a1 NVARCHAR(MAX),
@IsRequired_530bc1a1 BIT,
@LinkedParameterName_530bc1a1 NVARCHAR(255),
@LinkedParameterField_530bc1a1 NVARCHAR(500),
@ExtraFilter_530bc1a1 NVARCHAR(MAX),
@EntityID_530bc1a1 UNIQUEIDENTIFIER,
@RecordID_530bc1a1 NVARCHAR(2000),
@OrderBy_530bc1a1 NVARCHAR(MAX),
@TemplateContentID_530bc1a1 UNIQUEIDENTIFIER,
@ID_530bc1a1 UNIQUEIDENTIFIER
SET
  @TemplateID_530bc1a1 = '311AB35A-F04C-4B92-B917-89E23D534A4E'
SET
  @Name_530bc1a1 = N'entities'
SET
  @Description_530bc1a1 = N'List of database entities with their metadata including Name, Description, SchemaName, FieldCount, and RelatedEntities'
SET
  @Type_530bc1a1 = N'Array'
SET
  @IsRequired_530bc1a1 = 0
SET
  @ID_530bc1a1 = '04ED3EE0-9455-4167-94FB-2350FF356130'
EXEC [${flyway:defaultSchema}].spUpdateTemplateParam @TemplateID = @TemplateID_530bc1a1,
  @Name = @Name_530bc1a1,
  @Description = @Description_530bc1a1,
  @Type = @Type_530bc1a1,
  @DefaultValue = @DefaultValue_530bc1a1,
  @IsRequired = @IsRequired_530bc1a1,
  @LinkedParameterName = @LinkedParameterName_530bc1a1,
  @LinkedParameterField = @LinkedParameterField_530bc1a1,
  @ExtraFilter = @ExtraFilter_530bc1a1,
  @EntityID = @EntityID_530bc1a1,
  @RecordID = @RecordID_530bc1a1,
  @OrderBy = @OrderBy_530bc1a1,
  @TemplateContentID = @TemplateContentID_530bc1a1,
  @ID = @ID_530bc1a1;

-- Save Template Params (core SP call only)
DECLARE @TemplateID_dd9a4803 UNIQUEIDENTIFIER,
@Name_dd9a4803 NVARCHAR(255),
@Description_dd9a4803 NVARCHAR(MAX),
@Type_dd9a4803 NVARCHAR(20),
@DefaultValue_dd9a4803 NVARCHAR(MAX),
@IsRequired_dd9a4803 BIT,
@LinkedParameterName_dd9a4803 NVARCHAR(255),
@LinkedParameterField_dd9a4803 NVARCHAR(500),
@ExtraFilter_dd9a4803 NVARCHAR(MAX),
@EntityID_dd9a4803 UNIQUEIDENTIFIER,
@RecordID_dd9a4803 NVARCHAR(2000),
@OrderBy_dd9a4803 NVARCHAR(MAX),
@TemplateContentID_dd9a4803 UNIQUEIDENTIFIER,
@ID_dd9a4803 UNIQUEIDENTIFIER
SET
  @TemplateID_dd9a4803 = '311AB35A-F04C-4B92-B917-89E23D534A4E'
SET
  @Name_dd9a4803 = N'maxGroupSize'
SET
  @Description_dd9a4803 = N'Maximum number of entities allowed in a group'
SET
  @Type_dd9a4803 = N'Scalar'
SET
  @IsRequired_dd9a4803 = 0
SET
  @ID_dd9a4803 = '6C92E39E-2749-4071-8021-440C80D24D8A'
EXEC [${flyway:defaultSchema}].spUpdateTemplateParam @TemplateID = @TemplateID_dd9a4803,
  @Name = @Name_dd9a4803,
  @Description = @Description_dd9a4803,
  @Type = @Type_dd9a4803,
  @DefaultValue = @DefaultValue_dd9a4803,
  @IsRequired = @IsRequired_dd9a4803,
  @LinkedParameterName = @LinkedParameterName_dd9a4803,
  @LinkedParameterField = @LinkedParameterField_dd9a4803,
  @ExtraFilter = @ExtraFilter_dd9a4803,
  @EntityID = @EntityID_dd9a4803,
  @RecordID = @RecordID_dd9a4803,
  @OrderBy = @OrderBy_dd9a4803,
  @TemplateContentID = @TemplateContentID_dd9a4803,
  @ID = @ID_dd9a4803;

-- Save Template Params (core SP call only)
DECLARE @TemplateID_7022d1f7 UNIQUEIDENTIFIER,
@Name_7022d1f7 NVARCHAR(255),
@Description_7022d1f7 NVARCHAR(MAX),
@Type_7022d1f7 NVARCHAR(20),
@DefaultValue_7022d1f7 NVARCHAR(MAX),
@IsRequired_7022d1f7 BIT,
@LinkedParameterName_7022d1f7 NVARCHAR(255),
@LinkedParameterField_7022d1f7 NVARCHAR(500),
@ExtraFilter_7022d1f7 NVARCHAR(MAX),
@EntityID_7022d1f7 UNIQUEIDENTIFIER,
@RecordID_7022d1f7 NVARCHAR(2000),
@OrderBy_7022d1f7 NVARCHAR(MAX),
@TemplateContentID_7022d1f7 UNIQUEIDENTIFIER,
@ID_7022d1f7 UNIQUEIDENTIFIER
SET
  @TemplateID_7022d1f7 = '311AB35A-F04C-4B92-B917-89E23D534A4E'
SET
  @Name_7022d1f7 = N'schemaName'
SET
  @Description_7022d1f7 = N'Name of the database schema being analyzed'
SET
  @Type_7022d1f7 = N'Scalar'
SET
  @IsRequired_7022d1f7 = 0
SET
  @ID_7022d1f7 = '22609831-3F5F-4943-917B-50938F21CEBF'
EXEC [${flyway:defaultSchema}].spUpdateTemplateParam @TemplateID = @TemplateID_7022d1f7,
  @Name = @Name_7022d1f7,
  @Description = @Description_7022d1f7,
  @Type = @Type_7022d1f7,
  @DefaultValue = @DefaultValue_7022d1f7,
  @IsRequired = @IsRequired_7022d1f7,
  @LinkedParameterName = @LinkedParameterName_7022d1f7,
  @LinkedParameterField = @LinkedParameterField_7022d1f7,
  @ExtraFilter = @ExtraFilter_7022d1f7,
  @EntityID = @EntityID_7022d1f7,
  @RecordID = @RecordID_7022d1f7,
  @OrderBy = @OrderBy_7022d1f7,
  @TemplateContentID = @TemplateContentID_7022d1f7,
  @ID = @ID_7022d1f7;

-- Save Template Params (core SP call only)
DECLARE @TemplateID_9e84fff0 UNIQUEIDENTIFIER,
@Name_9e84fff0 NVARCHAR(255),
@Description_9e84fff0 NVARCHAR(MAX),
@Type_9e84fff0 NVARCHAR(20),
@DefaultValue_9e84fff0 NVARCHAR(MAX),
@IsRequired_9e84fff0 BIT,
@LinkedParameterName_9e84fff0 NVARCHAR(255),
@LinkedParameterField_9e84fff0 NVARCHAR(500),
@ExtraFilter_9e84fff0 NVARCHAR(MAX),
@EntityID_9e84fff0 UNIQUEIDENTIFIER,
@RecordID_9e84fff0 NVARCHAR(2000),
@OrderBy_9e84fff0 NVARCHAR(MAX),
@TemplateContentID_9e84fff0 UNIQUEIDENTIFIER,
@ID_9e84fff0 UNIQUEIDENTIFIER
SET
  @TemplateID_9e84fff0 = '311AB35A-F04C-4B92-B917-89E23D534A4E'
SET
  @Name_9e84fff0 = N'minGroupSize'
SET
  @Description_9e84fff0 = N'Minimum number of entities required in a group'
SET
  @Type_9e84fff0 = N'Scalar'
SET
  @IsRequired_9e84fff0 = 0
SET
  @ID_9e84fff0 = 'BA4959AD-72C4-48BA-9C68-9A1F47A3E82A'
EXEC [${flyway:defaultSchema}].spUpdateTemplateParam @TemplateID = @TemplateID_9e84fff0,
  @Name = @Name_9e84fff0,
  @Description = @Description_9e84fff0,
  @Type = @Type_9e84fff0,
  @DefaultValue = @DefaultValue_9e84fff0,
  @IsRequired = @IsRequired_9e84fff0,
  @LinkedParameterName = @LinkedParameterName_9e84fff0,
  @LinkedParameterField = @LinkedParameterField_9e84fff0,
  @ExtraFilter = @ExtraFilter_9e84fff0,
  @EntityID = @EntityID_9e84fff0,
  @RecordID = @RecordID_9e84fff0,
  @OrderBy = @OrderBy_9e84fff0,
  @TemplateContentID = @TemplateContentID_9e84fff0,
  @ID = @ID_9e84fff0;

-- Save AI Prompts (core SP call only)
DECLARE @Name_7eb225d1 NVARCHAR(255),
@Description_7eb225d1 NVARCHAR(MAX),
@TemplateID_7eb225d1 UNIQUEIDENTIFIER,
@CategoryID_7eb225d1 UNIQUEIDENTIFIER,
@TypeID_7eb225d1 UNIQUEIDENTIFIER,
@Status_7eb225d1 NVARCHAR(50),
@ResponseFormat_7eb225d1 NVARCHAR(20),
@ModelSpecificResponseFormat_7eb225d1 NVARCHAR(MAX),
@AIModelTypeID_7eb225d1 UNIQUEIDENTIFIER,
@MinPowerRank_7eb225d1 INT,
@SelectionStrategy_7eb225d1 NVARCHAR(20),
@PowerPreference_7eb225d1 NVARCHAR(20),
@ParallelizationMode_7eb225d1 NVARCHAR(20),
@ParallelCount_7eb225d1 INT,
@ParallelConfigParam_7eb225d1 NVARCHAR(100),
@OutputType_7eb225d1 NVARCHAR(50),
@OutputExample_7eb225d1 NVARCHAR(MAX),
@ValidationBehavior_7eb225d1 NVARCHAR(50),
@MaxRetries_7eb225d1 INT,
@RetryDelayMS_7eb225d1 INT,
@RetryStrategy_7eb225d1 NVARCHAR(20),
@ResultSelectorPromptID_7eb225d1 UNIQUEIDENTIFIER,
@EnableCaching_7eb225d1 BIT,
@CacheTTLSeconds_7eb225d1 INT,
@CacheMatchType_7eb225d1 NVARCHAR(20),
@CacheSimilarityThreshold_7eb225d1 FLOAT(53),
@CacheMustMatchModel_7eb225d1 BIT,
@CacheMustMatchVendor_7eb225d1 BIT,
@CacheMustMatchAgent_7eb225d1 BIT,
@CacheMustMatchConfig_7eb225d1 BIT,
@PromptRole_7eb225d1 NVARCHAR(20),
@PromptPosition_7eb225d1 NVARCHAR(20),
@Temperature_7eb225d1 DECIMAL(3, 2),
@TopP_7eb225d1 DECIMAL(3, 2),
@TopK_7eb225d1 INT,
@MinP_7eb225d1 DECIMAL(3, 2),
@FrequencyPenalty_7eb225d1 DECIMAL(3, 2),
@PresencePenalty_7eb225d1 DECIMAL(3, 2),
@Seed_7eb225d1 INT,
@StopSequences_7eb225d1 NVARCHAR(1000),
@IncludeLogProbs_7eb225d1 BIT,
@TopLogProbs_7eb225d1 INT,
@FailoverStrategy_7eb225d1 NVARCHAR(50),
@FailoverMaxAttempts_7eb225d1 INT,
@FailoverDelaySeconds_7eb225d1 INT,
@FailoverModelStrategy_7eb225d1 NVARCHAR(50),
@FailoverErrorScope_7eb225d1 NVARCHAR(50),
@EffortLevel_7eb225d1 INT,
@ID_7eb225d1 UNIQUEIDENTIFIER
SET
  @Name_7eb225d1 = N'Entity Group Generator'
SET
  @Description_7eb225d1 = N'Analyzes database schema to generate semantically meaningful entity groupings for business query generation'
SET
  @TemplateID_7eb225d1 = '311AB35A-F04C-4B92-B917-89E23D534A4E'
SET
  @CategoryID_7eb225d1 = 'FE112721-A511-4DC3-A75A-50E5E931E940'
SET
  @TypeID_7eb225d1 = 'A6DA423E-F36B-1410-8DAC-00021F8B792E'
SET
  @Status_7eb225d1 = N'Active'
SET
  @ResponseFormat_7eb225d1 = N'JSON'
SET
  @MinPowerRank_7eb225d1 = 0
SET
  @SelectionStrategy_7eb225d1 = N'Specific'
SET
  @PowerPreference_7eb225d1 = N'Highest'
SET
  @ParallelizationMode_7eb225d1 = N'None'
SET
  @OutputType_7eb225d1 = N'object'
SET
  @OutputExample_7eb225d1 = N'{"groups":[{"entities":["Customers"],"primaryEntity":"Customers","businessDomain":"Customer Master Data","businessRationale":"Core customer information and demographics for segmentation and analysis","relationshipType":"single","expectedQuestionTypes":["segmentation","demographics"]},{"entities":["Customers","Orders"],"primaryEntity":"Customers","businessDomain":"Customer Purchasing Behavior","businessRationale":"Links customers to their purchase history for lifetime value analysis","relationshipType":"parent-child","expectedQuestionTypes":["lifetime_value","repeat_purchase"]}]}'
SET
  @ValidationBehavior_7eb225d1 = N'Strict'
SET
  @MaxRetries_7eb225d1 = 3
SET
  @RetryDelayMS_7eb225d1 = 0
SET
  @RetryStrategy_7eb225d1 = N'Fixed'
SET
  @EnableCaching_7eb225d1 = 0
SET
  @CacheMatchType_7eb225d1 = N'Exact'
SET
  @CacheMustMatchModel_7eb225d1 = 1
SET
  @CacheMustMatchVendor_7eb225d1 = 1
SET
  @CacheMustMatchAgent_7eb225d1 = 0
SET
  @CacheMustMatchConfig_7eb225d1 = 0
SET
  @PromptRole_7eb225d1 = N'User'
SET
  @PromptPosition_7eb225d1 = N'First'
SET
  @IncludeLogProbs_7eb225d1 = 0
SET
  @FailoverStrategy_7eb225d1 = N'SameModelDifferentVendor'
SET
  @FailoverMaxAttempts_7eb225d1 = 5
SET
  @FailoverDelaySeconds_7eb225d1 = 5
SET
  @FailoverModelStrategy_7eb225d1 = N'PreferSameModel'
SET
  @FailoverErrorScope_7eb225d1 = N'All'
SET
  @ID_7eb225d1 = 'D6A4AD76-747B-49C0-BEC6-FCA801D08860'
EXEC [${flyway:defaultSchema}].spUpdateAIPrompt @Name = @Name_7eb225d1,
  @Description = @Description_7eb225d1,
  @TemplateID = @TemplateID_7eb225d1,
  @CategoryID = @CategoryID_7eb225d1,
  @TypeID = @TypeID_7eb225d1,
  @Status = @Status_7eb225d1,
  @ResponseFormat = @ResponseFormat_7eb225d1,
  @ModelSpecificResponseFormat = @ModelSpecificResponseFormat_7eb225d1,
  @AIModelTypeID = @AIModelTypeID_7eb225d1,
  @MinPowerRank = @MinPowerRank_7eb225d1,
  @SelectionStrategy = @SelectionStrategy_7eb225d1,
  @PowerPreference = @PowerPreference_7eb225d1,
  @ParallelizationMode = @ParallelizationMode_7eb225d1,
  @ParallelCount = @ParallelCount_7eb225d1,
  @ParallelConfigParam = @ParallelConfigParam_7eb225d1,
  @OutputType = @OutputType_7eb225d1,
  @OutputExample = @OutputExample_7eb225d1,
  @ValidationBehavior = @ValidationBehavior_7eb225d1,
  @MaxRetries = @MaxRetries_7eb225d1,
  @RetryDelayMS = @RetryDelayMS_7eb225d1,
  @RetryStrategy = @RetryStrategy_7eb225d1,
  @ResultSelectorPromptID = @ResultSelectorPromptID_7eb225d1,
  @EnableCaching = @EnableCaching_7eb225d1,
  @CacheTTLSeconds = @CacheTTLSeconds_7eb225d1,
  @CacheMatchType = @CacheMatchType_7eb225d1,
  @CacheSimilarityThreshold = @CacheSimilarityThreshold_7eb225d1,
  @CacheMustMatchModel = @CacheMustMatchModel_7eb225d1,
  @CacheMustMatchVendor = @CacheMustMatchVendor_7eb225d1,
  @CacheMustMatchAgent = @CacheMustMatchAgent_7eb225d1,
  @CacheMustMatchConfig = @CacheMustMatchConfig_7eb225d1,
  @PromptRole = @PromptRole_7eb225d1,
  @PromptPosition = @PromptPosition_7eb225d1,
  @Temperature = @Temperature_7eb225d1,
  @TopP = @TopP_7eb225d1,
  @TopK = @TopK_7eb225d1,
  @MinP = @MinP_7eb225d1,
  @FrequencyPenalty = @FrequencyPenalty_7eb225d1,
  @PresencePenalty = @PresencePenalty_7eb225d1,
  @Seed = @Seed_7eb225d1,
  @StopSequences = @StopSequences_7eb225d1,
  @IncludeLogProbs = @IncludeLogProbs_7eb225d1,
  @TopLogProbs = @TopLogProbs_7eb225d1,
  @FailoverStrategy = @FailoverStrategy_7eb225d1,
  @FailoverMaxAttempts = @FailoverMaxAttempts_7eb225d1,
  @FailoverDelaySeconds = @FailoverDelaySeconds_7eb225d1,
  @FailoverModelStrategy = @FailoverModelStrategy_7eb225d1,
  @FailoverErrorScope = @FailoverErrorScope_7eb225d1,
  @EffortLevel = @EffortLevel_7eb225d1,
  @ID = @ID_7eb225d1;

-- Save Applications (core SP call only)
DECLARE @ID_23e9380b UNIQUEIDENTIFIER,
@Name_23e9380b NVARCHAR(100),
@Description_23e9380b NVARCHAR(MAX),
@Icon_23e9380b NVARCHAR(500),
@DefaultForNewUser_23e9380b BIT,
@SchemaAutoAddNewEntities_23e9380b NVARCHAR(MAX),
@Color_23e9380b NVARCHAR(20),
@DefaultNavItems_23e9380b NVARCHAR(MAX),
@ClassName_23e9380b NVARCHAR(255),
@DefaultSequence_23e9380b INT,
@Status_23e9380b NVARCHAR(20),
@NavigationStyle_23e9380b NVARCHAR(20),
@TopNavLocation_23e9380b NVARCHAR(30),
@HideNavBarIconWhenActive_23e9380b BIT,
@Path_23e9380b NVARCHAR(100),
@AutoUpdatePath_23e9380b BIT
SET
  @ID_23e9380b = '6B351216-A44E-4BBE-9461-FC70BE858506'
SET
  @Name_23e9380b = N'Communication'
SET
  @Description_23e9380b = N'Manage and monitor system communications, providers, and logs'
SET
  @Icon_23e9380b = N'fa-solid fa-comments'
SET
  @DefaultForNewUser_23e9380b = 0
SET
  @Color_23e9380b = N'#00bcd4'
SET
  @DefaultNavItems_23e9380b = N'[
  {
    "Label": "Monitor",
    "Icon": "fa-solid fa-chart-line",
    "ResourceType": "Custom",
    "DriverClass": "CommunicationMonitorResource",
    "isDefault": true
  },
  {
    "Label": "Logs",
    "Icon": "fa-solid fa-list-ul",
    "ResourceType": "Custom",
    "DriverClass": "CommunicationLogsResource"
  },
  {
    "Label": "Providers",
    "Icon": "fa-solid fa-server",
    "ResourceType": "Custom",
    "DriverClass": "CommunicationProvidersResource"
  },
  {
    "Label": "Runs",
    "Icon": "fa-solid fa-play",
    "ResourceType": "Custom",
    "DriverClass": "CommunicationRunsResource"
  }
]'
SET
  @DefaultSequence_23e9380b = 1004
SET
  @Status_23e9380b = N'Active'
SET
  @NavigationStyle_23e9380b = N'App Switcher'
SET
  @HideNavBarIconWhenActive_23e9380b = 0
SET
  @Path_23e9380b = N'communication'
SET
  @AutoUpdatePath_23e9380b = 1
EXEC [${flyway:defaultSchema}].spCreateApplication @ID = @ID_23e9380b,
  @Name = @Name_23e9380b,
  @Description = @Description_23e9380b,
  @Icon = @Icon_23e9380b,
  @DefaultForNewUser = @DefaultForNewUser_23e9380b,
  @SchemaAutoAddNewEntities = @SchemaAutoAddNewEntities_23e9380b,
  @Color = @Color_23e9380b,
  @DefaultNavItems = @DefaultNavItems_23e9380b,
  @ClassName = @ClassName_23e9380b,
  @DefaultSequence = @DefaultSequence_23e9380b,
  @Status = @Status_23e9380b,
  @NavigationStyle = @NavigationStyle_23e9380b,
  @TopNavLocation = @TopNavLocation_23e9380b,
  @HideNavBarIconWhenActive = @HideNavBarIconWhenActive_23e9380b,
  @Path = @Path_23e9380b,
  @AutoUpdatePath = @AutoUpdatePath_23e9380b;


-- End of SQL Logging Session
-- Session ID: 41185031-16d8-4a8c-b0d0-901562932f56
-- Completed: 2025-12-20T16:41:02.624Z
-- Duration: 46795ms
-- Total Statements: 28
