-- SQL Logging Session
-- Session ID: 702b1a82-e3b0-4acd-ae8f-835b1775a597
-- Started: 2025-08-04T06:02:48.100Z
-- Description: MetadataSync push operation
-- Format: Migration-ready with Flyway schema placeholders
-- Generated by MemberJunction SQLServerDataProvider

-- Save Action Categories (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionCategory @ID = '32CA0D54-ABCB-431F-A4A3-476C14FBC147',
@Name = N'User Management',
@Description = N'Actions related to user creation, role assignment, and permission management',
@ParentID = '15E03732-607E-4125-86F4-8C846EE88749',
@Status = N'Active';

-- Save Action Categories (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionCategory @ID = '580E3E85-CFD0-4812-AC05-30256EA89C40',
@Name = N'Security',
@Description = N'Actions related to security, authentication, and permission checking',
@ParentID = '15E03732-607E-4125-86F4-8C846EE88749',
@Status = N'Active';

-- Save Actions (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAction @ID = 'C8094D90-1194-4C81-AE0F-77E85FD54169',
@CategoryID = '580E3E85-CFD0-4812-AC05-30256EA89C40',
@Name = N'Check User Permission',
@Description = N'Verifies if the current user has a specific role or permission to perform administrative tasks',
@Type = N'Custom',
@UserPrompt = NULL,
@UserComments = NULL,
@Code = NULL,
@CodeComments = NULL,
@CodeApprovalStatus = N'Pending',
@CodeApprovalComments = NULL,
@CodeApprovedByUserID = NULL,
@CodeApprovedAt = NULL,
@CodeLocked = 0,
@ForceCodeGeneration = 0,
@RetentionPeriod = NULL,
@Status = N'Active',
@DriverClass = N'CheckUserPermissionAction',
@ParentID = NULL,
@IconClass = NULL;

-- Save Action Params (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionParam @ID = '5F7F9008-5C8B-4157-AFC8-8356B902F406',
@ActionID = 'C8094D90-1194-4C81-AE0F-77E85FD54169',
@Name = N'PermissionType',
@DefaultValue = N'Role',
@Type = N'Input',
@ValueType = N'Scalar',
@IsArray = 0,
@Description = N'Type of permission to check (Role, Authorization, or EntityPermission)',
@IsRequired = 1;

-- Save Action Params (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionParam @ID = 'A173F9B6-1F69-4B5D-864F-4A3439790274',
@ActionID = 'C8094D90-1194-4C81-AE0F-77E85FD54169',
@Name = N'PermissionName',
@DefaultValue = NULL,
@Type = N'Input',
@ValueType = N'Scalar',
@IsArray = 0,
@Description = N'Name of the role, authorization, or entity to check',
@IsRequired = 1;

-- Save Action Params (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionParam @ID = 'DD7E9132-B31E-406E-8A98-F79A08B8AE32',
@ActionID = 'C8094D90-1194-4C81-AE0F-77E85FD54169',
@Name = N'HasPermission',
@DefaultValue = NULL,
@Type = N'Output',
@ValueType = N'Scalar',
@IsArray = 0,
@Description = N'Boolean indicating if user has the specified permission',
@IsRequired = 1;

-- Save Action Params (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionParam @ID = '5D8B4D41-C66C-49F7-9861-506BFEE4F1B3',
@ActionID = 'C8094D90-1194-4C81-AE0F-77E85FD54169',
@Name = N'UserRoles',
@DefaultValue = NULL,
@Type = N'Output',
@ValueType = N'Scalar',
@IsArray = 1,
@Description = N'List of current user''s roles',
@IsRequired = 0;

-- Save Action Result Codes (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionResultCode @ID = '723A787A-AFA6-441A-B133-653BDC3A1657',
@ActionID = 'C8094D90-1194-4C81-AE0F-77E85FD54169',
@ResultCode = N'SUCCESS',
@IsSuccess = 1,
@Description = N'Permission check completed successfully';

-- Save Action Result Codes (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionResultCode @ID = 'B9DB2B28-8CE7-4ACE-90DE-75E6724BA332',
@ActionID = 'C8094D90-1194-4C81-AE0F-77E85FD54169',
@ResultCode = N'PERMISSION_DENIED',
@IsSuccess = 0,
@Description = N'User does not have the required permission';

-- Save Action Result Codes (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionResultCode @ID = 'BDF194DC-113C-43E2-BEEC-03E9D6FA7138',
@ActionID = 'C8094D90-1194-4C81-AE0F-77E85FD54169',
@ResultCode = N'INVALID_PERMISSION_TYPE',
@IsSuccess = 0,
@Description = N'Invalid permission type specified';

-- Save Actions (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAction @ID = '4A57DE26-16DB-47A4-82AB-DFC74B3152FA',
@CategoryID = '32CA0D54-ABCB-431F-A4A3-476C14FBC147',
@Name = N'Create User',
@Description = N'Creates a new user in the MemberJunction system with validation and optional employee linking',
@Type = N'Custom',
@UserPrompt = NULL,
@UserComments = NULL,
@Code = NULL,
@CodeComments = NULL,
@CodeApprovalStatus = N'Pending',
@CodeApprovalComments = NULL,
@CodeApprovedByUserID = NULL,
@CodeApprovedAt = NULL,
@CodeLocked = 0,
@ForceCodeGeneration = 0,
@RetentionPeriod = NULL,
@Status = N'Active',
@DriverClass = N'CreateUserAction',
@ParentID = '2504E288-ADF7-4913-A627-AA14276BAA55',
@IconClass = NULL;

-- Save Action Params (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionParam @ID = '47570E42-3076-43E7-A0A6-8F77B407193C',
@ActionID = '4A57DE26-16DB-47A4-82AB-DFC74B3152FA',
@Name = N'FirstName',
@DefaultValue = NULL,
@Type = N'Input',
@ValueType = N'Scalar',
@IsArray = 0,
@Description = N'User''s first name',
@IsRequired = 1;

-- Save Action Params (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionParam @ID = 'F64CD9EA-27B2-4463-9088-6A99AA75B0BB',
@ActionID = '4A57DE26-16DB-47A4-82AB-DFC74B3152FA',
@Name = N'LastName',
@DefaultValue = NULL,
@Type = N'Input',
@ValueType = N'Scalar',
@IsArray = 0,
@Description = N'User''s last name',
@IsRequired = 1;

-- Save Action Params (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionParam @ID = '4A84CB4D-D0DD-4C3C-8CB2-55583C19DE2B',
@ActionID = '4A57DE26-16DB-47A4-82AB-DFC74B3152FA',
@Name = N'Email',
@DefaultValue = NULL,
@Type = N'Input',
@ValueType = N'Scalar',
@IsArray = 0,
@Description = N'User''s email address (must be unique)',
@IsRequired = 1;

-- Save Action Params (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionParam @ID = '87F5A4A3-0AA2-41EF-97AA-5B540FD85795',
@ActionID = '4A57DE26-16DB-47A4-82AB-DFC74B3152FA',
@Name = N'Title',
@DefaultValue = NULL,
@Type = N'Input',
@ValueType = N'Scalar',
@IsArray = 0,
@Description = N'User''s professional title',
@IsRequired = 0;

-- Save Action Params (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionParam @ID = 'C6F62A88-0388-4D27-91A1-2AB3A3A9749A',
@ActionID = '4A57DE26-16DB-47A4-82AB-DFC74B3152FA',
@Name = N'Type',
@DefaultValue = N'User',
@Type = N'Input',
@ValueType = N'Scalar',
@IsArray = 0,
@Description = N'User type (User or Owner)',
@IsRequired = 0;

-- Save Action Params (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionParam @ID = 'BB0071AB-EA49-48F2-BFDE-A45E7A735006',
@ActionID = '4A57DE26-16DB-47A4-82AB-DFC74B3152FA',
@Name = N'IsActive',
@DefaultValue = N'true',
@Type = N'Input',
@ValueType = N'Scalar',
@IsArray = 0,
@Description = N'Whether the user account should be active',
@IsRequired = 0;

-- Save Action Params (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionParam @ID = '5A437DF5-DD22-47EC-ADB8-010AA6E2AA6F',
@ActionID = '4A57DE26-16DB-47A4-82AB-DFC74B3152FA',
@Name = N'EmployeeID',
@DefaultValue = NULL,
@Type = N'Input',
@ValueType = N'Scalar',
@IsArray = 0,
@Description = N'Optional ID of linked employee record',
@IsRequired = 0;

-- Save Action Params (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionParam @ID = '7BE32625-CEBA-414A-8A9A-8496620F45AC',
@ActionID = '4A57DE26-16DB-47A4-82AB-DFC74B3152FA',
@Name = N'UserID',
@DefaultValue = NULL,
@Type = N'Output',
@ValueType = N'Scalar',
@IsArray = 0,
@Description = N'ID of the created user',
@IsRequired = 1;

-- Save Action Params (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionParam @ID = 'A63A0740-02F7-471B-92AB-B4CBB28EE26D',
@ActionID = '4A57DE26-16DB-47A4-82AB-DFC74B3152FA',
@Name = N'Name',
@DefaultValue = NULL,
@Type = N'Output',
@ValueType = N'Scalar',
@IsArray = 0,
@Description = N'Display name of the created user',
@IsRequired = 1;

-- Save Action Result Codes (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionResultCode @ID = 'DC8413FE-3A3A-4979-9C71-DC3E87224810',
@ActionID = '4A57DE26-16DB-47A4-82AB-DFC74B3152FA',
@ResultCode = N'SUCCESS',
@IsSuccess = 1,
@Description = N'User created successfully';

-- Save Action Result Codes (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionResultCode @ID = '99A8CB36-196C-42E6-9AC9-9D657CECF5C9',
@ActionID = '4A57DE26-16DB-47A4-82AB-DFC74B3152FA',
@ResultCode = N'EMAIL_EXISTS',
@IsSuccess = 0,
@Description = N'Email address already exists in the system';

-- Save Action Result Codes (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionResultCode @ID = 'D63BB773-A239-41A2-ABBB-4518BCBC76D1',
@ActionID = '4A57DE26-16DB-47A4-82AB-DFC74B3152FA',
@ResultCode = N'INVALID_EMPLOYEE',
@IsSuccess = 0,
@Description = N'Specified employee ID does not exist';

-- Save Action Result Codes (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionResultCode @ID = 'D2F4A583-DDEA-48C1-9DD4-9A838FEF11E1',
@ActionID = '4A57DE26-16DB-47A4-82AB-DFC74B3152FA',
@ResultCode = N'VALIDATION_ERROR',
@IsSuccess = 0,
@Description = N'Input validation failed';

-- Save Actions (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAction @ID = 'CC9C1E62-8AB9-4A46-886D-66F6B4295982',
@CategoryID = '32CA0D54-ABCB-431F-A4A3-476C14FBC147',
@Name = N'Create Employee',
@Description = N'Creates a new employee record in the MemberJunction system',
@Type = N'Custom',
@UserPrompt = NULL,
@UserComments = NULL,
@Code = NULL,
@CodeComments = NULL,
@CodeApprovalStatus = N'Pending',
@CodeApprovalComments = NULL,
@CodeApprovedByUserID = NULL,
@CodeApprovedAt = NULL,
@CodeLocked = 0,
@ForceCodeGeneration = 0,
@RetentionPeriod = NULL,
@Status = N'Active',
@DriverClass = N'CreateEmployeeAction',
@ParentID = '2504E288-ADF7-4913-A627-AA14276BAA55',
@IconClass = NULL;

-- Save Action Params (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionParam @ID = '9F6498E3-53DB-42A6-9BEA-4FD71C72AEAD',
@ActionID = 'CC9C1E62-8AB9-4A46-886D-66F6B4295982',
@Name = N'FirstName',
@DefaultValue = NULL,
@Type = N'Input',
@ValueType = N'Scalar',
@IsArray = 0,
@Description = N'Employee''s first name',
@IsRequired = 1;

-- Save Action Params (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionParam @ID = 'AF7DF8D7-1968-41C8-96E8-6DEC8A6B6790',
@ActionID = 'CC9C1E62-8AB9-4A46-886D-66F6B4295982',
@Name = N'LastName',
@DefaultValue = NULL,
@Type = N'Input',
@ValueType = N'Scalar',
@IsArray = 0,
@Description = N'Employee''s last name',
@IsRequired = 1;

-- Save Action Params (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionParam @ID = 'EA01F918-0B66-417A-AA84-FC791982A2F6',
@ActionID = 'CC9C1E62-8AB9-4A46-886D-66F6B4295982',
@Name = N'Email',
@DefaultValue = NULL,
@Type = N'Input',
@ValueType = N'Scalar',
@IsArray = 0,
@Description = N'Employee''s email address (must be unique)',
@IsRequired = 1;

-- Save Action Params (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionParam @ID = '5C672151-4B4A-42FD-BD3C-BF7727D23567',
@ActionID = 'CC9C1E62-8AB9-4A46-886D-66F6B4295982',
@Name = N'Title',
@DefaultValue = NULL,
@Type = N'Input',
@ValueType = N'Scalar',
@IsArray = 0,
@Description = N'Employee''s job title',
@IsRequired = 0;

-- Save Action Params (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionParam @ID = 'F9462D49-E1C1-4E55-862A-9394B09CC39D',
@ActionID = 'CC9C1E62-8AB9-4A46-886D-66F6B4295982',
@Name = N'Phone',
@DefaultValue = NULL,
@Type = N'Input',
@ValueType = N'Scalar',
@IsArray = 0,
@Description = N'Employee''s phone number',
@IsRequired = 0;

-- Save Action Params (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionParam @ID = '298BF25B-312B-48E9-803D-5258DFE46394',
@ActionID = 'CC9C1E62-8AB9-4A46-886D-66F6B4295982',
@Name = N'CompanyID',
@DefaultValue = NULL,
@Type = N'Input',
@ValueType = N'Scalar',
@IsArray = 0,
@Description = N'ID of the company the employee belongs to',
@IsRequired = 1;

-- Save Action Params (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionParam @ID = '47D96BB6-C561-4D3D-96CA-E8FCEFD6569F',
@ActionID = 'CC9C1E62-8AB9-4A46-886D-66F6B4295982',
@Name = N'SupervisorID',
@DefaultValue = NULL,
@Type = N'Input',
@ValueType = N'Scalar',
@IsArray = 0,
@Description = N'ID of the employee''s supervisor',
@IsRequired = 0;

-- Save Action Params (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionParam @ID = 'DB10B67C-ED6B-4CEE-8535-81B48AE4E3D7',
@ActionID = 'CC9C1E62-8AB9-4A46-886D-66F6B4295982',
@Name = N'Active',
@DefaultValue = N'true',
@Type = N'Input',
@ValueType = N'Scalar',
@IsArray = 0,
@Description = N'Whether the employee is active',
@IsRequired = 0;

-- Save Action Params (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionParam @ID = '8CDBA16E-42F6-4DA5-B42A-76866F6637D1',
@ActionID = 'CC9C1E62-8AB9-4A46-886D-66F6B4295982',
@Name = N'EmployeeID',
@DefaultValue = NULL,
@Type = N'Output',
@ValueType = N'Scalar',
@IsArray = 0,
@Description = N'ID of the created employee',
@IsRequired = 1;

-- Save Action Result Codes (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionResultCode @ID = 'AAC6F5BD-9408-42D3-872E-25A818D847D0',
@ActionID = 'CC9C1E62-8AB9-4A46-886D-66F6B4295982',
@ResultCode = N'SUCCESS',
@IsSuccess = 1,
@Description = N'Employee created successfully';

-- Save Action Result Codes (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionResultCode @ID = '1F6D5FCC-50C6-431A-B46F-2307FF20247D',
@ActionID = 'CC9C1E62-8AB9-4A46-886D-66F6B4295982',
@ResultCode = N'EMAIL_EXISTS',
@IsSuccess = 0,
@Description = N'Email address already exists for another employee';

-- Save Action Result Codes (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionResultCode @ID = '6EEF5C95-3F08-484C-850C-12A88546C2C6',
@ActionID = 'CC9C1E62-8AB9-4A46-886D-66F6B4295982',
@ResultCode = N'INVALID_COMPANY',
@IsSuccess = 0,
@Description = N'Specified company ID does not exist';

-- Save Action Result Codes (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionResultCode @ID = 'ED781DCB-4BB6-49F2-9A5B-42BCBC4D21BE',
@ActionID = 'CC9C1E62-8AB9-4A46-886D-66F6B4295982',
@ResultCode = N'INVALID_SUPERVISOR',
@IsSuccess = 0,
@Description = N'Specified supervisor ID does not exist';

-- Save Actions (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAction @ID = '873F5441-D1A9-497B-AE32-F9D1A23843C6',
@CategoryID = '32CA0D54-ABCB-431F-A4A3-476C14FBC147',
@Name = N'Assign User Roles',
@Description = N'Assigns one or more roles to a user by creating UserRole associations. Accepts either a single role name (RoleName) or an array of role names (RoleNames).',
@Type = N'Custom',
@UserPrompt = NULL,
@UserComments = NULL,
@Code = NULL,
@CodeComments = NULL,
@CodeApprovalStatus = N'Pending',
@CodeApprovalComments = NULL,
@CodeApprovedByUserID = NULL,
@CodeApprovedAt = NULL,
@CodeLocked = 0,
@ForceCodeGeneration = 0,
@RetentionPeriod = NULL,
@Status = N'Active',
@DriverClass = N'AssignUserRolesAction',
@ParentID = '2504E288-ADF7-4913-A627-AA14276BAA55',
@IconClass = NULL;

-- Save Action Params (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionParam @ID = '42A2303C-17AE-4F92-B0CA-67C617DA465C',
@ActionID = '873F5441-D1A9-497B-AE32-F9D1A23843C6',
@Name = N'UserID',
@DefaultValue = NULL,
@Type = N'Input',
@ValueType = N'Scalar',
@IsArray = 0,
@Description = N'The ID of the user to assign roles to',
@IsRequired = 1;

-- Save Action Params (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionParam @ID = 'BF96AF8E-2EC1-4016-85CC-418C0DFE6E7F',
@ActionID = '873F5441-D1A9-497B-AE32-F9D1A23843C6',
@Name = N'RoleNames',
@DefaultValue = NULL,
@Type = N'Input',
@ValueType = N'Scalar',
@IsArray = 1,
@Description = N'Array of role names to assign to the user',
@IsRequired = 0;

-- Save Action Params (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionParam @ID = '91281FA4-95D9-4A38-8C5E-32A1ECFE94E8',
@ActionID = '873F5441-D1A9-497B-AE32-F9D1A23843C6',
@Name = N'RoleName',
@DefaultValue = NULL,
@Type = N'Input',
@ValueType = N'Scalar',
@IsArray = 0,
@Description = N'Single role name to assign to the user (alternative to RoleNames)',
@IsRequired = 0;

-- Save Action Params (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionParam @ID = '8093868D-9FC6-4062-8D03-5064D52DC10B',
@ActionID = '873F5441-D1A9-497B-AE32-F9D1A23843C6',
@Name = N'AssignedRoleIDs',
@DefaultValue = NULL,
@Type = N'Output',
@ValueType = N'Scalar',
@IsArray = 1,
@Description = N'Array of role IDs that were assigned',
@IsRequired = 0;

-- Save Action Params (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionParam @ID = '18ED664F-BC6C-4829-93A2-53540CFDA122',
@ActionID = '873F5441-D1A9-497B-AE32-F9D1A23843C6',
@Name = N'AssignedUserRoleIDs',
@DefaultValue = NULL,
@Type = N'Output',
@ValueType = N'Scalar',
@IsArray = 1,
@Description = N'Array of UserRole record IDs created',
@IsRequired = 0;

-- Save Action Params (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionParam @ID = '27733050-FFB4-47E6-AE6F-5C6AE7AA6059',
@ActionID = '873F5441-D1A9-497B-AE32-F9D1A23843C6',
@Name = N'AssignedRoleNames',
@DefaultValue = NULL,
@Type = N'Output',
@ValueType = N'Scalar',
@IsArray = 1,
@Description = N'Array of role names that were assigned',
@IsRequired = 0;

-- Save Action Params (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionParam @ID = 'D9C8F1EA-82DE-4924-90BF-7F035CE3EDBB',
@ActionID = '873F5441-D1A9-497B-AE32-F9D1A23843C6',
@Name = N'AssignedCount',
@DefaultValue = NULL,
@Type = N'Output',
@ValueType = N'Scalar',
@IsArray = 0,
@Description = N'Number of roles successfully assigned',
@IsRequired = 0;

-- Save Action Result Codes (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionResultCode @ID = '5B0A489A-A919-4395-9014-E86D5CDBB76F',
@ActionID = '873F5441-D1A9-497B-AE32-F9D1A23843C6',
@ResultCode = N'SUCCESS',
@IsSuccess = 1,
@Description = N'All roles assigned successfully';

-- Save Action Result Codes (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionResultCode @ID = 'BCE865A9-0CA6-4713-8017-77F0A87F5D79',
@ActionID = '873F5441-D1A9-497B-AE32-F9D1A23843C6',
@ResultCode = N'PARTIAL_SUCCESS',
@IsSuccess = 1,
@Description = N'Some roles were assigned, others skipped or failed';

-- Save Action Result Codes (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionResultCode @ID = '80A31E58-974E-4B5C-A78C-F3767AF71322',
@ActionID = '873F5441-D1A9-497B-AE32-F9D1A23843C6',
@ResultCode = N'USER_NOT_FOUND',
@IsSuccess = 0,
@Description = N'Specified user ID does not exist';

-- Save Action Result Codes (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionResultCode @ID = '9E97C597-9EA3-45AC-B843-A4BFEC01B8E3',
@ActionID = '873F5441-D1A9-497B-AE32-F9D1A23843C6',
@ResultCode = N'ROLES_NOT_FOUND',
@IsSuccess = 0,
@Description = N'One or more specified role names do not exist';

-- Save Action Result Codes (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionResultCode @ID = '2054B0FE-8B02-4EAF-9380-D889505F8CF9',
@ActionID = '873F5441-D1A9-497B-AE32-F9D1A23843C6',
@ResultCode = N'VALIDATION_ERROR',
@IsSuccess = 0,
@Description = N'Input validation failed';

-- Save Actions (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAction @ID = '3A28C11B-EBE3-4F6F-B279-F1BA6D0C1912',
@CategoryID = '65E048AA-5220-4E4D-920A-A3D9349902A7',
@Name = N'Send Welcome Email',
@Description = N'Sends a welcome email to a newly created user with login instructions',
@Type = N'Custom',
@UserPrompt = NULL,
@UserComments = NULL,
@Code = NULL,
@CodeComments = NULL,
@CodeApprovalStatus = N'Pending',
@CodeApprovalComments = NULL,
@CodeApprovedByUserID = NULL,
@CodeApprovedAt = NULL,
@CodeLocked = 0,
@ForceCodeGeneration = 0,
@RetentionPeriod = NULL,
@Status = N'Active',
@DriverClass = N'SendWelcomeEmailAction',
@ParentID = NULL,
@IconClass = NULL;

-- Save Action Params (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionParam @ID = '73ABD08E-4F33-4066-96B7-39F50A932310',
@ActionID = '3A28C11B-EBE3-4F6F-B279-F1BA6D0C1912',
@Name = N'UserID',
@DefaultValue = NULL,
@Type = N'Input',
@ValueType = N'Scalar',
@IsArray = 0,
@Description = N'ID of the user to send the email to',
@IsRequired = 1;

-- Save Action Params (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionParam @ID = '75F6D61C-FA95-4632-9285-B919FCCBA057',
@ActionID = '3A28C11B-EBE3-4F6F-B279-F1BA6D0C1912',
@Name = N'TemporaryPassword',
@DefaultValue = NULL,
@Type = N'Input',
@ValueType = N'Scalar',
@IsArray = 0,
@Description = N'Temporary password for first login',
@IsRequired = 0;

-- Save Action Params (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionParam @ID = '2182CE07-CC20-49C5-B09B-327FEA31BC7C',
@ActionID = '3A28C11B-EBE3-4F6F-B279-F1BA6D0C1912',
@Name = N'LoginURL',
@DefaultValue = N'https://app.memberjunction.com',
@Type = N'Input',
@ValueType = N'Scalar',
@IsArray = 0,
@Description = N'URL for the user to login',
@IsRequired = 0;

-- Save Action Params (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionParam @ID = 'A44EC271-9913-4C08-99E6-B2CFB80FA80B',
@ActionID = '3A28C11B-EBE3-4F6F-B279-F1BA6D0C1912',
@Name = N'EmailSent',
@DefaultValue = NULL,
@Type = N'Output',
@ValueType = N'Scalar',
@IsArray = 0,
@Description = N'Boolean indicating if email was sent successfully',
@IsRequired = 1;

-- Save Action Params (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionParam @ID = 'D11ED469-EB21-4009-AE55-4DB093CEA4BD',
@ActionID = '3A28C11B-EBE3-4F6F-B279-F1BA6D0C1912',
@Name = N'MessageID',
@DefaultValue = NULL,
@Type = N'Output',
@ValueType = N'Scalar',
@IsArray = 0,
@Description = N'ID of the sent email message',
@IsRequired = 0;

-- Save Action Result Codes (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionResultCode @ID = 'E2CA66C3-3D06-42E8-A190-2481253C255D',
@ActionID = '3A28C11B-EBE3-4F6F-B279-F1BA6D0C1912',
@ResultCode = N'SUCCESS',
@IsSuccess = 1,
@Description = N'Welcome email sent successfully';

-- Save Action Result Codes (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionResultCode @ID = '2073C74C-DA23-44CE-967F-8FE76B52106C',
@ActionID = '3A28C11B-EBE3-4F6F-B279-F1BA6D0C1912',
@ResultCode = N'USER_NOT_FOUND',
@IsSuccess = 0,
@Description = N'Specified user ID does not exist';

-- Save Action Result Codes (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionResultCode @ID = '6BAEE59F-61A4-489A-84E1-895A2A05D4D1',
@ActionID = '3A28C11B-EBE3-4F6F-B279-F1BA6D0C1912',
@ResultCode = N'NO_EMAIL',
@IsSuccess = 0,
@Description = N'User does not have an email address';

-- Save Action Result Codes (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionResultCode @ID = '04489440-2384-47E1-8C44-E0CF55FBBED8',
@ActionID = '3A28C11B-EBE3-4F6F-B279-F1BA6D0C1912',
@ResultCode = N'EMAIL_PROVIDER_ERROR',
@IsSuccess = 0,
@Description = N'Email provider returned an error';

-- Save Actions (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAction @ID = '540BFDE1-02B5-432C-9490-BD34AF853FE8',
@CategoryID = '32CA0D54-ABCB-431F-A4A3-476C14FBC147',
@Name = N'Validate Email Unique',
@Description = N'Validates that an email address is not already in use by another user in the system',
@Type = N'Custom',
@UserPrompt = NULL,
@UserComments = NULL,
@Code = NULL,
@CodeComments = NULL,
@CodeApprovalStatus = N'Pending',
@CodeApprovalComments = NULL,
@CodeApprovedByUserID = NULL,
@CodeApprovedAt = NULL,
@CodeLocked = 0,
@ForceCodeGeneration = 0,
@RetentionPeriod = NULL,
@Status = N'Active',
@DriverClass = N'ValidateEmailUniqueAction',
@ParentID = NULL,
@IconClass = NULL;

-- Save Action Params (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionParam @ID = 'B53CFBF3-0AC2-4302-B950-8C24EACAF73C',
@ActionID = '540BFDE1-02B5-432C-9490-BD34AF853FE8',
@Name = N'Email',
@DefaultValue = NULL,
@Type = N'Input',
@ValueType = N'Scalar',
@IsArray = 0,
@Description = N'Email address to validate',
@IsRequired = 1;

-- Save Action Params (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionParam @ID = '7DA96F6A-FB6F-4F26-9383-F25FD63C7ACB',
@ActionID = '540BFDE1-02B5-432C-9490-BD34AF853FE8',
@Name = N'IsUnique',
@DefaultValue = NULL,
@Type = N'Output',
@ValueType = N'Scalar',
@IsArray = 0,
@Description = N'Boolean indicating if email is unique',
@IsRequired = 1;

-- Save Action Params (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionParam @ID = '563E51B9-0C29-4A93-80F8-A82C485F610E',
@ActionID = '540BFDE1-02B5-432C-9490-BD34AF853FE8',
@Name = N'ExistingUserID',
@DefaultValue = NULL,
@Type = N'Output',
@ValueType = N'Scalar',
@IsArray = 0,
@Description = N'ID of existing user if email is not unique',
@IsRequired = 0;

-- Save Action Params (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionParam @ID = 'BF6189DE-AAF8-43DD-9A0C-0DE2FA53E073',
@ActionID = '540BFDE1-02B5-432C-9490-BD34AF853FE8',
@Name = N'ExistingUserName',
@DefaultValue = NULL,
@Type = N'Output',
@ValueType = N'Scalar',
@IsArray = 0,
@Description = N'Name of existing user if email is not unique',
@IsRequired = 0;

-- Save Action Result Codes (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionResultCode @ID = '6FCCF724-192F-4AFF-BC6C-919FE9E99D42',
@ActionID = '540BFDE1-02B5-432C-9490-BD34AF853FE8',
@ResultCode = N'SUCCESS',
@IsSuccess = 1,
@Description = N'Email validation completed';

-- Save Action Result Codes (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateActionResultCode @ID = '6623C659-731B-4910-9C85-CDEB2F13E440',
@ActionID = '540BFDE1-02B5-432C-9490-BD34AF853FE8',
@ResultCode = N'INVALID_EMAIL_FORMAT',
@IsSuccess = 0,
@Description = N'Email address format is invalid';

-- Save AI Prompt Categories (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAIPromptCategory @ID = '94423b4d-bc7d-4ed6-9510-ec0e346da597',
@Name = N'User Onboarding Agents',
@ParentID = NULL,
@Description = N'Prompts for User Onboarding Agent System';

-- Save Templates (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateTemplate @ID = 'c9e7c6e9-4750-46f4-a20f-8075add17e45',
@Name = N'User Onboarding Flow Agent - System Prompt',
@Description = N'Template for AI Prompt: User Onboarding Flow Agent - System Prompt',
@CategoryID = 'B09D433E-F36B-1410-8DB1-00021F8B792E',
@UserPrompt = NULL,
@UserID = 'ECAFCCEC-6A37-EF11-86D4-000D3A4E707E',
@ActiveAt = NULL,
@DisabledAt = NULL,
@IsActive = 1;

-- Save Template Contents (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateTemplateContent @ID = 'd1665705-7a5f-486c-bf57-ec1b4144cd7a',
@TemplateID = 'C9E7C6E9-4750-46F4-A20F-8075ADD17E45',
@TypeID = 'E7AFCCEC-6A37-EF11-86D4-000D3A4E707E',
@TemplateText = N'# User Onboarding Flow Agent

You are the User Onboarding Flow Agent, responsible for creating new users in the MemberJunction system through a structured, deterministic workflow.

## Your Purpose
{{ agentDescription }}

## Available Steps and Actions

Your workflow follows these deterministic steps:

1. **Check Admin Permissions** - Verify the current user has administrative privileges
2. **Collect User Information** - Gather required details for the new user
3. **Validate User Data** - Ensure email uniqueness and data completeness  
4. **Create Employee Record** (optional) - Create employee record if requested
5. **Create User Record** - Create the main user entity
6. **Assign Roles** - Assign appropriate roles to the new user
7. **Set Permissions** - Configure entity access based on roles
8. **Send Welcome Email** - Send onboarding email to the new user

### Available Actions: ({{ actionCount }})
{{ actionDetails }}

## Workflow Rules

1. **Permission Check First**: Always verify admin permissions before proceeding
2. **Data Collection**: Collect all required user information upfront:
   - First Name (required)
   - Last Name (required)
   - Email (required, must be unique)
   - Title (optional)
   - User Type (User or Owner, default: User)
   - Company (required if creating employee)
   - Roles to assign (at least one required)
   
3. **Employee Creation**: Only create employee record if explicitly requested or if user type indicates employee status
4. **Role Assignment**: At least one role must be assigned to every new user
5. **Error Handling**: If any step fails, provide clear error messages and do not proceed to subsequent steps

## Decision Points

At the "Collect User Information" step, you will use AI to interact with the admin user to gather all necessary information. Use the following prompts:

- Ask for basic user information (name, email, title)
- Confirm if this is an employee user
- If employee, ask for company and supervisor information
- Ask which roles should be assigned (show available roles)
- Confirm all information before proceeding

## Success Criteria

A successful user onboarding includes:
- Valid admin permissions confirmed
- Unique email address verified
- User record created with all required fields
- At least one role assigned
- Welcome email sent successfully

## Error Messages

Provide clear, actionable error messages:
- "Permission Denied: You need admin privileges to create users"
- "Email Already Exists: This email is already registered in the system"
- "Invalid Company: The specified company does not exist"
- "Role Not Found: The specified role name is not valid"

## Response Format
{{ _OUTPUT_EXAMPLE }}',
@Priority = 1,
@IsActive = 1;

-- Save Template Params (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateTemplateParam @ID = '76a9533d-a5e6-4533-b003-cc508a357d25',
@TemplateID = 'C9E7C6E9-4750-46F4-A20F-8075ADD17E45',
@Name = N'agentDescription',
@Description = N'Description of the User Onboarding Flow Agent''s purpose',
@Type = N'Scalar',
@DefaultValue = NULL,
@IsRequired = 0,
@LinkedParameterName = NULL,
@LinkedParameterField = NULL,
@ExtraFilter = NULL,
@EntityID = NULL,
@RecordID = NULL,
@OrderBy = NULL,
@TemplateContentID = NULL;

-- Save Template Params (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateTemplateParam @ID = 'cc5eb2a3-1ba1-468e-ad38-4eea29fb0f96',
@TemplateID = 'C9E7C6E9-4750-46F4-A20F-8075ADD17E45',
@Name = N'actionCount',
@Description = N'Count of available actions in the workflow',
@Type = N'Scalar',
@DefaultValue = NULL,
@IsRequired = 0,
@LinkedParameterName = NULL,
@LinkedParameterField = NULL,
@ExtraFilter = NULL,
@EntityID = NULL,
@RecordID = NULL,
@OrderBy = NULL,
@TemplateContentID = NULL;

-- Save Template Params (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateTemplateParam @ID = '16e629e8-6348-4062-af15-c312e7b2cac3',
@TemplateID = 'C9E7C6E9-4750-46F4-A20F-8075ADD17E45',
@Name = N'actionDetails',
@Description = N'Detailed list of available actions in the onboarding workflow',
@Type = N'Scalar',
@DefaultValue = NULL,
@IsRequired = 0,
@LinkedParameterName = NULL,
@LinkedParameterField = NULL,
@ExtraFilter = NULL,
@EntityID = NULL,
@RecordID = NULL,
@OrderBy = NULL,
@TemplateContentID = NULL;

-- Save AI Prompts (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAIPrompt @ID = '7D231A18-11CB-48E2-881F-6CC12DD9CD2D',
@Name = N'User Onboarding Flow Agent - System Prompt',
@Description = N'System prompt for the User Onboarding Flow Agent that manages the deterministic workflow for creating new users',
@TemplateID = 'C9E7C6E9-4750-46F4-A20F-8075ADD17E45',
@CategoryID = '94423B4D-BC7D-4ED6-9510-EC0E346DA597',
@TypeID = 'A6DA423E-F36B-1410-8DAC-00021F8B792E',
@Status = N'Active',
@ResponseFormat = N'JSON',
@ModelSpecificResponseFormat = NULL,
@AIModelTypeID = NULL,
@MinPowerRank = 0,
@SelectionStrategy = N'Default',
@PowerPreference = N'Highest',
@ParallelizationMode = N'None',
@ParallelCount = NULL,
@ParallelConfigParam = NULL,
@OutputType = N'string',
@OutputExample = N'{
  "currentStep": "Collect User Information",
  "status": "in_progress",
  "message": "Collecting user information from administrator",
  "payload": {
    "hasAdminPermission": true,
    "currentUserRoles": ["Administrator", "User"],
    "userData": {
      "firstName": "John",
      "lastName": "Doe",
      "email": "john.doe@example.com",
      "title": "Senior Developer",
      "type": "User",
      "isEmployee": true,
      "employeeData": {
        "companyID": "123e4567-e89b-12d3-a456-426614174000",
        "supervisorID": "987f6543-e21b-12d3-a456-426614174000",
        "phone": "+1-555-123-4567"
      },
      "roles": ["Developer", "User"]
    },
    "emailIsUnique": true,
    "createdEmployeeID": "456e7890-e89b-12d3-a456-426614174000",
    "createdUserID": "789a1234-e89b-12d3-a456-426614174000",
    "createdUserName": "John Doe",
    "welcomeEmailSent": true,
    "emailMessageID": "msg_abc123def456"
  },
  "completedSteps": [
    "Check Admin Permissions",
    "Collect User Information",
    "Validate User Data",
    "Create Employee Record",
    "Create User Record",
    "Assign User Roles",
    "Send Welcome Email"
  ],
  "errors": []
}',
@ValidationBehavior = N'Warn',
@MaxRetries = 0,
@RetryDelayMS = 0,
@RetryStrategy = N'Fixed',
@ResultSelectorPromptID = NULL,
@EnableCaching = 0,
@CacheTTLSeconds = NULL,
@CacheMatchType = N'Exact',
@CacheSimilarityThreshold = NULL,
@CacheMustMatchModel = 1,
@CacheMustMatchVendor = 1,
@CacheMustMatchAgent = 0,
@CacheMustMatchConfig = 0,
@PromptRole = N'System',
@PromptPosition = N'First',
@Temperature = NULL,
@TopP = NULL,
@TopK = NULL,
@MinP = NULL,
@FrequencyPenalty = NULL,
@PresencePenalty = NULL,
@Seed = NULL,
@StopSequences = NULL,
@IncludeLogProbs = 0,
@TopLogProbs = NULL,
@FailoverStrategy = N'SameModelDifferentVendor',
@FailoverMaxAttempts = 3,
@FailoverDelaySeconds = 5,
@FailoverModelStrategy = N'PreferSameModel',
@FailoverErrorScope = N'All';

-- Save Templates (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateTemplate @ID = '462b4d79-3584-4225-a684-3f1858e3aaa0',
@Name = N'Collect User Information - Prompt Step',
@Description = N'Template for AI Prompt: Collect User Information - Prompt Step',
@CategoryID = 'B09D433E-F36B-1410-8DB1-00021F8B792E',
@UserPrompt = NULL,
@UserID = 'ECAFCCEC-6A37-EF11-86D4-000D3A4E707E',
@ActiveAt = NULL,
@DisabledAt = NULL,
@IsActive = 1;

-- Save Template Contents (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateTemplateContent @ID = '9cf1458f-361e-41c3-838c-35394cf6d62b',
@TemplateID = '462B4D79-3584-4225-A684-3F1858E3AAA0',
@TypeID = 'E7AFCCEC-6A37-EF11-86D4-000D3A4E707E',
@TemplateText = N'# Collect User Information Prompt

**CRITICAL**: You MUST respond with ONLY valid JSON. No conversational text, no explanations, no markdown formatting - ONLY the JSON object specified below.

You are processing a user creation request. Extract the required information from the administrator''s message and return it in the exact JSON format specified.

## Information to Extract

### Required Information:
1. **firstName** - The user''s first name
2. **lastName** - The user''s last name  
3. **email** - Must be unique in the system
4. **roles** - Extract role assignments (default to ["User"] if only "UI role" mentioned)

### Optional Information:
1. **title** - Job title or position
2. **type** - "User" (default) or "Owner"
3. **isEmployee** - Set to true if employee information provided

## Role Mapping
- "UI role" or "UI" → "UI"
- "Admin role" → "Administrator"
- "Developer role" or "Developer" → "Developer"
- "Integration role" → "Integration"
- If no specific role mentioned, default to ["UI"]

## REQUIRED OUTPUT FORMAT

You MUST return ONLY this JSON structure with NO additional text:

{
  "userData": {
    "firstName": "string",
    "lastName": "string", 
    "email": "string",
    "title": "string (optional)",
    "type": "User",
    "isEmployee": false,
    "employeeData": {
      "companyID": null,
      "supervisorID": null,
      "phone": null
    },
    "roles": ["UI"]
  },
  "confirmed": true
}

## Example
If the admin says: "Can you add a new user with the name ''Jordan Fanapour'' with the email address ''jjfanapour@gmail.com''. Assign them a UI role only."

You MUST respond with EXACTLY:
{
  "userData": {
    "firstName": "Jordan",
    "lastName": "Fanapour", 
    "email": "jjfanapour@gmail.com",
    "title": null,
    "type": "User",
    "isEmployee": false,
    "employeeData": {
      "companyID": null,
      "supervisorID": null,
      "phone": null
    },
    "roles": ["UI"]
  },
  "confirmed": true
}

Remember: Return ONLY the JSON object. No other text whatsoever.',
@Priority = 1,
@IsActive = 1;

-- Save Template Params (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateTemplateParam @ID = '4ed4cf50-4128-4c9f-aa08-05a00526a640',
@TemplateID = '462B4D79-3584-4225-A684-3F1858E3AAA0',
@Name = N'userData',
@Description = N'User creation data including name, email, and role information',
@Type = N'Object',
@DefaultValue = NULL,
@IsRequired = 0,
@LinkedParameterName = NULL,
@LinkedParameterField = NULL,
@ExtraFilter = NULL,
@EntityID = NULL,
@RecordID = NULL,
@OrderBy = NULL,
@TemplateContentID = NULL;

-- Save Template Params (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateTemplateParam @ID = '2c335b48-5a4b-4bb2-9a6b-d3f0b9dda2f6',
@TemplateID = '462B4D79-3584-4225-A684-3F1858E3AAA0',
@Name = N'confirmed',
@Description = N'Confirmation flag for the user creation request',
@Type = N'Scalar',
@DefaultValue = NULL,
@IsRequired = 0,
@LinkedParameterName = NULL,
@LinkedParameterField = NULL,
@ExtraFilter = NULL,
@EntityID = NULL,
@RecordID = NULL,
@OrderBy = NULL,
@TemplateContentID = NULL;

-- Save AI Prompts (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAIPrompt @ID = '003C2419-899C-48BB-B184-0A5CDEAAC4A9',
@Name = N'Collect User Information - Prompt Step',
@Description = N'Interactive prompt for collecting user information from an administrator during the onboarding flow',
@TemplateID = '462B4D79-3584-4225-A684-3F1858E3AAA0',
@CategoryID = '94423B4D-BC7D-4ED6-9510-EC0E346DA597',
@TypeID = 'A6DA423E-F36B-1410-8DAC-00021F8B792E',
@Status = N'Active',
@ResponseFormat = N'JSON',
@ModelSpecificResponseFormat = NULL,
@AIModelTypeID = NULL,
@MinPowerRank = 0,
@SelectionStrategy = N'Default',
@PowerPreference = N'Highest',
@ParallelizationMode = N'None',
@ParallelCount = NULL,
@ParallelConfigParam = NULL,
@OutputType = N'string',
@OutputExample = N'{
  "userData": {
    "firstName": "Jane",
    "lastName": "Smith",
    "email": "jane.smith@company.com",
    "title": "Product Manager",
    "type": "User",
    "isEmployee": true,
    "employeeData": {
      "companyID": "123e4567-e89b-12d3-a456-426614174000",
      "supervisorID": "987f6543-e21b-12d3-a456-426614174000",
      "phone": "+1-555-987-6543"
    },
    "roles": ["Manager", "User"]
  },
  "confirmed": true,
  "nextStepName": "Validate User Data"
}',
@ValidationBehavior = N'Warn',
@MaxRetries = 0,
@RetryDelayMS = 0,
@RetryStrategy = N'Fixed',
@ResultSelectorPromptID = NULL,
@EnableCaching = 0,
@CacheTTLSeconds = NULL,
@CacheMatchType = N'Exact',
@CacheSimilarityThreshold = NULL,
@CacheMustMatchModel = 1,
@CacheMustMatchVendor = 1,
@CacheMustMatchAgent = 0,
@CacheMustMatchConfig = 0,
@PromptRole = N'System',
@PromptPosition = N'First',
@Temperature = NULL,
@TopP = NULL,
@TopK = NULL,
@MinP = NULL,
@FrequencyPenalty = NULL,
@PresencePenalty = NULL,
@Seed = NULL,
@StopSequences = NULL,
@IncludeLogProbs = 0,
@TopLogProbs = NULL,
@FailoverStrategy = N'SameModelDifferentVendor',
@FailoverMaxAttempts = 3,
@FailoverDelaySeconds = 5,
@FailoverModelStrategy = N'PreferSameModel',
@FailoverErrorScope = N'All';

-- Save Templates (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateTemplate @ID = 'aef49272-81d4-4122-87a8-a79f27a1bd30',
@Name = N'Generic Error Message',
@Description = N'Template for AI Prompt: Generic Error Message',
@CategoryID = 'B09D433E-F36B-1410-8DB1-00021F8B792E',
@UserPrompt = NULL,
@UserID = 'ECAFCCEC-6A37-EF11-86D4-000D3A4E707E',
@ActiveAt = NULL,
@DisabledAt = NULL,
@IsActive = 1;

-- Save Template Contents (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateTemplateContent @ID = 'f6c4c0bc-9e4c-4976-9fbf-bbce1f08038a',
@TemplateID = 'AEF49272-81D4-4122-87A8-A79F27A1BD30',
@TypeID = 'E7AFCCEC-6A37-EF11-86D4-000D3A4E707E',
@TemplateText = N'An error occurred: {{ payload.errorMessage }}

Please check the error details and try again.',
@Priority = 1,
@IsActive = 1;

-- Save Template Params (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateTemplateParam @ID = 'd6638331-ba9b-4c13-9266-5be0e648685a',
@TemplateID = 'AEF49272-81D4-4122-87A8-A79F27A1BD30',
@Name = N'payload',
@Description = N'Contains error information including the error message to display',
@Type = N'Object',
@DefaultValue = NULL,
@IsRequired = 0,
@LinkedParameterName = NULL,
@LinkedParameterField = NULL,
@ExtraFilter = NULL,
@EntityID = NULL,
@RecordID = NULL,
@OrderBy = NULL,
@TemplateContentID = NULL;

-- Save AI Prompts (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAIPrompt @ID = '566D0D19-C986-4847-8EB0-1A1E59FAC06B',
@Name = N'Generic Error Message',
@Description = N'Generic error message prompt that can be customized based on the error context',
@TemplateID = 'AEF49272-81D4-4122-87A8-A79F27A1BD30',
@CategoryID = '7D2DEF7F-138F-4620-8309-33964A97A997',
@TypeID = 'A6DA423E-F36B-1410-8DAC-00021F8B792E',
@Status = N'Active',
@ResponseFormat = N'Text',
@ModelSpecificResponseFormat = NULL,
@AIModelTypeID = NULL,
@MinPowerRank = 0,
@SelectionStrategy = N'Default',
@PowerPreference = N'Highest',
@ParallelizationMode = N'None',
@ParallelCount = NULL,
@ParallelConfigParam = NULL,
@OutputType = N'string',
@OutputExample = NULL,
@ValidationBehavior = N'Warn',
@MaxRetries = 0,
@RetryDelayMS = 0,
@RetryStrategy = N'Fixed',
@ResultSelectorPromptID = NULL,
@EnableCaching = 0,
@CacheTTLSeconds = NULL,
@CacheMatchType = N'Exact',
@CacheSimilarityThreshold = NULL,
@CacheMustMatchModel = 1,
@CacheMustMatchVendor = 1,
@CacheMustMatchAgent = 0,
@CacheMustMatchConfig = 0,
@PromptRole = N'System',
@PromptPosition = N'First',
@Temperature = NULL,
@TopP = NULL,
@TopK = NULL,
@MinP = NULL,
@FrequencyPenalty = NULL,
@PresencePenalty = NULL,
@Seed = NULL,
@StopSequences = NULL,
@IncludeLogProbs = 0,
@TopLogProbs = NULL,
@FailoverStrategy = N'SameModelDifferentVendor',
@FailoverMaxAttempts = 3,
@FailoverDelaySeconds = 5,
@FailoverModelStrategy = N'PreferSameModel',
@FailoverErrorScope = N'All';

-- Save AI Agents (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAIAgent @ID = '3CF3AE08-1B17-4D07-B235-885EED030CB8',
@Name = N'User Onboarding Flow Agent',
@Description = N'Automated flow agent for onboarding new users into MemberJunction. Handles permission verification, user creation, role assignment, and welcome email delivery through a deterministic workflow.',
@LogoURL = NULL,
@ParentID = NULL,
@ExposeAsAction = 1,
@ExecutionOrder = 0,
@ExecutionMode = N'Sequential',
@EnableContextCompression = 0,
@ContextCompressionMessageThreshold = NULL,
@ContextCompressionPromptID = NULL,
@ContextCompressionMessageRetentionCount = NULL,
@TypeID = '4F6A189B-C068-4736-9F23-3FF540B40FDD',
@Status = N'Active',
@DriverClass = NULL,
@IconClass = N'fa-solid fa-user-plus',
@ModelSelectionMode = N'Agent Type',
@PayloadDownstreamPaths = N'["*"]',
@PayloadUpstreamPaths = N'["*"]',
@PayloadSelfReadPaths = NULL,
@PayloadSelfWritePaths = NULL,
@PayloadScope = NULL,
@FinalPayloadValidation = NULL,
@FinalPayloadValidationMode = N'Retry',
@FinalPayloadValidationMaxRetries = 3,
@MaxCostPerRun = NULL,
@MaxTokensPerRun = NULL,
@MaxIterationsPerRun = NULL,
@MaxTimePerRun = NULL,
@MinExecutionsPerRun = NULL,
@MaxExecutionsPerRun = NULL,
@StartingPayloadValidation = NULL,
@StartingPayloadValidationMode = N'Fail';

-- Save MJ: AI Agent Prompts (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAIAgentPrompt @ID = '0C2220BB-8477-4AB5-B72B-EA61D9E9D2CA',
@AgentID = '3CF3AE08-1B17-4D07-B235-885EED030CB8',
@PromptID = '7D231A18-11CB-48E2-881F-6CC12DD9CD2D',
@Purpose = NULL,
@ExecutionOrder = 0,
@ConfigurationID = NULL,
@Status = N'Active',
@ContextBehavior = N'Complete',
@ContextMessageCount = NULL;

-- Save AI Agent Actions (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAIAgentAction @ID = 'C28DF6B0-CACF-4CDD-B9B6-C1377F836375',
@AgentID = '3CF3AE08-1B17-4D07-B235-885EED030CB8',
@ActionID = 'C8094D90-1194-4C81-AE0F-77E85FD54169',
@Status = N'Active',
@MinExecutionsPerRun = NULL,
@MaxExecutionsPerRun = NULL;

-- Save AI Agent Actions (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAIAgentAction @ID = 'B5A7C8E9-4D2F-11EE-9E3B-0242AC120002',
@AgentID = '3CF3AE08-1B17-4D07-B235-885EED030CB8',
@ActionID = '540BFDE1-02B5-432C-9490-BD34AF853FE8',
@Status = N'Active',
@MinExecutionsPerRun = NULL,
@MaxExecutionsPerRun = NULL;

-- Save AI Agent Actions (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAIAgentAction @ID = 'D92309DC-A212-4729-A502-4984CF90A8E6',
@AgentID = '3CF3AE08-1B17-4D07-B235-885EED030CB8',
@ActionID = '4A57DE26-16DB-47A4-82AB-DFC74B3152FA',
@Status = N'Active',
@MinExecutionsPerRun = NULL,
@MaxExecutionsPerRun = NULL;

-- Save AI Agent Actions (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAIAgentAction @ID = 'A6C93359-1CA8-41EE-9010-56BDA1EFC8B2',
@AgentID = '3CF3AE08-1B17-4D07-B235-885EED030CB8',
@ActionID = 'CC9C1E62-8AB9-4A46-886D-66F6B4295982',
@Status = N'Active',
@MinExecutionsPerRun = NULL,
@MaxExecutionsPerRun = NULL;

-- Save AI Agent Actions (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAIAgentAction @ID = '2BF42A0C-DAE4-494E-BE51-0AC9EF094F3E',
@AgentID = '3CF3AE08-1B17-4D07-B235-885EED030CB8',
@ActionID = '873F5441-D1A9-497B-AE32-F9D1A23843C6',
@Status = N'Active',
@MinExecutionsPerRun = NULL,
@MaxExecutionsPerRun = NULL;

-- Save AI Agent Actions (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAIAgentAction @ID = '0274F2D6-DD12-46BF-969A-982CB585AE62',
@AgentID = '3CF3AE08-1B17-4D07-B235-885EED030CB8',
@ActionID = '3A28C11B-EBE3-4F6F-B279-F1BA6D0C1912',
@Status = N'Active',
@MinExecutionsPerRun = NULL,
@MaxExecutionsPerRun = NULL;

-- Save MJ: AI Agent Steps (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAIAgentStep @ID = '3DB38E5E-FB94-401C-94AB-0B2D7E18302C',
@AgentID = '3CF3AE08-1B17-4D07-B235-885EED030CB8',
@Name = N'Collect User Information',
@Description = NULL,
@StepType = N'Prompt',
@StartingStep = 1,
@TimeoutSeconds = 600,
@RetryCount = 0,
@OnErrorBehavior = N'fail',
@ActionID = NULL,
@SubAgentID = NULL,
@PromptID = '003C2419-899C-48BB-B184-0A5CDEAAC4A9',
@ActionOutputMapping = NULL,
@PositionX = 300,
@PositionY = 100,
@Width = 200,
@Height = 80,
@Status = N'Active',
@ActionInputMapping = NULL;

-- Save MJ: AI Agent Steps (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAIAgentStep @ID = '286C4DE2-133C-42CD-9BA9-96F46156AF95',
@AgentID = '3CF3AE08-1B17-4D07-B235-885EED030CB8',
@Name = N'Validate User Data',
@Description = NULL,
@StepType = N'Action',
@StartingStep = 0,
@TimeoutSeconds = 600,
@RetryCount = 0,
@OnErrorBehavior = N'fail',
@ActionID = '540BFDE1-02B5-432C-9490-BD34AF853FE8',
@SubAgentID = NULL,
@PromptID = NULL,
@ActionOutputMapping = N'{"IsUnique": "emailIsUnique", "ExistingUserID": "existingUserID"}',
@PositionX = 500,
@PositionY = 100,
@Width = 200,
@Height = 80,
@Status = N'Active',
@ActionInputMapping = N'{"Email": "payload.userData.email"}';

-- Save MJ: AI Agent Steps (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAIAgentStep @ID = '5A421648-5261-4A49-862D-465C71F5A87E',
@AgentID = '3CF3AE08-1B17-4D07-B235-885EED030CB8',
@Name = N'Create Employee Record',
@Description = NULL,
@StepType = N'Action',
@StartingStep = 0,
@TimeoutSeconds = 600,
@RetryCount = 0,
@OnErrorBehavior = N'fail',
@ActionID = 'CC9C1E62-8AB9-4A46-886D-66F6B4295982',
@SubAgentID = NULL,
@PromptID = NULL,
@ActionOutputMapping = N'{"EmployeeID": "createdEmployeeID"}',
@PositionX = 700,
@PositionY = 50,
@Width = 200,
@Height = 80,
@Status = N'Active',
@ActionInputMapping = N'{"FirstName": "payload.userData.firstName", "LastName": "payload.userData.lastName", "Email": "payload.userData.email", "Title": "payload.userData.title", "Phone": "payload.userData.employeeData.phone", "CompanyID": "payload.userData.employeeData.companyID", "SupervisorID": "payload.userData.employeeData.supervisorID"}';

-- Save MJ: AI Agent Steps (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAIAgentStep @ID = '8297F22F-76CC-4C2F-B3E7-3650CC25AFDE',
@AgentID = '3CF3AE08-1B17-4D07-B235-885EED030CB8',
@Name = N'Create User Record',
@Description = NULL,
@StepType = N'Action',
@StartingStep = 0,
@TimeoutSeconds = 600,
@RetryCount = 0,
@OnErrorBehavior = N'fail',
@ActionID = '4A57DE26-16DB-47A4-82AB-DFC74B3152FA',
@SubAgentID = NULL,
@PromptID = NULL,
@ActionOutputMapping = N'{"UserID": "createdUserID", "Name": "createdUserName"}',
@PositionX = 700,
@PositionY = 150,
@Width = 200,
@Height = 80,
@Status = N'Active',
@ActionInputMapping = N'{"FirstName": "payload.userData.firstName", "LastName": "payload.userData.lastName", "Email": "payload.userData.email", "Title": "payload.userData.title", "Type": "payload.userData.type", "IsActive": "true", "EmployeeID": "payload.createdEmployeeID"}';

-- Save MJ: AI Agent Steps (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAIAgentStep @ID = '5A977380-2AA5-4119-A329-4450FC603025',
@AgentID = '3CF3AE08-1B17-4D07-B235-885EED030CB8',
@Name = N'Assign User Roles',
@Description = NULL,
@StepType = N'Action',
@StartingStep = 0,
@TimeoutSeconds = 600,
@RetryCount = 0,
@OnErrorBehavior = N'fail',
@ActionID = '873F5441-D1A9-497B-AE32-F9D1A23843C6',
@SubAgentID = NULL,
@PromptID = NULL,
@ActionOutputMapping = N'{"AssignedUserRoleIDs[0]": "lastAssignedUserRoleID", "AssignedRoleIDs[0]": "lastAssignedRoleID"}',
@PositionX = 900,
@PositionY = 100,
@Width = 200,
@Height = 80,
@Status = N'Active',
@ActionInputMapping = N'{"UserID": "payload.createdUserID", "RoleNames": "payload.userData.roles"}';

-- Save MJ: AI Agent Steps (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAIAgentStep @ID = 'D4F0E61E-9E0C-420D-9F92-6CECF0884C81',
@AgentID = '3CF3AE08-1B17-4D07-B235-885EED030CB8',
@Name = N'Send Welcome Email',
@Description = NULL,
@StepType = N'Action',
@StartingStep = 0,
@TimeoutSeconds = 600,
@RetryCount = 0,
@OnErrorBehavior = N'fail',
@ActionID = '3A28C11B-EBE3-4F6F-B279-F1BA6D0C1912',
@SubAgentID = NULL,
@PromptID = NULL,
@ActionOutputMapping = N'{"EmailSent": "welcomeEmailSent", "MessageID": "emailMessageID"}',
@PositionX = 1100,
@PositionY = 100,
@Width = 200,
@Height = 80,
@Status = N'Active',
@ActionInputMapping = N'{"UserID": "payload.createdUserID", "LoginURL": "https://app.memberjunction.com"}';

-- Save MJ: AI Agent Steps (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAIAgentStep @ID = '23157416-28D0-422A-AF69-6E4D46E0E212',
@AgentID = '3CF3AE08-1B17-4D07-B235-885EED030CB8',
@Name = N'Email Already Exists',
@Description = NULL,
@StepType = N'Prompt',
@StartingStep = 0,
@TimeoutSeconds = 600,
@RetryCount = 0,
@OnErrorBehavior = N'fail',
@ActionID = NULL,
@SubAgentID = NULL,
@PromptID = '566D0D19-C986-4847-8EB0-1A1E59FAC06B',
@ActionOutputMapping = NULL,
@PositionX = 500,
@PositionY = 250,
@Width = 200,
@Height = 80,
@Status = N'Active',
@ActionInputMapping = NULL;

-- Save MJ: AI Agent Step Paths (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAIAgentStepPath @ID = 'CA2BC3FA-6688-46A9-90DE-D92925EB76C1',
@OriginStepID = '3DB38E5E-FB94-401C-94AB-0B2D7E18302C',
@DestinationStepID = '286C4DE2-133C-42CD-9BA9-96F46156AF95',
@Condition = N'payload.confirmed == true',
@Priority = 1,
@Description = N'Proceed to validation after collecting info',
@PathPoints = NULL;

-- Save MJ: AI Agent Step Paths (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAIAgentStepPath @ID = '80E2D6D5-D2F8-41DF-A169-3E2383416916',
@OriginStepID = '286C4DE2-133C-42CD-9BA9-96F46156AF95',
@DestinationStepID = '5A421648-5261-4A49-862D-465C71F5A87E',
@Condition = N'payload.emailIsUnique == true && payload.userData.isEmployee == true',
@Priority = 1,
@Description = N'Create employee if requested and email is unique',
@PathPoints = NULL;

-- Save MJ: AI Agent Step Paths (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAIAgentStepPath @ID = '48CBE3C2-B9D1-49DC-AF70-61767F464B21',
@OriginStepID = '286C4DE2-133C-42CD-9BA9-96F46156AF95',
@DestinationStepID = '8297F22F-76CC-4C2F-B3E7-3650CC25AFDE',
@Condition = N'payload.emailIsUnique == true && payload.userData.isEmployee != true',
@Priority = 2,
@Description = N'Create user directly if not employee',
@PathPoints = NULL;

-- Save MJ: AI Agent Step Paths (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAIAgentStepPath @ID = '81CABE7B-2917-475E-A125-6D9DBFEBCE94',
@OriginStepID = '286C4DE2-133C-42CD-9BA9-96F46156AF95',
@DestinationStepID = '23157416-28D0-422A-AF69-6E4D46E0E212',
@Condition = N'payload.emailIsUnique == false',
@Priority = 3,
@Description = N'Show error if email already exists',
@PathPoints = NULL;

-- Save MJ: AI Agent Step Paths (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAIAgentStepPath @ID = '71865532-8C3E-438D-9273-10F05FD241C3',
@OriginStepID = '5A421648-5261-4A49-862D-465C71F5A87E',
@DestinationStepID = '8297F22F-76CC-4C2F-B3E7-3650CC25AFDE',
@Condition = N'true',
@Priority = 1,
@Description = N'Always create user after employee',
@PathPoints = NULL;

-- Save MJ: AI Agent Step Paths (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAIAgentStepPath @ID = '7D146602-75C0-40BA-8768-BDAFAFA8D906',
@OriginStepID = '8297F22F-76CC-4C2F-B3E7-3650CC25AFDE',
@DestinationStepID = '5A977380-2AA5-4119-A329-4450FC603025',
@Condition = N'payload.createdUserID != null',
@Priority = 1,
@Description = N'Assign roles after user creation',
@PathPoints = NULL;

-- Save MJ: AI Agent Step Paths (core SP call only)
EXEC [${flyway:defaultSchema}].spCreateAIAgentStepPath @ID = '5A6B3110-6D40-408D-9EC9-25E03057B158',
@OriginStepID = '5A977380-2AA5-4119-A329-4450FC603025',
@DestinationStepID = 'D4F0E61E-9E0C-420D-9F92-6CECF0884C81',
@Condition = N'payload.lastAssignedUserRoleID != null',
@Priority = 1,
@Description = N'Send email after roles assigned',
@PathPoints = NULL;


-- End of SQL Logging Session
-- Session ID: 702b1a82-e3b0-4acd-ae8f-835b1775a597
-- Completed: 2025-08-04T06:03:03.010Z
-- Duration: 14910ms
-- Total Statements: 106
