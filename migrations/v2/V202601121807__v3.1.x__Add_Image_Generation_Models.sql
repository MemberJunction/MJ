-- Add Image Generation AI Models and Multi-Modal Output Infrastructure
-- This migration adds:
-- 1. Black Forest Labs as a new AI Vendor
-- 2. AI Model records for image generation models
-- 3. AIModelVendor associations for OpenAI, Google, and Black Forest Labs as providers
-- 4. AIModelCost records for each model
-- 5. AIModelModality records for specific modality configurations
-- 6. AIPromptRunMedia table for storing media generated by prompt executions
-- 7. AIAgentRunMedia table for storing media outputs promoted by agent runs

-- ============================================
-- VARIABLE DECLARATIONS
-- ============================================

-- Vendor IDs
DECLARE @OpenAIVendorID UNIQUEIDENTIFIER = 'D8A5CCEC-6A37-EF11-86D4-000D3A4E707E';
DECLARE @GoogleVendorID UNIQUEIDENTIFIER = 'E4A5CCEC-6A37-EF11-86D4-000D3A4E707E';
DECLARE @BFLVendorID UNIQUEIDENTIFIER = 'C7D8E9F0-A1B2-4C3D-5E6F-7A8B9C0D1E2F';

-- API Key credential type ID
DECLARE @APIKeyCredentialTypeID UNIQUEIDENTIFIER = '3F0C13AB-EF5F-4260-A50A-D66DDEC25270';

-- Model IDs for image generation models
DECLARE @GPTImage15ModelID UNIQUEIDENTIFIER = '4B9F8E72-1C5D-4A3E-B6F8-9D2E4A7C3B1A';
DECLARE @GPTImage1ModelID UNIQUEIDENTIFIER = '8C2D6F4E-3A7B-49C1-A5E2-1F8D3C6B9E7A';
DECLARE @NanoBananaProModelID UNIQUEIDENTIFIER = 'A1E5C9D3-7B2F-48E6-9A4C-5D8F1E3B7C2A';
DECLARE @FLUX2ProModelID UNIQUEIDENTIFIER = 'D4E5F6A7-B8C9-4D0E-1F2A-3B4C5D6E7F8A';
DECLARE @FLUX11ProModelID UNIQUEIDENTIFIER = 'E5F6A7B8-C9D0-4E1F-2A3B-4C5D6E7F8A9B';

-- Type IDs
DECLARE @ImageGeneratorTypeID UNIQUEIDENTIFIER = 'E9A5CCEC-6A37-EF11-86D4-000D3A4E707E';
DECLARE @ModelDeveloperTypeID UNIQUEIDENTIFIER = '10DB468E-F2CE-475D-9F39-2DF2DE75D257';
DECLARE @InferenceProviderTypeID UNIQUEIDENTIFIER = '5B043EC3-1FF2-4730-B5D2-7CFDA50979B3';

-- Modality IDs
DECLARE @TextModalityID UNIQUEIDENTIFIER = 'EA43F4CF-EC26-41D7-B2AC-CF928AF63E46';
DECLARE @ImageModalityID UNIQUEIDENTIFIER = 'AAD386E4-D6ED-4E6E-8960-B56AC1D2783B';

-- Pricing type IDs
DECLARE @ImageGenerationPricingTypeID UNIQUEIDENTIFIER = 'f8d3a2b1-c4e5-4f6a-9b8c-7d2e1a3f5c4d';
DECLARE @PerImageUnitTypeID UNIQUEIDENTIFIER = 'a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d';

-- Check if pricing types exist, if not create them
IF NOT EXISTS (SELECT 1 FROM ${flyway:defaultSchema}.AIModelPriceType WHERE ID = @ImageGenerationPricingTypeID)
BEGIN
    INSERT INTO ${flyway:defaultSchema}.AIModelPriceType (ID, Name, Description)
    VALUES (@ImageGenerationPricingTypeID, 'Image Generation', 'Pricing per generated image at various quality levels and sizes');
END

IF NOT EXISTS (SELECT 1 FROM ${flyway:defaultSchema}.AIModelPriceUnitType WHERE ID = @PerImageUnitTypeID)
BEGIN
    INSERT INTO ${flyway:defaultSchema}.AIModelPriceUnitType (ID, Name, Description, DriverClass)
    VALUES (@PerImageUnitTypeID, 'Per Image', 'Price per generated image', 'PerImage');
END

-- ============================================
-- BLACK FOREST LABS - NEW VENDOR
-- ============================================

-- Create Black Forest Labs vendor (creators of FLUX models)
IF NOT EXISTS (SELECT 1 FROM ${flyway:defaultSchema}.AIVendor WHERE ID = @BFLVendorID)
BEGIN
    INSERT INTO [${flyway:defaultSchema}].[AIVendor]
        (ID, Name, Description, CredentialTypeID)
    VALUES
        (
            @BFLVendorID,
            'Black Forest Labs',
            'Black Forest Labs is a frontier AI lab specializing in state-of-the-art image generation models. Creators of the FLUX model family, they offer both open-weights models for self-hosting and a production-ready API. Known for exceptional image quality, photorealism, and advanced editing capabilities.',
            @APIKeyCredentialTypeID
        );
END

-- ============================================
-- FLUX.2 Pro (Black Forest Labs - Latest)
-- ============================================

-- Create FLUX.2 Pro model record
INSERT INTO [${flyway:defaultSchema}].[AIModel]
    (ID, Name, Description, AIModelTypeID, IsActive, PowerRank, SpeedRank, CostRank)
VALUES
    (
        @FLUX2ProModelID,
        'FLUX.2 Pro',
        'Black Forest Labs'' most capable image generation model. A 32B parameter rectified flow transformer delivering photorealistic images up to 4MP resolution. Features exceptional detail accuracy in hands, faces, fabrics, and small objects. Supports image editing, multi-reference control (up to 8 reference images), and advanced prompt understanding.',
        @ImageGeneratorTypeID,
        1, -- IsActive
        10, -- PowerRank (highest quality)
        7, -- SpeedRank
        6  -- CostRank
    );

-- Create AI Model Vendor association for BFL as model developer
INSERT INTO [${flyway:defaultSchema}].[AIModelVendor]
    (ID, ModelID, VendorID, TypeID, Priority, Status, SupportedResponseFormats, SupportsEffortLevel, SupportsStreaming)
VALUES
    (
        'F1A2B3C4-D5E6-4F7A-8B9C-0D1E2F3A4B5C',
        @FLUX2ProModelID,
        @BFLVendorID,
        @ModelDeveloperTypeID,
        0, -- Priority
        'Active',
        'Any',
        0, -- SupportsEffortLevel
        0  -- SupportsStreaming
    );

-- Create AI Model Vendor association for BFL as inference provider
INSERT INTO [${flyway:defaultSchema}].[AIModelVendor]
    (ID, ModelID, VendorID, TypeID, APIName, Priority, Status, SupportedResponseFormats, SupportsEffortLevel, SupportsStreaming, DriverClass, DriverImportPath, MaxInputTokens, MaxOutputTokens)
VALUES
    (
        'A2B3C4D5-E6F7-4A8B-9C0D-1E2F3A4B5C6D',
        @FLUX2ProModelID,
        @BFLVendorID,
        @InferenceProviderTypeID,
        'flux-2-pro', -- API name
        1, -- Priority
        'Active',
        'Any',
        0, -- SupportsEffortLevel
        0, -- SupportsStreaming
        'FLUXImageGenerator', -- Driver class
        NULL, -- DriverImportPath
        10000, -- MaxInputTokens (prompt length)
        NULL  -- MaxOutputTokens
    );

-- Add cost tracking record for FLUX.2 Pro
INSERT INTO [${flyway:defaultSchema}].[AIModelCost]
    (ID, ModelID, VendorID, StartedAt, EndedAt, Status, Currency, PriceTypeID, InputPricePerUnit, OutputPricePerUnit, UnitTypeID, ProcessingType, Comments)
VALUES
    (
        'B3C4D5E6-F7A8-4B9C-0D1E-2F3A4B5C6D7E',
        @FLUX2ProModelID,
        @BFLVendorID,
        '2025-10-01', -- Approximate release date
        NULL,
        'Active',
        'USD',
        @ImageGenerationPricingTypeID,
        0.00, -- Input price (N/A)
        0.030, -- Output price per image (~$0.03/image via Together AI)
        @PerImageUnitTypeID,
        'Realtime',
        'FLUX.2 Pro pricing as of January 2026. Standard pricing approximately $0.03/image. Uses megapixel-based pricing where cost scales with output resolution. 1 credit = $0.01 USD on BFL API.'
    );

-- ============================================
-- FLUX 1.1 Pro (Black Forest Labs)
-- ============================================

-- Create FLUX 1.1 Pro model record
INSERT INTO [${flyway:defaultSchema}].[AIModel]
    (ID, Name, Description, AIModelTypeID, IsActive, PowerRank, SpeedRank, CostRank)
VALUES
    (
        @FLUX11ProModelID,
        'FLUX 1.1 Pro',
        'Black Forest Labs'' production-ready image generation model. Offers excellent image quality with fast generation times. Well-suited for high-volume production workloads. Supports standard image generation with good prompt adherence and style control.',
        @ImageGeneratorTypeID,
        1, -- IsActive
        9, -- PowerRank (excellent quality)
        8, -- SpeedRank (faster than FLUX.2)
        4  -- CostRank (cost-effective)
    );

-- Create AI Model Vendor association for BFL as model developer
INSERT INTO [${flyway:defaultSchema}].[AIModelVendor]
    (ID, ModelID, VendorID, TypeID, Priority, Status, SupportedResponseFormats, SupportsEffortLevel, SupportsStreaming)
VALUES
    (
        'C4D5E6F7-A8B9-4C0D-1E2F-3A4B5C6D7E8F',
        @FLUX11ProModelID,
        @BFLVendorID,
        @ModelDeveloperTypeID,
        0, -- Priority
        'Active',
        'Any',
        0, -- SupportsEffortLevel
        0  -- SupportsStreaming
    );

-- Create AI Model Vendor association for BFL as inference provider
INSERT INTO [${flyway:defaultSchema}].[AIModelVendor]
    (ID, ModelID, VendorID, TypeID, APIName, Priority, Status, SupportedResponseFormats, SupportsEffortLevel, SupportsStreaming, DriverClass, DriverImportPath, MaxInputTokens, MaxOutputTokens)
VALUES
    (
        'D5E6F7A8-B9C0-4D1E-2F3A-4B5C6D7E8F9A',
        @FLUX11ProModelID,
        @BFLVendorID,
        @InferenceProviderTypeID,
        'flux-1.1-pro', -- API name
        1, -- Priority
        'Active',
        'Any',
        0, -- SupportsEffortLevel
        0, -- SupportsStreaming
        'FLUXImageGenerator', -- Driver class
        NULL, -- DriverImportPath
        10000, -- MaxInputTokens (prompt length)
        NULL  -- MaxOutputTokens
    );

-- Add cost tracking record for FLUX 1.1 Pro
INSERT INTO [${flyway:defaultSchema}].[AIModelCost]
    (ID, ModelID, VendorID, StartedAt, EndedAt, Status, Currency, PriceTypeID, InputPricePerUnit, OutputPricePerUnit, UnitTypeID, ProcessingType, Comments)
VALUES
    (
        'E6F7A8B9-C0D1-4E2F-3A4B-5C6D7E8F9A0B',
        @FLUX11ProModelID,
        @BFLVendorID,
        '2025-10-01', -- Release date from announcement
        NULL,
        'Active',
        'USD',
        @ImageGenerationPricingTypeID,
        0.00, -- Input price (N/A)
        0.040, -- Output price per image ($0.04/image)
        @PerImageUnitTypeID,
        'Realtime',
        'FLUX 1.1 Pro pricing as of January 2026. $0.04/image standard resolution. Credit-based pricing on BFL API (1 credit = $0.01).'
    );

-- ============================================
-- GPT-4o Image 1.5 (Latest)
-- ============================================

-- 1. Create GPT-4o Image 1.5 model record
INSERT INTO [${flyway:defaultSchema}].[AIModel]
    (ID, Name, Description, AIModelTypeID, IsActive, PowerRank, SpeedRank, CostRank)
VALUES
    (
        @GPTImage15ModelID,
        'GPT-4o Image 1.5',
        'OpenAI''s latest native multimodal image generation model (December 2025). Built on GPT-4o architecture for exceptional image quality. Supports up to 2K resolution, HD quality, and advanced prompt understanding. Includes editing and variation capabilities.',
        @ImageGeneratorTypeID,
        1, -- IsActive
        10, -- PowerRank (highest quality)
        8, -- SpeedRank
        7  -- CostRank (premium pricing)
    );

-- 2. Create AI Model Vendor association for OpenAI as model developer
INSERT INTO [${flyway:defaultSchema}].[AIModelVendor]
    (ID, ModelID, VendorID, TypeID, Priority, Status, SupportedResponseFormats, SupportsEffortLevel, SupportsStreaming)
VALUES
    (
        '2A4F6E8C-1B3D-4E5F-A7C9-8D2E1F3B5A7C',
        @GPTImage15ModelID,
        @OpenAIVendorID,
        @ModelDeveloperTypeID,
        0, -- Priority
        'Active',
        'Any',
        0, -- SupportsEffortLevel
        0  -- SupportsStreaming
    );

-- 3. Create AI Model Vendor association for OpenAI as inference provider
INSERT INTO [${flyway:defaultSchema}].[AIModelVendor]
    (ID, ModelID, VendorID, TypeID, APIName, Priority, Status, SupportedResponseFormats, SupportsEffortLevel, SupportsStreaming, DriverClass, DriverImportPath, MaxInputTokens, MaxOutputTokens)
VALUES
    (
        '9C8B7A6D-5E4F-3C2B-1A9D-8E7F6C5B4A3D',
        @GPTImage15ModelID,
        @OpenAIVendorID,
        @InferenceProviderTypeID,
        'gpt-image-1.5', -- API name
        1, -- Priority
        'Active',
        'Any',
        0, -- SupportsEffortLevel
        0, -- SupportsStreaming (image generation doesn't stream)
        'OpenAIImageGenerator', -- Driver class
        NULL, -- DriverImportPath
        8000, -- MaxInputTokens (prompt length limit)
        NULL  -- MaxOutputTokens (N/A for image generation)
    );

-- 4. Add cost tracking record for GPT-4o Image 1.5
INSERT INTO [${flyway:defaultSchema}].[AIModelCost]
    (ID, ModelID, VendorID, StartedAt, EndedAt, Status, Currency, PriceTypeID, InputPricePerUnit, OutputPricePerUnit, UnitTypeID, ProcessingType, Comments)
VALUES
    (
        'E1D2C3B4-A5F6-4E7D-8C9B-0A1F2E3D4C5B',
        @GPTImage15ModelID,
        @OpenAIVendorID,
        '2025-12-01', -- Model release date
        NULL,
        'Active',
        'USD',
        @ImageGenerationPricingTypeID,
        0.00, -- Input price (N/A)
        0.080, -- Output price per image (Standard quality)
        @PerImageUnitTypeID,
        'Realtime',
        'GPT-4o Image 1.5 pricing as of January 2026. Standard quality 1024x1024: $0.080/image. HD quality: $0.120/image. 2048x2048: $0.160/image.'
    );

-- ============================================
-- GPT-4o Image 1.0
-- ============================================

-- 5. Create GPT-4o Image 1.0 model record
INSERT INTO [${flyway:defaultSchema}].[AIModel]
    (ID, Name, Description, AIModelTypeID, IsActive, PowerRank, SpeedRank, CostRank)
VALUES
    (
        @GPTImage1ModelID,
        'GPT-4o Image 1.0',
        'OpenAI''s first GPT-4o native image generation model (April 2025). Multimodal architecture enables natural image generation from text. Supports multiple sizes and formats. Cost-effective option for standard quality needs.',
        @ImageGeneratorTypeID,
        1, -- IsActive
        8, -- PowerRank (previous generation)
        8, -- SpeedRank
        5  -- CostRank (more affordable)
    );

-- 6. Create AI Model Vendor association for OpenAI as model developer
INSERT INTO [${flyway:defaultSchema}].[AIModelVendor]
    (ID, ModelID, VendorID, TypeID, Priority, Status, SupportedResponseFormats, SupportsEffortLevel, SupportsStreaming)
VALUES
    (
        '3B5D7F9A-2C4E-6F8A-B1D3-9E7C5A3F1D8B',
        @GPTImage1ModelID,
        @OpenAIVendorID,
        @ModelDeveloperTypeID,
        0, -- Priority
        'Active',
        'Any',
        0, -- SupportsEffortLevel
        0  -- SupportsStreaming
    );

-- 7. Create AI Model Vendor association for OpenAI as inference provider
INSERT INTO [${flyway:defaultSchema}].[AIModelVendor]
    (ID, ModelID, VendorID, TypeID, APIName, Priority, Status, SupportedResponseFormats, SupportsEffortLevel, SupportsStreaming, DriverClass, DriverImportPath, MaxInputTokens, MaxOutputTokens)
VALUES
    (
        'A8C6E4B2-D1F3-5A7C-9E8B-7D6C5A4F3E2B',
        @GPTImage1ModelID,
        @OpenAIVendorID,
        @InferenceProviderTypeID,
        'gpt-image-1', -- API name
        1, -- Priority
        'Active',
        'Any',
        0, -- SupportsEffortLevel
        0, -- SupportsStreaming
        'OpenAIImageGenerator', -- Driver class
        NULL, -- DriverImportPath
        6000, -- MaxInputTokens (prompt length limit)
        NULL  -- MaxOutputTokens
    );

-- 8. Add cost tracking record for GPT-4o Image 1.0
INSERT INTO [${flyway:defaultSchema}].[AIModelCost]
    (ID, ModelID, VendorID, StartedAt, EndedAt, Status, Currency, PriceTypeID, InputPricePerUnit, OutputPricePerUnit, UnitTypeID, ProcessingType, Comments)
VALUES
    (
        'F2E3D4C5-B6A7-8E9F-0A1B-2C3D4E5F6A7B',
        @GPTImage1ModelID,
        @OpenAIVendorID,
        '2025-04-01', -- Model release date
        NULL,
        'Active',
        'USD',
        @ImageGenerationPricingTypeID,
        0.00, -- Input price (N/A)
        0.040, -- Output price per image (Standard quality)
        @PerImageUnitTypeID,
        'Realtime',
        'GPT-4o Image 1.0 pricing as of January 2026. Standard quality 1024x1024: $0.040/image. HD quality: $0.080/image.'
    );

-- ============================================
-- Gemini 3 Pro Image (Nano Banana Pro)
-- ============================================

-- 9. Create Nano Banana Pro model record
INSERT INTO [${flyway:defaultSchema}].[AIModel]
    (ID, Name, Description, AIModelTypeID, IsActive, PowerRank, SpeedRank, CostRank)
VALUES
    (
        @NanoBananaProModelID,
        'Nano Banana Pro',
        'Google''s most advanced image generation model (November 2025), officially Gemini 3 Pro Image. Exceptional quality with support for up to 4K resolution (3840x2160). Features advanced style control, negative prompts, and seed-based reproducibility. State-of-the-art prompt understanding and image editing capabilities.',
        @ImageGeneratorTypeID,
        1, -- IsActive
        10, -- PowerRank (highest quality)
        8, -- SpeedRank
        6  -- CostRank
    );

-- 10. Create AI Model Vendor association for Google as model developer
INSERT INTO [${flyway:defaultSchema}].[AIModelVendor]
    (ID, ModelID, VendorID, TypeID, Priority, Status, SupportedResponseFormats, SupportsEffortLevel, SupportsStreaming)
VALUES
    (
        '4C6E8A2D-3F5B-7D9E-A1C3-8B4F6E2D9A5C',
        @NanoBananaProModelID,
        @GoogleVendorID,
        @ModelDeveloperTypeID,
        0, -- Priority
        'Active',
        'Any',
        0, -- SupportsEffortLevel
        0  -- SupportsStreaming
    );

-- 11. Create AI Model Vendor association for Google as inference provider
INSERT INTO [${flyway:defaultSchema}].[AIModelVendor]
    (ID, ModelID, VendorID, TypeID, APIName, Priority, Status, SupportedResponseFormats, SupportsEffortLevel, SupportsStreaming, DriverClass, DriverImportPath, MaxInputTokens, MaxOutputTokens)
VALUES
    (
        'B9D7E5C3-A1F8-6B4E-2D9C-7A5F3E1B8D6C',
        @NanoBananaProModelID,
        @GoogleVendorID,
        @InferenceProviderTypeID,
        'gemini-3-pro-image-preview', -- API name
        1, -- Priority
        'Active',
        'Any',
        0, -- SupportsEffortLevel
        0, -- SupportsStreaming
        'GeminiImageGenerator', -- Driver class
        NULL, -- DriverImportPath
        12000, -- MaxInputTokens
        NULL  -- MaxOutputTokens
    );

-- 12. Add cost tracking record for Nano Banana Pro
INSERT INTO [${flyway:defaultSchema}].[AIModelCost]
    (ID, ModelID, VendorID, StartedAt, EndedAt, Status, Currency, PriceTypeID, InputPricePerUnit, OutputPricePerUnit, UnitTypeID, ProcessingType, Comments)
VALUES
    (
        'C3A4B5D6-E7F8-9A0B-1C2D-3E4F5A6B7C8D',
        @NanoBananaProModelID,
        @GoogleVendorID,
        '2025-11-01', -- Model release date
        NULL,
        'Active',
        'USD',
        @ImageGenerationPricingTypeID,
        0.00, -- Input price (N/A)
        0.050, -- Output price per image (1024x1024)
        @PerImageUnitTypeID,
        'Realtime',
        'Gemini 3 Pro Image (Nano Banana Pro) pricing as of January 2026. 1024x1024: $0.050/image. 2048x2048: $0.100/image. 4K resolution: $0.200/image.'
    );

-- ============================================
-- AIModelModality records for additional modality support
-- (Beyond the defaults inherited from AIModelType)
-- ============================================

-- GPT-4o Image 1.5 supports image input for editing and variations
INSERT INTO [${flyway:defaultSchema}].[AIModelModality]
    (ID, ModelID, ModalityID, Direction, IsSupported, IsRequired, SupportedFormats, MaxSizeBytes, MaxDimension, Comments)
VALUES
    (
        '1A2B3C4D-5E6F-7A8B-9C0D-1E2F3A4B5C6D',
        @GPTImage15ModelID,
        @ImageModalityID,
        'Input',
        1, -- IsSupported
        0, -- IsRequired (optional for editing/variations)
        'png,jpg,webp',
        20971520, -- 20MB max
        4096, -- Max dimension
        'GPT-4o Image 1.5 accepts image input for editing and variations. Supports multiple formats up to 20MB.'
    );

-- Nano Banana Pro supports image input for editing/variations
INSERT INTO [${flyway:defaultSchema}].[AIModelModality]
    (ID, ModelID, ModalityID, Direction, IsSupported, IsRequired, SupportedFormats, MaxSizeBytes, MaxDimension, Comments)
VALUES
    (
        '2B3C4D5E-6F7A-8B9C-0D1E-2F3A4B5C6D7E',
        @NanoBananaProModelID,
        @ImageModalityID,
        'Input',
        1, -- IsSupported
        0, -- IsRequired
        'png,jpg,webp,gif,heic',
        52428800, -- 50MB max
        NULL, -- No specific dimension limit
        'Gemini 3 Pro Image (Nano Banana Pro) accepts image input for editing and creating variations. Supports multiple image formats including HEIC.'
    );

-- FLUX.2 Pro supports image input for editing and multi-reference control
INSERT INTO [${flyway:defaultSchema}].[AIModelModality]
    (ID, ModelID, ModalityID, Direction, IsSupported, IsRequired, SupportedFormats, MaxSizeBytes, MaxDimension, Comments)
VALUES
    (
        '3C4D5E6F-7A8B-9C0D-1E2F-3A4B5C6D7E8F',
        @FLUX2ProModelID,
        @ImageModalityID,
        'Input',
        1, -- IsSupported
        0, -- IsRequired (optional for editing/multi-reference)
        'png,jpg,webp',
        52428800, -- 50MB max
        4096, -- Max dimension
        'FLUX.2 Pro accepts image input for editing and multi-reference control. Supports up to 8 reference images via API for character and product consistency.'
    );

-- FLUX 1.1 Pro supports image input for variations
INSERT INTO [${flyway:defaultSchema}].[AIModelModality]
    (ID, ModelID, ModalityID, Direction, IsSupported, IsRequired, SupportedFormats, MaxSizeBytes, MaxDimension, Comments)
VALUES
    (
        '4D5E6F7A-8B9C-0D1E-2F3A-4B5C6D7E8F9A',
        @FLUX11ProModelID,
        @ImageModalityID,
        'Input',
        1, -- IsSupported
        0, -- IsRequired
        'png,jpg,webp',
        52428800, -- 50MB max
        4096, -- Max dimension
        'FLUX 1.1 Pro accepts image input for image-to-image generation and variations.'
    );

-- ============================================
-- AI PROMPT RUN MEDIA TABLE
-- Stores media (images, audio, video) generated by AI prompt executions.
-- This provides complete audit trail of all generated media at the prompt level.
-- ============================================

CREATE TABLE [${flyway:defaultSchema}].[AIPromptRunMedia] (
    [ID] [uniqueidentifier] NOT NULL DEFAULT newsequentialid(),
    [PromptRunID] [uniqueidentifier] NOT NULL,
    [ModalityID] [uniqueidentifier] NOT NULL,
    [MimeType] [nvarchar](100) NOT NULL,
    [FileName] [nvarchar](255) NULL,
    [FileSizeBytes] [int] NULL,
    [Width] [int] NULL,
    [Height] [int] NULL,
    [DurationSeconds] [decimal](10, 2) NULL,
    [InlineData] [nvarchar](max) NULL,
    [FileID] [uniqueidentifier] NULL,
    [ThumbnailBase64] [nvarchar](max) NULL,
    [Metadata] [nvarchar](max) NULL,
    [DisplayOrder] [int] NOT NULL DEFAULT 0,
    CONSTRAINT [PK_AIPromptRunMedia] PRIMARY KEY CLUSTERED ([ID] ASC)
);

-- Foreign key to AI Prompt Runs
ALTER TABLE [${flyway:defaultSchema}].[AIPromptRunMedia]
    ADD CONSTRAINT [FK_AIPromptRunMedia_PromptRunID]
    FOREIGN KEY ([PromptRunID])
    REFERENCES [${flyway:defaultSchema}].[AIPromptRun] ([ID]);

-- Foreign key to AI Modalities
ALTER TABLE [${flyway:defaultSchema}].[AIPromptRunMedia]
    ADD CONSTRAINT [FK_AIPromptRunMedia_ModalityID]
    FOREIGN KEY ([ModalityID])
    REFERENCES [${flyway:defaultSchema}].[AIModality] ([ID]);

-- Foreign key to Files (MJStorage)
ALTER TABLE [${flyway:defaultSchema}].[AIPromptRunMedia]
    ADD CONSTRAINT [FK_AIPromptRunMedia_FileID]
    FOREIGN KEY ([FileID])
    REFERENCES [${flyway:defaultSchema}].[File] ([ID]);
 

-- ============================================
-- AI AGENT RUN MEDIA TABLE
-- Stores media outputs that agents explicitly promote to their output.
-- Links back to source AIPromptRunMedia when promoted from a prompt execution.
-- ============================================

CREATE TABLE [${flyway:defaultSchema}].[AIAgentRunMedia] (
    [ID] [uniqueidentifier] NOT NULL DEFAULT newsequentialid(),
    [AgentRunID] [uniqueidentifier] NOT NULL,
    [SourcePromptRunMediaID] [uniqueidentifier] NULL,
    [ModalityID] [uniqueidentifier] NOT NULL,
    [MimeType] [nvarchar](100) NOT NULL,
    [FileName] [nvarchar](255) NULL,
    [FileSizeBytes] [int] NULL,
    [Width] [int] NULL,
    [Height] [int] NULL,
    [DurationSeconds] [decimal](10, 2) NULL,
    [InlineData] [nvarchar](max) NULL,
    [FileID] [uniqueidentifier] NULL,
    [ThumbnailBase64] [nvarchar](max) NULL,
    [Label] [nvarchar](255) NULL,
    [Metadata] [nvarchar](max) NULL,
    [DisplayOrder] [int] NOT NULL DEFAULT 0,
    CONSTRAINT [PK_AIAgentRunMedia] PRIMARY KEY CLUSTERED ([ID] ASC)
);

-- Foreign key to AI Agent Runs
ALTER TABLE [${flyway:defaultSchema}].[AIAgentRunMedia]
    ADD CONSTRAINT [FK_AIAgentRunMedia_AgentRunID]
    FOREIGN KEY ([AgentRunID])
    REFERENCES [${flyway:defaultSchema}].[AIAgentRun] ([ID]);

-- Foreign key to source prompt run media (optional - for promoted media)
ALTER TABLE [${flyway:defaultSchema}].[AIAgentRunMedia]
    ADD CONSTRAINT [FK_AIAgentRunMedia_SourcePromptRunMediaID]
    FOREIGN KEY ([SourcePromptRunMediaID])
    REFERENCES [${flyway:defaultSchema}].[AIPromptRunMedia] ([ID]);

-- Foreign key to AI Modalities
ALTER TABLE [${flyway:defaultSchema}].[AIAgentRunMedia]
    ADD CONSTRAINT [FK_AIAgentRunMedia_ModalityID]
    FOREIGN KEY ([ModalityID])
    REFERENCES [${flyway:defaultSchema}].[AIModality] ([ID]);

-- Foreign key to Files (MJStorage)
ALTER TABLE [${flyway:defaultSchema}].[AIAgentRunMedia]
    ADD CONSTRAINT [FK_AIAgentRunMedia_FileID]
    FOREIGN KEY ([FileID])
    REFERENCES [${flyway:defaultSchema}].[File] ([ID]);
 
GO


































































































-- CODE GEN RUN
/* SQL generated to create new entity MJ: AI Agent Run Medias */

      INSERT INTO [${flyway:defaultSchema}].Entity (
         ID,
         Name,
         DisplayName,
         Description,
         NameSuffix,
         BaseTable,
         BaseView,
         SchemaName,
         IncludeInAPI,
         AllowUserSearchAPI
         , TrackRecordChanges
         , AuditRecordAccess
         , AuditViewRuns
         , AllowAllRowsAPI
         , AllowCreateAPI
         , AllowUpdateAPI
         , AllowDeleteAPI
         , UserViewMaxRows
      )
      VALUES (
         'c21cd727-d771-450d-bafa-104922931bfc',
         'MJ: AI Agent Run Medias',
         'AI Agent Run Medias',
         NULL,
         NULL,
         'AIAgentRunMedia',
         'vwAIAgentRunMedias',
         '${flyway:defaultSchema}',
         1,
         0
         , 1
         , 0
         , 0
         , 0
         , 1
         , 1
         , 1
         , 1000
      )
   

/* SQL generated to add new entity MJ: AI Agent Run Medias to application ID: 'EBA5CCEC-6A37-EF11-86D4-000D3A4E707E' */
INSERT INTO ${flyway:defaultSchema}.ApplicationEntity
                                       (ApplicationID, EntityID, Sequence) VALUES
                                       ('EBA5CCEC-6A37-EF11-86D4-000D3A4E707E', 'c21cd727-d771-450d-bafa-104922931bfc', (SELECT ISNULL(MAX(Sequence),0)+1 FROM ${flyway:defaultSchema}.ApplicationEntity WHERE ApplicationID = 'EBA5CCEC-6A37-EF11-86D4-000D3A4E707E'))

/* SQL generated to add new permission for entity MJ: AI Agent Run Medias for role UI */
INSERT INTO ${flyway:defaultSchema}.EntityPermission
                                                   (EntityID, RoleID, CanRead, CanCreate, CanUpdate, CanDelete) VALUES
                                                   ('c21cd727-d771-450d-bafa-104922931bfc', 'E0AFCCEC-6A37-EF11-86D4-000D3A4E707E', 1, 0, 0, 0)

/* SQL generated to add new permission for entity MJ: AI Agent Run Medias for role Developer */
INSERT INTO ${flyway:defaultSchema}.EntityPermission
                                                   (EntityID, RoleID, CanRead, CanCreate, CanUpdate, CanDelete) VALUES
                                                   ('c21cd727-d771-450d-bafa-104922931bfc', 'DEAFCCEC-6A37-EF11-86D4-000D3A4E707E', 1, 1, 1, 0)

/* SQL generated to add new permission for entity MJ: AI Agent Run Medias for role Integration */
INSERT INTO ${flyway:defaultSchema}.EntityPermission
                                                   (EntityID, RoleID, CanRead, CanCreate, CanUpdate, CanDelete) VALUES
                                                   ('c21cd727-d771-450d-bafa-104922931bfc', 'DFAFCCEC-6A37-EF11-86D4-000D3A4E707E', 1, 1, 1, 1)

/* SQL generated to create new entity MJ: AI Prompt Run Medias */

      INSERT INTO [${flyway:defaultSchema}].Entity (
         ID,
         Name,
         DisplayName,
         Description,
         NameSuffix,
         BaseTable,
         BaseView,
         SchemaName,
         IncludeInAPI,
         AllowUserSearchAPI
         , TrackRecordChanges
         , AuditRecordAccess
         , AuditViewRuns
         , AllowAllRowsAPI
         , AllowCreateAPI
         , AllowUpdateAPI
         , AllowDeleteAPI
         , UserViewMaxRows
      )
      VALUES (
         '228ff492-57ad-4097-922f-50441fd19ba0',
         'MJ: AI Prompt Run Medias',
         'AI Prompt Run Medias',
         NULL,
         NULL,
         'AIPromptRunMedia',
         'vwAIPromptRunMedias',
         '${flyway:defaultSchema}',
         1,
         0
         , 1
         , 0
         , 0
         , 0
         , 1
         , 1
         , 1
         , 1000
      )
   

/* SQL generated to add new entity MJ: AI Prompt Run Medias to application ID: 'EBA5CCEC-6A37-EF11-86D4-000D3A4E707E' */
INSERT INTO ${flyway:defaultSchema}.ApplicationEntity
                                       (ApplicationID, EntityID, Sequence) VALUES
                                       ('EBA5CCEC-6A37-EF11-86D4-000D3A4E707E', '228ff492-57ad-4097-922f-50441fd19ba0', (SELECT ISNULL(MAX(Sequence),0)+1 FROM ${flyway:defaultSchema}.ApplicationEntity WHERE ApplicationID = 'EBA5CCEC-6A37-EF11-86D4-000D3A4E707E'))

/* SQL generated to add new permission for entity MJ: AI Prompt Run Medias for role UI */
INSERT INTO ${flyway:defaultSchema}.EntityPermission
                                                   (EntityID, RoleID, CanRead, CanCreate, CanUpdate, CanDelete) VALUES
                                                   ('228ff492-57ad-4097-922f-50441fd19ba0', 'E0AFCCEC-6A37-EF11-86D4-000D3A4E707E', 1, 0, 0, 0)

/* SQL generated to add new permission for entity MJ: AI Prompt Run Medias for role Developer */
INSERT INTO ${flyway:defaultSchema}.EntityPermission
                                                   (EntityID, RoleID, CanRead, CanCreate, CanUpdate, CanDelete) VALUES
                                                   ('228ff492-57ad-4097-922f-50441fd19ba0', 'DEAFCCEC-6A37-EF11-86D4-000D3A4E707E', 1, 1, 1, 0)

/* SQL generated to add new permission for entity MJ: AI Prompt Run Medias for role Integration */
INSERT INTO ${flyway:defaultSchema}.EntityPermission
                                                   (EntityID, RoleID, CanRead, CanCreate, CanUpdate, CanDelete) VALUES
                                                   ('228ff492-57ad-4097-922f-50441fd19ba0', 'DFAFCCEC-6A37-EF11-86D4-000D3A4E707E', 1, 1, 1, 1)

/* SQL text to add special date field __mj_CreatedAt to entity ${flyway:defaultSchema}.AIAgentRunMedia */
ALTER TABLE [${flyway:defaultSchema}].[AIAgentRunMedia] ADD __mj_CreatedAt DATETIMEOFFSET NOT NULL DEFAULT GETUTCDATE()

/* SQL text to add special date field __mj_UpdatedAt to entity ${flyway:defaultSchema}.AIAgentRunMedia */
ALTER TABLE [${flyway:defaultSchema}].[AIAgentRunMedia] ADD __mj_UpdatedAt DATETIMEOFFSET NOT NULL DEFAULT GETUTCDATE()

/* SQL text to add special date field __mj_CreatedAt to entity ${flyway:defaultSchema}.AIPromptRunMedia */
ALTER TABLE [${flyway:defaultSchema}].[AIPromptRunMedia] ADD __mj_CreatedAt DATETIMEOFFSET NOT NULL DEFAULT GETUTCDATE()

/* SQL text to add special date field __mj_UpdatedAt to entity ${flyway:defaultSchema}.AIPromptRunMedia */
ALTER TABLE [${flyway:defaultSchema}].[AIPromptRunMedia] ADD __mj_UpdatedAt DATETIMEOFFSET NOT NULL DEFAULT GETUTCDATE()

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '9882eb6b-c103-4b37-a823-bb066c66204d'  OR 
               (EntityID = 'C21CD727-D771-450D-BAFA-104922931BFC' AND Name = 'ID')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '9882eb6b-c103-4b37-a823-bb066c66204d',
            'C21CD727-D771-450D-BAFA-104922931BFC', -- Entity: MJ: AI Agent Run Medias
            100001,
            'ID',
            'ID',
            NULL,
            'uniqueidentifier',
            16,
            0,
            0,
            0,
            'newsequentialid()',
            0,
            0,
            0,
            NULL,
            NULL,
            0,
            1,
            0,
            0,
            1,
            1,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'f6640624-c8aa-40e9-9476-fc5b05138d79'  OR 
               (EntityID = 'C21CD727-D771-450D-BAFA-104922931BFC' AND Name = 'AgentRunID')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'f6640624-c8aa-40e9-9476-fc5b05138d79',
            'C21CD727-D771-450D-BAFA-104922931BFC', -- Entity: MJ: AI Agent Run Medias
            100002,
            'AgentRunID',
            'Agent Run ID',
            NULL,
            'uniqueidentifier',
            16,
            0,
            0,
            0,
            'null',
            0,
            1,
            0,
            '5190AF93-4C39-4429-BDAA-0AEB492A0256',
            'ID',
            0,
            0,
            1,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'f5798cfe-136c-42cc-b751-979f29ba7df9'  OR 
               (EntityID = 'C21CD727-D771-450D-BAFA-104922931BFC' AND Name = 'SourcePromptRunMediaID')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'f5798cfe-136c-42cc-b751-979f29ba7df9',
            'C21CD727-D771-450D-BAFA-104922931BFC', -- Entity: MJ: AI Agent Run Medias
            100003,
            'SourcePromptRunMediaID',
            'Source Prompt Run Media ID',
            NULL,
            'uniqueidentifier',
            16,
            0,
            0,
            1,
            'null',
            0,
            1,
            0,
            '228FF492-57AD-4097-922F-50441FD19BA0',
            'ID',
            0,
            0,
            1,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'a6d8bf95-bea7-4412-ae17-a985e046863a'  OR 
               (EntityID = 'C21CD727-D771-450D-BAFA-104922931BFC' AND Name = 'ModalityID')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'a6d8bf95-bea7-4412-ae17-a985e046863a',
            'C21CD727-D771-450D-BAFA-104922931BFC', -- Entity: MJ: AI Agent Run Medias
            100004,
            'ModalityID',
            'Modality ID',
            NULL,
            'uniqueidentifier',
            16,
            0,
            0,
            0,
            'null',
            0,
            1,
            0,
            '56AB1EF8-2E92-4E04-BBF5-CFEB62F1897D',
            'ID',
            0,
            0,
            1,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '3ebcbc53-5fbd-4f6a-9f0f-7c9a6a96303e'  OR 
               (EntityID = 'C21CD727-D771-450D-BAFA-104922931BFC' AND Name = 'MimeType')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '3ebcbc53-5fbd-4f6a-9f0f-7c9a6a96303e',
            'C21CD727-D771-450D-BAFA-104922931BFC', -- Entity: MJ: AI Agent Run Medias
            100005,
            'MimeType',
            'Mime Type',
            NULL,
            'nvarchar',
            200,
            0,
            0,
            0,
            'null',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '121a46da-fa89-4004-88dc-70a4e210319c'  OR 
               (EntityID = 'C21CD727-D771-450D-BAFA-104922931BFC' AND Name = 'FileName')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '121a46da-fa89-4004-88dc-70a4e210319c',
            'C21CD727-D771-450D-BAFA-104922931BFC', -- Entity: MJ: AI Agent Run Medias
            100006,
            'FileName',
            'File Name',
            NULL,
            'nvarchar',
            510,
            0,
            0,
            1,
            'null',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '4c29a554-2dc8-44e4-8bd5-68455f3299e6'  OR 
               (EntityID = 'C21CD727-D771-450D-BAFA-104922931BFC' AND Name = 'FileSizeBytes')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '4c29a554-2dc8-44e4-8bd5-68455f3299e6',
            'C21CD727-D771-450D-BAFA-104922931BFC', -- Entity: MJ: AI Agent Run Medias
            100007,
            'FileSizeBytes',
            'File Size Bytes',
            NULL,
            'int',
            4,
            10,
            0,
            1,
            'null',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'e01bfcec-0843-49d0-9351-bcd4a91180c5'  OR 
               (EntityID = 'C21CD727-D771-450D-BAFA-104922931BFC' AND Name = 'Width')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'e01bfcec-0843-49d0-9351-bcd4a91180c5',
            'C21CD727-D771-450D-BAFA-104922931BFC', -- Entity: MJ: AI Agent Run Medias
            100008,
            'Width',
            'Width',
            NULL,
            'int',
            4,
            10,
            0,
            1,
            'null',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '5a3df96c-a638-45cb-adf8-ca910af16158'  OR 
               (EntityID = 'C21CD727-D771-450D-BAFA-104922931BFC' AND Name = 'Height')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '5a3df96c-a638-45cb-adf8-ca910af16158',
            'C21CD727-D771-450D-BAFA-104922931BFC', -- Entity: MJ: AI Agent Run Medias
            100009,
            'Height',
            'Height',
            NULL,
            'int',
            4,
            10,
            0,
            1,
            'null',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '0173b18f-1369-4e2d-9985-2676b1241f69'  OR 
               (EntityID = 'C21CD727-D771-450D-BAFA-104922931BFC' AND Name = 'DurationSeconds')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '0173b18f-1369-4e2d-9985-2676b1241f69',
            'C21CD727-D771-450D-BAFA-104922931BFC', -- Entity: MJ: AI Agent Run Medias
            100010,
            'DurationSeconds',
            'Duration Seconds',
            NULL,
            'decimal',
            9,
            10,
            2,
            1,
            'null',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '4e624f95-8368-4b70-bb73-20aeda8c7d0a'  OR 
               (EntityID = 'C21CD727-D771-450D-BAFA-104922931BFC' AND Name = 'InlineData')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '4e624f95-8368-4b70-bb73-20aeda8c7d0a',
            'C21CD727-D771-450D-BAFA-104922931BFC', -- Entity: MJ: AI Agent Run Medias
            100011,
            'InlineData',
            'Inline Data',
            NULL,
            'nvarchar',
            -1,
            0,
            0,
            1,
            'null',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'd5bc6da5-a541-4d2b-b1e6-2a2171bb1f5a'  OR 
               (EntityID = 'C21CD727-D771-450D-BAFA-104922931BFC' AND Name = 'FileID')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'd5bc6da5-a541-4d2b-b1e6-2a2171bb1f5a',
            'C21CD727-D771-450D-BAFA-104922931BFC', -- Entity: MJ: AI Agent Run Medias
            100012,
            'FileID',
            'File ID',
            NULL,
            'uniqueidentifier',
            16,
            0,
            0,
            1,
            'null',
            0,
            1,
            0,
            '29248F34-2837-EF11-86D4-6045BDEE16E6',
            'ID',
            0,
            0,
            1,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '42ca522b-7a45-48ca-9bc5-7a77c13c2557'  OR 
               (EntityID = 'C21CD727-D771-450D-BAFA-104922931BFC' AND Name = 'ThumbnailBase64')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '42ca522b-7a45-48ca-9bc5-7a77c13c2557',
            'C21CD727-D771-450D-BAFA-104922931BFC', -- Entity: MJ: AI Agent Run Medias
            100013,
            'ThumbnailBase64',
            'Thumbnail Base 64',
            NULL,
            'nvarchar',
            -1,
            0,
            0,
            1,
            'null',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '6feb9bb1-01a3-4d34-952d-fdced06b55ca'  OR 
               (EntityID = 'C21CD727-D771-450D-BAFA-104922931BFC' AND Name = 'Label')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '6feb9bb1-01a3-4d34-952d-fdced06b55ca',
            'C21CD727-D771-450D-BAFA-104922931BFC', -- Entity: MJ: AI Agent Run Medias
            100014,
            'Label',
            'Label',
            NULL,
            'nvarchar',
            510,
            0,
            0,
            1,
            'null',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'c271f34b-36f6-4f6b-8928-904fc0ab628d'  OR 
               (EntityID = 'C21CD727-D771-450D-BAFA-104922931BFC' AND Name = 'Metadata')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'c271f34b-36f6-4f6b-8928-904fc0ab628d',
            'C21CD727-D771-450D-BAFA-104922931BFC', -- Entity: MJ: AI Agent Run Medias
            100015,
            'Metadata',
            'Metadata',
            NULL,
            'nvarchar',
            -1,
            0,
            0,
            1,
            'null',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '316f664e-9ce4-42d0-8291-867b3fbff094'  OR 
               (EntityID = 'C21CD727-D771-450D-BAFA-104922931BFC' AND Name = 'DisplayOrder')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '316f664e-9ce4-42d0-8291-867b3fbff094',
            'C21CD727-D771-450D-BAFA-104922931BFC', -- Entity: MJ: AI Agent Run Medias
            100016,
            'DisplayOrder',
            'Display Order',
            NULL,
            'int',
            4,
            10,
            0,
            0,
            '(0)',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '71155cd3-ab80-4cb9-aa59-e431febd29df'  OR 
               (EntityID = 'C21CD727-D771-450D-BAFA-104922931BFC' AND Name = '__mj_CreatedAt')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '71155cd3-ab80-4cb9-aa59-e431febd29df',
            'C21CD727-D771-450D-BAFA-104922931BFC', -- Entity: MJ: AI Agent Run Medias
            100017,
            '__mj_CreatedAt',
            'Created At',
            NULL,
            'datetimeoffset',
            10,
            34,
            7,
            0,
            'getutcdate()',
            0,
            0,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '7a7cea6b-f52c-443c-b2eb-4f1aaa6d58ea'  OR 
               (EntityID = 'C21CD727-D771-450D-BAFA-104922931BFC' AND Name = '__mj_UpdatedAt')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '7a7cea6b-f52c-443c-b2eb-4f1aaa6d58ea',
            'C21CD727-D771-450D-BAFA-104922931BFC', -- Entity: MJ: AI Agent Run Medias
            100018,
            '__mj_UpdatedAt',
            'Updated At',
            NULL,
            'datetimeoffset',
            10,
            34,
            7,
            0,
            'getutcdate()',
            0,
            0,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '130d5e45-d2fa-4c00-94e6-b1f28287215a'  OR 
               (EntityID = '228FF492-57AD-4097-922F-50441FD19BA0' AND Name = 'ID')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '130d5e45-d2fa-4c00-94e6-b1f28287215a',
            '228FF492-57AD-4097-922F-50441FD19BA0', -- Entity: MJ: AI Prompt Run Medias
            100001,
            'ID',
            'ID',
            NULL,
            'uniqueidentifier',
            16,
            0,
            0,
            0,
            'newsequentialid()',
            0,
            0,
            0,
            NULL,
            NULL,
            0,
            1,
            0,
            0,
            1,
            1,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '7b716e53-951c-44f5-a688-225fc0f04b75'  OR 
               (EntityID = '228FF492-57AD-4097-922F-50441FD19BA0' AND Name = 'PromptRunID')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '7b716e53-951c-44f5-a688-225fc0f04b75',
            '228FF492-57AD-4097-922F-50441FD19BA0', -- Entity: MJ: AI Prompt Run Medias
            100002,
            'PromptRunID',
            'Prompt Run ID',
            NULL,
            'uniqueidentifier',
            16,
            0,
            0,
            0,
            'null',
            0,
            1,
            0,
            '7C1C98D0-3978-4CE8-8E3F-C90301E59767',
            'ID',
            0,
            0,
            1,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '8ee092ad-bd92-4fe7-a3f8-b94b6b6888dc'  OR 
               (EntityID = '228FF492-57AD-4097-922F-50441FD19BA0' AND Name = 'ModalityID')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '8ee092ad-bd92-4fe7-a3f8-b94b6b6888dc',
            '228FF492-57AD-4097-922F-50441FD19BA0', -- Entity: MJ: AI Prompt Run Medias
            100003,
            'ModalityID',
            'Modality ID',
            NULL,
            'uniqueidentifier',
            16,
            0,
            0,
            0,
            'null',
            0,
            1,
            0,
            '56AB1EF8-2E92-4E04-BBF5-CFEB62F1897D',
            'ID',
            0,
            0,
            1,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'a59b40b9-3811-47a9-9484-7ec23ce5cfcb'  OR 
               (EntityID = '228FF492-57AD-4097-922F-50441FD19BA0' AND Name = 'MimeType')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'a59b40b9-3811-47a9-9484-7ec23ce5cfcb',
            '228FF492-57AD-4097-922F-50441FD19BA0', -- Entity: MJ: AI Prompt Run Medias
            100004,
            'MimeType',
            'Mime Type',
            NULL,
            'nvarchar',
            200,
            0,
            0,
            0,
            'null',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '3c807185-2f2b-41e3-b4b7-6af0df475e02'  OR 
               (EntityID = '228FF492-57AD-4097-922F-50441FD19BA0' AND Name = 'FileName')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '3c807185-2f2b-41e3-b4b7-6af0df475e02',
            '228FF492-57AD-4097-922F-50441FD19BA0', -- Entity: MJ: AI Prompt Run Medias
            100005,
            'FileName',
            'File Name',
            NULL,
            'nvarchar',
            510,
            0,
            0,
            1,
            'null',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '0cb636e1-f53b-483c-a561-c13cf41692c6'  OR 
               (EntityID = '228FF492-57AD-4097-922F-50441FD19BA0' AND Name = 'FileSizeBytes')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '0cb636e1-f53b-483c-a561-c13cf41692c6',
            '228FF492-57AD-4097-922F-50441FD19BA0', -- Entity: MJ: AI Prompt Run Medias
            100006,
            'FileSizeBytes',
            'File Size Bytes',
            NULL,
            'int',
            4,
            10,
            0,
            1,
            'null',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'fec4a6c1-6d1f-441d-ae75-d45fa2927636'  OR 
               (EntityID = '228FF492-57AD-4097-922F-50441FD19BA0' AND Name = 'Width')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'fec4a6c1-6d1f-441d-ae75-d45fa2927636',
            '228FF492-57AD-4097-922F-50441FD19BA0', -- Entity: MJ: AI Prompt Run Medias
            100007,
            'Width',
            'Width',
            NULL,
            'int',
            4,
            10,
            0,
            1,
            'null',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'dfa33632-d484-4af1-95f4-bceb512ae496'  OR 
               (EntityID = '228FF492-57AD-4097-922F-50441FD19BA0' AND Name = 'Height')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'dfa33632-d484-4af1-95f4-bceb512ae496',
            '228FF492-57AD-4097-922F-50441FD19BA0', -- Entity: MJ: AI Prompt Run Medias
            100008,
            'Height',
            'Height',
            NULL,
            'int',
            4,
            10,
            0,
            1,
            'null',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'df17ad06-edc1-40f0-a48c-7c57f0be322f'  OR 
               (EntityID = '228FF492-57AD-4097-922F-50441FD19BA0' AND Name = 'DurationSeconds')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'df17ad06-edc1-40f0-a48c-7c57f0be322f',
            '228FF492-57AD-4097-922F-50441FD19BA0', -- Entity: MJ: AI Prompt Run Medias
            100009,
            'DurationSeconds',
            'Duration Seconds',
            NULL,
            'decimal',
            9,
            10,
            2,
            1,
            'null',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '502a684f-f72d-41ed-998b-4913ae993487'  OR 
               (EntityID = '228FF492-57AD-4097-922F-50441FD19BA0' AND Name = 'InlineData')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '502a684f-f72d-41ed-998b-4913ae993487',
            '228FF492-57AD-4097-922F-50441FD19BA0', -- Entity: MJ: AI Prompt Run Medias
            100010,
            'InlineData',
            'Inline Data',
            NULL,
            'nvarchar',
            -1,
            0,
            0,
            1,
            'null',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '8fd697e8-4f1a-4dbe-b17e-6d099fe654fa'  OR 
               (EntityID = '228FF492-57AD-4097-922F-50441FD19BA0' AND Name = 'FileID')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '8fd697e8-4f1a-4dbe-b17e-6d099fe654fa',
            '228FF492-57AD-4097-922F-50441FD19BA0', -- Entity: MJ: AI Prompt Run Medias
            100011,
            'FileID',
            'File ID',
            NULL,
            'uniqueidentifier',
            16,
            0,
            0,
            1,
            'null',
            0,
            1,
            0,
            '29248F34-2837-EF11-86D4-6045BDEE16E6',
            'ID',
            0,
            0,
            1,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '510d78b2-a971-4f5e-a4d8-71b5a0a7e9f1'  OR 
               (EntityID = '228FF492-57AD-4097-922F-50441FD19BA0' AND Name = 'ThumbnailBase64')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '510d78b2-a971-4f5e-a4d8-71b5a0a7e9f1',
            '228FF492-57AD-4097-922F-50441FD19BA0', -- Entity: MJ: AI Prompt Run Medias
            100012,
            'ThumbnailBase64',
            'Thumbnail Base 64',
            NULL,
            'nvarchar',
            -1,
            0,
            0,
            1,
            'null',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'f2f3e535-fdbd-4312-988a-19ddd434c840'  OR 
               (EntityID = '228FF492-57AD-4097-922F-50441FD19BA0' AND Name = 'Metadata')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'f2f3e535-fdbd-4312-988a-19ddd434c840',
            '228FF492-57AD-4097-922F-50441FD19BA0', -- Entity: MJ: AI Prompt Run Medias
            100013,
            'Metadata',
            'Metadata',
            NULL,
            'nvarchar',
            -1,
            0,
            0,
            1,
            'null',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '344f278b-e7a1-4375-ba2c-8615ccc47718'  OR 
               (EntityID = '228FF492-57AD-4097-922F-50441FD19BA0' AND Name = 'DisplayOrder')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '344f278b-e7a1-4375-ba2c-8615ccc47718',
            '228FF492-57AD-4097-922F-50441FD19BA0', -- Entity: MJ: AI Prompt Run Medias
            100014,
            'DisplayOrder',
            'Display Order',
            NULL,
            'int',
            4,
            10,
            0,
            0,
            '(0)',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '13a1eb13-184a-4a6b-8b3e-82cc6a83a8eb'  OR 
               (EntityID = '228FF492-57AD-4097-922F-50441FD19BA0' AND Name = '__mj_CreatedAt')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '13a1eb13-184a-4a6b-8b3e-82cc6a83a8eb',
            '228FF492-57AD-4097-922F-50441FD19BA0', -- Entity: MJ: AI Prompt Run Medias
            100015,
            '__mj_CreatedAt',
            'Created At',
            NULL,
            'datetimeoffset',
            10,
            34,
            7,
            0,
            'getutcdate()',
            0,
            0,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'ab9942f0-a077-431f-86ff-9a196c45423e'  OR 
               (EntityID = '228FF492-57AD-4097-922F-50441FD19BA0' AND Name = '__mj_UpdatedAt')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'ab9942f0-a077-431f-86ff-9a196c45423e',
            '228FF492-57AD-4097-922F-50441FD19BA0', -- Entity: MJ: AI Prompt Run Medias
            100016,
            '__mj_UpdatedAt',
            'Updated At',
            NULL,
            'datetimeoffset',
            10,
            34,
            7,
            0,
            'getutcdate()',
            0,
            0,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to create Entitiy Relationships */

   IF NOT EXISTS (
      SELECT 1
      FROM [${flyway:defaultSchema}].EntityRelationship
      WHERE ID = 'd7d603b6-bd63-45c8-a886-2ed9a13de495'
   )
   BEGIN
      INSERT INTO ${flyway:defaultSchema}.EntityRelationship (ID, EntityID, RelatedEntityID, RelatedEntityJoinField, Type, BundleInAPI, DisplayInForm, DisplayName, Sequence)
                              VALUES ('d7d603b6-bd63-45c8-a886-2ed9a13de495', '5190AF93-4C39-4429-BDAA-0AEB492A0256', 'C21CD727-D771-450D-BAFA-104922931BFC', 'AgentRunID', 'One To Many', 1, 1, 'MJ: AI Agent Run Medias', 1);
   END
                              

/* SQL text to create Entitiy Relationships */

   IF NOT EXISTS (
      SELECT 1
      FROM [${flyway:defaultSchema}].EntityRelationship
      WHERE ID = '850e0493-0a13-4d08-b659-ed83dd8eb6cc'
   )
   BEGIN
      INSERT INTO ${flyway:defaultSchema}.EntityRelationship (ID, EntityID, RelatedEntityID, RelatedEntityJoinField, Type, BundleInAPI, DisplayInForm, DisplayName, Sequence)
                              VALUES ('850e0493-0a13-4d08-b659-ed83dd8eb6cc', '228FF492-57AD-4097-922F-50441FD19BA0', 'C21CD727-D771-450D-BAFA-104922931BFC', 'SourcePromptRunMediaID', 'One To Many', 1, 1, 'MJ: AI Agent Run Medias', 2);
   END
                              

/* SQL text to create Entitiy Relationships */

   IF NOT EXISTS (
      SELECT 1
      FROM [${flyway:defaultSchema}].EntityRelationship
      WHERE ID = '54c20347-55f3-46aa-82a3-5dfea21360f0'
   )
   BEGIN
      INSERT INTO ${flyway:defaultSchema}.EntityRelationship (ID, EntityID, RelatedEntityID, RelatedEntityJoinField, Type, BundleInAPI, DisplayInForm, DisplayName, Sequence)
                              VALUES ('54c20347-55f3-46aa-82a3-5dfea21360f0', '29248F34-2837-EF11-86D4-6045BDEE16E6', 'C21CD727-D771-450D-BAFA-104922931BFC', 'FileID', 'One To Many', 1, 1, 'MJ: AI Agent Run Medias', 3);
   END
                              
   IF NOT EXISTS (
      SELECT 1
      FROM [${flyway:defaultSchema}].EntityRelationship
      WHERE ID = 'c2cfab18-21a1-4293-aae0-2030aab7b702'
   )
   BEGIN
      INSERT INTO ${flyway:defaultSchema}.EntityRelationship (ID, EntityID, RelatedEntityID, RelatedEntityJoinField, Type, BundleInAPI, DisplayInForm, DisplayName, Sequence)
                              VALUES ('c2cfab18-21a1-4293-aae0-2030aab7b702', '29248F34-2837-EF11-86D4-6045BDEE16E6', '228FF492-57AD-4097-922F-50441FD19BA0', 'FileID', 'One To Many', 1, 1, 'MJ: AI Prompt Run Medias', 1);
   END
                              

/* SQL text to create Entitiy Relationships */

   IF NOT EXISTS (
      SELECT 1
      FROM [${flyway:defaultSchema}].EntityRelationship
      WHERE ID = '72b33931-45ba-4630-b259-c90265ffbe11'
   )
   BEGIN
      INSERT INTO ${flyway:defaultSchema}.EntityRelationship (ID, EntityID, RelatedEntityID, RelatedEntityJoinField, Type, BundleInAPI, DisplayInForm, DisplayName, Sequence)
                              VALUES ('72b33931-45ba-4630-b259-c90265ffbe11', '7C1C98D0-3978-4CE8-8E3F-C90301E59767', '228FF492-57AD-4097-922F-50441FD19BA0', 'PromptRunID', 'One To Many', 1, 1, 'MJ: AI Prompt Run Medias', 2);
   END
                              

/* SQL text to create Entitiy Relationships */

   IF NOT EXISTS (
      SELECT 1
      FROM [${flyway:defaultSchema}].EntityRelationship
      WHERE ID = '74573112-265f-443e-bb98-19169714bd06'
   )
   BEGIN
      INSERT INTO ${flyway:defaultSchema}.EntityRelationship (ID, EntityID, RelatedEntityID, RelatedEntityJoinField, Type, BundleInAPI, DisplayInForm, DisplayName, Sequence)
                              VALUES ('74573112-265f-443e-bb98-19169714bd06', '56AB1EF8-2E92-4E04-BBF5-CFEB62F1897D', 'C21CD727-D771-450D-BAFA-104922931BFC', 'ModalityID', 'One To Many', 1, 1, 'MJ: AI Agent Run Medias', 4);
   END
                              

/* SQL text to create Entitiy Relationships */

   IF NOT EXISTS (
      SELECT 1
      FROM [${flyway:defaultSchema}].EntityRelationship
      WHERE ID = '796c5783-50ae-44d1-a95b-1c7cc7233991'
   )
   BEGIN
      INSERT INTO ${flyway:defaultSchema}.EntityRelationship (ID, EntityID, RelatedEntityID, RelatedEntityJoinField, Type, BundleInAPI, DisplayInForm, DisplayName, Sequence)
                              VALUES ('796c5783-50ae-44d1-a95b-1c7cc7233991', '56AB1EF8-2E92-4E04-BBF5-CFEB62F1897D', '228FF492-57AD-4097-922F-50441FD19BA0', 'ModalityID', 'One To Many', 1, 1, 'MJ: AI Prompt Run Medias', 3);
   END
                              

/* Index for Foreign Keys for AIAgentRunMedia */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Run Medias
-- Item: Index for Foreign Keys
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------
-- Index for foreign key AgentRunID in table AIAgentRunMedia
IF NOT EXISTS (
    SELECT 1
    FROM sys.indexes
    WHERE name = 'IDX_AUTO_MJ_FKEY_AIAgentRunMedia_AgentRunID' 
    AND object_id = OBJECT_ID('[${flyway:defaultSchema}].[AIAgentRunMedia]')
)
CREATE INDEX IDX_AUTO_MJ_FKEY_AIAgentRunMedia_AgentRunID ON [${flyway:defaultSchema}].[AIAgentRunMedia] ([AgentRunID]);

-- Index for foreign key SourcePromptRunMediaID in table AIAgentRunMedia
IF NOT EXISTS (
    SELECT 1
    FROM sys.indexes
    WHERE name = 'IDX_AUTO_MJ_FKEY_AIAgentRunMedia_SourcePromptRunMediaID' 
    AND object_id = OBJECT_ID('[${flyway:defaultSchema}].[AIAgentRunMedia]')
)
CREATE INDEX IDX_AUTO_MJ_FKEY_AIAgentRunMedia_SourcePromptRunMediaID ON [${flyway:defaultSchema}].[AIAgentRunMedia] ([SourcePromptRunMediaID]);

-- Index for foreign key ModalityID in table AIAgentRunMedia
IF NOT EXISTS (
    SELECT 1
    FROM sys.indexes
    WHERE name = 'IDX_AUTO_MJ_FKEY_AIAgentRunMedia_ModalityID' 
    AND object_id = OBJECT_ID('[${flyway:defaultSchema}].[AIAgentRunMedia]')
)
CREATE INDEX IDX_AUTO_MJ_FKEY_AIAgentRunMedia_ModalityID ON [${flyway:defaultSchema}].[AIAgentRunMedia] ([ModalityID]);

-- Index for foreign key FileID in table AIAgentRunMedia
IF NOT EXISTS (
    SELECT 1
    FROM sys.indexes
    WHERE name = 'IDX_AUTO_MJ_FKEY_AIAgentRunMedia_FileID' 
    AND object_id = OBJECT_ID('[${flyway:defaultSchema}].[AIAgentRunMedia]')
)
CREATE INDEX IDX_AUTO_MJ_FKEY_AIAgentRunMedia_FileID ON [${flyway:defaultSchema}].[AIAgentRunMedia] ([FileID]);

/* SQL text to update entity field related entity name field map for entity field ID F6640624-C8AA-40E9-9476-FC5B05138D79 */
EXEC [${flyway:defaultSchema}].spUpdateEntityFieldRelatedEntityNameFieldMap
         @EntityFieldID='F6640624-C8AA-40E9-9476-FC5B05138D79',
         @RelatedEntityNameFieldMap='AgentRun'

/* SQL text to update entity field related entity name field map for entity field ID A6D8BF95-BEA7-4412-AE17-A985E046863A */
EXEC [${flyway:defaultSchema}].spUpdateEntityFieldRelatedEntityNameFieldMap
         @EntityFieldID='A6D8BF95-BEA7-4412-AE17-A985E046863A',
         @RelatedEntityNameFieldMap='Modality'

/* SQL text to update entity field related entity name field map for entity field ID D5BC6DA5-A541-4D2B-B1E6-2A2171BB1F5A */
EXEC [${flyway:defaultSchema}].spUpdateEntityFieldRelatedEntityNameFieldMap
         @EntityFieldID='D5BC6DA5-A541-4D2B-B1E6-2A2171BB1F5A',
         @RelatedEntityNameFieldMap='File'

/* Base View SQL for MJ: AI Agent Run Medias */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Run Medias
-- Item: vwAIAgentRunMedias
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: AI Agent Run Medias
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  AIAgentRunMedia
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwAIAgentRunMedias]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwAIAgentRunMedias];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwAIAgentRunMedias]
AS
SELECT
    a.*,
    AIAgentRun_AgentRunID.[RunName] AS [AgentRun],
    AIModality_ModalityID.[Name] AS [Modality],
    File_FileID.[Name] AS [File]
FROM
    [${flyway:defaultSchema}].[AIAgentRunMedia] AS a
INNER JOIN
    [${flyway:defaultSchema}].[AIAgentRun] AS AIAgentRun_AgentRunID
  ON
    [a].[AgentRunID] = AIAgentRun_AgentRunID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[AIModality] AS AIModality_ModalityID
  ON
    [a].[ModalityID] = AIModality_ModalityID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[File] AS File_FileID
  ON
    [a].[FileID] = File_FileID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwAIAgentRunMedias] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: AI Agent Run Medias */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Run Medias
-- Item: Permissions for vwAIAgentRunMedias
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwAIAgentRunMedias] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: AI Agent Run Medias */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Run Medias
-- Item: spCreateAIAgentRunMedia
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR AIAgentRunMedia
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateAIAgentRunMedia]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateAIAgentRunMedia];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateAIAgentRunMedia]
    @ID uniqueidentifier = NULL,
    @AgentRunID uniqueidentifier,
    @SourcePromptRunMediaID uniqueidentifier,
    @ModalityID uniqueidentifier,
    @MimeType nvarchar(100),
    @FileName nvarchar(255),
    @FileSizeBytes int,
    @Width int,
    @Height int,
    @DurationSeconds decimal(10, 2),
    @InlineData nvarchar(MAX),
    @FileID uniqueidentifier,
    @ThumbnailBase64 nvarchar(MAX),
    @Label nvarchar(255),
    @Metadata nvarchar(MAX),
    @DisplayOrder int = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[AIAgentRunMedia]
            (
                [ID],
                [AgentRunID],
                [SourcePromptRunMediaID],
                [ModalityID],
                [MimeType],
                [FileName],
                [FileSizeBytes],
                [Width],
                [Height],
                [DurationSeconds],
                [InlineData],
                [FileID],
                [ThumbnailBase64],
                [Label],
                [Metadata],
                [DisplayOrder]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @AgentRunID,
                @SourcePromptRunMediaID,
                @ModalityID,
                @MimeType,
                @FileName,
                @FileSizeBytes,
                @Width,
                @Height,
                @DurationSeconds,
                @InlineData,
                @FileID,
                @ThumbnailBase64,
                @Label,
                @Metadata,
                ISNULL(@DisplayOrder, 0)
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[AIAgentRunMedia]
            (
                [AgentRunID],
                [SourcePromptRunMediaID],
                [ModalityID],
                [MimeType],
                [FileName],
                [FileSizeBytes],
                [Width],
                [Height],
                [DurationSeconds],
                [InlineData],
                [FileID],
                [ThumbnailBase64],
                [Label],
                [Metadata],
                [DisplayOrder]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @AgentRunID,
                @SourcePromptRunMediaID,
                @ModalityID,
                @MimeType,
                @FileName,
                @FileSizeBytes,
                @Width,
                @Height,
                @DurationSeconds,
                @InlineData,
                @FileID,
                @ThumbnailBase64,
                @Label,
                @Metadata,
                ISNULL(@DisplayOrder, 0)
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwAIAgentRunMedias] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateAIAgentRunMedia] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: AI Agent Run Medias */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateAIAgentRunMedia] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: AI Agent Run Medias */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Run Medias
-- Item: spUpdateAIAgentRunMedia
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR AIAgentRunMedia
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateAIAgentRunMedia]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateAIAgentRunMedia];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateAIAgentRunMedia]
    @ID uniqueidentifier,
    @AgentRunID uniqueidentifier,
    @SourcePromptRunMediaID uniqueidentifier,
    @ModalityID uniqueidentifier,
    @MimeType nvarchar(100),
    @FileName nvarchar(255),
    @FileSizeBytes int,
    @Width int,
    @Height int,
    @DurationSeconds decimal(10, 2),
    @InlineData nvarchar(MAX),
    @FileID uniqueidentifier,
    @ThumbnailBase64 nvarchar(MAX),
    @Label nvarchar(255),
    @Metadata nvarchar(MAX),
    @DisplayOrder int
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIAgentRunMedia]
    SET
        [AgentRunID] = @AgentRunID,
        [SourcePromptRunMediaID] = @SourcePromptRunMediaID,
        [ModalityID] = @ModalityID,
        [MimeType] = @MimeType,
        [FileName] = @FileName,
        [FileSizeBytes] = @FileSizeBytes,
        [Width] = @Width,
        [Height] = @Height,
        [DurationSeconds] = @DurationSeconds,
        [InlineData] = @InlineData,
        [FileID] = @FileID,
        [ThumbnailBase64] = @ThumbnailBase64,
        [Label] = @Label,
        [Metadata] = @Metadata,
        [DisplayOrder] = @DisplayOrder
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwAIAgentRunMedias] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwAIAgentRunMedias]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateAIAgentRunMedia] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the AIAgentRunMedia table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateAIAgentRunMedia]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateAIAgentRunMedia];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateAIAgentRunMedia
ON [${flyway:defaultSchema}].[AIAgentRunMedia]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIAgentRunMedia]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[AIAgentRunMedia] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: AI Agent Run Medias */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateAIAgentRunMedia] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: AI Agent Run Medias */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Run Medias
-- Item: spDeleteAIAgentRunMedia
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR AIAgentRunMedia
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteAIAgentRunMedia]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteAIAgentRunMedia];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteAIAgentRunMedia]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[AIAgentRunMedia]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteAIAgentRunMedia] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: AI Agent Run Medias */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteAIAgentRunMedia] TO [cdp_Integration]



/* Index for Foreign Keys for AIPromptRunMedia */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Prompt Run Medias
-- Item: Index for Foreign Keys
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------
-- Index for foreign key PromptRunID in table AIPromptRunMedia
IF NOT EXISTS (
    SELECT 1
    FROM sys.indexes
    WHERE name = 'IDX_AUTO_MJ_FKEY_AIPromptRunMedia_PromptRunID' 
    AND object_id = OBJECT_ID('[${flyway:defaultSchema}].[AIPromptRunMedia]')
)
CREATE INDEX IDX_AUTO_MJ_FKEY_AIPromptRunMedia_PromptRunID ON [${flyway:defaultSchema}].[AIPromptRunMedia] ([PromptRunID]);

-- Index for foreign key ModalityID in table AIPromptRunMedia
IF NOT EXISTS (
    SELECT 1
    FROM sys.indexes
    WHERE name = 'IDX_AUTO_MJ_FKEY_AIPromptRunMedia_ModalityID' 
    AND object_id = OBJECT_ID('[${flyway:defaultSchema}].[AIPromptRunMedia]')
)
CREATE INDEX IDX_AUTO_MJ_FKEY_AIPromptRunMedia_ModalityID ON [${flyway:defaultSchema}].[AIPromptRunMedia] ([ModalityID]);

-- Index for foreign key FileID in table AIPromptRunMedia
IF NOT EXISTS (
    SELECT 1
    FROM sys.indexes
    WHERE name = 'IDX_AUTO_MJ_FKEY_AIPromptRunMedia_FileID' 
    AND object_id = OBJECT_ID('[${flyway:defaultSchema}].[AIPromptRunMedia]')
)
CREATE INDEX IDX_AUTO_MJ_FKEY_AIPromptRunMedia_FileID ON [${flyway:defaultSchema}].[AIPromptRunMedia] ([FileID]);

/* SQL text to update entity field related entity name field map for entity field ID 7B716E53-951C-44F5-A688-225FC0F04B75 */
EXEC [${flyway:defaultSchema}].spUpdateEntityFieldRelatedEntityNameFieldMap
         @EntityFieldID='7B716E53-951C-44F5-A688-225FC0F04B75',
         @RelatedEntityNameFieldMap='PromptRun'

/* SQL text to update entity field related entity name field map for entity field ID 8EE092AD-BD92-4FE7-A3F8-B94B6B6888DC */
EXEC [${flyway:defaultSchema}].spUpdateEntityFieldRelatedEntityNameFieldMap
         @EntityFieldID='8EE092AD-BD92-4FE7-A3F8-B94B6B6888DC',
         @RelatedEntityNameFieldMap='Modality'

/* SQL text to update entity field related entity name field map for entity field ID 8FD697E8-4F1A-4DBE-B17E-6D099FE654FA */
EXEC [${flyway:defaultSchema}].spUpdateEntityFieldRelatedEntityNameFieldMap
         @EntityFieldID='8FD697E8-4F1A-4DBE-B17E-6D099FE654FA',
         @RelatedEntityNameFieldMap='File'

/* Base View SQL for MJ: AI Prompt Run Medias */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Prompt Run Medias
-- Item: vwAIPromptRunMedias
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: AI Prompt Run Medias
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  AIPromptRunMedia
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwAIPromptRunMedias]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwAIPromptRunMedias];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwAIPromptRunMedias]
AS
SELECT
    a.*,
    AIPromptRun_PromptRunID.[RunName] AS [PromptRun],
    AIModality_ModalityID.[Name] AS [Modality],
    File_FileID.[Name] AS [File]
FROM
    [${flyway:defaultSchema}].[AIPromptRunMedia] AS a
INNER JOIN
    [${flyway:defaultSchema}].[AIPromptRun] AS AIPromptRun_PromptRunID
  ON
    [a].[PromptRunID] = AIPromptRun_PromptRunID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[AIModality] AS AIModality_ModalityID
  ON
    [a].[ModalityID] = AIModality_ModalityID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[File] AS File_FileID
  ON
    [a].[FileID] = File_FileID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwAIPromptRunMedias] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: AI Prompt Run Medias */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Prompt Run Medias
-- Item: Permissions for vwAIPromptRunMedias
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwAIPromptRunMedias] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: AI Prompt Run Medias */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Prompt Run Medias
-- Item: spCreateAIPromptRunMedia
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR AIPromptRunMedia
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateAIPromptRunMedia]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateAIPromptRunMedia];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateAIPromptRunMedia]
    @ID uniqueidentifier = NULL,
    @PromptRunID uniqueidentifier,
    @ModalityID uniqueidentifier,
    @MimeType nvarchar(100),
    @FileName nvarchar(255),
    @FileSizeBytes int,
    @Width int,
    @Height int,
    @DurationSeconds decimal(10, 2),
    @InlineData nvarchar(MAX),
    @FileID uniqueidentifier,
    @ThumbnailBase64 nvarchar(MAX),
    @Metadata nvarchar(MAX),
    @DisplayOrder int = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[AIPromptRunMedia]
            (
                [ID],
                [PromptRunID],
                [ModalityID],
                [MimeType],
                [FileName],
                [FileSizeBytes],
                [Width],
                [Height],
                [DurationSeconds],
                [InlineData],
                [FileID],
                [ThumbnailBase64],
                [Metadata],
                [DisplayOrder]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @PromptRunID,
                @ModalityID,
                @MimeType,
                @FileName,
                @FileSizeBytes,
                @Width,
                @Height,
                @DurationSeconds,
                @InlineData,
                @FileID,
                @ThumbnailBase64,
                @Metadata,
                ISNULL(@DisplayOrder, 0)
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[AIPromptRunMedia]
            (
                [PromptRunID],
                [ModalityID],
                [MimeType],
                [FileName],
                [FileSizeBytes],
                [Width],
                [Height],
                [DurationSeconds],
                [InlineData],
                [FileID],
                [ThumbnailBase64],
                [Metadata],
                [DisplayOrder]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @PromptRunID,
                @ModalityID,
                @MimeType,
                @FileName,
                @FileSizeBytes,
                @Width,
                @Height,
                @DurationSeconds,
                @InlineData,
                @FileID,
                @ThumbnailBase64,
                @Metadata,
                ISNULL(@DisplayOrder, 0)
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwAIPromptRunMedias] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateAIPromptRunMedia] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: AI Prompt Run Medias */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateAIPromptRunMedia] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: AI Prompt Run Medias */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Prompt Run Medias
-- Item: spUpdateAIPromptRunMedia
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR AIPromptRunMedia
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateAIPromptRunMedia]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateAIPromptRunMedia];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateAIPromptRunMedia]
    @ID uniqueidentifier,
    @PromptRunID uniqueidentifier,
    @ModalityID uniqueidentifier,
    @MimeType nvarchar(100),
    @FileName nvarchar(255),
    @FileSizeBytes int,
    @Width int,
    @Height int,
    @DurationSeconds decimal(10, 2),
    @InlineData nvarchar(MAX),
    @FileID uniqueidentifier,
    @ThumbnailBase64 nvarchar(MAX),
    @Metadata nvarchar(MAX),
    @DisplayOrder int
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIPromptRunMedia]
    SET
        [PromptRunID] = @PromptRunID,
        [ModalityID] = @ModalityID,
        [MimeType] = @MimeType,
        [FileName] = @FileName,
        [FileSizeBytes] = @FileSizeBytes,
        [Width] = @Width,
        [Height] = @Height,
        [DurationSeconds] = @DurationSeconds,
        [InlineData] = @InlineData,
        [FileID] = @FileID,
        [ThumbnailBase64] = @ThumbnailBase64,
        [Metadata] = @Metadata,
        [DisplayOrder] = @DisplayOrder
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwAIPromptRunMedias] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwAIPromptRunMedias]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateAIPromptRunMedia] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the AIPromptRunMedia table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateAIPromptRunMedia]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateAIPromptRunMedia];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateAIPromptRunMedia
ON [${flyway:defaultSchema}].[AIPromptRunMedia]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIPromptRunMedia]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[AIPromptRunMedia] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: AI Prompt Run Medias */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateAIPromptRunMedia] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: AI Prompt Run Medias */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Prompt Run Medias
-- Item: spDeleteAIPromptRunMedia
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR AIPromptRunMedia
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteAIPromptRunMedia]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteAIPromptRunMedia];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteAIPromptRunMedia]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[AIPromptRunMedia]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteAIPromptRunMedia] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: AI Prompt Run Medias */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteAIPromptRunMedia] TO [cdp_Integration]



/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'bd9a8820-378d-4998-8c73-7805c0ce3d6d'  OR 
               (EntityID = 'C21CD727-D771-450D-BAFA-104922931BFC' AND Name = 'AgentRun')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'bd9a8820-378d-4998-8c73-7805c0ce3d6d',
            'C21CD727-D771-450D-BAFA-104922931BFC', -- Entity: MJ: AI Agent Run Medias
            100037,
            'AgentRun',
            'Agent Run',
            NULL,
            'nvarchar',
            510,
            0,
            0,
            1,
            'null',
            0,
            0,
            1,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '8ad2cc07-6ca4-4c5f-b54b-0fe604bf6f2d'  OR 
               (EntityID = 'C21CD727-D771-450D-BAFA-104922931BFC' AND Name = 'Modality')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '8ad2cc07-6ca4-4c5f-b54b-0fe604bf6f2d',
            'C21CD727-D771-450D-BAFA-104922931BFC', -- Entity: MJ: AI Agent Run Medias
            100038,
            'Modality',
            'Modality',
            NULL,
            'nvarchar',
            100,
            0,
            0,
            0,
            'null',
            0,
            0,
            1,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '11f44c13-fd93-4f19-bb0d-50ffb4794a5e'  OR 
               (EntityID = 'C21CD727-D771-450D-BAFA-104922931BFC' AND Name = 'File')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '11f44c13-fd93-4f19-bb0d-50ffb4794a5e',
            'C21CD727-D771-450D-BAFA-104922931BFC', -- Entity: MJ: AI Agent Run Medias
            100039,
            'File',
            'File',
            NULL,
            'nvarchar',
            1000,
            0,
            0,
            1,
            'null',
            0,
            0,
            1,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '348803a9-dda4-491e-bbcf-f036f4c2b637'  OR 
               (EntityID = '228FF492-57AD-4097-922F-50441FD19BA0' AND Name = 'PromptRun')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '348803a9-dda4-491e-bbcf-f036f4c2b637',
            '228FF492-57AD-4097-922F-50441FD19BA0', -- Entity: MJ: AI Prompt Run Medias
            100033,
            'PromptRun',
            'Prompt Run',
            NULL,
            'nvarchar',
            510,
            0,
            0,
            1,
            'null',
            0,
            0,
            1,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '63f7b8eb-c5ee-4af5-83e1-4d5325c6eeac'  OR 
               (EntityID = '228FF492-57AD-4097-922F-50441FD19BA0' AND Name = 'Modality')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '63f7b8eb-c5ee-4af5-83e1-4d5325c6eeac',
            '228FF492-57AD-4097-922F-50441FD19BA0', -- Entity: MJ: AI Prompt Run Medias
            100034,
            'Modality',
            'Modality',
            NULL,
            'nvarchar',
            100,
            0,
            0,
            0,
            'null',
            0,
            0,
            1,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '9a45b252-0266-4877-ac5d-9508674cdf6d'  OR 
               (EntityID = '228FF492-57AD-4097-922F-50441FD19BA0' AND Name = 'File')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '9a45b252-0266-4877-ac5d-9508674cdf6d',
            '228FF492-57AD-4097-922F-50441FD19BA0', -- Entity: MJ: AI Prompt Run Medias
            100035,
            'File',
            'File',
            NULL,
            'nvarchar',
            1000,
            0,
            0,
            1,
            'null',
            0,
            0,
            1,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* Set field properties for entity */

            UPDATE [${flyway:defaultSchema}].EntityField
            SET IsNameField = 1
            WHERE ID = '3C807185-2F2B-41E3-B4B7-6AF0DF475E02'
            AND AutoUpdateIsNameField = 1
         

            UPDATE [${flyway:defaultSchema}].EntityField
            SET DefaultInView = 1
            WHERE ID = 'A59B40B9-3811-47A9-9484-7EC23CE5CFCB'
            AND AutoUpdateDefaultInView = 1
         

            UPDATE [${flyway:defaultSchema}].EntityField
            SET DefaultInView = 1
            WHERE ID = '3C807185-2F2B-41E3-B4B7-6AF0DF475E02'
            AND AutoUpdateDefaultInView = 1
         

            UPDATE [${flyway:defaultSchema}].EntityField
            SET DefaultInView = 1
            WHERE ID = 'FEC4A6C1-6D1F-441D-AE75-D45FA2927636'
            AND AutoUpdateDefaultInView = 1
         

            UPDATE [${flyway:defaultSchema}].EntityField
            SET DefaultInView = 1
            WHERE ID = 'DFA33632-D484-4AF1-95F4-BCEB512AE496'
            AND AutoUpdateDefaultInView = 1
         

            UPDATE [${flyway:defaultSchema}].EntityField
            SET DefaultInView = 1
            WHERE ID = 'DF17AD06-EDC1-40F0-A48C-7C57F0BE322F'
            AND AutoUpdateDefaultInView = 1
         

            UPDATE [${flyway:defaultSchema}].EntityField
            SET DefaultInView = 1
            WHERE ID = '348803A9-DDA4-491E-BBCF-F036F4C2B637'
            AND AutoUpdateDefaultInView = 1
         

            UPDATE [${flyway:defaultSchema}].EntityField
            SET DefaultInView = 1
            WHERE ID = '63F7B8EB-C5EE-4AF5-83E1-4D5325C6EEAC'
            AND AutoUpdateDefaultInView = 1
         

               UPDATE [${flyway:defaultSchema}].EntityField
               SET IncludeInUserSearchAPI = 1
               WHERE ID = 'A59B40B9-3811-47A9-9484-7EC23CE5CFCB'
               AND AutoUpdateIncludeInUserSearchAPI = 1
            

               UPDATE [${flyway:defaultSchema}].EntityField
               SET IncludeInUserSearchAPI = 1
               WHERE ID = '3C807185-2F2B-41E3-B4B7-6AF0DF475E02'
               AND AutoUpdateIncludeInUserSearchAPI = 1
            

               UPDATE [${flyway:defaultSchema}].EntityField
               SET IncludeInUserSearchAPI = 1
               WHERE ID = '348803A9-DDA4-491E-BBCF-F036F4C2B637'
               AND AutoUpdateIncludeInUserSearchAPI = 1
            

               UPDATE [${flyway:defaultSchema}].EntityField
               SET IncludeInUserSearchAPI = 1
               WHERE ID = '63F7B8EB-C5EE-4AF5-83E1-4D5325C6EEAC'
               AND AutoUpdateIncludeInUserSearchAPI = 1
            

/* Set field properties for entity */

            UPDATE [${flyway:defaultSchema}].EntityField
            SET IsNameField = 1
            WHERE ID = '6FEB9BB1-01A3-4D34-952D-FDCED06B55CA'
            AND AutoUpdateIsNameField = 1
         

            UPDATE [${flyway:defaultSchema}].EntityField
            SET DefaultInView = 1
            WHERE ID = '3EBCBC53-5FBD-4F6A-9F0F-7C9A6A96303E'
            AND AutoUpdateDefaultInView = 1
         

            UPDATE [${flyway:defaultSchema}].EntityField
            SET DefaultInView = 1
            WHERE ID = '121A46DA-FA89-4004-88DC-70A4E210319C'
            AND AutoUpdateDefaultInView = 1
         

            UPDATE [${flyway:defaultSchema}].EntityField
            SET DefaultInView = 1
            WHERE ID = '6FEB9BB1-01A3-4D34-952D-FDCED06B55CA'
            AND AutoUpdateDefaultInView = 1
         

            UPDATE [${flyway:defaultSchema}].EntityField
            SET DefaultInView = 1
            WHERE ID = '316F664E-9CE4-42D0-8291-867B3FBFF094'
            AND AutoUpdateDefaultInView = 1
         

            UPDATE [${flyway:defaultSchema}].EntityField
            SET DefaultInView = 1
            WHERE ID = '8AD2CC07-6CA4-4C5F-B54B-0FE604BF6F2D'
            AND AutoUpdateDefaultInView = 1
         

               UPDATE [${flyway:defaultSchema}].EntityField
               SET IncludeInUserSearchAPI = 1
               WHERE ID = '3EBCBC53-5FBD-4F6A-9F0F-7C9A6A96303E'
               AND AutoUpdateIncludeInUserSearchAPI = 1
            

               UPDATE [${flyway:defaultSchema}].EntityField
               SET IncludeInUserSearchAPI = 1
               WHERE ID = '121A46DA-FA89-4004-88DC-70A4E210319C'
               AND AutoUpdateIncludeInUserSearchAPI = 1
            

               UPDATE [${flyway:defaultSchema}].EntityField
               SET IncludeInUserSearchAPI = 1
               WHERE ID = '6FEB9BB1-01A3-4D34-952D-FDCED06B55CA'
               AND AutoUpdateIncludeInUserSearchAPI = 1
            

               UPDATE [${flyway:defaultSchema}].EntityField
               SET IncludeInUserSearchAPI = 1
               WHERE ID = 'BD9A8820-378D-4998-8C73-7805C0CE3D6D'
               AND AutoUpdateIncludeInUserSearchAPI = 1
            

               UPDATE [${flyway:defaultSchema}].EntityField
               SET IncludeInUserSearchAPI = 1
               WHERE ID = '8AD2CC07-6CA4-4C5F-B54B-0FE604BF6F2D'
               AND AutoUpdateIncludeInUserSearchAPI = 1
            

/* Set categories for 19 fields */
UPDATE [${flyway:defaultSchema}].EntityField
   SET Category = 'System Metadata',
       GeneratedFormSection = 'Category',
       DisplayName = 'ID',
       ExtendedType = NULL,
       CodeType = NULL
   WHERE ID = '130D5E45-D2FA-4C00-94E6-B1F28287215A'
   AND AutoUpdateCategory = 1
UPDATE [${flyway:defaultSchema}].EntityField
   SET Category = 'System Metadata',
       GeneratedFormSection = 'Category',
       DisplayName = 'Created At',
       ExtendedType = NULL,
       CodeType = NULL
   WHERE ID = '13A1EB13-184A-4A6B-8B3E-82CC6A83A8EB'
   AND AutoUpdateCategory = 1
UPDATE [${flyway:defaultSchema}].EntityField
   SET Category = 'System Metadata',
       GeneratedFormSection = 'Category',
       DisplayName = 'Updated At',
       ExtendedType = NULL,
       CodeType = NULL
   WHERE ID = 'AB9942F0-A077-431F-86FF-9A196C45423E'
   AND AutoUpdateCategory = 1
UPDATE [${flyway:defaultSchema}].EntityField
   SET Category = 'Association',
       GeneratedFormSection = 'Category',
       DisplayName = 'Prompt Run',
       ExtendedType = NULL,
       CodeType = NULL
   WHERE ID = '7B716E53-951C-44F5-A688-225FC0F04B75'
   AND AutoUpdateCategory = 1
UPDATE [${flyway:defaultSchema}].EntityField
   SET Category = 'Association',
       GeneratedFormSection = 'Category',
       DisplayName = 'Prompt Run',
       ExtendedType = NULL,
       CodeType = NULL
   WHERE ID = '348803A9-DDA4-491E-BBCF-F036F4C2B637'
   AND AutoUpdateCategory = 1
UPDATE [${flyway:defaultSchema}].EntityField
   SET Category = 'Association',
       GeneratedFormSection = 'Category',
       DisplayName = 'Modality',
       ExtendedType = NULL,
       CodeType = NULL
   WHERE ID = '8EE092AD-BD92-4FE7-A3F8-B94B6B6888DC'
   AND AutoUpdateCategory = 1
UPDATE [${flyway:defaultSchema}].EntityField
   SET Category = 'Association',
       GeneratedFormSection = 'Category',
       DisplayName = 'Modality',
       ExtendedType = NULL,
       CodeType = NULL
   WHERE ID = '63F7B8EB-C5EE-4AF5-83E1-4D5325C6EEAC'
   AND AutoUpdateCategory = 1
UPDATE [${flyway:defaultSchema}].EntityField
   SET Category = 'Association',
       GeneratedFormSection = 'Category',
       DisplayName = 'Display Order',
       ExtendedType = NULL,
       CodeType = NULL
   WHERE ID = '344F278B-E7A1-4375-BA2C-8615CCC47718'
   AND AutoUpdateCategory = 1
UPDATE [${flyway:defaultSchema}].EntityField
   SET Category = 'Media Metadata',
       GeneratedFormSection = 'Category',
       DisplayName = 'MIME Type',
       ExtendedType = NULL,
       CodeType = NULL
   WHERE ID = 'A59B40B9-3811-47A9-9484-7EC23CE5CFCB'
   AND AutoUpdateCategory = 1
UPDATE [${flyway:defaultSchema}].EntityField
   SET Category = 'Media Metadata',
       GeneratedFormSection = 'Category',
       DisplayName = 'File Name',
       ExtendedType = NULL,
       CodeType = NULL
   WHERE ID = '3C807185-2F2B-41E3-B4B7-6AF0DF475E02'
   AND AutoUpdateCategory = 1
UPDATE [${flyway:defaultSchema}].EntityField
   SET Category = 'Media Metadata',
       GeneratedFormSection = 'Category',
       DisplayName = 'File Size (Bytes)',
       ExtendedType = NULL,
       CodeType = NULL
   WHERE ID = '0CB636E1-F53B-483C-A561-C13CF41692C6'
   AND AutoUpdateCategory = 1
UPDATE [${flyway:defaultSchema}].EntityField
   SET Category = 'Media Metadata',
       GeneratedFormSection = 'Category',
       DisplayName = 'Width',
       ExtendedType = NULL,
       CodeType = NULL
   WHERE ID = 'FEC4A6C1-6D1F-441D-AE75-D45FA2927636'
   AND AutoUpdateCategory = 1
UPDATE [${flyway:defaultSchema}].EntityField
   SET Category = 'Media Metadata',
       GeneratedFormSection = 'Category',
       DisplayName = 'Height',
       ExtendedType = NULL,
       CodeType = NULL
   WHERE ID = 'DFA33632-D484-4AF1-95F4-BCEB512AE496'
   AND AutoUpdateCategory = 1
UPDATE [${flyway:defaultSchema}].EntityField
   SET Category = 'Media Metadata',
       GeneratedFormSection = 'Category',
       DisplayName = 'Duration (Seconds)',
       ExtendedType = NULL,
       CodeType = NULL
   WHERE ID = 'DF17AD06-EDC1-40F0-A48C-7C57F0BE322F'
   AND AutoUpdateCategory = 1
UPDATE [${flyway:defaultSchema}].EntityField
   SET Category = 'Media Metadata',
       GeneratedFormSection = 'Category',
       DisplayName = 'Metadata',
       ExtendedType = NULL,
       CodeType = NULL
   WHERE ID = 'F2F3E535-FDBD-4312-988A-19DDD434C840'
   AND AutoUpdateCategory = 1
UPDATE [${flyway:defaultSchema}].EntityField
   SET Category = 'Content Data',
       GeneratedFormSection = 'Category',
       DisplayName = 'Inline Data',
       ExtendedType = NULL,
       CodeType = NULL
   WHERE ID = '502A684F-F72D-41ED-998B-4913AE993487'
   AND AutoUpdateCategory = 1
UPDATE [${flyway:defaultSchema}].EntityField
   SET Category = 'Content Data',
       GeneratedFormSection = 'Category',
       DisplayName = 'File ID',
       ExtendedType = NULL,
       CodeType = NULL
   WHERE ID = '8FD697E8-4F1A-4DBE-B17E-6D099FE654FA'
   AND AutoUpdateCategory = 1
UPDATE [${flyway:defaultSchema}].EntityField
   SET Category = 'Content Data',
       GeneratedFormSection = 'Category',
       DisplayName = 'File',
       ExtendedType = NULL,
       CodeType = NULL
   WHERE ID = '9A45B252-0266-4877-AC5D-9508674CDF6D'
   AND AutoUpdateCategory = 1
UPDATE [${flyway:defaultSchema}].EntityField
   SET Category = 'Content Data',
       GeneratedFormSection = 'Category',
       DisplayName = 'Thumbnail (Base64)',
       ExtendedType = NULL,
       CodeType = NULL
   WHERE ID = '510D78B2-A971-4F5E-A4D8-71B5A0A7E9F1'
   AND AutoUpdateCategory = 1

/* Set categories for 21 fields */
UPDATE [${flyway:defaultSchema}].EntityField
   SET Category = 'Run Context',
       GeneratedFormSection = 'Category',
       DisplayName = 'Agent Run',
       ExtendedType = NULL,
       CodeType = NULL
   WHERE ID = 'F6640624-C8AA-40E9-9476-FC5B05138D79'
   AND AutoUpdateCategory = 1
UPDATE [${flyway:defaultSchema}].EntityField
   SET Category = 'Run Context',
       GeneratedFormSection = 'Category',
       DisplayName = 'Agent Run',
       ExtendedType = NULL,
       CodeType = NULL
   WHERE ID = 'BD9A8820-378D-4998-8C73-7805C0CE3D6D'
   AND AutoUpdateCategory = 1
UPDATE [${flyway:defaultSchema}].EntityField
   SET Category = 'Run Context',
       GeneratedFormSection = 'Category',
       DisplayName = 'Source Prompt Run Media',
       ExtendedType = NULL,
       CodeType = NULL
   WHERE ID = 'F5798CFE-136C-42CC-B751-979F29BA7DF9'
   AND AutoUpdateCategory = 1
UPDATE [${flyway:defaultSchema}].EntityField
   SET Category = 'Run Context',
       GeneratedFormSection = 'Category',
       DisplayName = 'Modality',
       ExtendedType = NULL,
       CodeType = NULL
   WHERE ID = 'A6D8BF95-BEA7-4412-AE17-A985E046863A'
   AND AutoUpdateCategory = 1
UPDATE [${flyway:defaultSchema}].EntityField
   SET Category = 'Run Context',
       GeneratedFormSection = 'Category',
       DisplayName = 'Modality Name',
       ExtendedType = NULL,
       CodeType = NULL
   WHERE ID = '8AD2CC07-6CA4-4C5F-B54B-0FE604BF6F2D'
   AND AutoUpdateCategory = 1
UPDATE [${flyway:defaultSchema}].EntityField
   SET Category = 'Run Context',
       GeneratedFormSection = 'Category',
       DisplayName = 'Label',
       ExtendedType = NULL,
       CodeType = NULL
   WHERE ID = '6FEB9BB1-01A3-4D34-952D-FDCED06B55CA'
   AND AutoUpdateCategory = 1
UPDATE [${flyway:defaultSchema}].EntityField
   SET Category = 'Run Context',
       GeneratedFormSection = 'Category',
       DisplayName = 'Display Order',
       ExtendedType = NULL,
       CodeType = NULL
   WHERE ID = '316F664E-9CE4-42D0-8291-867B3FBFF094'
   AND AutoUpdateCategory = 1
UPDATE [${flyway:defaultSchema}].EntityField
   SET Category = 'File Attributes',
       GeneratedFormSection = 'Category',
       DisplayName = 'File Name',
       ExtendedType = NULL,
       CodeType = NULL
   WHERE ID = '121A46DA-FA89-4004-88DC-70A4E210319C'
   AND AutoUpdateCategory = 1
UPDATE [${flyway:defaultSchema}].EntityField
   SET Category = 'File Attributes',
       GeneratedFormSection = 'Category',
       DisplayName = 'MIME Type',
       ExtendedType = NULL,
       CodeType = NULL
   WHERE ID = '3EBCBC53-5FBD-4F6A-9F0F-7C9A6A96303E'
   AND AutoUpdateCategory = 1
UPDATE [${flyway:defaultSchema}].EntityField
   SET Category = 'File Attributes',
       GeneratedFormSection = 'Category',
       DisplayName = 'File Size (Bytes)',
       ExtendedType = NULL,
       CodeType = NULL
   WHERE ID = '4C29A554-2DC8-44E4-8BD5-68455F3299E6'
   AND AutoUpdateCategory = 1
UPDATE [${flyway:defaultSchema}].EntityField
   SET Category = 'File Attributes',
       GeneratedFormSection = 'Category',
       DisplayName = 'Width',
       ExtendedType = NULL,
       CodeType = NULL
   WHERE ID = 'E01BFCEC-0843-49D0-9351-BCD4A91180C5'
   AND AutoUpdateCategory = 1
UPDATE [${flyway:defaultSchema}].EntityField
   SET Category = 'File Attributes',
       GeneratedFormSection = 'Category',
       DisplayName = 'Height',
       ExtendedType = NULL,
       CodeType = NULL
   WHERE ID = '5A3DF96C-A638-45CB-ADF8-CA910AF16158'
   AND AutoUpdateCategory = 1
UPDATE [${flyway:defaultSchema}].EntityField
   SET Category = 'File Attributes',
       GeneratedFormSection = 'Category',
       DisplayName = 'Duration (Seconds)',
       ExtendedType = NULL,
       CodeType = NULL
   WHERE ID = '0173B18F-1369-4E2D-9985-2676B1241F69'
   AND AutoUpdateCategory = 1
UPDATE [${flyway:defaultSchema}].EntityField
   SET Category = 'File Attributes',
       GeneratedFormSection = 'Category',
       DisplayName = 'File',
       ExtendedType = NULL,
       CodeType = NULL
   WHERE ID = '11F44C13-FD93-4F19-BB0D-50FFB4794A5E'
   AND AutoUpdateCategory = 1
UPDATE [${flyway:defaultSchema}].EntityField
   SET Category = 'File Attributes',
       GeneratedFormSection = 'Category',
       DisplayName = 'File ID',
       ExtendedType = NULL,
       CodeType = NULL
   WHERE ID = 'D5BC6DA5-A541-4D2B-B1E6-2A2171BB1F5A'
   AND AutoUpdateCategory = 1
UPDATE [${flyway:defaultSchema}].EntityField
   SET Category = 'Media Content',
       GeneratedFormSection = 'Category',
       DisplayName = 'Inline Data',
       ExtendedType = NULL,
       CodeType = NULL
   WHERE ID = '4E624F95-8368-4B70-BB73-20AEDA8C7D0A'
   AND AutoUpdateCategory = 1
UPDATE [${flyway:defaultSchema}].EntityField
   SET Category = 'Media Content',
       GeneratedFormSection = 'Category',
       DisplayName = 'Thumbnail (Base64)',
       ExtendedType = NULL,
       CodeType = NULL
   WHERE ID = '42CA522B-7A45-48CA-9BC5-7A77C13C2557'
   AND AutoUpdateCategory = 1
UPDATE [${flyway:defaultSchema}].EntityField
   SET Category = 'Media Content',
       GeneratedFormSection = 'Category',
       DisplayName = 'Metadata',
       ExtendedType = NULL,
       CodeType = NULL
   WHERE ID = 'C271F34B-36F6-4F6B-8928-904FC0AB628D'
   AND AutoUpdateCategory = 1
UPDATE [${flyway:defaultSchema}].EntityField
   SET Category = 'System Metadata',
       GeneratedFormSection = 'Category',
       DisplayName = 'ID',
       ExtendedType = NULL,
       CodeType = NULL
   WHERE ID = '9882EB6B-C103-4B37-A823-BB066C66204D'
   AND AutoUpdateCategory = 1
UPDATE [${flyway:defaultSchema}].EntityField
   SET Category = 'System Metadata',
       GeneratedFormSection = 'Category',
       DisplayName = 'Created At',
       ExtendedType = NULL,
       CodeType = NULL
   WHERE ID = '71155CD3-AB80-4CB9-AA59-E431FEBD29DF'
   AND AutoUpdateCategory = 1
UPDATE [${flyway:defaultSchema}].EntityField
   SET Category = 'System Metadata',
       GeneratedFormSection = 'Category',
       DisplayName = 'Updated At',
       ExtendedType = NULL,
       CodeType = NULL
   WHERE ID = '7A7CEA6B-F52C-443C-B2EB-4F1AAA6D58EA'
   AND AutoUpdateCategory = 1

/* Set entity icon to fa fa-robot */

                  UPDATE [${flyway:defaultSchema}].Entity
                  SET Icon = 'fa fa-robot',
                      __mj_UpdatedAt = GETUTCDATE()
                  WHERE ID = 'C21CD727-D771-450D-BAFA-104922931BFC'
               

/* Set entity icon to fa fa-image */

                  UPDATE [${flyway:defaultSchema}].Entity
                  SET Icon = 'fa fa-image',
                      __mj_UpdatedAt = GETUTCDATE()
                  WHERE ID = '228FF492-57AD-4097-922F-50441FD19BA0'
               

/* Insert FieldCategoryInfo setting for entity */

               INSERT INTO [${flyway:defaultSchema}].EntitySetting (ID, EntityID, Name, Value, __mj_CreatedAt, __mj_UpdatedAt)
               VALUES ('3bf9b071-766d-42fc-b1f2-d97d8c868ec2', '228FF492-57AD-4097-922F-50441FD19BA0', 'FieldCategoryInfo', '{"System Metadata":{"icon":"fa fa-cog","description":"Technical audit fields that track record creation and modification"},"Association":{"icon":"fa fa-link","description":"Fields that link a media item to a prompt run, modality, and define display ordering"},"Media Metadata":{"icon":"fa fa-image","description":"Core descriptive attributes of the media file such as type, size, dimensions and duration"},"Content Data":{"icon":"fa fa-database","description":"Raw data and storage references for the media content, including inline data and thumbnails"}}', GETUTCDATE(), GETUTCDATE())
            

/* Insert FieldCategoryInfo setting for entity */

               INSERT INTO [${flyway:defaultSchema}].EntitySetting (ID, EntityID, Name, Value, __mj_CreatedAt, __mj_UpdatedAt)
               VALUES ('b045581f-08a7-4f55-ac19-f6970ac518c4', 'C21CD727-D771-450D-BAFA-104922931BFC', 'FieldCategoryInfo', '{"Run Context":{"icon":"fa fa-robot","description":"Information that ties a media item to a specific AI agent run, including identifiers, labels and ordering"},"File Attributes":{"icon":"fa fa-file","description":"Technical specifications of the stored media file such as name, type, size, dimensions and duration"},"Media Content":{"icon":"fa fa-image","description":"Embedded data, thumbnail previews and supplemental metadata describing the media"},"System Metadata":{"icon":"fa fa-cog","description":"Systemmanaged audit fields and primary identifier"}}', GETUTCDATE(), GETUTCDATE())
            

/* Insert FieldCategoryIcons setting for entity (legacy format) */

               INSERT INTO [${flyway:defaultSchema}].EntitySetting (ID, EntityID, Name, Value, __mj_CreatedAt, __mj_UpdatedAt)
               VALUES ('9b39af43-1c1a-4c04-a465-7960ceb3bc1b', '228FF492-57AD-4097-922F-50441FD19BA0', 'FieldCategoryIcons', '{"System Metadata":"fa fa-cog","Association":"fa fa-link","Media Metadata":"fa fa-image","Content Data":"fa fa-database"}', GETUTCDATE(), GETUTCDATE())
            

/* Insert FieldCategoryIcons setting for entity (legacy format) */

               INSERT INTO [${flyway:defaultSchema}].EntitySetting (ID, EntityID, Name, Value, __mj_CreatedAt, __mj_UpdatedAt)
               VALUES ('80ce3b43-9634-4f75-ae0d-7fea4807bd8a', 'C21CD727-D771-450D-BAFA-104922931BFC', 'FieldCategoryIcons', '{"Run Context":"fa fa-robot","File Attributes":"fa fa-file","Media Content":"fa fa-image","System Metadata":"fa fa-cog"}', GETUTCDATE(), GETUTCDATE())
            

/* Set DefaultForNewUser=1 for NEW entity based on AI analysis (category: primary, confidence: high) */

            UPDATE [${flyway:defaultSchema}].ApplicationEntity
            SET DefaultForNewUser = 1,
                __mj_UpdatedAt = GETUTCDATE()
            WHERE EntityID = 'C21CD727-D771-450D-BAFA-104922931BFC'
         

/* Set DefaultForNewUser=1 for NEW entity based on AI analysis (category: primary, confidence: medium) */

            UPDATE [${flyway:defaultSchema}].ApplicationEntity
            SET DefaultForNewUser = 1,
                __mj_UpdatedAt = GETUTCDATE()
            WHERE EntityID = '228FF492-57AD-4097-922F-50441FD19BA0'
         

