/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '1dc5dc58-e981-4f89-a78a-b73b8534cd18'  OR 
               (EntityID = 'AE731C66-02F2-4798-B8F4-4D9ED6AB35DB' AND Name = 'DetectedEmotion')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '1dc5dc58-e981-4f89-a78a-b73b8534cd18',
            'AE731C66-02F2-4798-B8F4-4D9ED6AB35DB', -- Entity: Song Journals
            100019,
            'DetectedEmotion',
            'Detected Emotion',
            'AI-detected emotion from the journal entry (e.g., Joy, Nostalgia, Melancholy, Energy, Peace, Love)',
            'nvarchar',
            200,
            0,
            0,
            1,
            'null',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* Index for Foreign Keys for SongJournal */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Song Journals
-- Item: Index for Foreign Keys
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------
-- Index for foreign key UserID in table SongJournal
IF NOT EXISTS (
    SELECT 1
    FROM sys.indexes
    WHERE name = 'IDX_AUTO_MJ_FKEY_SongJournal_UserID' 
    AND object_id = OBJECT_ID('[spotify].[SongJournal]')
)
CREATE INDEX IDX_AUTO_MJ_FKEY_SongJournal_UserID ON [spotify].[SongJournal] ([UserID]);

-- Index for foreign key SongID in table SongJournal
IF NOT EXISTS (
    SELECT 1
    FROM sys.indexes
    WHERE name = 'IDX_AUTO_MJ_FKEY_SongJournal_SongID' 
    AND object_id = OBJECT_ID('[spotify].[SongJournal]')
)
CREATE INDEX IDX_AUTO_MJ_FKEY_SongJournal_SongID ON [spotify].[SongJournal] ([SongID]);

/* Base View SQL for Song Journals */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Song Journals
-- Item: vwSongJournals
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      Song Journals
-----               SCHEMA:      spotify
-----               BASE TABLE:  SongJournal
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[spotify].[vwSongJournals]', 'V') IS NOT NULL
    DROP VIEW [spotify].[vwSongJournals];
GO

CREATE VIEW [spotify].[vwSongJournals]
AS
SELECT
    s.*,
    User_UserID.[Name] AS [User],
    Song_SongID.[Name] AS [Song]
FROM
    [spotify].[SongJournal] AS s
INNER JOIN
    [${flyway:defaultSchema}].[User] AS User_UserID
  ON
    [s].[UserID] = User_UserID.[ID]
INNER JOIN
    [spotify].[Song] AS Song_SongID
  ON
    [s].[SongID] = Song_SongID.[ID]
GO
GRANT SELECT ON [spotify].[vwSongJournals] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for Song Journals */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Song Journals
-- Item: Permissions for vwSongJournals
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [spotify].[vwSongJournals] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for Song Journals */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Song Journals
-- Item: spCreateSongJournal
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR SongJournal
------------------------------------------------------------
IF OBJECT_ID('[spotify].[spCreateSongJournal]', 'P') IS NOT NULL
    DROP PROCEDURE [spotify].[spCreateSongJournal];
GO

CREATE PROCEDURE [spotify].[spCreateSongJournal]
    @ID uniqueidentifier = NULL,
    @UserID uniqueidentifier,
    @SongID uniqueidentifier,
    @JournalEntry nvarchar(MAX),
    @ReflectionYear int,
    @ReflectionMonth int,
    @DetectedEmotion nvarchar(100)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [spotify].[SongJournal]
            (
                [ID],
                [UserID],
                [SongID],
                [JournalEntry],
                [ReflectionYear],
                [ReflectionMonth],
                [DetectedEmotion]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @UserID,
                @SongID,
                @JournalEntry,
                @ReflectionYear,
                @ReflectionMonth,
                @DetectedEmotion
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [spotify].[SongJournal]
            (
                [UserID],
                [SongID],
                [JournalEntry],
                [ReflectionYear],
                [ReflectionMonth],
                [DetectedEmotion]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @UserID,
                @SongID,
                @JournalEntry,
                @ReflectionYear,
                @ReflectionMonth,
                @DetectedEmotion
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [spotify].[vwSongJournals] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [spotify].[spCreateSongJournal] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for Song Journals */

GRANT EXECUTE ON [spotify].[spCreateSongJournal] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for Song Journals */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Song Journals
-- Item: spUpdateSongJournal
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR SongJournal
------------------------------------------------------------
IF OBJECT_ID('[spotify].[spUpdateSongJournal]', 'P') IS NOT NULL
    DROP PROCEDURE [spotify].[spUpdateSongJournal];
GO

CREATE PROCEDURE [spotify].[spUpdateSongJournal]
    @ID uniqueidentifier,
    @UserID uniqueidentifier,
    @SongID uniqueidentifier,
    @JournalEntry nvarchar(MAX),
    @ReflectionYear int,
    @ReflectionMonth int,
    @DetectedEmotion nvarchar(100)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [spotify].[SongJournal]
    SET
        [UserID] = @UserID,
        [SongID] = @SongID,
        [JournalEntry] = @JournalEntry,
        [ReflectionYear] = @ReflectionYear,
        [ReflectionMonth] = @ReflectionMonth,
        [DetectedEmotion] = @DetectedEmotion
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [spotify].[vwSongJournals] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [spotify].[vwSongJournals]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [spotify].[spUpdateSongJournal] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the SongJournal table
------------------------------------------------------------
IF OBJECT_ID('[spotify].[trgUpdateSongJournal]', 'TR') IS NOT NULL
    DROP TRIGGER [spotify].[trgUpdateSongJournal];
GO
CREATE TRIGGER [spotify].trgUpdateSongJournal
ON [spotify].[SongJournal]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [spotify].[SongJournal]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [spotify].[SongJournal] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for Song Journals */

GRANT EXECUTE ON [spotify].[spUpdateSongJournal] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for Song Journals */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Song Journals
-- Item: spDeleteSongJournal
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR SongJournal
------------------------------------------------------------
IF OBJECT_ID('[spotify].[spDeleteSongJournal]', 'P') IS NOT NULL
    DROP PROCEDURE [spotify].[spDeleteSongJournal];
GO

CREATE PROCEDURE [spotify].[spDeleteSongJournal]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [spotify].[SongJournal]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [spotify].[spDeleteSongJournal] TO [cdp_Integration]
    

/* spDelete Permissions for Song Journals */

GRANT EXECUTE ON [spotify].[spDeleteSongJournal] TO [cdp_Integration]



/* Set field properties for entity */

            UPDATE [${flyway:defaultSchema}].EntityField
            SET IsNameField = 1
            WHERE ID = 'C3119D2E-E017-488B-B39F-825164C786F7'
            AND AutoUpdateIsNameField = 1
         

            UPDATE [${flyway:defaultSchema}].EntityField
            SET DefaultInView = 1
            WHERE ID = 'C6DFFF3F-B8AD-4650-BEF7-F13B7314EA1E'
            AND AutoUpdateDefaultInView = 1
         

            UPDATE [${flyway:defaultSchema}].EntityField
            SET DefaultInView = 1
            WHERE ID = '8E44EF6F-0E15-4E99-9694-5EB5D530344D'
            AND AutoUpdateDefaultInView = 1
         

            UPDATE [${flyway:defaultSchema}].EntityField
            SET DefaultInView = 1
            WHERE ID = '1DC5DC58-E981-4F89-A78A-B73B8534CD18'
            AND AutoUpdateDefaultInView = 1
         

            UPDATE [${flyway:defaultSchema}].EntityField
            SET DefaultInView = 1
            WHERE ID = '13D4CFB9-0FCD-4451-A3D8-3B7AEC25CC40'
            AND AutoUpdateDefaultInView = 1
         

            UPDATE [${flyway:defaultSchema}].EntityField
            SET DefaultInView = 1
            WHERE ID = 'C3119D2E-E017-488B-B39F-825164C786F7'
            AND AutoUpdateDefaultInView = 1
         

               UPDATE [${flyway:defaultSchema}].EntityField
               SET IncludeInUserSearchAPI = 1
               WHERE ID = '1DC5DC58-E981-4F89-A78A-B73B8534CD18'
               AND AutoUpdateIncludeInUserSearchAPI = 1
            

               UPDATE [${flyway:defaultSchema}].EntityField
               SET IncludeInUserSearchAPI = 1
               WHERE ID = '13D4CFB9-0FCD-4451-A3D8-3B7AEC25CC40'
               AND AutoUpdateIncludeInUserSearchAPI = 1
            

               UPDATE [${flyway:defaultSchema}].EntityField
               SET IncludeInUserSearchAPI = 1
               WHERE ID = 'C3119D2E-E017-488B-B39F-825164C786F7'
               AND AutoUpdateIncludeInUserSearchAPI = 1
            

/* Set categories for 11 fields */
UPDATE [${flyway:defaultSchema}].EntityField
   SET Category = 'System Metadata',
       GeneratedFormSection = 'Category',
       DisplayName = 'ID',
       ExtendedType = NULL,
       CodeType = NULL
   WHERE ID = 'D0B4B749-FB4C-4BD6-8080-CAC1257E61B1'
   AND AutoUpdateCategory = 1
UPDATE [${flyway:defaultSchema}].EntityField
   SET Category = 'System Metadata',
       GeneratedFormSection = 'Category',
       DisplayName = 'Created At',
       ExtendedType = NULL,
       CodeType = NULL
   WHERE ID = '09501377-BB3B-4AD9-93D6-28658D33A16A'
   AND AutoUpdateCategory = 1
UPDATE [${flyway:defaultSchema}].EntityField
   SET Category = 'System Metadata',
       GeneratedFormSection = 'Category',
       DisplayName = 'Updated At',
       ExtendedType = NULL,
       CodeType = NULL
   WHERE ID = '0B178956-DC1C-4D7B-B2C8-60F80ED3C204'
   AND AutoUpdateCategory = 1
UPDATE [${flyway:defaultSchema}].EntityField
   SET Category = 'Associations',
       GeneratedFormSection = 'Category',
       DisplayName = 'User',
       ExtendedType = NULL,
       CodeType = NULL
   WHERE ID = 'B79C024B-62FE-4FA7-AC3D-6E16329F2BF1'
   AND AutoUpdateCategory = 1
UPDATE [${flyway:defaultSchema}].EntityField
   SET Category = 'Associations',
       GeneratedFormSection = 'Category',
       DisplayName = 'User Name',
       ExtendedType = NULL,
       CodeType = NULL
   WHERE ID = '13D4CFB9-0FCD-4451-A3D8-3B7AEC25CC40'
   AND AutoUpdateCategory = 1
UPDATE [${flyway:defaultSchema}].EntityField
   SET Category = 'Associations',
       GeneratedFormSection = 'Category',
       DisplayName = 'Song',
       ExtendedType = NULL,
       CodeType = NULL
   WHERE ID = '9EA31CEA-9C03-4947-86D7-E4FCA8239201'
   AND AutoUpdateCategory = 1
UPDATE [${flyway:defaultSchema}].EntityField
   SET Category = 'Associations',
       GeneratedFormSection = 'Category',
       DisplayName = 'Song Title',
       ExtendedType = NULL,
       CodeType = NULL
   WHERE ID = 'C3119D2E-E017-488B-B39F-825164C786F7'
   AND AutoUpdateCategory = 1
UPDATE [${flyway:defaultSchema}].EntityField
   SET Category = 'Entry Details',
       GeneratedFormSection = 'Category',
       DisplayName = 'Journal Entry',
       ExtendedType = NULL,
       CodeType = NULL
   WHERE ID = '0F425ADF-0CE6-47F0-854D-161C47C6D00F'
   AND AutoUpdateCategory = 1
UPDATE [${flyway:defaultSchema}].EntityField
   SET Category = 'Entry Details',
       GeneratedFormSection = 'Category',
       DisplayName = 'Detected Emotion',
       ExtendedType = NULL,
       CodeType = NULL
   WHERE ID = '1DC5DC58-E981-4F89-A78A-B73B8534CD18'
   AND AutoUpdateCategory = 1
UPDATE [${flyway:defaultSchema}].EntityField
   SET Category = 'Entry Details',
       GeneratedFormSection = 'Category',
       DisplayName = 'Reflection Year',
       ExtendedType = NULL,
       CodeType = NULL
   WHERE ID = 'C6DFFF3F-B8AD-4650-BEF7-F13B7314EA1E'
   AND AutoUpdateCategory = 1
UPDATE [${flyway:defaultSchema}].EntityField
   SET Category = 'Entry Details',
       GeneratedFormSection = 'Category',
       DisplayName = 'Reflection Month',
       ExtendedType = NULL,
       CodeType = NULL
   WHERE ID = '8E44EF6F-0E15-4E99-9694-5EB5D530344D'
   AND AutoUpdateCategory = 1

/* Set entity icon to fa fa-music */

                  UPDATE [${flyway:defaultSchema}].Entity
                  SET Icon = 'fa fa-music',
                      __mj_UpdatedAt = GETUTCDATE()
                  WHERE ID = 'AE731C66-02F2-4798-B8F4-4D9ED6AB35DB'
               

/* Insert FieldCategoryInfo setting for entity */

               INSERT INTO [${flyway:defaultSchema}].EntitySetting (ID, EntityID, Name, Value, __mj_CreatedAt, __mj_UpdatedAt)
               VALUES ('aaef077c-b20c-4e9c-8d0d-b12dbf58fb91', 'AE731C66-02F2-4798-B8F4-4D9ED6AB35DB', 'FieldCategoryInfo', '{"Entry Details":{"icon":"fa fa-align-left","description":"User''s reflection text, AI‑detected emotion, and the listening date (year and month)."},"Associations":{"icon":"fa fa-link","description":"Links the journal entry to the user and song, including identifiers and display names."},"System Metadata":{"icon":"fa fa-cog","description":"Technical audit fields automatically managed by the system."}}', GETUTCDATE(), GETUTCDATE())
            

/* Insert FieldCategoryIcons setting for entity (legacy format) */

               INSERT INTO [${flyway:defaultSchema}].EntitySetting (ID, EntityID, Name, Value, __mj_CreatedAt, __mj_UpdatedAt)
               VALUES ('c2c1243a-68b1-4aa0-ae88-22aacdc2f3a7', 'AE731C66-02F2-4798-B8F4-4D9ED6AB35DB', 'FieldCategoryIcons', '{"Entry Details":"fa fa-align-left","Associations":"fa fa-link","System Metadata":"fa fa-cog"}', GETUTCDATE(), GETUTCDATE())
            

/* Generated Validation Functions for Enrollments */
-- CHECK constraint for Enrollments: Field: ProgressPercentage was newly set or modified since the last generation of the validation function, the code was regenerated and updating the GeneratedCode table with the new generated validation function
INSERT INTO [${flyway:defaultSchema}].[GeneratedCode] (CategoryID, GeneratedByModelID, GeneratedAt, Language, Status, Source, Code, Description, Name, LinkedEntityID, LinkedRecordPrimaryKey)
                      VALUES ((SELECT ID FROM ${flyway:defaultSchema}.vwGeneratedCodeCategories WHERE Name='CodeGen: Validators'), '8E1BADD5-D593-4F9B-90D4-BF6D8AFA74A0', GETUTCDATE(), 'TypeScript','Approved', '([ProgressPercentage]>=(0) AND [ProgressPercentage]<=(100))', 'public ValidateProgressPercentageRange(result: ValidationResult) {
	// If ProgressPercentage is set, it must be between 0 and 100 inclusive
	if (this.ProgressPercentage != null && (this.ProgressPercentage < 0 || this.ProgressPercentage > 100)) {
		result.Errors.push(new ValidationErrorInfo(
			"ProgressPercentage",
			"Progress percentage must be between 0 and 100.",
			this.ProgressPercentage,
			ValidationErrorType.Failure
		));
	}
}', 'Progress percentage, when provided, must be a value from 0 to 100. This ensures progress tracking stays within a realistic range and prevents invalid negative or overly large percentages.', 'ValidateProgressPercentageRange', 'DF238F34-2837-EF11-86D4-6045BDEE16E6', '7BC91CCF-C7EB-4C01-B627-E94984344D6A');
  
            

/* Generated Validation Functions for Listening Histories */
-- CHECK constraint for Listening Histories: Field: CompletionPercentage was newly set or modified since the last generation of the validation function, the code was regenerated and updating the GeneratedCode table with the new generated validation function
INSERT INTO [${flyway:defaultSchema}].[GeneratedCode] (CategoryID, GeneratedByModelID, GeneratedAt, Language, Status, Source, Code, Description, Name, LinkedEntityID, LinkedRecordPrimaryKey)
                      VALUES ((SELECT ID FROM ${flyway:defaultSchema}.vwGeneratedCodeCategories WHERE Name='CodeGen: Validators'), '8E1BADD5-D593-4F9B-90D4-BF6D8AFA74A0', GETUTCDATE(), 'TypeScript','Approved', '([CompletionPercentage]>=(0) AND [CompletionPercentage]<=(100))', 'public ValidateCompletionPercentageRange(result: ValidationResult) {
	// Ensure the field is set before applying range validation
	if (this.CompletionPercentage != null && (this.CompletionPercentage < 0 || this.CompletionPercentage > 100)) {
		result.Errors.push(new ValidationErrorInfo(
			"CompletionPercentage",
			"Completion percentage must be between 0 and 100.",
			this.CompletionPercentage,
			ValidationErrorType.Failure
		));
	}
}', 'Completion percentage must be between 0 and 100 when provided, ensuring the recorded listening progress is valid.', 'ValidateCompletionPercentageRange', 'DF238F34-2837-EF11-86D4-6045BDEE16E6', '4D0B1C35-F582-4DF3-A5AD-CAFD00AFC33B');
  
            -- CHECK constraint for Listening Histories: Field: PlayDuration was newly set or modified since the last generation of the validation function, the code was regenerated and updating the GeneratedCode table with the new generated validation function
INSERT INTO [${flyway:defaultSchema}].[GeneratedCode] (CategoryID, GeneratedByModelID, GeneratedAt, Language, Status, Source, Code, Description, Name, LinkedEntityID, LinkedRecordPrimaryKey)
                      VALUES ((SELECT ID FROM ${flyway:defaultSchema}.vwGeneratedCodeCategories WHERE Name='CodeGen: Validators'), '8E1BADD5-D593-4F9B-90D4-BF6D8AFA74A0', GETUTCDATE(), 'TypeScript','Approved', '([PlayDuration]>=(0))', 'public ValidatePlayDurationNonNegative(result: ValidationResult) {
	if (this.PlayDuration != null && this.PlayDuration < 0) {
		result.Errors.push(new ValidationErrorInfo(
			"PlayDuration",
			"Play duration must be zero or greater; negative values are not allowed.",
			this.PlayDuration,
			ValidationErrorType.Failure
		));
	}
}', 'Play duration must be zero or greater; negative values are not allowed when a duration is recorded.', 'ValidatePlayDurationNonNegative', 'DF238F34-2837-EF11-86D4-6045BDEE16E6', 'EA017D24-C479-4AEE-9645-94AAB39E0F53');
  
            

/* Generated Validation Functions for Resource Ratings */
-- CHECK constraint for Resource Ratings: Field: Rating was newly set or modified since the last generation of the validation function, the code was regenerated and updating the GeneratedCode table with the new generated validation function
INSERT INTO [${flyway:defaultSchema}].[GeneratedCode] (CategoryID, GeneratedByModelID, GeneratedAt, Language, Status, Source, Code, Description, Name, LinkedEntityID, LinkedRecordPrimaryKey)
                      VALUES ((SELECT ID FROM ${flyway:defaultSchema}.vwGeneratedCodeCategories WHERE Name='CodeGen: Validators'), '8E1BADD5-D593-4F9B-90D4-BF6D8AFA74A0', GETUTCDATE(), 'TypeScript','Approved', '([Rating]>=(1) AND [Rating]<=(5))', 'public ValidateRatingRange(result: ValidationResult) {
	if (this.Rating != null && (this.Rating < 1 || this.Rating > 5)) {
		result.Errors.push(new ValidationErrorInfo(
			"Rating",
			"Rating must be between 1 and 5",
			this.Rating,
			ValidationErrorType.Failure
		));
	}
}', 'Rating must be a whole number from 1 (lowest) to 5 (highest) for each review, ensuring consistent scoring.', 'ValidateRatingRange', 'DF238F34-2837-EF11-86D4-6045BDEE16E6', 'C368D2CB-F2B3-4947-801D-27613A162E9C');
  
            

/* Generated Validation Functions for Song Journals */
-- CHECK constraint for Song Journals: Field: ReflectionMonth was newly set or modified since the last generation of the validation function, the code was regenerated and updating the GeneratedCode table with the new generated validation function
INSERT INTO [${flyway:defaultSchema}].[GeneratedCode] (CategoryID, GeneratedByModelID, GeneratedAt, Language, Status, Source, Code, Description, Name, LinkedEntityID, LinkedRecordPrimaryKey)
                      VALUES ((SELECT ID FROM ${flyway:defaultSchema}.vwGeneratedCodeCategories WHERE Name='CodeGen: Validators'), '8E1BADD5-D593-4F9B-90D4-BF6D8AFA74A0', GETUTCDATE(), 'TypeScript','Approved', '([ReflectionMonth]>=(1) AND [ReflectionMonth]<=(12))', 'public ValidateReflectionMonthRange(result: ValidationResult) {
	if (this.ReflectionMonth < 1 || this.ReflectionMonth > 12) {
		result.Errors.push(new ValidationErrorInfo(
			"ReflectionMonth",
			"Reflection month must be between 1 and 12.",
			this.ReflectionMonth,
			ValidationErrorType.Failure
		));
	}
}', 'Reflection month must be a valid month number between 1 and 12. This ensures that each reflection is recorded for an actual calendar month and prevents invalid month values from being stored.', 'ValidateReflectionMonthRange', 'DF238F34-2837-EF11-86D4-6045BDEE16E6', '8E44EF6F-0E15-4E99-9694-5EB5D530344D');
  
            -- CHECK constraint for Song Journals: Field: ReflectionYear was newly set or modified since the last generation of the validation function, the code was regenerated and updating the GeneratedCode table with the new generated validation function
INSERT INTO [${flyway:defaultSchema}].[GeneratedCode] (CategoryID, GeneratedByModelID, GeneratedAt, Language, Status, Source, Code, Description, Name, LinkedEntityID, LinkedRecordPrimaryKey)
                      VALUES ((SELECT ID FROM ${flyway:defaultSchema}.vwGeneratedCodeCategories WHERE Name='CodeGen: Validators'), '8E1BADD5-D593-4F9B-90D4-BF6D8AFA74A0', GETUTCDATE(), 'TypeScript','Approved', '([ReflectionYear]>=(2020) AND [ReflectionYear]<=(2100))', 'public ValidateReflectionYearRange(result: ValidationResult) {
	if (this.ReflectionYear < 2020 || this.ReflectionYear > 2100) {
		result.Errors.push(new ValidationErrorInfo(
			"ReflectionYear",
			"Reflection year must be between 2020 and 2100.",
			this.ReflectionYear,
			ValidationErrorType.Failure
		));
	}
}', 'Reflection year must be between 2020 and 2100 inclusive, ensuring that reflections are recorded only for realistic years and preventing future or overly old dates.', 'ValidateReflectionYearRange', 'DF238F34-2837-EF11-86D4-6045BDEE16E6', 'C6DFFF3F-B8AD-4650-BEF7-F13B7314EA1E');
  
            

/* Generated Validation Functions for Songs */
-- CHECK constraint for Songs: Field: Duration was newly set or modified since the last generation of the validation function, the code was regenerated and updating the GeneratedCode table with the new generated validation function
INSERT INTO [${flyway:defaultSchema}].[GeneratedCode] (CategoryID, GeneratedByModelID, GeneratedAt, Language, Status, Source, Code, Description, Name, LinkedEntityID, LinkedRecordPrimaryKey)
                      VALUES ((SELECT ID FROM ${flyway:defaultSchema}.vwGeneratedCodeCategories WHERE Name='CodeGen: Validators'), '8E1BADD5-D593-4F9B-90D4-BF6D8AFA74A0', GETUTCDATE(), 'TypeScript','Approved', '([Duration]>(0))', 'public ValidateDurationGreaterThanZero(result: ValidationResult) {
	if (this.Duration <= 0) {
		result.Errors.push(new ValidationErrorInfo(
			"Duration",
			"Duration must be a positive number greater than 0",
			this.Duration,
			ValidationErrorType.Failure
		));
	}
}', 'Duration must be greater than zero, ensuring each track has a positive length.', 'ValidateDurationGreaterThanZero', 'DF238F34-2837-EF11-86D4-6045BDEE16E6', 'B1630B1B-6237-42E2-A1D0-E79310963329');
  
            -- CHECK constraint for Songs: Field: ReleaseYear was newly set or modified since the last generation of the validation function, the code was regenerated and updating the GeneratedCode table with the new generated validation function
INSERT INTO [${flyway:defaultSchema}].[GeneratedCode] (CategoryID, GeneratedByModelID, GeneratedAt, Language, Status, Source, Code, Description, Name, LinkedEntityID, LinkedRecordPrimaryKey)
                      VALUES ((SELECT ID FROM ${flyway:defaultSchema}.vwGeneratedCodeCategories WHERE Name='CodeGen: Validators'), '8E1BADD5-D593-4F9B-90D4-BF6D8AFA74A0', GETUTCDATE(), 'TypeScript','Approved', '([ReleaseYear]>=(1900) AND [ReleaseYear]<=(2100))', 'public ValidateReleaseYearRange(result: ValidationResult) {
	// Only validate when a year is supplied
	if (this.ReleaseYear != null && (this.ReleaseYear < 1900 || this.ReleaseYear > 2100)) {
		result.Errors.push(new ValidationErrorInfo(
			"ReleaseYear",
			"Release year must be between 1900 and 2100.",
			this.ReleaseYear,
			ValidationErrorType.Failure
		));
	}
}', 'Release year must be a realistic value: if a year is provided, it must be between 1900 and 2100 inclusive.', 'ValidateReleaseYearRange', 'DF238F34-2837-EF11-86D4-6045BDEE16E6', 'D4EA97AF-A8A4-4854-9808-12EA009A8B74');
  
            

/* Generated Validation Functions for User Year Summaries */
-- CHECK constraint for User Year Summaries: Field: TotalListens was newly set or modified since the last generation of the validation function, the code was regenerated and updating the GeneratedCode table with the new generated validation function
INSERT INTO [${flyway:defaultSchema}].[GeneratedCode] (CategoryID, GeneratedByModelID, GeneratedAt, Language, Status, Source, Code, Description, Name, LinkedEntityID, LinkedRecordPrimaryKey)
                      VALUES ((SELECT ID FROM ${flyway:defaultSchema}.vwGeneratedCodeCategories WHERE Name='CodeGen: Validators'), '8E1BADD5-D593-4F9B-90D4-BF6D8AFA74A0', GETUTCDATE(), 'TypeScript','Approved', '([TotalListens]>=(0))', 'public ValidateTotalListensNonNegative(result: ValidationResult) {
	// TotalListens must be zero or greater
	if (this.TotalListens < 0) {
		result.Errors.push(new ValidationErrorInfo(
			"TotalListens",
			"Total listens must be zero or greater; negative values are not allowed.",
			this.TotalListens,
			ValidationErrorType.Failure
		));
	}
}', 'Total listens must be zero or greater; negative values are not allowed, ensuring that listen counts are always non‑negative.', 'ValidateTotalListensNonNegative', 'DF238F34-2837-EF11-86D4-6045BDEE16E6', 'FD4BD426-47AF-4567-85BA-D592016FCE15');
  
            -- CHECK constraint for User Year Summaries: Field: TotalMinutesListened was newly set or modified since the last generation of the validation function, the code was regenerated and updating the GeneratedCode table with the new generated validation function
INSERT INTO [${flyway:defaultSchema}].[GeneratedCode] (CategoryID, GeneratedByModelID, GeneratedAt, Language, Status, Source, Code, Description, Name, LinkedEntityID, LinkedRecordPrimaryKey)
                      VALUES ((SELECT ID FROM ${flyway:defaultSchema}.vwGeneratedCodeCategories WHERE Name='CodeGen: Validators'), '8E1BADD5-D593-4F9B-90D4-BF6D8AFA74A0', GETUTCDATE(), 'TypeScript','Approved', '([TotalMinutesListened]>=(0))', 'public ValidateTotalMinutesListenedGreaterThanOrEqualZero(result: ValidationResult) {
	if (this.TotalMinutesListened < 0) {
		result.Errors.push(new ValidationErrorInfo(
			"TotalMinutesListened",
			"Total minutes listened cannot be negative; it must be zero or greater.",
			this.TotalMinutesListened,
			ValidationErrorType.Failure
		));
	}
}', 'Total minutes listened must be zero or more; negative values are not allowed.', 'ValidateTotalMinutesListenedGreaterThanOrEqualZero', 'DF238F34-2837-EF11-86D4-6045BDEE16E6', '9243970B-DF49-444D-9711-A4FB06D72907');
  
            -- CHECK constraint for User Year Summaries: Field: UniqueArtists was newly set or modified since the last generation of the validation function, the code was regenerated and updating the GeneratedCode table with the new generated validation function
INSERT INTO [${flyway:defaultSchema}].[GeneratedCode] (CategoryID, GeneratedByModelID, GeneratedAt, Language, Status, Source, Code, Description, Name, LinkedEntityID, LinkedRecordPrimaryKey)
                      VALUES ((SELECT ID FROM ${flyway:defaultSchema}.vwGeneratedCodeCategories WHERE Name='CodeGen: Validators'), '8E1BADD5-D593-4F9B-90D4-BF6D8AFA74A0', GETUTCDATE(), 'TypeScript','Approved', '([UniqueArtists]>=(0))', 'public ValidateUniqueArtistsGreaterOrEqualZero(result: ValidationResult) {
	if (this.UniqueArtists < 0) {
		result.Errors.push(new ValidationErrorInfo(
			"UniqueArtists",
			"Number of unique artists must be zero or a positive number.",
			this.UniqueArtists,
			ValidationErrorType.Failure
		));
	}
}', 'The number of unique artists recorded must be zero or a positive integer; negative values are not allowed, ensuring the count reflects a realistic, non‑negative total.', 'ValidateUniqueArtistsGreaterOrEqualZero', 'DF238F34-2837-EF11-86D4-6045BDEE16E6', '24CA112C-AA47-4D13-B120-16B961206510');
  
            -- CHECK constraint for User Year Summaries: Field: UniqueSongs was newly set or modified since the last generation of the validation function, the code was regenerated and updating the GeneratedCode table with the new generated validation function
INSERT INTO [${flyway:defaultSchema}].[GeneratedCode] (CategoryID, GeneratedByModelID, GeneratedAt, Language, Status, Source, Code, Description, Name, LinkedEntityID, LinkedRecordPrimaryKey)
                      VALUES ((SELECT ID FROM ${flyway:defaultSchema}.vwGeneratedCodeCategories WHERE Name='CodeGen: Validators'), '8E1BADD5-D593-4F9B-90D4-BF6D8AFA74A0', GETUTCDATE(), 'TypeScript','Approved', '([UniqueSongs]>=(0))', 'public ValidateUniqueSongsNonNegative(result: ValidationResult) {
	if (this.UniqueSongs < 0) {
		result.Errors.push(new ValidationErrorInfo(
			"UniqueSongs",
			"UniqueSongs must be zero or a positive number.",
			this.UniqueSongs,
			ValidationErrorType.Failure
		));
	}
}', 'UniqueSongs must be zero or a positive number, ensuring the count of distinct songs a user has cannot be negative, which keeps the listening statistics logically correct', 'ValidateUniqueSongsNonNegative', 'DF238F34-2837-EF11-86D4-6045BDEE16E6', '7D985A69-F76B-419A-B2F8-390999A26BB1');
  
            -- CHECK constraint for User Year Summaries: Field: Year was newly set or modified since the last generation of the validation function, the code was regenerated and updating the GeneratedCode table with the new generated validation function
INSERT INTO [${flyway:defaultSchema}].[GeneratedCode] (CategoryID, GeneratedByModelID, GeneratedAt, Language, Status, Source, Code, Description, Name, LinkedEntityID, LinkedRecordPrimaryKey)
                      VALUES ((SELECT ID FROM ${flyway:defaultSchema}.vwGeneratedCodeCategories WHERE Name='CodeGen: Validators'), '8E1BADD5-D593-4F9B-90D4-BF6D8AFA74A0', GETUTCDATE(), 'TypeScript','Approved', '([Year]>=(2020) AND [Year]<=(2100))', 'public ValidateYearRange(result: ValidationResult) {
	if (this.Year < 2020 || this.Year > 2100) {
		result.Errors.push(new ValidationErrorInfo(
			"Year",
			"Year must be between 2020 and 2100 inclusive.",
			this.Year,
			ValidationErrorType.Failure
		));
	}
}', 'Year must be between 2020 and 2100 inclusive, ensuring that only valid reporting years are recorded in the system', 'ValidateYearRange', 'DF238F34-2837-EF11-86D4-6045BDEE16E6', '158B699E-6E03-4F8A-B9E7-A203737AC4C9');
  
            

