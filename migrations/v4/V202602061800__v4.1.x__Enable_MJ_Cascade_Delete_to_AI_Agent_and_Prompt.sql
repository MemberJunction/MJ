-- Migration: Add CASCADE DELETE to AI Agent/Prompt Tables
-- Description: Enable cascade deletes for AI agent and prompt entities so that
--              deleting parent records automatically cleans up associated child records.
--
-- This fixes FK constraint errors when deleting AI records via MetadataSync or
-- through the MJ entity system, where child records would otherwise block deletion.
--

-- ============================================================================
-- Entity metadata CascadeDeletes flag
-- ============================================================================
-- Setting CascadeDeletes = 1 on these entities will cause CodeGen to regenerate
-- the delete stored procedures with cascade logic for child entities.

-- AI Agents: Cascades to AIAgentRun, AIAgentStep, AIAgentExample, AIAgentAction, etc.
UPDATE ${flyway:defaultSchema}.Entity
SET CascadeDeletes = 1
WHERE ID = 'CDB135CC-6D3C-480B-90AE-25B7805F82C1'; -- AI Agents

-- MJ: AI Agent Steps: Cascades to AIAgentStepPath
UPDATE ${flyway:defaultSchema}.Entity
SET CascadeDeletes = 1
WHERE ID = '416D6E4C-31EF-4BBC-AC27-277A192AA1D9'; -- MJ: AI Agent Steps

-- MJ: AI Agent Runs: Cascades to AIPromptRun, AIAgentRunMedia, AIAgentRunStep
UPDATE ${flyway:defaultSchema}.Entity
SET CascadeDeletes = 1
WHERE ID = '5190AF93-4C39-4429-BDAA-0AEB492A0256'; -- MJ: AI Agent Runs

-- MJ: AI Agent Run Steps: Has self-reference via ParentID, needs cascade for child steps
UPDATE ${flyway:defaultSchema}.Entity
SET CascadeDeletes = 1
WHERE ID = '99273DAD-560E-4ABC-8332-C97AB58B7463'; -- MJ: AI Agent Run Steps

-- AI Prompts: Cascades to AIPromptRun
UPDATE ${flyway:defaultSchema}.Entity
SET CascadeDeletes = 1
WHERE ID = '73AD0238-8B56-EF11-991A-6045BDEBA539'; -- AI Prompts

-- MJ: AI Prompt Runs: Cascades to AIPromptRunMedia
UPDATE ${flyway:defaultSchema}.Entity
SET CascadeDeletes = 1
WHERE ID = '7C1C98D0-3978-4CE8-8E3F-C90301E59767'; -- MJ: AI Prompt Runs

-- Actions: Cascades to ActionParam, ActionAuthorization, ActionLibrary, etc.
UPDATE ${flyway:defaultSchema}.Entity
SET CascadeDeletes = 1
WHERE ID = '38248F34-2837-EF11-86D4-6045BDEE16E6'; -- Actions

-- MJ: AI Configurations: Cascades to AIConfigurationParam, AIPromptModel, child AIConfigurations (self-ref)
UPDATE ${flyway:defaultSchema}.Entity
SET CascadeDeletes = 1
WHERE ID = '6AE1BBF0-2085-4D2F-B724-219DC4212026'; -- MJ: AI Configurations

/* spDelete SQL for Actions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Actions
-- Item: spDeleteAction
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR Action
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteAction]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteAction];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteAction]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    -- Cascade delete from ActionAuthorization using cursor to call spDeleteActionAuthorization
    DECLARE @ActionAuthorizations_ActionIDID uniqueidentifier
    DECLARE cascade_delete_ActionAuthorizations_ActionID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[ActionAuthorization]
        WHERE [ActionID] = @ID
    
    OPEN cascade_delete_ActionAuthorizations_ActionID_cursor
    FETCH NEXT FROM cascade_delete_ActionAuthorizations_ActionID_cursor INTO @ActionAuthorizations_ActionIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteActionAuthorization] @ID = @ActionAuthorizations_ActionIDID
        
        FETCH NEXT FROM cascade_delete_ActionAuthorizations_ActionID_cursor INTO @ActionAuthorizations_ActionIDID
    END
    
    CLOSE cascade_delete_ActionAuthorizations_ActionID_cursor
    DEALLOCATE cascade_delete_ActionAuthorizations_ActionID_cursor
    
    -- Cascade delete from ActionContext using cursor to call spDeleteActionContext
    DECLARE @ActionContexts_ActionIDID uniqueidentifier
    DECLARE cascade_delete_ActionContexts_ActionID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[ActionContext]
        WHERE [ActionID] = @ID
    
    OPEN cascade_delete_ActionContexts_ActionID_cursor
    FETCH NEXT FROM cascade_delete_ActionContexts_ActionID_cursor INTO @ActionContexts_ActionIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteActionContext] @ID = @ActionContexts_ActionIDID
        
        FETCH NEXT FROM cascade_delete_ActionContexts_ActionID_cursor INTO @ActionContexts_ActionIDID
    END
    
    CLOSE cascade_delete_ActionContexts_ActionID_cursor
    DEALLOCATE cascade_delete_ActionContexts_ActionID_cursor
    
    -- Cascade delete from ActionExecutionLog using cursor to call spDeleteActionExecutionLog
    DECLARE @ActionExecutionLogs_ActionIDID uniqueidentifier
    DECLARE cascade_delete_ActionExecutionLogs_ActionID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[ActionExecutionLog]
        WHERE [ActionID] = @ID
    
    OPEN cascade_delete_ActionExecutionLogs_ActionID_cursor
    FETCH NEXT FROM cascade_delete_ActionExecutionLogs_ActionID_cursor INTO @ActionExecutionLogs_ActionIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteActionExecutionLog] @ID = @ActionExecutionLogs_ActionIDID
        
        FETCH NEXT FROM cascade_delete_ActionExecutionLogs_ActionID_cursor INTO @ActionExecutionLogs_ActionIDID
    END
    
    CLOSE cascade_delete_ActionExecutionLogs_ActionID_cursor
    DEALLOCATE cascade_delete_ActionExecutionLogs_ActionID_cursor
    
    -- Cascade delete from ActionLibrary using cursor to call spDeleteActionLibrary
    DECLARE @ActionLibraries_ActionIDID uniqueidentifier
    DECLARE cascade_delete_ActionLibraries_ActionID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[ActionLibrary]
        WHERE [ActionID] = @ID
    
    OPEN cascade_delete_ActionLibraries_ActionID_cursor
    FETCH NEXT FROM cascade_delete_ActionLibraries_ActionID_cursor INTO @ActionLibraries_ActionIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteActionLibrary] @ID = @ActionLibraries_ActionIDID
        
        FETCH NEXT FROM cascade_delete_ActionLibraries_ActionID_cursor INTO @ActionLibraries_ActionIDID
    END
    
    CLOSE cascade_delete_ActionLibraries_ActionID_cursor
    DEALLOCATE cascade_delete_ActionLibraries_ActionID_cursor
    
    -- Cascade delete from ActionParam using cursor to call spDeleteActionParam
    DECLARE @ActionParams_ActionIDID uniqueidentifier
    DECLARE cascade_delete_ActionParams_ActionID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[ActionParam]
        WHERE [ActionID] = @ID
    
    OPEN cascade_delete_ActionParams_ActionID_cursor
    FETCH NEXT FROM cascade_delete_ActionParams_ActionID_cursor INTO @ActionParams_ActionIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteActionParam] @ID = @ActionParams_ActionIDID
        
        FETCH NEXT FROM cascade_delete_ActionParams_ActionID_cursor INTO @ActionParams_ActionIDID
    END
    
    CLOSE cascade_delete_ActionParams_ActionID_cursor
    DEALLOCATE cascade_delete_ActionParams_ActionID_cursor
    
    -- Cascade delete from ActionResultCode using cursor to call spDeleteActionResultCode
    DECLARE @ActionResultCodes_ActionIDID uniqueidentifier
    DECLARE cascade_delete_ActionResultCodes_ActionID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[ActionResultCode]
        WHERE [ActionID] = @ID
    
    OPEN cascade_delete_ActionResultCodes_ActionID_cursor
    FETCH NEXT FROM cascade_delete_ActionResultCodes_ActionID_cursor INTO @ActionResultCodes_ActionIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteActionResultCode] @ID = @ActionResultCodes_ActionIDID
        
        FETCH NEXT FROM cascade_delete_ActionResultCodes_ActionID_cursor INTO @ActionResultCodes_ActionIDID
    END
    
    CLOSE cascade_delete_ActionResultCodes_ActionID_cursor
    DEALLOCATE cascade_delete_ActionResultCodes_ActionID_cursor
    
    -- Cascade update on Action using cursor to call spUpdateAction
    DECLARE @Actions_ParentIDID uniqueidentifier
    DECLARE @Actions_ParentID_CategoryID uniqueidentifier
    DECLARE @Actions_ParentID_Name nvarchar(425)
    DECLARE @Actions_ParentID_Description nvarchar(MAX)
    DECLARE @Actions_ParentID_Type nvarchar(20)
    DECLARE @Actions_ParentID_UserPrompt nvarchar(MAX)
    DECLARE @Actions_ParentID_UserComments nvarchar(MAX)
    DECLARE @Actions_ParentID_Code nvarchar(MAX)
    DECLARE @Actions_ParentID_CodeComments nvarchar(MAX)
    DECLARE @Actions_ParentID_CodeApprovalStatus nvarchar(20)
    DECLARE @Actions_ParentID_CodeApprovalComments nvarchar(MAX)
    DECLARE @Actions_ParentID_CodeApprovedByUserID uniqueidentifier
    DECLARE @Actions_ParentID_CodeApprovedAt datetimeoffset
    DECLARE @Actions_ParentID_CodeLocked bit
    DECLARE @Actions_ParentID_ForceCodeGeneration bit
    DECLARE @Actions_ParentID_RetentionPeriod int
    DECLARE @Actions_ParentID_Status nvarchar(20)
    DECLARE @Actions_ParentID_DriverClass nvarchar(255)
    DECLARE @Actions_ParentID_ParentID uniqueidentifier
    DECLARE @Actions_ParentID_IconClass nvarchar(100)
    DECLARE @Actions_ParentID_DefaultCompactPromptID uniqueidentifier
    DECLARE cascade_update_Actions_ParentID_cursor CURSOR FOR
        SELECT [ID], [CategoryID], [Name], [Description], [Type], [UserPrompt], [UserComments], [Code], [CodeComments], [CodeApprovalStatus], [CodeApprovalComments], [CodeApprovedByUserID], [CodeApprovedAt], [CodeLocked], [ForceCodeGeneration], [RetentionPeriod], [Status], [DriverClass], [ParentID], [IconClass], [DefaultCompactPromptID]
        FROM [${flyway:defaultSchema}].[Action]
        WHERE [ParentID] = @ID

    OPEN cascade_update_Actions_ParentID_cursor
    FETCH NEXT FROM cascade_update_Actions_ParentID_cursor INTO @Actions_ParentIDID, @Actions_ParentID_CategoryID, @Actions_ParentID_Name, @Actions_ParentID_Description, @Actions_ParentID_Type, @Actions_ParentID_UserPrompt, @Actions_ParentID_UserComments, @Actions_ParentID_Code, @Actions_ParentID_CodeComments, @Actions_ParentID_CodeApprovalStatus, @Actions_ParentID_CodeApprovalComments, @Actions_ParentID_CodeApprovedByUserID, @Actions_ParentID_CodeApprovedAt, @Actions_ParentID_CodeLocked, @Actions_ParentID_ForceCodeGeneration, @Actions_ParentID_RetentionPeriod, @Actions_ParentID_Status, @Actions_ParentID_DriverClass, @Actions_ParentID_ParentID, @Actions_ParentID_IconClass, @Actions_ParentID_DefaultCompactPromptID

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @Actions_ParentID_ParentID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateAction] @ID = @Actions_ParentIDID, @CategoryID = @Actions_ParentID_CategoryID, @Name = @Actions_ParentID_Name, @Description = @Actions_ParentID_Description, @Type = @Actions_ParentID_Type, @UserPrompt = @Actions_ParentID_UserPrompt, @UserComments = @Actions_ParentID_UserComments, @Code = @Actions_ParentID_Code, @CodeComments = @Actions_ParentID_CodeComments, @CodeApprovalStatus = @Actions_ParentID_CodeApprovalStatus, @CodeApprovalComments = @Actions_ParentID_CodeApprovalComments, @CodeApprovedByUserID = @Actions_ParentID_CodeApprovedByUserID, @CodeApprovedAt = @Actions_ParentID_CodeApprovedAt, @CodeLocked = @Actions_ParentID_CodeLocked, @ForceCodeGeneration = @Actions_ParentID_ForceCodeGeneration, @RetentionPeriod = @Actions_ParentID_RetentionPeriod, @Status = @Actions_ParentID_Status, @DriverClass = @Actions_ParentID_DriverClass, @ParentID = @Actions_ParentID_ParentID, @IconClass = @Actions_ParentID_IconClass, @DefaultCompactPromptID = @Actions_ParentID_DefaultCompactPromptID

        FETCH NEXT FROM cascade_update_Actions_ParentID_cursor INTO @Actions_ParentIDID, @Actions_ParentID_CategoryID, @Actions_ParentID_Name, @Actions_ParentID_Description, @Actions_ParentID_Type, @Actions_ParentID_UserPrompt, @Actions_ParentID_UserComments, @Actions_ParentID_Code, @Actions_ParentID_CodeComments, @Actions_ParentID_CodeApprovalStatus, @Actions_ParentID_CodeApprovalComments, @Actions_ParentID_CodeApprovedByUserID, @Actions_ParentID_CodeApprovedAt, @Actions_ParentID_CodeLocked, @Actions_ParentID_ForceCodeGeneration, @Actions_ParentID_RetentionPeriod, @Actions_ParentID_Status, @Actions_ParentID_DriverClass, @Actions_ParentID_ParentID, @Actions_ParentID_IconClass, @Actions_ParentID_DefaultCompactPromptID
    END

    CLOSE cascade_update_Actions_ParentID_cursor
    DEALLOCATE cascade_update_Actions_ParentID_cursor
    
    -- Cascade update on AIAgentAction using cursor to call spUpdateAIAgentAction
    DECLARE @AIAgentActions_ActionIDID uniqueidentifier
    DECLARE @AIAgentActions_ActionID_AgentID uniqueidentifier
    DECLARE @AIAgentActions_ActionID_ActionID uniqueidentifier
    DECLARE @AIAgentActions_ActionID_Status nvarchar(15)
    DECLARE @AIAgentActions_ActionID_MinExecutionsPerRun int
    DECLARE @AIAgentActions_ActionID_MaxExecutionsPerRun int
    DECLARE @AIAgentActions_ActionID_ResultExpirationTurns int
    DECLARE @AIAgentActions_ActionID_ResultExpirationMode nvarchar(20)
    DECLARE @AIAgentActions_ActionID_CompactMode nvarchar(20)
    DECLARE @AIAgentActions_ActionID_CompactLength int
    DECLARE @AIAgentActions_ActionID_CompactPromptID uniqueidentifier
    DECLARE cascade_update_AIAgentActions_ActionID_cursor CURSOR FOR
        SELECT [ID], [AgentID], [ActionID], [Status], [MinExecutionsPerRun], [MaxExecutionsPerRun], [ResultExpirationTurns], [ResultExpirationMode], [CompactMode], [CompactLength], [CompactPromptID]
        FROM [${flyway:defaultSchema}].[AIAgentAction]
        WHERE [ActionID] = @ID

    OPEN cascade_update_AIAgentActions_ActionID_cursor
    FETCH NEXT FROM cascade_update_AIAgentActions_ActionID_cursor INTO @AIAgentActions_ActionIDID, @AIAgentActions_ActionID_AgentID, @AIAgentActions_ActionID_ActionID, @AIAgentActions_ActionID_Status, @AIAgentActions_ActionID_MinExecutionsPerRun, @AIAgentActions_ActionID_MaxExecutionsPerRun, @AIAgentActions_ActionID_ResultExpirationTurns, @AIAgentActions_ActionID_ResultExpirationMode, @AIAgentActions_ActionID_CompactMode, @AIAgentActions_ActionID_CompactLength, @AIAgentActions_ActionID_CompactPromptID

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @AIAgentActions_ActionID_ActionID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateAIAgentAction] @ID = @AIAgentActions_ActionIDID, @AgentID = @AIAgentActions_ActionID_AgentID, @ActionID = @AIAgentActions_ActionID_ActionID, @Status = @AIAgentActions_ActionID_Status, @MinExecutionsPerRun = @AIAgentActions_ActionID_MinExecutionsPerRun, @MaxExecutionsPerRun = @AIAgentActions_ActionID_MaxExecutionsPerRun, @ResultExpirationTurns = @AIAgentActions_ActionID_ResultExpirationTurns, @ResultExpirationMode = @AIAgentActions_ActionID_ResultExpirationMode, @CompactMode = @AIAgentActions_ActionID_CompactMode, @CompactLength = @AIAgentActions_ActionID_CompactLength, @CompactPromptID = @AIAgentActions_ActionID_CompactPromptID

        FETCH NEXT FROM cascade_update_AIAgentActions_ActionID_cursor INTO @AIAgentActions_ActionIDID, @AIAgentActions_ActionID_AgentID, @AIAgentActions_ActionID_ActionID, @AIAgentActions_ActionID_Status, @AIAgentActions_ActionID_MinExecutionsPerRun, @AIAgentActions_ActionID_MaxExecutionsPerRun, @AIAgentActions_ActionID_ResultExpirationTurns, @AIAgentActions_ActionID_ResultExpirationMode, @AIAgentActions_ActionID_CompactMode, @AIAgentActions_ActionID_CompactLength, @AIAgentActions_ActionID_CompactPromptID
    END

    CLOSE cascade_update_AIAgentActions_ActionID_cursor
    DEALLOCATE cascade_update_AIAgentActions_ActionID_cursor
    
    -- Cascade delete from EntityAction using cursor to call spDeleteEntityAction
    DECLARE @EntityActions_ActionIDID uniqueidentifier
    DECLARE cascade_delete_EntityActions_ActionID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[EntityAction]
        WHERE [ActionID] = @ID
    
    OPEN cascade_delete_EntityActions_ActionID_cursor
    FETCH NEXT FROM cascade_delete_EntityActions_ActionID_cursor INTO @EntityActions_ActionIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteEntityAction] @ID = @EntityActions_ActionIDID
        
        FETCH NEXT FROM cascade_delete_EntityActions_ActionID_cursor INTO @EntityActions_ActionIDID
    END
    
    CLOSE cascade_delete_EntityActions_ActionID_cursor
    DEALLOCATE cascade_delete_EntityActions_ActionID_cursor
    
    -- Cascade update on AIAgentStep using cursor to call spUpdateAIAgentStep
    DECLARE @MJ_AIAgentSteps_ActionIDID uniqueidentifier
    DECLARE @MJ_AIAgentSteps_ActionID_AgentID uniqueidentifier
    DECLARE @MJ_AIAgentSteps_ActionID_Name nvarchar(255)
    DECLARE @MJ_AIAgentSteps_ActionID_Description nvarchar(MAX)
    DECLARE @MJ_AIAgentSteps_ActionID_StepType nvarchar(20)
    DECLARE @MJ_AIAgentSteps_ActionID_StartingStep bit
    DECLARE @MJ_AIAgentSteps_ActionID_TimeoutSeconds int
    DECLARE @MJ_AIAgentSteps_ActionID_RetryCount int
    DECLARE @MJ_AIAgentSteps_ActionID_OnErrorBehavior nvarchar(20)
    DECLARE @MJ_AIAgentSteps_ActionID_ActionID uniqueidentifier
    DECLARE @MJ_AIAgentSteps_ActionID_SubAgentID uniqueidentifier
    DECLARE @MJ_AIAgentSteps_ActionID_PromptID uniqueidentifier
    DECLARE @MJ_AIAgentSteps_ActionID_ActionOutputMapping nvarchar(MAX)
    DECLARE @MJ_AIAgentSteps_ActionID_PositionX int
    DECLARE @MJ_AIAgentSteps_ActionID_PositionY int
    DECLARE @MJ_AIAgentSteps_ActionID_Width int
    DECLARE @MJ_AIAgentSteps_ActionID_Height int
    DECLARE @MJ_AIAgentSteps_ActionID_Status nvarchar(20)
    DECLARE @MJ_AIAgentSteps_ActionID_ActionInputMapping nvarchar(MAX)
    DECLARE @MJ_AIAgentSteps_ActionID_LoopBodyType nvarchar(50)
    DECLARE @MJ_AIAgentSteps_ActionID_Configuration nvarchar(MAX)
    DECLARE cascade_update_MJ_AIAgentSteps_ActionID_cursor CURSOR FOR
        SELECT [ID], [AgentID], [Name], [Description], [StepType], [StartingStep], [TimeoutSeconds], [RetryCount], [OnErrorBehavior], [ActionID], [SubAgentID], [PromptID], [ActionOutputMapping], [PositionX], [PositionY], [Width], [Height], [Status], [ActionInputMapping], [LoopBodyType], [Configuration]
        FROM [${flyway:defaultSchema}].[AIAgentStep]
        WHERE [ActionID] = @ID

    OPEN cascade_update_MJ_AIAgentSteps_ActionID_cursor
    FETCH NEXT FROM cascade_update_MJ_AIAgentSteps_ActionID_cursor INTO @MJ_AIAgentSteps_ActionIDID, @MJ_AIAgentSteps_ActionID_AgentID, @MJ_AIAgentSteps_ActionID_Name, @MJ_AIAgentSteps_ActionID_Description, @MJ_AIAgentSteps_ActionID_StepType, @MJ_AIAgentSteps_ActionID_StartingStep, @MJ_AIAgentSteps_ActionID_TimeoutSeconds, @MJ_AIAgentSteps_ActionID_RetryCount, @MJ_AIAgentSteps_ActionID_OnErrorBehavior, @MJ_AIAgentSteps_ActionID_ActionID, @MJ_AIAgentSteps_ActionID_SubAgentID, @MJ_AIAgentSteps_ActionID_PromptID, @MJ_AIAgentSteps_ActionID_ActionOutputMapping, @MJ_AIAgentSteps_ActionID_PositionX, @MJ_AIAgentSteps_ActionID_PositionY, @MJ_AIAgentSteps_ActionID_Width, @MJ_AIAgentSteps_ActionID_Height, @MJ_AIAgentSteps_ActionID_Status, @MJ_AIAgentSteps_ActionID_ActionInputMapping, @MJ_AIAgentSteps_ActionID_LoopBodyType, @MJ_AIAgentSteps_ActionID_Configuration

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @MJ_AIAgentSteps_ActionID_ActionID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateAIAgentStep] @ID = @MJ_AIAgentSteps_ActionIDID, @AgentID = @MJ_AIAgentSteps_ActionID_AgentID, @Name = @MJ_AIAgentSteps_ActionID_Name, @Description = @MJ_AIAgentSteps_ActionID_Description, @StepType = @MJ_AIAgentSteps_ActionID_StepType, @StartingStep = @MJ_AIAgentSteps_ActionID_StartingStep, @TimeoutSeconds = @MJ_AIAgentSteps_ActionID_TimeoutSeconds, @RetryCount = @MJ_AIAgentSteps_ActionID_RetryCount, @OnErrorBehavior = @MJ_AIAgentSteps_ActionID_OnErrorBehavior, @ActionID = @MJ_AIAgentSteps_ActionID_ActionID, @SubAgentID = @MJ_AIAgentSteps_ActionID_SubAgentID, @PromptID = @MJ_AIAgentSteps_ActionID_PromptID, @ActionOutputMapping = @MJ_AIAgentSteps_ActionID_ActionOutputMapping, @PositionX = @MJ_AIAgentSteps_ActionID_PositionX, @PositionY = @MJ_AIAgentSteps_ActionID_PositionY, @Width = @MJ_AIAgentSteps_ActionID_Width, @Height = @MJ_AIAgentSteps_ActionID_Height, @Status = @MJ_AIAgentSteps_ActionID_Status, @ActionInputMapping = @MJ_AIAgentSteps_ActionID_ActionInputMapping, @LoopBodyType = @MJ_AIAgentSteps_ActionID_LoopBodyType, @Configuration = @MJ_AIAgentSteps_ActionID_Configuration

        FETCH NEXT FROM cascade_update_MJ_AIAgentSteps_ActionID_cursor INTO @MJ_AIAgentSteps_ActionIDID, @MJ_AIAgentSteps_ActionID_AgentID, @MJ_AIAgentSteps_ActionID_Name, @MJ_AIAgentSteps_ActionID_Description, @MJ_AIAgentSteps_ActionID_StepType, @MJ_AIAgentSteps_ActionID_StartingStep, @MJ_AIAgentSteps_ActionID_TimeoutSeconds, @MJ_AIAgentSteps_ActionID_RetryCount, @MJ_AIAgentSteps_ActionID_OnErrorBehavior, @MJ_AIAgentSteps_ActionID_ActionID, @MJ_AIAgentSteps_ActionID_SubAgentID, @MJ_AIAgentSteps_ActionID_PromptID, @MJ_AIAgentSteps_ActionID_ActionOutputMapping, @MJ_AIAgentSteps_ActionID_PositionX, @MJ_AIAgentSteps_ActionID_PositionY, @MJ_AIAgentSteps_ActionID_Width, @MJ_AIAgentSteps_ActionID_Height, @MJ_AIAgentSteps_ActionID_Status, @MJ_AIAgentSteps_ActionID_ActionInputMapping, @MJ_AIAgentSteps_ActionID_LoopBodyType, @MJ_AIAgentSteps_ActionID_Configuration
    END

    CLOSE cascade_update_MJ_AIAgentSteps_ActionID_cursor
    DEALLOCATE cascade_update_MJ_AIAgentSteps_ActionID_cursor
    
    -- Cascade update on MCPServerTool using cursor to call spUpdateMCPServerTool
    DECLARE @MJ_MCPServerTools_GeneratedActionIDID uniqueidentifier
    DECLARE @MJ_MCPServerTools_GeneratedActionID_MCPServerID uniqueidentifier
    DECLARE @MJ_MCPServerTools_GeneratedActionID_ToolName nvarchar(255)
    DECLARE @MJ_MCPServerTools_GeneratedActionID_ToolTitle nvarchar(255)
    DECLARE @MJ_MCPServerTools_GeneratedActionID_ToolDescription nvarchar(MAX)
    DECLARE @MJ_MCPServerTools_GeneratedActionID_InputSchema nvarchar(MAX)
    DECLARE @MJ_MCPServerTools_GeneratedActionID_OutputSchema nvarchar(MAX)
    DECLARE @MJ_MCPServerTools_GeneratedActionID_Annotations nvarchar(MAX)
    DECLARE @MJ_MCPServerTools_GeneratedActionID_Status nvarchar(50)
    DECLARE @MJ_MCPServerTools_GeneratedActionID_DiscoveredAt datetimeoffset
    DECLARE @MJ_MCPServerTools_GeneratedActionID_LastSeenAt datetimeoffset
    DECLARE @MJ_MCPServerTools_GeneratedActionID_GeneratedActionID uniqueidentifier
    DECLARE @MJ_MCPServerTools_GeneratedActionID_GeneratedActionCategoryID uniqueidentifier
    DECLARE cascade_update_MJ_MCPServerTools_GeneratedActionID_cursor CURSOR FOR
        SELECT [ID], [MCPServerID], [ToolName], [ToolTitle], [ToolDescription], [InputSchema], [OutputSchema], [Annotations], [Status], [DiscoveredAt], [LastSeenAt], [GeneratedActionID], [GeneratedActionCategoryID]
        FROM [${flyway:defaultSchema}].[MCPServerTool]
        WHERE [GeneratedActionID] = @ID

    OPEN cascade_update_MJ_MCPServerTools_GeneratedActionID_cursor
    FETCH NEXT FROM cascade_update_MJ_MCPServerTools_GeneratedActionID_cursor INTO @MJ_MCPServerTools_GeneratedActionIDID, @MJ_MCPServerTools_GeneratedActionID_MCPServerID, @MJ_MCPServerTools_GeneratedActionID_ToolName, @MJ_MCPServerTools_GeneratedActionID_ToolTitle, @MJ_MCPServerTools_GeneratedActionID_ToolDescription, @MJ_MCPServerTools_GeneratedActionID_InputSchema, @MJ_MCPServerTools_GeneratedActionID_OutputSchema, @MJ_MCPServerTools_GeneratedActionID_Annotations, @MJ_MCPServerTools_GeneratedActionID_Status, @MJ_MCPServerTools_GeneratedActionID_DiscoveredAt, @MJ_MCPServerTools_GeneratedActionID_LastSeenAt, @MJ_MCPServerTools_GeneratedActionID_GeneratedActionID, @MJ_MCPServerTools_GeneratedActionID_GeneratedActionCategoryID

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @MJ_MCPServerTools_GeneratedActionID_GeneratedActionID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateMCPServerTool] @ID = @MJ_MCPServerTools_GeneratedActionIDID, @MCPServerID = @MJ_MCPServerTools_GeneratedActionID_MCPServerID, @ToolName = @MJ_MCPServerTools_GeneratedActionID_ToolName, @ToolTitle = @MJ_MCPServerTools_GeneratedActionID_ToolTitle, @ToolDescription = @MJ_MCPServerTools_GeneratedActionID_ToolDescription, @InputSchema = @MJ_MCPServerTools_GeneratedActionID_InputSchema, @OutputSchema = @MJ_MCPServerTools_GeneratedActionID_OutputSchema, @Annotations = @MJ_MCPServerTools_GeneratedActionID_Annotations, @Status = @MJ_MCPServerTools_GeneratedActionID_Status, @DiscoveredAt = @MJ_MCPServerTools_GeneratedActionID_DiscoveredAt, @LastSeenAt = @MJ_MCPServerTools_GeneratedActionID_LastSeenAt, @GeneratedActionID = @MJ_MCPServerTools_GeneratedActionID_GeneratedActionID, @GeneratedActionCategoryID = @MJ_MCPServerTools_GeneratedActionID_GeneratedActionCategoryID

        FETCH NEXT FROM cascade_update_MJ_MCPServerTools_GeneratedActionID_cursor INTO @MJ_MCPServerTools_GeneratedActionIDID, @MJ_MCPServerTools_GeneratedActionID_MCPServerID, @MJ_MCPServerTools_GeneratedActionID_ToolName, @MJ_MCPServerTools_GeneratedActionID_ToolTitle, @MJ_MCPServerTools_GeneratedActionID_ToolDescription, @MJ_MCPServerTools_GeneratedActionID_InputSchema, @MJ_MCPServerTools_GeneratedActionID_OutputSchema, @MJ_MCPServerTools_GeneratedActionID_Annotations, @MJ_MCPServerTools_GeneratedActionID_Status, @MJ_MCPServerTools_GeneratedActionID_DiscoveredAt, @MJ_MCPServerTools_GeneratedActionID_LastSeenAt, @MJ_MCPServerTools_GeneratedActionID_GeneratedActionID, @MJ_MCPServerTools_GeneratedActionID_GeneratedActionCategoryID
    END

    CLOSE cascade_update_MJ_MCPServerTools_GeneratedActionID_cursor
    DEALLOCATE cascade_update_MJ_MCPServerTools_GeneratedActionID_cursor
    
    -- Cascade delete from ScheduledAction using cursor to call spDeleteScheduledAction
    DECLARE @ScheduledActions_ActionIDID uniqueidentifier
    DECLARE cascade_delete_ScheduledActions_ActionID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[ScheduledAction]
        WHERE [ActionID] = @ID
    
    OPEN cascade_delete_ScheduledActions_ActionID_cursor
    FETCH NEXT FROM cascade_delete_ScheduledActions_ActionID_cursor INTO @ScheduledActions_ActionIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteScheduledAction] @ID = @ScheduledActions_ActionIDID
        
        FETCH NEXT FROM cascade_delete_ScheduledActions_ActionID_cursor INTO @ScheduledActions_ActionIDID
    END
    
    CLOSE cascade_delete_ScheduledActions_ActionID_cursor
    DEALLOCATE cascade_delete_ScheduledActions_ActionID_cursor
    

    DELETE FROM
        [${flyway:defaultSchema}].[Action]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteAction] TO [cdp_Integration]
    

/* spDelete Permissions for Actions */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteAction] TO [cdp_Integration]



/* spDelete SQL for AI Agents */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: AI Agents
-- Item: spDeleteAIAgent
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR AIAgent
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteAIAgent]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteAIAgent];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteAIAgent]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    -- Cascade update on AIAgentAction using cursor to call spUpdateAIAgentAction
    DECLARE @AIAgentActions_AgentIDID uniqueidentifier
    DECLARE @AIAgentActions_AgentID_AgentID uniqueidentifier
    DECLARE @AIAgentActions_AgentID_ActionID uniqueidentifier
    DECLARE @AIAgentActions_AgentID_Status nvarchar(15)
    DECLARE @AIAgentActions_AgentID_MinExecutionsPerRun int
    DECLARE @AIAgentActions_AgentID_MaxExecutionsPerRun int
    DECLARE @AIAgentActions_AgentID_ResultExpirationTurns int
    DECLARE @AIAgentActions_AgentID_ResultExpirationMode nvarchar(20)
    DECLARE @AIAgentActions_AgentID_CompactMode nvarchar(20)
    DECLARE @AIAgentActions_AgentID_CompactLength int
    DECLARE @AIAgentActions_AgentID_CompactPromptID uniqueidentifier
    DECLARE cascade_update_AIAgentActions_AgentID_cursor CURSOR FOR
        SELECT [ID], [AgentID], [ActionID], [Status], [MinExecutionsPerRun], [MaxExecutionsPerRun], [ResultExpirationTurns], [ResultExpirationMode], [CompactMode], [CompactLength], [CompactPromptID]
        FROM [${flyway:defaultSchema}].[AIAgentAction]
        WHERE [AgentID] = @ID

    OPEN cascade_update_AIAgentActions_AgentID_cursor
    FETCH NEXT FROM cascade_update_AIAgentActions_AgentID_cursor INTO @AIAgentActions_AgentIDID, @AIAgentActions_AgentID_AgentID, @AIAgentActions_AgentID_ActionID, @AIAgentActions_AgentID_Status, @AIAgentActions_AgentID_MinExecutionsPerRun, @AIAgentActions_AgentID_MaxExecutionsPerRun, @AIAgentActions_AgentID_ResultExpirationTurns, @AIAgentActions_AgentID_ResultExpirationMode, @AIAgentActions_AgentID_CompactMode, @AIAgentActions_AgentID_CompactLength, @AIAgentActions_AgentID_CompactPromptID

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @AIAgentActions_AgentID_AgentID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateAIAgentAction] @ID = @AIAgentActions_AgentIDID, @AgentID = @AIAgentActions_AgentID_AgentID, @ActionID = @AIAgentActions_AgentID_ActionID, @Status = @AIAgentActions_AgentID_Status, @MinExecutionsPerRun = @AIAgentActions_AgentID_MinExecutionsPerRun, @MaxExecutionsPerRun = @AIAgentActions_AgentID_MaxExecutionsPerRun, @ResultExpirationTurns = @AIAgentActions_AgentID_ResultExpirationTurns, @ResultExpirationMode = @AIAgentActions_AgentID_ResultExpirationMode, @CompactMode = @AIAgentActions_AgentID_CompactMode, @CompactLength = @AIAgentActions_AgentID_CompactLength, @CompactPromptID = @AIAgentActions_AgentID_CompactPromptID

        FETCH NEXT FROM cascade_update_AIAgentActions_AgentID_cursor INTO @AIAgentActions_AgentIDID, @AIAgentActions_AgentID_AgentID, @AIAgentActions_AgentID_ActionID, @AIAgentActions_AgentID_Status, @AIAgentActions_AgentID_MinExecutionsPerRun, @AIAgentActions_AgentID_MaxExecutionsPerRun, @AIAgentActions_AgentID_ResultExpirationTurns, @AIAgentActions_AgentID_ResultExpirationMode, @AIAgentActions_AgentID_CompactMode, @AIAgentActions_AgentID_CompactLength, @AIAgentActions_AgentID_CompactPromptID
    END

    CLOSE cascade_update_AIAgentActions_AgentID_cursor
    DEALLOCATE cascade_update_AIAgentActions_AgentID_cursor
    
    -- Cascade delete from AIAgentLearningCycle using cursor to call spDeleteAIAgentLearningCycle
    DECLARE @AIAgentLearningCycles_AgentIDID uniqueidentifier
    DECLARE cascade_delete_AIAgentLearningCycles_AgentID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[AIAgentLearningCycle]
        WHERE [AgentID] = @ID
    
    OPEN cascade_delete_AIAgentLearningCycles_AgentID_cursor
    FETCH NEXT FROM cascade_delete_AIAgentLearningCycles_AgentID_cursor INTO @AIAgentLearningCycles_AgentIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteAIAgentLearningCycle] @ID = @AIAgentLearningCycles_AgentIDID
        
        FETCH NEXT FROM cascade_delete_AIAgentLearningCycles_AgentID_cursor INTO @AIAgentLearningCycles_AgentIDID
    END
    
    CLOSE cascade_delete_AIAgentLearningCycles_AgentID_cursor
    DEALLOCATE cascade_delete_AIAgentLearningCycles_AgentID_cursor
    
    -- Cascade update on AIAgentModel using cursor to call spUpdateAIAgentModel
    DECLARE @AIAgentModels_AgentIDID uniqueidentifier
    DECLARE @AIAgentModels_AgentID_AgentID uniqueidentifier
    DECLARE @AIAgentModels_AgentID_ModelID uniqueidentifier
    DECLARE @AIAgentModels_AgentID_Active bit
    DECLARE @AIAgentModels_AgentID_Priority int
    DECLARE cascade_update_AIAgentModels_AgentID_cursor CURSOR FOR
        SELECT [ID], [AgentID], [ModelID], [Active], [Priority]
        FROM [${flyway:defaultSchema}].[AIAgentModel]
        WHERE [AgentID] = @ID

    OPEN cascade_update_AIAgentModels_AgentID_cursor
    FETCH NEXT FROM cascade_update_AIAgentModels_AgentID_cursor INTO @AIAgentModels_AgentIDID, @AIAgentModels_AgentID_AgentID, @AIAgentModels_AgentID_ModelID, @AIAgentModels_AgentID_Active, @AIAgentModels_AgentID_Priority

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @AIAgentModels_AgentID_AgentID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateAIAgentModel] @ID = @AIAgentModels_AgentIDID, @AgentID = @AIAgentModels_AgentID_AgentID, @ModelID = @AIAgentModels_AgentID_ModelID, @Active = @AIAgentModels_AgentID_Active, @Priority = @AIAgentModels_AgentID_Priority

        FETCH NEXT FROM cascade_update_AIAgentModels_AgentID_cursor INTO @AIAgentModels_AgentIDID, @AIAgentModels_AgentID_AgentID, @AIAgentModels_AgentID_ModelID, @AIAgentModels_AgentID_Active, @AIAgentModels_AgentID_Priority
    END

    CLOSE cascade_update_AIAgentModels_AgentID_cursor
    DEALLOCATE cascade_update_AIAgentModels_AgentID_cursor
    
    -- Cascade update on AIAgentNote using cursor to call spUpdateAIAgentNote
    DECLARE @AIAgentNotes_AgentIDID uniqueidentifier
    DECLARE @AIAgentNotes_AgentID_AgentID uniqueidentifier
    DECLARE @AIAgentNotes_AgentID_AgentNoteTypeID uniqueidentifier
    DECLARE @AIAgentNotes_AgentID_Note nvarchar(MAX)
    DECLARE @AIAgentNotes_AgentID_UserID uniqueidentifier
    DECLARE @AIAgentNotes_AgentID_Type nvarchar(20)
    DECLARE @AIAgentNotes_AgentID_IsAutoGenerated bit
    DECLARE @AIAgentNotes_AgentID_Comments nvarchar(MAX)
    DECLARE @AIAgentNotes_AgentID_Status nvarchar(20)
    DECLARE @AIAgentNotes_AgentID_SourceConversationID uniqueidentifier
    DECLARE @AIAgentNotes_AgentID_SourceConversationDetailID uniqueidentifier
    DECLARE @AIAgentNotes_AgentID_SourceAIAgentRunID uniqueidentifier
    DECLARE @AIAgentNotes_AgentID_CompanyID uniqueidentifier
    DECLARE @AIAgentNotes_AgentID_EmbeddingVector nvarchar(MAX)
    DECLARE @AIAgentNotes_AgentID_EmbeddingModelID uniqueidentifier
    DECLARE @AIAgentNotes_AgentID_PrimaryScopeEntityID uniqueidentifier
    DECLARE @AIAgentNotes_AgentID_PrimaryScopeRecordID nvarchar(100)
    DECLARE @AIAgentNotes_AgentID_SecondaryScopes nvarchar(MAX)
    DECLARE @AIAgentNotes_AgentID_LastAccessedAt datetimeoffset
    DECLARE @AIAgentNotes_AgentID_AccessCount int
    DECLARE @AIAgentNotes_AgentID_ExpiresAt datetimeoffset
    DECLARE cascade_update_AIAgentNotes_AgentID_cursor CURSOR FOR
        SELECT [ID], [AgentID], [AgentNoteTypeID], [Note], [UserID], [Type], [IsAutoGenerated], [Comments], [Status], [SourceConversationID], [SourceConversationDetailID], [SourceAIAgentRunID], [CompanyID], [EmbeddingVector], [EmbeddingModelID], [PrimaryScopeEntityID], [PrimaryScopeRecordID], [SecondaryScopes], [LastAccessedAt], [AccessCount], [ExpiresAt]
        FROM [${flyway:defaultSchema}].[AIAgentNote]
        WHERE [AgentID] = @ID

    OPEN cascade_update_AIAgentNotes_AgentID_cursor
    FETCH NEXT FROM cascade_update_AIAgentNotes_AgentID_cursor INTO @AIAgentNotes_AgentIDID, @AIAgentNotes_AgentID_AgentID, @AIAgentNotes_AgentID_AgentNoteTypeID, @AIAgentNotes_AgentID_Note, @AIAgentNotes_AgentID_UserID, @AIAgentNotes_AgentID_Type, @AIAgentNotes_AgentID_IsAutoGenerated, @AIAgentNotes_AgentID_Comments, @AIAgentNotes_AgentID_Status, @AIAgentNotes_AgentID_SourceConversationID, @AIAgentNotes_AgentID_SourceConversationDetailID, @AIAgentNotes_AgentID_SourceAIAgentRunID, @AIAgentNotes_AgentID_CompanyID, @AIAgentNotes_AgentID_EmbeddingVector, @AIAgentNotes_AgentID_EmbeddingModelID, @AIAgentNotes_AgentID_PrimaryScopeEntityID, @AIAgentNotes_AgentID_PrimaryScopeRecordID, @AIAgentNotes_AgentID_SecondaryScopes, @AIAgentNotes_AgentID_LastAccessedAt, @AIAgentNotes_AgentID_AccessCount, @AIAgentNotes_AgentID_ExpiresAt

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @AIAgentNotes_AgentID_AgentID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateAIAgentNote] @ID = @AIAgentNotes_AgentIDID, @AgentID = @AIAgentNotes_AgentID_AgentID, @AgentNoteTypeID = @AIAgentNotes_AgentID_AgentNoteTypeID, @Note = @AIAgentNotes_AgentID_Note, @UserID = @AIAgentNotes_AgentID_UserID, @Type = @AIAgentNotes_AgentID_Type, @IsAutoGenerated = @AIAgentNotes_AgentID_IsAutoGenerated, @Comments = @AIAgentNotes_AgentID_Comments, @Status = @AIAgentNotes_AgentID_Status, @SourceConversationID = @AIAgentNotes_AgentID_SourceConversationID, @SourceConversationDetailID = @AIAgentNotes_AgentID_SourceConversationDetailID, @SourceAIAgentRunID = @AIAgentNotes_AgentID_SourceAIAgentRunID, @CompanyID = @AIAgentNotes_AgentID_CompanyID, @EmbeddingVector = @AIAgentNotes_AgentID_EmbeddingVector, @EmbeddingModelID = @AIAgentNotes_AgentID_EmbeddingModelID, @PrimaryScopeEntityID = @AIAgentNotes_AgentID_PrimaryScopeEntityID, @PrimaryScopeRecordID = @AIAgentNotes_AgentID_PrimaryScopeRecordID, @SecondaryScopes = @AIAgentNotes_AgentID_SecondaryScopes, @LastAccessedAt = @AIAgentNotes_AgentID_LastAccessedAt, @AccessCount = @AIAgentNotes_AgentID_AccessCount, @ExpiresAt = @AIAgentNotes_AgentID_ExpiresAt

        FETCH NEXT FROM cascade_update_AIAgentNotes_AgentID_cursor INTO @AIAgentNotes_AgentIDID, @AIAgentNotes_AgentID_AgentID, @AIAgentNotes_AgentID_AgentNoteTypeID, @AIAgentNotes_AgentID_Note, @AIAgentNotes_AgentID_UserID, @AIAgentNotes_AgentID_Type, @AIAgentNotes_AgentID_IsAutoGenerated, @AIAgentNotes_AgentID_Comments, @AIAgentNotes_AgentID_Status, @AIAgentNotes_AgentID_SourceConversationID, @AIAgentNotes_AgentID_SourceConversationDetailID, @AIAgentNotes_AgentID_SourceAIAgentRunID, @AIAgentNotes_AgentID_CompanyID, @AIAgentNotes_AgentID_EmbeddingVector, @AIAgentNotes_AgentID_EmbeddingModelID, @AIAgentNotes_AgentID_PrimaryScopeEntityID, @AIAgentNotes_AgentID_PrimaryScopeRecordID, @AIAgentNotes_AgentID_SecondaryScopes, @AIAgentNotes_AgentID_LastAccessedAt, @AIAgentNotes_AgentID_AccessCount, @AIAgentNotes_AgentID_ExpiresAt
    END

    CLOSE cascade_update_AIAgentNotes_AgentID_cursor
    DEALLOCATE cascade_update_AIAgentNotes_AgentID_cursor
    
    -- Cascade delete from AIAgentRequest using cursor to call spDeleteAIAgentRequest
    DECLARE @AIAgentRequests_AgentIDID uniqueidentifier
    DECLARE cascade_delete_AIAgentRequests_AgentID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[AIAgentRequest]
        WHERE [AgentID] = @ID
    
    OPEN cascade_delete_AIAgentRequests_AgentID_cursor
    FETCH NEXT FROM cascade_delete_AIAgentRequests_AgentID_cursor INTO @AIAgentRequests_AgentIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteAIAgentRequest] @ID = @AIAgentRequests_AgentIDID
        
        FETCH NEXT FROM cascade_delete_AIAgentRequests_AgentID_cursor INTO @AIAgentRequests_AgentIDID
    END
    
    CLOSE cascade_delete_AIAgentRequests_AgentID_cursor
    DEALLOCATE cascade_delete_AIAgentRequests_AgentID_cursor
    
    -- Cascade update on AIAgent using cursor to call spUpdateAIAgent
    DECLARE @AIAgents_ParentIDID uniqueidentifier
    DECLARE @AIAgents_ParentID_Name nvarchar(255)
    DECLARE @AIAgents_ParentID_Description nvarchar(MAX)
    DECLARE @AIAgents_ParentID_LogoURL nvarchar(255)
    DECLARE @AIAgents_ParentID_ParentID uniqueidentifier
    DECLARE @AIAgents_ParentID_ExposeAsAction bit
    DECLARE @AIAgents_ParentID_ExecutionOrder int
    DECLARE @AIAgents_ParentID_ExecutionMode nvarchar(20)
    DECLARE @AIAgents_ParentID_EnableContextCompression bit
    DECLARE @AIAgents_ParentID_ContextCompressionMessageThreshold int
    DECLARE @AIAgents_ParentID_ContextCompressionPromptID uniqueidentifier
    DECLARE @AIAgents_ParentID_ContextCompressionMessageRetentionCount int
    DECLARE @AIAgents_ParentID_TypeID uniqueidentifier
    DECLARE @AIAgents_ParentID_Status nvarchar(20)
    DECLARE @AIAgents_ParentID_DriverClass nvarchar(255)
    DECLARE @AIAgents_ParentID_IconClass nvarchar(100)
    DECLARE @AIAgents_ParentID_ModelSelectionMode nvarchar(50)
    DECLARE @AIAgents_ParentID_PayloadDownstreamPaths nvarchar(MAX)
    DECLARE @AIAgents_ParentID_PayloadUpstreamPaths nvarchar(MAX)
    DECLARE @AIAgents_ParentID_PayloadSelfReadPaths nvarchar(MAX)
    DECLARE @AIAgents_ParentID_PayloadSelfWritePaths nvarchar(MAX)
    DECLARE @AIAgents_ParentID_PayloadScope nvarchar(MAX)
    DECLARE @AIAgents_ParentID_FinalPayloadValidation nvarchar(MAX)
    DECLARE @AIAgents_ParentID_FinalPayloadValidationMode nvarchar(25)
    DECLARE @AIAgents_ParentID_FinalPayloadValidationMaxRetries int
    DECLARE @AIAgents_ParentID_MaxCostPerRun decimal(10, 4)
    DECLARE @AIAgents_ParentID_MaxTokensPerRun int
    DECLARE @AIAgents_ParentID_MaxIterationsPerRun int
    DECLARE @AIAgents_ParentID_MaxTimePerRun int
    DECLARE @AIAgents_ParentID_MinExecutionsPerRun int
    DECLARE @AIAgents_ParentID_MaxExecutionsPerRun int
    DECLARE @AIAgents_ParentID_StartingPayloadValidation nvarchar(MAX)
    DECLARE @AIAgents_ParentID_StartingPayloadValidationMode nvarchar(25)
    DECLARE @AIAgents_ParentID_DefaultPromptEffortLevel int
    DECLARE @AIAgents_ParentID_ChatHandlingOption nvarchar(30)
    DECLARE @AIAgents_ParentID_DefaultArtifactTypeID uniqueidentifier
    DECLARE @AIAgents_ParentID_OwnerUserID uniqueidentifier
    DECLARE @AIAgents_ParentID_InvocationMode nvarchar(20)
    DECLARE @AIAgents_ParentID_ArtifactCreationMode nvarchar(20)
    DECLARE @AIAgents_ParentID_FunctionalRequirements nvarchar(MAX)
    DECLARE @AIAgents_ParentID_TechnicalDesign nvarchar(MAX)
    DECLARE @AIAgents_ParentID_InjectNotes bit
    DECLARE @AIAgents_ParentID_MaxNotesToInject int
    DECLARE @AIAgents_ParentID_NoteInjectionStrategy nvarchar(20)
    DECLARE @AIAgents_ParentID_InjectExamples bit
    DECLARE @AIAgents_ParentID_MaxExamplesToInject int
    DECLARE @AIAgents_ParentID_ExampleInjectionStrategy nvarchar(20)
    DECLARE @AIAgents_ParentID_IsRestricted bit
    DECLARE @AIAgents_ParentID_MessageMode nvarchar(50)
    DECLARE @AIAgents_ParentID_MaxMessages int
    DECLARE @AIAgents_ParentID_AttachmentStorageProviderID uniqueidentifier
    DECLARE @AIAgents_ParentID_AttachmentRootPath nvarchar(500)
    DECLARE @AIAgents_ParentID_InlineStorageThresholdBytes int
    DECLARE @AIAgents_ParentID_AgentTypePromptParams nvarchar(MAX)
    DECLARE @AIAgents_ParentID_ScopeConfig nvarchar(MAX)
    DECLARE @AIAgents_ParentID_NoteRetentionDays int
    DECLARE @AIAgents_ParentID_ExampleRetentionDays int
    DECLARE @AIAgents_ParentID_AutoArchiveEnabled bit
    DECLARE @AIAgents_ParentID_RerankerConfiguration nvarchar(MAX)
    DECLARE cascade_update_AIAgents_ParentID_cursor CURSOR FOR
        SELECT [ID], [Name], [Description], [LogoURL], [ParentID], [ExposeAsAction], [ExecutionOrder], [ExecutionMode], [EnableContextCompression], [ContextCompressionMessageThreshold], [ContextCompressionPromptID], [ContextCompressionMessageRetentionCount], [TypeID], [Status], [DriverClass], [IconClass], [ModelSelectionMode], [PayloadDownstreamPaths], [PayloadUpstreamPaths], [PayloadSelfReadPaths], [PayloadSelfWritePaths], [PayloadScope], [FinalPayloadValidation], [FinalPayloadValidationMode], [FinalPayloadValidationMaxRetries], [MaxCostPerRun], [MaxTokensPerRun], [MaxIterationsPerRun], [MaxTimePerRun], [MinExecutionsPerRun], [MaxExecutionsPerRun], [StartingPayloadValidation], [StartingPayloadValidationMode], [DefaultPromptEffortLevel], [ChatHandlingOption], [DefaultArtifactTypeID], [OwnerUserID], [InvocationMode], [ArtifactCreationMode], [FunctionalRequirements], [TechnicalDesign], [InjectNotes], [MaxNotesToInject], [NoteInjectionStrategy], [InjectExamples], [MaxExamplesToInject], [ExampleInjectionStrategy], [IsRestricted], [MessageMode], [MaxMessages], [AttachmentStorageProviderID], [AttachmentRootPath], [InlineStorageThresholdBytes], [AgentTypePromptParams], [ScopeConfig], [NoteRetentionDays], [ExampleRetentionDays], [AutoArchiveEnabled], [RerankerConfiguration]
        FROM [${flyway:defaultSchema}].[AIAgent]
        WHERE [ParentID] = @ID

    OPEN cascade_update_AIAgents_ParentID_cursor
    FETCH NEXT FROM cascade_update_AIAgents_ParentID_cursor INTO @AIAgents_ParentIDID, @AIAgents_ParentID_Name, @AIAgents_ParentID_Description, @AIAgents_ParentID_LogoURL, @AIAgents_ParentID_ParentID, @AIAgents_ParentID_ExposeAsAction, @AIAgents_ParentID_ExecutionOrder, @AIAgents_ParentID_ExecutionMode, @AIAgents_ParentID_EnableContextCompression, @AIAgents_ParentID_ContextCompressionMessageThreshold, @AIAgents_ParentID_ContextCompressionPromptID, @AIAgents_ParentID_ContextCompressionMessageRetentionCount, @AIAgents_ParentID_TypeID, @AIAgents_ParentID_Status, @AIAgents_ParentID_DriverClass, @AIAgents_ParentID_IconClass, @AIAgents_ParentID_ModelSelectionMode, @AIAgents_ParentID_PayloadDownstreamPaths, @AIAgents_ParentID_PayloadUpstreamPaths, @AIAgents_ParentID_PayloadSelfReadPaths, @AIAgents_ParentID_PayloadSelfWritePaths, @AIAgents_ParentID_PayloadScope, @AIAgents_ParentID_FinalPayloadValidation, @AIAgents_ParentID_FinalPayloadValidationMode, @AIAgents_ParentID_FinalPayloadValidationMaxRetries, @AIAgents_ParentID_MaxCostPerRun, @AIAgents_ParentID_MaxTokensPerRun, @AIAgents_ParentID_MaxIterationsPerRun, @AIAgents_ParentID_MaxTimePerRun, @AIAgents_ParentID_MinExecutionsPerRun, @AIAgents_ParentID_MaxExecutionsPerRun, @AIAgents_ParentID_StartingPayloadValidation, @AIAgents_ParentID_StartingPayloadValidationMode, @AIAgents_ParentID_DefaultPromptEffortLevel, @AIAgents_ParentID_ChatHandlingOption, @AIAgents_ParentID_DefaultArtifactTypeID, @AIAgents_ParentID_OwnerUserID, @AIAgents_ParentID_InvocationMode, @AIAgents_ParentID_ArtifactCreationMode, @AIAgents_ParentID_FunctionalRequirements, @AIAgents_ParentID_TechnicalDesign, @AIAgents_ParentID_InjectNotes, @AIAgents_ParentID_MaxNotesToInject, @AIAgents_ParentID_NoteInjectionStrategy, @AIAgents_ParentID_InjectExamples, @AIAgents_ParentID_MaxExamplesToInject, @AIAgents_ParentID_ExampleInjectionStrategy, @AIAgents_ParentID_IsRestricted, @AIAgents_ParentID_MessageMode, @AIAgents_ParentID_MaxMessages, @AIAgents_ParentID_AttachmentStorageProviderID, @AIAgents_ParentID_AttachmentRootPath, @AIAgents_ParentID_InlineStorageThresholdBytes, @AIAgents_ParentID_AgentTypePromptParams, @AIAgents_ParentID_ScopeConfig, @AIAgents_ParentID_NoteRetentionDays, @AIAgents_ParentID_ExampleRetentionDays, @AIAgents_ParentID_AutoArchiveEnabled, @AIAgents_ParentID_RerankerConfiguration

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @AIAgents_ParentID_ParentID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateAIAgent] @ID = @AIAgents_ParentIDID, @Name = @AIAgents_ParentID_Name, @Description = @AIAgents_ParentID_Description, @LogoURL = @AIAgents_ParentID_LogoURL, @ParentID = @AIAgents_ParentID_ParentID, @ExposeAsAction = @AIAgents_ParentID_ExposeAsAction, @ExecutionOrder = @AIAgents_ParentID_ExecutionOrder, @ExecutionMode = @AIAgents_ParentID_ExecutionMode, @EnableContextCompression = @AIAgents_ParentID_EnableContextCompression, @ContextCompressionMessageThreshold = @AIAgents_ParentID_ContextCompressionMessageThreshold, @ContextCompressionPromptID = @AIAgents_ParentID_ContextCompressionPromptID, @ContextCompressionMessageRetentionCount = @AIAgents_ParentID_ContextCompressionMessageRetentionCount, @TypeID = @AIAgents_ParentID_TypeID, @Status = @AIAgents_ParentID_Status, @DriverClass = @AIAgents_ParentID_DriverClass, @IconClass = @AIAgents_ParentID_IconClass, @ModelSelectionMode = @AIAgents_ParentID_ModelSelectionMode, @PayloadDownstreamPaths = @AIAgents_ParentID_PayloadDownstreamPaths, @PayloadUpstreamPaths = @AIAgents_ParentID_PayloadUpstreamPaths, @PayloadSelfReadPaths = @AIAgents_ParentID_PayloadSelfReadPaths, @PayloadSelfWritePaths = @AIAgents_ParentID_PayloadSelfWritePaths, @PayloadScope = @AIAgents_ParentID_PayloadScope, @FinalPayloadValidation = @AIAgents_ParentID_FinalPayloadValidation, @FinalPayloadValidationMode = @AIAgents_ParentID_FinalPayloadValidationMode, @FinalPayloadValidationMaxRetries = @AIAgents_ParentID_FinalPayloadValidationMaxRetries, @MaxCostPerRun = @AIAgents_ParentID_MaxCostPerRun, @MaxTokensPerRun = @AIAgents_ParentID_MaxTokensPerRun, @MaxIterationsPerRun = @AIAgents_ParentID_MaxIterationsPerRun, @MaxTimePerRun = @AIAgents_ParentID_MaxTimePerRun, @MinExecutionsPerRun = @AIAgents_ParentID_MinExecutionsPerRun, @MaxExecutionsPerRun = @AIAgents_ParentID_MaxExecutionsPerRun, @StartingPayloadValidation = @AIAgents_ParentID_StartingPayloadValidation, @StartingPayloadValidationMode = @AIAgents_ParentID_StartingPayloadValidationMode, @DefaultPromptEffortLevel = @AIAgents_ParentID_DefaultPromptEffortLevel, @ChatHandlingOption = @AIAgents_ParentID_ChatHandlingOption, @DefaultArtifactTypeID = @AIAgents_ParentID_DefaultArtifactTypeID, @OwnerUserID = @AIAgents_ParentID_OwnerUserID, @InvocationMode = @AIAgents_ParentID_InvocationMode, @ArtifactCreationMode = @AIAgents_ParentID_ArtifactCreationMode, @FunctionalRequirements = @AIAgents_ParentID_FunctionalRequirements, @TechnicalDesign = @AIAgents_ParentID_TechnicalDesign, @InjectNotes = @AIAgents_ParentID_InjectNotes, @MaxNotesToInject = @AIAgents_ParentID_MaxNotesToInject, @NoteInjectionStrategy = @AIAgents_ParentID_NoteInjectionStrategy, @InjectExamples = @AIAgents_ParentID_InjectExamples, @MaxExamplesToInject = @AIAgents_ParentID_MaxExamplesToInject, @ExampleInjectionStrategy = @AIAgents_ParentID_ExampleInjectionStrategy, @IsRestricted = @AIAgents_ParentID_IsRestricted, @MessageMode = @AIAgents_ParentID_MessageMode, @MaxMessages = @AIAgents_ParentID_MaxMessages, @AttachmentStorageProviderID = @AIAgents_ParentID_AttachmentStorageProviderID, @AttachmentRootPath = @AIAgents_ParentID_AttachmentRootPath, @InlineStorageThresholdBytes = @AIAgents_ParentID_InlineStorageThresholdBytes, @AgentTypePromptParams = @AIAgents_ParentID_AgentTypePromptParams, @ScopeConfig = @AIAgents_ParentID_ScopeConfig, @NoteRetentionDays = @AIAgents_ParentID_NoteRetentionDays, @ExampleRetentionDays = @AIAgents_ParentID_ExampleRetentionDays, @AutoArchiveEnabled = @AIAgents_ParentID_AutoArchiveEnabled, @RerankerConfiguration = @AIAgents_ParentID_RerankerConfiguration

        FETCH NEXT FROM cascade_update_AIAgents_ParentID_cursor INTO @AIAgents_ParentIDID, @AIAgents_ParentID_Name, @AIAgents_ParentID_Description, @AIAgents_ParentID_LogoURL, @AIAgents_ParentID_ParentID, @AIAgents_ParentID_ExposeAsAction, @AIAgents_ParentID_ExecutionOrder, @AIAgents_ParentID_ExecutionMode, @AIAgents_ParentID_EnableContextCompression, @AIAgents_ParentID_ContextCompressionMessageThreshold, @AIAgents_ParentID_ContextCompressionPromptID, @AIAgents_ParentID_ContextCompressionMessageRetentionCount, @AIAgents_ParentID_TypeID, @AIAgents_ParentID_Status, @AIAgents_ParentID_DriverClass, @AIAgents_ParentID_IconClass, @AIAgents_ParentID_ModelSelectionMode, @AIAgents_ParentID_PayloadDownstreamPaths, @AIAgents_ParentID_PayloadUpstreamPaths, @AIAgents_ParentID_PayloadSelfReadPaths, @AIAgents_ParentID_PayloadSelfWritePaths, @AIAgents_ParentID_PayloadScope, @AIAgents_ParentID_FinalPayloadValidation, @AIAgents_ParentID_FinalPayloadValidationMode, @AIAgents_ParentID_FinalPayloadValidationMaxRetries, @AIAgents_ParentID_MaxCostPerRun, @AIAgents_ParentID_MaxTokensPerRun, @AIAgents_ParentID_MaxIterationsPerRun, @AIAgents_ParentID_MaxTimePerRun, @AIAgents_ParentID_MinExecutionsPerRun, @AIAgents_ParentID_MaxExecutionsPerRun, @AIAgents_ParentID_StartingPayloadValidation, @AIAgents_ParentID_StartingPayloadValidationMode, @AIAgents_ParentID_DefaultPromptEffortLevel, @AIAgents_ParentID_ChatHandlingOption, @AIAgents_ParentID_DefaultArtifactTypeID, @AIAgents_ParentID_OwnerUserID, @AIAgents_ParentID_InvocationMode, @AIAgents_ParentID_ArtifactCreationMode, @AIAgents_ParentID_FunctionalRequirements, @AIAgents_ParentID_TechnicalDesign, @AIAgents_ParentID_InjectNotes, @AIAgents_ParentID_MaxNotesToInject, @AIAgents_ParentID_NoteInjectionStrategy, @AIAgents_ParentID_InjectExamples, @AIAgents_ParentID_MaxExamplesToInject, @AIAgents_ParentID_ExampleInjectionStrategy, @AIAgents_ParentID_IsRestricted, @AIAgents_ParentID_MessageMode, @AIAgents_ParentID_MaxMessages, @AIAgents_ParentID_AttachmentStorageProviderID, @AIAgents_ParentID_AttachmentRootPath, @AIAgents_ParentID_InlineStorageThresholdBytes, @AIAgents_ParentID_AgentTypePromptParams, @AIAgents_ParentID_ScopeConfig, @AIAgents_ParentID_NoteRetentionDays, @AIAgents_ParentID_ExampleRetentionDays, @AIAgents_ParentID_AutoArchiveEnabled, @AIAgents_ParentID_RerankerConfiguration
    END

    CLOSE cascade_update_AIAgents_ParentID_cursor
    DEALLOCATE cascade_update_AIAgents_ParentID_cursor
    
    -- Cascade update on AIResultCache using cursor to call spUpdateAIResultCache
    DECLARE @AIResultCache_AgentIDID uniqueidentifier
    DECLARE @AIResultCache_AgentID_AIPromptID uniqueidentifier
    DECLARE @AIResultCache_AgentID_AIModelID uniqueidentifier
    DECLARE @AIResultCache_AgentID_RunAt datetimeoffset
    DECLARE @AIResultCache_AgentID_PromptText nvarchar(MAX)
    DECLARE @AIResultCache_AgentID_ResultText nvarchar(MAX)
    DECLARE @AIResultCache_AgentID_Status nvarchar(50)
    DECLARE @AIResultCache_AgentID_ExpiredOn datetimeoffset
    DECLARE @AIResultCache_AgentID_VendorID uniqueidentifier
    DECLARE @AIResultCache_AgentID_AgentID uniqueidentifier
    DECLARE @AIResultCache_AgentID_ConfigurationID uniqueidentifier
    DECLARE @AIResultCache_AgentID_PromptEmbedding varbinary
    DECLARE @AIResultCache_AgentID_PromptRunID uniqueidentifier
    DECLARE cascade_update_AIResultCache_AgentID_cursor CURSOR FOR
        SELECT [ID], [AIPromptID], [AIModelID], [RunAt], [PromptText], [ResultText], [Status], [ExpiredOn], [VendorID], [AgentID], [ConfigurationID], [PromptEmbedding], [PromptRunID]
        FROM [${flyway:defaultSchema}].[AIResultCache]
        WHERE [AgentID] = @ID

    OPEN cascade_update_AIResultCache_AgentID_cursor
    FETCH NEXT FROM cascade_update_AIResultCache_AgentID_cursor INTO @AIResultCache_AgentIDID, @AIResultCache_AgentID_AIPromptID, @AIResultCache_AgentID_AIModelID, @AIResultCache_AgentID_RunAt, @AIResultCache_AgentID_PromptText, @AIResultCache_AgentID_ResultText, @AIResultCache_AgentID_Status, @AIResultCache_AgentID_ExpiredOn, @AIResultCache_AgentID_VendorID, @AIResultCache_AgentID_AgentID, @AIResultCache_AgentID_ConfigurationID, @AIResultCache_AgentID_PromptEmbedding, @AIResultCache_AgentID_PromptRunID

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @AIResultCache_AgentID_AgentID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateAIResultCache] @ID = @AIResultCache_AgentIDID, @AIPromptID = @AIResultCache_AgentID_AIPromptID, @AIModelID = @AIResultCache_AgentID_AIModelID, @RunAt = @AIResultCache_AgentID_RunAt, @PromptText = @AIResultCache_AgentID_PromptText, @ResultText = @AIResultCache_AgentID_ResultText, @Status = @AIResultCache_AgentID_Status, @ExpiredOn = @AIResultCache_AgentID_ExpiredOn, @VendorID = @AIResultCache_AgentID_VendorID, @AgentID = @AIResultCache_AgentID_AgentID, @ConfigurationID = @AIResultCache_AgentID_ConfigurationID, @PromptEmbedding = @AIResultCache_AgentID_PromptEmbedding, @PromptRunID = @AIResultCache_AgentID_PromptRunID

        FETCH NEXT FROM cascade_update_AIResultCache_AgentID_cursor INTO @AIResultCache_AgentIDID, @AIResultCache_AgentID_AIPromptID, @AIResultCache_AgentID_AIModelID, @AIResultCache_AgentID_RunAt, @AIResultCache_AgentID_PromptText, @AIResultCache_AgentID_ResultText, @AIResultCache_AgentID_Status, @AIResultCache_AgentID_ExpiredOn, @AIResultCache_AgentID_VendorID, @AIResultCache_AgentID_AgentID, @AIResultCache_AgentID_ConfigurationID, @AIResultCache_AgentID_PromptEmbedding, @AIResultCache_AgentID_PromptRunID
    END

    CLOSE cascade_update_AIResultCache_AgentID_cursor
    DEALLOCATE cascade_update_AIResultCache_AgentID_cursor
    
    -- Cascade update on ConversationDetail using cursor to call spUpdateConversationDetail
    DECLARE @ConversationDetails_AgentIDID uniqueidentifier
    DECLARE @ConversationDetails_AgentID_ConversationID uniqueidentifier
    DECLARE @ConversationDetails_AgentID_ExternalID nvarchar(100)
    DECLARE @ConversationDetails_AgentID_Role nvarchar(20)
    DECLARE @ConversationDetails_AgentID_Message nvarchar(MAX)
    DECLARE @ConversationDetails_AgentID_Error nvarchar(MAX)
    DECLARE @ConversationDetails_AgentID_HiddenToUser bit
    DECLARE @ConversationDetails_AgentID_UserRating int
    DECLARE @ConversationDetails_AgentID_UserFeedback nvarchar(MAX)
    DECLARE @ConversationDetails_AgentID_ReflectionInsights nvarchar(MAX)
    DECLARE @ConversationDetails_AgentID_SummaryOfEarlierConversation nvarchar(MAX)
    DECLARE @ConversationDetails_AgentID_UserID uniqueidentifier
    DECLARE @ConversationDetails_AgentID_ArtifactID uniqueidentifier
    DECLARE @ConversationDetails_AgentID_ArtifactVersionID uniqueidentifier
    DECLARE @ConversationDetails_AgentID_CompletionTime bigint
    DECLARE @ConversationDetails_AgentID_IsPinned bit
    DECLARE @ConversationDetails_AgentID_ParentID uniqueidentifier
    DECLARE @ConversationDetails_AgentID_AgentID uniqueidentifier
    DECLARE @ConversationDetails_AgentID_Status nvarchar(20)
    DECLARE @ConversationDetails_AgentID_SuggestedResponses nvarchar(MAX)
    DECLARE @ConversationDetails_AgentID_TestRunID uniqueidentifier
    DECLARE @ConversationDetails_AgentID_ResponseForm nvarchar(MAX)
    DECLARE @ConversationDetails_AgentID_ActionableCommands nvarchar(MAX)
    DECLARE @ConversationDetails_AgentID_AutomaticCommands nvarchar(MAX)
    DECLARE @ConversationDetails_AgentID_OriginalMessageChanged bit
    DECLARE cascade_update_ConversationDetails_AgentID_cursor CURSOR FOR
        SELECT [ID], [ConversationID], [ExternalID], [Role], [Message], [Error], [HiddenToUser], [UserRating], [UserFeedback], [ReflectionInsights], [SummaryOfEarlierConversation], [UserID], [ArtifactID], [ArtifactVersionID], [CompletionTime], [IsPinned], [ParentID], [AgentID], [Status], [SuggestedResponses], [TestRunID], [ResponseForm], [ActionableCommands], [AutomaticCommands], [OriginalMessageChanged]
        FROM [${flyway:defaultSchema}].[ConversationDetail]
        WHERE [AgentID] = @ID

    OPEN cascade_update_ConversationDetails_AgentID_cursor
    FETCH NEXT FROM cascade_update_ConversationDetails_AgentID_cursor INTO @ConversationDetails_AgentIDID, @ConversationDetails_AgentID_ConversationID, @ConversationDetails_AgentID_ExternalID, @ConversationDetails_AgentID_Role, @ConversationDetails_AgentID_Message, @ConversationDetails_AgentID_Error, @ConversationDetails_AgentID_HiddenToUser, @ConversationDetails_AgentID_UserRating, @ConversationDetails_AgentID_UserFeedback, @ConversationDetails_AgentID_ReflectionInsights, @ConversationDetails_AgentID_SummaryOfEarlierConversation, @ConversationDetails_AgentID_UserID, @ConversationDetails_AgentID_ArtifactID, @ConversationDetails_AgentID_ArtifactVersionID, @ConversationDetails_AgentID_CompletionTime, @ConversationDetails_AgentID_IsPinned, @ConversationDetails_AgentID_ParentID, @ConversationDetails_AgentID_AgentID, @ConversationDetails_AgentID_Status, @ConversationDetails_AgentID_SuggestedResponses, @ConversationDetails_AgentID_TestRunID, @ConversationDetails_AgentID_ResponseForm, @ConversationDetails_AgentID_ActionableCommands, @ConversationDetails_AgentID_AutomaticCommands, @ConversationDetails_AgentID_OriginalMessageChanged

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @ConversationDetails_AgentID_AgentID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateConversationDetail] @ID = @ConversationDetails_AgentIDID, @ConversationID = @ConversationDetails_AgentID_ConversationID, @ExternalID = @ConversationDetails_AgentID_ExternalID, @Role = @ConversationDetails_AgentID_Role, @Message = @ConversationDetails_AgentID_Message, @Error = @ConversationDetails_AgentID_Error, @HiddenToUser = @ConversationDetails_AgentID_HiddenToUser, @UserRating = @ConversationDetails_AgentID_UserRating, @UserFeedback = @ConversationDetails_AgentID_UserFeedback, @ReflectionInsights = @ConversationDetails_AgentID_ReflectionInsights, @SummaryOfEarlierConversation = @ConversationDetails_AgentID_SummaryOfEarlierConversation, @UserID = @ConversationDetails_AgentID_UserID, @ArtifactID = @ConversationDetails_AgentID_ArtifactID, @ArtifactVersionID = @ConversationDetails_AgentID_ArtifactVersionID, @CompletionTime = @ConversationDetails_AgentID_CompletionTime, @IsPinned = @ConversationDetails_AgentID_IsPinned, @ParentID = @ConversationDetails_AgentID_ParentID, @AgentID = @ConversationDetails_AgentID_AgentID, @Status = @ConversationDetails_AgentID_Status, @SuggestedResponses = @ConversationDetails_AgentID_SuggestedResponses, @TestRunID = @ConversationDetails_AgentID_TestRunID, @ResponseForm = @ConversationDetails_AgentID_ResponseForm, @ActionableCommands = @ConversationDetails_AgentID_ActionableCommands, @AutomaticCommands = @ConversationDetails_AgentID_AutomaticCommands, @OriginalMessageChanged = @ConversationDetails_AgentID_OriginalMessageChanged

        FETCH NEXT FROM cascade_update_ConversationDetails_AgentID_cursor INTO @ConversationDetails_AgentIDID, @ConversationDetails_AgentID_ConversationID, @ConversationDetails_AgentID_ExternalID, @ConversationDetails_AgentID_Role, @ConversationDetails_AgentID_Message, @ConversationDetails_AgentID_Error, @ConversationDetails_AgentID_HiddenToUser, @ConversationDetails_AgentID_UserRating, @ConversationDetails_AgentID_UserFeedback, @ConversationDetails_AgentID_ReflectionInsights, @ConversationDetails_AgentID_SummaryOfEarlierConversation, @ConversationDetails_AgentID_UserID, @ConversationDetails_AgentID_ArtifactID, @ConversationDetails_AgentID_ArtifactVersionID, @ConversationDetails_AgentID_CompletionTime, @ConversationDetails_AgentID_IsPinned, @ConversationDetails_AgentID_ParentID, @ConversationDetails_AgentID_AgentID, @ConversationDetails_AgentID_Status, @ConversationDetails_AgentID_SuggestedResponses, @ConversationDetails_AgentID_TestRunID, @ConversationDetails_AgentID_ResponseForm, @ConversationDetails_AgentID_ActionableCommands, @ConversationDetails_AgentID_AutomaticCommands, @ConversationDetails_AgentID_OriginalMessageChanged
    END

    CLOSE cascade_update_ConversationDetails_AgentID_cursor
    DEALLOCATE cascade_update_ConversationDetails_AgentID_cursor
    
    -- Cascade delete from AIAgentArtifactType using cursor to call spDeleteAIAgentArtifactType
    DECLARE @MJ_AIAgentArtifactTypes_AgentIDID uniqueidentifier
    DECLARE cascade_delete_MJ_AIAgentArtifactTypes_AgentID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[AIAgentArtifactType]
        WHERE [AgentID] = @ID
    
    OPEN cascade_delete_MJ_AIAgentArtifactTypes_AgentID_cursor
    FETCH NEXT FROM cascade_delete_MJ_AIAgentArtifactTypes_AgentID_cursor INTO @MJ_AIAgentArtifactTypes_AgentIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteAIAgentArtifactType] @ID = @MJ_AIAgentArtifactTypes_AgentIDID
        
        FETCH NEXT FROM cascade_delete_MJ_AIAgentArtifactTypes_AgentID_cursor INTO @MJ_AIAgentArtifactTypes_AgentIDID
    END
    
    CLOSE cascade_delete_MJ_AIAgentArtifactTypes_AgentID_cursor
    DEALLOCATE cascade_delete_MJ_AIAgentArtifactTypes_AgentID_cursor
    
    -- Cascade delete from AIAgentConfiguration using cursor to call spDeleteAIAgentConfiguration
    DECLARE @MJ_AIAgentConfigurations_AgentIDID uniqueidentifier
    DECLARE cascade_delete_MJ_AIAgentConfigurations_AgentID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[AIAgentConfiguration]
        WHERE [AgentID] = @ID
    
    OPEN cascade_delete_MJ_AIAgentConfigurations_AgentID_cursor
    FETCH NEXT FROM cascade_delete_MJ_AIAgentConfigurations_AgentID_cursor INTO @MJ_AIAgentConfigurations_AgentIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteAIAgentConfiguration] @ID = @MJ_AIAgentConfigurations_AgentIDID
        
        FETCH NEXT FROM cascade_delete_MJ_AIAgentConfigurations_AgentID_cursor INTO @MJ_AIAgentConfigurations_AgentIDID
    END
    
    CLOSE cascade_delete_MJ_AIAgentConfigurations_AgentID_cursor
    DEALLOCATE cascade_delete_MJ_AIAgentConfigurations_AgentID_cursor
    
    -- Cascade delete from AIAgentDataSource using cursor to call spDeleteAIAgentDataSource
    DECLARE @MJ_AIAgentDataSources_AgentIDID uniqueidentifier
    DECLARE cascade_delete_MJ_AIAgentDataSources_AgentID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[AIAgentDataSource]
        WHERE [AgentID] = @ID
    
    OPEN cascade_delete_MJ_AIAgentDataSources_AgentID_cursor
    FETCH NEXT FROM cascade_delete_MJ_AIAgentDataSources_AgentID_cursor INTO @MJ_AIAgentDataSources_AgentIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteAIAgentDataSource] @ID = @MJ_AIAgentDataSources_AgentIDID
        
        FETCH NEXT FROM cascade_delete_MJ_AIAgentDataSources_AgentID_cursor INTO @MJ_AIAgentDataSources_AgentIDID
    END
    
    CLOSE cascade_delete_MJ_AIAgentDataSources_AgentID_cursor
    DEALLOCATE cascade_delete_MJ_AIAgentDataSources_AgentID_cursor
    
    -- Cascade delete from AIAgentExample using cursor to call spDeleteAIAgentExample
    DECLARE @MJ_AIAgentExamples_AgentIDID uniqueidentifier
    DECLARE cascade_delete_MJ_AIAgentExamples_AgentID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[AIAgentExample]
        WHERE [AgentID] = @ID
    
    OPEN cascade_delete_MJ_AIAgentExamples_AgentID_cursor
    FETCH NEXT FROM cascade_delete_MJ_AIAgentExamples_AgentID_cursor INTO @MJ_AIAgentExamples_AgentIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteAIAgentExample] @ID = @MJ_AIAgentExamples_AgentIDID
        
        FETCH NEXT FROM cascade_delete_MJ_AIAgentExamples_AgentID_cursor INTO @MJ_AIAgentExamples_AgentIDID
    END
    
    CLOSE cascade_delete_MJ_AIAgentExamples_AgentID_cursor
    DEALLOCATE cascade_delete_MJ_AIAgentExamples_AgentID_cursor
    
    -- Cascade delete from AIAgentModality using cursor to call spDeleteAIAgentModality
    DECLARE @MJ_AIAgentModalities_AgentIDID uniqueidentifier
    DECLARE cascade_delete_MJ_AIAgentModalities_AgentID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[AIAgentModality]
        WHERE [AgentID] = @ID
    
    OPEN cascade_delete_MJ_AIAgentModalities_AgentID_cursor
    FETCH NEXT FROM cascade_delete_MJ_AIAgentModalities_AgentID_cursor INTO @MJ_AIAgentModalities_AgentIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteAIAgentModality] @ID = @MJ_AIAgentModalities_AgentIDID
        
        FETCH NEXT FROM cascade_delete_MJ_AIAgentModalities_AgentID_cursor INTO @MJ_AIAgentModalities_AgentIDID
    END
    
    CLOSE cascade_delete_MJ_AIAgentModalities_AgentID_cursor
    DEALLOCATE cascade_delete_MJ_AIAgentModalities_AgentID_cursor
    
    -- Cascade delete from AIAgentPermission using cursor to call spDeleteAIAgentPermission
    DECLARE @MJ_AIAgentPermissions_AgentIDID uniqueidentifier
    DECLARE cascade_delete_MJ_AIAgentPermissions_AgentID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[AIAgentPermission]
        WHERE [AgentID] = @ID
    
    OPEN cascade_delete_MJ_AIAgentPermissions_AgentID_cursor
    FETCH NEXT FROM cascade_delete_MJ_AIAgentPermissions_AgentID_cursor INTO @MJ_AIAgentPermissions_AgentIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteAIAgentPermission] @ID = @MJ_AIAgentPermissions_AgentIDID
        
        FETCH NEXT FROM cascade_delete_MJ_AIAgentPermissions_AgentID_cursor INTO @MJ_AIAgentPermissions_AgentIDID
    END
    
    CLOSE cascade_delete_MJ_AIAgentPermissions_AgentID_cursor
    DEALLOCATE cascade_delete_MJ_AIAgentPermissions_AgentID_cursor
    
    -- Cascade delete from AIAgentPrompt using cursor to call spDeleteAIAgentPrompt
    DECLARE @MJ_AIAgentPrompts_AgentIDID uniqueidentifier
    DECLARE cascade_delete_MJ_AIAgentPrompts_AgentID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[AIAgentPrompt]
        WHERE [AgentID] = @ID
    
    OPEN cascade_delete_MJ_AIAgentPrompts_AgentID_cursor
    FETCH NEXT FROM cascade_delete_MJ_AIAgentPrompts_AgentID_cursor INTO @MJ_AIAgentPrompts_AgentIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteAIAgentPrompt] @ID = @MJ_AIAgentPrompts_AgentIDID
        
        FETCH NEXT FROM cascade_delete_MJ_AIAgentPrompts_AgentID_cursor INTO @MJ_AIAgentPrompts_AgentIDID
    END
    
    CLOSE cascade_delete_MJ_AIAgentPrompts_AgentID_cursor
    DEALLOCATE cascade_delete_MJ_AIAgentPrompts_AgentID_cursor
    
    -- Cascade delete from AIAgentRelationship using cursor to call spDeleteAIAgentRelationship
    DECLARE @MJ_AIAgentRelationships_AgentIDID uniqueidentifier
    DECLARE cascade_delete_MJ_AIAgentRelationships_AgentID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[AIAgentRelationship]
        WHERE [AgentID] = @ID
    
    OPEN cascade_delete_MJ_AIAgentRelationships_AgentID_cursor
    FETCH NEXT FROM cascade_delete_MJ_AIAgentRelationships_AgentID_cursor INTO @MJ_AIAgentRelationships_AgentIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteAIAgentRelationship] @ID = @MJ_AIAgentRelationships_AgentIDID
        
        FETCH NEXT FROM cascade_delete_MJ_AIAgentRelationships_AgentID_cursor INTO @MJ_AIAgentRelationships_AgentIDID
    END
    
    CLOSE cascade_delete_MJ_AIAgentRelationships_AgentID_cursor
    DEALLOCATE cascade_delete_MJ_AIAgentRelationships_AgentID_cursor
    
    -- Cascade delete from AIAgentRelationship using cursor to call spDeleteAIAgentRelationship
    DECLARE @MJ_AIAgentRelationships_SubAgentIDID uniqueidentifier
    DECLARE cascade_delete_MJ_AIAgentRelationships_SubAgentID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[AIAgentRelationship]
        WHERE [SubAgentID] = @ID
    
    OPEN cascade_delete_MJ_AIAgentRelationships_SubAgentID_cursor
    FETCH NEXT FROM cascade_delete_MJ_AIAgentRelationships_SubAgentID_cursor INTO @MJ_AIAgentRelationships_SubAgentIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteAIAgentRelationship] @ID = @MJ_AIAgentRelationships_SubAgentIDID
        
        FETCH NEXT FROM cascade_delete_MJ_AIAgentRelationships_SubAgentID_cursor INTO @MJ_AIAgentRelationships_SubAgentIDID
    END
    
    CLOSE cascade_delete_MJ_AIAgentRelationships_SubAgentID_cursor
    DEALLOCATE cascade_delete_MJ_AIAgentRelationships_SubAgentID_cursor
    
    -- Cascade delete from AIAgentRun using cursor to call spDeleteAIAgentRun
    DECLARE @MJ_AIAgentRuns_AgentIDID uniqueidentifier
    DECLARE cascade_delete_MJ_AIAgentRuns_AgentID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[AIAgentRun]
        WHERE [AgentID] = @ID
    
    OPEN cascade_delete_MJ_AIAgentRuns_AgentID_cursor
    FETCH NEXT FROM cascade_delete_MJ_AIAgentRuns_AgentID_cursor INTO @MJ_AIAgentRuns_AgentIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteAIAgentRun] @ID = @MJ_AIAgentRuns_AgentIDID
        
        FETCH NEXT FROM cascade_delete_MJ_AIAgentRuns_AgentID_cursor INTO @MJ_AIAgentRuns_AgentIDID
    END
    
    CLOSE cascade_delete_MJ_AIAgentRuns_AgentID_cursor
    DEALLOCATE cascade_delete_MJ_AIAgentRuns_AgentID_cursor
    
    -- Cascade delete from AIAgentStep using cursor to call spDeleteAIAgentStep
    DECLARE @MJ_AIAgentSteps_AgentIDID uniqueidentifier
    DECLARE cascade_delete_MJ_AIAgentSteps_AgentID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[AIAgentStep]
        WHERE [AgentID] = @ID
    
    OPEN cascade_delete_MJ_AIAgentSteps_AgentID_cursor
    FETCH NEXT FROM cascade_delete_MJ_AIAgentSteps_AgentID_cursor INTO @MJ_AIAgentSteps_AgentIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteAIAgentStep] @ID = @MJ_AIAgentSteps_AgentIDID
        
        FETCH NEXT FROM cascade_delete_MJ_AIAgentSteps_AgentID_cursor INTO @MJ_AIAgentSteps_AgentIDID
    END
    
    CLOSE cascade_delete_MJ_AIAgentSteps_AgentID_cursor
    DEALLOCATE cascade_delete_MJ_AIAgentSteps_AgentID_cursor
    
    -- Cascade update on AIAgentStep using cursor to call spUpdateAIAgentStep
    DECLARE @MJ_AIAgentSteps_SubAgentIDID uniqueidentifier
    DECLARE @MJ_AIAgentSteps_SubAgentID_AgentID uniqueidentifier
    DECLARE @MJ_AIAgentSteps_SubAgentID_Name nvarchar(255)
    DECLARE @MJ_AIAgentSteps_SubAgentID_Description nvarchar(MAX)
    DECLARE @MJ_AIAgentSteps_SubAgentID_StepType nvarchar(20)
    DECLARE @MJ_AIAgentSteps_SubAgentID_StartingStep bit
    DECLARE @MJ_AIAgentSteps_SubAgentID_TimeoutSeconds int
    DECLARE @MJ_AIAgentSteps_SubAgentID_RetryCount int
    DECLARE @MJ_AIAgentSteps_SubAgentID_OnErrorBehavior nvarchar(20)
    DECLARE @MJ_AIAgentSteps_SubAgentID_ActionID uniqueidentifier
    DECLARE @MJ_AIAgentSteps_SubAgentID_SubAgentID uniqueidentifier
    DECLARE @MJ_AIAgentSteps_SubAgentID_PromptID uniqueidentifier
    DECLARE @MJ_AIAgentSteps_SubAgentID_ActionOutputMapping nvarchar(MAX)
    DECLARE @MJ_AIAgentSteps_SubAgentID_PositionX int
    DECLARE @MJ_AIAgentSteps_SubAgentID_PositionY int
    DECLARE @MJ_AIAgentSteps_SubAgentID_Width int
    DECLARE @MJ_AIAgentSteps_SubAgentID_Height int
    DECLARE @MJ_AIAgentSteps_SubAgentID_Status nvarchar(20)
    DECLARE @MJ_AIAgentSteps_SubAgentID_ActionInputMapping nvarchar(MAX)
    DECLARE @MJ_AIAgentSteps_SubAgentID_LoopBodyType nvarchar(50)
    DECLARE @MJ_AIAgentSteps_SubAgentID_Configuration nvarchar(MAX)
    DECLARE cascade_update_MJ_AIAgentSteps_SubAgentID_cursor CURSOR FOR
        SELECT [ID], [AgentID], [Name], [Description], [StepType], [StartingStep], [TimeoutSeconds], [RetryCount], [OnErrorBehavior], [ActionID], [SubAgentID], [PromptID], [ActionOutputMapping], [PositionX], [PositionY], [Width], [Height], [Status], [ActionInputMapping], [LoopBodyType], [Configuration]
        FROM [${flyway:defaultSchema}].[AIAgentStep]
        WHERE [SubAgentID] = @ID

    OPEN cascade_update_MJ_AIAgentSteps_SubAgentID_cursor
    FETCH NEXT FROM cascade_update_MJ_AIAgentSteps_SubAgentID_cursor INTO @MJ_AIAgentSteps_SubAgentIDID, @MJ_AIAgentSteps_SubAgentID_AgentID, @MJ_AIAgentSteps_SubAgentID_Name, @MJ_AIAgentSteps_SubAgentID_Description, @MJ_AIAgentSteps_SubAgentID_StepType, @MJ_AIAgentSteps_SubAgentID_StartingStep, @MJ_AIAgentSteps_SubAgentID_TimeoutSeconds, @MJ_AIAgentSteps_SubAgentID_RetryCount, @MJ_AIAgentSteps_SubAgentID_OnErrorBehavior, @MJ_AIAgentSteps_SubAgentID_ActionID, @MJ_AIAgentSteps_SubAgentID_SubAgentID, @MJ_AIAgentSteps_SubAgentID_PromptID, @MJ_AIAgentSteps_SubAgentID_ActionOutputMapping, @MJ_AIAgentSteps_SubAgentID_PositionX, @MJ_AIAgentSteps_SubAgentID_PositionY, @MJ_AIAgentSteps_SubAgentID_Width, @MJ_AIAgentSteps_SubAgentID_Height, @MJ_AIAgentSteps_SubAgentID_Status, @MJ_AIAgentSteps_SubAgentID_ActionInputMapping, @MJ_AIAgentSteps_SubAgentID_LoopBodyType, @MJ_AIAgentSteps_SubAgentID_Configuration

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @MJ_AIAgentSteps_SubAgentID_SubAgentID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateAIAgentStep] @ID = @MJ_AIAgentSteps_SubAgentIDID, @AgentID = @MJ_AIAgentSteps_SubAgentID_AgentID, @Name = @MJ_AIAgentSteps_SubAgentID_Name, @Description = @MJ_AIAgentSteps_SubAgentID_Description, @StepType = @MJ_AIAgentSteps_SubAgentID_StepType, @StartingStep = @MJ_AIAgentSteps_SubAgentID_StartingStep, @TimeoutSeconds = @MJ_AIAgentSteps_SubAgentID_TimeoutSeconds, @RetryCount = @MJ_AIAgentSteps_SubAgentID_RetryCount, @OnErrorBehavior = @MJ_AIAgentSteps_SubAgentID_OnErrorBehavior, @ActionID = @MJ_AIAgentSteps_SubAgentID_ActionID, @SubAgentID = @MJ_AIAgentSteps_SubAgentID_SubAgentID, @PromptID = @MJ_AIAgentSteps_SubAgentID_PromptID, @ActionOutputMapping = @MJ_AIAgentSteps_SubAgentID_ActionOutputMapping, @PositionX = @MJ_AIAgentSteps_SubAgentID_PositionX, @PositionY = @MJ_AIAgentSteps_SubAgentID_PositionY, @Width = @MJ_AIAgentSteps_SubAgentID_Width, @Height = @MJ_AIAgentSteps_SubAgentID_Height, @Status = @MJ_AIAgentSteps_SubAgentID_Status, @ActionInputMapping = @MJ_AIAgentSteps_SubAgentID_ActionInputMapping, @LoopBodyType = @MJ_AIAgentSteps_SubAgentID_LoopBodyType, @Configuration = @MJ_AIAgentSteps_SubAgentID_Configuration

        FETCH NEXT FROM cascade_update_MJ_AIAgentSteps_SubAgentID_cursor INTO @MJ_AIAgentSteps_SubAgentIDID, @MJ_AIAgentSteps_SubAgentID_AgentID, @MJ_AIAgentSteps_SubAgentID_Name, @MJ_AIAgentSteps_SubAgentID_Description, @MJ_AIAgentSteps_SubAgentID_StepType, @MJ_AIAgentSteps_SubAgentID_StartingStep, @MJ_AIAgentSteps_SubAgentID_TimeoutSeconds, @MJ_AIAgentSteps_SubAgentID_RetryCount, @MJ_AIAgentSteps_SubAgentID_OnErrorBehavior, @MJ_AIAgentSteps_SubAgentID_ActionID, @MJ_AIAgentSteps_SubAgentID_SubAgentID, @MJ_AIAgentSteps_SubAgentID_PromptID, @MJ_AIAgentSteps_SubAgentID_ActionOutputMapping, @MJ_AIAgentSteps_SubAgentID_PositionX, @MJ_AIAgentSteps_SubAgentID_PositionY, @MJ_AIAgentSteps_SubAgentID_Width, @MJ_AIAgentSteps_SubAgentID_Height, @MJ_AIAgentSteps_SubAgentID_Status, @MJ_AIAgentSteps_SubAgentID_ActionInputMapping, @MJ_AIAgentSteps_SubAgentID_LoopBodyType, @MJ_AIAgentSteps_SubAgentID_Configuration
    END

    CLOSE cascade_update_MJ_AIAgentSteps_SubAgentID_cursor
    DEALLOCATE cascade_update_MJ_AIAgentSteps_SubAgentID_cursor
    
    -- Cascade update on AIPromptRun using cursor to call spUpdateAIPromptRun
    DECLARE @MJ_AIPromptRuns_AgentIDID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_AgentID_PromptID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_AgentID_ModelID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_AgentID_VendorID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_AgentID_AgentID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_AgentID_ConfigurationID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_AgentID_RunAt datetimeoffset
    DECLARE @MJ_AIPromptRuns_AgentID_CompletedAt datetimeoffset
    DECLARE @MJ_AIPromptRuns_AgentID_ExecutionTimeMS int
    DECLARE @MJ_AIPromptRuns_AgentID_Messages nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_AgentID_Result nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_AgentID_TokensUsed int
    DECLARE @MJ_AIPromptRuns_AgentID_TokensPrompt int
    DECLARE @MJ_AIPromptRuns_AgentID_TokensCompletion int
    DECLARE @MJ_AIPromptRuns_AgentID_TotalCost decimal(18, 6)
    DECLARE @MJ_AIPromptRuns_AgentID_Success bit
    DECLARE @MJ_AIPromptRuns_AgentID_ErrorMessage nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_AgentID_ParentID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_AgentID_RunType nvarchar(20)
    DECLARE @MJ_AIPromptRuns_AgentID_ExecutionOrder int
    DECLARE @MJ_AIPromptRuns_AgentID_AgentRunID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_AgentID_Cost decimal(19, 8)
    DECLARE @MJ_AIPromptRuns_AgentID_CostCurrency nvarchar(10)
    DECLARE @MJ_AIPromptRuns_AgentID_TokensUsedRollup int
    DECLARE @MJ_AIPromptRuns_AgentID_TokensPromptRollup int
    DECLARE @MJ_AIPromptRuns_AgentID_TokensCompletionRollup int
    DECLARE @MJ_AIPromptRuns_AgentID_Temperature decimal(3, 2)
    DECLARE @MJ_AIPromptRuns_AgentID_TopP decimal(3, 2)
    DECLARE @MJ_AIPromptRuns_AgentID_TopK int
    DECLARE @MJ_AIPromptRuns_AgentID_MinP decimal(3, 2)
    DECLARE @MJ_AIPromptRuns_AgentID_FrequencyPenalty decimal(3, 2)
    DECLARE @MJ_AIPromptRuns_AgentID_PresencePenalty decimal(3, 2)
    DECLARE @MJ_AIPromptRuns_AgentID_Seed int
    DECLARE @MJ_AIPromptRuns_AgentID_StopSequences nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_AgentID_ResponseFormat nvarchar(50)
    DECLARE @MJ_AIPromptRuns_AgentID_LogProbs bit
    DECLARE @MJ_AIPromptRuns_AgentID_TopLogProbs int
    DECLARE @MJ_AIPromptRuns_AgentID_DescendantCost decimal(18, 6)
    DECLARE @MJ_AIPromptRuns_AgentID_ValidationAttemptCount int
    DECLARE @MJ_AIPromptRuns_AgentID_SuccessfulValidationCount int
    DECLARE @MJ_AIPromptRuns_AgentID_FinalValidationPassed bit
    DECLARE @MJ_AIPromptRuns_AgentID_ValidationBehavior nvarchar(50)
    DECLARE @MJ_AIPromptRuns_AgentID_RetryStrategy nvarchar(50)
    DECLARE @MJ_AIPromptRuns_AgentID_MaxRetriesConfigured int
    DECLARE @MJ_AIPromptRuns_AgentID_FinalValidationError nvarchar(500)
    DECLARE @MJ_AIPromptRuns_AgentID_ValidationErrorCount int
    DECLARE @MJ_AIPromptRuns_AgentID_CommonValidationError nvarchar(255)
    DECLARE @MJ_AIPromptRuns_AgentID_FirstAttemptAt datetimeoffset
    DECLARE @MJ_AIPromptRuns_AgentID_LastAttemptAt datetimeoffset
    DECLARE @MJ_AIPromptRuns_AgentID_TotalRetryDurationMS int
    DECLARE @MJ_AIPromptRuns_AgentID_ValidationAttempts nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_AgentID_ValidationSummary nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_AgentID_FailoverAttempts int
    DECLARE @MJ_AIPromptRuns_AgentID_FailoverErrors nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_AgentID_FailoverDurations nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_AgentID_OriginalModelID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_AgentID_OriginalRequestStartTime datetimeoffset
    DECLARE @MJ_AIPromptRuns_AgentID_TotalFailoverDuration int
    DECLARE @MJ_AIPromptRuns_AgentID_RerunFromPromptRunID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_AgentID_ModelSelection nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_AgentID_Status nvarchar(50)
    DECLARE @MJ_AIPromptRuns_AgentID_Cancelled bit
    DECLARE @MJ_AIPromptRuns_AgentID_CancellationReason nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_AgentID_ModelPowerRank int
    DECLARE @MJ_AIPromptRuns_AgentID_SelectionStrategy nvarchar(50)
    DECLARE @MJ_AIPromptRuns_AgentID_CacheHit bit
    DECLARE @MJ_AIPromptRuns_AgentID_CacheKey nvarchar(500)
    DECLARE @MJ_AIPromptRuns_AgentID_JudgeID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_AgentID_JudgeScore float(53)
    DECLARE @MJ_AIPromptRuns_AgentID_WasSelectedResult bit
    DECLARE @MJ_AIPromptRuns_AgentID_StreamingEnabled bit
    DECLARE @MJ_AIPromptRuns_AgentID_FirstTokenTime int
    DECLARE @MJ_AIPromptRuns_AgentID_ErrorDetails nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_AgentID_ChildPromptID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_AgentID_QueueTime int
    DECLARE @MJ_AIPromptRuns_AgentID_PromptTime int
    DECLARE @MJ_AIPromptRuns_AgentID_CompletionTime int
    DECLARE @MJ_AIPromptRuns_AgentID_ModelSpecificResponseDetails nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_AgentID_EffortLevel int
    DECLARE @MJ_AIPromptRuns_AgentID_RunName nvarchar(255)
    DECLARE @MJ_AIPromptRuns_AgentID_Comments nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_AgentID_TestRunID uniqueidentifier
    DECLARE cascade_update_MJ_AIPromptRuns_AgentID_cursor CURSOR FOR
        SELECT [ID], [PromptID], [ModelID], [VendorID], [AgentID], [ConfigurationID], [RunAt], [CompletedAt], [ExecutionTimeMS], [Messages], [Result], [TokensUsed], [TokensPrompt], [TokensCompletion], [TotalCost], [Success], [ErrorMessage], [ParentID], [RunType], [ExecutionOrder], [AgentRunID], [Cost], [CostCurrency], [TokensUsedRollup], [TokensPromptRollup], [TokensCompletionRollup], [Temperature], [TopP], [TopK], [MinP], [FrequencyPenalty], [PresencePenalty], [Seed], [StopSequences], [ResponseFormat], [LogProbs], [TopLogProbs], [DescendantCost], [ValidationAttemptCount], [SuccessfulValidationCount], [FinalValidationPassed], [ValidationBehavior], [RetryStrategy], [MaxRetriesConfigured], [FinalValidationError], [ValidationErrorCount], [CommonValidationError], [FirstAttemptAt], [LastAttemptAt], [TotalRetryDurationMS], [ValidationAttempts], [ValidationSummary], [FailoverAttempts], [FailoverErrors], [FailoverDurations], [OriginalModelID], [OriginalRequestStartTime], [TotalFailoverDuration], [RerunFromPromptRunID], [ModelSelection], [Status], [Cancelled], [CancellationReason], [ModelPowerRank], [SelectionStrategy], [CacheHit], [CacheKey], [JudgeID], [JudgeScore], [WasSelectedResult], [StreamingEnabled], [FirstTokenTime], [ErrorDetails], [ChildPromptID], [QueueTime], [PromptTime], [CompletionTime], [ModelSpecificResponseDetails], [EffortLevel], [RunName], [Comments], [TestRunID]
        FROM [${flyway:defaultSchema}].[AIPromptRun]
        WHERE [AgentID] = @ID

    OPEN cascade_update_MJ_AIPromptRuns_AgentID_cursor
    FETCH NEXT FROM cascade_update_MJ_AIPromptRuns_AgentID_cursor INTO @MJ_AIPromptRuns_AgentIDID, @MJ_AIPromptRuns_AgentID_PromptID, @MJ_AIPromptRuns_AgentID_ModelID, @MJ_AIPromptRuns_AgentID_VendorID, @MJ_AIPromptRuns_AgentID_AgentID, @MJ_AIPromptRuns_AgentID_ConfigurationID, @MJ_AIPromptRuns_AgentID_RunAt, @MJ_AIPromptRuns_AgentID_CompletedAt, @MJ_AIPromptRuns_AgentID_ExecutionTimeMS, @MJ_AIPromptRuns_AgentID_Messages, @MJ_AIPromptRuns_AgentID_Result, @MJ_AIPromptRuns_AgentID_TokensUsed, @MJ_AIPromptRuns_AgentID_TokensPrompt, @MJ_AIPromptRuns_AgentID_TokensCompletion, @MJ_AIPromptRuns_AgentID_TotalCost, @MJ_AIPromptRuns_AgentID_Success, @MJ_AIPromptRuns_AgentID_ErrorMessage, @MJ_AIPromptRuns_AgentID_ParentID, @MJ_AIPromptRuns_AgentID_RunType, @MJ_AIPromptRuns_AgentID_ExecutionOrder, @MJ_AIPromptRuns_AgentID_AgentRunID, @MJ_AIPromptRuns_AgentID_Cost, @MJ_AIPromptRuns_AgentID_CostCurrency, @MJ_AIPromptRuns_AgentID_TokensUsedRollup, @MJ_AIPromptRuns_AgentID_TokensPromptRollup, @MJ_AIPromptRuns_AgentID_TokensCompletionRollup, @MJ_AIPromptRuns_AgentID_Temperature, @MJ_AIPromptRuns_AgentID_TopP, @MJ_AIPromptRuns_AgentID_TopK, @MJ_AIPromptRuns_AgentID_MinP, @MJ_AIPromptRuns_AgentID_FrequencyPenalty, @MJ_AIPromptRuns_AgentID_PresencePenalty, @MJ_AIPromptRuns_AgentID_Seed, @MJ_AIPromptRuns_AgentID_StopSequences, @MJ_AIPromptRuns_AgentID_ResponseFormat, @MJ_AIPromptRuns_AgentID_LogProbs, @MJ_AIPromptRuns_AgentID_TopLogProbs, @MJ_AIPromptRuns_AgentID_DescendantCost, @MJ_AIPromptRuns_AgentID_ValidationAttemptCount, @MJ_AIPromptRuns_AgentID_SuccessfulValidationCount, @MJ_AIPromptRuns_AgentID_FinalValidationPassed, @MJ_AIPromptRuns_AgentID_ValidationBehavior, @MJ_AIPromptRuns_AgentID_RetryStrategy, @MJ_AIPromptRuns_AgentID_MaxRetriesConfigured, @MJ_AIPromptRuns_AgentID_FinalValidationError, @MJ_AIPromptRuns_AgentID_ValidationErrorCount, @MJ_AIPromptRuns_AgentID_CommonValidationError, @MJ_AIPromptRuns_AgentID_FirstAttemptAt, @MJ_AIPromptRuns_AgentID_LastAttemptAt, @MJ_AIPromptRuns_AgentID_TotalRetryDurationMS, @MJ_AIPromptRuns_AgentID_ValidationAttempts, @MJ_AIPromptRuns_AgentID_ValidationSummary, @MJ_AIPromptRuns_AgentID_FailoverAttempts, @MJ_AIPromptRuns_AgentID_FailoverErrors, @MJ_AIPromptRuns_AgentID_FailoverDurations, @MJ_AIPromptRuns_AgentID_OriginalModelID, @MJ_AIPromptRuns_AgentID_OriginalRequestStartTime, @MJ_AIPromptRuns_AgentID_TotalFailoverDuration, @MJ_AIPromptRuns_AgentID_RerunFromPromptRunID, @MJ_AIPromptRuns_AgentID_ModelSelection, @MJ_AIPromptRuns_AgentID_Status, @MJ_AIPromptRuns_AgentID_Cancelled, @MJ_AIPromptRuns_AgentID_CancellationReason, @MJ_AIPromptRuns_AgentID_ModelPowerRank, @MJ_AIPromptRuns_AgentID_SelectionStrategy, @MJ_AIPromptRuns_AgentID_CacheHit, @MJ_AIPromptRuns_AgentID_CacheKey, @MJ_AIPromptRuns_AgentID_JudgeID, @MJ_AIPromptRuns_AgentID_JudgeScore, @MJ_AIPromptRuns_AgentID_WasSelectedResult, @MJ_AIPromptRuns_AgentID_StreamingEnabled, @MJ_AIPromptRuns_AgentID_FirstTokenTime, @MJ_AIPromptRuns_AgentID_ErrorDetails, @MJ_AIPromptRuns_AgentID_ChildPromptID, @MJ_AIPromptRuns_AgentID_QueueTime, @MJ_AIPromptRuns_AgentID_PromptTime, @MJ_AIPromptRuns_AgentID_CompletionTime, @MJ_AIPromptRuns_AgentID_ModelSpecificResponseDetails, @MJ_AIPromptRuns_AgentID_EffortLevel, @MJ_AIPromptRuns_AgentID_RunName, @MJ_AIPromptRuns_AgentID_Comments, @MJ_AIPromptRuns_AgentID_TestRunID

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @MJ_AIPromptRuns_AgentID_AgentID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateAIPromptRun] @ID = @MJ_AIPromptRuns_AgentIDID, @PromptID = @MJ_AIPromptRuns_AgentID_PromptID, @ModelID = @MJ_AIPromptRuns_AgentID_ModelID, @VendorID = @MJ_AIPromptRuns_AgentID_VendorID, @AgentID = @MJ_AIPromptRuns_AgentID_AgentID, @ConfigurationID = @MJ_AIPromptRuns_AgentID_ConfigurationID, @RunAt = @MJ_AIPromptRuns_AgentID_RunAt, @CompletedAt = @MJ_AIPromptRuns_AgentID_CompletedAt, @ExecutionTimeMS = @MJ_AIPromptRuns_AgentID_ExecutionTimeMS, @Messages = @MJ_AIPromptRuns_AgentID_Messages, @Result = @MJ_AIPromptRuns_AgentID_Result, @TokensUsed = @MJ_AIPromptRuns_AgentID_TokensUsed, @TokensPrompt = @MJ_AIPromptRuns_AgentID_TokensPrompt, @TokensCompletion = @MJ_AIPromptRuns_AgentID_TokensCompletion, @TotalCost = @MJ_AIPromptRuns_AgentID_TotalCost, @Success = @MJ_AIPromptRuns_AgentID_Success, @ErrorMessage = @MJ_AIPromptRuns_AgentID_ErrorMessage, @ParentID = @MJ_AIPromptRuns_AgentID_ParentID, @RunType = @MJ_AIPromptRuns_AgentID_RunType, @ExecutionOrder = @MJ_AIPromptRuns_AgentID_ExecutionOrder, @AgentRunID = @MJ_AIPromptRuns_AgentID_AgentRunID, @Cost = @MJ_AIPromptRuns_AgentID_Cost, @CostCurrency = @MJ_AIPromptRuns_AgentID_CostCurrency, @TokensUsedRollup = @MJ_AIPromptRuns_AgentID_TokensUsedRollup, @TokensPromptRollup = @MJ_AIPromptRuns_AgentID_TokensPromptRollup, @TokensCompletionRollup = @MJ_AIPromptRuns_AgentID_TokensCompletionRollup, @Temperature = @MJ_AIPromptRuns_AgentID_Temperature, @TopP = @MJ_AIPromptRuns_AgentID_TopP, @TopK = @MJ_AIPromptRuns_AgentID_TopK, @MinP = @MJ_AIPromptRuns_AgentID_MinP, @FrequencyPenalty = @MJ_AIPromptRuns_AgentID_FrequencyPenalty, @PresencePenalty = @MJ_AIPromptRuns_AgentID_PresencePenalty, @Seed = @MJ_AIPromptRuns_AgentID_Seed, @StopSequences = @MJ_AIPromptRuns_AgentID_StopSequences, @ResponseFormat = @MJ_AIPromptRuns_AgentID_ResponseFormat, @LogProbs = @MJ_AIPromptRuns_AgentID_LogProbs, @TopLogProbs = @MJ_AIPromptRuns_AgentID_TopLogProbs, @DescendantCost = @MJ_AIPromptRuns_AgentID_DescendantCost, @ValidationAttemptCount = @MJ_AIPromptRuns_AgentID_ValidationAttemptCount, @SuccessfulValidationCount = @MJ_AIPromptRuns_AgentID_SuccessfulValidationCount, @FinalValidationPassed = @MJ_AIPromptRuns_AgentID_FinalValidationPassed, @ValidationBehavior = @MJ_AIPromptRuns_AgentID_ValidationBehavior, @RetryStrategy = @MJ_AIPromptRuns_AgentID_RetryStrategy, @MaxRetriesConfigured = @MJ_AIPromptRuns_AgentID_MaxRetriesConfigured, @FinalValidationError = @MJ_AIPromptRuns_AgentID_FinalValidationError, @ValidationErrorCount = @MJ_AIPromptRuns_AgentID_ValidationErrorCount, @CommonValidationError = @MJ_AIPromptRuns_AgentID_CommonValidationError, @FirstAttemptAt = @MJ_AIPromptRuns_AgentID_FirstAttemptAt, @LastAttemptAt = @MJ_AIPromptRuns_AgentID_LastAttemptAt, @TotalRetryDurationMS = @MJ_AIPromptRuns_AgentID_TotalRetryDurationMS, @ValidationAttempts = @MJ_AIPromptRuns_AgentID_ValidationAttempts, @ValidationSummary = @MJ_AIPromptRuns_AgentID_ValidationSummary, @FailoverAttempts = @MJ_AIPromptRuns_AgentID_FailoverAttempts, @FailoverErrors = @MJ_AIPromptRuns_AgentID_FailoverErrors, @FailoverDurations = @MJ_AIPromptRuns_AgentID_FailoverDurations, @OriginalModelID = @MJ_AIPromptRuns_AgentID_OriginalModelID, @OriginalRequestStartTime = @MJ_AIPromptRuns_AgentID_OriginalRequestStartTime, @TotalFailoverDuration = @MJ_AIPromptRuns_AgentID_TotalFailoverDuration, @RerunFromPromptRunID = @MJ_AIPromptRuns_AgentID_RerunFromPromptRunID, @ModelSelection = @MJ_AIPromptRuns_AgentID_ModelSelection, @Status = @MJ_AIPromptRuns_AgentID_Status, @Cancelled = @MJ_AIPromptRuns_AgentID_Cancelled, @CancellationReason = @MJ_AIPromptRuns_AgentID_CancellationReason, @ModelPowerRank = @MJ_AIPromptRuns_AgentID_ModelPowerRank, @SelectionStrategy = @MJ_AIPromptRuns_AgentID_SelectionStrategy, @CacheHit = @MJ_AIPromptRuns_AgentID_CacheHit, @CacheKey = @MJ_AIPromptRuns_AgentID_CacheKey, @JudgeID = @MJ_AIPromptRuns_AgentID_JudgeID, @JudgeScore = @MJ_AIPromptRuns_AgentID_JudgeScore, @WasSelectedResult = @MJ_AIPromptRuns_AgentID_WasSelectedResult, @StreamingEnabled = @MJ_AIPromptRuns_AgentID_StreamingEnabled, @FirstTokenTime = @MJ_AIPromptRuns_AgentID_FirstTokenTime, @ErrorDetails = @MJ_AIPromptRuns_AgentID_ErrorDetails, @ChildPromptID = @MJ_AIPromptRuns_AgentID_ChildPromptID, @QueueTime = @MJ_AIPromptRuns_AgentID_QueueTime, @PromptTime = @MJ_AIPromptRuns_AgentID_PromptTime, @CompletionTime = @MJ_AIPromptRuns_AgentID_CompletionTime, @ModelSpecificResponseDetails = @MJ_AIPromptRuns_AgentID_ModelSpecificResponseDetails, @EffortLevel = @MJ_AIPromptRuns_AgentID_EffortLevel, @RunName = @MJ_AIPromptRuns_AgentID_RunName, @Comments = @MJ_AIPromptRuns_AgentID_Comments, @TestRunID = @MJ_AIPromptRuns_AgentID_TestRunID

        FETCH NEXT FROM cascade_update_MJ_AIPromptRuns_AgentID_cursor INTO @MJ_AIPromptRuns_AgentIDID, @MJ_AIPromptRuns_AgentID_PromptID, @MJ_AIPromptRuns_AgentID_ModelID, @MJ_AIPromptRuns_AgentID_VendorID, @MJ_AIPromptRuns_AgentID_AgentID, @MJ_AIPromptRuns_AgentID_ConfigurationID, @MJ_AIPromptRuns_AgentID_RunAt, @MJ_AIPromptRuns_AgentID_CompletedAt, @MJ_AIPromptRuns_AgentID_ExecutionTimeMS, @MJ_AIPromptRuns_AgentID_Messages, @MJ_AIPromptRuns_AgentID_Result, @MJ_AIPromptRuns_AgentID_TokensUsed, @MJ_AIPromptRuns_AgentID_TokensPrompt, @MJ_AIPromptRuns_AgentID_TokensCompletion, @MJ_AIPromptRuns_AgentID_TotalCost, @MJ_AIPromptRuns_AgentID_Success, @MJ_AIPromptRuns_AgentID_ErrorMessage, @MJ_AIPromptRuns_AgentID_ParentID, @MJ_AIPromptRuns_AgentID_RunType, @MJ_AIPromptRuns_AgentID_ExecutionOrder, @MJ_AIPromptRuns_AgentID_AgentRunID, @MJ_AIPromptRuns_AgentID_Cost, @MJ_AIPromptRuns_AgentID_CostCurrency, @MJ_AIPromptRuns_AgentID_TokensUsedRollup, @MJ_AIPromptRuns_AgentID_TokensPromptRollup, @MJ_AIPromptRuns_AgentID_TokensCompletionRollup, @MJ_AIPromptRuns_AgentID_Temperature, @MJ_AIPromptRuns_AgentID_TopP, @MJ_AIPromptRuns_AgentID_TopK, @MJ_AIPromptRuns_AgentID_MinP, @MJ_AIPromptRuns_AgentID_FrequencyPenalty, @MJ_AIPromptRuns_AgentID_PresencePenalty, @MJ_AIPromptRuns_AgentID_Seed, @MJ_AIPromptRuns_AgentID_StopSequences, @MJ_AIPromptRuns_AgentID_ResponseFormat, @MJ_AIPromptRuns_AgentID_LogProbs, @MJ_AIPromptRuns_AgentID_TopLogProbs, @MJ_AIPromptRuns_AgentID_DescendantCost, @MJ_AIPromptRuns_AgentID_ValidationAttemptCount, @MJ_AIPromptRuns_AgentID_SuccessfulValidationCount, @MJ_AIPromptRuns_AgentID_FinalValidationPassed, @MJ_AIPromptRuns_AgentID_ValidationBehavior, @MJ_AIPromptRuns_AgentID_RetryStrategy, @MJ_AIPromptRuns_AgentID_MaxRetriesConfigured, @MJ_AIPromptRuns_AgentID_FinalValidationError, @MJ_AIPromptRuns_AgentID_ValidationErrorCount, @MJ_AIPromptRuns_AgentID_CommonValidationError, @MJ_AIPromptRuns_AgentID_FirstAttemptAt, @MJ_AIPromptRuns_AgentID_LastAttemptAt, @MJ_AIPromptRuns_AgentID_TotalRetryDurationMS, @MJ_AIPromptRuns_AgentID_ValidationAttempts, @MJ_AIPromptRuns_AgentID_ValidationSummary, @MJ_AIPromptRuns_AgentID_FailoverAttempts, @MJ_AIPromptRuns_AgentID_FailoverErrors, @MJ_AIPromptRuns_AgentID_FailoverDurations, @MJ_AIPromptRuns_AgentID_OriginalModelID, @MJ_AIPromptRuns_AgentID_OriginalRequestStartTime, @MJ_AIPromptRuns_AgentID_TotalFailoverDuration, @MJ_AIPromptRuns_AgentID_RerunFromPromptRunID, @MJ_AIPromptRuns_AgentID_ModelSelection, @MJ_AIPromptRuns_AgentID_Status, @MJ_AIPromptRuns_AgentID_Cancelled, @MJ_AIPromptRuns_AgentID_CancellationReason, @MJ_AIPromptRuns_AgentID_ModelPowerRank, @MJ_AIPromptRuns_AgentID_SelectionStrategy, @MJ_AIPromptRuns_AgentID_CacheHit, @MJ_AIPromptRuns_AgentID_CacheKey, @MJ_AIPromptRuns_AgentID_JudgeID, @MJ_AIPromptRuns_AgentID_JudgeScore, @MJ_AIPromptRuns_AgentID_WasSelectedResult, @MJ_AIPromptRuns_AgentID_StreamingEnabled, @MJ_AIPromptRuns_AgentID_FirstTokenTime, @MJ_AIPromptRuns_AgentID_ErrorDetails, @MJ_AIPromptRuns_AgentID_ChildPromptID, @MJ_AIPromptRuns_AgentID_QueueTime, @MJ_AIPromptRuns_AgentID_PromptTime, @MJ_AIPromptRuns_AgentID_CompletionTime, @MJ_AIPromptRuns_AgentID_ModelSpecificResponseDetails, @MJ_AIPromptRuns_AgentID_EffortLevel, @MJ_AIPromptRuns_AgentID_RunName, @MJ_AIPromptRuns_AgentID_Comments, @MJ_AIPromptRuns_AgentID_TestRunID
    END

    CLOSE cascade_update_MJ_AIPromptRuns_AgentID_cursor
    DEALLOCATE cascade_update_MJ_AIPromptRuns_AgentID_cursor
    
    -- Cascade update on Task using cursor to call spUpdateTask
    DECLARE @MJ_Tasks_AgentIDID uniqueidentifier
    DECLARE @MJ_Tasks_AgentID_ParentID uniqueidentifier
    DECLARE @MJ_Tasks_AgentID_Name nvarchar(255)
    DECLARE @MJ_Tasks_AgentID_Description nvarchar(MAX)
    DECLARE @MJ_Tasks_AgentID_TypeID uniqueidentifier
    DECLARE @MJ_Tasks_AgentID_EnvironmentID uniqueidentifier
    DECLARE @MJ_Tasks_AgentID_ProjectID uniqueidentifier
    DECLARE @MJ_Tasks_AgentID_ConversationDetailID uniqueidentifier
    DECLARE @MJ_Tasks_AgentID_UserID uniqueidentifier
    DECLARE @MJ_Tasks_AgentID_AgentID uniqueidentifier
    DECLARE @MJ_Tasks_AgentID_Status nvarchar(50)
    DECLARE @MJ_Tasks_AgentID_PercentComplete int
    DECLARE @MJ_Tasks_AgentID_DueAt datetimeoffset
    DECLARE @MJ_Tasks_AgentID_StartedAt datetimeoffset
    DECLARE @MJ_Tasks_AgentID_CompletedAt datetimeoffset
    DECLARE cascade_update_MJ_Tasks_AgentID_cursor CURSOR FOR
        SELECT [ID], [ParentID], [Name], [Description], [TypeID], [EnvironmentID], [ProjectID], [ConversationDetailID], [UserID], [AgentID], [Status], [PercentComplete], [DueAt], [StartedAt], [CompletedAt]
        FROM [${flyway:defaultSchema}].[Task]
        WHERE [AgentID] = @ID

    OPEN cascade_update_MJ_Tasks_AgentID_cursor
    FETCH NEXT FROM cascade_update_MJ_Tasks_AgentID_cursor INTO @MJ_Tasks_AgentIDID, @MJ_Tasks_AgentID_ParentID, @MJ_Tasks_AgentID_Name, @MJ_Tasks_AgentID_Description, @MJ_Tasks_AgentID_TypeID, @MJ_Tasks_AgentID_EnvironmentID, @MJ_Tasks_AgentID_ProjectID, @MJ_Tasks_AgentID_ConversationDetailID, @MJ_Tasks_AgentID_UserID, @MJ_Tasks_AgentID_AgentID, @MJ_Tasks_AgentID_Status, @MJ_Tasks_AgentID_PercentComplete, @MJ_Tasks_AgentID_DueAt, @MJ_Tasks_AgentID_StartedAt, @MJ_Tasks_AgentID_CompletedAt

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @MJ_Tasks_AgentID_AgentID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateTask] @ID = @MJ_Tasks_AgentIDID, @ParentID = @MJ_Tasks_AgentID_ParentID, @Name = @MJ_Tasks_AgentID_Name, @Description = @MJ_Tasks_AgentID_Description, @TypeID = @MJ_Tasks_AgentID_TypeID, @EnvironmentID = @MJ_Tasks_AgentID_EnvironmentID, @ProjectID = @MJ_Tasks_AgentID_ProjectID, @ConversationDetailID = @MJ_Tasks_AgentID_ConversationDetailID, @UserID = @MJ_Tasks_AgentID_UserID, @AgentID = @MJ_Tasks_AgentID_AgentID, @Status = @MJ_Tasks_AgentID_Status, @PercentComplete = @MJ_Tasks_AgentID_PercentComplete, @DueAt = @MJ_Tasks_AgentID_DueAt, @StartedAt = @MJ_Tasks_AgentID_StartedAt, @CompletedAt = @MJ_Tasks_AgentID_CompletedAt

        FETCH NEXT FROM cascade_update_MJ_Tasks_AgentID_cursor INTO @MJ_Tasks_AgentIDID, @MJ_Tasks_AgentID_ParentID, @MJ_Tasks_AgentID_Name, @MJ_Tasks_AgentID_Description, @MJ_Tasks_AgentID_TypeID, @MJ_Tasks_AgentID_EnvironmentID, @MJ_Tasks_AgentID_ProjectID, @MJ_Tasks_AgentID_ConversationDetailID, @MJ_Tasks_AgentID_UserID, @MJ_Tasks_AgentID_AgentID, @MJ_Tasks_AgentID_Status, @MJ_Tasks_AgentID_PercentComplete, @MJ_Tasks_AgentID_DueAt, @MJ_Tasks_AgentID_StartedAt, @MJ_Tasks_AgentID_CompletedAt
    END

    CLOSE cascade_update_MJ_Tasks_AgentID_cursor
    DEALLOCATE cascade_update_MJ_Tasks_AgentID_cursor
    

    DELETE FROM
        [${flyway:defaultSchema}].[AIAgent]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteAIAgent] TO [cdp_Integration]
    

/* spDelete Permissions for AI Agents */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteAIAgent] TO [cdp_Integration]



/* spDelete SQL for AI Prompts */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: AI Prompts
-- Item: spDeleteAIPrompt
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR AIPrompt
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteAIPrompt]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteAIPrompt];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteAIPrompt]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    -- Cascade update on Action using cursor to call spUpdateAction
    DECLARE @Actions_DefaultCompactPromptIDID uniqueidentifier
    DECLARE @Actions_DefaultCompactPromptID_CategoryID uniqueidentifier
    DECLARE @Actions_DefaultCompactPromptID_Name nvarchar(425)
    DECLARE @Actions_DefaultCompactPromptID_Description nvarchar(MAX)
    DECLARE @Actions_DefaultCompactPromptID_Type nvarchar(20)
    DECLARE @Actions_DefaultCompactPromptID_UserPrompt nvarchar(MAX)
    DECLARE @Actions_DefaultCompactPromptID_UserComments nvarchar(MAX)
    DECLARE @Actions_DefaultCompactPromptID_Code nvarchar(MAX)
    DECLARE @Actions_DefaultCompactPromptID_CodeComments nvarchar(MAX)
    DECLARE @Actions_DefaultCompactPromptID_CodeApprovalStatus nvarchar(20)
    DECLARE @Actions_DefaultCompactPromptID_CodeApprovalComments nvarchar(MAX)
    DECLARE @Actions_DefaultCompactPromptID_CodeApprovedByUserID uniqueidentifier
    DECLARE @Actions_DefaultCompactPromptID_CodeApprovedAt datetimeoffset
    DECLARE @Actions_DefaultCompactPromptID_CodeLocked bit
    DECLARE @Actions_DefaultCompactPromptID_ForceCodeGeneration bit
    DECLARE @Actions_DefaultCompactPromptID_RetentionPeriod int
    DECLARE @Actions_DefaultCompactPromptID_Status nvarchar(20)
    DECLARE @Actions_DefaultCompactPromptID_DriverClass nvarchar(255)
    DECLARE @Actions_DefaultCompactPromptID_ParentID uniqueidentifier
    DECLARE @Actions_DefaultCompactPromptID_IconClass nvarchar(100)
    DECLARE @Actions_DefaultCompactPromptID_DefaultCompactPromptID uniqueidentifier
    DECLARE cascade_update_Actions_DefaultCompactPromptID_cursor CURSOR FOR
        SELECT [ID], [CategoryID], [Name], [Description], [Type], [UserPrompt], [UserComments], [Code], [CodeComments], [CodeApprovalStatus], [CodeApprovalComments], [CodeApprovedByUserID], [CodeApprovedAt], [CodeLocked], [ForceCodeGeneration], [RetentionPeriod], [Status], [DriverClass], [ParentID], [IconClass], [DefaultCompactPromptID]
        FROM [${flyway:defaultSchema}].[Action]
        WHERE [DefaultCompactPromptID] = @ID

    OPEN cascade_update_Actions_DefaultCompactPromptID_cursor
    FETCH NEXT FROM cascade_update_Actions_DefaultCompactPromptID_cursor INTO @Actions_DefaultCompactPromptIDID, @Actions_DefaultCompactPromptID_CategoryID, @Actions_DefaultCompactPromptID_Name, @Actions_DefaultCompactPromptID_Description, @Actions_DefaultCompactPromptID_Type, @Actions_DefaultCompactPromptID_UserPrompt, @Actions_DefaultCompactPromptID_UserComments, @Actions_DefaultCompactPromptID_Code, @Actions_DefaultCompactPromptID_CodeComments, @Actions_DefaultCompactPromptID_CodeApprovalStatus, @Actions_DefaultCompactPromptID_CodeApprovalComments, @Actions_DefaultCompactPromptID_CodeApprovedByUserID, @Actions_DefaultCompactPromptID_CodeApprovedAt, @Actions_DefaultCompactPromptID_CodeLocked, @Actions_DefaultCompactPromptID_ForceCodeGeneration, @Actions_DefaultCompactPromptID_RetentionPeriod, @Actions_DefaultCompactPromptID_Status, @Actions_DefaultCompactPromptID_DriverClass, @Actions_DefaultCompactPromptID_ParentID, @Actions_DefaultCompactPromptID_IconClass, @Actions_DefaultCompactPromptID_DefaultCompactPromptID

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @Actions_DefaultCompactPromptID_DefaultCompactPromptID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateAction] @ID = @Actions_DefaultCompactPromptIDID, @CategoryID = @Actions_DefaultCompactPromptID_CategoryID, @Name = @Actions_DefaultCompactPromptID_Name, @Description = @Actions_DefaultCompactPromptID_Description, @Type = @Actions_DefaultCompactPromptID_Type, @UserPrompt = @Actions_DefaultCompactPromptID_UserPrompt, @UserComments = @Actions_DefaultCompactPromptID_UserComments, @Code = @Actions_DefaultCompactPromptID_Code, @CodeComments = @Actions_DefaultCompactPromptID_CodeComments, @CodeApprovalStatus = @Actions_DefaultCompactPromptID_CodeApprovalStatus, @CodeApprovalComments = @Actions_DefaultCompactPromptID_CodeApprovalComments, @CodeApprovedByUserID = @Actions_DefaultCompactPromptID_CodeApprovedByUserID, @CodeApprovedAt = @Actions_DefaultCompactPromptID_CodeApprovedAt, @CodeLocked = @Actions_DefaultCompactPromptID_CodeLocked, @ForceCodeGeneration = @Actions_DefaultCompactPromptID_ForceCodeGeneration, @RetentionPeriod = @Actions_DefaultCompactPromptID_RetentionPeriod, @Status = @Actions_DefaultCompactPromptID_Status, @DriverClass = @Actions_DefaultCompactPromptID_DriverClass, @ParentID = @Actions_DefaultCompactPromptID_ParentID, @IconClass = @Actions_DefaultCompactPromptID_IconClass, @DefaultCompactPromptID = @Actions_DefaultCompactPromptID_DefaultCompactPromptID

        FETCH NEXT FROM cascade_update_Actions_DefaultCompactPromptID_cursor INTO @Actions_DefaultCompactPromptIDID, @Actions_DefaultCompactPromptID_CategoryID, @Actions_DefaultCompactPromptID_Name, @Actions_DefaultCompactPromptID_Description, @Actions_DefaultCompactPromptID_Type, @Actions_DefaultCompactPromptID_UserPrompt, @Actions_DefaultCompactPromptID_UserComments, @Actions_DefaultCompactPromptID_Code, @Actions_DefaultCompactPromptID_CodeComments, @Actions_DefaultCompactPromptID_CodeApprovalStatus, @Actions_DefaultCompactPromptID_CodeApprovalComments, @Actions_DefaultCompactPromptID_CodeApprovedByUserID, @Actions_DefaultCompactPromptID_CodeApprovedAt, @Actions_DefaultCompactPromptID_CodeLocked, @Actions_DefaultCompactPromptID_ForceCodeGeneration, @Actions_DefaultCompactPromptID_RetentionPeriod, @Actions_DefaultCompactPromptID_Status, @Actions_DefaultCompactPromptID_DriverClass, @Actions_DefaultCompactPromptID_ParentID, @Actions_DefaultCompactPromptID_IconClass, @Actions_DefaultCompactPromptID_DefaultCompactPromptID
    END

    CLOSE cascade_update_Actions_DefaultCompactPromptID_cursor
    DEALLOCATE cascade_update_Actions_DefaultCompactPromptID_cursor
    
    -- Cascade update on AIAgentAction using cursor to call spUpdateAIAgentAction
    DECLARE @AIAgentActions_CompactPromptIDID uniqueidentifier
    DECLARE @AIAgentActions_CompactPromptID_AgentID uniqueidentifier
    DECLARE @AIAgentActions_CompactPromptID_ActionID uniqueidentifier
    DECLARE @AIAgentActions_CompactPromptID_Status nvarchar(15)
    DECLARE @AIAgentActions_CompactPromptID_MinExecutionsPerRun int
    DECLARE @AIAgentActions_CompactPromptID_MaxExecutionsPerRun int
    DECLARE @AIAgentActions_CompactPromptID_ResultExpirationTurns int
    DECLARE @AIAgentActions_CompactPromptID_ResultExpirationMode nvarchar(20)
    DECLARE @AIAgentActions_CompactPromptID_CompactMode nvarchar(20)
    DECLARE @AIAgentActions_CompactPromptID_CompactLength int
    DECLARE @AIAgentActions_CompactPromptID_CompactPromptID uniqueidentifier
    DECLARE cascade_update_AIAgentActions_CompactPromptID_cursor CURSOR FOR
        SELECT [ID], [AgentID], [ActionID], [Status], [MinExecutionsPerRun], [MaxExecutionsPerRun], [ResultExpirationTurns], [ResultExpirationMode], [CompactMode], [CompactLength], [CompactPromptID]
        FROM [${flyway:defaultSchema}].[AIAgentAction]
        WHERE [CompactPromptID] = @ID

    OPEN cascade_update_AIAgentActions_CompactPromptID_cursor
    FETCH NEXT FROM cascade_update_AIAgentActions_CompactPromptID_cursor INTO @AIAgentActions_CompactPromptIDID, @AIAgentActions_CompactPromptID_AgentID, @AIAgentActions_CompactPromptID_ActionID, @AIAgentActions_CompactPromptID_Status, @AIAgentActions_CompactPromptID_MinExecutionsPerRun, @AIAgentActions_CompactPromptID_MaxExecutionsPerRun, @AIAgentActions_CompactPromptID_ResultExpirationTurns, @AIAgentActions_CompactPromptID_ResultExpirationMode, @AIAgentActions_CompactPromptID_CompactMode, @AIAgentActions_CompactPromptID_CompactLength, @AIAgentActions_CompactPromptID_CompactPromptID

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @AIAgentActions_CompactPromptID_CompactPromptID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateAIAgentAction] @ID = @AIAgentActions_CompactPromptIDID, @AgentID = @AIAgentActions_CompactPromptID_AgentID, @ActionID = @AIAgentActions_CompactPromptID_ActionID, @Status = @AIAgentActions_CompactPromptID_Status, @MinExecutionsPerRun = @AIAgentActions_CompactPromptID_MinExecutionsPerRun, @MaxExecutionsPerRun = @AIAgentActions_CompactPromptID_MaxExecutionsPerRun, @ResultExpirationTurns = @AIAgentActions_CompactPromptID_ResultExpirationTurns, @ResultExpirationMode = @AIAgentActions_CompactPromptID_ResultExpirationMode, @CompactMode = @AIAgentActions_CompactPromptID_CompactMode, @CompactLength = @AIAgentActions_CompactPromptID_CompactLength, @CompactPromptID = @AIAgentActions_CompactPromptID_CompactPromptID

        FETCH NEXT FROM cascade_update_AIAgentActions_CompactPromptID_cursor INTO @AIAgentActions_CompactPromptIDID, @AIAgentActions_CompactPromptID_AgentID, @AIAgentActions_CompactPromptID_ActionID, @AIAgentActions_CompactPromptID_Status, @AIAgentActions_CompactPromptID_MinExecutionsPerRun, @AIAgentActions_CompactPromptID_MaxExecutionsPerRun, @AIAgentActions_CompactPromptID_ResultExpirationTurns, @AIAgentActions_CompactPromptID_ResultExpirationMode, @AIAgentActions_CompactPromptID_CompactMode, @AIAgentActions_CompactPromptID_CompactLength, @AIAgentActions_CompactPromptID_CompactPromptID
    END

    CLOSE cascade_update_AIAgentActions_CompactPromptID_cursor
    DEALLOCATE cascade_update_AIAgentActions_CompactPromptID_cursor
    
    -- Cascade update on AIAgent using cursor to call spUpdateAIAgent
    DECLARE @AIAgents_ContextCompressionPromptIDID uniqueidentifier
    DECLARE @AIAgents_ContextCompressionPromptID_Name nvarchar(255)
    DECLARE @AIAgents_ContextCompressionPromptID_Description nvarchar(MAX)
    DECLARE @AIAgents_ContextCompressionPromptID_LogoURL nvarchar(255)
    DECLARE @AIAgents_ContextCompressionPromptID_ParentID uniqueidentifier
    DECLARE @AIAgents_ContextCompressionPromptID_ExposeAsAction bit
    DECLARE @AIAgents_ContextCompressionPromptID_ExecutionOrder int
    DECLARE @AIAgents_ContextCompressionPromptID_ExecutionMode nvarchar(20)
    DECLARE @AIAgents_ContextCompressionPromptID_EnableContextCompression bit
    DECLARE @AIAgents_ContextCompressionPromptID_ContextCompressionMessageThreshold int
    DECLARE @AIAgents_ContextCompressionPromptID_ContextCompressionPromptID uniqueidentifier
    DECLARE @AIAgents_ContextCompressionPromptID_ContextCompressionMessageRetentionCount int
    DECLARE @AIAgents_ContextCompressionPromptID_TypeID uniqueidentifier
    DECLARE @AIAgents_ContextCompressionPromptID_Status nvarchar(20)
    DECLARE @AIAgents_ContextCompressionPromptID_DriverClass nvarchar(255)
    DECLARE @AIAgents_ContextCompressionPromptID_IconClass nvarchar(100)
    DECLARE @AIAgents_ContextCompressionPromptID_ModelSelectionMode nvarchar(50)
    DECLARE @AIAgents_ContextCompressionPromptID_PayloadDownstreamPaths nvarchar(MAX)
    DECLARE @AIAgents_ContextCompressionPromptID_PayloadUpstreamPaths nvarchar(MAX)
    DECLARE @AIAgents_ContextCompressionPromptID_PayloadSelfReadPaths nvarchar(MAX)
    DECLARE @AIAgents_ContextCompressionPromptID_PayloadSelfWritePaths nvarchar(MAX)
    DECLARE @AIAgents_ContextCompressionPromptID_PayloadScope nvarchar(MAX)
    DECLARE @AIAgents_ContextCompressionPromptID_FinalPayloadValidation nvarchar(MAX)
    DECLARE @AIAgents_ContextCompressionPromptID_FinalPayloadValidationMode nvarchar(25)
    DECLARE @AIAgents_ContextCompressionPromptID_FinalPayloadValidationMaxRetries int
    DECLARE @AIAgents_ContextCompressionPromptID_MaxCostPerRun decimal(10, 4)
    DECLARE @AIAgents_ContextCompressionPromptID_MaxTokensPerRun int
    DECLARE @AIAgents_ContextCompressionPromptID_MaxIterationsPerRun int
    DECLARE @AIAgents_ContextCompressionPromptID_MaxTimePerRun int
    DECLARE @AIAgents_ContextCompressionPromptID_MinExecutionsPerRun int
    DECLARE @AIAgents_ContextCompressionPromptID_MaxExecutionsPerRun int
    DECLARE @AIAgents_ContextCompressionPromptID_StartingPayloadValidation nvarchar(MAX)
    DECLARE @AIAgents_ContextCompressionPromptID_StartingPayloadValidationMode nvarchar(25)
    DECLARE @AIAgents_ContextCompressionPromptID_DefaultPromptEffortLevel int
    DECLARE @AIAgents_ContextCompressionPromptID_ChatHandlingOption nvarchar(30)
    DECLARE @AIAgents_ContextCompressionPromptID_DefaultArtifactTypeID uniqueidentifier
    DECLARE @AIAgents_ContextCompressionPromptID_OwnerUserID uniqueidentifier
    DECLARE @AIAgents_ContextCompressionPromptID_InvocationMode nvarchar(20)
    DECLARE @AIAgents_ContextCompressionPromptID_ArtifactCreationMode nvarchar(20)
    DECLARE @AIAgents_ContextCompressionPromptID_FunctionalRequirements nvarchar(MAX)
    DECLARE @AIAgents_ContextCompressionPromptID_TechnicalDesign nvarchar(MAX)
    DECLARE @AIAgents_ContextCompressionPromptID_InjectNotes bit
    DECLARE @AIAgents_ContextCompressionPromptID_MaxNotesToInject int
    DECLARE @AIAgents_ContextCompressionPromptID_NoteInjectionStrategy nvarchar(20)
    DECLARE @AIAgents_ContextCompressionPromptID_InjectExamples bit
    DECLARE @AIAgents_ContextCompressionPromptID_MaxExamplesToInject int
    DECLARE @AIAgents_ContextCompressionPromptID_ExampleInjectionStrategy nvarchar(20)
    DECLARE @AIAgents_ContextCompressionPromptID_IsRestricted bit
    DECLARE @AIAgents_ContextCompressionPromptID_MessageMode nvarchar(50)
    DECLARE @AIAgents_ContextCompressionPromptID_MaxMessages int
    DECLARE @AIAgents_ContextCompressionPromptID_AttachmentStorageProviderID uniqueidentifier
    DECLARE @AIAgents_ContextCompressionPromptID_AttachmentRootPath nvarchar(500)
    DECLARE @AIAgents_ContextCompressionPromptID_InlineStorageThresholdBytes int
    DECLARE @AIAgents_ContextCompressionPromptID_AgentTypePromptParams nvarchar(MAX)
    DECLARE @AIAgents_ContextCompressionPromptID_ScopeConfig nvarchar(MAX)
    DECLARE @AIAgents_ContextCompressionPromptID_NoteRetentionDays int
    DECLARE @AIAgents_ContextCompressionPromptID_ExampleRetentionDays int
    DECLARE @AIAgents_ContextCompressionPromptID_AutoArchiveEnabled bit
    DECLARE @AIAgents_ContextCompressionPromptID_RerankerConfiguration nvarchar(MAX)
    DECLARE cascade_update_AIAgents_ContextCompressionPromptID_cursor CURSOR FOR
        SELECT [ID], [Name], [Description], [LogoURL], [ParentID], [ExposeAsAction], [ExecutionOrder], [ExecutionMode], [EnableContextCompression], [ContextCompressionMessageThreshold], [ContextCompressionPromptID], [ContextCompressionMessageRetentionCount], [TypeID], [Status], [DriverClass], [IconClass], [ModelSelectionMode], [PayloadDownstreamPaths], [PayloadUpstreamPaths], [PayloadSelfReadPaths], [PayloadSelfWritePaths], [PayloadScope], [FinalPayloadValidation], [FinalPayloadValidationMode], [FinalPayloadValidationMaxRetries], [MaxCostPerRun], [MaxTokensPerRun], [MaxIterationsPerRun], [MaxTimePerRun], [MinExecutionsPerRun], [MaxExecutionsPerRun], [StartingPayloadValidation], [StartingPayloadValidationMode], [DefaultPromptEffortLevel], [ChatHandlingOption], [DefaultArtifactTypeID], [OwnerUserID], [InvocationMode], [ArtifactCreationMode], [FunctionalRequirements], [TechnicalDesign], [InjectNotes], [MaxNotesToInject], [NoteInjectionStrategy], [InjectExamples], [MaxExamplesToInject], [ExampleInjectionStrategy], [IsRestricted], [MessageMode], [MaxMessages], [AttachmentStorageProviderID], [AttachmentRootPath], [InlineStorageThresholdBytes], [AgentTypePromptParams], [ScopeConfig], [NoteRetentionDays], [ExampleRetentionDays], [AutoArchiveEnabled], [RerankerConfiguration]
        FROM [${flyway:defaultSchema}].[AIAgent]
        WHERE [ContextCompressionPromptID] = @ID

    OPEN cascade_update_AIAgents_ContextCompressionPromptID_cursor
    FETCH NEXT FROM cascade_update_AIAgents_ContextCompressionPromptID_cursor INTO @AIAgents_ContextCompressionPromptIDID, @AIAgents_ContextCompressionPromptID_Name, @AIAgents_ContextCompressionPromptID_Description, @AIAgents_ContextCompressionPromptID_LogoURL, @AIAgents_ContextCompressionPromptID_ParentID, @AIAgents_ContextCompressionPromptID_ExposeAsAction, @AIAgents_ContextCompressionPromptID_ExecutionOrder, @AIAgents_ContextCompressionPromptID_ExecutionMode, @AIAgents_ContextCompressionPromptID_EnableContextCompression, @AIAgents_ContextCompressionPromptID_ContextCompressionMessageThreshold, @AIAgents_ContextCompressionPromptID_ContextCompressionPromptID, @AIAgents_ContextCompressionPromptID_ContextCompressionMessageRetentionCount, @AIAgents_ContextCompressionPromptID_TypeID, @AIAgents_ContextCompressionPromptID_Status, @AIAgents_ContextCompressionPromptID_DriverClass, @AIAgents_ContextCompressionPromptID_IconClass, @AIAgents_ContextCompressionPromptID_ModelSelectionMode, @AIAgents_ContextCompressionPromptID_PayloadDownstreamPaths, @AIAgents_ContextCompressionPromptID_PayloadUpstreamPaths, @AIAgents_ContextCompressionPromptID_PayloadSelfReadPaths, @AIAgents_ContextCompressionPromptID_PayloadSelfWritePaths, @AIAgents_ContextCompressionPromptID_PayloadScope, @AIAgents_ContextCompressionPromptID_FinalPayloadValidation, @AIAgents_ContextCompressionPromptID_FinalPayloadValidationMode, @AIAgents_ContextCompressionPromptID_FinalPayloadValidationMaxRetries, @AIAgents_ContextCompressionPromptID_MaxCostPerRun, @AIAgents_ContextCompressionPromptID_MaxTokensPerRun, @AIAgents_ContextCompressionPromptID_MaxIterationsPerRun, @AIAgents_ContextCompressionPromptID_MaxTimePerRun, @AIAgents_ContextCompressionPromptID_MinExecutionsPerRun, @AIAgents_ContextCompressionPromptID_MaxExecutionsPerRun, @AIAgents_ContextCompressionPromptID_StartingPayloadValidation, @AIAgents_ContextCompressionPromptID_StartingPayloadValidationMode, @AIAgents_ContextCompressionPromptID_DefaultPromptEffortLevel, @AIAgents_ContextCompressionPromptID_ChatHandlingOption, @AIAgents_ContextCompressionPromptID_DefaultArtifactTypeID, @AIAgents_ContextCompressionPromptID_OwnerUserID, @AIAgents_ContextCompressionPromptID_InvocationMode, @AIAgents_ContextCompressionPromptID_ArtifactCreationMode, @AIAgents_ContextCompressionPromptID_FunctionalRequirements, @AIAgents_ContextCompressionPromptID_TechnicalDesign, @AIAgents_ContextCompressionPromptID_InjectNotes, @AIAgents_ContextCompressionPromptID_MaxNotesToInject, @AIAgents_ContextCompressionPromptID_NoteInjectionStrategy, @AIAgents_ContextCompressionPromptID_InjectExamples, @AIAgents_ContextCompressionPromptID_MaxExamplesToInject, @AIAgents_ContextCompressionPromptID_ExampleInjectionStrategy, @AIAgents_ContextCompressionPromptID_IsRestricted, @AIAgents_ContextCompressionPromptID_MessageMode, @AIAgents_ContextCompressionPromptID_MaxMessages, @AIAgents_ContextCompressionPromptID_AttachmentStorageProviderID, @AIAgents_ContextCompressionPromptID_AttachmentRootPath, @AIAgents_ContextCompressionPromptID_InlineStorageThresholdBytes, @AIAgents_ContextCompressionPromptID_AgentTypePromptParams, @AIAgents_ContextCompressionPromptID_ScopeConfig, @AIAgents_ContextCompressionPromptID_NoteRetentionDays, @AIAgents_ContextCompressionPromptID_ExampleRetentionDays, @AIAgents_ContextCompressionPromptID_AutoArchiveEnabled, @AIAgents_ContextCompressionPromptID_RerankerConfiguration

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @AIAgents_ContextCompressionPromptID_ContextCompressionPromptID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateAIAgent] @ID = @AIAgents_ContextCompressionPromptIDID, @Name = @AIAgents_ContextCompressionPromptID_Name, @Description = @AIAgents_ContextCompressionPromptID_Description, @LogoURL = @AIAgents_ContextCompressionPromptID_LogoURL, @ParentID = @AIAgents_ContextCompressionPromptID_ParentID, @ExposeAsAction = @AIAgents_ContextCompressionPromptID_ExposeAsAction, @ExecutionOrder = @AIAgents_ContextCompressionPromptID_ExecutionOrder, @ExecutionMode = @AIAgents_ContextCompressionPromptID_ExecutionMode, @EnableContextCompression = @AIAgents_ContextCompressionPromptID_EnableContextCompression, @ContextCompressionMessageThreshold = @AIAgents_ContextCompressionPromptID_ContextCompressionMessageThreshold, @ContextCompressionPromptID = @AIAgents_ContextCompressionPromptID_ContextCompressionPromptID, @ContextCompressionMessageRetentionCount = @AIAgents_ContextCompressionPromptID_ContextCompressionMessageRetentionCount, @TypeID = @AIAgents_ContextCompressionPromptID_TypeID, @Status = @AIAgents_ContextCompressionPromptID_Status, @DriverClass = @AIAgents_ContextCompressionPromptID_DriverClass, @IconClass = @AIAgents_ContextCompressionPromptID_IconClass, @ModelSelectionMode = @AIAgents_ContextCompressionPromptID_ModelSelectionMode, @PayloadDownstreamPaths = @AIAgents_ContextCompressionPromptID_PayloadDownstreamPaths, @PayloadUpstreamPaths = @AIAgents_ContextCompressionPromptID_PayloadUpstreamPaths, @PayloadSelfReadPaths = @AIAgents_ContextCompressionPromptID_PayloadSelfReadPaths, @PayloadSelfWritePaths = @AIAgents_ContextCompressionPromptID_PayloadSelfWritePaths, @PayloadScope = @AIAgents_ContextCompressionPromptID_PayloadScope, @FinalPayloadValidation = @AIAgents_ContextCompressionPromptID_FinalPayloadValidation, @FinalPayloadValidationMode = @AIAgents_ContextCompressionPromptID_FinalPayloadValidationMode, @FinalPayloadValidationMaxRetries = @AIAgents_ContextCompressionPromptID_FinalPayloadValidationMaxRetries, @MaxCostPerRun = @AIAgents_ContextCompressionPromptID_MaxCostPerRun, @MaxTokensPerRun = @AIAgents_ContextCompressionPromptID_MaxTokensPerRun, @MaxIterationsPerRun = @AIAgents_ContextCompressionPromptID_MaxIterationsPerRun, @MaxTimePerRun = @AIAgents_ContextCompressionPromptID_MaxTimePerRun, @MinExecutionsPerRun = @AIAgents_ContextCompressionPromptID_MinExecutionsPerRun, @MaxExecutionsPerRun = @AIAgents_ContextCompressionPromptID_MaxExecutionsPerRun, @StartingPayloadValidation = @AIAgents_ContextCompressionPromptID_StartingPayloadValidation, @StartingPayloadValidationMode = @AIAgents_ContextCompressionPromptID_StartingPayloadValidationMode, @DefaultPromptEffortLevel = @AIAgents_ContextCompressionPromptID_DefaultPromptEffortLevel, @ChatHandlingOption = @AIAgents_ContextCompressionPromptID_ChatHandlingOption, @DefaultArtifactTypeID = @AIAgents_ContextCompressionPromptID_DefaultArtifactTypeID, @OwnerUserID = @AIAgents_ContextCompressionPromptID_OwnerUserID, @InvocationMode = @AIAgents_ContextCompressionPromptID_InvocationMode, @ArtifactCreationMode = @AIAgents_ContextCompressionPromptID_ArtifactCreationMode, @FunctionalRequirements = @AIAgents_ContextCompressionPromptID_FunctionalRequirements, @TechnicalDesign = @AIAgents_ContextCompressionPromptID_TechnicalDesign, @InjectNotes = @AIAgents_ContextCompressionPromptID_InjectNotes, @MaxNotesToInject = @AIAgents_ContextCompressionPromptID_MaxNotesToInject, @NoteInjectionStrategy = @AIAgents_ContextCompressionPromptID_NoteInjectionStrategy, @InjectExamples = @AIAgents_ContextCompressionPromptID_InjectExamples, @MaxExamplesToInject = @AIAgents_ContextCompressionPromptID_MaxExamplesToInject, @ExampleInjectionStrategy = @AIAgents_ContextCompressionPromptID_ExampleInjectionStrategy, @IsRestricted = @AIAgents_ContextCompressionPromptID_IsRestricted, @MessageMode = @AIAgents_ContextCompressionPromptID_MessageMode, @MaxMessages = @AIAgents_ContextCompressionPromptID_MaxMessages, @AttachmentStorageProviderID = @AIAgents_ContextCompressionPromptID_AttachmentStorageProviderID, @AttachmentRootPath = @AIAgents_ContextCompressionPromptID_AttachmentRootPath, @InlineStorageThresholdBytes = @AIAgents_ContextCompressionPromptID_InlineStorageThresholdBytes, @AgentTypePromptParams = @AIAgents_ContextCompressionPromptID_AgentTypePromptParams, @ScopeConfig = @AIAgents_ContextCompressionPromptID_ScopeConfig, @NoteRetentionDays = @AIAgents_ContextCompressionPromptID_NoteRetentionDays, @ExampleRetentionDays = @AIAgents_ContextCompressionPromptID_ExampleRetentionDays, @AutoArchiveEnabled = @AIAgents_ContextCompressionPromptID_AutoArchiveEnabled, @RerankerConfiguration = @AIAgents_ContextCompressionPromptID_RerankerConfiguration

        FETCH NEXT FROM cascade_update_AIAgents_ContextCompressionPromptID_cursor INTO @AIAgents_ContextCompressionPromptIDID, @AIAgents_ContextCompressionPromptID_Name, @AIAgents_ContextCompressionPromptID_Description, @AIAgents_ContextCompressionPromptID_LogoURL, @AIAgents_ContextCompressionPromptID_ParentID, @AIAgents_ContextCompressionPromptID_ExposeAsAction, @AIAgents_ContextCompressionPromptID_ExecutionOrder, @AIAgents_ContextCompressionPromptID_ExecutionMode, @AIAgents_ContextCompressionPromptID_EnableContextCompression, @AIAgents_ContextCompressionPromptID_ContextCompressionMessageThreshold, @AIAgents_ContextCompressionPromptID_ContextCompressionPromptID, @AIAgents_ContextCompressionPromptID_ContextCompressionMessageRetentionCount, @AIAgents_ContextCompressionPromptID_TypeID, @AIAgents_ContextCompressionPromptID_Status, @AIAgents_ContextCompressionPromptID_DriverClass, @AIAgents_ContextCompressionPromptID_IconClass, @AIAgents_ContextCompressionPromptID_ModelSelectionMode, @AIAgents_ContextCompressionPromptID_PayloadDownstreamPaths, @AIAgents_ContextCompressionPromptID_PayloadUpstreamPaths, @AIAgents_ContextCompressionPromptID_PayloadSelfReadPaths, @AIAgents_ContextCompressionPromptID_PayloadSelfWritePaths, @AIAgents_ContextCompressionPromptID_PayloadScope, @AIAgents_ContextCompressionPromptID_FinalPayloadValidation, @AIAgents_ContextCompressionPromptID_FinalPayloadValidationMode, @AIAgents_ContextCompressionPromptID_FinalPayloadValidationMaxRetries, @AIAgents_ContextCompressionPromptID_MaxCostPerRun, @AIAgents_ContextCompressionPromptID_MaxTokensPerRun, @AIAgents_ContextCompressionPromptID_MaxIterationsPerRun, @AIAgents_ContextCompressionPromptID_MaxTimePerRun, @AIAgents_ContextCompressionPromptID_MinExecutionsPerRun, @AIAgents_ContextCompressionPromptID_MaxExecutionsPerRun, @AIAgents_ContextCompressionPromptID_StartingPayloadValidation, @AIAgents_ContextCompressionPromptID_StartingPayloadValidationMode, @AIAgents_ContextCompressionPromptID_DefaultPromptEffortLevel, @AIAgents_ContextCompressionPromptID_ChatHandlingOption, @AIAgents_ContextCompressionPromptID_DefaultArtifactTypeID, @AIAgents_ContextCompressionPromptID_OwnerUserID, @AIAgents_ContextCompressionPromptID_InvocationMode, @AIAgents_ContextCompressionPromptID_ArtifactCreationMode, @AIAgents_ContextCompressionPromptID_FunctionalRequirements, @AIAgents_ContextCompressionPromptID_TechnicalDesign, @AIAgents_ContextCompressionPromptID_InjectNotes, @AIAgents_ContextCompressionPromptID_MaxNotesToInject, @AIAgents_ContextCompressionPromptID_NoteInjectionStrategy, @AIAgents_ContextCompressionPromptID_InjectExamples, @AIAgents_ContextCompressionPromptID_MaxExamplesToInject, @AIAgents_ContextCompressionPromptID_ExampleInjectionStrategy, @AIAgents_ContextCompressionPromptID_IsRestricted, @AIAgents_ContextCompressionPromptID_MessageMode, @AIAgents_ContextCompressionPromptID_MaxMessages, @AIAgents_ContextCompressionPromptID_AttachmentStorageProviderID, @AIAgents_ContextCompressionPromptID_AttachmentRootPath, @AIAgents_ContextCompressionPromptID_InlineStorageThresholdBytes, @AIAgents_ContextCompressionPromptID_AgentTypePromptParams, @AIAgents_ContextCompressionPromptID_ScopeConfig, @AIAgents_ContextCompressionPromptID_NoteRetentionDays, @AIAgents_ContextCompressionPromptID_ExampleRetentionDays, @AIAgents_ContextCompressionPromptID_AutoArchiveEnabled, @AIAgents_ContextCompressionPromptID_RerankerConfiguration
    END

    CLOSE cascade_update_AIAgents_ContextCompressionPromptID_cursor
    DEALLOCATE cascade_update_AIAgents_ContextCompressionPromptID_cursor
    
    -- Cascade update on AIPrompt using cursor to call spUpdateAIPrompt
    DECLARE @AIPrompts_ResultSelectorPromptIDID uniqueidentifier
    DECLARE @AIPrompts_ResultSelectorPromptID_Name nvarchar(255)
    DECLARE @AIPrompts_ResultSelectorPromptID_Description nvarchar(MAX)
    DECLARE @AIPrompts_ResultSelectorPromptID_TemplateID uniqueidentifier
    DECLARE @AIPrompts_ResultSelectorPromptID_CategoryID uniqueidentifier
    DECLARE @AIPrompts_ResultSelectorPromptID_TypeID uniqueidentifier
    DECLARE @AIPrompts_ResultSelectorPromptID_Status nvarchar(50)
    DECLARE @AIPrompts_ResultSelectorPromptID_ResponseFormat nvarchar(20)
    DECLARE @AIPrompts_ResultSelectorPromptID_ModelSpecificResponseFormat nvarchar(MAX)
    DECLARE @AIPrompts_ResultSelectorPromptID_AIModelTypeID uniqueidentifier
    DECLARE @AIPrompts_ResultSelectorPromptID_MinPowerRank int
    DECLARE @AIPrompts_ResultSelectorPromptID_SelectionStrategy nvarchar(20)
    DECLARE @AIPrompts_ResultSelectorPromptID_PowerPreference nvarchar(20)
    DECLARE @AIPrompts_ResultSelectorPromptID_ParallelizationMode nvarchar(20)
    DECLARE @AIPrompts_ResultSelectorPromptID_ParallelCount int
    DECLARE @AIPrompts_ResultSelectorPromptID_ParallelConfigParam nvarchar(100)
    DECLARE @AIPrompts_ResultSelectorPromptID_OutputType nvarchar(50)
    DECLARE @AIPrompts_ResultSelectorPromptID_OutputExample nvarchar(MAX)
    DECLARE @AIPrompts_ResultSelectorPromptID_ValidationBehavior nvarchar(50)
    DECLARE @AIPrompts_ResultSelectorPromptID_MaxRetries int
    DECLARE @AIPrompts_ResultSelectorPromptID_RetryDelayMS int
    DECLARE @AIPrompts_ResultSelectorPromptID_RetryStrategy nvarchar(20)
    DECLARE @AIPrompts_ResultSelectorPromptID_ResultSelectorPromptID uniqueidentifier
    DECLARE @AIPrompts_ResultSelectorPromptID_EnableCaching bit
    DECLARE @AIPrompts_ResultSelectorPromptID_CacheTTLSeconds int
    DECLARE @AIPrompts_ResultSelectorPromptID_CacheMatchType nvarchar(20)
    DECLARE @AIPrompts_ResultSelectorPromptID_CacheSimilarityThreshold float(53)
    DECLARE @AIPrompts_ResultSelectorPromptID_CacheMustMatchModel bit
    DECLARE @AIPrompts_ResultSelectorPromptID_CacheMustMatchVendor bit
    DECLARE @AIPrompts_ResultSelectorPromptID_CacheMustMatchAgent bit
    DECLARE @AIPrompts_ResultSelectorPromptID_CacheMustMatchConfig bit
    DECLARE @AIPrompts_ResultSelectorPromptID_PromptRole nvarchar(20)
    DECLARE @AIPrompts_ResultSelectorPromptID_PromptPosition nvarchar(20)
    DECLARE @AIPrompts_ResultSelectorPromptID_Temperature decimal(3, 2)
    DECLARE @AIPrompts_ResultSelectorPromptID_TopP decimal(3, 2)
    DECLARE @AIPrompts_ResultSelectorPromptID_TopK int
    DECLARE @AIPrompts_ResultSelectorPromptID_MinP decimal(3, 2)
    DECLARE @AIPrompts_ResultSelectorPromptID_FrequencyPenalty decimal(3, 2)
    DECLARE @AIPrompts_ResultSelectorPromptID_PresencePenalty decimal(3, 2)
    DECLARE @AIPrompts_ResultSelectorPromptID_Seed int
    DECLARE @AIPrompts_ResultSelectorPromptID_StopSequences nvarchar(1000)
    DECLARE @AIPrompts_ResultSelectorPromptID_IncludeLogProbs bit
    DECLARE @AIPrompts_ResultSelectorPromptID_TopLogProbs int
    DECLARE @AIPrompts_ResultSelectorPromptID_FailoverStrategy nvarchar(50)
    DECLARE @AIPrompts_ResultSelectorPromptID_FailoverMaxAttempts int
    DECLARE @AIPrompts_ResultSelectorPromptID_FailoverDelaySeconds int
    DECLARE @AIPrompts_ResultSelectorPromptID_FailoverModelStrategy nvarchar(50)
    DECLARE @AIPrompts_ResultSelectorPromptID_FailoverErrorScope nvarchar(50)
    DECLARE @AIPrompts_ResultSelectorPromptID_EffortLevel int
    DECLARE cascade_update_AIPrompts_ResultSelectorPromptID_cursor CURSOR FOR
        SELECT [ID], [Name], [Description], [TemplateID], [CategoryID], [TypeID], [Status], [ResponseFormat], [ModelSpecificResponseFormat], [AIModelTypeID], [MinPowerRank], [SelectionStrategy], [PowerPreference], [ParallelizationMode], [ParallelCount], [ParallelConfigParam], [OutputType], [OutputExample], [ValidationBehavior], [MaxRetries], [RetryDelayMS], [RetryStrategy], [ResultSelectorPromptID], [EnableCaching], [CacheTTLSeconds], [CacheMatchType], [CacheSimilarityThreshold], [CacheMustMatchModel], [CacheMustMatchVendor], [CacheMustMatchAgent], [CacheMustMatchConfig], [PromptRole], [PromptPosition], [Temperature], [TopP], [TopK], [MinP], [FrequencyPenalty], [PresencePenalty], [Seed], [StopSequences], [IncludeLogProbs], [TopLogProbs], [FailoverStrategy], [FailoverMaxAttempts], [FailoverDelaySeconds], [FailoverModelStrategy], [FailoverErrorScope], [EffortLevel]
        FROM [${flyway:defaultSchema}].[AIPrompt]
        WHERE [ResultSelectorPromptID] = @ID

    OPEN cascade_update_AIPrompts_ResultSelectorPromptID_cursor
    FETCH NEXT FROM cascade_update_AIPrompts_ResultSelectorPromptID_cursor INTO @AIPrompts_ResultSelectorPromptIDID, @AIPrompts_ResultSelectorPromptID_Name, @AIPrompts_ResultSelectorPromptID_Description, @AIPrompts_ResultSelectorPromptID_TemplateID, @AIPrompts_ResultSelectorPromptID_CategoryID, @AIPrompts_ResultSelectorPromptID_TypeID, @AIPrompts_ResultSelectorPromptID_Status, @AIPrompts_ResultSelectorPromptID_ResponseFormat, @AIPrompts_ResultSelectorPromptID_ModelSpecificResponseFormat, @AIPrompts_ResultSelectorPromptID_AIModelTypeID, @AIPrompts_ResultSelectorPromptID_MinPowerRank, @AIPrompts_ResultSelectorPromptID_SelectionStrategy, @AIPrompts_ResultSelectorPromptID_PowerPreference, @AIPrompts_ResultSelectorPromptID_ParallelizationMode, @AIPrompts_ResultSelectorPromptID_ParallelCount, @AIPrompts_ResultSelectorPromptID_ParallelConfigParam, @AIPrompts_ResultSelectorPromptID_OutputType, @AIPrompts_ResultSelectorPromptID_OutputExample, @AIPrompts_ResultSelectorPromptID_ValidationBehavior, @AIPrompts_ResultSelectorPromptID_MaxRetries, @AIPrompts_ResultSelectorPromptID_RetryDelayMS, @AIPrompts_ResultSelectorPromptID_RetryStrategy, @AIPrompts_ResultSelectorPromptID_ResultSelectorPromptID, @AIPrompts_ResultSelectorPromptID_EnableCaching, @AIPrompts_ResultSelectorPromptID_CacheTTLSeconds, @AIPrompts_ResultSelectorPromptID_CacheMatchType, @AIPrompts_ResultSelectorPromptID_CacheSimilarityThreshold, @AIPrompts_ResultSelectorPromptID_CacheMustMatchModel, @AIPrompts_ResultSelectorPromptID_CacheMustMatchVendor, @AIPrompts_ResultSelectorPromptID_CacheMustMatchAgent, @AIPrompts_ResultSelectorPromptID_CacheMustMatchConfig, @AIPrompts_ResultSelectorPromptID_PromptRole, @AIPrompts_ResultSelectorPromptID_PromptPosition, @AIPrompts_ResultSelectorPromptID_Temperature, @AIPrompts_ResultSelectorPromptID_TopP, @AIPrompts_ResultSelectorPromptID_TopK, @AIPrompts_ResultSelectorPromptID_MinP, @AIPrompts_ResultSelectorPromptID_FrequencyPenalty, @AIPrompts_ResultSelectorPromptID_PresencePenalty, @AIPrompts_ResultSelectorPromptID_Seed, @AIPrompts_ResultSelectorPromptID_StopSequences, @AIPrompts_ResultSelectorPromptID_IncludeLogProbs, @AIPrompts_ResultSelectorPromptID_TopLogProbs, @AIPrompts_ResultSelectorPromptID_FailoverStrategy, @AIPrompts_ResultSelectorPromptID_FailoverMaxAttempts, @AIPrompts_ResultSelectorPromptID_FailoverDelaySeconds, @AIPrompts_ResultSelectorPromptID_FailoverModelStrategy, @AIPrompts_ResultSelectorPromptID_FailoverErrorScope, @AIPrompts_ResultSelectorPromptID_EffortLevel

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @AIPrompts_ResultSelectorPromptID_ResultSelectorPromptID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateAIPrompt] @ID = @AIPrompts_ResultSelectorPromptIDID, @Name = @AIPrompts_ResultSelectorPromptID_Name, @Description = @AIPrompts_ResultSelectorPromptID_Description, @TemplateID = @AIPrompts_ResultSelectorPromptID_TemplateID, @CategoryID = @AIPrompts_ResultSelectorPromptID_CategoryID, @TypeID = @AIPrompts_ResultSelectorPromptID_TypeID, @Status = @AIPrompts_ResultSelectorPromptID_Status, @ResponseFormat = @AIPrompts_ResultSelectorPromptID_ResponseFormat, @ModelSpecificResponseFormat = @AIPrompts_ResultSelectorPromptID_ModelSpecificResponseFormat, @AIModelTypeID = @AIPrompts_ResultSelectorPromptID_AIModelTypeID, @MinPowerRank = @AIPrompts_ResultSelectorPromptID_MinPowerRank, @SelectionStrategy = @AIPrompts_ResultSelectorPromptID_SelectionStrategy, @PowerPreference = @AIPrompts_ResultSelectorPromptID_PowerPreference, @ParallelizationMode = @AIPrompts_ResultSelectorPromptID_ParallelizationMode, @ParallelCount = @AIPrompts_ResultSelectorPromptID_ParallelCount, @ParallelConfigParam = @AIPrompts_ResultSelectorPromptID_ParallelConfigParam, @OutputType = @AIPrompts_ResultSelectorPromptID_OutputType, @OutputExample = @AIPrompts_ResultSelectorPromptID_OutputExample, @ValidationBehavior = @AIPrompts_ResultSelectorPromptID_ValidationBehavior, @MaxRetries = @AIPrompts_ResultSelectorPromptID_MaxRetries, @RetryDelayMS = @AIPrompts_ResultSelectorPromptID_RetryDelayMS, @RetryStrategy = @AIPrompts_ResultSelectorPromptID_RetryStrategy, @ResultSelectorPromptID = @AIPrompts_ResultSelectorPromptID_ResultSelectorPromptID, @EnableCaching = @AIPrompts_ResultSelectorPromptID_EnableCaching, @CacheTTLSeconds = @AIPrompts_ResultSelectorPromptID_CacheTTLSeconds, @CacheMatchType = @AIPrompts_ResultSelectorPromptID_CacheMatchType, @CacheSimilarityThreshold = @AIPrompts_ResultSelectorPromptID_CacheSimilarityThreshold, @CacheMustMatchModel = @AIPrompts_ResultSelectorPromptID_CacheMustMatchModel, @CacheMustMatchVendor = @AIPrompts_ResultSelectorPromptID_CacheMustMatchVendor, @CacheMustMatchAgent = @AIPrompts_ResultSelectorPromptID_CacheMustMatchAgent, @CacheMustMatchConfig = @AIPrompts_ResultSelectorPromptID_CacheMustMatchConfig, @PromptRole = @AIPrompts_ResultSelectorPromptID_PromptRole, @PromptPosition = @AIPrompts_ResultSelectorPromptID_PromptPosition, @Temperature = @AIPrompts_ResultSelectorPromptID_Temperature, @TopP = @AIPrompts_ResultSelectorPromptID_TopP, @TopK = @AIPrompts_ResultSelectorPromptID_TopK, @MinP = @AIPrompts_ResultSelectorPromptID_MinP, @FrequencyPenalty = @AIPrompts_ResultSelectorPromptID_FrequencyPenalty, @PresencePenalty = @AIPrompts_ResultSelectorPromptID_PresencePenalty, @Seed = @AIPrompts_ResultSelectorPromptID_Seed, @StopSequences = @AIPrompts_ResultSelectorPromptID_StopSequences, @IncludeLogProbs = @AIPrompts_ResultSelectorPromptID_IncludeLogProbs, @TopLogProbs = @AIPrompts_ResultSelectorPromptID_TopLogProbs, @FailoverStrategy = @AIPrompts_ResultSelectorPromptID_FailoverStrategy, @FailoverMaxAttempts = @AIPrompts_ResultSelectorPromptID_FailoverMaxAttempts, @FailoverDelaySeconds = @AIPrompts_ResultSelectorPromptID_FailoverDelaySeconds, @FailoverModelStrategy = @AIPrompts_ResultSelectorPromptID_FailoverModelStrategy, @FailoverErrorScope = @AIPrompts_ResultSelectorPromptID_FailoverErrorScope, @EffortLevel = @AIPrompts_ResultSelectorPromptID_EffortLevel

        FETCH NEXT FROM cascade_update_AIPrompts_ResultSelectorPromptID_cursor INTO @AIPrompts_ResultSelectorPromptIDID, @AIPrompts_ResultSelectorPromptID_Name, @AIPrompts_ResultSelectorPromptID_Description, @AIPrompts_ResultSelectorPromptID_TemplateID, @AIPrompts_ResultSelectorPromptID_CategoryID, @AIPrompts_ResultSelectorPromptID_TypeID, @AIPrompts_ResultSelectorPromptID_Status, @AIPrompts_ResultSelectorPromptID_ResponseFormat, @AIPrompts_ResultSelectorPromptID_ModelSpecificResponseFormat, @AIPrompts_ResultSelectorPromptID_AIModelTypeID, @AIPrompts_ResultSelectorPromptID_MinPowerRank, @AIPrompts_ResultSelectorPromptID_SelectionStrategy, @AIPrompts_ResultSelectorPromptID_PowerPreference, @AIPrompts_ResultSelectorPromptID_ParallelizationMode, @AIPrompts_ResultSelectorPromptID_ParallelCount, @AIPrompts_ResultSelectorPromptID_ParallelConfigParam, @AIPrompts_ResultSelectorPromptID_OutputType, @AIPrompts_ResultSelectorPromptID_OutputExample, @AIPrompts_ResultSelectorPromptID_ValidationBehavior, @AIPrompts_ResultSelectorPromptID_MaxRetries, @AIPrompts_ResultSelectorPromptID_RetryDelayMS, @AIPrompts_ResultSelectorPromptID_RetryStrategy, @AIPrompts_ResultSelectorPromptID_ResultSelectorPromptID, @AIPrompts_ResultSelectorPromptID_EnableCaching, @AIPrompts_ResultSelectorPromptID_CacheTTLSeconds, @AIPrompts_ResultSelectorPromptID_CacheMatchType, @AIPrompts_ResultSelectorPromptID_CacheSimilarityThreshold, @AIPrompts_ResultSelectorPromptID_CacheMustMatchModel, @AIPrompts_ResultSelectorPromptID_CacheMustMatchVendor, @AIPrompts_ResultSelectorPromptID_CacheMustMatchAgent, @AIPrompts_ResultSelectorPromptID_CacheMustMatchConfig, @AIPrompts_ResultSelectorPromptID_PromptRole, @AIPrompts_ResultSelectorPromptID_PromptPosition, @AIPrompts_ResultSelectorPromptID_Temperature, @AIPrompts_ResultSelectorPromptID_TopP, @AIPrompts_ResultSelectorPromptID_TopK, @AIPrompts_ResultSelectorPromptID_MinP, @AIPrompts_ResultSelectorPromptID_FrequencyPenalty, @AIPrompts_ResultSelectorPromptID_PresencePenalty, @AIPrompts_ResultSelectorPromptID_Seed, @AIPrompts_ResultSelectorPromptID_StopSequences, @AIPrompts_ResultSelectorPromptID_IncludeLogProbs, @AIPrompts_ResultSelectorPromptID_TopLogProbs, @AIPrompts_ResultSelectorPromptID_FailoverStrategy, @AIPrompts_ResultSelectorPromptID_FailoverMaxAttempts, @AIPrompts_ResultSelectorPromptID_FailoverDelaySeconds, @AIPrompts_ResultSelectorPromptID_FailoverModelStrategy, @AIPrompts_ResultSelectorPromptID_FailoverErrorScope, @AIPrompts_ResultSelectorPromptID_EffortLevel
    END

    CLOSE cascade_update_AIPrompts_ResultSelectorPromptID_cursor
    DEALLOCATE cascade_update_AIPrompts_ResultSelectorPromptID_cursor
    
    -- Cascade delete from AIResultCache using cursor to call spDeleteAIResultCache
    DECLARE @AIResultCache_AIPromptIDID uniqueidentifier
    DECLARE cascade_delete_AIResultCache_AIPromptID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[AIResultCache]
        WHERE [AIPromptID] = @ID
    
    OPEN cascade_delete_AIResultCache_AIPromptID_cursor
    FETCH NEXT FROM cascade_delete_AIResultCache_AIPromptID_cursor INTO @AIResultCache_AIPromptIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteAIResultCache] @ID = @AIResultCache_AIPromptIDID
        
        FETCH NEXT FROM cascade_delete_AIResultCache_AIPromptID_cursor INTO @AIResultCache_AIPromptIDID
    END
    
    CLOSE cascade_delete_AIResultCache_AIPromptID_cursor
    DEALLOCATE cascade_delete_AIResultCache_AIPromptID_cursor
    
    -- Cascade delete from AIAgentPrompt using cursor to call spDeleteAIAgentPrompt
    DECLARE @MJ_AIAgentPrompts_PromptIDID uniqueidentifier
    DECLARE cascade_delete_MJ_AIAgentPrompts_PromptID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[AIAgentPrompt]
        WHERE [PromptID] = @ID
    
    OPEN cascade_delete_MJ_AIAgentPrompts_PromptID_cursor
    FETCH NEXT FROM cascade_delete_MJ_AIAgentPrompts_PromptID_cursor INTO @MJ_AIAgentPrompts_PromptIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteAIAgentPrompt] @ID = @MJ_AIAgentPrompts_PromptIDID
        
        FETCH NEXT FROM cascade_delete_MJ_AIAgentPrompts_PromptID_cursor INTO @MJ_AIAgentPrompts_PromptIDID
    END
    
    CLOSE cascade_delete_MJ_AIAgentPrompts_PromptID_cursor
    DEALLOCATE cascade_delete_MJ_AIAgentPrompts_PromptID_cursor
    
    -- Cascade update on AIAgentStep using cursor to call spUpdateAIAgentStep
    DECLARE @MJ_AIAgentSteps_PromptIDID uniqueidentifier
    DECLARE @MJ_AIAgentSteps_PromptID_AgentID uniqueidentifier
    DECLARE @MJ_AIAgentSteps_PromptID_Name nvarchar(255)
    DECLARE @MJ_AIAgentSteps_PromptID_Description nvarchar(MAX)
    DECLARE @MJ_AIAgentSteps_PromptID_StepType nvarchar(20)
    DECLARE @MJ_AIAgentSteps_PromptID_StartingStep bit
    DECLARE @MJ_AIAgentSteps_PromptID_TimeoutSeconds int
    DECLARE @MJ_AIAgentSteps_PromptID_RetryCount int
    DECLARE @MJ_AIAgentSteps_PromptID_OnErrorBehavior nvarchar(20)
    DECLARE @MJ_AIAgentSteps_PromptID_ActionID uniqueidentifier
    DECLARE @MJ_AIAgentSteps_PromptID_SubAgentID uniqueidentifier
    DECLARE @MJ_AIAgentSteps_PromptID_PromptID uniqueidentifier
    DECLARE @MJ_AIAgentSteps_PromptID_ActionOutputMapping nvarchar(MAX)
    DECLARE @MJ_AIAgentSteps_PromptID_PositionX int
    DECLARE @MJ_AIAgentSteps_PromptID_PositionY int
    DECLARE @MJ_AIAgentSteps_PromptID_Width int
    DECLARE @MJ_AIAgentSteps_PromptID_Height int
    DECLARE @MJ_AIAgentSteps_PromptID_Status nvarchar(20)
    DECLARE @MJ_AIAgentSteps_PromptID_ActionInputMapping nvarchar(MAX)
    DECLARE @MJ_AIAgentSteps_PromptID_LoopBodyType nvarchar(50)
    DECLARE @MJ_AIAgentSteps_PromptID_Configuration nvarchar(MAX)
    DECLARE cascade_update_MJ_AIAgentSteps_PromptID_cursor CURSOR FOR
        SELECT [ID], [AgentID], [Name], [Description], [StepType], [StartingStep], [TimeoutSeconds], [RetryCount], [OnErrorBehavior], [ActionID], [SubAgentID], [PromptID], [ActionOutputMapping], [PositionX], [PositionY], [Width], [Height], [Status], [ActionInputMapping], [LoopBodyType], [Configuration]
        FROM [${flyway:defaultSchema}].[AIAgentStep]
        WHERE [PromptID] = @ID

    OPEN cascade_update_MJ_AIAgentSteps_PromptID_cursor
    FETCH NEXT FROM cascade_update_MJ_AIAgentSteps_PromptID_cursor INTO @MJ_AIAgentSteps_PromptIDID, @MJ_AIAgentSteps_PromptID_AgentID, @MJ_AIAgentSteps_PromptID_Name, @MJ_AIAgentSteps_PromptID_Description, @MJ_AIAgentSteps_PromptID_StepType, @MJ_AIAgentSteps_PromptID_StartingStep, @MJ_AIAgentSteps_PromptID_TimeoutSeconds, @MJ_AIAgentSteps_PromptID_RetryCount, @MJ_AIAgentSteps_PromptID_OnErrorBehavior, @MJ_AIAgentSteps_PromptID_ActionID, @MJ_AIAgentSteps_PromptID_SubAgentID, @MJ_AIAgentSteps_PromptID_PromptID, @MJ_AIAgentSteps_PromptID_ActionOutputMapping, @MJ_AIAgentSteps_PromptID_PositionX, @MJ_AIAgentSteps_PromptID_PositionY, @MJ_AIAgentSteps_PromptID_Width, @MJ_AIAgentSteps_PromptID_Height, @MJ_AIAgentSteps_PromptID_Status, @MJ_AIAgentSteps_PromptID_ActionInputMapping, @MJ_AIAgentSteps_PromptID_LoopBodyType, @MJ_AIAgentSteps_PromptID_Configuration

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @MJ_AIAgentSteps_PromptID_PromptID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateAIAgentStep] @ID = @MJ_AIAgentSteps_PromptIDID, @AgentID = @MJ_AIAgentSteps_PromptID_AgentID, @Name = @MJ_AIAgentSteps_PromptID_Name, @Description = @MJ_AIAgentSteps_PromptID_Description, @StepType = @MJ_AIAgentSteps_PromptID_StepType, @StartingStep = @MJ_AIAgentSteps_PromptID_StartingStep, @TimeoutSeconds = @MJ_AIAgentSteps_PromptID_TimeoutSeconds, @RetryCount = @MJ_AIAgentSteps_PromptID_RetryCount, @OnErrorBehavior = @MJ_AIAgentSteps_PromptID_OnErrorBehavior, @ActionID = @MJ_AIAgentSteps_PromptID_ActionID, @SubAgentID = @MJ_AIAgentSteps_PromptID_SubAgentID, @PromptID = @MJ_AIAgentSteps_PromptID_PromptID, @ActionOutputMapping = @MJ_AIAgentSteps_PromptID_ActionOutputMapping, @PositionX = @MJ_AIAgentSteps_PromptID_PositionX, @PositionY = @MJ_AIAgentSteps_PromptID_PositionY, @Width = @MJ_AIAgentSteps_PromptID_Width, @Height = @MJ_AIAgentSteps_PromptID_Height, @Status = @MJ_AIAgentSteps_PromptID_Status, @ActionInputMapping = @MJ_AIAgentSteps_PromptID_ActionInputMapping, @LoopBodyType = @MJ_AIAgentSteps_PromptID_LoopBodyType, @Configuration = @MJ_AIAgentSteps_PromptID_Configuration

        FETCH NEXT FROM cascade_update_MJ_AIAgentSteps_PromptID_cursor INTO @MJ_AIAgentSteps_PromptIDID, @MJ_AIAgentSteps_PromptID_AgentID, @MJ_AIAgentSteps_PromptID_Name, @MJ_AIAgentSteps_PromptID_Description, @MJ_AIAgentSteps_PromptID_StepType, @MJ_AIAgentSteps_PromptID_StartingStep, @MJ_AIAgentSteps_PromptID_TimeoutSeconds, @MJ_AIAgentSteps_PromptID_RetryCount, @MJ_AIAgentSteps_PromptID_OnErrorBehavior, @MJ_AIAgentSteps_PromptID_ActionID, @MJ_AIAgentSteps_PromptID_SubAgentID, @MJ_AIAgentSteps_PromptID_PromptID, @MJ_AIAgentSteps_PromptID_ActionOutputMapping, @MJ_AIAgentSteps_PromptID_PositionX, @MJ_AIAgentSteps_PromptID_PositionY, @MJ_AIAgentSteps_PromptID_Width, @MJ_AIAgentSteps_PromptID_Height, @MJ_AIAgentSteps_PromptID_Status, @MJ_AIAgentSteps_PromptID_ActionInputMapping, @MJ_AIAgentSteps_PromptID_LoopBodyType, @MJ_AIAgentSteps_PromptID_Configuration
    END

    CLOSE cascade_update_MJ_AIAgentSteps_PromptID_cursor
    DEALLOCATE cascade_update_MJ_AIAgentSteps_PromptID_cursor
    
    -- Cascade update on AIAgentType using cursor to call spUpdateAIAgentType
    DECLARE @MJ_AIAgentTypes_SystemPromptIDID uniqueidentifier
    DECLARE @MJ_AIAgentTypes_SystemPromptID_Name nvarchar(100)
    DECLARE @MJ_AIAgentTypes_SystemPromptID_Description nvarchar(MAX)
    DECLARE @MJ_AIAgentTypes_SystemPromptID_SystemPromptID uniqueidentifier
    DECLARE @MJ_AIAgentTypes_SystemPromptID_IsActive bit
    DECLARE @MJ_AIAgentTypes_SystemPromptID_AgentPromptPlaceholder nvarchar(255)
    DECLARE @MJ_AIAgentTypes_SystemPromptID_DriverClass nvarchar(255)
    DECLARE @MJ_AIAgentTypes_SystemPromptID_UIFormSectionKey nvarchar(500)
    DECLARE @MJ_AIAgentTypes_SystemPromptID_UIFormKey nvarchar(500)
    DECLARE @MJ_AIAgentTypes_SystemPromptID_UIFormSectionExpandedByDefault bit
    DECLARE @MJ_AIAgentTypes_SystemPromptID_PromptParamsSchema nvarchar(MAX)
    DECLARE cascade_update_MJ_AIAgentTypes_SystemPromptID_cursor CURSOR FOR
        SELECT [ID], [Name], [Description], [SystemPromptID], [IsActive], [AgentPromptPlaceholder], [DriverClass], [UIFormSectionKey], [UIFormKey], [UIFormSectionExpandedByDefault], [PromptParamsSchema]
        FROM [${flyway:defaultSchema}].[AIAgentType]
        WHERE [SystemPromptID] = @ID

    OPEN cascade_update_MJ_AIAgentTypes_SystemPromptID_cursor
    FETCH NEXT FROM cascade_update_MJ_AIAgentTypes_SystemPromptID_cursor INTO @MJ_AIAgentTypes_SystemPromptIDID, @MJ_AIAgentTypes_SystemPromptID_Name, @MJ_AIAgentTypes_SystemPromptID_Description, @MJ_AIAgentTypes_SystemPromptID_SystemPromptID, @MJ_AIAgentTypes_SystemPromptID_IsActive, @MJ_AIAgentTypes_SystemPromptID_AgentPromptPlaceholder, @MJ_AIAgentTypes_SystemPromptID_DriverClass, @MJ_AIAgentTypes_SystemPromptID_UIFormSectionKey, @MJ_AIAgentTypes_SystemPromptID_UIFormKey, @MJ_AIAgentTypes_SystemPromptID_UIFormSectionExpandedByDefault, @MJ_AIAgentTypes_SystemPromptID_PromptParamsSchema

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @MJ_AIAgentTypes_SystemPromptID_SystemPromptID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateAIAgentType] @ID = @MJ_AIAgentTypes_SystemPromptIDID, @Name = @MJ_AIAgentTypes_SystemPromptID_Name, @Description = @MJ_AIAgentTypes_SystemPromptID_Description, @SystemPromptID = @MJ_AIAgentTypes_SystemPromptID_SystemPromptID, @IsActive = @MJ_AIAgentTypes_SystemPromptID_IsActive, @AgentPromptPlaceholder = @MJ_AIAgentTypes_SystemPromptID_AgentPromptPlaceholder, @DriverClass = @MJ_AIAgentTypes_SystemPromptID_DriverClass, @UIFormSectionKey = @MJ_AIAgentTypes_SystemPromptID_UIFormSectionKey, @UIFormKey = @MJ_AIAgentTypes_SystemPromptID_UIFormKey, @UIFormSectionExpandedByDefault = @MJ_AIAgentTypes_SystemPromptID_UIFormSectionExpandedByDefault, @PromptParamsSchema = @MJ_AIAgentTypes_SystemPromptID_PromptParamsSchema

        FETCH NEXT FROM cascade_update_MJ_AIAgentTypes_SystemPromptID_cursor INTO @MJ_AIAgentTypes_SystemPromptIDID, @MJ_AIAgentTypes_SystemPromptID_Name, @MJ_AIAgentTypes_SystemPromptID_Description, @MJ_AIAgentTypes_SystemPromptID_SystemPromptID, @MJ_AIAgentTypes_SystemPromptID_IsActive, @MJ_AIAgentTypes_SystemPromptID_AgentPromptPlaceholder, @MJ_AIAgentTypes_SystemPromptID_DriverClass, @MJ_AIAgentTypes_SystemPromptID_UIFormSectionKey, @MJ_AIAgentTypes_SystemPromptID_UIFormKey, @MJ_AIAgentTypes_SystemPromptID_UIFormSectionExpandedByDefault, @MJ_AIAgentTypes_SystemPromptID_PromptParamsSchema
    END

    CLOSE cascade_update_MJ_AIAgentTypes_SystemPromptID_cursor
    DEALLOCATE cascade_update_MJ_AIAgentTypes_SystemPromptID_cursor
    
    -- Cascade update on AIConfiguration using cursor to call spUpdateAIConfiguration
    DECLARE @MJ_AIConfigurations_DefaultPromptForContextCompressionIDID uniqueidentifier
    DECLARE @MJ_AIConfigurations_DefaultPromptForContextCompressionID_Name nvarchar(100)
    DECLARE @MJ_AIConfigurations_DefaultPromptForContextCompressionID_Description nvarchar(MAX)
    DECLARE @MJ_AIConfigurations_DefaultPromptForContextCompressionID_IsDefault bit
    DECLARE @MJ_AIConfigurations_DefaultPromptForContextCompressionID_Status nvarchar(20)
    DECLARE @MJ_AIConfigurations_DefaultPromptForContextCompressionID_DefaultPromptForContextCompressionID uniqueidentifier
    DECLARE @MJ_AIConfigurations_DefaultPromptForContextCompressionID_DefaultPromptForContextSummarizationID uniqueidentifier
    DECLARE @MJ_AIConfigurations_DefaultPromptForContextCompressionID_DefaultStorageProviderID uniqueidentifier
    DECLARE @MJ_AIConfigurations_DefaultPromptForContextCompressionID_DefaultStorageRootPath nvarchar(500)
    DECLARE @MJ_AIConfigurations_DefaultPromptForContextCompressionID_ParentID uniqueidentifier
    DECLARE cascade_update_MJ_AIConfigurations_DefaultPromptForContextCompressionID_cursor CURSOR FOR
        SELECT [ID], [Name], [Description], [IsDefault], [Status], [DefaultPromptForContextCompressionID], [DefaultPromptForContextSummarizationID], [DefaultStorageProviderID], [DefaultStorageRootPath], [ParentID]
        FROM [${flyway:defaultSchema}].[AIConfiguration]
        WHERE [DefaultPromptForContextCompressionID] = @ID

    OPEN cascade_update_MJ_AIConfigurations_DefaultPromptForContextCompressionID_cursor
    FETCH NEXT FROM cascade_update_MJ_AIConfigurations_DefaultPromptForContextCompressionID_cursor INTO @MJ_AIConfigurations_DefaultPromptForContextCompressionIDID, @MJ_AIConfigurations_DefaultPromptForContextCompressionID_Name, @MJ_AIConfigurations_DefaultPromptForContextCompressionID_Description, @MJ_AIConfigurations_DefaultPromptForContextCompressionID_IsDefault, @MJ_AIConfigurations_DefaultPromptForContextCompressionID_Status, @MJ_AIConfigurations_DefaultPromptForContextCompressionID_DefaultPromptForContextCompressionID, @MJ_AIConfigurations_DefaultPromptForContextCompressionID_DefaultPromptForContextSummarizationID, @MJ_AIConfigurations_DefaultPromptForContextCompressionID_DefaultStorageProviderID, @MJ_AIConfigurations_DefaultPromptForContextCompressionID_DefaultStorageRootPath, @MJ_AIConfigurations_DefaultPromptForContextCompressionID_ParentID

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @MJ_AIConfigurations_DefaultPromptForContextCompressionID_DefaultPromptForContextCompressionID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateAIConfiguration] @ID = @MJ_AIConfigurations_DefaultPromptForContextCompressionIDID, @Name = @MJ_AIConfigurations_DefaultPromptForContextCompressionID_Name, @Description = @MJ_AIConfigurations_DefaultPromptForContextCompressionID_Description, @IsDefault = @MJ_AIConfigurations_DefaultPromptForContextCompressionID_IsDefault, @Status = @MJ_AIConfigurations_DefaultPromptForContextCompressionID_Status, @DefaultPromptForContextCompressionID = @MJ_AIConfigurations_DefaultPromptForContextCompressionID_DefaultPromptForContextCompressionID, @DefaultPromptForContextSummarizationID = @MJ_AIConfigurations_DefaultPromptForContextCompressionID_DefaultPromptForContextSummarizationID, @DefaultStorageProviderID = @MJ_AIConfigurations_DefaultPromptForContextCompressionID_DefaultStorageProviderID, @DefaultStorageRootPath = @MJ_AIConfigurations_DefaultPromptForContextCompressionID_DefaultStorageRootPath, @ParentID = @MJ_AIConfigurations_DefaultPromptForContextCompressionID_ParentID

        FETCH NEXT FROM cascade_update_MJ_AIConfigurations_DefaultPromptForContextCompressionID_cursor INTO @MJ_AIConfigurations_DefaultPromptForContextCompressionIDID, @MJ_AIConfigurations_DefaultPromptForContextCompressionID_Name, @MJ_AIConfigurations_DefaultPromptForContextCompressionID_Description, @MJ_AIConfigurations_DefaultPromptForContextCompressionID_IsDefault, @MJ_AIConfigurations_DefaultPromptForContextCompressionID_Status, @MJ_AIConfigurations_DefaultPromptForContextCompressionID_DefaultPromptForContextCompressionID, @MJ_AIConfigurations_DefaultPromptForContextCompressionID_DefaultPromptForContextSummarizationID, @MJ_AIConfigurations_DefaultPromptForContextCompressionID_DefaultStorageProviderID, @MJ_AIConfigurations_DefaultPromptForContextCompressionID_DefaultStorageRootPath, @MJ_AIConfigurations_DefaultPromptForContextCompressionID_ParentID
    END

    CLOSE cascade_update_MJ_AIConfigurations_DefaultPromptForContextCompressionID_cursor
    DEALLOCATE cascade_update_MJ_AIConfigurations_DefaultPromptForContextCompressionID_cursor
    
    -- Cascade update on AIConfiguration using cursor to call spUpdateAIConfiguration
    DECLARE @MJ_AIConfigurations_DefaultPromptForContextSummarizationIDID uniqueidentifier
    DECLARE @MJ_AIConfigurations_DefaultPromptForContextSummarizationID_Name nvarchar(100)
    DECLARE @MJ_AIConfigurations_DefaultPromptForContextSummarizationID_Description nvarchar(MAX)
    DECLARE @MJ_AIConfigurations_DefaultPromptForContextSummarizationID_IsDefault bit
    DECLARE @MJ_AIConfigurations_DefaultPromptForContextSummarizationID_Status nvarchar(20)
    DECLARE @MJ_AIConfigurations_DefaultPromptForContextSummarizationID_DefaultPromptForContextCompressionID uniqueidentifier
    DECLARE @MJ_AIConfigurations_DefaultPromptForContextSummarizationID_DefaultPromptForContextSummarizationID uniqueidentifier
    DECLARE @MJ_AIConfigurations_DefaultPromptForContextSummarizationID_DefaultStorageProviderID uniqueidentifier
    DECLARE @MJ_AIConfigurations_DefaultPromptForContextSummarizationID_DefaultStorageRootPath nvarchar(500)
    DECLARE @MJ_AIConfigurations_DefaultPromptForContextSummarizationID_ParentID uniqueidentifier
    DECLARE cascade_update_MJ_AIConfigurations_DefaultPromptForContextSummarizationID_cursor CURSOR FOR
        SELECT [ID], [Name], [Description], [IsDefault], [Status], [DefaultPromptForContextCompressionID], [DefaultPromptForContextSummarizationID], [DefaultStorageProviderID], [DefaultStorageRootPath], [ParentID]
        FROM [${flyway:defaultSchema}].[AIConfiguration]
        WHERE [DefaultPromptForContextSummarizationID] = @ID

    OPEN cascade_update_MJ_AIConfigurations_DefaultPromptForContextSummarizationID_cursor
    FETCH NEXT FROM cascade_update_MJ_AIConfigurations_DefaultPromptForContextSummarizationID_cursor INTO @MJ_AIConfigurations_DefaultPromptForContextSummarizationIDID, @MJ_AIConfigurations_DefaultPromptForContextSummarizationID_Name, @MJ_AIConfigurations_DefaultPromptForContextSummarizationID_Description, @MJ_AIConfigurations_DefaultPromptForContextSummarizationID_IsDefault, @MJ_AIConfigurations_DefaultPromptForContextSummarizationID_Status, @MJ_AIConfigurations_DefaultPromptForContextSummarizationID_DefaultPromptForContextCompressionID, @MJ_AIConfigurations_DefaultPromptForContextSummarizationID_DefaultPromptForContextSummarizationID, @MJ_AIConfigurations_DefaultPromptForContextSummarizationID_DefaultStorageProviderID, @MJ_AIConfigurations_DefaultPromptForContextSummarizationID_DefaultStorageRootPath, @MJ_AIConfigurations_DefaultPromptForContextSummarizationID_ParentID

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @MJ_AIConfigurations_DefaultPromptForContextSummarizationID_DefaultPromptForContextSummarizationID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateAIConfiguration] @ID = @MJ_AIConfigurations_DefaultPromptForContextSummarizationIDID, @Name = @MJ_AIConfigurations_DefaultPromptForContextSummarizationID_Name, @Description = @MJ_AIConfigurations_DefaultPromptForContextSummarizationID_Description, @IsDefault = @MJ_AIConfigurations_DefaultPromptForContextSummarizationID_IsDefault, @Status = @MJ_AIConfigurations_DefaultPromptForContextSummarizationID_Status, @DefaultPromptForContextCompressionID = @MJ_AIConfigurations_DefaultPromptForContextSummarizationID_DefaultPromptForContextCompressionID, @DefaultPromptForContextSummarizationID = @MJ_AIConfigurations_DefaultPromptForContextSummarizationID_DefaultPromptForContextSummarizationID, @DefaultStorageProviderID = @MJ_AIConfigurations_DefaultPromptForContextSummarizationID_DefaultStorageProviderID, @DefaultStorageRootPath = @MJ_AIConfigurations_DefaultPromptForContextSummarizationID_DefaultStorageRootPath, @ParentID = @MJ_AIConfigurations_DefaultPromptForContextSummarizationID_ParentID

        FETCH NEXT FROM cascade_update_MJ_AIConfigurations_DefaultPromptForContextSummarizationID_cursor INTO @MJ_AIConfigurations_DefaultPromptForContextSummarizationIDID, @MJ_AIConfigurations_DefaultPromptForContextSummarizationID_Name, @MJ_AIConfigurations_DefaultPromptForContextSummarizationID_Description, @MJ_AIConfigurations_DefaultPromptForContextSummarizationID_IsDefault, @MJ_AIConfigurations_DefaultPromptForContextSummarizationID_Status, @MJ_AIConfigurations_DefaultPromptForContextSummarizationID_DefaultPromptForContextCompressionID, @MJ_AIConfigurations_DefaultPromptForContextSummarizationID_DefaultPromptForContextSummarizationID, @MJ_AIConfigurations_DefaultPromptForContextSummarizationID_DefaultStorageProviderID, @MJ_AIConfigurations_DefaultPromptForContextSummarizationID_DefaultStorageRootPath, @MJ_AIConfigurations_DefaultPromptForContextSummarizationID_ParentID
    END

    CLOSE cascade_update_MJ_AIConfigurations_DefaultPromptForContextSummarizationID_cursor
    DEALLOCATE cascade_update_MJ_AIConfigurations_DefaultPromptForContextSummarizationID_cursor
    
    -- Cascade delete from AIPromptModel using cursor to call spDeleteAIPromptModel
    DECLARE @MJ_AIPromptModels_PromptIDID uniqueidentifier
    DECLARE cascade_delete_MJ_AIPromptModels_PromptID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[AIPromptModel]
        WHERE [PromptID] = @ID
    
    OPEN cascade_delete_MJ_AIPromptModels_PromptID_cursor
    FETCH NEXT FROM cascade_delete_MJ_AIPromptModels_PromptID_cursor INTO @MJ_AIPromptModels_PromptIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteAIPromptModel] @ID = @MJ_AIPromptModels_PromptIDID
        
        FETCH NEXT FROM cascade_delete_MJ_AIPromptModels_PromptID_cursor INTO @MJ_AIPromptModels_PromptIDID
    END
    
    CLOSE cascade_delete_MJ_AIPromptModels_PromptID_cursor
    DEALLOCATE cascade_delete_MJ_AIPromptModels_PromptID_cursor
    
    -- Cascade delete from AIPromptRun using cursor to call spDeleteAIPromptRun
    DECLARE @MJ_AIPromptRuns_PromptIDID uniqueidentifier
    DECLARE cascade_delete_MJ_AIPromptRuns_PromptID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[AIPromptRun]
        WHERE [PromptID] = @ID
    
    OPEN cascade_delete_MJ_AIPromptRuns_PromptID_cursor
    FETCH NEXT FROM cascade_delete_MJ_AIPromptRuns_PromptID_cursor INTO @MJ_AIPromptRuns_PromptIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteAIPromptRun] @ID = @MJ_AIPromptRuns_PromptIDID
        
        FETCH NEXT FROM cascade_delete_MJ_AIPromptRuns_PromptID_cursor INTO @MJ_AIPromptRuns_PromptIDID
    END
    
    CLOSE cascade_delete_MJ_AIPromptRuns_PromptID_cursor
    DEALLOCATE cascade_delete_MJ_AIPromptRuns_PromptID_cursor
    
    -- Cascade update on AIPromptRun using cursor to call spUpdateAIPromptRun
    DECLARE @MJ_AIPromptRuns_JudgeIDID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_JudgeID_PromptID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_JudgeID_ModelID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_JudgeID_VendorID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_JudgeID_AgentID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_JudgeID_ConfigurationID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_JudgeID_RunAt datetimeoffset
    DECLARE @MJ_AIPromptRuns_JudgeID_CompletedAt datetimeoffset
    DECLARE @MJ_AIPromptRuns_JudgeID_ExecutionTimeMS int
    DECLARE @MJ_AIPromptRuns_JudgeID_Messages nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_JudgeID_Result nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_JudgeID_TokensUsed int
    DECLARE @MJ_AIPromptRuns_JudgeID_TokensPrompt int
    DECLARE @MJ_AIPromptRuns_JudgeID_TokensCompletion int
    DECLARE @MJ_AIPromptRuns_JudgeID_TotalCost decimal(18, 6)
    DECLARE @MJ_AIPromptRuns_JudgeID_Success bit
    DECLARE @MJ_AIPromptRuns_JudgeID_ErrorMessage nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_JudgeID_ParentID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_JudgeID_RunType nvarchar(20)
    DECLARE @MJ_AIPromptRuns_JudgeID_ExecutionOrder int
    DECLARE @MJ_AIPromptRuns_JudgeID_AgentRunID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_JudgeID_Cost decimal(19, 8)
    DECLARE @MJ_AIPromptRuns_JudgeID_CostCurrency nvarchar(10)
    DECLARE @MJ_AIPromptRuns_JudgeID_TokensUsedRollup int
    DECLARE @MJ_AIPromptRuns_JudgeID_TokensPromptRollup int
    DECLARE @MJ_AIPromptRuns_JudgeID_TokensCompletionRollup int
    DECLARE @MJ_AIPromptRuns_JudgeID_Temperature decimal(3, 2)
    DECLARE @MJ_AIPromptRuns_JudgeID_TopP decimal(3, 2)
    DECLARE @MJ_AIPromptRuns_JudgeID_TopK int
    DECLARE @MJ_AIPromptRuns_JudgeID_MinP decimal(3, 2)
    DECLARE @MJ_AIPromptRuns_JudgeID_FrequencyPenalty decimal(3, 2)
    DECLARE @MJ_AIPromptRuns_JudgeID_PresencePenalty decimal(3, 2)
    DECLARE @MJ_AIPromptRuns_JudgeID_Seed int
    DECLARE @MJ_AIPromptRuns_JudgeID_StopSequences nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_JudgeID_ResponseFormat nvarchar(50)
    DECLARE @MJ_AIPromptRuns_JudgeID_LogProbs bit
    DECLARE @MJ_AIPromptRuns_JudgeID_TopLogProbs int
    DECLARE @MJ_AIPromptRuns_JudgeID_DescendantCost decimal(18, 6)
    DECLARE @MJ_AIPromptRuns_JudgeID_ValidationAttemptCount int
    DECLARE @MJ_AIPromptRuns_JudgeID_SuccessfulValidationCount int
    DECLARE @MJ_AIPromptRuns_JudgeID_FinalValidationPassed bit
    DECLARE @MJ_AIPromptRuns_JudgeID_ValidationBehavior nvarchar(50)
    DECLARE @MJ_AIPromptRuns_JudgeID_RetryStrategy nvarchar(50)
    DECLARE @MJ_AIPromptRuns_JudgeID_MaxRetriesConfigured int
    DECLARE @MJ_AIPromptRuns_JudgeID_FinalValidationError nvarchar(500)
    DECLARE @MJ_AIPromptRuns_JudgeID_ValidationErrorCount int
    DECLARE @MJ_AIPromptRuns_JudgeID_CommonValidationError nvarchar(255)
    DECLARE @MJ_AIPromptRuns_JudgeID_FirstAttemptAt datetimeoffset
    DECLARE @MJ_AIPromptRuns_JudgeID_LastAttemptAt datetimeoffset
    DECLARE @MJ_AIPromptRuns_JudgeID_TotalRetryDurationMS int
    DECLARE @MJ_AIPromptRuns_JudgeID_ValidationAttempts nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_JudgeID_ValidationSummary nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_JudgeID_FailoverAttempts int
    DECLARE @MJ_AIPromptRuns_JudgeID_FailoverErrors nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_JudgeID_FailoverDurations nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_JudgeID_OriginalModelID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_JudgeID_OriginalRequestStartTime datetimeoffset
    DECLARE @MJ_AIPromptRuns_JudgeID_TotalFailoverDuration int
    DECLARE @MJ_AIPromptRuns_JudgeID_RerunFromPromptRunID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_JudgeID_ModelSelection nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_JudgeID_Status nvarchar(50)
    DECLARE @MJ_AIPromptRuns_JudgeID_Cancelled bit
    DECLARE @MJ_AIPromptRuns_JudgeID_CancellationReason nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_JudgeID_ModelPowerRank int
    DECLARE @MJ_AIPromptRuns_JudgeID_SelectionStrategy nvarchar(50)
    DECLARE @MJ_AIPromptRuns_JudgeID_CacheHit bit
    DECLARE @MJ_AIPromptRuns_JudgeID_CacheKey nvarchar(500)
    DECLARE @MJ_AIPromptRuns_JudgeID_JudgeID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_JudgeID_JudgeScore float(53)
    DECLARE @MJ_AIPromptRuns_JudgeID_WasSelectedResult bit
    DECLARE @MJ_AIPromptRuns_JudgeID_StreamingEnabled bit
    DECLARE @MJ_AIPromptRuns_JudgeID_FirstTokenTime int
    DECLARE @MJ_AIPromptRuns_JudgeID_ErrorDetails nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_JudgeID_ChildPromptID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_JudgeID_QueueTime int
    DECLARE @MJ_AIPromptRuns_JudgeID_PromptTime int
    DECLARE @MJ_AIPromptRuns_JudgeID_CompletionTime int
    DECLARE @MJ_AIPromptRuns_JudgeID_ModelSpecificResponseDetails nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_JudgeID_EffortLevel int
    DECLARE @MJ_AIPromptRuns_JudgeID_RunName nvarchar(255)
    DECLARE @MJ_AIPromptRuns_JudgeID_Comments nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_JudgeID_TestRunID uniqueidentifier
    DECLARE cascade_update_MJ_AIPromptRuns_JudgeID_cursor CURSOR FOR
        SELECT [ID], [PromptID], [ModelID], [VendorID], [AgentID], [ConfigurationID], [RunAt], [CompletedAt], [ExecutionTimeMS], [Messages], [Result], [TokensUsed], [TokensPrompt], [TokensCompletion], [TotalCost], [Success], [ErrorMessage], [ParentID], [RunType], [ExecutionOrder], [AgentRunID], [Cost], [CostCurrency], [TokensUsedRollup], [TokensPromptRollup], [TokensCompletionRollup], [Temperature], [TopP], [TopK], [MinP], [FrequencyPenalty], [PresencePenalty], [Seed], [StopSequences], [ResponseFormat], [LogProbs], [TopLogProbs], [DescendantCost], [ValidationAttemptCount], [SuccessfulValidationCount], [FinalValidationPassed], [ValidationBehavior], [RetryStrategy], [MaxRetriesConfigured], [FinalValidationError], [ValidationErrorCount], [CommonValidationError], [FirstAttemptAt], [LastAttemptAt], [TotalRetryDurationMS], [ValidationAttempts], [ValidationSummary], [FailoverAttempts], [FailoverErrors], [FailoverDurations], [OriginalModelID], [OriginalRequestStartTime], [TotalFailoverDuration], [RerunFromPromptRunID], [ModelSelection], [Status], [Cancelled], [CancellationReason], [ModelPowerRank], [SelectionStrategy], [CacheHit], [CacheKey], [JudgeID], [JudgeScore], [WasSelectedResult], [StreamingEnabled], [FirstTokenTime], [ErrorDetails], [ChildPromptID], [QueueTime], [PromptTime], [CompletionTime], [ModelSpecificResponseDetails], [EffortLevel], [RunName], [Comments], [TestRunID]
        FROM [${flyway:defaultSchema}].[AIPromptRun]
        WHERE [JudgeID] = @ID

    OPEN cascade_update_MJ_AIPromptRuns_JudgeID_cursor
    FETCH NEXT FROM cascade_update_MJ_AIPromptRuns_JudgeID_cursor INTO @MJ_AIPromptRuns_JudgeIDID, @MJ_AIPromptRuns_JudgeID_PromptID, @MJ_AIPromptRuns_JudgeID_ModelID, @MJ_AIPromptRuns_JudgeID_VendorID, @MJ_AIPromptRuns_JudgeID_AgentID, @MJ_AIPromptRuns_JudgeID_ConfigurationID, @MJ_AIPromptRuns_JudgeID_RunAt, @MJ_AIPromptRuns_JudgeID_CompletedAt, @MJ_AIPromptRuns_JudgeID_ExecutionTimeMS, @MJ_AIPromptRuns_JudgeID_Messages, @MJ_AIPromptRuns_JudgeID_Result, @MJ_AIPromptRuns_JudgeID_TokensUsed, @MJ_AIPromptRuns_JudgeID_TokensPrompt, @MJ_AIPromptRuns_JudgeID_TokensCompletion, @MJ_AIPromptRuns_JudgeID_TotalCost, @MJ_AIPromptRuns_JudgeID_Success, @MJ_AIPromptRuns_JudgeID_ErrorMessage, @MJ_AIPromptRuns_JudgeID_ParentID, @MJ_AIPromptRuns_JudgeID_RunType, @MJ_AIPromptRuns_JudgeID_ExecutionOrder, @MJ_AIPromptRuns_JudgeID_AgentRunID, @MJ_AIPromptRuns_JudgeID_Cost, @MJ_AIPromptRuns_JudgeID_CostCurrency, @MJ_AIPromptRuns_JudgeID_TokensUsedRollup, @MJ_AIPromptRuns_JudgeID_TokensPromptRollup, @MJ_AIPromptRuns_JudgeID_TokensCompletionRollup, @MJ_AIPromptRuns_JudgeID_Temperature, @MJ_AIPromptRuns_JudgeID_TopP, @MJ_AIPromptRuns_JudgeID_TopK, @MJ_AIPromptRuns_JudgeID_MinP, @MJ_AIPromptRuns_JudgeID_FrequencyPenalty, @MJ_AIPromptRuns_JudgeID_PresencePenalty, @MJ_AIPromptRuns_JudgeID_Seed, @MJ_AIPromptRuns_JudgeID_StopSequences, @MJ_AIPromptRuns_JudgeID_ResponseFormat, @MJ_AIPromptRuns_JudgeID_LogProbs, @MJ_AIPromptRuns_JudgeID_TopLogProbs, @MJ_AIPromptRuns_JudgeID_DescendantCost, @MJ_AIPromptRuns_JudgeID_ValidationAttemptCount, @MJ_AIPromptRuns_JudgeID_SuccessfulValidationCount, @MJ_AIPromptRuns_JudgeID_FinalValidationPassed, @MJ_AIPromptRuns_JudgeID_ValidationBehavior, @MJ_AIPromptRuns_JudgeID_RetryStrategy, @MJ_AIPromptRuns_JudgeID_MaxRetriesConfigured, @MJ_AIPromptRuns_JudgeID_FinalValidationError, @MJ_AIPromptRuns_JudgeID_ValidationErrorCount, @MJ_AIPromptRuns_JudgeID_CommonValidationError, @MJ_AIPromptRuns_JudgeID_FirstAttemptAt, @MJ_AIPromptRuns_JudgeID_LastAttemptAt, @MJ_AIPromptRuns_JudgeID_TotalRetryDurationMS, @MJ_AIPromptRuns_JudgeID_ValidationAttempts, @MJ_AIPromptRuns_JudgeID_ValidationSummary, @MJ_AIPromptRuns_JudgeID_FailoverAttempts, @MJ_AIPromptRuns_JudgeID_FailoverErrors, @MJ_AIPromptRuns_JudgeID_FailoverDurations, @MJ_AIPromptRuns_JudgeID_OriginalModelID, @MJ_AIPromptRuns_JudgeID_OriginalRequestStartTime, @MJ_AIPromptRuns_JudgeID_TotalFailoverDuration, @MJ_AIPromptRuns_JudgeID_RerunFromPromptRunID, @MJ_AIPromptRuns_JudgeID_ModelSelection, @MJ_AIPromptRuns_JudgeID_Status, @MJ_AIPromptRuns_JudgeID_Cancelled, @MJ_AIPromptRuns_JudgeID_CancellationReason, @MJ_AIPromptRuns_JudgeID_ModelPowerRank, @MJ_AIPromptRuns_JudgeID_SelectionStrategy, @MJ_AIPromptRuns_JudgeID_CacheHit, @MJ_AIPromptRuns_JudgeID_CacheKey, @MJ_AIPromptRuns_JudgeID_JudgeID, @MJ_AIPromptRuns_JudgeID_JudgeScore, @MJ_AIPromptRuns_JudgeID_WasSelectedResult, @MJ_AIPromptRuns_JudgeID_StreamingEnabled, @MJ_AIPromptRuns_JudgeID_FirstTokenTime, @MJ_AIPromptRuns_JudgeID_ErrorDetails, @MJ_AIPromptRuns_JudgeID_ChildPromptID, @MJ_AIPromptRuns_JudgeID_QueueTime, @MJ_AIPromptRuns_JudgeID_PromptTime, @MJ_AIPromptRuns_JudgeID_CompletionTime, @MJ_AIPromptRuns_JudgeID_ModelSpecificResponseDetails, @MJ_AIPromptRuns_JudgeID_EffortLevel, @MJ_AIPromptRuns_JudgeID_RunName, @MJ_AIPromptRuns_JudgeID_Comments, @MJ_AIPromptRuns_JudgeID_TestRunID

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @MJ_AIPromptRuns_JudgeID_JudgeID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateAIPromptRun] @ID = @MJ_AIPromptRuns_JudgeIDID, @PromptID = @MJ_AIPromptRuns_JudgeID_PromptID, @ModelID = @MJ_AIPromptRuns_JudgeID_ModelID, @VendorID = @MJ_AIPromptRuns_JudgeID_VendorID, @AgentID = @MJ_AIPromptRuns_JudgeID_AgentID, @ConfigurationID = @MJ_AIPromptRuns_JudgeID_ConfigurationID, @RunAt = @MJ_AIPromptRuns_JudgeID_RunAt, @CompletedAt = @MJ_AIPromptRuns_JudgeID_CompletedAt, @ExecutionTimeMS = @MJ_AIPromptRuns_JudgeID_ExecutionTimeMS, @Messages = @MJ_AIPromptRuns_JudgeID_Messages, @Result = @MJ_AIPromptRuns_JudgeID_Result, @TokensUsed = @MJ_AIPromptRuns_JudgeID_TokensUsed, @TokensPrompt = @MJ_AIPromptRuns_JudgeID_TokensPrompt, @TokensCompletion = @MJ_AIPromptRuns_JudgeID_TokensCompletion, @TotalCost = @MJ_AIPromptRuns_JudgeID_TotalCost, @Success = @MJ_AIPromptRuns_JudgeID_Success, @ErrorMessage = @MJ_AIPromptRuns_JudgeID_ErrorMessage, @ParentID = @MJ_AIPromptRuns_JudgeID_ParentID, @RunType = @MJ_AIPromptRuns_JudgeID_RunType, @ExecutionOrder = @MJ_AIPromptRuns_JudgeID_ExecutionOrder, @AgentRunID = @MJ_AIPromptRuns_JudgeID_AgentRunID, @Cost = @MJ_AIPromptRuns_JudgeID_Cost, @CostCurrency = @MJ_AIPromptRuns_JudgeID_CostCurrency, @TokensUsedRollup = @MJ_AIPromptRuns_JudgeID_TokensUsedRollup, @TokensPromptRollup = @MJ_AIPromptRuns_JudgeID_TokensPromptRollup, @TokensCompletionRollup = @MJ_AIPromptRuns_JudgeID_TokensCompletionRollup, @Temperature = @MJ_AIPromptRuns_JudgeID_Temperature, @TopP = @MJ_AIPromptRuns_JudgeID_TopP, @TopK = @MJ_AIPromptRuns_JudgeID_TopK, @MinP = @MJ_AIPromptRuns_JudgeID_MinP, @FrequencyPenalty = @MJ_AIPromptRuns_JudgeID_FrequencyPenalty, @PresencePenalty = @MJ_AIPromptRuns_JudgeID_PresencePenalty, @Seed = @MJ_AIPromptRuns_JudgeID_Seed, @StopSequences = @MJ_AIPromptRuns_JudgeID_StopSequences, @ResponseFormat = @MJ_AIPromptRuns_JudgeID_ResponseFormat, @LogProbs = @MJ_AIPromptRuns_JudgeID_LogProbs, @TopLogProbs = @MJ_AIPromptRuns_JudgeID_TopLogProbs, @DescendantCost = @MJ_AIPromptRuns_JudgeID_DescendantCost, @ValidationAttemptCount = @MJ_AIPromptRuns_JudgeID_ValidationAttemptCount, @SuccessfulValidationCount = @MJ_AIPromptRuns_JudgeID_SuccessfulValidationCount, @FinalValidationPassed = @MJ_AIPromptRuns_JudgeID_FinalValidationPassed, @ValidationBehavior = @MJ_AIPromptRuns_JudgeID_ValidationBehavior, @RetryStrategy = @MJ_AIPromptRuns_JudgeID_RetryStrategy, @MaxRetriesConfigured = @MJ_AIPromptRuns_JudgeID_MaxRetriesConfigured, @FinalValidationError = @MJ_AIPromptRuns_JudgeID_FinalValidationError, @ValidationErrorCount = @MJ_AIPromptRuns_JudgeID_ValidationErrorCount, @CommonValidationError = @MJ_AIPromptRuns_JudgeID_CommonValidationError, @FirstAttemptAt = @MJ_AIPromptRuns_JudgeID_FirstAttemptAt, @LastAttemptAt = @MJ_AIPromptRuns_JudgeID_LastAttemptAt, @TotalRetryDurationMS = @MJ_AIPromptRuns_JudgeID_TotalRetryDurationMS, @ValidationAttempts = @MJ_AIPromptRuns_JudgeID_ValidationAttempts, @ValidationSummary = @MJ_AIPromptRuns_JudgeID_ValidationSummary, @FailoverAttempts = @MJ_AIPromptRuns_JudgeID_FailoverAttempts, @FailoverErrors = @MJ_AIPromptRuns_JudgeID_FailoverErrors, @FailoverDurations = @MJ_AIPromptRuns_JudgeID_FailoverDurations, @OriginalModelID = @MJ_AIPromptRuns_JudgeID_OriginalModelID, @OriginalRequestStartTime = @MJ_AIPromptRuns_JudgeID_OriginalRequestStartTime, @TotalFailoverDuration = @MJ_AIPromptRuns_JudgeID_TotalFailoverDuration, @RerunFromPromptRunID = @MJ_AIPromptRuns_JudgeID_RerunFromPromptRunID, @ModelSelection = @MJ_AIPromptRuns_JudgeID_ModelSelection, @Status = @MJ_AIPromptRuns_JudgeID_Status, @Cancelled = @MJ_AIPromptRuns_JudgeID_Cancelled, @CancellationReason = @MJ_AIPromptRuns_JudgeID_CancellationReason, @ModelPowerRank = @MJ_AIPromptRuns_JudgeID_ModelPowerRank, @SelectionStrategy = @MJ_AIPromptRuns_JudgeID_SelectionStrategy, @CacheHit = @MJ_AIPromptRuns_JudgeID_CacheHit, @CacheKey = @MJ_AIPromptRuns_JudgeID_CacheKey, @JudgeID = @MJ_AIPromptRuns_JudgeID_JudgeID, @JudgeScore = @MJ_AIPromptRuns_JudgeID_JudgeScore, @WasSelectedResult = @MJ_AIPromptRuns_JudgeID_WasSelectedResult, @StreamingEnabled = @MJ_AIPromptRuns_JudgeID_StreamingEnabled, @FirstTokenTime = @MJ_AIPromptRuns_JudgeID_FirstTokenTime, @ErrorDetails = @MJ_AIPromptRuns_JudgeID_ErrorDetails, @ChildPromptID = @MJ_AIPromptRuns_JudgeID_ChildPromptID, @QueueTime = @MJ_AIPromptRuns_JudgeID_QueueTime, @PromptTime = @MJ_AIPromptRuns_JudgeID_PromptTime, @CompletionTime = @MJ_AIPromptRuns_JudgeID_CompletionTime, @ModelSpecificResponseDetails = @MJ_AIPromptRuns_JudgeID_ModelSpecificResponseDetails, @EffortLevel = @MJ_AIPromptRuns_JudgeID_EffortLevel, @RunName = @MJ_AIPromptRuns_JudgeID_RunName, @Comments = @MJ_AIPromptRuns_JudgeID_Comments, @TestRunID = @MJ_AIPromptRuns_JudgeID_TestRunID

        FETCH NEXT FROM cascade_update_MJ_AIPromptRuns_JudgeID_cursor INTO @MJ_AIPromptRuns_JudgeIDID, @MJ_AIPromptRuns_JudgeID_PromptID, @MJ_AIPromptRuns_JudgeID_ModelID, @MJ_AIPromptRuns_JudgeID_VendorID, @MJ_AIPromptRuns_JudgeID_AgentID, @MJ_AIPromptRuns_JudgeID_ConfigurationID, @MJ_AIPromptRuns_JudgeID_RunAt, @MJ_AIPromptRuns_JudgeID_CompletedAt, @MJ_AIPromptRuns_JudgeID_ExecutionTimeMS, @MJ_AIPromptRuns_JudgeID_Messages, @MJ_AIPromptRuns_JudgeID_Result, @MJ_AIPromptRuns_JudgeID_TokensUsed, @MJ_AIPromptRuns_JudgeID_TokensPrompt, @MJ_AIPromptRuns_JudgeID_TokensCompletion, @MJ_AIPromptRuns_JudgeID_TotalCost, @MJ_AIPromptRuns_JudgeID_Success, @MJ_AIPromptRuns_JudgeID_ErrorMessage, @MJ_AIPromptRuns_JudgeID_ParentID, @MJ_AIPromptRuns_JudgeID_RunType, @MJ_AIPromptRuns_JudgeID_ExecutionOrder, @MJ_AIPromptRuns_JudgeID_AgentRunID, @MJ_AIPromptRuns_JudgeID_Cost, @MJ_AIPromptRuns_JudgeID_CostCurrency, @MJ_AIPromptRuns_JudgeID_TokensUsedRollup, @MJ_AIPromptRuns_JudgeID_TokensPromptRollup, @MJ_AIPromptRuns_JudgeID_TokensCompletionRollup, @MJ_AIPromptRuns_JudgeID_Temperature, @MJ_AIPromptRuns_JudgeID_TopP, @MJ_AIPromptRuns_JudgeID_TopK, @MJ_AIPromptRuns_JudgeID_MinP, @MJ_AIPromptRuns_JudgeID_FrequencyPenalty, @MJ_AIPromptRuns_JudgeID_PresencePenalty, @MJ_AIPromptRuns_JudgeID_Seed, @MJ_AIPromptRuns_JudgeID_StopSequences, @MJ_AIPromptRuns_JudgeID_ResponseFormat, @MJ_AIPromptRuns_JudgeID_LogProbs, @MJ_AIPromptRuns_JudgeID_TopLogProbs, @MJ_AIPromptRuns_JudgeID_DescendantCost, @MJ_AIPromptRuns_JudgeID_ValidationAttemptCount, @MJ_AIPromptRuns_JudgeID_SuccessfulValidationCount, @MJ_AIPromptRuns_JudgeID_FinalValidationPassed, @MJ_AIPromptRuns_JudgeID_ValidationBehavior, @MJ_AIPromptRuns_JudgeID_RetryStrategy, @MJ_AIPromptRuns_JudgeID_MaxRetriesConfigured, @MJ_AIPromptRuns_JudgeID_FinalValidationError, @MJ_AIPromptRuns_JudgeID_ValidationErrorCount, @MJ_AIPromptRuns_JudgeID_CommonValidationError, @MJ_AIPromptRuns_JudgeID_FirstAttemptAt, @MJ_AIPromptRuns_JudgeID_LastAttemptAt, @MJ_AIPromptRuns_JudgeID_TotalRetryDurationMS, @MJ_AIPromptRuns_JudgeID_ValidationAttempts, @MJ_AIPromptRuns_JudgeID_ValidationSummary, @MJ_AIPromptRuns_JudgeID_FailoverAttempts, @MJ_AIPromptRuns_JudgeID_FailoverErrors, @MJ_AIPromptRuns_JudgeID_FailoverDurations, @MJ_AIPromptRuns_JudgeID_OriginalModelID, @MJ_AIPromptRuns_JudgeID_OriginalRequestStartTime, @MJ_AIPromptRuns_JudgeID_TotalFailoverDuration, @MJ_AIPromptRuns_JudgeID_RerunFromPromptRunID, @MJ_AIPromptRuns_JudgeID_ModelSelection, @MJ_AIPromptRuns_JudgeID_Status, @MJ_AIPromptRuns_JudgeID_Cancelled, @MJ_AIPromptRuns_JudgeID_CancellationReason, @MJ_AIPromptRuns_JudgeID_ModelPowerRank, @MJ_AIPromptRuns_JudgeID_SelectionStrategy, @MJ_AIPromptRuns_JudgeID_CacheHit, @MJ_AIPromptRuns_JudgeID_CacheKey, @MJ_AIPromptRuns_JudgeID_JudgeID, @MJ_AIPromptRuns_JudgeID_JudgeScore, @MJ_AIPromptRuns_JudgeID_WasSelectedResult, @MJ_AIPromptRuns_JudgeID_StreamingEnabled, @MJ_AIPromptRuns_JudgeID_FirstTokenTime, @MJ_AIPromptRuns_JudgeID_ErrorDetails, @MJ_AIPromptRuns_JudgeID_ChildPromptID, @MJ_AIPromptRuns_JudgeID_QueueTime, @MJ_AIPromptRuns_JudgeID_PromptTime, @MJ_AIPromptRuns_JudgeID_CompletionTime, @MJ_AIPromptRuns_JudgeID_ModelSpecificResponseDetails, @MJ_AIPromptRuns_JudgeID_EffortLevel, @MJ_AIPromptRuns_JudgeID_RunName, @MJ_AIPromptRuns_JudgeID_Comments, @MJ_AIPromptRuns_JudgeID_TestRunID
    END

    CLOSE cascade_update_MJ_AIPromptRuns_JudgeID_cursor
    DEALLOCATE cascade_update_MJ_AIPromptRuns_JudgeID_cursor
    
    -- Cascade update on AIPromptRun using cursor to call spUpdateAIPromptRun
    DECLARE @MJ_AIPromptRuns_ChildPromptIDID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_ChildPromptID_PromptID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_ChildPromptID_ModelID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_ChildPromptID_VendorID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_ChildPromptID_AgentID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_ChildPromptID_ConfigurationID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_ChildPromptID_RunAt datetimeoffset
    DECLARE @MJ_AIPromptRuns_ChildPromptID_CompletedAt datetimeoffset
    DECLARE @MJ_AIPromptRuns_ChildPromptID_ExecutionTimeMS int
    DECLARE @MJ_AIPromptRuns_ChildPromptID_Messages nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_ChildPromptID_Result nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_ChildPromptID_TokensUsed int
    DECLARE @MJ_AIPromptRuns_ChildPromptID_TokensPrompt int
    DECLARE @MJ_AIPromptRuns_ChildPromptID_TokensCompletion int
    DECLARE @MJ_AIPromptRuns_ChildPromptID_TotalCost decimal(18, 6)
    DECLARE @MJ_AIPromptRuns_ChildPromptID_Success bit
    DECLARE @MJ_AIPromptRuns_ChildPromptID_ErrorMessage nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_ChildPromptID_ParentID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_ChildPromptID_RunType nvarchar(20)
    DECLARE @MJ_AIPromptRuns_ChildPromptID_ExecutionOrder int
    DECLARE @MJ_AIPromptRuns_ChildPromptID_AgentRunID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_ChildPromptID_Cost decimal(19, 8)
    DECLARE @MJ_AIPromptRuns_ChildPromptID_CostCurrency nvarchar(10)
    DECLARE @MJ_AIPromptRuns_ChildPromptID_TokensUsedRollup int
    DECLARE @MJ_AIPromptRuns_ChildPromptID_TokensPromptRollup int
    DECLARE @MJ_AIPromptRuns_ChildPromptID_TokensCompletionRollup int
    DECLARE @MJ_AIPromptRuns_ChildPromptID_Temperature decimal(3, 2)
    DECLARE @MJ_AIPromptRuns_ChildPromptID_TopP decimal(3, 2)
    DECLARE @MJ_AIPromptRuns_ChildPromptID_TopK int
    DECLARE @MJ_AIPromptRuns_ChildPromptID_MinP decimal(3, 2)
    DECLARE @MJ_AIPromptRuns_ChildPromptID_FrequencyPenalty decimal(3, 2)
    DECLARE @MJ_AIPromptRuns_ChildPromptID_PresencePenalty decimal(3, 2)
    DECLARE @MJ_AIPromptRuns_ChildPromptID_Seed int
    DECLARE @MJ_AIPromptRuns_ChildPromptID_StopSequences nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_ChildPromptID_ResponseFormat nvarchar(50)
    DECLARE @MJ_AIPromptRuns_ChildPromptID_LogProbs bit
    DECLARE @MJ_AIPromptRuns_ChildPromptID_TopLogProbs int
    DECLARE @MJ_AIPromptRuns_ChildPromptID_DescendantCost decimal(18, 6)
    DECLARE @MJ_AIPromptRuns_ChildPromptID_ValidationAttemptCount int
    DECLARE @MJ_AIPromptRuns_ChildPromptID_SuccessfulValidationCount int
    DECLARE @MJ_AIPromptRuns_ChildPromptID_FinalValidationPassed bit
    DECLARE @MJ_AIPromptRuns_ChildPromptID_ValidationBehavior nvarchar(50)
    DECLARE @MJ_AIPromptRuns_ChildPromptID_RetryStrategy nvarchar(50)
    DECLARE @MJ_AIPromptRuns_ChildPromptID_MaxRetriesConfigured int
    DECLARE @MJ_AIPromptRuns_ChildPromptID_FinalValidationError nvarchar(500)
    DECLARE @MJ_AIPromptRuns_ChildPromptID_ValidationErrorCount int
    DECLARE @MJ_AIPromptRuns_ChildPromptID_CommonValidationError nvarchar(255)
    DECLARE @MJ_AIPromptRuns_ChildPromptID_FirstAttemptAt datetimeoffset
    DECLARE @MJ_AIPromptRuns_ChildPromptID_LastAttemptAt datetimeoffset
    DECLARE @MJ_AIPromptRuns_ChildPromptID_TotalRetryDurationMS int
    DECLARE @MJ_AIPromptRuns_ChildPromptID_ValidationAttempts nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_ChildPromptID_ValidationSummary nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_ChildPromptID_FailoverAttempts int
    DECLARE @MJ_AIPromptRuns_ChildPromptID_FailoverErrors nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_ChildPromptID_FailoverDurations nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_ChildPromptID_OriginalModelID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_ChildPromptID_OriginalRequestStartTime datetimeoffset
    DECLARE @MJ_AIPromptRuns_ChildPromptID_TotalFailoverDuration int
    DECLARE @MJ_AIPromptRuns_ChildPromptID_RerunFromPromptRunID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_ChildPromptID_ModelSelection nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_ChildPromptID_Status nvarchar(50)
    DECLARE @MJ_AIPromptRuns_ChildPromptID_Cancelled bit
    DECLARE @MJ_AIPromptRuns_ChildPromptID_CancellationReason nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_ChildPromptID_ModelPowerRank int
    DECLARE @MJ_AIPromptRuns_ChildPromptID_SelectionStrategy nvarchar(50)
    DECLARE @MJ_AIPromptRuns_ChildPromptID_CacheHit bit
    DECLARE @MJ_AIPromptRuns_ChildPromptID_CacheKey nvarchar(500)
    DECLARE @MJ_AIPromptRuns_ChildPromptID_JudgeID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_ChildPromptID_JudgeScore float(53)
    DECLARE @MJ_AIPromptRuns_ChildPromptID_WasSelectedResult bit
    DECLARE @MJ_AIPromptRuns_ChildPromptID_StreamingEnabled bit
    DECLARE @MJ_AIPromptRuns_ChildPromptID_FirstTokenTime int
    DECLARE @MJ_AIPromptRuns_ChildPromptID_ErrorDetails nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_ChildPromptID_ChildPromptID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_ChildPromptID_QueueTime int
    DECLARE @MJ_AIPromptRuns_ChildPromptID_PromptTime int
    DECLARE @MJ_AIPromptRuns_ChildPromptID_CompletionTime int
    DECLARE @MJ_AIPromptRuns_ChildPromptID_ModelSpecificResponseDetails nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_ChildPromptID_EffortLevel int
    DECLARE @MJ_AIPromptRuns_ChildPromptID_RunName nvarchar(255)
    DECLARE @MJ_AIPromptRuns_ChildPromptID_Comments nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_ChildPromptID_TestRunID uniqueidentifier
    DECLARE cascade_update_MJ_AIPromptRuns_ChildPromptID_cursor CURSOR FOR
        SELECT [ID], [PromptID], [ModelID], [VendorID], [AgentID], [ConfigurationID], [RunAt], [CompletedAt], [ExecutionTimeMS], [Messages], [Result], [TokensUsed], [TokensPrompt], [TokensCompletion], [TotalCost], [Success], [ErrorMessage], [ParentID], [RunType], [ExecutionOrder], [AgentRunID], [Cost], [CostCurrency], [TokensUsedRollup], [TokensPromptRollup], [TokensCompletionRollup], [Temperature], [TopP], [TopK], [MinP], [FrequencyPenalty], [PresencePenalty], [Seed], [StopSequences], [ResponseFormat], [LogProbs], [TopLogProbs], [DescendantCost], [ValidationAttemptCount], [SuccessfulValidationCount], [FinalValidationPassed], [ValidationBehavior], [RetryStrategy], [MaxRetriesConfigured], [FinalValidationError], [ValidationErrorCount], [CommonValidationError], [FirstAttemptAt], [LastAttemptAt], [TotalRetryDurationMS], [ValidationAttempts], [ValidationSummary], [FailoverAttempts], [FailoverErrors], [FailoverDurations], [OriginalModelID], [OriginalRequestStartTime], [TotalFailoverDuration], [RerunFromPromptRunID], [ModelSelection], [Status], [Cancelled], [CancellationReason], [ModelPowerRank], [SelectionStrategy], [CacheHit], [CacheKey], [JudgeID], [JudgeScore], [WasSelectedResult], [StreamingEnabled], [FirstTokenTime], [ErrorDetails], [ChildPromptID], [QueueTime], [PromptTime], [CompletionTime], [ModelSpecificResponseDetails], [EffortLevel], [RunName], [Comments], [TestRunID]
        FROM [${flyway:defaultSchema}].[AIPromptRun]
        WHERE [ChildPromptID] = @ID

    OPEN cascade_update_MJ_AIPromptRuns_ChildPromptID_cursor
    FETCH NEXT FROM cascade_update_MJ_AIPromptRuns_ChildPromptID_cursor INTO @MJ_AIPromptRuns_ChildPromptIDID, @MJ_AIPromptRuns_ChildPromptID_PromptID, @MJ_AIPromptRuns_ChildPromptID_ModelID, @MJ_AIPromptRuns_ChildPromptID_VendorID, @MJ_AIPromptRuns_ChildPromptID_AgentID, @MJ_AIPromptRuns_ChildPromptID_ConfigurationID, @MJ_AIPromptRuns_ChildPromptID_RunAt, @MJ_AIPromptRuns_ChildPromptID_CompletedAt, @MJ_AIPromptRuns_ChildPromptID_ExecutionTimeMS, @MJ_AIPromptRuns_ChildPromptID_Messages, @MJ_AIPromptRuns_ChildPromptID_Result, @MJ_AIPromptRuns_ChildPromptID_TokensUsed, @MJ_AIPromptRuns_ChildPromptID_TokensPrompt, @MJ_AIPromptRuns_ChildPromptID_TokensCompletion, @MJ_AIPromptRuns_ChildPromptID_TotalCost, @MJ_AIPromptRuns_ChildPromptID_Success, @MJ_AIPromptRuns_ChildPromptID_ErrorMessage, @MJ_AIPromptRuns_ChildPromptID_ParentID, @MJ_AIPromptRuns_ChildPromptID_RunType, @MJ_AIPromptRuns_ChildPromptID_ExecutionOrder, @MJ_AIPromptRuns_ChildPromptID_AgentRunID, @MJ_AIPromptRuns_ChildPromptID_Cost, @MJ_AIPromptRuns_ChildPromptID_CostCurrency, @MJ_AIPromptRuns_ChildPromptID_TokensUsedRollup, @MJ_AIPromptRuns_ChildPromptID_TokensPromptRollup, @MJ_AIPromptRuns_ChildPromptID_TokensCompletionRollup, @MJ_AIPromptRuns_ChildPromptID_Temperature, @MJ_AIPromptRuns_ChildPromptID_TopP, @MJ_AIPromptRuns_ChildPromptID_TopK, @MJ_AIPromptRuns_ChildPromptID_MinP, @MJ_AIPromptRuns_ChildPromptID_FrequencyPenalty, @MJ_AIPromptRuns_ChildPromptID_PresencePenalty, @MJ_AIPromptRuns_ChildPromptID_Seed, @MJ_AIPromptRuns_ChildPromptID_StopSequences, @MJ_AIPromptRuns_ChildPromptID_ResponseFormat, @MJ_AIPromptRuns_ChildPromptID_LogProbs, @MJ_AIPromptRuns_ChildPromptID_TopLogProbs, @MJ_AIPromptRuns_ChildPromptID_DescendantCost, @MJ_AIPromptRuns_ChildPromptID_ValidationAttemptCount, @MJ_AIPromptRuns_ChildPromptID_SuccessfulValidationCount, @MJ_AIPromptRuns_ChildPromptID_FinalValidationPassed, @MJ_AIPromptRuns_ChildPromptID_ValidationBehavior, @MJ_AIPromptRuns_ChildPromptID_RetryStrategy, @MJ_AIPromptRuns_ChildPromptID_MaxRetriesConfigured, @MJ_AIPromptRuns_ChildPromptID_FinalValidationError, @MJ_AIPromptRuns_ChildPromptID_ValidationErrorCount, @MJ_AIPromptRuns_ChildPromptID_CommonValidationError, @MJ_AIPromptRuns_ChildPromptID_FirstAttemptAt, @MJ_AIPromptRuns_ChildPromptID_LastAttemptAt, @MJ_AIPromptRuns_ChildPromptID_TotalRetryDurationMS, @MJ_AIPromptRuns_ChildPromptID_ValidationAttempts, @MJ_AIPromptRuns_ChildPromptID_ValidationSummary, @MJ_AIPromptRuns_ChildPromptID_FailoverAttempts, @MJ_AIPromptRuns_ChildPromptID_FailoverErrors, @MJ_AIPromptRuns_ChildPromptID_FailoverDurations, @MJ_AIPromptRuns_ChildPromptID_OriginalModelID, @MJ_AIPromptRuns_ChildPromptID_OriginalRequestStartTime, @MJ_AIPromptRuns_ChildPromptID_TotalFailoverDuration, @MJ_AIPromptRuns_ChildPromptID_RerunFromPromptRunID, @MJ_AIPromptRuns_ChildPromptID_ModelSelection, @MJ_AIPromptRuns_ChildPromptID_Status, @MJ_AIPromptRuns_ChildPromptID_Cancelled, @MJ_AIPromptRuns_ChildPromptID_CancellationReason, @MJ_AIPromptRuns_ChildPromptID_ModelPowerRank, @MJ_AIPromptRuns_ChildPromptID_SelectionStrategy, @MJ_AIPromptRuns_ChildPromptID_CacheHit, @MJ_AIPromptRuns_ChildPromptID_CacheKey, @MJ_AIPromptRuns_ChildPromptID_JudgeID, @MJ_AIPromptRuns_ChildPromptID_JudgeScore, @MJ_AIPromptRuns_ChildPromptID_WasSelectedResult, @MJ_AIPromptRuns_ChildPromptID_StreamingEnabled, @MJ_AIPromptRuns_ChildPromptID_FirstTokenTime, @MJ_AIPromptRuns_ChildPromptID_ErrorDetails, @MJ_AIPromptRuns_ChildPromptID_ChildPromptID, @MJ_AIPromptRuns_ChildPromptID_QueueTime, @MJ_AIPromptRuns_ChildPromptID_PromptTime, @MJ_AIPromptRuns_ChildPromptID_CompletionTime, @MJ_AIPromptRuns_ChildPromptID_ModelSpecificResponseDetails, @MJ_AIPromptRuns_ChildPromptID_EffortLevel, @MJ_AIPromptRuns_ChildPromptID_RunName, @MJ_AIPromptRuns_ChildPromptID_Comments, @MJ_AIPromptRuns_ChildPromptID_TestRunID

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @MJ_AIPromptRuns_ChildPromptID_ChildPromptID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateAIPromptRun] @ID = @MJ_AIPromptRuns_ChildPromptIDID, @PromptID = @MJ_AIPromptRuns_ChildPromptID_PromptID, @ModelID = @MJ_AIPromptRuns_ChildPromptID_ModelID, @VendorID = @MJ_AIPromptRuns_ChildPromptID_VendorID, @AgentID = @MJ_AIPromptRuns_ChildPromptID_AgentID, @ConfigurationID = @MJ_AIPromptRuns_ChildPromptID_ConfigurationID, @RunAt = @MJ_AIPromptRuns_ChildPromptID_RunAt, @CompletedAt = @MJ_AIPromptRuns_ChildPromptID_CompletedAt, @ExecutionTimeMS = @MJ_AIPromptRuns_ChildPromptID_ExecutionTimeMS, @Messages = @MJ_AIPromptRuns_ChildPromptID_Messages, @Result = @MJ_AIPromptRuns_ChildPromptID_Result, @TokensUsed = @MJ_AIPromptRuns_ChildPromptID_TokensUsed, @TokensPrompt = @MJ_AIPromptRuns_ChildPromptID_TokensPrompt, @TokensCompletion = @MJ_AIPromptRuns_ChildPromptID_TokensCompletion, @TotalCost = @MJ_AIPromptRuns_ChildPromptID_TotalCost, @Success = @MJ_AIPromptRuns_ChildPromptID_Success, @ErrorMessage = @MJ_AIPromptRuns_ChildPromptID_ErrorMessage, @ParentID = @MJ_AIPromptRuns_ChildPromptID_ParentID, @RunType = @MJ_AIPromptRuns_ChildPromptID_RunType, @ExecutionOrder = @MJ_AIPromptRuns_ChildPromptID_ExecutionOrder, @AgentRunID = @MJ_AIPromptRuns_ChildPromptID_AgentRunID, @Cost = @MJ_AIPromptRuns_ChildPromptID_Cost, @CostCurrency = @MJ_AIPromptRuns_ChildPromptID_CostCurrency, @TokensUsedRollup = @MJ_AIPromptRuns_ChildPromptID_TokensUsedRollup, @TokensPromptRollup = @MJ_AIPromptRuns_ChildPromptID_TokensPromptRollup, @TokensCompletionRollup = @MJ_AIPromptRuns_ChildPromptID_TokensCompletionRollup, @Temperature = @MJ_AIPromptRuns_ChildPromptID_Temperature, @TopP = @MJ_AIPromptRuns_ChildPromptID_TopP, @TopK = @MJ_AIPromptRuns_ChildPromptID_TopK, @MinP = @MJ_AIPromptRuns_ChildPromptID_MinP, @FrequencyPenalty = @MJ_AIPromptRuns_ChildPromptID_FrequencyPenalty, @PresencePenalty = @MJ_AIPromptRuns_ChildPromptID_PresencePenalty, @Seed = @MJ_AIPromptRuns_ChildPromptID_Seed, @StopSequences = @MJ_AIPromptRuns_ChildPromptID_StopSequences, @ResponseFormat = @MJ_AIPromptRuns_ChildPromptID_ResponseFormat, @LogProbs = @MJ_AIPromptRuns_ChildPromptID_LogProbs, @TopLogProbs = @MJ_AIPromptRuns_ChildPromptID_TopLogProbs, @DescendantCost = @MJ_AIPromptRuns_ChildPromptID_DescendantCost, @ValidationAttemptCount = @MJ_AIPromptRuns_ChildPromptID_ValidationAttemptCount, @SuccessfulValidationCount = @MJ_AIPromptRuns_ChildPromptID_SuccessfulValidationCount, @FinalValidationPassed = @MJ_AIPromptRuns_ChildPromptID_FinalValidationPassed, @ValidationBehavior = @MJ_AIPromptRuns_ChildPromptID_ValidationBehavior, @RetryStrategy = @MJ_AIPromptRuns_ChildPromptID_RetryStrategy, @MaxRetriesConfigured = @MJ_AIPromptRuns_ChildPromptID_MaxRetriesConfigured, @FinalValidationError = @MJ_AIPromptRuns_ChildPromptID_FinalValidationError, @ValidationErrorCount = @MJ_AIPromptRuns_ChildPromptID_ValidationErrorCount, @CommonValidationError = @MJ_AIPromptRuns_ChildPromptID_CommonValidationError, @FirstAttemptAt = @MJ_AIPromptRuns_ChildPromptID_FirstAttemptAt, @LastAttemptAt = @MJ_AIPromptRuns_ChildPromptID_LastAttemptAt, @TotalRetryDurationMS = @MJ_AIPromptRuns_ChildPromptID_TotalRetryDurationMS, @ValidationAttempts = @MJ_AIPromptRuns_ChildPromptID_ValidationAttempts, @ValidationSummary = @MJ_AIPromptRuns_ChildPromptID_ValidationSummary, @FailoverAttempts = @MJ_AIPromptRuns_ChildPromptID_FailoverAttempts, @FailoverErrors = @MJ_AIPromptRuns_ChildPromptID_FailoverErrors, @FailoverDurations = @MJ_AIPromptRuns_ChildPromptID_FailoverDurations, @OriginalModelID = @MJ_AIPromptRuns_ChildPromptID_OriginalModelID, @OriginalRequestStartTime = @MJ_AIPromptRuns_ChildPromptID_OriginalRequestStartTime, @TotalFailoverDuration = @MJ_AIPromptRuns_ChildPromptID_TotalFailoverDuration, @RerunFromPromptRunID = @MJ_AIPromptRuns_ChildPromptID_RerunFromPromptRunID, @ModelSelection = @MJ_AIPromptRuns_ChildPromptID_ModelSelection, @Status = @MJ_AIPromptRuns_ChildPromptID_Status, @Cancelled = @MJ_AIPromptRuns_ChildPromptID_Cancelled, @CancellationReason = @MJ_AIPromptRuns_ChildPromptID_CancellationReason, @ModelPowerRank = @MJ_AIPromptRuns_ChildPromptID_ModelPowerRank, @SelectionStrategy = @MJ_AIPromptRuns_ChildPromptID_SelectionStrategy, @CacheHit = @MJ_AIPromptRuns_ChildPromptID_CacheHit, @CacheKey = @MJ_AIPromptRuns_ChildPromptID_CacheKey, @JudgeID = @MJ_AIPromptRuns_ChildPromptID_JudgeID, @JudgeScore = @MJ_AIPromptRuns_ChildPromptID_JudgeScore, @WasSelectedResult = @MJ_AIPromptRuns_ChildPromptID_WasSelectedResult, @StreamingEnabled = @MJ_AIPromptRuns_ChildPromptID_StreamingEnabled, @FirstTokenTime = @MJ_AIPromptRuns_ChildPromptID_FirstTokenTime, @ErrorDetails = @MJ_AIPromptRuns_ChildPromptID_ErrorDetails, @ChildPromptID = @MJ_AIPromptRuns_ChildPromptID_ChildPromptID, @QueueTime = @MJ_AIPromptRuns_ChildPromptID_QueueTime, @PromptTime = @MJ_AIPromptRuns_ChildPromptID_PromptTime, @CompletionTime = @MJ_AIPromptRuns_ChildPromptID_CompletionTime, @ModelSpecificResponseDetails = @MJ_AIPromptRuns_ChildPromptID_ModelSpecificResponseDetails, @EffortLevel = @MJ_AIPromptRuns_ChildPromptID_EffortLevel, @RunName = @MJ_AIPromptRuns_ChildPromptID_RunName, @Comments = @MJ_AIPromptRuns_ChildPromptID_Comments, @TestRunID = @MJ_AIPromptRuns_ChildPromptID_TestRunID

        FETCH NEXT FROM cascade_update_MJ_AIPromptRuns_ChildPromptID_cursor INTO @MJ_AIPromptRuns_ChildPromptIDID, @MJ_AIPromptRuns_ChildPromptID_PromptID, @MJ_AIPromptRuns_ChildPromptID_ModelID, @MJ_AIPromptRuns_ChildPromptID_VendorID, @MJ_AIPromptRuns_ChildPromptID_AgentID, @MJ_AIPromptRuns_ChildPromptID_ConfigurationID, @MJ_AIPromptRuns_ChildPromptID_RunAt, @MJ_AIPromptRuns_ChildPromptID_CompletedAt, @MJ_AIPromptRuns_ChildPromptID_ExecutionTimeMS, @MJ_AIPromptRuns_ChildPromptID_Messages, @MJ_AIPromptRuns_ChildPromptID_Result, @MJ_AIPromptRuns_ChildPromptID_TokensUsed, @MJ_AIPromptRuns_ChildPromptID_TokensPrompt, @MJ_AIPromptRuns_ChildPromptID_TokensCompletion, @MJ_AIPromptRuns_ChildPromptID_TotalCost, @MJ_AIPromptRuns_ChildPromptID_Success, @MJ_AIPromptRuns_ChildPromptID_ErrorMessage, @MJ_AIPromptRuns_ChildPromptID_ParentID, @MJ_AIPromptRuns_ChildPromptID_RunType, @MJ_AIPromptRuns_ChildPromptID_ExecutionOrder, @MJ_AIPromptRuns_ChildPromptID_AgentRunID, @MJ_AIPromptRuns_ChildPromptID_Cost, @MJ_AIPromptRuns_ChildPromptID_CostCurrency, @MJ_AIPromptRuns_ChildPromptID_TokensUsedRollup, @MJ_AIPromptRuns_ChildPromptID_TokensPromptRollup, @MJ_AIPromptRuns_ChildPromptID_TokensCompletionRollup, @MJ_AIPromptRuns_ChildPromptID_Temperature, @MJ_AIPromptRuns_ChildPromptID_TopP, @MJ_AIPromptRuns_ChildPromptID_TopK, @MJ_AIPromptRuns_ChildPromptID_MinP, @MJ_AIPromptRuns_ChildPromptID_FrequencyPenalty, @MJ_AIPromptRuns_ChildPromptID_PresencePenalty, @MJ_AIPromptRuns_ChildPromptID_Seed, @MJ_AIPromptRuns_ChildPromptID_StopSequences, @MJ_AIPromptRuns_ChildPromptID_ResponseFormat, @MJ_AIPromptRuns_ChildPromptID_LogProbs, @MJ_AIPromptRuns_ChildPromptID_TopLogProbs, @MJ_AIPromptRuns_ChildPromptID_DescendantCost, @MJ_AIPromptRuns_ChildPromptID_ValidationAttemptCount, @MJ_AIPromptRuns_ChildPromptID_SuccessfulValidationCount, @MJ_AIPromptRuns_ChildPromptID_FinalValidationPassed, @MJ_AIPromptRuns_ChildPromptID_ValidationBehavior, @MJ_AIPromptRuns_ChildPromptID_RetryStrategy, @MJ_AIPromptRuns_ChildPromptID_MaxRetriesConfigured, @MJ_AIPromptRuns_ChildPromptID_FinalValidationError, @MJ_AIPromptRuns_ChildPromptID_ValidationErrorCount, @MJ_AIPromptRuns_ChildPromptID_CommonValidationError, @MJ_AIPromptRuns_ChildPromptID_FirstAttemptAt, @MJ_AIPromptRuns_ChildPromptID_LastAttemptAt, @MJ_AIPromptRuns_ChildPromptID_TotalRetryDurationMS, @MJ_AIPromptRuns_ChildPromptID_ValidationAttempts, @MJ_AIPromptRuns_ChildPromptID_ValidationSummary, @MJ_AIPromptRuns_ChildPromptID_FailoverAttempts, @MJ_AIPromptRuns_ChildPromptID_FailoverErrors, @MJ_AIPromptRuns_ChildPromptID_FailoverDurations, @MJ_AIPromptRuns_ChildPromptID_OriginalModelID, @MJ_AIPromptRuns_ChildPromptID_OriginalRequestStartTime, @MJ_AIPromptRuns_ChildPromptID_TotalFailoverDuration, @MJ_AIPromptRuns_ChildPromptID_RerunFromPromptRunID, @MJ_AIPromptRuns_ChildPromptID_ModelSelection, @MJ_AIPromptRuns_ChildPromptID_Status, @MJ_AIPromptRuns_ChildPromptID_Cancelled, @MJ_AIPromptRuns_ChildPromptID_CancellationReason, @MJ_AIPromptRuns_ChildPromptID_ModelPowerRank, @MJ_AIPromptRuns_ChildPromptID_SelectionStrategy, @MJ_AIPromptRuns_ChildPromptID_CacheHit, @MJ_AIPromptRuns_ChildPromptID_CacheKey, @MJ_AIPromptRuns_ChildPromptID_JudgeID, @MJ_AIPromptRuns_ChildPromptID_JudgeScore, @MJ_AIPromptRuns_ChildPromptID_WasSelectedResult, @MJ_AIPromptRuns_ChildPromptID_StreamingEnabled, @MJ_AIPromptRuns_ChildPromptID_FirstTokenTime, @MJ_AIPromptRuns_ChildPromptID_ErrorDetails, @MJ_AIPromptRuns_ChildPromptID_ChildPromptID, @MJ_AIPromptRuns_ChildPromptID_QueueTime, @MJ_AIPromptRuns_ChildPromptID_PromptTime, @MJ_AIPromptRuns_ChildPromptID_CompletionTime, @MJ_AIPromptRuns_ChildPromptID_ModelSpecificResponseDetails, @MJ_AIPromptRuns_ChildPromptID_EffortLevel, @MJ_AIPromptRuns_ChildPromptID_RunName, @MJ_AIPromptRuns_ChildPromptID_Comments, @MJ_AIPromptRuns_ChildPromptID_TestRunID
    END

    CLOSE cascade_update_MJ_AIPromptRuns_ChildPromptID_cursor
    DEALLOCATE cascade_update_MJ_AIPromptRuns_ChildPromptID_cursor
    

    DELETE FROM
        [${flyway:defaultSchema}].[AIPrompt]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteAIPrompt] TO [cdp_Developer]
    

/* spDelete Permissions for AI Prompts */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteAIPrompt] TO [cdp_Developer]



/* spDelete SQL for MJ: AI Agent Run Steps */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Run Steps
-- Item: spDeleteAIAgentRunStep
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR AIAgentRunStep
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteAIAgentRunStep]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteAIAgentRunStep];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteAIAgentRunStep]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    -- Cascade update on AIAgentRunStep using cursor to call spUpdateAIAgentRunStep
    DECLARE @MJ_AIAgentRunSteps_ParentIDID uniqueidentifier
    DECLARE @MJ_AIAgentRunSteps_ParentID_AgentRunID uniqueidentifier
    DECLARE @MJ_AIAgentRunSteps_ParentID_StepNumber int
    DECLARE @MJ_AIAgentRunSteps_ParentID_StepType nvarchar(50)
    DECLARE @MJ_AIAgentRunSteps_ParentID_StepName nvarchar(255)
    DECLARE @MJ_AIAgentRunSteps_ParentID_TargetID uniqueidentifier
    DECLARE @MJ_AIAgentRunSteps_ParentID_Status nvarchar(50)
    DECLARE @MJ_AIAgentRunSteps_ParentID_StartedAt datetimeoffset
    DECLARE @MJ_AIAgentRunSteps_ParentID_CompletedAt datetimeoffset
    DECLARE @MJ_AIAgentRunSteps_ParentID_Success bit
    DECLARE @MJ_AIAgentRunSteps_ParentID_ErrorMessage nvarchar(MAX)
    DECLARE @MJ_AIAgentRunSteps_ParentID_InputData nvarchar(MAX)
    DECLARE @MJ_AIAgentRunSteps_ParentID_OutputData nvarchar(MAX)
    DECLARE @MJ_AIAgentRunSteps_ParentID_TargetLogID uniqueidentifier
    DECLARE @MJ_AIAgentRunSteps_ParentID_PayloadAtStart nvarchar(MAX)
    DECLARE @MJ_AIAgentRunSteps_ParentID_PayloadAtEnd nvarchar(MAX)
    DECLARE @MJ_AIAgentRunSteps_ParentID_FinalPayloadValidationResult nvarchar(25)
    DECLARE @MJ_AIAgentRunSteps_ParentID_FinalPayloadValidationMessages nvarchar(MAX)
    DECLARE @MJ_AIAgentRunSteps_ParentID_ParentID uniqueidentifier
    DECLARE @MJ_AIAgentRunSteps_ParentID_Comments nvarchar(MAX)
    DECLARE cascade_update_MJ_AIAgentRunSteps_ParentID_cursor CURSOR FOR
        SELECT [ID], [AgentRunID], [StepNumber], [StepType], [StepName], [TargetID], [Status], [StartedAt], [CompletedAt], [Success], [ErrorMessage], [InputData], [OutputData], [TargetLogID], [PayloadAtStart], [PayloadAtEnd], [FinalPayloadValidationResult], [FinalPayloadValidationMessages], [ParentID], [Comments]
        FROM [${flyway:defaultSchema}].[AIAgentRunStep]
        WHERE [ParentID] = @ID

    OPEN cascade_update_MJ_AIAgentRunSteps_ParentID_cursor
    FETCH NEXT FROM cascade_update_MJ_AIAgentRunSteps_ParentID_cursor INTO @MJ_AIAgentRunSteps_ParentIDID, @MJ_AIAgentRunSteps_ParentID_AgentRunID, @MJ_AIAgentRunSteps_ParentID_StepNumber, @MJ_AIAgentRunSteps_ParentID_StepType, @MJ_AIAgentRunSteps_ParentID_StepName, @MJ_AIAgentRunSteps_ParentID_TargetID, @MJ_AIAgentRunSteps_ParentID_Status, @MJ_AIAgentRunSteps_ParentID_StartedAt, @MJ_AIAgentRunSteps_ParentID_CompletedAt, @MJ_AIAgentRunSteps_ParentID_Success, @MJ_AIAgentRunSteps_ParentID_ErrorMessage, @MJ_AIAgentRunSteps_ParentID_InputData, @MJ_AIAgentRunSteps_ParentID_OutputData, @MJ_AIAgentRunSteps_ParentID_TargetLogID, @MJ_AIAgentRunSteps_ParentID_PayloadAtStart, @MJ_AIAgentRunSteps_ParentID_PayloadAtEnd, @MJ_AIAgentRunSteps_ParentID_FinalPayloadValidationResult, @MJ_AIAgentRunSteps_ParentID_FinalPayloadValidationMessages, @MJ_AIAgentRunSteps_ParentID_ParentID, @MJ_AIAgentRunSteps_ParentID_Comments

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @MJ_AIAgentRunSteps_ParentID_ParentID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateAIAgentRunStep] @ID = @MJ_AIAgentRunSteps_ParentIDID, @AgentRunID = @MJ_AIAgentRunSteps_ParentID_AgentRunID, @StepNumber = @MJ_AIAgentRunSteps_ParentID_StepNumber, @StepType = @MJ_AIAgentRunSteps_ParentID_StepType, @StepName = @MJ_AIAgentRunSteps_ParentID_StepName, @TargetID = @MJ_AIAgentRunSteps_ParentID_TargetID, @Status = @MJ_AIAgentRunSteps_ParentID_Status, @StartedAt = @MJ_AIAgentRunSteps_ParentID_StartedAt, @CompletedAt = @MJ_AIAgentRunSteps_ParentID_CompletedAt, @Success = @MJ_AIAgentRunSteps_ParentID_Success, @ErrorMessage = @MJ_AIAgentRunSteps_ParentID_ErrorMessage, @InputData = @MJ_AIAgentRunSteps_ParentID_InputData, @OutputData = @MJ_AIAgentRunSteps_ParentID_OutputData, @TargetLogID = @MJ_AIAgentRunSteps_ParentID_TargetLogID, @PayloadAtStart = @MJ_AIAgentRunSteps_ParentID_PayloadAtStart, @PayloadAtEnd = @MJ_AIAgentRunSteps_ParentID_PayloadAtEnd, @FinalPayloadValidationResult = @MJ_AIAgentRunSteps_ParentID_FinalPayloadValidationResult, @FinalPayloadValidationMessages = @MJ_AIAgentRunSteps_ParentID_FinalPayloadValidationMessages, @ParentID = @MJ_AIAgentRunSteps_ParentID_ParentID, @Comments = @MJ_AIAgentRunSteps_ParentID_Comments

        FETCH NEXT FROM cascade_update_MJ_AIAgentRunSteps_ParentID_cursor INTO @MJ_AIAgentRunSteps_ParentIDID, @MJ_AIAgentRunSteps_ParentID_AgentRunID, @MJ_AIAgentRunSteps_ParentID_StepNumber, @MJ_AIAgentRunSteps_ParentID_StepType, @MJ_AIAgentRunSteps_ParentID_StepName, @MJ_AIAgentRunSteps_ParentID_TargetID, @MJ_AIAgentRunSteps_ParentID_Status, @MJ_AIAgentRunSteps_ParentID_StartedAt, @MJ_AIAgentRunSteps_ParentID_CompletedAt, @MJ_AIAgentRunSteps_ParentID_Success, @MJ_AIAgentRunSteps_ParentID_ErrorMessage, @MJ_AIAgentRunSteps_ParentID_InputData, @MJ_AIAgentRunSteps_ParentID_OutputData, @MJ_AIAgentRunSteps_ParentID_TargetLogID, @MJ_AIAgentRunSteps_ParentID_PayloadAtStart, @MJ_AIAgentRunSteps_ParentID_PayloadAtEnd, @MJ_AIAgentRunSteps_ParentID_FinalPayloadValidationResult, @MJ_AIAgentRunSteps_ParentID_FinalPayloadValidationMessages, @MJ_AIAgentRunSteps_ParentID_ParentID, @MJ_AIAgentRunSteps_ParentID_Comments
    END

    CLOSE cascade_update_MJ_AIAgentRunSteps_ParentID_cursor
    DEALLOCATE cascade_update_MJ_AIAgentRunSteps_ParentID_cursor
    

    DELETE FROM
        [${flyway:defaultSchema}].[AIAgentRunStep]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteAIAgentRunStep] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: AI Agent Run Steps */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteAIAgentRunStep] TO [cdp_Integration]



/* spDelete SQL for MJ: AI Agent Runs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Runs
-- Item: spDeleteAIAgentRun
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR AIAgentRun
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteAIAgentRun]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteAIAgentRun];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteAIAgentRun]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    -- Cascade update on AIAgentNote using cursor to call spUpdateAIAgentNote
    DECLARE @AIAgentNotes_SourceAIAgentRunIDID uniqueidentifier
    DECLARE @AIAgentNotes_SourceAIAgentRunID_AgentID uniqueidentifier
    DECLARE @AIAgentNotes_SourceAIAgentRunID_AgentNoteTypeID uniqueidentifier
    DECLARE @AIAgentNotes_SourceAIAgentRunID_Note nvarchar(MAX)
    DECLARE @AIAgentNotes_SourceAIAgentRunID_UserID uniqueidentifier
    DECLARE @AIAgentNotes_SourceAIAgentRunID_Type nvarchar(20)
    DECLARE @AIAgentNotes_SourceAIAgentRunID_IsAutoGenerated bit
    DECLARE @AIAgentNotes_SourceAIAgentRunID_Comments nvarchar(MAX)
    DECLARE @AIAgentNotes_SourceAIAgentRunID_Status nvarchar(20)
    DECLARE @AIAgentNotes_SourceAIAgentRunID_SourceConversationID uniqueidentifier
    DECLARE @AIAgentNotes_SourceAIAgentRunID_SourceConversationDetailID uniqueidentifier
    DECLARE @AIAgentNotes_SourceAIAgentRunID_SourceAIAgentRunID uniqueidentifier
    DECLARE @AIAgentNotes_SourceAIAgentRunID_CompanyID uniqueidentifier
    DECLARE @AIAgentNotes_SourceAIAgentRunID_EmbeddingVector nvarchar(MAX)
    DECLARE @AIAgentNotes_SourceAIAgentRunID_EmbeddingModelID uniqueidentifier
    DECLARE @AIAgentNotes_SourceAIAgentRunID_PrimaryScopeEntityID uniqueidentifier
    DECLARE @AIAgentNotes_SourceAIAgentRunID_PrimaryScopeRecordID nvarchar(100)
    DECLARE @AIAgentNotes_SourceAIAgentRunID_SecondaryScopes nvarchar(MAX)
    DECLARE @AIAgentNotes_SourceAIAgentRunID_LastAccessedAt datetimeoffset
    DECLARE @AIAgentNotes_SourceAIAgentRunID_AccessCount int
    DECLARE @AIAgentNotes_SourceAIAgentRunID_ExpiresAt datetimeoffset
    DECLARE cascade_update_AIAgentNotes_SourceAIAgentRunID_cursor CURSOR FOR
        SELECT [ID], [AgentID], [AgentNoteTypeID], [Note], [UserID], [Type], [IsAutoGenerated], [Comments], [Status], [SourceConversationID], [SourceConversationDetailID], [SourceAIAgentRunID], [CompanyID], [EmbeddingVector], [EmbeddingModelID], [PrimaryScopeEntityID], [PrimaryScopeRecordID], [SecondaryScopes], [LastAccessedAt], [AccessCount], [ExpiresAt]
        FROM [${flyway:defaultSchema}].[AIAgentNote]
        WHERE [SourceAIAgentRunID] = @ID

    OPEN cascade_update_AIAgentNotes_SourceAIAgentRunID_cursor
    FETCH NEXT FROM cascade_update_AIAgentNotes_SourceAIAgentRunID_cursor INTO @AIAgentNotes_SourceAIAgentRunIDID, @AIAgentNotes_SourceAIAgentRunID_AgentID, @AIAgentNotes_SourceAIAgentRunID_AgentNoteTypeID, @AIAgentNotes_SourceAIAgentRunID_Note, @AIAgentNotes_SourceAIAgentRunID_UserID, @AIAgentNotes_SourceAIAgentRunID_Type, @AIAgentNotes_SourceAIAgentRunID_IsAutoGenerated, @AIAgentNotes_SourceAIAgentRunID_Comments, @AIAgentNotes_SourceAIAgentRunID_Status, @AIAgentNotes_SourceAIAgentRunID_SourceConversationID, @AIAgentNotes_SourceAIAgentRunID_SourceConversationDetailID, @AIAgentNotes_SourceAIAgentRunID_SourceAIAgentRunID, @AIAgentNotes_SourceAIAgentRunID_CompanyID, @AIAgentNotes_SourceAIAgentRunID_EmbeddingVector, @AIAgentNotes_SourceAIAgentRunID_EmbeddingModelID, @AIAgentNotes_SourceAIAgentRunID_PrimaryScopeEntityID, @AIAgentNotes_SourceAIAgentRunID_PrimaryScopeRecordID, @AIAgentNotes_SourceAIAgentRunID_SecondaryScopes, @AIAgentNotes_SourceAIAgentRunID_LastAccessedAt, @AIAgentNotes_SourceAIAgentRunID_AccessCount, @AIAgentNotes_SourceAIAgentRunID_ExpiresAt

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @AIAgentNotes_SourceAIAgentRunID_SourceAIAgentRunID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateAIAgentNote] @ID = @AIAgentNotes_SourceAIAgentRunIDID, @AgentID = @AIAgentNotes_SourceAIAgentRunID_AgentID, @AgentNoteTypeID = @AIAgentNotes_SourceAIAgentRunID_AgentNoteTypeID, @Note = @AIAgentNotes_SourceAIAgentRunID_Note, @UserID = @AIAgentNotes_SourceAIAgentRunID_UserID, @Type = @AIAgentNotes_SourceAIAgentRunID_Type, @IsAutoGenerated = @AIAgentNotes_SourceAIAgentRunID_IsAutoGenerated, @Comments = @AIAgentNotes_SourceAIAgentRunID_Comments, @Status = @AIAgentNotes_SourceAIAgentRunID_Status, @SourceConversationID = @AIAgentNotes_SourceAIAgentRunID_SourceConversationID, @SourceConversationDetailID = @AIAgentNotes_SourceAIAgentRunID_SourceConversationDetailID, @SourceAIAgentRunID = @AIAgentNotes_SourceAIAgentRunID_SourceAIAgentRunID, @CompanyID = @AIAgentNotes_SourceAIAgentRunID_CompanyID, @EmbeddingVector = @AIAgentNotes_SourceAIAgentRunID_EmbeddingVector, @EmbeddingModelID = @AIAgentNotes_SourceAIAgentRunID_EmbeddingModelID, @PrimaryScopeEntityID = @AIAgentNotes_SourceAIAgentRunID_PrimaryScopeEntityID, @PrimaryScopeRecordID = @AIAgentNotes_SourceAIAgentRunID_PrimaryScopeRecordID, @SecondaryScopes = @AIAgentNotes_SourceAIAgentRunID_SecondaryScopes, @LastAccessedAt = @AIAgentNotes_SourceAIAgentRunID_LastAccessedAt, @AccessCount = @AIAgentNotes_SourceAIAgentRunID_AccessCount, @ExpiresAt = @AIAgentNotes_SourceAIAgentRunID_ExpiresAt

        FETCH NEXT FROM cascade_update_AIAgentNotes_SourceAIAgentRunID_cursor INTO @AIAgentNotes_SourceAIAgentRunIDID, @AIAgentNotes_SourceAIAgentRunID_AgentID, @AIAgentNotes_SourceAIAgentRunID_AgentNoteTypeID, @AIAgentNotes_SourceAIAgentRunID_Note, @AIAgentNotes_SourceAIAgentRunID_UserID, @AIAgentNotes_SourceAIAgentRunID_Type, @AIAgentNotes_SourceAIAgentRunID_IsAutoGenerated, @AIAgentNotes_SourceAIAgentRunID_Comments, @AIAgentNotes_SourceAIAgentRunID_Status, @AIAgentNotes_SourceAIAgentRunID_SourceConversationID, @AIAgentNotes_SourceAIAgentRunID_SourceConversationDetailID, @AIAgentNotes_SourceAIAgentRunID_SourceAIAgentRunID, @AIAgentNotes_SourceAIAgentRunID_CompanyID, @AIAgentNotes_SourceAIAgentRunID_EmbeddingVector, @AIAgentNotes_SourceAIAgentRunID_EmbeddingModelID, @AIAgentNotes_SourceAIAgentRunID_PrimaryScopeEntityID, @AIAgentNotes_SourceAIAgentRunID_PrimaryScopeRecordID, @AIAgentNotes_SourceAIAgentRunID_SecondaryScopes, @AIAgentNotes_SourceAIAgentRunID_LastAccessedAt, @AIAgentNotes_SourceAIAgentRunID_AccessCount, @AIAgentNotes_SourceAIAgentRunID_ExpiresAt
    END

    CLOSE cascade_update_AIAgentNotes_SourceAIAgentRunID_cursor
    DEALLOCATE cascade_update_AIAgentNotes_SourceAIAgentRunID_cursor
    
    -- Cascade update on AIAgentExample using cursor to call spUpdateAIAgentExample
    DECLARE @MJ_AIAgentExamples_SourceAIAgentRunIDID uniqueidentifier
    DECLARE @MJ_AIAgentExamples_SourceAIAgentRunID_AgentID uniqueidentifier
    DECLARE @MJ_AIAgentExamples_SourceAIAgentRunID_UserID uniqueidentifier
    DECLARE @MJ_AIAgentExamples_SourceAIAgentRunID_CompanyID uniqueidentifier
    DECLARE @MJ_AIAgentExamples_SourceAIAgentRunID_Type nvarchar(20)
    DECLARE @MJ_AIAgentExamples_SourceAIAgentRunID_ExampleInput nvarchar(MAX)
    DECLARE @MJ_AIAgentExamples_SourceAIAgentRunID_ExampleOutput nvarchar(MAX)
    DECLARE @MJ_AIAgentExamples_SourceAIAgentRunID_IsAutoGenerated bit
    DECLARE @MJ_AIAgentExamples_SourceAIAgentRunID_SourceConversationID uniqueidentifier
    DECLARE @MJ_AIAgentExamples_SourceAIAgentRunID_SourceConversationDetailID uniqueidentifier
    DECLARE @MJ_AIAgentExamples_SourceAIAgentRunID_SourceAIAgentRunID uniqueidentifier
    DECLARE @MJ_AIAgentExamples_SourceAIAgentRunID_SuccessScore decimal(5, 2)
    DECLARE @MJ_AIAgentExamples_SourceAIAgentRunID_Comments nvarchar(MAX)
    DECLARE @MJ_AIAgentExamples_SourceAIAgentRunID_Status nvarchar(20)
    DECLARE @MJ_AIAgentExamples_SourceAIAgentRunID_EmbeddingVector nvarchar(MAX)
    DECLARE @MJ_AIAgentExamples_SourceAIAgentRunID_EmbeddingModelID uniqueidentifier
    DECLARE @MJ_AIAgentExamples_SourceAIAgentRunID_PrimaryScopeEntityID uniqueidentifier
    DECLARE @MJ_AIAgentExamples_SourceAIAgentRunID_PrimaryScopeRecordID nvarchar(100)
    DECLARE @MJ_AIAgentExamples_SourceAIAgentRunID_SecondaryScopes nvarchar(MAX)
    DECLARE @MJ_AIAgentExamples_SourceAIAgentRunID_LastAccessedAt datetimeoffset
    DECLARE @MJ_AIAgentExamples_SourceAIAgentRunID_AccessCount int
    DECLARE @MJ_AIAgentExamples_SourceAIAgentRunID_ExpiresAt datetimeoffset
    DECLARE cascade_update_MJ_AIAgentExamples_SourceAIAgentRunID_cursor CURSOR FOR
        SELECT [ID], [AgentID], [UserID], [CompanyID], [Type], [ExampleInput], [ExampleOutput], [IsAutoGenerated], [SourceConversationID], [SourceConversationDetailID], [SourceAIAgentRunID], [SuccessScore], [Comments], [Status], [EmbeddingVector], [EmbeddingModelID], [PrimaryScopeEntityID], [PrimaryScopeRecordID], [SecondaryScopes], [LastAccessedAt], [AccessCount], [ExpiresAt]
        FROM [${flyway:defaultSchema}].[AIAgentExample]
        WHERE [SourceAIAgentRunID] = @ID

    OPEN cascade_update_MJ_AIAgentExamples_SourceAIAgentRunID_cursor
    FETCH NEXT FROM cascade_update_MJ_AIAgentExamples_SourceAIAgentRunID_cursor INTO @MJ_AIAgentExamples_SourceAIAgentRunIDID, @MJ_AIAgentExamples_SourceAIAgentRunID_AgentID, @MJ_AIAgentExamples_SourceAIAgentRunID_UserID, @MJ_AIAgentExamples_SourceAIAgentRunID_CompanyID, @MJ_AIAgentExamples_SourceAIAgentRunID_Type, @MJ_AIAgentExamples_SourceAIAgentRunID_ExampleInput, @MJ_AIAgentExamples_SourceAIAgentRunID_ExampleOutput, @MJ_AIAgentExamples_SourceAIAgentRunID_IsAutoGenerated, @MJ_AIAgentExamples_SourceAIAgentRunID_SourceConversationID, @MJ_AIAgentExamples_SourceAIAgentRunID_SourceConversationDetailID, @MJ_AIAgentExamples_SourceAIAgentRunID_SourceAIAgentRunID, @MJ_AIAgentExamples_SourceAIAgentRunID_SuccessScore, @MJ_AIAgentExamples_SourceAIAgentRunID_Comments, @MJ_AIAgentExamples_SourceAIAgentRunID_Status, @MJ_AIAgentExamples_SourceAIAgentRunID_EmbeddingVector, @MJ_AIAgentExamples_SourceAIAgentRunID_EmbeddingModelID, @MJ_AIAgentExamples_SourceAIAgentRunID_PrimaryScopeEntityID, @MJ_AIAgentExamples_SourceAIAgentRunID_PrimaryScopeRecordID, @MJ_AIAgentExamples_SourceAIAgentRunID_SecondaryScopes, @MJ_AIAgentExamples_SourceAIAgentRunID_LastAccessedAt, @MJ_AIAgentExamples_SourceAIAgentRunID_AccessCount, @MJ_AIAgentExamples_SourceAIAgentRunID_ExpiresAt

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @MJ_AIAgentExamples_SourceAIAgentRunID_SourceAIAgentRunID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateAIAgentExample] @ID = @MJ_AIAgentExamples_SourceAIAgentRunIDID, @AgentID = @MJ_AIAgentExamples_SourceAIAgentRunID_AgentID, @UserID = @MJ_AIAgentExamples_SourceAIAgentRunID_UserID, @CompanyID = @MJ_AIAgentExamples_SourceAIAgentRunID_CompanyID, @Type = @MJ_AIAgentExamples_SourceAIAgentRunID_Type, @ExampleInput = @MJ_AIAgentExamples_SourceAIAgentRunID_ExampleInput, @ExampleOutput = @MJ_AIAgentExamples_SourceAIAgentRunID_ExampleOutput, @IsAutoGenerated = @MJ_AIAgentExamples_SourceAIAgentRunID_IsAutoGenerated, @SourceConversationID = @MJ_AIAgentExamples_SourceAIAgentRunID_SourceConversationID, @SourceConversationDetailID = @MJ_AIAgentExamples_SourceAIAgentRunID_SourceConversationDetailID, @SourceAIAgentRunID = @MJ_AIAgentExamples_SourceAIAgentRunID_SourceAIAgentRunID, @SuccessScore = @MJ_AIAgentExamples_SourceAIAgentRunID_SuccessScore, @Comments = @MJ_AIAgentExamples_SourceAIAgentRunID_Comments, @Status = @MJ_AIAgentExamples_SourceAIAgentRunID_Status, @EmbeddingVector = @MJ_AIAgentExamples_SourceAIAgentRunID_EmbeddingVector, @EmbeddingModelID = @MJ_AIAgentExamples_SourceAIAgentRunID_EmbeddingModelID, @PrimaryScopeEntityID = @MJ_AIAgentExamples_SourceAIAgentRunID_PrimaryScopeEntityID, @PrimaryScopeRecordID = @MJ_AIAgentExamples_SourceAIAgentRunID_PrimaryScopeRecordID, @SecondaryScopes = @MJ_AIAgentExamples_SourceAIAgentRunID_SecondaryScopes, @LastAccessedAt = @MJ_AIAgentExamples_SourceAIAgentRunID_LastAccessedAt, @AccessCount = @MJ_AIAgentExamples_SourceAIAgentRunID_AccessCount, @ExpiresAt = @MJ_AIAgentExamples_SourceAIAgentRunID_ExpiresAt

        FETCH NEXT FROM cascade_update_MJ_AIAgentExamples_SourceAIAgentRunID_cursor INTO @MJ_AIAgentExamples_SourceAIAgentRunIDID, @MJ_AIAgentExamples_SourceAIAgentRunID_AgentID, @MJ_AIAgentExamples_SourceAIAgentRunID_UserID, @MJ_AIAgentExamples_SourceAIAgentRunID_CompanyID, @MJ_AIAgentExamples_SourceAIAgentRunID_Type, @MJ_AIAgentExamples_SourceAIAgentRunID_ExampleInput, @MJ_AIAgentExamples_SourceAIAgentRunID_ExampleOutput, @MJ_AIAgentExamples_SourceAIAgentRunID_IsAutoGenerated, @MJ_AIAgentExamples_SourceAIAgentRunID_SourceConversationID, @MJ_AIAgentExamples_SourceAIAgentRunID_SourceConversationDetailID, @MJ_AIAgentExamples_SourceAIAgentRunID_SourceAIAgentRunID, @MJ_AIAgentExamples_SourceAIAgentRunID_SuccessScore, @MJ_AIAgentExamples_SourceAIAgentRunID_Comments, @MJ_AIAgentExamples_SourceAIAgentRunID_Status, @MJ_AIAgentExamples_SourceAIAgentRunID_EmbeddingVector, @MJ_AIAgentExamples_SourceAIAgentRunID_EmbeddingModelID, @MJ_AIAgentExamples_SourceAIAgentRunID_PrimaryScopeEntityID, @MJ_AIAgentExamples_SourceAIAgentRunID_PrimaryScopeRecordID, @MJ_AIAgentExamples_SourceAIAgentRunID_SecondaryScopes, @MJ_AIAgentExamples_SourceAIAgentRunID_LastAccessedAt, @MJ_AIAgentExamples_SourceAIAgentRunID_AccessCount, @MJ_AIAgentExamples_SourceAIAgentRunID_ExpiresAt
    END

    CLOSE cascade_update_MJ_AIAgentExamples_SourceAIAgentRunID_cursor
    DEALLOCATE cascade_update_MJ_AIAgentExamples_SourceAIAgentRunID_cursor
    
    -- Cascade delete from AIAgentRunMedia using cursor to call spDeleteAIAgentRunMedia
    DECLARE @MJ_AIAgentRunMedias_AgentRunIDID uniqueidentifier
    DECLARE cascade_delete_MJ_AIAgentRunMedias_AgentRunID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[AIAgentRunMedia]
        WHERE [AgentRunID] = @ID
    
    OPEN cascade_delete_MJ_AIAgentRunMedias_AgentRunID_cursor
    FETCH NEXT FROM cascade_delete_MJ_AIAgentRunMedias_AgentRunID_cursor INTO @MJ_AIAgentRunMedias_AgentRunIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteAIAgentRunMedia] @ID = @MJ_AIAgentRunMedias_AgentRunIDID
        
        FETCH NEXT FROM cascade_delete_MJ_AIAgentRunMedias_AgentRunID_cursor INTO @MJ_AIAgentRunMedias_AgentRunIDID
    END
    
    CLOSE cascade_delete_MJ_AIAgentRunMedias_AgentRunID_cursor
    DEALLOCATE cascade_delete_MJ_AIAgentRunMedias_AgentRunID_cursor
    
    -- Cascade delete from AIAgentRunStep using cursor to call spDeleteAIAgentRunStep
    DECLARE @MJ_AIAgentRunSteps_AgentRunIDID uniqueidentifier
    DECLARE cascade_delete_MJ_AIAgentRunSteps_AgentRunID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[AIAgentRunStep]
        WHERE [AgentRunID] = @ID
    
    OPEN cascade_delete_MJ_AIAgentRunSteps_AgentRunID_cursor
    FETCH NEXT FROM cascade_delete_MJ_AIAgentRunSteps_AgentRunID_cursor INTO @MJ_AIAgentRunSteps_AgentRunIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteAIAgentRunStep] @ID = @MJ_AIAgentRunSteps_AgentRunIDID
        
        FETCH NEXT FROM cascade_delete_MJ_AIAgentRunSteps_AgentRunID_cursor INTO @MJ_AIAgentRunSteps_AgentRunIDID
    END
    
    CLOSE cascade_delete_MJ_AIAgentRunSteps_AgentRunID_cursor
    DEALLOCATE cascade_delete_MJ_AIAgentRunSteps_AgentRunID_cursor
    
    -- Cascade update on AIAgentRun using cursor to call spUpdateAIAgentRun
    DECLARE @MJ_AIAgentRuns_ParentRunIDID uniqueidentifier
    DECLARE @MJ_AIAgentRuns_ParentRunID_AgentID uniqueidentifier
    DECLARE @MJ_AIAgentRuns_ParentRunID_ParentRunID uniqueidentifier
    DECLARE @MJ_AIAgentRuns_ParentRunID_Status nvarchar(50)
    DECLARE @MJ_AIAgentRuns_ParentRunID_StartedAt datetimeoffset
    DECLARE @MJ_AIAgentRuns_ParentRunID_CompletedAt datetimeoffset
    DECLARE @MJ_AIAgentRuns_ParentRunID_Success bit
    DECLARE @MJ_AIAgentRuns_ParentRunID_ErrorMessage nvarchar(MAX)
    DECLARE @MJ_AIAgentRuns_ParentRunID_ConversationID uniqueidentifier
    DECLARE @MJ_AIAgentRuns_ParentRunID_UserID uniqueidentifier
    DECLARE @MJ_AIAgentRuns_ParentRunID_Result nvarchar(MAX)
    DECLARE @MJ_AIAgentRuns_ParentRunID_AgentState nvarchar(MAX)
    DECLARE @MJ_AIAgentRuns_ParentRunID_TotalTokensUsed int
    DECLARE @MJ_AIAgentRuns_ParentRunID_TotalCost decimal(18, 6)
    DECLARE @MJ_AIAgentRuns_ParentRunID_TotalPromptTokensUsed int
    DECLARE @MJ_AIAgentRuns_ParentRunID_TotalCompletionTokensUsed int
    DECLARE @MJ_AIAgentRuns_ParentRunID_TotalTokensUsedRollup int
    DECLARE @MJ_AIAgentRuns_ParentRunID_TotalPromptTokensUsedRollup int
    DECLARE @MJ_AIAgentRuns_ParentRunID_TotalCompletionTokensUsedRollup int
    DECLARE @MJ_AIAgentRuns_ParentRunID_TotalCostRollup decimal(19, 8)
    DECLARE @MJ_AIAgentRuns_ParentRunID_ConversationDetailID uniqueidentifier
    DECLARE @MJ_AIAgentRuns_ParentRunID_ConversationDetailSequence int
    DECLARE @MJ_AIAgentRuns_ParentRunID_CancellationReason nvarchar(30)
    DECLARE @MJ_AIAgentRuns_ParentRunID_FinalStep nvarchar(30)
    DECLARE @MJ_AIAgentRuns_ParentRunID_FinalPayload nvarchar(MAX)
    DECLARE @MJ_AIAgentRuns_ParentRunID_Message nvarchar(MAX)
    DECLARE @MJ_AIAgentRuns_ParentRunID_LastRunID uniqueidentifier
    DECLARE @MJ_AIAgentRuns_ParentRunID_StartingPayload nvarchar(MAX)
    DECLARE @MJ_AIAgentRuns_ParentRunID_TotalPromptIterations int
    DECLARE @MJ_AIAgentRuns_ParentRunID_ConfigurationID uniqueidentifier
    DECLARE @MJ_AIAgentRuns_ParentRunID_OverrideModelID uniqueidentifier
    DECLARE @MJ_AIAgentRuns_ParentRunID_OverrideVendorID uniqueidentifier
    DECLARE @MJ_AIAgentRuns_ParentRunID_Data nvarchar(MAX)
    DECLARE @MJ_AIAgentRuns_ParentRunID_Verbose bit
    DECLARE @MJ_AIAgentRuns_ParentRunID_EffortLevel int
    DECLARE @MJ_AIAgentRuns_ParentRunID_RunName nvarchar(255)
    DECLARE @MJ_AIAgentRuns_ParentRunID_Comments nvarchar(MAX)
    DECLARE @MJ_AIAgentRuns_ParentRunID_ScheduledJobRunID uniqueidentifier
    DECLARE @MJ_AIAgentRuns_ParentRunID_TestRunID uniqueidentifier
    DECLARE @MJ_AIAgentRuns_ParentRunID_PrimaryScopeEntityID uniqueidentifier
    DECLARE @MJ_AIAgentRuns_ParentRunID_PrimaryScopeRecordID nvarchar(100)
    DECLARE @MJ_AIAgentRuns_ParentRunID_SecondaryScopes nvarchar(MAX)
    DECLARE cascade_update_MJ_AIAgentRuns_ParentRunID_cursor CURSOR FOR
        SELECT [ID], [AgentID], [ParentRunID], [Status], [StartedAt], [CompletedAt], [Success], [ErrorMessage], [ConversationID], [UserID], [Result], [AgentState], [TotalTokensUsed], [TotalCost], [TotalPromptTokensUsed], [TotalCompletionTokensUsed], [TotalTokensUsedRollup], [TotalPromptTokensUsedRollup], [TotalCompletionTokensUsedRollup], [TotalCostRollup], [ConversationDetailID], [ConversationDetailSequence], [CancellationReason], [FinalStep], [FinalPayload], [Message], [LastRunID], [StartingPayload], [TotalPromptIterations], [ConfigurationID], [OverrideModelID], [OverrideVendorID], [Data], [Verbose], [EffortLevel], [RunName], [Comments], [ScheduledJobRunID], [TestRunID], [PrimaryScopeEntityID], [PrimaryScopeRecordID], [SecondaryScopes]
        FROM [${flyway:defaultSchema}].[AIAgentRun]
        WHERE [ParentRunID] = @ID

    OPEN cascade_update_MJ_AIAgentRuns_ParentRunID_cursor
    FETCH NEXT FROM cascade_update_MJ_AIAgentRuns_ParentRunID_cursor INTO @MJ_AIAgentRuns_ParentRunIDID, @MJ_AIAgentRuns_ParentRunID_AgentID, @MJ_AIAgentRuns_ParentRunID_ParentRunID, @MJ_AIAgentRuns_ParentRunID_Status, @MJ_AIAgentRuns_ParentRunID_StartedAt, @MJ_AIAgentRuns_ParentRunID_CompletedAt, @MJ_AIAgentRuns_ParentRunID_Success, @MJ_AIAgentRuns_ParentRunID_ErrorMessage, @MJ_AIAgentRuns_ParentRunID_ConversationID, @MJ_AIAgentRuns_ParentRunID_UserID, @MJ_AIAgentRuns_ParentRunID_Result, @MJ_AIAgentRuns_ParentRunID_AgentState, @MJ_AIAgentRuns_ParentRunID_TotalTokensUsed, @MJ_AIAgentRuns_ParentRunID_TotalCost, @MJ_AIAgentRuns_ParentRunID_TotalPromptTokensUsed, @MJ_AIAgentRuns_ParentRunID_TotalCompletionTokensUsed, @MJ_AIAgentRuns_ParentRunID_TotalTokensUsedRollup, @MJ_AIAgentRuns_ParentRunID_TotalPromptTokensUsedRollup, @MJ_AIAgentRuns_ParentRunID_TotalCompletionTokensUsedRollup, @MJ_AIAgentRuns_ParentRunID_TotalCostRollup, @MJ_AIAgentRuns_ParentRunID_ConversationDetailID, @MJ_AIAgentRuns_ParentRunID_ConversationDetailSequence, @MJ_AIAgentRuns_ParentRunID_CancellationReason, @MJ_AIAgentRuns_ParentRunID_FinalStep, @MJ_AIAgentRuns_ParentRunID_FinalPayload, @MJ_AIAgentRuns_ParentRunID_Message, @MJ_AIAgentRuns_ParentRunID_LastRunID, @MJ_AIAgentRuns_ParentRunID_StartingPayload, @MJ_AIAgentRuns_ParentRunID_TotalPromptIterations, @MJ_AIAgentRuns_ParentRunID_ConfigurationID, @MJ_AIAgentRuns_ParentRunID_OverrideModelID, @MJ_AIAgentRuns_ParentRunID_OverrideVendorID, @MJ_AIAgentRuns_ParentRunID_Data, @MJ_AIAgentRuns_ParentRunID_Verbose, @MJ_AIAgentRuns_ParentRunID_EffortLevel, @MJ_AIAgentRuns_ParentRunID_RunName, @MJ_AIAgentRuns_ParentRunID_Comments, @MJ_AIAgentRuns_ParentRunID_ScheduledJobRunID, @MJ_AIAgentRuns_ParentRunID_TestRunID, @MJ_AIAgentRuns_ParentRunID_PrimaryScopeEntityID, @MJ_AIAgentRuns_ParentRunID_PrimaryScopeRecordID, @MJ_AIAgentRuns_ParentRunID_SecondaryScopes

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @MJ_AIAgentRuns_ParentRunID_ParentRunID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateAIAgentRun] @ID = @MJ_AIAgentRuns_ParentRunIDID, @AgentID = @MJ_AIAgentRuns_ParentRunID_AgentID, @ParentRunID = @MJ_AIAgentRuns_ParentRunID_ParentRunID, @Status = @MJ_AIAgentRuns_ParentRunID_Status, @StartedAt = @MJ_AIAgentRuns_ParentRunID_StartedAt, @CompletedAt = @MJ_AIAgentRuns_ParentRunID_CompletedAt, @Success = @MJ_AIAgentRuns_ParentRunID_Success, @ErrorMessage = @MJ_AIAgentRuns_ParentRunID_ErrorMessage, @ConversationID = @MJ_AIAgentRuns_ParentRunID_ConversationID, @UserID = @MJ_AIAgentRuns_ParentRunID_UserID, @Result = @MJ_AIAgentRuns_ParentRunID_Result, @AgentState = @MJ_AIAgentRuns_ParentRunID_AgentState, @TotalTokensUsed = @MJ_AIAgentRuns_ParentRunID_TotalTokensUsed, @TotalCost = @MJ_AIAgentRuns_ParentRunID_TotalCost, @TotalPromptTokensUsed = @MJ_AIAgentRuns_ParentRunID_TotalPromptTokensUsed, @TotalCompletionTokensUsed = @MJ_AIAgentRuns_ParentRunID_TotalCompletionTokensUsed, @TotalTokensUsedRollup = @MJ_AIAgentRuns_ParentRunID_TotalTokensUsedRollup, @TotalPromptTokensUsedRollup = @MJ_AIAgentRuns_ParentRunID_TotalPromptTokensUsedRollup, @TotalCompletionTokensUsedRollup = @MJ_AIAgentRuns_ParentRunID_TotalCompletionTokensUsedRollup, @TotalCostRollup = @MJ_AIAgentRuns_ParentRunID_TotalCostRollup, @ConversationDetailID = @MJ_AIAgentRuns_ParentRunID_ConversationDetailID, @ConversationDetailSequence = @MJ_AIAgentRuns_ParentRunID_ConversationDetailSequence, @CancellationReason = @MJ_AIAgentRuns_ParentRunID_CancellationReason, @FinalStep = @MJ_AIAgentRuns_ParentRunID_FinalStep, @FinalPayload = @MJ_AIAgentRuns_ParentRunID_FinalPayload, @Message = @MJ_AIAgentRuns_ParentRunID_Message, @LastRunID = @MJ_AIAgentRuns_ParentRunID_LastRunID, @StartingPayload = @MJ_AIAgentRuns_ParentRunID_StartingPayload, @TotalPromptIterations = @MJ_AIAgentRuns_ParentRunID_TotalPromptIterations, @ConfigurationID = @MJ_AIAgentRuns_ParentRunID_ConfigurationID, @OverrideModelID = @MJ_AIAgentRuns_ParentRunID_OverrideModelID, @OverrideVendorID = @MJ_AIAgentRuns_ParentRunID_OverrideVendorID, @Data = @MJ_AIAgentRuns_ParentRunID_Data, @Verbose = @MJ_AIAgentRuns_ParentRunID_Verbose, @EffortLevel = @MJ_AIAgentRuns_ParentRunID_EffortLevel, @RunName = @MJ_AIAgentRuns_ParentRunID_RunName, @Comments = @MJ_AIAgentRuns_ParentRunID_Comments, @ScheduledJobRunID = @MJ_AIAgentRuns_ParentRunID_ScheduledJobRunID, @TestRunID = @MJ_AIAgentRuns_ParentRunID_TestRunID, @PrimaryScopeEntityID = @MJ_AIAgentRuns_ParentRunID_PrimaryScopeEntityID, @PrimaryScopeRecordID = @MJ_AIAgentRuns_ParentRunID_PrimaryScopeRecordID, @SecondaryScopes = @MJ_AIAgentRuns_ParentRunID_SecondaryScopes

        FETCH NEXT FROM cascade_update_MJ_AIAgentRuns_ParentRunID_cursor INTO @MJ_AIAgentRuns_ParentRunIDID, @MJ_AIAgentRuns_ParentRunID_AgentID, @MJ_AIAgentRuns_ParentRunID_ParentRunID, @MJ_AIAgentRuns_ParentRunID_Status, @MJ_AIAgentRuns_ParentRunID_StartedAt, @MJ_AIAgentRuns_ParentRunID_CompletedAt, @MJ_AIAgentRuns_ParentRunID_Success, @MJ_AIAgentRuns_ParentRunID_ErrorMessage, @MJ_AIAgentRuns_ParentRunID_ConversationID, @MJ_AIAgentRuns_ParentRunID_UserID, @MJ_AIAgentRuns_ParentRunID_Result, @MJ_AIAgentRuns_ParentRunID_AgentState, @MJ_AIAgentRuns_ParentRunID_TotalTokensUsed, @MJ_AIAgentRuns_ParentRunID_TotalCost, @MJ_AIAgentRuns_ParentRunID_TotalPromptTokensUsed, @MJ_AIAgentRuns_ParentRunID_TotalCompletionTokensUsed, @MJ_AIAgentRuns_ParentRunID_TotalTokensUsedRollup, @MJ_AIAgentRuns_ParentRunID_TotalPromptTokensUsedRollup, @MJ_AIAgentRuns_ParentRunID_TotalCompletionTokensUsedRollup, @MJ_AIAgentRuns_ParentRunID_TotalCostRollup, @MJ_AIAgentRuns_ParentRunID_ConversationDetailID, @MJ_AIAgentRuns_ParentRunID_ConversationDetailSequence, @MJ_AIAgentRuns_ParentRunID_CancellationReason, @MJ_AIAgentRuns_ParentRunID_FinalStep, @MJ_AIAgentRuns_ParentRunID_FinalPayload, @MJ_AIAgentRuns_ParentRunID_Message, @MJ_AIAgentRuns_ParentRunID_LastRunID, @MJ_AIAgentRuns_ParentRunID_StartingPayload, @MJ_AIAgentRuns_ParentRunID_TotalPromptIterations, @MJ_AIAgentRuns_ParentRunID_ConfigurationID, @MJ_AIAgentRuns_ParentRunID_OverrideModelID, @MJ_AIAgentRuns_ParentRunID_OverrideVendorID, @MJ_AIAgentRuns_ParentRunID_Data, @MJ_AIAgentRuns_ParentRunID_Verbose, @MJ_AIAgentRuns_ParentRunID_EffortLevel, @MJ_AIAgentRuns_ParentRunID_RunName, @MJ_AIAgentRuns_ParentRunID_Comments, @MJ_AIAgentRuns_ParentRunID_ScheduledJobRunID, @MJ_AIAgentRuns_ParentRunID_TestRunID, @MJ_AIAgentRuns_ParentRunID_PrimaryScopeEntityID, @MJ_AIAgentRuns_ParentRunID_PrimaryScopeRecordID, @MJ_AIAgentRuns_ParentRunID_SecondaryScopes
    END

    CLOSE cascade_update_MJ_AIAgentRuns_ParentRunID_cursor
    DEALLOCATE cascade_update_MJ_AIAgentRuns_ParentRunID_cursor
    
    -- Cascade update on AIAgentRun using cursor to call spUpdateAIAgentRun
    DECLARE @MJ_AIAgentRuns_LastRunIDID uniqueidentifier
    DECLARE @MJ_AIAgentRuns_LastRunID_AgentID uniqueidentifier
    DECLARE @MJ_AIAgentRuns_LastRunID_ParentRunID uniqueidentifier
    DECLARE @MJ_AIAgentRuns_LastRunID_Status nvarchar(50)
    DECLARE @MJ_AIAgentRuns_LastRunID_StartedAt datetimeoffset
    DECLARE @MJ_AIAgentRuns_LastRunID_CompletedAt datetimeoffset
    DECLARE @MJ_AIAgentRuns_LastRunID_Success bit
    DECLARE @MJ_AIAgentRuns_LastRunID_ErrorMessage nvarchar(MAX)
    DECLARE @MJ_AIAgentRuns_LastRunID_ConversationID uniqueidentifier
    DECLARE @MJ_AIAgentRuns_LastRunID_UserID uniqueidentifier
    DECLARE @MJ_AIAgentRuns_LastRunID_Result nvarchar(MAX)
    DECLARE @MJ_AIAgentRuns_LastRunID_AgentState nvarchar(MAX)
    DECLARE @MJ_AIAgentRuns_LastRunID_TotalTokensUsed int
    DECLARE @MJ_AIAgentRuns_LastRunID_TotalCost decimal(18, 6)
    DECLARE @MJ_AIAgentRuns_LastRunID_TotalPromptTokensUsed int
    DECLARE @MJ_AIAgentRuns_LastRunID_TotalCompletionTokensUsed int
    DECLARE @MJ_AIAgentRuns_LastRunID_TotalTokensUsedRollup int
    DECLARE @MJ_AIAgentRuns_LastRunID_TotalPromptTokensUsedRollup int
    DECLARE @MJ_AIAgentRuns_LastRunID_TotalCompletionTokensUsedRollup int
    DECLARE @MJ_AIAgentRuns_LastRunID_TotalCostRollup decimal(19, 8)
    DECLARE @MJ_AIAgentRuns_LastRunID_ConversationDetailID uniqueidentifier
    DECLARE @MJ_AIAgentRuns_LastRunID_ConversationDetailSequence int
    DECLARE @MJ_AIAgentRuns_LastRunID_CancellationReason nvarchar(30)
    DECLARE @MJ_AIAgentRuns_LastRunID_FinalStep nvarchar(30)
    DECLARE @MJ_AIAgentRuns_LastRunID_FinalPayload nvarchar(MAX)
    DECLARE @MJ_AIAgentRuns_LastRunID_Message nvarchar(MAX)
    DECLARE @MJ_AIAgentRuns_LastRunID_LastRunID uniqueidentifier
    DECLARE @MJ_AIAgentRuns_LastRunID_StartingPayload nvarchar(MAX)
    DECLARE @MJ_AIAgentRuns_LastRunID_TotalPromptIterations int
    DECLARE @MJ_AIAgentRuns_LastRunID_ConfigurationID uniqueidentifier
    DECLARE @MJ_AIAgentRuns_LastRunID_OverrideModelID uniqueidentifier
    DECLARE @MJ_AIAgentRuns_LastRunID_OverrideVendorID uniqueidentifier
    DECLARE @MJ_AIAgentRuns_LastRunID_Data nvarchar(MAX)
    DECLARE @MJ_AIAgentRuns_LastRunID_Verbose bit
    DECLARE @MJ_AIAgentRuns_LastRunID_EffortLevel int
    DECLARE @MJ_AIAgentRuns_LastRunID_RunName nvarchar(255)
    DECLARE @MJ_AIAgentRuns_LastRunID_Comments nvarchar(MAX)
    DECLARE @MJ_AIAgentRuns_LastRunID_ScheduledJobRunID uniqueidentifier
    DECLARE @MJ_AIAgentRuns_LastRunID_TestRunID uniqueidentifier
    DECLARE @MJ_AIAgentRuns_LastRunID_PrimaryScopeEntityID uniqueidentifier
    DECLARE @MJ_AIAgentRuns_LastRunID_PrimaryScopeRecordID nvarchar(100)
    DECLARE @MJ_AIAgentRuns_LastRunID_SecondaryScopes nvarchar(MAX)
    DECLARE cascade_update_MJ_AIAgentRuns_LastRunID_cursor CURSOR FOR
        SELECT [ID], [AgentID], [ParentRunID], [Status], [StartedAt], [CompletedAt], [Success], [ErrorMessage], [ConversationID], [UserID], [Result], [AgentState], [TotalTokensUsed], [TotalCost], [TotalPromptTokensUsed], [TotalCompletionTokensUsed], [TotalTokensUsedRollup], [TotalPromptTokensUsedRollup], [TotalCompletionTokensUsedRollup], [TotalCostRollup], [ConversationDetailID], [ConversationDetailSequence], [CancellationReason], [FinalStep], [FinalPayload], [Message], [LastRunID], [StartingPayload], [TotalPromptIterations], [ConfigurationID], [OverrideModelID], [OverrideVendorID], [Data], [Verbose], [EffortLevel], [RunName], [Comments], [ScheduledJobRunID], [TestRunID], [PrimaryScopeEntityID], [PrimaryScopeRecordID], [SecondaryScopes]
        FROM [${flyway:defaultSchema}].[AIAgentRun]
        WHERE [LastRunID] = @ID

    OPEN cascade_update_MJ_AIAgentRuns_LastRunID_cursor
    FETCH NEXT FROM cascade_update_MJ_AIAgentRuns_LastRunID_cursor INTO @MJ_AIAgentRuns_LastRunIDID, @MJ_AIAgentRuns_LastRunID_AgentID, @MJ_AIAgentRuns_LastRunID_ParentRunID, @MJ_AIAgentRuns_LastRunID_Status, @MJ_AIAgentRuns_LastRunID_StartedAt, @MJ_AIAgentRuns_LastRunID_CompletedAt, @MJ_AIAgentRuns_LastRunID_Success, @MJ_AIAgentRuns_LastRunID_ErrorMessage, @MJ_AIAgentRuns_LastRunID_ConversationID, @MJ_AIAgentRuns_LastRunID_UserID, @MJ_AIAgentRuns_LastRunID_Result, @MJ_AIAgentRuns_LastRunID_AgentState, @MJ_AIAgentRuns_LastRunID_TotalTokensUsed, @MJ_AIAgentRuns_LastRunID_TotalCost, @MJ_AIAgentRuns_LastRunID_TotalPromptTokensUsed, @MJ_AIAgentRuns_LastRunID_TotalCompletionTokensUsed, @MJ_AIAgentRuns_LastRunID_TotalTokensUsedRollup, @MJ_AIAgentRuns_LastRunID_TotalPromptTokensUsedRollup, @MJ_AIAgentRuns_LastRunID_TotalCompletionTokensUsedRollup, @MJ_AIAgentRuns_LastRunID_TotalCostRollup, @MJ_AIAgentRuns_LastRunID_ConversationDetailID, @MJ_AIAgentRuns_LastRunID_ConversationDetailSequence, @MJ_AIAgentRuns_LastRunID_CancellationReason, @MJ_AIAgentRuns_LastRunID_FinalStep, @MJ_AIAgentRuns_LastRunID_FinalPayload, @MJ_AIAgentRuns_LastRunID_Message, @MJ_AIAgentRuns_LastRunID_LastRunID, @MJ_AIAgentRuns_LastRunID_StartingPayload, @MJ_AIAgentRuns_LastRunID_TotalPromptIterations, @MJ_AIAgentRuns_LastRunID_ConfigurationID, @MJ_AIAgentRuns_LastRunID_OverrideModelID, @MJ_AIAgentRuns_LastRunID_OverrideVendorID, @MJ_AIAgentRuns_LastRunID_Data, @MJ_AIAgentRuns_LastRunID_Verbose, @MJ_AIAgentRuns_LastRunID_EffortLevel, @MJ_AIAgentRuns_LastRunID_RunName, @MJ_AIAgentRuns_LastRunID_Comments, @MJ_AIAgentRuns_LastRunID_ScheduledJobRunID, @MJ_AIAgentRuns_LastRunID_TestRunID, @MJ_AIAgentRuns_LastRunID_PrimaryScopeEntityID, @MJ_AIAgentRuns_LastRunID_PrimaryScopeRecordID, @MJ_AIAgentRuns_LastRunID_SecondaryScopes

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @MJ_AIAgentRuns_LastRunID_LastRunID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateAIAgentRun] @ID = @MJ_AIAgentRuns_LastRunIDID, @AgentID = @MJ_AIAgentRuns_LastRunID_AgentID, @ParentRunID = @MJ_AIAgentRuns_LastRunID_ParentRunID, @Status = @MJ_AIAgentRuns_LastRunID_Status, @StartedAt = @MJ_AIAgentRuns_LastRunID_StartedAt, @CompletedAt = @MJ_AIAgentRuns_LastRunID_CompletedAt, @Success = @MJ_AIAgentRuns_LastRunID_Success, @ErrorMessage = @MJ_AIAgentRuns_LastRunID_ErrorMessage, @ConversationID = @MJ_AIAgentRuns_LastRunID_ConversationID, @UserID = @MJ_AIAgentRuns_LastRunID_UserID, @Result = @MJ_AIAgentRuns_LastRunID_Result, @AgentState = @MJ_AIAgentRuns_LastRunID_AgentState, @TotalTokensUsed = @MJ_AIAgentRuns_LastRunID_TotalTokensUsed, @TotalCost = @MJ_AIAgentRuns_LastRunID_TotalCost, @TotalPromptTokensUsed = @MJ_AIAgentRuns_LastRunID_TotalPromptTokensUsed, @TotalCompletionTokensUsed = @MJ_AIAgentRuns_LastRunID_TotalCompletionTokensUsed, @TotalTokensUsedRollup = @MJ_AIAgentRuns_LastRunID_TotalTokensUsedRollup, @TotalPromptTokensUsedRollup = @MJ_AIAgentRuns_LastRunID_TotalPromptTokensUsedRollup, @TotalCompletionTokensUsedRollup = @MJ_AIAgentRuns_LastRunID_TotalCompletionTokensUsedRollup, @TotalCostRollup = @MJ_AIAgentRuns_LastRunID_TotalCostRollup, @ConversationDetailID = @MJ_AIAgentRuns_LastRunID_ConversationDetailID, @ConversationDetailSequence = @MJ_AIAgentRuns_LastRunID_ConversationDetailSequence, @CancellationReason = @MJ_AIAgentRuns_LastRunID_CancellationReason, @FinalStep = @MJ_AIAgentRuns_LastRunID_FinalStep, @FinalPayload = @MJ_AIAgentRuns_LastRunID_FinalPayload, @Message = @MJ_AIAgentRuns_LastRunID_Message, @LastRunID = @MJ_AIAgentRuns_LastRunID_LastRunID, @StartingPayload = @MJ_AIAgentRuns_LastRunID_StartingPayload, @TotalPromptIterations = @MJ_AIAgentRuns_LastRunID_TotalPromptIterations, @ConfigurationID = @MJ_AIAgentRuns_LastRunID_ConfigurationID, @OverrideModelID = @MJ_AIAgentRuns_LastRunID_OverrideModelID, @OverrideVendorID = @MJ_AIAgentRuns_LastRunID_OverrideVendorID, @Data = @MJ_AIAgentRuns_LastRunID_Data, @Verbose = @MJ_AIAgentRuns_LastRunID_Verbose, @EffortLevel = @MJ_AIAgentRuns_LastRunID_EffortLevel, @RunName = @MJ_AIAgentRuns_LastRunID_RunName, @Comments = @MJ_AIAgentRuns_LastRunID_Comments, @ScheduledJobRunID = @MJ_AIAgentRuns_LastRunID_ScheduledJobRunID, @TestRunID = @MJ_AIAgentRuns_LastRunID_TestRunID, @PrimaryScopeEntityID = @MJ_AIAgentRuns_LastRunID_PrimaryScopeEntityID, @PrimaryScopeRecordID = @MJ_AIAgentRuns_LastRunID_PrimaryScopeRecordID, @SecondaryScopes = @MJ_AIAgentRuns_LastRunID_SecondaryScopes

        FETCH NEXT FROM cascade_update_MJ_AIAgentRuns_LastRunID_cursor INTO @MJ_AIAgentRuns_LastRunIDID, @MJ_AIAgentRuns_LastRunID_AgentID, @MJ_AIAgentRuns_LastRunID_ParentRunID, @MJ_AIAgentRuns_LastRunID_Status, @MJ_AIAgentRuns_LastRunID_StartedAt, @MJ_AIAgentRuns_LastRunID_CompletedAt, @MJ_AIAgentRuns_LastRunID_Success, @MJ_AIAgentRuns_LastRunID_ErrorMessage, @MJ_AIAgentRuns_LastRunID_ConversationID, @MJ_AIAgentRuns_LastRunID_UserID, @MJ_AIAgentRuns_LastRunID_Result, @MJ_AIAgentRuns_LastRunID_AgentState, @MJ_AIAgentRuns_LastRunID_TotalTokensUsed, @MJ_AIAgentRuns_LastRunID_TotalCost, @MJ_AIAgentRuns_LastRunID_TotalPromptTokensUsed, @MJ_AIAgentRuns_LastRunID_TotalCompletionTokensUsed, @MJ_AIAgentRuns_LastRunID_TotalTokensUsedRollup, @MJ_AIAgentRuns_LastRunID_TotalPromptTokensUsedRollup, @MJ_AIAgentRuns_LastRunID_TotalCompletionTokensUsedRollup, @MJ_AIAgentRuns_LastRunID_TotalCostRollup, @MJ_AIAgentRuns_LastRunID_ConversationDetailID, @MJ_AIAgentRuns_LastRunID_ConversationDetailSequence, @MJ_AIAgentRuns_LastRunID_CancellationReason, @MJ_AIAgentRuns_LastRunID_FinalStep, @MJ_AIAgentRuns_LastRunID_FinalPayload, @MJ_AIAgentRuns_LastRunID_Message, @MJ_AIAgentRuns_LastRunID_LastRunID, @MJ_AIAgentRuns_LastRunID_StartingPayload, @MJ_AIAgentRuns_LastRunID_TotalPromptIterations, @MJ_AIAgentRuns_LastRunID_ConfigurationID, @MJ_AIAgentRuns_LastRunID_OverrideModelID, @MJ_AIAgentRuns_LastRunID_OverrideVendorID, @MJ_AIAgentRuns_LastRunID_Data, @MJ_AIAgentRuns_LastRunID_Verbose, @MJ_AIAgentRuns_LastRunID_EffortLevel, @MJ_AIAgentRuns_LastRunID_RunName, @MJ_AIAgentRuns_LastRunID_Comments, @MJ_AIAgentRuns_LastRunID_ScheduledJobRunID, @MJ_AIAgentRuns_LastRunID_TestRunID, @MJ_AIAgentRuns_LastRunID_PrimaryScopeEntityID, @MJ_AIAgentRuns_LastRunID_PrimaryScopeRecordID, @MJ_AIAgentRuns_LastRunID_SecondaryScopes
    END

    CLOSE cascade_update_MJ_AIAgentRuns_LastRunID_cursor
    DEALLOCATE cascade_update_MJ_AIAgentRuns_LastRunID_cursor
    
    -- Cascade update on AIPromptRun using cursor to call spUpdateAIPromptRun
    DECLARE @MJ_AIPromptRuns_AgentRunIDID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_AgentRunID_PromptID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_AgentRunID_ModelID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_AgentRunID_VendorID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_AgentRunID_AgentID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_AgentRunID_ConfigurationID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_AgentRunID_RunAt datetimeoffset
    DECLARE @MJ_AIPromptRuns_AgentRunID_CompletedAt datetimeoffset
    DECLARE @MJ_AIPromptRuns_AgentRunID_ExecutionTimeMS int
    DECLARE @MJ_AIPromptRuns_AgentRunID_Messages nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_AgentRunID_Result nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_AgentRunID_TokensUsed int
    DECLARE @MJ_AIPromptRuns_AgentRunID_TokensPrompt int
    DECLARE @MJ_AIPromptRuns_AgentRunID_TokensCompletion int
    DECLARE @MJ_AIPromptRuns_AgentRunID_TotalCost decimal(18, 6)
    DECLARE @MJ_AIPromptRuns_AgentRunID_Success bit
    DECLARE @MJ_AIPromptRuns_AgentRunID_ErrorMessage nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_AgentRunID_ParentID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_AgentRunID_RunType nvarchar(20)
    DECLARE @MJ_AIPromptRuns_AgentRunID_ExecutionOrder int
    DECLARE @MJ_AIPromptRuns_AgentRunID_AgentRunID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_AgentRunID_Cost decimal(19, 8)
    DECLARE @MJ_AIPromptRuns_AgentRunID_CostCurrency nvarchar(10)
    DECLARE @MJ_AIPromptRuns_AgentRunID_TokensUsedRollup int
    DECLARE @MJ_AIPromptRuns_AgentRunID_TokensPromptRollup int
    DECLARE @MJ_AIPromptRuns_AgentRunID_TokensCompletionRollup int
    DECLARE @MJ_AIPromptRuns_AgentRunID_Temperature decimal(3, 2)
    DECLARE @MJ_AIPromptRuns_AgentRunID_TopP decimal(3, 2)
    DECLARE @MJ_AIPromptRuns_AgentRunID_TopK int
    DECLARE @MJ_AIPromptRuns_AgentRunID_MinP decimal(3, 2)
    DECLARE @MJ_AIPromptRuns_AgentRunID_FrequencyPenalty decimal(3, 2)
    DECLARE @MJ_AIPromptRuns_AgentRunID_PresencePenalty decimal(3, 2)
    DECLARE @MJ_AIPromptRuns_AgentRunID_Seed int
    DECLARE @MJ_AIPromptRuns_AgentRunID_StopSequences nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_AgentRunID_ResponseFormat nvarchar(50)
    DECLARE @MJ_AIPromptRuns_AgentRunID_LogProbs bit
    DECLARE @MJ_AIPromptRuns_AgentRunID_TopLogProbs int
    DECLARE @MJ_AIPromptRuns_AgentRunID_DescendantCost decimal(18, 6)
    DECLARE @MJ_AIPromptRuns_AgentRunID_ValidationAttemptCount int
    DECLARE @MJ_AIPromptRuns_AgentRunID_SuccessfulValidationCount int
    DECLARE @MJ_AIPromptRuns_AgentRunID_FinalValidationPassed bit
    DECLARE @MJ_AIPromptRuns_AgentRunID_ValidationBehavior nvarchar(50)
    DECLARE @MJ_AIPromptRuns_AgentRunID_RetryStrategy nvarchar(50)
    DECLARE @MJ_AIPromptRuns_AgentRunID_MaxRetriesConfigured int
    DECLARE @MJ_AIPromptRuns_AgentRunID_FinalValidationError nvarchar(500)
    DECLARE @MJ_AIPromptRuns_AgentRunID_ValidationErrorCount int
    DECLARE @MJ_AIPromptRuns_AgentRunID_CommonValidationError nvarchar(255)
    DECLARE @MJ_AIPromptRuns_AgentRunID_FirstAttemptAt datetimeoffset
    DECLARE @MJ_AIPromptRuns_AgentRunID_LastAttemptAt datetimeoffset
    DECLARE @MJ_AIPromptRuns_AgentRunID_TotalRetryDurationMS int
    DECLARE @MJ_AIPromptRuns_AgentRunID_ValidationAttempts nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_AgentRunID_ValidationSummary nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_AgentRunID_FailoverAttempts int
    DECLARE @MJ_AIPromptRuns_AgentRunID_FailoverErrors nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_AgentRunID_FailoverDurations nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_AgentRunID_OriginalModelID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_AgentRunID_OriginalRequestStartTime datetimeoffset
    DECLARE @MJ_AIPromptRuns_AgentRunID_TotalFailoverDuration int
    DECLARE @MJ_AIPromptRuns_AgentRunID_RerunFromPromptRunID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_AgentRunID_ModelSelection nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_AgentRunID_Status nvarchar(50)
    DECLARE @MJ_AIPromptRuns_AgentRunID_Cancelled bit
    DECLARE @MJ_AIPromptRuns_AgentRunID_CancellationReason nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_AgentRunID_ModelPowerRank int
    DECLARE @MJ_AIPromptRuns_AgentRunID_SelectionStrategy nvarchar(50)
    DECLARE @MJ_AIPromptRuns_AgentRunID_CacheHit bit
    DECLARE @MJ_AIPromptRuns_AgentRunID_CacheKey nvarchar(500)
    DECLARE @MJ_AIPromptRuns_AgentRunID_JudgeID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_AgentRunID_JudgeScore float(53)
    DECLARE @MJ_AIPromptRuns_AgentRunID_WasSelectedResult bit
    DECLARE @MJ_AIPromptRuns_AgentRunID_StreamingEnabled bit
    DECLARE @MJ_AIPromptRuns_AgentRunID_FirstTokenTime int
    DECLARE @MJ_AIPromptRuns_AgentRunID_ErrorDetails nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_AgentRunID_ChildPromptID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_AgentRunID_QueueTime int
    DECLARE @MJ_AIPromptRuns_AgentRunID_PromptTime int
    DECLARE @MJ_AIPromptRuns_AgentRunID_CompletionTime int
    DECLARE @MJ_AIPromptRuns_AgentRunID_ModelSpecificResponseDetails nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_AgentRunID_EffortLevel int
    DECLARE @MJ_AIPromptRuns_AgentRunID_RunName nvarchar(255)
    DECLARE @MJ_AIPromptRuns_AgentRunID_Comments nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_AgentRunID_TestRunID uniqueidentifier
    DECLARE cascade_update_MJ_AIPromptRuns_AgentRunID_cursor CURSOR FOR
        SELECT [ID], [PromptID], [ModelID], [VendorID], [AgentID], [ConfigurationID], [RunAt], [CompletedAt], [ExecutionTimeMS], [Messages], [Result], [TokensUsed], [TokensPrompt], [TokensCompletion], [TotalCost], [Success], [ErrorMessage], [ParentID], [RunType], [ExecutionOrder], [AgentRunID], [Cost], [CostCurrency], [TokensUsedRollup], [TokensPromptRollup], [TokensCompletionRollup], [Temperature], [TopP], [TopK], [MinP], [FrequencyPenalty], [PresencePenalty], [Seed], [StopSequences], [ResponseFormat], [LogProbs], [TopLogProbs], [DescendantCost], [ValidationAttemptCount], [SuccessfulValidationCount], [FinalValidationPassed], [ValidationBehavior], [RetryStrategy], [MaxRetriesConfigured], [FinalValidationError], [ValidationErrorCount], [CommonValidationError], [FirstAttemptAt], [LastAttemptAt], [TotalRetryDurationMS], [ValidationAttempts], [ValidationSummary], [FailoverAttempts], [FailoverErrors], [FailoverDurations], [OriginalModelID], [OriginalRequestStartTime], [TotalFailoverDuration], [RerunFromPromptRunID], [ModelSelection], [Status], [Cancelled], [CancellationReason], [ModelPowerRank], [SelectionStrategy], [CacheHit], [CacheKey], [JudgeID], [JudgeScore], [WasSelectedResult], [StreamingEnabled], [FirstTokenTime], [ErrorDetails], [ChildPromptID], [QueueTime], [PromptTime], [CompletionTime], [ModelSpecificResponseDetails], [EffortLevel], [RunName], [Comments], [TestRunID]
        FROM [${flyway:defaultSchema}].[AIPromptRun]
        WHERE [AgentRunID] = @ID

    OPEN cascade_update_MJ_AIPromptRuns_AgentRunID_cursor
    FETCH NEXT FROM cascade_update_MJ_AIPromptRuns_AgentRunID_cursor INTO @MJ_AIPromptRuns_AgentRunIDID, @MJ_AIPromptRuns_AgentRunID_PromptID, @MJ_AIPromptRuns_AgentRunID_ModelID, @MJ_AIPromptRuns_AgentRunID_VendorID, @MJ_AIPromptRuns_AgentRunID_AgentID, @MJ_AIPromptRuns_AgentRunID_ConfigurationID, @MJ_AIPromptRuns_AgentRunID_RunAt, @MJ_AIPromptRuns_AgentRunID_CompletedAt, @MJ_AIPromptRuns_AgentRunID_ExecutionTimeMS, @MJ_AIPromptRuns_AgentRunID_Messages, @MJ_AIPromptRuns_AgentRunID_Result, @MJ_AIPromptRuns_AgentRunID_TokensUsed, @MJ_AIPromptRuns_AgentRunID_TokensPrompt, @MJ_AIPromptRuns_AgentRunID_TokensCompletion, @MJ_AIPromptRuns_AgentRunID_TotalCost, @MJ_AIPromptRuns_AgentRunID_Success, @MJ_AIPromptRuns_AgentRunID_ErrorMessage, @MJ_AIPromptRuns_AgentRunID_ParentID, @MJ_AIPromptRuns_AgentRunID_RunType, @MJ_AIPromptRuns_AgentRunID_ExecutionOrder, @MJ_AIPromptRuns_AgentRunID_AgentRunID, @MJ_AIPromptRuns_AgentRunID_Cost, @MJ_AIPromptRuns_AgentRunID_CostCurrency, @MJ_AIPromptRuns_AgentRunID_TokensUsedRollup, @MJ_AIPromptRuns_AgentRunID_TokensPromptRollup, @MJ_AIPromptRuns_AgentRunID_TokensCompletionRollup, @MJ_AIPromptRuns_AgentRunID_Temperature, @MJ_AIPromptRuns_AgentRunID_TopP, @MJ_AIPromptRuns_AgentRunID_TopK, @MJ_AIPromptRuns_AgentRunID_MinP, @MJ_AIPromptRuns_AgentRunID_FrequencyPenalty, @MJ_AIPromptRuns_AgentRunID_PresencePenalty, @MJ_AIPromptRuns_AgentRunID_Seed, @MJ_AIPromptRuns_AgentRunID_StopSequences, @MJ_AIPromptRuns_AgentRunID_ResponseFormat, @MJ_AIPromptRuns_AgentRunID_LogProbs, @MJ_AIPromptRuns_AgentRunID_TopLogProbs, @MJ_AIPromptRuns_AgentRunID_DescendantCost, @MJ_AIPromptRuns_AgentRunID_ValidationAttemptCount, @MJ_AIPromptRuns_AgentRunID_SuccessfulValidationCount, @MJ_AIPromptRuns_AgentRunID_FinalValidationPassed, @MJ_AIPromptRuns_AgentRunID_ValidationBehavior, @MJ_AIPromptRuns_AgentRunID_RetryStrategy, @MJ_AIPromptRuns_AgentRunID_MaxRetriesConfigured, @MJ_AIPromptRuns_AgentRunID_FinalValidationError, @MJ_AIPromptRuns_AgentRunID_ValidationErrorCount, @MJ_AIPromptRuns_AgentRunID_CommonValidationError, @MJ_AIPromptRuns_AgentRunID_FirstAttemptAt, @MJ_AIPromptRuns_AgentRunID_LastAttemptAt, @MJ_AIPromptRuns_AgentRunID_TotalRetryDurationMS, @MJ_AIPromptRuns_AgentRunID_ValidationAttempts, @MJ_AIPromptRuns_AgentRunID_ValidationSummary, @MJ_AIPromptRuns_AgentRunID_FailoverAttempts, @MJ_AIPromptRuns_AgentRunID_FailoverErrors, @MJ_AIPromptRuns_AgentRunID_FailoverDurations, @MJ_AIPromptRuns_AgentRunID_OriginalModelID, @MJ_AIPromptRuns_AgentRunID_OriginalRequestStartTime, @MJ_AIPromptRuns_AgentRunID_TotalFailoverDuration, @MJ_AIPromptRuns_AgentRunID_RerunFromPromptRunID, @MJ_AIPromptRuns_AgentRunID_ModelSelection, @MJ_AIPromptRuns_AgentRunID_Status, @MJ_AIPromptRuns_AgentRunID_Cancelled, @MJ_AIPromptRuns_AgentRunID_CancellationReason, @MJ_AIPromptRuns_AgentRunID_ModelPowerRank, @MJ_AIPromptRuns_AgentRunID_SelectionStrategy, @MJ_AIPromptRuns_AgentRunID_CacheHit, @MJ_AIPromptRuns_AgentRunID_CacheKey, @MJ_AIPromptRuns_AgentRunID_JudgeID, @MJ_AIPromptRuns_AgentRunID_JudgeScore, @MJ_AIPromptRuns_AgentRunID_WasSelectedResult, @MJ_AIPromptRuns_AgentRunID_StreamingEnabled, @MJ_AIPromptRuns_AgentRunID_FirstTokenTime, @MJ_AIPromptRuns_AgentRunID_ErrorDetails, @MJ_AIPromptRuns_AgentRunID_ChildPromptID, @MJ_AIPromptRuns_AgentRunID_QueueTime, @MJ_AIPromptRuns_AgentRunID_PromptTime, @MJ_AIPromptRuns_AgentRunID_CompletionTime, @MJ_AIPromptRuns_AgentRunID_ModelSpecificResponseDetails, @MJ_AIPromptRuns_AgentRunID_EffortLevel, @MJ_AIPromptRuns_AgentRunID_RunName, @MJ_AIPromptRuns_AgentRunID_Comments, @MJ_AIPromptRuns_AgentRunID_TestRunID

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @MJ_AIPromptRuns_AgentRunID_AgentRunID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateAIPromptRun] @ID = @MJ_AIPromptRuns_AgentRunIDID, @PromptID = @MJ_AIPromptRuns_AgentRunID_PromptID, @ModelID = @MJ_AIPromptRuns_AgentRunID_ModelID, @VendorID = @MJ_AIPromptRuns_AgentRunID_VendorID, @AgentID = @MJ_AIPromptRuns_AgentRunID_AgentID, @ConfigurationID = @MJ_AIPromptRuns_AgentRunID_ConfigurationID, @RunAt = @MJ_AIPromptRuns_AgentRunID_RunAt, @CompletedAt = @MJ_AIPromptRuns_AgentRunID_CompletedAt, @ExecutionTimeMS = @MJ_AIPromptRuns_AgentRunID_ExecutionTimeMS, @Messages = @MJ_AIPromptRuns_AgentRunID_Messages, @Result = @MJ_AIPromptRuns_AgentRunID_Result, @TokensUsed = @MJ_AIPromptRuns_AgentRunID_TokensUsed, @TokensPrompt = @MJ_AIPromptRuns_AgentRunID_TokensPrompt, @TokensCompletion = @MJ_AIPromptRuns_AgentRunID_TokensCompletion, @TotalCost = @MJ_AIPromptRuns_AgentRunID_TotalCost, @Success = @MJ_AIPromptRuns_AgentRunID_Success, @ErrorMessage = @MJ_AIPromptRuns_AgentRunID_ErrorMessage, @ParentID = @MJ_AIPromptRuns_AgentRunID_ParentID, @RunType = @MJ_AIPromptRuns_AgentRunID_RunType, @ExecutionOrder = @MJ_AIPromptRuns_AgentRunID_ExecutionOrder, @AgentRunID = @MJ_AIPromptRuns_AgentRunID_AgentRunID, @Cost = @MJ_AIPromptRuns_AgentRunID_Cost, @CostCurrency = @MJ_AIPromptRuns_AgentRunID_CostCurrency, @TokensUsedRollup = @MJ_AIPromptRuns_AgentRunID_TokensUsedRollup, @TokensPromptRollup = @MJ_AIPromptRuns_AgentRunID_TokensPromptRollup, @TokensCompletionRollup = @MJ_AIPromptRuns_AgentRunID_TokensCompletionRollup, @Temperature = @MJ_AIPromptRuns_AgentRunID_Temperature, @TopP = @MJ_AIPromptRuns_AgentRunID_TopP, @TopK = @MJ_AIPromptRuns_AgentRunID_TopK, @MinP = @MJ_AIPromptRuns_AgentRunID_MinP, @FrequencyPenalty = @MJ_AIPromptRuns_AgentRunID_FrequencyPenalty, @PresencePenalty = @MJ_AIPromptRuns_AgentRunID_PresencePenalty, @Seed = @MJ_AIPromptRuns_AgentRunID_Seed, @StopSequences = @MJ_AIPromptRuns_AgentRunID_StopSequences, @ResponseFormat = @MJ_AIPromptRuns_AgentRunID_ResponseFormat, @LogProbs = @MJ_AIPromptRuns_AgentRunID_LogProbs, @TopLogProbs = @MJ_AIPromptRuns_AgentRunID_TopLogProbs, @DescendantCost = @MJ_AIPromptRuns_AgentRunID_DescendantCost, @ValidationAttemptCount = @MJ_AIPromptRuns_AgentRunID_ValidationAttemptCount, @SuccessfulValidationCount = @MJ_AIPromptRuns_AgentRunID_SuccessfulValidationCount, @FinalValidationPassed = @MJ_AIPromptRuns_AgentRunID_FinalValidationPassed, @ValidationBehavior = @MJ_AIPromptRuns_AgentRunID_ValidationBehavior, @RetryStrategy = @MJ_AIPromptRuns_AgentRunID_RetryStrategy, @MaxRetriesConfigured = @MJ_AIPromptRuns_AgentRunID_MaxRetriesConfigured, @FinalValidationError = @MJ_AIPromptRuns_AgentRunID_FinalValidationError, @ValidationErrorCount = @MJ_AIPromptRuns_AgentRunID_ValidationErrorCount, @CommonValidationError = @MJ_AIPromptRuns_AgentRunID_CommonValidationError, @FirstAttemptAt = @MJ_AIPromptRuns_AgentRunID_FirstAttemptAt, @LastAttemptAt = @MJ_AIPromptRuns_AgentRunID_LastAttemptAt, @TotalRetryDurationMS = @MJ_AIPromptRuns_AgentRunID_TotalRetryDurationMS, @ValidationAttempts = @MJ_AIPromptRuns_AgentRunID_ValidationAttempts, @ValidationSummary = @MJ_AIPromptRuns_AgentRunID_ValidationSummary, @FailoverAttempts = @MJ_AIPromptRuns_AgentRunID_FailoverAttempts, @FailoverErrors = @MJ_AIPromptRuns_AgentRunID_FailoverErrors, @FailoverDurations = @MJ_AIPromptRuns_AgentRunID_FailoverDurations, @OriginalModelID = @MJ_AIPromptRuns_AgentRunID_OriginalModelID, @OriginalRequestStartTime = @MJ_AIPromptRuns_AgentRunID_OriginalRequestStartTime, @TotalFailoverDuration = @MJ_AIPromptRuns_AgentRunID_TotalFailoverDuration, @RerunFromPromptRunID = @MJ_AIPromptRuns_AgentRunID_RerunFromPromptRunID, @ModelSelection = @MJ_AIPromptRuns_AgentRunID_ModelSelection, @Status = @MJ_AIPromptRuns_AgentRunID_Status, @Cancelled = @MJ_AIPromptRuns_AgentRunID_Cancelled, @CancellationReason = @MJ_AIPromptRuns_AgentRunID_CancellationReason, @ModelPowerRank = @MJ_AIPromptRuns_AgentRunID_ModelPowerRank, @SelectionStrategy = @MJ_AIPromptRuns_AgentRunID_SelectionStrategy, @CacheHit = @MJ_AIPromptRuns_AgentRunID_CacheHit, @CacheKey = @MJ_AIPromptRuns_AgentRunID_CacheKey, @JudgeID = @MJ_AIPromptRuns_AgentRunID_JudgeID, @JudgeScore = @MJ_AIPromptRuns_AgentRunID_JudgeScore, @WasSelectedResult = @MJ_AIPromptRuns_AgentRunID_WasSelectedResult, @StreamingEnabled = @MJ_AIPromptRuns_AgentRunID_StreamingEnabled, @FirstTokenTime = @MJ_AIPromptRuns_AgentRunID_FirstTokenTime, @ErrorDetails = @MJ_AIPromptRuns_AgentRunID_ErrorDetails, @ChildPromptID = @MJ_AIPromptRuns_AgentRunID_ChildPromptID, @QueueTime = @MJ_AIPromptRuns_AgentRunID_QueueTime, @PromptTime = @MJ_AIPromptRuns_AgentRunID_PromptTime, @CompletionTime = @MJ_AIPromptRuns_AgentRunID_CompletionTime, @ModelSpecificResponseDetails = @MJ_AIPromptRuns_AgentRunID_ModelSpecificResponseDetails, @EffortLevel = @MJ_AIPromptRuns_AgentRunID_EffortLevel, @RunName = @MJ_AIPromptRuns_AgentRunID_RunName, @Comments = @MJ_AIPromptRuns_AgentRunID_Comments, @TestRunID = @MJ_AIPromptRuns_AgentRunID_TestRunID

        FETCH NEXT FROM cascade_update_MJ_AIPromptRuns_AgentRunID_cursor INTO @MJ_AIPromptRuns_AgentRunIDID, @MJ_AIPromptRuns_AgentRunID_PromptID, @MJ_AIPromptRuns_AgentRunID_ModelID, @MJ_AIPromptRuns_AgentRunID_VendorID, @MJ_AIPromptRuns_AgentRunID_AgentID, @MJ_AIPromptRuns_AgentRunID_ConfigurationID, @MJ_AIPromptRuns_AgentRunID_RunAt, @MJ_AIPromptRuns_AgentRunID_CompletedAt, @MJ_AIPromptRuns_AgentRunID_ExecutionTimeMS, @MJ_AIPromptRuns_AgentRunID_Messages, @MJ_AIPromptRuns_AgentRunID_Result, @MJ_AIPromptRuns_AgentRunID_TokensUsed, @MJ_AIPromptRuns_AgentRunID_TokensPrompt, @MJ_AIPromptRuns_AgentRunID_TokensCompletion, @MJ_AIPromptRuns_AgentRunID_TotalCost, @MJ_AIPromptRuns_AgentRunID_Success, @MJ_AIPromptRuns_AgentRunID_ErrorMessage, @MJ_AIPromptRuns_AgentRunID_ParentID, @MJ_AIPromptRuns_AgentRunID_RunType, @MJ_AIPromptRuns_AgentRunID_ExecutionOrder, @MJ_AIPromptRuns_AgentRunID_AgentRunID, @MJ_AIPromptRuns_AgentRunID_Cost, @MJ_AIPromptRuns_AgentRunID_CostCurrency, @MJ_AIPromptRuns_AgentRunID_TokensUsedRollup, @MJ_AIPromptRuns_AgentRunID_TokensPromptRollup, @MJ_AIPromptRuns_AgentRunID_TokensCompletionRollup, @MJ_AIPromptRuns_AgentRunID_Temperature, @MJ_AIPromptRuns_AgentRunID_TopP, @MJ_AIPromptRuns_AgentRunID_TopK, @MJ_AIPromptRuns_AgentRunID_MinP, @MJ_AIPromptRuns_AgentRunID_FrequencyPenalty, @MJ_AIPromptRuns_AgentRunID_PresencePenalty, @MJ_AIPromptRuns_AgentRunID_Seed, @MJ_AIPromptRuns_AgentRunID_StopSequences, @MJ_AIPromptRuns_AgentRunID_ResponseFormat, @MJ_AIPromptRuns_AgentRunID_LogProbs, @MJ_AIPromptRuns_AgentRunID_TopLogProbs, @MJ_AIPromptRuns_AgentRunID_DescendantCost, @MJ_AIPromptRuns_AgentRunID_ValidationAttemptCount, @MJ_AIPromptRuns_AgentRunID_SuccessfulValidationCount, @MJ_AIPromptRuns_AgentRunID_FinalValidationPassed, @MJ_AIPromptRuns_AgentRunID_ValidationBehavior, @MJ_AIPromptRuns_AgentRunID_RetryStrategy, @MJ_AIPromptRuns_AgentRunID_MaxRetriesConfigured, @MJ_AIPromptRuns_AgentRunID_FinalValidationError, @MJ_AIPromptRuns_AgentRunID_ValidationErrorCount, @MJ_AIPromptRuns_AgentRunID_CommonValidationError, @MJ_AIPromptRuns_AgentRunID_FirstAttemptAt, @MJ_AIPromptRuns_AgentRunID_LastAttemptAt, @MJ_AIPromptRuns_AgentRunID_TotalRetryDurationMS, @MJ_AIPromptRuns_AgentRunID_ValidationAttempts, @MJ_AIPromptRuns_AgentRunID_ValidationSummary, @MJ_AIPromptRuns_AgentRunID_FailoverAttempts, @MJ_AIPromptRuns_AgentRunID_FailoverErrors, @MJ_AIPromptRuns_AgentRunID_FailoverDurations, @MJ_AIPromptRuns_AgentRunID_OriginalModelID, @MJ_AIPromptRuns_AgentRunID_OriginalRequestStartTime, @MJ_AIPromptRuns_AgentRunID_TotalFailoverDuration, @MJ_AIPromptRuns_AgentRunID_RerunFromPromptRunID, @MJ_AIPromptRuns_AgentRunID_ModelSelection, @MJ_AIPromptRuns_AgentRunID_Status, @MJ_AIPromptRuns_AgentRunID_Cancelled, @MJ_AIPromptRuns_AgentRunID_CancellationReason, @MJ_AIPromptRuns_AgentRunID_ModelPowerRank, @MJ_AIPromptRuns_AgentRunID_SelectionStrategy, @MJ_AIPromptRuns_AgentRunID_CacheHit, @MJ_AIPromptRuns_AgentRunID_CacheKey, @MJ_AIPromptRuns_AgentRunID_JudgeID, @MJ_AIPromptRuns_AgentRunID_JudgeScore, @MJ_AIPromptRuns_AgentRunID_WasSelectedResult, @MJ_AIPromptRuns_AgentRunID_StreamingEnabled, @MJ_AIPromptRuns_AgentRunID_FirstTokenTime, @MJ_AIPromptRuns_AgentRunID_ErrorDetails, @MJ_AIPromptRuns_AgentRunID_ChildPromptID, @MJ_AIPromptRuns_AgentRunID_QueueTime, @MJ_AIPromptRuns_AgentRunID_PromptTime, @MJ_AIPromptRuns_AgentRunID_CompletionTime, @MJ_AIPromptRuns_AgentRunID_ModelSpecificResponseDetails, @MJ_AIPromptRuns_AgentRunID_EffortLevel, @MJ_AIPromptRuns_AgentRunID_RunName, @MJ_AIPromptRuns_AgentRunID_Comments, @MJ_AIPromptRuns_AgentRunID_TestRunID
    END

    CLOSE cascade_update_MJ_AIPromptRuns_AgentRunID_cursor
    DEALLOCATE cascade_update_MJ_AIPromptRuns_AgentRunID_cursor
    

    DELETE FROM
        [${flyway:defaultSchema}].[AIAgentRun]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteAIAgentRun] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: AI Agent Runs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteAIAgentRun] TO [cdp_Integration]



/* spDelete SQL for MJ: AI Agent Steps */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Steps
-- Item: spDeleteAIAgentStep
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR AIAgentStep
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteAIAgentStep]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteAIAgentStep];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteAIAgentStep]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    -- Cascade delete from AIAgentStepPath using cursor to call spDeleteAIAgentStepPath
    DECLARE @MJ_AIAgentStepPaths_OriginStepIDID uniqueidentifier
    DECLARE cascade_delete_MJ_AIAgentStepPaths_OriginStepID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[AIAgentStepPath]
        WHERE [OriginStepID] = @ID
    
    OPEN cascade_delete_MJ_AIAgentStepPaths_OriginStepID_cursor
    FETCH NEXT FROM cascade_delete_MJ_AIAgentStepPaths_OriginStepID_cursor INTO @MJ_AIAgentStepPaths_OriginStepIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteAIAgentStepPath] @ID = @MJ_AIAgentStepPaths_OriginStepIDID
        
        FETCH NEXT FROM cascade_delete_MJ_AIAgentStepPaths_OriginStepID_cursor INTO @MJ_AIAgentStepPaths_OriginStepIDID
    END
    
    CLOSE cascade_delete_MJ_AIAgentStepPaths_OriginStepID_cursor
    DEALLOCATE cascade_delete_MJ_AIAgentStepPaths_OriginStepID_cursor
    
    -- Cascade delete from AIAgentStepPath using cursor to call spDeleteAIAgentStepPath
    DECLARE @MJ_AIAgentStepPaths_DestinationStepIDID uniqueidentifier
    DECLARE cascade_delete_MJ_AIAgentStepPaths_DestinationStepID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[AIAgentStepPath]
        WHERE [DestinationStepID] = @ID
    
    OPEN cascade_delete_MJ_AIAgentStepPaths_DestinationStepID_cursor
    FETCH NEXT FROM cascade_delete_MJ_AIAgentStepPaths_DestinationStepID_cursor INTO @MJ_AIAgentStepPaths_DestinationStepIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteAIAgentStepPath] @ID = @MJ_AIAgentStepPaths_DestinationStepIDID
        
        FETCH NEXT FROM cascade_delete_MJ_AIAgentStepPaths_DestinationStepID_cursor INTO @MJ_AIAgentStepPaths_DestinationStepIDID
    END
    
    CLOSE cascade_delete_MJ_AIAgentStepPaths_DestinationStepID_cursor
    DEALLOCATE cascade_delete_MJ_AIAgentStepPaths_DestinationStepID_cursor
    

    DELETE FROM
        [${flyway:defaultSchema}].[AIAgentStep]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteAIAgentStep] TO [cdp_Developer], [cdp_Integration]
    

/* spDelete Permissions for MJ: AI Agent Steps */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteAIAgentStep] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: AI Configurations */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Configurations
-- Item: spDeleteAIConfiguration
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR AIConfiguration
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteAIConfiguration]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteAIConfiguration];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteAIConfiguration]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    -- Cascade update on AIResultCache using cursor to call spUpdateAIResultCache
    DECLARE @AIResultCache_ConfigurationIDID uniqueidentifier
    DECLARE @AIResultCache_ConfigurationID_AIPromptID uniqueidentifier
    DECLARE @AIResultCache_ConfigurationID_AIModelID uniqueidentifier
    DECLARE @AIResultCache_ConfigurationID_RunAt datetimeoffset
    DECLARE @AIResultCache_ConfigurationID_PromptText nvarchar(MAX)
    DECLARE @AIResultCache_ConfigurationID_ResultText nvarchar(MAX)
    DECLARE @AIResultCache_ConfigurationID_Status nvarchar(50)
    DECLARE @AIResultCache_ConfigurationID_ExpiredOn datetimeoffset
    DECLARE @AIResultCache_ConfigurationID_VendorID uniqueidentifier
    DECLARE @AIResultCache_ConfigurationID_AgentID uniqueidentifier
    DECLARE @AIResultCache_ConfigurationID_ConfigurationID uniqueidentifier
    DECLARE @AIResultCache_ConfigurationID_PromptEmbedding varbinary
    DECLARE @AIResultCache_ConfigurationID_PromptRunID uniqueidentifier
    DECLARE cascade_update_AIResultCache_ConfigurationID_cursor CURSOR FOR
        SELECT [ID], [AIPromptID], [AIModelID], [RunAt], [PromptText], [ResultText], [Status], [ExpiredOn], [VendorID], [AgentID], [ConfigurationID], [PromptEmbedding], [PromptRunID]
        FROM [${flyway:defaultSchema}].[AIResultCache]
        WHERE [ConfigurationID] = @ID

    OPEN cascade_update_AIResultCache_ConfigurationID_cursor
    FETCH NEXT FROM cascade_update_AIResultCache_ConfigurationID_cursor INTO @AIResultCache_ConfigurationIDID, @AIResultCache_ConfigurationID_AIPromptID, @AIResultCache_ConfigurationID_AIModelID, @AIResultCache_ConfigurationID_RunAt, @AIResultCache_ConfigurationID_PromptText, @AIResultCache_ConfigurationID_ResultText, @AIResultCache_ConfigurationID_Status, @AIResultCache_ConfigurationID_ExpiredOn, @AIResultCache_ConfigurationID_VendorID, @AIResultCache_ConfigurationID_AgentID, @AIResultCache_ConfigurationID_ConfigurationID, @AIResultCache_ConfigurationID_PromptEmbedding, @AIResultCache_ConfigurationID_PromptRunID

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @AIResultCache_ConfigurationID_ConfigurationID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateAIResultCache] @ID = @AIResultCache_ConfigurationIDID, @AIPromptID = @AIResultCache_ConfigurationID_AIPromptID, @AIModelID = @AIResultCache_ConfigurationID_AIModelID, @RunAt = @AIResultCache_ConfigurationID_RunAt, @PromptText = @AIResultCache_ConfigurationID_PromptText, @ResultText = @AIResultCache_ConfigurationID_ResultText, @Status = @AIResultCache_ConfigurationID_Status, @ExpiredOn = @AIResultCache_ConfigurationID_ExpiredOn, @VendorID = @AIResultCache_ConfigurationID_VendorID, @AgentID = @AIResultCache_ConfigurationID_AgentID, @ConfigurationID = @AIResultCache_ConfigurationID_ConfigurationID, @PromptEmbedding = @AIResultCache_ConfigurationID_PromptEmbedding, @PromptRunID = @AIResultCache_ConfigurationID_PromptRunID

        FETCH NEXT FROM cascade_update_AIResultCache_ConfigurationID_cursor INTO @AIResultCache_ConfigurationIDID, @AIResultCache_ConfigurationID_AIPromptID, @AIResultCache_ConfigurationID_AIModelID, @AIResultCache_ConfigurationID_RunAt, @AIResultCache_ConfigurationID_PromptText, @AIResultCache_ConfigurationID_ResultText, @AIResultCache_ConfigurationID_Status, @AIResultCache_ConfigurationID_ExpiredOn, @AIResultCache_ConfigurationID_VendorID, @AIResultCache_ConfigurationID_AgentID, @AIResultCache_ConfigurationID_ConfigurationID, @AIResultCache_ConfigurationID_PromptEmbedding, @AIResultCache_ConfigurationID_PromptRunID
    END

    CLOSE cascade_update_AIResultCache_ConfigurationID_cursor
    DEALLOCATE cascade_update_AIResultCache_ConfigurationID_cursor
    
    -- Cascade update on AIAgentConfiguration using cursor to call spUpdateAIAgentConfiguration
    DECLARE @MJ_AIAgentConfigurations_AIConfigurationIDID uniqueidentifier
    DECLARE @MJ_AIAgentConfigurations_AIConfigurationID_AgentID uniqueidentifier
    DECLARE @MJ_AIAgentConfigurations_AIConfigurationID_Name nvarchar(100)
    DECLARE @MJ_AIAgentConfigurations_AIConfigurationID_DisplayName nvarchar(200)
    DECLARE @MJ_AIAgentConfigurations_AIConfigurationID_Description nvarchar(MAX)
    DECLARE @MJ_AIAgentConfigurations_AIConfigurationID_AIConfigurationID uniqueidentifier
    DECLARE @MJ_AIAgentConfigurations_AIConfigurationID_IsDefault bit
    DECLARE @MJ_AIAgentConfigurations_AIConfigurationID_Priority int
    DECLARE @MJ_AIAgentConfigurations_AIConfigurationID_Status nvarchar(20)
    DECLARE cascade_update_MJ_AIAgentConfigurations_AIConfigurationID_cursor CURSOR FOR
        SELECT [ID], [AgentID], [Name], [DisplayName], [Description], [AIConfigurationID], [IsDefault], [Priority], [Status]
        FROM [${flyway:defaultSchema}].[AIAgentConfiguration]
        WHERE [AIConfigurationID] = @ID

    OPEN cascade_update_MJ_AIAgentConfigurations_AIConfigurationID_cursor
    FETCH NEXT FROM cascade_update_MJ_AIAgentConfigurations_AIConfigurationID_cursor INTO @MJ_AIAgentConfigurations_AIConfigurationIDID, @MJ_AIAgentConfigurations_AIConfigurationID_AgentID, @MJ_AIAgentConfigurations_AIConfigurationID_Name, @MJ_AIAgentConfigurations_AIConfigurationID_DisplayName, @MJ_AIAgentConfigurations_AIConfigurationID_Description, @MJ_AIAgentConfigurations_AIConfigurationID_AIConfigurationID, @MJ_AIAgentConfigurations_AIConfigurationID_IsDefault, @MJ_AIAgentConfigurations_AIConfigurationID_Priority, @MJ_AIAgentConfigurations_AIConfigurationID_Status

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @MJ_AIAgentConfigurations_AIConfigurationID_AIConfigurationID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateAIAgentConfiguration] @ID = @MJ_AIAgentConfigurations_AIConfigurationIDID, @AgentID = @MJ_AIAgentConfigurations_AIConfigurationID_AgentID, @Name = @MJ_AIAgentConfigurations_AIConfigurationID_Name, @DisplayName = @MJ_AIAgentConfigurations_AIConfigurationID_DisplayName, @Description = @MJ_AIAgentConfigurations_AIConfigurationID_Description, @AIConfigurationID = @MJ_AIAgentConfigurations_AIConfigurationID_AIConfigurationID, @IsDefault = @MJ_AIAgentConfigurations_AIConfigurationID_IsDefault, @Priority = @MJ_AIAgentConfigurations_AIConfigurationID_Priority, @Status = @MJ_AIAgentConfigurations_AIConfigurationID_Status

        FETCH NEXT FROM cascade_update_MJ_AIAgentConfigurations_AIConfigurationID_cursor INTO @MJ_AIAgentConfigurations_AIConfigurationIDID, @MJ_AIAgentConfigurations_AIConfigurationID_AgentID, @MJ_AIAgentConfigurations_AIConfigurationID_Name, @MJ_AIAgentConfigurations_AIConfigurationID_DisplayName, @MJ_AIAgentConfigurations_AIConfigurationID_Description, @MJ_AIAgentConfigurations_AIConfigurationID_AIConfigurationID, @MJ_AIAgentConfigurations_AIConfigurationID_IsDefault, @MJ_AIAgentConfigurations_AIConfigurationID_Priority, @MJ_AIAgentConfigurations_AIConfigurationID_Status
    END

    CLOSE cascade_update_MJ_AIAgentConfigurations_AIConfigurationID_cursor
    DEALLOCATE cascade_update_MJ_AIAgentConfigurations_AIConfigurationID_cursor
    
    -- Cascade update on AIAgentPrompt using cursor to call spUpdateAIAgentPrompt
    DECLARE @MJ_AIAgentPrompts_ConfigurationIDID uniqueidentifier
    DECLARE @MJ_AIAgentPrompts_ConfigurationID_AgentID uniqueidentifier
    DECLARE @MJ_AIAgentPrompts_ConfigurationID_PromptID uniqueidentifier
    DECLARE @MJ_AIAgentPrompts_ConfigurationID_Purpose nvarchar(MAX)
    DECLARE @MJ_AIAgentPrompts_ConfigurationID_ExecutionOrder int
    DECLARE @MJ_AIAgentPrompts_ConfigurationID_ConfigurationID uniqueidentifier
    DECLARE @MJ_AIAgentPrompts_ConfigurationID_Status nvarchar(20)
    DECLARE @MJ_AIAgentPrompts_ConfigurationID_ContextBehavior nvarchar(50)
    DECLARE @MJ_AIAgentPrompts_ConfigurationID_ContextMessageCount int
    DECLARE cascade_update_MJ_AIAgentPrompts_ConfigurationID_cursor CURSOR FOR
        SELECT [ID], [AgentID], [PromptID], [Purpose], [ExecutionOrder], [ConfigurationID], [Status], [ContextBehavior], [ContextMessageCount]
        FROM [${flyway:defaultSchema}].[AIAgentPrompt]
        WHERE [ConfigurationID] = @ID

    OPEN cascade_update_MJ_AIAgentPrompts_ConfigurationID_cursor
    FETCH NEXT FROM cascade_update_MJ_AIAgentPrompts_ConfigurationID_cursor INTO @MJ_AIAgentPrompts_ConfigurationIDID, @MJ_AIAgentPrompts_ConfigurationID_AgentID, @MJ_AIAgentPrompts_ConfigurationID_PromptID, @MJ_AIAgentPrompts_ConfigurationID_Purpose, @MJ_AIAgentPrompts_ConfigurationID_ExecutionOrder, @MJ_AIAgentPrompts_ConfigurationID_ConfigurationID, @MJ_AIAgentPrompts_ConfigurationID_Status, @MJ_AIAgentPrompts_ConfigurationID_ContextBehavior, @MJ_AIAgentPrompts_ConfigurationID_ContextMessageCount

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @MJ_AIAgentPrompts_ConfigurationID_ConfigurationID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateAIAgentPrompt] @ID = @MJ_AIAgentPrompts_ConfigurationIDID, @AgentID = @MJ_AIAgentPrompts_ConfigurationID_AgentID, @PromptID = @MJ_AIAgentPrompts_ConfigurationID_PromptID, @Purpose = @MJ_AIAgentPrompts_ConfigurationID_Purpose, @ExecutionOrder = @MJ_AIAgentPrompts_ConfigurationID_ExecutionOrder, @ConfigurationID = @MJ_AIAgentPrompts_ConfigurationID_ConfigurationID, @Status = @MJ_AIAgentPrompts_ConfigurationID_Status, @ContextBehavior = @MJ_AIAgentPrompts_ConfigurationID_ContextBehavior, @ContextMessageCount = @MJ_AIAgentPrompts_ConfigurationID_ContextMessageCount

        FETCH NEXT FROM cascade_update_MJ_AIAgentPrompts_ConfigurationID_cursor INTO @MJ_AIAgentPrompts_ConfigurationIDID, @MJ_AIAgentPrompts_ConfigurationID_AgentID, @MJ_AIAgentPrompts_ConfigurationID_PromptID, @MJ_AIAgentPrompts_ConfigurationID_Purpose, @MJ_AIAgentPrompts_ConfigurationID_ExecutionOrder, @MJ_AIAgentPrompts_ConfigurationID_ConfigurationID, @MJ_AIAgentPrompts_ConfigurationID_Status, @MJ_AIAgentPrompts_ConfigurationID_ContextBehavior, @MJ_AIAgentPrompts_ConfigurationID_ContextMessageCount
    END

    CLOSE cascade_update_MJ_AIAgentPrompts_ConfigurationID_cursor
    DEALLOCATE cascade_update_MJ_AIAgentPrompts_ConfigurationID_cursor
    
    -- Cascade update on AIAgentRun using cursor to call spUpdateAIAgentRun
    DECLARE @MJ_AIAgentRuns_ConfigurationIDID uniqueidentifier
    DECLARE @MJ_AIAgentRuns_ConfigurationID_AgentID uniqueidentifier
    DECLARE @MJ_AIAgentRuns_ConfigurationID_ParentRunID uniqueidentifier
    DECLARE @MJ_AIAgentRuns_ConfigurationID_Status nvarchar(50)
    DECLARE @MJ_AIAgentRuns_ConfigurationID_StartedAt datetimeoffset
    DECLARE @MJ_AIAgentRuns_ConfigurationID_CompletedAt datetimeoffset
    DECLARE @MJ_AIAgentRuns_ConfigurationID_Success bit
    DECLARE @MJ_AIAgentRuns_ConfigurationID_ErrorMessage nvarchar(MAX)
    DECLARE @MJ_AIAgentRuns_ConfigurationID_ConversationID uniqueidentifier
    DECLARE @MJ_AIAgentRuns_ConfigurationID_UserID uniqueidentifier
    DECLARE @MJ_AIAgentRuns_ConfigurationID_Result nvarchar(MAX)
    DECLARE @MJ_AIAgentRuns_ConfigurationID_AgentState nvarchar(MAX)
    DECLARE @MJ_AIAgentRuns_ConfigurationID_TotalTokensUsed int
    DECLARE @MJ_AIAgentRuns_ConfigurationID_TotalCost decimal(18, 6)
    DECLARE @MJ_AIAgentRuns_ConfigurationID_TotalPromptTokensUsed int
    DECLARE @MJ_AIAgentRuns_ConfigurationID_TotalCompletionTokensUsed int
    DECLARE @MJ_AIAgentRuns_ConfigurationID_TotalTokensUsedRollup int
    DECLARE @MJ_AIAgentRuns_ConfigurationID_TotalPromptTokensUsedRollup int
    DECLARE @MJ_AIAgentRuns_ConfigurationID_TotalCompletionTokensUsedRollup int
    DECLARE @MJ_AIAgentRuns_ConfigurationID_TotalCostRollup decimal(19, 8)
    DECLARE @MJ_AIAgentRuns_ConfigurationID_ConversationDetailID uniqueidentifier
    DECLARE @MJ_AIAgentRuns_ConfigurationID_ConversationDetailSequence int
    DECLARE @MJ_AIAgentRuns_ConfigurationID_CancellationReason nvarchar(30)
    DECLARE @MJ_AIAgentRuns_ConfigurationID_FinalStep nvarchar(30)
    DECLARE @MJ_AIAgentRuns_ConfigurationID_FinalPayload nvarchar(MAX)
    DECLARE @MJ_AIAgentRuns_ConfigurationID_Message nvarchar(MAX)
    DECLARE @MJ_AIAgentRuns_ConfigurationID_LastRunID uniqueidentifier
    DECLARE @MJ_AIAgentRuns_ConfigurationID_StartingPayload nvarchar(MAX)
    DECLARE @MJ_AIAgentRuns_ConfigurationID_TotalPromptIterations int
    DECLARE @MJ_AIAgentRuns_ConfigurationID_ConfigurationID uniqueidentifier
    DECLARE @MJ_AIAgentRuns_ConfigurationID_OverrideModelID uniqueidentifier
    DECLARE @MJ_AIAgentRuns_ConfigurationID_OverrideVendorID uniqueidentifier
    DECLARE @MJ_AIAgentRuns_ConfigurationID_Data nvarchar(MAX)
    DECLARE @MJ_AIAgentRuns_ConfigurationID_Verbose bit
    DECLARE @MJ_AIAgentRuns_ConfigurationID_EffortLevel int
    DECLARE @MJ_AIAgentRuns_ConfigurationID_RunName nvarchar(255)
    DECLARE @MJ_AIAgentRuns_ConfigurationID_Comments nvarchar(MAX)
    DECLARE @MJ_AIAgentRuns_ConfigurationID_ScheduledJobRunID uniqueidentifier
    DECLARE @MJ_AIAgentRuns_ConfigurationID_TestRunID uniqueidentifier
    DECLARE @MJ_AIAgentRuns_ConfigurationID_PrimaryScopeEntityID uniqueidentifier
    DECLARE @MJ_AIAgentRuns_ConfigurationID_PrimaryScopeRecordID nvarchar(100)
    DECLARE @MJ_AIAgentRuns_ConfigurationID_SecondaryScopes nvarchar(MAX)
    DECLARE cascade_update_MJ_AIAgentRuns_ConfigurationID_cursor CURSOR FOR
        SELECT [ID], [AgentID], [ParentRunID], [Status], [StartedAt], [CompletedAt], [Success], [ErrorMessage], [ConversationID], [UserID], [Result], [AgentState], [TotalTokensUsed], [TotalCost], [TotalPromptTokensUsed], [TotalCompletionTokensUsed], [TotalTokensUsedRollup], [TotalPromptTokensUsedRollup], [TotalCompletionTokensUsedRollup], [TotalCostRollup], [ConversationDetailID], [ConversationDetailSequence], [CancellationReason], [FinalStep], [FinalPayload], [Message], [LastRunID], [StartingPayload], [TotalPromptIterations], [ConfigurationID], [OverrideModelID], [OverrideVendorID], [Data], [Verbose], [EffortLevel], [RunName], [Comments], [ScheduledJobRunID], [TestRunID], [PrimaryScopeEntityID], [PrimaryScopeRecordID], [SecondaryScopes]
        FROM [${flyway:defaultSchema}].[AIAgentRun]
        WHERE [ConfigurationID] = @ID

    OPEN cascade_update_MJ_AIAgentRuns_ConfigurationID_cursor
    FETCH NEXT FROM cascade_update_MJ_AIAgentRuns_ConfigurationID_cursor INTO @MJ_AIAgentRuns_ConfigurationIDID, @MJ_AIAgentRuns_ConfigurationID_AgentID, @MJ_AIAgentRuns_ConfigurationID_ParentRunID, @MJ_AIAgentRuns_ConfigurationID_Status, @MJ_AIAgentRuns_ConfigurationID_StartedAt, @MJ_AIAgentRuns_ConfigurationID_CompletedAt, @MJ_AIAgentRuns_ConfigurationID_Success, @MJ_AIAgentRuns_ConfigurationID_ErrorMessage, @MJ_AIAgentRuns_ConfigurationID_ConversationID, @MJ_AIAgentRuns_ConfigurationID_UserID, @MJ_AIAgentRuns_ConfigurationID_Result, @MJ_AIAgentRuns_ConfigurationID_AgentState, @MJ_AIAgentRuns_ConfigurationID_TotalTokensUsed, @MJ_AIAgentRuns_ConfigurationID_TotalCost, @MJ_AIAgentRuns_ConfigurationID_TotalPromptTokensUsed, @MJ_AIAgentRuns_ConfigurationID_TotalCompletionTokensUsed, @MJ_AIAgentRuns_ConfigurationID_TotalTokensUsedRollup, @MJ_AIAgentRuns_ConfigurationID_TotalPromptTokensUsedRollup, @MJ_AIAgentRuns_ConfigurationID_TotalCompletionTokensUsedRollup, @MJ_AIAgentRuns_ConfigurationID_TotalCostRollup, @MJ_AIAgentRuns_ConfigurationID_ConversationDetailID, @MJ_AIAgentRuns_ConfigurationID_ConversationDetailSequence, @MJ_AIAgentRuns_ConfigurationID_CancellationReason, @MJ_AIAgentRuns_ConfigurationID_FinalStep, @MJ_AIAgentRuns_ConfigurationID_FinalPayload, @MJ_AIAgentRuns_ConfigurationID_Message, @MJ_AIAgentRuns_ConfigurationID_LastRunID, @MJ_AIAgentRuns_ConfigurationID_StartingPayload, @MJ_AIAgentRuns_ConfigurationID_TotalPromptIterations, @MJ_AIAgentRuns_ConfigurationID_ConfigurationID, @MJ_AIAgentRuns_ConfigurationID_OverrideModelID, @MJ_AIAgentRuns_ConfigurationID_OverrideVendorID, @MJ_AIAgentRuns_ConfigurationID_Data, @MJ_AIAgentRuns_ConfigurationID_Verbose, @MJ_AIAgentRuns_ConfigurationID_EffortLevel, @MJ_AIAgentRuns_ConfigurationID_RunName, @MJ_AIAgentRuns_ConfigurationID_Comments, @MJ_AIAgentRuns_ConfigurationID_ScheduledJobRunID, @MJ_AIAgentRuns_ConfigurationID_TestRunID, @MJ_AIAgentRuns_ConfigurationID_PrimaryScopeEntityID, @MJ_AIAgentRuns_ConfigurationID_PrimaryScopeRecordID, @MJ_AIAgentRuns_ConfigurationID_SecondaryScopes

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @MJ_AIAgentRuns_ConfigurationID_ConfigurationID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateAIAgentRun] @ID = @MJ_AIAgentRuns_ConfigurationIDID, @AgentID = @MJ_AIAgentRuns_ConfigurationID_AgentID, @ParentRunID = @MJ_AIAgentRuns_ConfigurationID_ParentRunID, @Status = @MJ_AIAgentRuns_ConfigurationID_Status, @StartedAt = @MJ_AIAgentRuns_ConfigurationID_StartedAt, @CompletedAt = @MJ_AIAgentRuns_ConfigurationID_CompletedAt, @Success = @MJ_AIAgentRuns_ConfigurationID_Success, @ErrorMessage = @MJ_AIAgentRuns_ConfigurationID_ErrorMessage, @ConversationID = @MJ_AIAgentRuns_ConfigurationID_ConversationID, @UserID = @MJ_AIAgentRuns_ConfigurationID_UserID, @Result = @MJ_AIAgentRuns_ConfigurationID_Result, @AgentState = @MJ_AIAgentRuns_ConfigurationID_AgentState, @TotalTokensUsed = @MJ_AIAgentRuns_ConfigurationID_TotalTokensUsed, @TotalCost = @MJ_AIAgentRuns_ConfigurationID_TotalCost, @TotalPromptTokensUsed = @MJ_AIAgentRuns_ConfigurationID_TotalPromptTokensUsed, @TotalCompletionTokensUsed = @MJ_AIAgentRuns_ConfigurationID_TotalCompletionTokensUsed, @TotalTokensUsedRollup = @MJ_AIAgentRuns_ConfigurationID_TotalTokensUsedRollup, @TotalPromptTokensUsedRollup = @MJ_AIAgentRuns_ConfigurationID_TotalPromptTokensUsedRollup, @TotalCompletionTokensUsedRollup = @MJ_AIAgentRuns_ConfigurationID_TotalCompletionTokensUsedRollup, @TotalCostRollup = @MJ_AIAgentRuns_ConfigurationID_TotalCostRollup, @ConversationDetailID = @MJ_AIAgentRuns_ConfigurationID_ConversationDetailID, @ConversationDetailSequence = @MJ_AIAgentRuns_ConfigurationID_ConversationDetailSequence, @CancellationReason = @MJ_AIAgentRuns_ConfigurationID_CancellationReason, @FinalStep = @MJ_AIAgentRuns_ConfigurationID_FinalStep, @FinalPayload = @MJ_AIAgentRuns_ConfigurationID_FinalPayload, @Message = @MJ_AIAgentRuns_ConfigurationID_Message, @LastRunID = @MJ_AIAgentRuns_ConfigurationID_LastRunID, @StartingPayload = @MJ_AIAgentRuns_ConfigurationID_StartingPayload, @TotalPromptIterations = @MJ_AIAgentRuns_ConfigurationID_TotalPromptIterations, @ConfigurationID = @MJ_AIAgentRuns_ConfigurationID_ConfigurationID, @OverrideModelID = @MJ_AIAgentRuns_ConfigurationID_OverrideModelID, @OverrideVendorID = @MJ_AIAgentRuns_ConfigurationID_OverrideVendorID, @Data = @MJ_AIAgentRuns_ConfigurationID_Data, @Verbose = @MJ_AIAgentRuns_ConfigurationID_Verbose, @EffortLevel = @MJ_AIAgentRuns_ConfigurationID_EffortLevel, @RunName = @MJ_AIAgentRuns_ConfigurationID_RunName, @Comments = @MJ_AIAgentRuns_ConfigurationID_Comments, @ScheduledJobRunID = @MJ_AIAgentRuns_ConfigurationID_ScheduledJobRunID, @TestRunID = @MJ_AIAgentRuns_ConfigurationID_TestRunID, @PrimaryScopeEntityID = @MJ_AIAgentRuns_ConfigurationID_PrimaryScopeEntityID, @PrimaryScopeRecordID = @MJ_AIAgentRuns_ConfigurationID_PrimaryScopeRecordID, @SecondaryScopes = @MJ_AIAgentRuns_ConfigurationID_SecondaryScopes

        FETCH NEXT FROM cascade_update_MJ_AIAgentRuns_ConfigurationID_cursor INTO @MJ_AIAgentRuns_ConfigurationIDID, @MJ_AIAgentRuns_ConfigurationID_AgentID, @MJ_AIAgentRuns_ConfigurationID_ParentRunID, @MJ_AIAgentRuns_ConfigurationID_Status, @MJ_AIAgentRuns_ConfigurationID_StartedAt, @MJ_AIAgentRuns_ConfigurationID_CompletedAt, @MJ_AIAgentRuns_ConfigurationID_Success, @MJ_AIAgentRuns_ConfigurationID_ErrorMessage, @MJ_AIAgentRuns_ConfigurationID_ConversationID, @MJ_AIAgentRuns_ConfigurationID_UserID, @MJ_AIAgentRuns_ConfigurationID_Result, @MJ_AIAgentRuns_ConfigurationID_AgentState, @MJ_AIAgentRuns_ConfigurationID_TotalTokensUsed, @MJ_AIAgentRuns_ConfigurationID_TotalCost, @MJ_AIAgentRuns_ConfigurationID_TotalPromptTokensUsed, @MJ_AIAgentRuns_ConfigurationID_TotalCompletionTokensUsed, @MJ_AIAgentRuns_ConfigurationID_TotalTokensUsedRollup, @MJ_AIAgentRuns_ConfigurationID_TotalPromptTokensUsedRollup, @MJ_AIAgentRuns_ConfigurationID_TotalCompletionTokensUsedRollup, @MJ_AIAgentRuns_ConfigurationID_TotalCostRollup, @MJ_AIAgentRuns_ConfigurationID_ConversationDetailID, @MJ_AIAgentRuns_ConfigurationID_ConversationDetailSequence, @MJ_AIAgentRuns_ConfigurationID_CancellationReason, @MJ_AIAgentRuns_ConfigurationID_FinalStep, @MJ_AIAgentRuns_ConfigurationID_FinalPayload, @MJ_AIAgentRuns_ConfigurationID_Message, @MJ_AIAgentRuns_ConfigurationID_LastRunID, @MJ_AIAgentRuns_ConfigurationID_StartingPayload, @MJ_AIAgentRuns_ConfigurationID_TotalPromptIterations, @MJ_AIAgentRuns_ConfigurationID_ConfigurationID, @MJ_AIAgentRuns_ConfigurationID_OverrideModelID, @MJ_AIAgentRuns_ConfigurationID_OverrideVendorID, @MJ_AIAgentRuns_ConfigurationID_Data, @MJ_AIAgentRuns_ConfigurationID_Verbose, @MJ_AIAgentRuns_ConfigurationID_EffortLevel, @MJ_AIAgentRuns_ConfigurationID_RunName, @MJ_AIAgentRuns_ConfigurationID_Comments, @MJ_AIAgentRuns_ConfigurationID_ScheduledJobRunID, @MJ_AIAgentRuns_ConfigurationID_TestRunID, @MJ_AIAgentRuns_ConfigurationID_PrimaryScopeEntityID, @MJ_AIAgentRuns_ConfigurationID_PrimaryScopeRecordID, @MJ_AIAgentRuns_ConfigurationID_SecondaryScopes
    END

    CLOSE cascade_update_MJ_AIAgentRuns_ConfigurationID_cursor
    DEALLOCATE cascade_update_MJ_AIAgentRuns_ConfigurationID_cursor
    
    -- Cascade delete from AIConfigurationParam using cursor to call spDeleteAIConfigurationParam
    DECLARE @MJ_AIConfigurationParams_ConfigurationIDID uniqueidentifier
    DECLARE cascade_delete_MJ_AIConfigurationParams_ConfigurationID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[AIConfigurationParam]
        WHERE [ConfigurationID] = @ID
    
    OPEN cascade_delete_MJ_AIConfigurationParams_ConfigurationID_cursor
    FETCH NEXT FROM cascade_delete_MJ_AIConfigurationParams_ConfigurationID_cursor INTO @MJ_AIConfigurationParams_ConfigurationIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteAIConfigurationParam] @ID = @MJ_AIConfigurationParams_ConfigurationIDID
        
        FETCH NEXT FROM cascade_delete_MJ_AIConfigurationParams_ConfigurationID_cursor INTO @MJ_AIConfigurationParams_ConfigurationIDID
    END
    
    CLOSE cascade_delete_MJ_AIConfigurationParams_ConfigurationID_cursor
    DEALLOCATE cascade_delete_MJ_AIConfigurationParams_ConfigurationID_cursor
    
    -- Cascade update on AIConfiguration using cursor to call spUpdateAIConfiguration
    DECLARE @MJ_AIConfigurations_ParentIDID uniqueidentifier
    DECLARE @MJ_AIConfigurations_ParentID_Name nvarchar(100)
    DECLARE @MJ_AIConfigurations_ParentID_Description nvarchar(MAX)
    DECLARE @MJ_AIConfigurations_ParentID_IsDefault bit
    DECLARE @MJ_AIConfigurations_ParentID_Status nvarchar(20)
    DECLARE @MJ_AIConfigurations_ParentID_DefaultPromptForContextCompressionID uniqueidentifier
    DECLARE @MJ_AIConfigurations_ParentID_DefaultPromptForContextSummarizationID uniqueidentifier
    DECLARE @MJ_AIConfigurations_ParentID_DefaultStorageProviderID uniqueidentifier
    DECLARE @MJ_AIConfigurations_ParentID_DefaultStorageRootPath nvarchar(500)
    DECLARE @MJ_AIConfigurations_ParentID_ParentID uniqueidentifier
    DECLARE cascade_update_MJ_AIConfigurations_ParentID_cursor CURSOR FOR
        SELECT [ID], [Name], [Description], [IsDefault], [Status], [DefaultPromptForContextCompressionID], [DefaultPromptForContextSummarizationID], [DefaultStorageProviderID], [DefaultStorageRootPath], [ParentID]
        FROM [${flyway:defaultSchema}].[AIConfiguration]
        WHERE [ParentID] = @ID

    OPEN cascade_update_MJ_AIConfigurations_ParentID_cursor
    FETCH NEXT FROM cascade_update_MJ_AIConfigurations_ParentID_cursor INTO @MJ_AIConfigurations_ParentIDID, @MJ_AIConfigurations_ParentID_Name, @MJ_AIConfigurations_ParentID_Description, @MJ_AIConfigurations_ParentID_IsDefault, @MJ_AIConfigurations_ParentID_Status, @MJ_AIConfigurations_ParentID_DefaultPromptForContextCompressionID, @MJ_AIConfigurations_ParentID_DefaultPromptForContextSummarizationID, @MJ_AIConfigurations_ParentID_DefaultStorageProviderID, @MJ_AIConfigurations_ParentID_DefaultStorageRootPath, @MJ_AIConfigurations_ParentID_ParentID

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @MJ_AIConfigurations_ParentID_ParentID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateAIConfiguration] @ID = @MJ_AIConfigurations_ParentIDID, @Name = @MJ_AIConfigurations_ParentID_Name, @Description = @MJ_AIConfigurations_ParentID_Description, @IsDefault = @MJ_AIConfigurations_ParentID_IsDefault, @Status = @MJ_AIConfigurations_ParentID_Status, @DefaultPromptForContextCompressionID = @MJ_AIConfigurations_ParentID_DefaultPromptForContextCompressionID, @DefaultPromptForContextSummarizationID = @MJ_AIConfigurations_ParentID_DefaultPromptForContextSummarizationID, @DefaultStorageProviderID = @MJ_AIConfigurations_ParentID_DefaultStorageProviderID, @DefaultStorageRootPath = @MJ_AIConfigurations_ParentID_DefaultStorageRootPath, @ParentID = @MJ_AIConfigurations_ParentID_ParentID

        FETCH NEXT FROM cascade_update_MJ_AIConfigurations_ParentID_cursor INTO @MJ_AIConfigurations_ParentIDID, @MJ_AIConfigurations_ParentID_Name, @MJ_AIConfigurations_ParentID_Description, @MJ_AIConfigurations_ParentID_IsDefault, @MJ_AIConfigurations_ParentID_Status, @MJ_AIConfigurations_ParentID_DefaultPromptForContextCompressionID, @MJ_AIConfigurations_ParentID_DefaultPromptForContextSummarizationID, @MJ_AIConfigurations_ParentID_DefaultStorageProviderID, @MJ_AIConfigurations_ParentID_DefaultStorageRootPath, @MJ_AIConfigurations_ParentID_ParentID
    END

    CLOSE cascade_update_MJ_AIConfigurations_ParentID_cursor
    DEALLOCATE cascade_update_MJ_AIConfigurations_ParentID_cursor
    
    -- Cascade update on AIPromptModel using cursor to call spUpdateAIPromptModel
    DECLARE @MJ_AIPromptModels_ConfigurationIDID uniqueidentifier
    DECLARE @MJ_AIPromptModels_ConfigurationID_PromptID uniqueidentifier
    DECLARE @MJ_AIPromptModels_ConfigurationID_ModelID uniqueidentifier
    DECLARE @MJ_AIPromptModels_ConfigurationID_VendorID uniqueidentifier
    DECLARE @MJ_AIPromptModels_ConfigurationID_ConfigurationID uniqueidentifier
    DECLARE @MJ_AIPromptModels_ConfigurationID_Priority int
    DECLARE @MJ_AIPromptModels_ConfigurationID_ExecutionGroup int
    DECLARE @MJ_AIPromptModels_ConfigurationID_ModelParameters nvarchar(MAX)
    DECLARE @MJ_AIPromptModels_ConfigurationID_Status nvarchar(20)
    DECLARE @MJ_AIPromptModels_ConfigurationID_ParallelizationMode nvarchar(20)
    DECLARE @MJ_AIPromptModels_ConfigurationID_ParallelCount int
    DECLARE @MJ_AIPromptModels_ConfigurationID_ParallelConfigParam nvarchar(100)
    DECLARE @MJ_AIPromptModels_ConfigurationID_EffortLevel int
    DECLARE cascade_update_MJ_AIPromptModels_ConfigurationID_cursor CURSOR FOR
        SELECT [ID], [PromptID], [ModelID], [VendorID], [ConfigurationID], [Priority], [ExecutionGroup], [ModelParameters], [Status], [ParallelizationMode], [ParallelCount], [ParallelConfigParam], [EffortLevel]
        FROM [${flyway:defaultSchema}].[AIPromptModel]
        WHERE [ConfigurationID] = @ID

    OPEN cascade_update_MJ_AIPromptModels_ConfigurationID_cursor
    FETCH NEXT FROM cascade_update_MJ_AIPromptModels_ConfigurationID_cursor INTO @MJ_AIPromptModels_ConfigurationIDID, @MJ_AIPromptModels_ConfigurationID_PromptID, @MJ_AIPromptModels_ConfigurationID_ModelID, @MJ_AIPromptModels_ConfigurationID_VendorID, @MJ_AIPromptModels_ConfigurationID_ConfigurationID, @MJ_AIPromptModels_ConfigurationID_Priority, @MJ_AIPromptModels_ConfigurationID_ExecutionGroup, @MJ_AIPromptModels_ConfigurationID_ModelParameters, @MJ_AIPromptModels_ConfigurationID_Status, @MJ_AIPromptModels_ConfigurationID_ParallelizationMode, @MJ_AIPromptModels_ConfigurationID_ParallelCount, @MJ_AIPromptModels_ConfigurationID_ParallelConfigParam, @MJ_AIPromptModels_ConfigurationID_EffortLevel

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @MJ_AIPromptModels_ConfigurationID_ConfigurationID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateAIPromptModel] @ID = @MJ_AIPromptModels_ConfigurationIDID, @PromptID = @MJ_AIPromptModels_ConfigurationID_PromptID, @ModelID = @MJ_AIPromptModels_ConfigurationID_ModelID, @VendorID = @MJ_AIPromptModels_ConfigurationID_VendorID, @ConfigurationID = @MJ_AIPromptModels_ConfigurationID_ConfigurationID, @Priority = @MJ_AIPromptModels_ConfigurationID_Priority, @ExecutionGroup = @MJ_AIPromptModels_ConfigurationID_ExecutionGroup, @ModelParameters = @MJ_AIPromptModels_ConfigurationID_ModelParameters, @Status = @MJ_AIPromptModels_ConfigurationID_Status, @ParallelizationMode = @MJ_AIPromptModels_ConfigurationID_ParallelizationMode, @ParallelCount = @MJ_AIPromptModels_ConfigurationID_ParallelCount, @ParallelConfigParam = @MJ_AIPromptModels_ConfigurationID_ParallelConfigParam, @EffortLevel = @MJ_AIPromptModels_ConfigurationID_EffortLevel

        FETCH NEXT FROM cascade_update_MJ_AIPromptModels_ConfigurationID_cursor INTO @MJ_AIPromptModels_ConfigurationIDID, @MJ_AIPromptModels_ConfigurationID_PromptID, @MJ_AIPromptModels_ConfigurationID_ModelID, @MJ_AIPromptModels_ConfigurationID_VendorID, @MJ_AIPromptModels_ConfigurationID_ConfigurationID, @MJ_AIPromptModels_ConfigurationID_Priority, @MJ_AIPromptModels_ConfigurationID_ExecutionGroup, @MJ_AIPromptModels_ConfigurationID_ModelParameters, @MJ_AIPromptModels_ConfigurationID_Status, @MJ_AIPromptModels_ConfigurationID_ParallelizationMode, @MJ_AIPromptModels_ConfigurationID_ParallelCount, @MJ_AIPromptModels_ConfigurationID_ParallelConfigParam, @MJ_AIPromptModels_ConfigurationID_EffortLevel
    END

    CLOSE cascade_update_MJ_AIPromptModels_ConfigurationID_cursor
    DEALLOCATE cascade_update_MJ_AIPromptModels_ConfigurationID_cursor
    
    -- Cascade update on AIPromptRun using cursor to call spUpdateAIPromptRun
    DECLARE @MJ_AIPromptRuns_ConfigurationIDID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_ConfigurationID_PromptID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_ConfigurationID_ModelID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_ConfigurationID_VendorID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_ConfigurationID_AgentID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_ConfigurationID_ConfigurationID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_ConfigurationID_RunAt datetimeoffset
    DECLARE @MJ_AIPromptRuns_ConfigurationID_CompletedAt datetimeoffset
    DECLARE @MJ_AIPromptRuns_ConfigurationID_ExecutionTimeMS int
    DECLARE @MJ_AIPromptRuns_ConfigurationID_Messages nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_ConfigurationID_Result nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_ConfigurationID_TokensUsed int
    DECLARE @MJ_AIPromptRuns_ConfigurationID_TokensPrompt int
    DECLARE @MJ_AIPromptRuns_ConfigurationID_TokensCompletion int
    DECLARE @MJ_AIPromptRuns_ConfigurationID_TotalCost decimal(18, 6)
    DECLARE @MJ_AIPromptRuns_ConfigurationID_Success bit
    DECLARE @MJ_AIPromptRuns_ConfigurationID_ErrorMessage nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_ConfigurationID_ParentID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_ConfigurationID_RunType nvarchar(20)
    DECLARE @MJ_AIPromptRuns_ConfigurationID_ExecutionOrder int
    DECLARE @MJ_AIPromptRuns_ConfigurationID_AgentRunID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_ConfigurationID_Cost decimal(19, 8)
    DECLARE @MJ_AIPromptRuns_ConfigurationID_CostCurrency nvarchar(10)
    DECLARE @MJ_AIPromptRuns_ConfigurationID_TokensUsedRollup int
    DECLARE @MJ_AIPromptRuns_ConfigurationID_TokensPromptRollup int
    DECLARE @MJ_AIPromptRuns_ConfigurationID_TokensCompletionRollup int
    DECLARE @MJ_AIPromptRuns_ConfigurationID_Temperature decimal(3, 2)
    DECLARE @MJ_AIPromptRuns_ConfigurationID_TopP decimal(3, 2)
    DECLARE @MJ_AIPromptRuns_ConfigurationID_TopK int
    DECLARE @MJ_AIPromptRuns_ConfigurationID_MinP decimal(3, 2)
    DECLARE @MJ_AIPromptRuns_ConfigurationID_FrequencyPenalty decimal(3, 2)
    DECLARE @MJ_AIPromptRuns_ConfigurationID_PresencePenalty decimal(3, 2)
    DECLARE @MJ_AIPromptRuns_ConfigurationID_Seed int
    DECLARE @MJ_AIPromptRuns_ConfigurationID_StopSequences nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_ConfigurationID_ResponseFormat nvarchar(50)
    DECLARE @MJ_AIPromptRuns_ConfigurationID_LogProbs bit
    DECLARE @MJ_AIPromptRuns_ConfigurationID_TopLogProbs int
    DECLARE @MJ_AIPromptRuns_ConfigurationID_DescendantCost decimal(18, 6)
    DECLARE @MJ_AIPromptRuns_ConfigurationID_ValidationAttemptCount int
    DECLARE @MJ_AIPromptRuns_ConfigurationID_SuccessfulValidationCount int
    DECLARE @MJ_AIPromptRuns_ConfigurationID_FinalValidationPassed bit
    DECLARE @MJ_AIPromptRuns_ConfigurationID_ValidationBehavior nvarchar(50)
    DECLARE @MJ_AIPromptRuns_ConfigurationID_RetryStrategy nvarchar(50)
    DECLARE @MJ_AIPromptRuns_ConfigurationID_MaxRetriesConfigured int
    DECLARE @MJ_AIPromptRuns_ConfigurationID_FinalValidationError nvarchar(500)
    DECLARE @MJ_AIPromptRuns_ConfigurationID_ValidationErrorCount int
    DECLARE @MJ_AIPromptRuns_ConfigurationID_CommonValidationError nvarchar(255)
    DECLARE @MJ_AIPromptRuns_ConfigurationID_FirstAttemptAt datetimeoffset
    DECLARE @MJ_AIPromptRuns_ConfigurationID_LastAttemptAt datetimeoffset
    DECLARE @MJ_AIPromptRuns_ConfigurationID_TotalRetryDurationMS int
    DECLARE @MJ_AIPromptRuns_ConfigurationID_ValidationAttempts nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_ConfigurationID_ValidationSummary nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_ConfigurationID_FailoverAttempts int
    DECLARE @MJ_AIPromptRuns_ConfigurationID_FailoverErrors nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_ConfigurationID_FailoverDurations nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_ConfigurationID_OriginalModelID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_ConfigurationID_OriginalRequestStartTime datetimeoffset
    DECLARE @MJ_AIPromptRuns_ConfigurationID_TotalFailoverDuration int
    DECLARE @MJ_AIPromptRuns_ConfigurationID_RerunFromPromptRunID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_ConfigurationID_ModelSelection nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_ConfigurationID_Status nvarchar(50)
    DECLARE @MJ_AIPromptRuns_ConfigurationID_Cancelled bit
    DECLARE @MJ_AIPromptRuns_ConfigurationID_CancellationReason nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_ConfigurationID_ModelPowerRank int
    DECLARE @MJ_AIPromptRuns_ConfigurationID_SelectionStrategy nvarchar(50)
    DECLARE @MJ_AIPromptRuns_ConfigurationID_CacheHit bit
    DECLARE @MJ_AIPromptRuns_ConfigurationID_CacheKey nvarchar(500)
    DECLARE @MJ_AIPromptRuns_ConfigurationID_JudgeID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_ConfigurationID_JudgeScore float(53)
    DECLARE @MJ_AIPromptRuns_ConfigurationID_WasSelectedResult bit
    DECLARE @MJ_AIPromptRuns_ConfigurationID_StreamingEnabled bit
    DECLARE @MJ_AIPromptRuns_ConfigurationID_FirstTokenTime int
    DECLARE @MJ_AIPromptRuns_ConfigurationID_ErrorDetails nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_ConfigurationID_ChildPromptID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_ConfigurationID_QueueTime int
    DECLARE @MJ_AIPromptRuns_ConfigurationID_PromptTime int
    DECLARE @MJ_AIPromptRuns_ConfigurationID_CompletionTime int
    DECLARE @MJ_AIPromptRuns_ConfigurationID_ModelSpecificResponseDetails nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_ConfigurationID_EffortLevel int
    DECLARE @MJ_AIPromptRuns_ConfigurationID_RunName nvarchar(255)
    DECLARE @MJ_AIPromptRuns_ConfigurationID_Comments nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_ConfigurationID_TestRunID uniqueidentifier
    DECLARE cascade_update_MJ_AIPromptRuns_ConfigurationID_cursor CURSOR FOR
        SELECT [ID], [PromptID], [ModelID], [VendorID], [AgentID], [ConfigurationID], [RunAt], [CompletedAt], [ExecutionTimeMS], [Messages], [Result], [TokensUsed], [TokensPrompt], [TokensCompletion], [TotalCost], [Success], [ErrorMessage], [ParentID], [RunType], [ExecutionOrder], [AgentRunID], [Cost], [CostCurrency], [TokensUsedRollup], [TokensPromptRollup], [TokensCompletionRollup], [Temperature], [TopP], [TopK], [MinP], [FrequencyPenalty], [PresencePenalty], [Seed], [StopSequences], [ResponseFormat], [LogProbs], [TopLogProbs], [DescendantCost], [ValidationAttemptCount], [SuccessfulValidationCount], [FinalValidationPassed], [ValidationBehavior], [RetryStrategy], [MaxRetriesConfigured], [FinalValidationError], [ValidationErrorCount], [CommonValidationError], [FirstAttemptAt], [LastAttemptAt], [TotalRetryDurationMS], [ValidationAttempts], [ValidationSummary], [FailoverAttempts], [FailoverErrors], [FailoverDurations], [OriginalModelID], [OriginalRequestStartTime], [TotalFailoverDuration], [RerunFromPromptRunID], [ModelSelection], [Status], [Cancelled], [CancellationReason], [ModelPowerRank], [SelectionStrategy], [CacheHit], [CacheKey], [JudgeID], [JudgeScore], [WasSelectedResult], [StreamingEnabled], [FirstTokenTime], [ErrorDetails], [ChildPromptID], [QueueTime], [PromptTime], [CompletionTime], [ModelSpecificResponseDetails], [EffortLevel], [RunName], [Comments], [TestRunID]
        FROM [${flyway:defaultSchema}].[AIPromptRun]
        WHERE [ConfigurationID] = @ID

    OPEN cascade_update_MJ_AIPromptRuns_ConfigurationID_cursor
    FETCH NEXT FROM cascade_update_MJ_AIPromptRuns_ConfigurationID_cursor INTO @MJ_AIPromptRuns_ConfigurationIDID, @MJ_AIPromptRuns_ConfigurationID_PromptID, @MJ_AIPromptRuns_ConfigurationID_ModelID, @MJ_AIPromptRuns_ConfigurationID_VendorID, @MJ_AIPromptRuns_ConfigurationID_AgentID, @MJ_AIPromptRuns_ConfigurationID_ConfigurationID, @MJ_AIPromptRuns_ConfigurationID_RunAt, @MJ_AIPromptRuns_ConfigurationID_CompletedAt, @MJ_AIPromptRuns_ConfigurationID_ExecutionTimeMS, @MJ_AIPromptRuns_ConfigurationID_Messages, @MJ_AIPromptRuns_ConfigurationID_Result, @MJ_AIPromptRuns_ConfigurationID_TokensUsed, @MJ_AIPromptRuns_ConfigurationID_TokensPrompt, @MJ_AIPromptRuns_ConfigurationID_TokensCompletion, @MJ_AIPromptRuns_ConfigurationID_TotalCost, @MJ_AIPromptRuns_ConfigurationID_Success, @MJ_AIPromptRuns_ConfigurationID_ErrorMessage, @MJ_AIPromptRuns_ConfigurationID_ParentID, @MJ_AIPromptRuns_ConfigurationID_RunType, @MJ_AIPromptRuns_ConfigurationID_ExecutionOrder, @MJ_AIPromptRuns_ConfigurationID_AgentRunID, @MJ_AIPromptRuns_ConfigurationID_Cost, @MJ_AIPromptRuns_ConfigurationID_CostCurrency, @MJ_AIPromptRuns_ConfigurationID_TokensUsedRollup, @MJ_AIPromptRuns_ConfigurationID_TokensPromptRollup, @MJ_AIPromptRuns_ConfigurationID_TokensCompletionRollup, @MJ_AIPromptRuns_ConfigurationID_Temperature, @MJ_AIPromptRuns_ConfigurationID_TopP, @MJ_AIPromptRuns_ConfigurationID_TopK, @MJ_AIPromptRuns_ConfigurationID_MinP, @MJ_AIPromptRuns_ConfigurationID_FrequencyPenalty, @MJ_AIPromptRuns_ConfigurationID_PresencePenalty, @MJ_AIPromptRuns_ConfigurationID_Seed, @MJ_AIPromptRuns_ConfigurationID_StopSequences, @MJ_AIPromptRuns_ConfigurationID_ResponseFormat, @MJ_AIPromptRuns_ConfigurationID_LogProbs, @MJ_AIPromptRuns_ConfigurationID_TopLogProbs, @MJ_AIPromptRuns_ConfigurationID_DescendantCost, @MJ_AIPromptRuns_ConfigurationID_ValidationAttemptCount, @MJ_AIPromptRuns_ConfigurationID_SuccessfulValidationCount, @MJ_AIPromptRuns_ConfigurationID_FinalValidationPassed, @MJ_AIPromptRuns_ConfigurationID_ValidationBehavior, @MJ_AIPromptRuns_ConfigurationID_RetryStrategy, @MJ_AIPromptRuns_ConfigurationID_MaxRetriesConfigured, @MJ_AIPromptRuns_ConfigurationID_FinalValidationError, @MJ_AIPromptRuns_ConfigurationID_ValidationErrorCount, @MJ_AIPromptRuns_ConfigurationID_CommonValidationError, @MJ_AIPromptRuns_ConfigurationID_FirstAttemptAt, @MJ_AIPromptRuns_ConfigurationID_LastAttemptAt, @MJ_AIPromptRuns_ConfigurationID_TotalRetryDurationMS, @MJ_AIPromptRuns_ConfigurationID_ValidationAttempts, @MJ_AIPromptRuns_ConfigurationID_ValidationSummary, @MJ_AIPromptRuns_ConfigurationID_FailoverAttempts, @MJ_AIPromptRuns_ConfigurationID_FailoverErrors, @MJ_AIPromptRuns_ConfigurationID_FailoverDurations, @MJ_AIPromptRuns_ConfigurationID_OriginalModelID, @MJ_AIPromptRuns_ConfigurationID_OriginalRequestStartTime, @MJ_AIPromptRuns_ConfigurationID_TotalFailoverDuration, @MJ_AIPromptRuns_ConfigurationID_RerunFromPromptRunID, @MJ_AIPromptRuns_ConfigurationID_ModelSelection, @MJ_AIPromptRuns_ConfigurationID_Status, @MJ_AIPromptRuns_ConfigurationID_Cancelled, @MJ_AIPromptRuns_ConfigurationID_CancellationReason, @MJ_AIPromptRuns_ConfigurationID_ModelPowerRank, @MJ_AIPromptRuns_ConfigurationID_SelectionStrategy, @MJ_AIPromptRuns_ConfigurationID_CacheHit, @MJ_AIPromptRuns_ConfigurationID_CacheKey, @MJ_AIPromptRuns_ConfigurationID_JudgeID, @MJ_AIPromptRuns_ConfigurationID_JudgeScore, @MJ_AIPromptRuns_ConfigurationID_WasSelectedResult, @MJ_AIPromptRuns_ConfigurationID_StreamingEnabled, @MJ_AIPromptRuns_ConfigurationID_FirstTokenTime, @MJ_AIPromptRuns_ConfigurationID_ErrorDetails, @MJ_AIPromptRuns_ConfigurationID_ChildPromptID, @MJ_AIPromptRuns_ConfigurationID_QueueTime, @MJ_AIPromptRuns_ConfigurationID_PromptTime, @MJ_AIPromptRuns_ConfigurationID_CompletionTime, @MJ_AIPromptRuns_ConfigurationID_ModelSpecificResponseDetails, @MJ_AIPromptRuns_ConfigurationID_EffortLevel, @MJ_AIPromptRuns_ConfigurationID_RunName, @MJ_AIPromptRuns_ConfigurationID_Comments, @MJ_AIPromptRuns_ConfigurationID_TestRunID

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @MJ_AIPromptRuns_ConfigurationID_ConfigurationID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateAIPromptRun] @ID = @MJ_AIPromptRuns_ConfigurationIDID, @PromptID = @MJ_AIPromptRuns_ConfigurationID_PromptID, @ModelID = @MJ_AIPromptRuns_ConfigurationID_ModelID, @VendorID = @MJ_AIPromptRuns_ConfigurationID_VendorID, @AgentID = @MJ_AIPromptRuns_ConfigurationID_AgentID, @ConfigurationID = @MJ_AIPromptRuns_ConfigurationID_ConfigurationID, @RunAt = @MJ_AIPromptRuns_ConfigurationID_RunAt, @CompletedAt = @MJ_AIPromptRuns_ConfigurationID_CompletedAt, @ExecutionTimeMS = @MJ_AIPromptRuns_ConfigurationID_ExecutionTimeMS, @Messages = @MJ_AIPromptRuns_ConfigurationID_Messages, @Result = @MJ_AIPromptRuns_ConfigurationID_Result, @TokensUsed = @MJ_AIPromptRuns_ConfigurationID_TokensUsed, @TokensPrompt = @MJ_AIPromptRuns_ConfigurationID_TokensPrompt, @TokensCompletion = @MJ_AIPromptRuns_ConfigurationID_TokensCompletion, @TotalCost = @MJ_AIPromptRuns_ConfigurationID_TotalCost, @Success = @MJ_AIPromptRuns_ConfigurationID_Success, @ErrorMessage = @MJ_AIPromptRuns_ConfigurationID_ErrorMessage, @ParentID = @MJ_AIPromptRuns_ConfigurationID_ParentID, @RunType = @MJ_AIPromptRuns_ConfigurationID_RunType, @ExecutionOrder = @MJ_AIPromptRuns_ConfigurationID_ExecutionOrder, @AgentRunID = @MJ_AIPromptRuns_ConfigurationID_AgentRunID, @Cost = @MJ_AIPromptRuns_ConfigurationID_Cost, @CostCurrency = @MJ_AIPromptRuns_ConfigurationID_CostCurrency, @TokensUsedRollup = @MJ_AIPromptRuns_ConfigurationID_TokensUsedRollup, @TokensPromptRollup = @MJ_AIPromptRuns_ConfigurationID_TokensPromptRollup, @TokensCompletionRollup = @MJ_AIPromptRuns_ConfigurationID_TokensCompletionRollup, @Temperature = @MJ_AIPromptRuns_ConfigurationID_Temperature, @TopP = @MJ_AIPromptRuns_ConfigurationID_TopP, @TopK = @MJ_AIPromptRuns_ConfigurationID_TopK, @MinP = @MJ_AIPromptRuns_ConfigurationID_MinP, @FrequencyPenalty = @MJ_AIPromptRuns_ConfigurationID_FrequencyPenalty, @PresencePenalty = @MJ_AIPromptRuns_ConfigurationID_PresencePenalty, @Seed = @MJ_AIPromptRuns_ConfigurationID_Seed, @StopSequences = @MJ_AIPromptRuns_ConfigurationID_StopSequences, @ResponseFormat = @MJ_AIPromptRuns_ConfigurationID_ResponseFormat, @LogProbs = @MJ_AIPromptRuns_ConfigurationID_LogProbs, @TopLogProbs = @MJ_AIPromptRuns_ConfigurationID_TopLogProbs, @DescendantCost = @MJ_AIPromptRuns_ConfigurationID_DescendantCost, @ValidationAttemptCount = @MJ_AIPromptRuns_ConfigurationID_ValidationAttemptCount, @SuccessfulValidationCount = @MJ_AIPromptRuns_ConfigurationID_SuccessfulValidationCount, @FinalValidationPassed = @MJ_AIPromptRuns_ConfigurationID_FinalValidationPassed, @ValidationBehavior = @MJ_AIPromptRuns_ConfigurationID_ValidationBehavior, @RetryStrategy = @MJ_AIPromptRuns_ConfigurationID_RetryStrategy, @MaxRetriesConfigured = @MJ_AIPromptRuns_ConfigurationID_MaxRetriesConfigured, @FinalValidationError = @MJ_AIPromptRuns_ConfigurationID_FinalValidationError, @ValidationErrorCount = @MJ_AIPromptRuns_ConfigurationID_ValidationErrorCount, @CommonValidationError = @MJ_AIPromptRuns_ConfigurationID_CommonValidationError, @FirstAttemptAt = @MJ_AIPromptRuns_ConfigurationID_FirstAttemptAt, @LastAttemptAt = @MJ_AIPromptRuns_ConfigurationID_LastAttemptAt, @TotalRetryDurationMS = @MJ_AIPromptRuns_ConfigurationID_TotalRetryDurationMS, @ValidationAttempts = @MJ_AIPromptRuns_ConfigurationID_ValidationAttempts, @ValidationSummary = @MJ_AIPromptRuns_ConfigurationID_ValidationSummary, @FailoverAttempts = @MJ_AIPromptRuns_ConfigurationID_FailoverAttempts, @FailoverErrors = @MJ_AIPromptRuns_ConfigurationID_FailoverErrors, @FailoverDurations = @MJ_AIPromptRuns_ConfigurationID_FailoverDurations, @OriginalModelID = @MJ_AIPromptRuns_ConfigurationID_OriginalModelID, @OriginalRequestStartTime = @MJ_AIPromptRuns_ConfigurationID_OriginalRequestStartTime, @TotalFailoverDuration = @MJ_AIPromptRuns_ConfigurationID_TotalFailoverDuration, @RerunFromPromptRunID = @MJ_AIPromptRuns_ConfigurationID_RerunFromPromptRunID, @ModelSelection = @MJ_AIPromptRuns_ConfigurationID_ModelSelection, @Status = @MJ_AIPromptRuns_ConfigurationID_Status, @Cancelled = @MJ_AIPromptRuns_ConfigurationID_Cancelled, @CancellationReason = @MJ_AIPromptRuns_ConfigurationID_CancellationReason, @ModelPowerRank = @MJ_AIPromptRuns_ConfigurationID_ModelPowerRank, @SelectionStrategy = @MJ_AIPromptRuns_ConfigurationID_SelectionStrategy, @CacheHit = @MJ_AIPromptRuns_ConfigurationID_CacheHit, @CacheKey = @MJ_AIPromptRuns_ConfigurationID_CacheKey, @JudgeID = @MJ_AIPromptRuns_ConfigurationID_JudgeID, @JudgeScore = @MJ_AIPromptRuns_ConfigurationID_JudgeScore, @WasSelectedResult = @MJ_AIPromptRuns_ConfigurationID_WasSelectedResult, @StreamingEnabled = @MJ_AIPromptRuns_ConfigurationID_StreamingEnabled, @FirstTokenTime = @MJ_AIPromptRuns_ConfigurationID_FirstTokenTime, @ErrorDetails = @MJ_AIPromptRuns_ConfigurationID_ErrorDetails, @ChildPromptID = @MJ_AIPromptRuns_ConfigurationID_ChildPromptID, @QueueTime = @MJ_AIPromptRuns_ConfigurationID_QueueTime, @PromptTime = @MJ_AIPromptRuns_ConfigurationID_PromptTime, @CompletionTime = @MJ_AIPromptRuns_ConfigurationID_CompletionTime, @ModelSpecificResponseDetails = @MJ_AIPromptRuns_ConfigurationID_ModelSpecificResponseDetails, @EffortLevel = @MJ_AIPromptRuns_ConfigurationID_EffortLevel, @RunName = @MJ_AIPromptRuns_ConfigurationID_RunName, @Comments = @MJ_AIPromptRuns_ConfigurationID_Comments, @TestRunID = @MJ_AIPromptRuns_ConfigurationID_TestRunID

        FETCH NEXT FROM cascade_update_MJ_AIPromptRuns_ConfigurationID_cursor INTO @MJ_AIPromptRuns_ConfigurationIDID, @MJ_AIPromptRuns_ConfigurationID_PromptID, @MJ_AIPromptRuns_ConfigurationID_ModelID, @MJ_AIPromptRuns_ConfigurationID_VendorID, @MJ_AIPromptRuns_ConfigurationID_AgentID, @MJ_AIPromptRuns_ConfigurationID_ConfigurationID, @MJ_AIPromptRuns_ConfigurationID_RunAt, @MJ_AIPromptRuns_ConfigurationID_CompletedAt, @MJ_AIPromptRuns_ConfigurationID_ExecutionTimeMS, @MJ_AIPromptRuns_ConfigurationID_Messages, @MJ_AIPromptRuns_ConfigurationID_Result, @MJ_AIPromptRuns_ConfigurationID_TokensUsed, @MJ_AIPromptRuns_ConfigurationID_TokensPrompt, @MJ_AIPromptRuns_ConfigurationID_TokensCompletion, @MJ_AIPromptRuns_ConfigurationID_TotalCost, @MJ_AIPromptRuns_ConfigurationID_Success, @MJ_AIPromptRuns_ConfigurationID_ErrorMessage, @MJ_AIPromptRuns_ConfigurationID_ParentID, @MJ_AIPromptRuns_ConfigurationID_RunType, @MJ_AIPromptRuns_ConfigurationID_ExecutionOrder, @MJ_AIPromptRuns_ConfigurationID_AgentRunID, @MJ_AIPromptRuns_ConfigurationID_Cost, @MJ_AIPromptRuns_ConfigurationID_CostCurrency, @MJ_AIPromptRuns_ConfigurationID_TokensUsedRollup, @MJ_AIPromptRuns_ConfigurationID_TokensPromptRollup, @MJ_AIPromptRuns_ConfigurationID_TokensCompletionRollup, @MJ_AIPromptRuns_ConfigurationID_Temperature, @MJ_AIPromptRuns_ConfigurationID_TopP, @MJ_AIPromptRuns_ConfigurationID_TopK, @MJ_AIPromptRuns_ConfigurationID_MinP, @MJ_AIPromptRuns_ConfigurationID_FrequencyPenalty, @MJ_AIPromptRuns_ConfigurationID_PresencePenalty, @MJ_AIPromptRuns_ConfigurationID_Seed, @MJ_AIPromptRuns_ConfigurationID_StopSequences, @MJ_AIPromptRuns_ConfigurationID_ResponseFormat, @MJ_AIPromptRuns_ConfigurationID_LogProbs, @MJ_AIPromptRuns_ConfigurationID_TopLogProbs, @MJ_AIPromptRuns_ConfigurationID_DescendantCost, @MJ_AIPromptRuns_ConfigurationID_ValidationAttemptCount, @MJ_AIPromptRuns_ConfigurationID_SuccessfulValidationCount, @MJ_AIPromptRuns_ConfigurationID_FinalValidationPassed, @MJ_AIPromptRuns_ConfigurationID_ValidationBehavior, @MJ_AIPromptRuns_ConfigurationID_RetryStrategy, @MJ_AIPromptRuns_ConfigurationID_MaxRetriesConfigured, @MJ_AIPromptRuns_ConfigurationID_FinalValidationError, @MJ_AIPromptRuns_ConfigurationID_ValidationErrorCount, @MJ_AIPromptRuns_ConfigurationID_CommonValidationError, @MJ_AIPromptRuns_ConfigurationID_FirstAttemptAt, @MJ_AIPromptRuns_ConfigurationID_LastAttemptAt, @MJ_AIPromptRuns_ConfigurationID_TotalRetryDurationMS, @MJ_AIPromptRuns_ConfigurationID_ValidationAttempts, @MJ_AIPromptRuns_ConfigurationID_ValidationSummary, @MJ_AIPromptRuns_ConfigurationID_FailoverAttempts, @MJ_AIPromptRuns_ConfigurationID_FailoverErrors, @MJ_AIPromptRuns_ConfigurationID_FailoverDurations, @MJ_AIPromptRuns_ConfigurationID_OriginalModelID, @MJ_AIPromptRuns_ConfigurationID_OriginalRequestStartTime, @MJ_AIPromptRuns_ConfigurationID_TotalFailoverDuration, @MJ_AIPromptRuns_ConfigurationID_RerunFromPromptRunID, @MJ_AIPromptRuns_ConfigurationID_ModelSelection, @MJ_AIPromptRuns_ConfigurationID_Status, @MJ_AIPromptRuns_ConfigurationID_Cancelled, @MJ_AIPromptRuns_ConfigurationID_CancellationReason, @MJ_AIPromptRuns_ConfigurationID_ModelPowerRank, @MJ_AIPromptRuns_ConfigurationID_SelectionStrategy, @MJ_AIPromptRuns_ConfigurationID_CacheHit, @MJ_AIPromptRuns_ConfigurationID_CacheKey, @MJ_AIPromptRuns_ConfigurationID_JudgeID, @MJ_AIPromptRuns_ConfigurationID_JudgeScore, @MJ_AIPromptRuns_ConfigurationID_WasSelectedResult, @MJ_AIPromptRuns_ConfigurationID_StreamingEnabled, @MJ_AIPromptRuns_ConfigurationID_FirstTokenTime, @MJ_AIPromptRuns_ConfigurationID_ErrorDetails, @MJ_AIPromptRuns_ConfigurationID_ChildPromptID, @MJ_AIPromptRuns_ConfigurationID_QueueTime, @MJ_AIPromptRuns_ConfigurationID_PromptTime, @MJ_AIPromptRuns_ConfigurationID_CompletionTime, @MJ_AIPromptRuns_ConfigurationID_ModelSpecificResponseDetails, @MJ_AIPromptRuns_ConfigurationID_EffortLevel, @MJ_AIPromptRuns_ConfigurationID_RunName, @MJ_AIPromptRuns_ConfigurationID_Comments, @MJ_AIPromptRuns_ConfigurationID_TestRunID
    END

    CLOSE cascade_update_MJ_AIPromptRuns_ConfigurationID_cursor
    DEALLOCATE cascade_update_MJ_AIPromptRuns_ConfigurationID_cursor
    

    DELETE FROM
        [${flyway:defaultSchema}].[AIConfiguration]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteAIConfiguration] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: AI Configurations */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteAIConfiguration] TO [cdp_Integration]



/* spDelete SQL for MJ: AI Prompt Runs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Prompt Runs
-- Item: spDeleteAIPromptRun
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR AIPromptRun
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteAIPromptRun]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteAIPromptRun];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteAIPromptRun]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    -- Cascade update on AIResultCache using cursor to call spUpdateAIResultCache
    DECLARE @AIResultCache_PromptRunIDID uniqueidentifier
    DECLARE @AIResultCache_PromptRunID_AIPromptID uniqueidentifier
    DECLARE @AIResultCache_PromptRunID_AIModelID uniqueidentifier
    DECLARE @AIResultCache_PromptRunID_RunAt datetimeoffset
    DECLARE @AIResultCache_PromptRunID_PromptText nvarchar(MAX)
    DECLARE @AIResultCache_PromptRunID_ResultText nvarchar(MAX)
    DECLARE @AIResultCache_PromptRunID_Status nvarchar(50)
    DECLARE @AIResultCache_PromptRunID_ExpiredOn datetimeoffset
    DECLARE @AIResultCache_PromptRunID_VendorID uniqueidentifier
    DECLARE @AIResultCache_PromptRunID_AgentID uniqueidentifier
    DECLARE @AIResultCache_PromptRunID_ConfigurationID uniqueidentifier
    DECLARE @AIResultCache_PromptRunID_PromptEmbedding varbinary
    DECLARE @AIResultCache_PromptRunID_PromptRunID uniqueidentifier
    DECLARE cascade_update_AIResultCache_PromptRunID_cursor CURSOR FOR
        SELECT [ID], [AIPromptID], [AIModelID], [RunAt], [PromptText], [ResultText], [Status], [ExpiredOn], [VendorID], [AgentID], [ConfigurationID], [PromptEmbedding], [PromptRunID]
        FROM [${flyway:defaultSchema}].[AIResultCache]
        WHERE [PromptRunID] = @ID

    OPEN cascade_update_AIResultCache_PromptRunID_cursor
    FETCH NEXT FROM cascade_update_AIResultCache_PromptRunID_cursor INTO @AIResultCache_PromptRunIDID, @AIResultCache_PromptRunID_AIPromptID, @AIResultCache_PromptRunID_AIModelID, @AIResultCache_PromptRunID_RunAt, @AIResultCache_PromptRunID_PromptText, @AIResultCache_PromptRunID_ResultText, @AIResultCache_PromptRunID_Status, @AIResultCache_PromptRunID_ExpiredOn, @AIResultCache_PromptRunID_VendorID, @AIResultCache_PromptRunID_AgentID, @AIResultCache_PromptRunID_ConfigurationID, @AIResultCache_PromptRunID_PromptEmbedding, @AIResultCache_PromptRunID_PromptRunID

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @AIResultCache_PromptRunID_PromptRunID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateAIResultCache] @ID = @AIResultCache_PromptRunIDID, @AIPromptID = @AIResultCache_PromptRunID_AIPromptID, @AIModelID = @AIResultCache_PromptRunID_AIModelID, @RunAt = @AIResultCache_PromptRunID_RunAt, @PromptText = @AIResultCache_PromptRunID_PromptText, @ResultText = @AIResultCache_PromptRunID_ResultText, @Status = @AIResultCache_PromptRunID_Status, @ExpiredOn = @AIResultCache_PromptRunID_ExpiredOn, @VendorID = @AIResultCache_PromptRunID_VendorID, @AgentID = @AIResultCache_PromptRunID_AgentID, @ConfigurationID = @AIResultCache_PromptRunID_ConfigurationID, @PromptEmbedding = @AIResultCache_PromptRunID_PromptEmbedding, @PromptRunID = @AIResultCache_PromptRunID_PromptRunID

        FETCH NEXT FROM cascade_update_AIResultCache_PromptRunID_cursor INTO @AIResultCache_PromptRunIDID, @AIResultCache_PromptRunID_AIPromptID, @AIResultCache_PromptRunID_AIModelID, @AIResultCache_PromptRunID_RunAt, @AIResultCache_PromptRunID_PromptText, @AIResultCache_PromptRunID_ResultText, @AIResultCache_PromptRunID_Status, @AIResultCache_PromptRunID_ExpiredOn, @AIResultCache_PromptRunID_VendorID, @AIResultCache_PromptRunID_AgentID, @AIResultCache_PromptRunID_ConfigurationID, @AIResultCache_PromptRunID_PromptEmbedding, @AIResultCache_PromptRunID_PromptRunID
    END

    CLOSE cascade_update_AIResultCache_PromptRunID_cursor
    DEALLOCATE cascade_update_AIResultCache_PromptRunID_cursor
    
    -- Cascade delete from AIPromptRunMedia using cursor to call spDeleteAIPromptRunMedia
    DECLARE @MJ_AIPromptRunMedias_PromptRunIDID uniqueidentifier
    DECLARE cascade_delete_MJ_AIPromptRunMedias_PromptRunID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[AIPromptRunMedia]
        WHERE [PromptRunID] = @ID
    
    OPEN cascade_delete_MJ_AIPromptRunMedias_PromptRunID_cursor
    FETCH NEXT FROM cascade_delete_MJ_AIPromptRunMedias_PromptRunID_cursor INTO @MJ_AIPromptRunMedias_PromptRunIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteAIPromptRunMedia] @ID = @MJ_AIPromptRunMedias_PromptRunIDID
        
        FETCH NEXT FROM cascade_delete_MJ_AIPromptRunMedias_PromptRunID_cursor INTO @MJ_AIPromptRunMedias_PromptRunIDID
    END
    
    CLOSE cascade_delete_MJ_AIPromptRunMedias_PromptRunID_cursor
    DEALLOCATE cascade_delete_MJ_AIPromptRunMedias_PromptRunID_cursor
    
    -- Cascade update on AIPromptRun using cursor to call spUpdateAIPromptRun
    DECLARE @MJ_AIPromptRuns_ParentIDID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_ParentID_PromptID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_ParentID_ModelID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_ParentID_VendorID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_ParentID_AgentID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_ParentID_ConfigurationID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_ParentID_RunAt datetimeoffset
    DECLARE @MJ_AIPromptRuns_ParentID_CompletedAt datetimeoffset
    DECLARE @MJ_AIPromptRuns_ParentID_ExecutionTimeMS int
    DECLARE @MJ_AIPromptRuns_ParentID_Messages nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_ParentID_Result nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_ParentID_TokensUsed int
    DECLARE @MJ_AIPromptRuns_ParentID_TokensPrompt int
    DECLARE @MJ_AIPromptRuns_ParentID_TokensCompletion int
    DECLARE @MJ_AIPromptRuns_ParentID_TotalCost decimal(18, 6)
    DECLARE @MJ_AIPromptRuns_ParentID_Success bit
    DECLARE @MJ_AIPromptRuns_ParentID_ErrorMessage nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_ParentID_ParentID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_ParentID_RunType nvarchar(20)
    DECLARE @MJ_AIPromptRuns_ParentID_ExecutionOrder int
    DECLARE @MJ_AIPromptRuns_ParentID_AgentRunID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_ParentID_Cost decimal(19, 8)
    DECLARE @MJ_AIPromptRuns_ParentID_CostCurrency nvarchar(10)
    DECLARE @MJ_AIPromptRuns_ParentID_TokensUsedRollup int
    DECLARE @MJ_AIPromptRuns_ParentID_TokensPromptRollup int
    DECLARE @MJ_AIPromptRuns_ParentID_TokensCompletionRollup int
    DECLARE @MJ_AIPromptRuns_ParentID_Temperature decimal(3, 2)
    DECLARE @MJ_AIPromptRuns_ParentID_TopP decimal(3, 2)
    DECLARE @MJ_AIPromptRuns_ParentID_TopK int
    DECLARE @MJ_AIPromptRuns_ParentID_MinP decimal(3, 2)
    DECLARE @MJ_AIPromptRuns_ParentID_FrequencyPenalty decimal(3, 2)
    DECLARE @MJ_AIPromptRuns_ParentID_PresencePenalty decimal(3, 2)
    DECLARE @MJ_AIPromptRuns_ParentID_Seed int
    DECLARE @MJ_AIPromptRuns_ParentID_StopSequences nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_ParentID_ResponseFormat nvarchar(50)
    DECLARE @MJ_AIPromptRuns_ParentID_LogProbs bit
    DECLARE @MJ_AIPromptRuns_ParentID_TopLogProbs int
    DECLARE @MJ_AIPromptRuns_ParentID_DescendantCost decimal(18, 6)
    DECLARE @MJ_AIPromptRuns_ParentID_ValidationAttemptCount int
    DECLARE @MJ_AIPromptRuns_ParentID_SuccessfulValidationCount int
    DECLARE @MJ_AIPromptRuns_ParentID_FinalValidationPassed bit
    DECLARE @MJ_AIPromptRuns_ParentID_ValidationBehavior nvarchar(50)
    DECLARE @MJ_AIPromptRuns_ParentID_RetryStrategy nvarchar(50)
    DECLARE @MJ_AIPromptRuns_ParentID_MaxRetriesConfigured int
    DECLARE @MJ_AIPromptRuns_ParentID_FinalValidationError nvarchar(500)
    DECLARE @MJ_AIPromptRuns_ParentID_ValidationErrorCount int
    DECLARE @MJ_AIPromptRuns_ParentID_CommonValidationError nvarchar(255)
    DECLARE @MJ_AIPromptRuns_ParentID_FirstAttemptAt datetimeoffset
    DECLARE @MJ_AIPromptRuns_ParentID_LastAttemptAt datetimeoffset
    DECLARE @MJ_AIPromptRuns_ParentID_TotalRetryDurationMS int
    DECLARE @MJ_AIPromptRuns_ParentID_ValidationAttempts nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_ParentID_ValidationSummary nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_ParentID_FailoverAttempts int
    DECLARE @MJ_AIPromptRuns_ParentID_FailoverErrors nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_ParentID_FailoverDurations nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_ParentID_OriginalModelID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_ParentID_OriginalRequestStartTime datetimeoffset
    DECLARE @MJ_AIPromptRuns_ParentID_TotalFailoverDuration int
    DECLARE @MJ_AIPromptRuns_ParentID_RerunFromPromptRunID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_ParentID_ModelSelection nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_ParentID_Status nvarchar(50)
    DECLARE @MJ_AIPromptRuns_ParentID_Cancelled bit
    DECLARE @MJ_AIPromptRuns_ParentID_CancellationReason nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_ParentID_ModelPowerRank int
    DECLARE @MJ_AIPromptRuns_ParentID_SelectionStrategy nvarchar(50)
    DECLARE @MJ_AIPromptRuns_ParentID_CacheHit bit
    DECLARE @MJ_AIPromptRuns_ParentID_CacheKey nvarchar(500)
    DECLARE @MJ_AIPromptRuns_ParentID_JudgeID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_ParentID_JudgeScore float(53)
    DECLARE @MJ_AIPromptRuns_ParentID_WasSelectedResult bit
    DECLARE @MJ_AIPromptRuns_ParentID_StreamingEnabled bit
    DECLARE @MJ_AIPromptRuns_ParentID_FirstTokenTime int
    DECLARE @MJ_AIPromptRuns_ParentID_ErrorDetails nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_ParentID_ChildPromptID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_ParentID_QueueTime int
    DECLARE @MJ_AIPromptRuns_ParentID_PromptTime int
    DECLARE @MJ_AIPromptRuns_ParentID_CompletionTime int
    DECLARE @MJ_AIPromptRuns_ParentID_ModelSpecificResponseDetails nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_ParentID_EffortLevel int
    DECLARE @MJ_AIPromptRuns_ParentID_RunName nvarchar(255)
    DECLARE @MJ_AIPromptRuns_ParentID_Comments nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_ParentID_TestRunID uniqueidentifier
    DECLARE cascade_update_MJ_AIPromptRuns_ParentID_cursor CURSOR FOR
        SELECT [ID], [PromptID], [ModelID], [VendorID], [AgentID], [ConfigurationID], [RunAt], [CompletedAt], [ExecutionTimeMS], [Messages], [Result], [TokensUsed], [TokensPrompt], [TokensCompletion], [TotalCost], [Success], [ErrorMessage], [ParentID], [RunType], [ExecutionOrder], [AgentRunID], [Cost], [CostCurrency], [TokensUsedRollup], [TokensPromptRollup], [TokensCompletionRollup], [Temperature], [TopP], [TopK], [MinP], [FrequencyPenalty], [PresencePenalty], [Seed], [StopSequences], [ResponseFormat], [LogProbs], [TopLogProbs], [DescendantCost], [ValidationAttemptCount], [SuccessfulValidationCount], [FinalValidationPassed], [ValidationBehavior], [RetryStrategy], [MaxRetriesConfigured], [FinalValidationError], [ValidationErrorCount], [CommonValidationError], [FirstAttemptAt], [LastAttemptAt], [TotalRetryDurationMS], [ValidationAttempts], [ValidationSummary], [FailoverAttempts], [FailoverErrors], [FailoverDurations], [OriginalModelID], [OriginalRequestStartTime], [TotalFailoverDuration], [RerunFromPromptRunID], [ModelSelection], [Status], [Cancelled], [CancellationReason], [ModelPowerRank], [SelectionStrategy], [CacheHit], [CacheKey], [JudgeID], [JudgeScore], [WasSelectedResult], [StreamingEnabled], [FirstTokenTime], [ErrorDetails], [ChildPromptID], [QueueTime], [PromptTime], [CompletionTime], [ModelSpecificResponseDetails], [EffortLevel], [RunName], [Comments], [TestRunID]
        FROM [${flyway:defaultSchema}].[AIPromptRun]
        WHERE [ParentID] = @ID

    OPEN cascade_update_MJ_AIPromptRuns_ParentID_cursor
    FETCH NEXT FROM cascade_update_MJ_AIPromptRuns_ParentID_cursor INTO @MJ_AIPromptRuns_ParentIDID, @MJ_AIPromptRuns_ParentID_PromptID, @MJ_AIPromptRuns_ParentID_ModelID, @MJ_AIPromptRuns_ParentID_VendorID, @MJ_AIPromptRuns_ParentID_AgentID, @MJ_AIPromptRuns_ParentID_ConfigurationID, @MJ_AIPromptRuns_ParentID_RunAt, @MJ_AIPromptRuns_ParentID_CompletedAt, @MJ_AIPromptRuns_ParentID_ExecutionTimeMS, @MJ_AIPromptRuns_ParentID_Messages, @MJ_AIPromptRuns_ParentID_Result, @MJ_AIPromptRuns_ParentID_TokensUsed, @MJ_AIPromptRuns_ParentID_TokensPrompt, @MJ_AIPromptRuns_ParentID_TokensCompletion, @MJ_AIPromptRuns_ParentID_TotalCost, @MJ_AIPromptRuns_ParentID_Success, @MJ_AIPromptRuns_ParentID_ErrorMessage, @MJ_AIPromptRuns_ParentID_ParentID, @MJ_AIPromptRuns_ParentID_RunType, @MJ_AIPromptRuns_ParentID_ExecutionOrder, @MJ_AIPromptRuns_ParentID_AgentRunID, @MJ_AIPromptRuns_ParentID_Cost, @MJ_AIPromptRuns_ParentID_CostCurrency, @MJ_AIPromptRuns_ParentID_TokensUsedRollup, @MJ_AIPromptRuns_ParentID_TokensPromptRollup, @MJ_AIPromptRuns_ParentID_TokensCompletionRollup, @MJ_AIPromptRuns_ParentID_Temperature, @MJ_AIPromptRuns_ParentID_TopP, @MJ_AIPromptRuns_ParentID_TopK, @MJ_AIPromptRuns_ParentID_MinP, @MJ_AIPromptRuns_ParentID_FrequencyPenalty, @MJ_AIPromptRuns_ParentID_PresencePenalty, @MJ_AIPromptRuns_ParentID_Seed, @MJ_AIPromptRuns_ParentID_StopSequences, @MJ_AIPromptRuns_ParentID_ResponseFormat, @MJ_AIPromptRuns_ParentID_LogProbs, @MJ_AIPromptRuns_ParentID_TopLogProbs, @MJ_AIPromptRuns_ParentID_DescendantCost, @MJ_AIPromptRuns_ParentID_ValidationAttemptCount, @MJ_AIPromptRuns_ParentID_SuccessfulValidationCount, @MJ_AIPromptRuns_ParentID_FinalValidationPassed, @MJ_AIPromptRuns_ParentID_ValidationBehavior, @MJ_AIPromptRuns_ParentID_RetryStrategy, @MJ_AIPromptRuns_ParentID_MaxRetriesConfigured, @MJ_AIPromptRuns_ParentID_FinalValidationError, @MJ_AIPromptRuns_ParentID_ValidationErrorCount, @MJ_AIPromptRuns_ParentID_CommonValidationError, @MJ_AIPromptRuns_ParentID_FirstAttemptAt, @MJ_AIPromptRuns_ParentID_LastAttemptAt, @MJ_AIPromptRuns_ParentID_TotalRetryDurationMS, @MJ_AIPromptRuns_ParentID_ValidationAttempts, @MJ_AIPromptRuns_ParentID_ValidationSummary, @MJ_AIPromptRuns_ParentID_FailoverAttempts, @MJ_AIPromptRuns_ParentID_FailoverErrors, @MJ_AIPromptRuns_ParentID_FailoverDurations, @MJ_AIPromptRuns_ParentID_OriginalModelID, @MJ_AIPromptRuns_ParentID_OriginalRequestStartTime, @MJ_AIPromptRuns_ParentID_TotalFailoverDuration, @MJ_AIPromptRuns_ParentID_RerunFromPromptRunID, @MJ_AIPromptRuns_ParentID_ModelSelection, @MJ_AIPromptRuns_ParentID_Status, @MJ_AIPromptRuns_ParentID_Cancelled, @MJ_AIPromptRuns_ParentID_CancellationReason, @MJ_AIPromptRuns_ParentID_ModelPowerRank, @MJ_AIPromptRuns_ParentID_SelectionStrategy, @MJ_AIPromptRuns_ParentID_CacheHit, @MJ_AIPromptRuns_ParentID_CacheKey, @MJ_AIPromptRuns_ParentID_JudgeID, @MJ_AIPromptRuns_ParentID_JudgeScore, @MJ_AIPromptRuns_ParentID_WasSelectedResult, @MJ_AIPromptRuns_ParentID_StreamingEnabled, @MJ_AIPromptRuns_ParentID_FirstTokenTime, @MJ_AIPromptRuns_ParentID_ErrorDetails, @MJ_AIPromptRuns_ParentID_ChildPromptID, @MJ_AIPromptRuns_ParentID_QueueTime, @MJ_AIPromptRuns_ParentID_PromptTime, @MJ_AIPromptRuns_ParentID_CompletionTime, @MJ_AIPromptRuns_ParentID_ModelSpecificResponseDetails, @MJ_AIPromptRuns_ParentID_EffortLevel, @MJ_AIPromptRuns_ParentID_RunName, @MJ_AIPromptRuns_ParentID_Comments, @MJ_AIPromptRuns_ParentID_TestRunID

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @MJ_AIPromptRuns_ParentID_ParentID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateAIPromptRun] @ID = @MJ_AIPromptRuns_ParentIDID, @PromptID = @MJ_AIPromptRuns_ParentID_PromptID, @ModelID = @MJ_AIPromptRuns_ParentID_ModelID, @VendorID = @MJ_AIPromptRuns_ParentID_VendorID, @AgentID = @MJ_AIPromptRuns_ParentID_AgentID, @ConfigurationID = @MJ_AIPromptRuns_ParentID_ConfigurationID, @RunAt = @MJ_AIPromptRuns_ParentID_RunAt, @CompletedAt = @MJ_AIPromptRuns_ParentID_CompletedAt, @ExecutionTimeMS = @MJ_AIPromptRuns_ParentID_ExecutionTimeMS, @Messages = @MJ_AIPromptRuns_ParentID_Messages, @Result = @MJ_AIPromptRuns_ParentID_Result, @TokensUsed = @MJ_AIPromptRuns_ParentID_TokensUsed, @TokensPrompt = @MJ_AIPromptRuns_ParentID_TokensPrompt, @TokensCompletion = @MJ_AIPromptRuns_ParentID_TokensCompletion, @TotalCost = @MJ_AIPromptRuns_ParentID_TotalCost, @Success = @MJ_AIPromptRuns_ParentID_Success, @ErrorMessage = @MJ_AIPromptRuns_ParentID_ErrorMessage, @ParentID = @MJ_AIPromptRuns_ParentID_ParentID, @RunType = @MJ_AIPromptRuns_ParentID_RunType, @ExecutionOrder = @MJ_AIPromptRuns_ParentID_ExecutionOrder, @AgentRunID = @MJ_AIPromptRuns_ParentID_AgentRunID, @Cost = @MJ_AIPromptRuns_ParentID_Cost, @CostCurrency = @MJ_AIPromptRuns_ParentID_CostCurrency, @TokensUsedRollup = @MJ_AIPromptRuns_ParentID_TokensUsedRollup, @TokensPromptRollup = @MJ_AIPromptRuns_ParentID_TokensPromptRollup, @TokensCompletionRollup = @MJ_AIPromptRuns_ParentID_TokensCompletionRollup, @Temperature = @MJ_AIPromptRuns_ParentID_Temperature, @TopP = @MJ_AIPromptRuns_ParentID_TopP, @TopK = @MJ_AIPromptRuns_ParentID_TopK, @MinP = @MJ_AIPromptRuns_ParentID_MinP, @FrequencyPenalty = @MJ_AIPromptRuns_ParentID_FrequencyPenalty, @PresencePenalty = @MJ_AIPromptRuns_ParentID_PresencePenalty, @Seed = @MJ_AIPromptRuns_ParentID_Seed, @StopSequences = @MJ_AIPromptRuns_ParentID_StopSequences, @ResponseFormat = @MJ_AIPromptRuns_ParentID_ResponseFormat, @LogProbs = @MJ_AIPromptRuns_ParentID_LogProbs, @TopLogProbs = @MJ_AIPromptRuns_ParentID_TopLogProbs, @DescendantCost = @MJ_AIPromptRuns_ParentID_DescendantCost, @ValidationAttemptCount = @MJ_AIPromptRuns_ParentID_ValidationAttemptCount, @SuccessfulValidationCount = @MJ_AIPromptRuns_ParentID_SuccessfulValidationCount, @FinalValidationPassed = @MJ_AIPromptRuns_ParentID_FinalValidationPassed, @ValidationBehavior = @MJ_AIPromptRuns_ParentID_ValidationBehavior, @RetryStrategy = @MJ_AIPromptRuns_ParentID_RetryStrategy, @MaxRetriesConfigured = @MJ_AIPromptRuns_ParentID_MaxRetriesConfigured, @FinalValidationError = @MJ_AIPromptRuns_ParentID_FinalValidationError, @ValidationErrorCount = @MJ_AIPromptRuns_ParentID_ValidationErrorCount, @CommonValidationError = @MJ_AIPromptRuns_ParentID_CommonValidationError, @FirstAttemptAt = @MJ_AIPromptRuns_ParentID_FirstAttemptAt, @LastAttemptAt = @MJ_AIPromptRuns_ParentID_LastAttemptAt, @TotalRetryDurationMS = @MJ_AIPromptRuns_ParentID_TotalRetryDurationMS, @ValidationAttempts = @MJ_AIPromptRuns_ParentID_ValidationAttempts, @ValidationSummary = @MJ_AIPromptRuns_ParentID_ValidationSummary, @FailoverAttempts = @MJ_AIPromptRuns_ParentID_FailoverAttempts, @FailoverErrors = @MJ_AIPromptRuns_ParentID_FailoverErrors, @FailoverDurations = @MJ_AIPromptRuns_ParentID_FailoverDurations, @OriginalModelID = @MJ_AIPromptRuns_ParentID_OriginalModelID, @OriginalRequestStartTime = @MJ_AIPromptRuns_ParentID_OriginalRequestStartTime, @TotalFailoverDuration = @MJ_AIPromptRuns_ParentID_TotalFailoverDuration, @RerunFromPromptRunID = @MJ_AIPromptRuns_ParentID_RerunFromPromptRunID, @ModelSelection = @MJ_AIPromptRuns_ParentID_ModelSelection, @Status = @MJ_AIPromptRuns_ParentID_Status, @Cancelled = @MJ_AIPromptRuns_ParentID_Cancelled, @CancellationReason = @MJ_AIPromptRuns_ParentID_CancellationReason, @ModelPowerRank = @MJ_AIPromptRuns_ParentID_ModelPowerRank, @SelectionStrategy = @MJ_AIPromptRuns_ParentID_SelectionStrategy, @CacheHit = @MJ_AIPromptRuns_ParentID_CacheHit, @CacheKey = @MJ_AIPromptRuns_ParentID_CacheKey, @JudgeID = @MJ_AIPromptRuns_ParentID_JudgeID, @JudgeScore = @MJ_AIPromptRuns_ParentID_JudgeScore, @WasSelectedResult = @MJ_AIPromptRuns_ParentID_WasSelectedResult, @StreamingEnabled = @MJ_AIPromptRuns_ParentID_StreamingEnabled, @FirstTokenTime = @MJ_AIPromptRuns_ParentID_FirstTokenTime, @ErrorDetails = @MJ_AIPromptRuns_ParentID_ErrorDetails, @ChildPromptID = @MJ_AIPromptRuns_ParentID_ChildPromptID, @QueueTime = @MJ_AIPromptRuns_ParentID_QueueTime, @PromptTime = @MJ_AIPromptRuns_ParentID_PromptTime, @CompletionTime = @MJ_AIPromptRuns_ParentID_CompletionTime, @ModelSpecificResponseDetails = @MJ_AIPromptRuns_ParentID_ModelSpecificResponseDetails, @EffortLevel = @MJ_AIPromptRuns_ParentID_EffortLevel, @RunName = @MJ_AIPromptRuns_ParentID_RunName, @Comments = @MJ_AIPromptRuns_ParentID_Comments, @TestRunID = @MJ_AIPromptRuns_ParentID_TestRunID

        FETCH NEXT FROM cascade_update_MJ_AIPromptRuns_ParentID_cursor INTO @MJ_AIPromptRuns_ParentIDID, @MJ_AIPromptRuns_ParentID_PromptID, @MJ_AIPromptRuns_ParentID_ModelID, @MJ_AIPromptRuns_ParentID_VendorID, @MJ_AIPromptRuns_ParentID_AgentID, @MJ_AIPromptRuns_ParentID_ConfigurationID, @MJ_AIPromptRuns_ParentID_RunAt, @MJ_AIPromptRuns_ParentID_CompletedAt, @MJ_AIPromptRuns_ParentID_ExecutionTimeMS, @MJ_AIPromptRuns_ParentID_Messages, @MJ_AIPromptRuns_ParentID_Result, @MJ_AIPromptRuns_ParentID_TokensUsed, @MJ_AIPromptRuns_ParentID_TokensPrompt, @MJ_AIPromptRuns_ParentID_TokensCompletion, @MJ_AIPromptRuns_ParentID_TotalCost, @MJ_AIPromptRuns_ParentID_Success, @MJ_AIPromptRuns_ParentID_ErrorMessage, @MJ_AIPromptRuns_ParentID_ParentID, @MJ_AIPromptRuns_ParentID_RunType, @MJ_AIPromptRuns_ParentID_ExecutionOrder, @MJ_AIPromptRuns_ParentID_AgentRunID, @MJ_AIPromptRuns_ParentID_Cost, @MJ_AIPromptRuns_ParentID_CostCurrency, @MJ_AIPromptRuns_ParentID_TokensUsedRollup, @MJ_AIPromptRuns_ParentID_TokensPromptRollup, @MJ_AIPromptRuns_ParentID_TokensCompletionRollup, @MJ_AIPromptRuns_ParentID_Temperature, @MJ_AIPromptRuns_ParentID_TopP, @MJ_AIPromptRuns_ParentID_TopK, @MJ_AIPromptRuns_ParentID_MinP, @MJ_AIPromptRuns_ParentID_FrequencyPenalty, @MJ_AIPromptRuns_ParentID_PresencePenalty, @MJ_AIPromptRuns_ParentID_Seed, @MJ_AIPromptRuns_ParentID_StopSequences, @MJ_AIPromptRuns_ParentID_ResponseFormat, @MJ_AIPromptRuns_ParentID_LogProbs, @MJ_AIPromptRuns_ParentID_TopLogProbs, @MJ_AIPromptRuns_ParentID_DescendantCost, @MJ_AIPromptRuns_ParentID_ValidationAttemptCount, @MJ_AIPromptRuns_ParentID_SuccessfulValidationCount, @MJ_AIPromptRuns_ParentID_FinalValidationPassed, @MJ_AIPromptRuns_ParentID_ValidationBehavior, @MJ_AIPromptRuns_ParentID_RetryStrategy, @MJ_AIPromptRuns_ParentID_MaxRetriesConfigured, @MJ_AIPromptRuns_ParentID_FinalValidationError, @MJ_AIPromptRuns_ParentID_ValidationErrorCount, @MJ_AIPromptRuns_ParentID_CommonValidationError, @MJ_AIPromptRuns_ParentID_FirstAttemptAt, @MJ_AIPromptRuns_ParentID_LastAttemptAt, @MJ_AIPromptRuns_ParentID_TotalRetryDurationMS, @MJ_AIPromptRuns_ParentID_ValidationAttempts, @MJ_AIPromptRuns_ParentID_ValidationSummary, @MJ_AIPromptRuns_ParentID_FailoverAttempts, @MJ_AIPromptRuns_ParentID_FailoverErrors, @MJ_AIPromptRuns_ParentID_FailoverDurations, @MJ_AIPromptRuns_ParentID_OriginalModelID, @MJ_AIPromptRuns_ParentID_OriginalRequestStartTime, @MJ_AIPromptRuns_ParentID_TotalFailoverDuration, @MJ_AIPromptRuns_ParentID_RerunFromPromptRunID, @MJ_AIPromptRuns_ParentID_ModelSelection, @MJ_AIPromptRuns_ParentID_Status, @MJ_AIPromptRuns_ParentID_Cancelled, @MJ_AIPromptRuns_ParentID_CancellationReason, @MJ_AIPromptRuns_ParentID_ModelPowerRank, @MJ_AIPromptRuns_ParentID_SelectionStrategy, @MJ_AIPromptRuns_ParentID_CacheHit, @MJ_AIPromptRuns_ParentID_CacheKey, @MJ_AIPromptRuns_ParentID_JudgeID, @MJ_AIPromptRuns_ParentID_JudgeScore, @MJ_AIPromptRuns_ParentID_WasSelectedResult, @MJ_AIPromptRuns_ParentID_StreamingEnabled, @MJ_AIPromptRuns_ParentID_FirstTokenTime, @MJ_AIPromptRuns_ParentID_ErrorDetails, @MJ_AIPromptRuns_ParentID_ChildPromptID, @MJ_AIPromptRuns_ParentID_QueueTime, @MJ_AIPromptRuns_ParentID_PromptTime, @MJ_AIPromptRuns_ParentID_CompletionTime, @MJ_AIPromptRuns_ParentID_ModelSpecificResponseDetails, @MJ_AIPromptRuns_ParentID_EffortLevel, @MJ_AIPromptRuns_ParentID_RunName, @MJ_AIPromptRuns_ParentID_Comments, @MJ_AIPromptRuns_ParentID_TestRunID
    END

    CLOSE cascade_update_MJ_AIPromptRuns_ParentID_cursor
    DEALLOCATE cascade_update_MJ_AIPromptRuns_ParentID_cursor
    
    -- Cascade update on AIPromptRun using cursor to call spUpdateAIPromptRun
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunIDID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_PromptID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_ModelID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_VendorID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_AgentID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_ConfigurationID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_RunAt datetimeoffset
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_CompletedAt datetimeoffset
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_ExecutionTimeMS int
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_Messages nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_Result nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_TokensUsed int
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_TokensPrompt int
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_TokensCompletion int
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_TotalCost decimal(18, 6)
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_Success bit
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_ErrorMessage nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_ParentID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_RunType nvarchar(20)
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_ExecutionOrder int
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_AgentRunID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_Cost decimal(19, 8)
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_CostCurrency nvarchar(10)
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_TokensUsedRollup int
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_TokensPromptRollup int
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_TokensCompletionRollup int
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_Temperature decimal(3, 2)
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_TopP decimal(3, 2)
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_TopK int
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_MinP decimal(3, 2)
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_FrequencyPenalty decimal(3, 2)
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_PresencePenalty decimal(3, 2)
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_Seed int
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_StopSequences nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_ResponseFormat nvarchar(50)
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_LogProbs bit
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_TopLogProbs int
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_DescendantCost decimal(18, 6)
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_ValidationAttemptCount int
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_SuccessfulValidationCount int
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_FinalValidationPassed bit
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_ValidationBehavior nvarchar(50)
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_RetryStrategy nvarchar(50)
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_MaxRetriesConfigured int
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_FinalValidationError nvarchar(500)
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_ValidationErrorCount int
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_CommonValidationError nvarchar(255)
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_FirstAttemptAt datetimeoffset
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_LastAttemptAt datetimeoffset
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_TotalRetryDurationMS int
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_ValidationAttempts nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_ValidationSummary nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_FailoverAttempts int
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_FailoverErrors nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_FailoverDurations nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_OriginalModelID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_OriginalRequestStartTime datetimeoffset
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_TotalFailoverDuration int
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_RerunFromPromptRunID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_ModelSelection nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_Status nvarchar(50)
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_Cancelled bit
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_CancellationReason nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_ModelPowerRank int
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_SelectionStrategy nvarchar(50)
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_CacheHit bit
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_CacheKey nvarchar(500)
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_JudgeID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_JudgeScore float(53)
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_WasSelectedResult bit
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_StreamingEnabled bit
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_FirstTokenTime int
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_ErrorDetails nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_ChildPromptID uniqueidentifier
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_QueueTime int
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_PromptTime int
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_CompletionTime int
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_ModelSpecificResponseDetails nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_EffortLevel int
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_RunName nvarchar(255)
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_Comments nvarchar(MAX)
    DECLARE @MJ_AIPromptRuns_RerunFromPromptRunID_TestRunID uniqueidentifier
    DECLARE cascade_update_MJ_AIPromptRuns_RerunFromPromptRunID_cursor CURSOR FOR
        SELECT [ID], [PromptID], [ModelID], [VendorID], [AgentID], [ConfigurationID], [RunAt], [CompletedAt], [ExecutionTimeMS], [Messages], [Result], [TokensUsed], [TokensPrompt], [TokensCompletion], [TotalCost], [Success], [ErrorMessage], [ParentID], [RunType], [ExecutionOrder], [AgentRunID], [Cost], [CostCurrency], [TokensUsedRollup], [TokensPromptRollup], [TokensCompletionRollup], [Temperature], [TopP], [TopK], [MinP], [FrequencyPenalty], [PresencePenalty], [Seed], [StopSequences], [ResponseFormat], [LogProbs], [TopLogProbs], [DescendantCost], [ValidationAttemptCount], [SuccessfulValidationCount], [FinalValidationPassed], [ValidationBehavior], [RetryStrategy], [MaxRetriesConfigured], [FinalValidationError], [ValidationErrorCount], [CommonValidationError], [FirstAttemptAt], [LastAttemptAt], [TotalRetryDurationMS], [ValidationAttempts], [ValidationSummary], [FailoverAttempts], [FailoverErrors], [FailoverDurations], [OriginalModelID], [OriginalRequestStartTime], [TotalFailoverDuration], [RerunFromPromptRunID], [ModelSelection], [Status], [Cancelled], [CancellationReason], [ModelPowerRank], [SelectionStrategy], [CacheHit], [CacheKey], [JudgeID], [JudgeScore], [WasSelectedResult], [StreamingEnabled], [FirstTokenTime], [ErrorDetails], [ChildPromptID], [QueueTime], [PromptTime], [CompletionTime], [ModelSpecificResponseDetails], [EffortLevel], [RunName], [Comments], [TestRunID]
        FROM [${flyway:defaultSchema}].[AIPromptRun]
        WHERE [RerunFromPromptRunID] = @ID

    OPEN cascade_update_MJ_AIPromptRuns_RerunFromPromptRunID_cursor
    FETCH NEXT FROM cascade_update_MJ_AIPromptRuns_RerunFromPromptRunID_cursor INTO @MJ_AIPromptRuns_RerunFromPromptRunIDID, @MJ_AIPromptRuns_RerunFromPromptRunID_PromptID, @MJ_AIPromptRuns_RerunFromPromptRunID_ModelID, @MJ_AIPromptRuns_RerunFromPromptRunID_VendorID, @MJ_AIPromptRuns_RerunFromPromptRunID_AgentID, @MJ_AIPromptRuns_RerunFromPromptRunID_ConfigurationID, @MJ_AIPromptRuns_RerunFromPromptRunID_RunAt, @MJ_AIPromptRuns_RerunFromPromptRunID_CompletedAt, @MJ_AIPromptRuns_RerunFromPromptRunID_ExecutionTimeMS, @MJ_AIPromptRuns_RerunFromPromptRunID_Messages, @MJ_AIPromptRuns_RerunFromPromptRunID_Result, @MJ_AIPromptRuns_RerunFromPromptRunID_TokensUsed, @MJ_AIPromptRuns_RerunFromPromptRunID_TokensPrompt, @MJ_AIPromptRuns_RerunFromPromptRunID_TokensCompletion, @MJ_AIPromptRuns_RerunFromPromptRunID_TotalCost, @MJ_AIPromptRuns_RerunFromPromptRunID_Success, @MJ_AIPromptRuns_RerunFromPromptRunID_ErrorMessage, @MJ_AIPromptRuns_RerunFromPromptRunID_ParentID, @MJ_AIPromptRuns_RerunFromPromptRunID_RunType, @MJ_AIPromptRuns_RerunFromPromptRunID_ExecutionOrder, @MJ_AIPromptRuns_RerunFromPromptRunID_AgentRunID, @MJ_AIPromptRuns_RerunFromPromptRunID_Cost, @MJ_AIPromptRuns_RerunFromPromptRunID_CostCurrency, @MJ_AIPromptRuns_RerunFromPromptRunID_TokensUsedRollup, @MJ_AIPromptRuns_RerunFromPromptRunID_TokensPromptRollup, @MJ_AIPromptRuns_RerunFromPromptRunID_TokensCompletionRollup, @MJ_AIPromptRuns_RerunFromPromptRunID_Temperature, @MJ_AIPromptRuns_RerunFromPromptRunID_TopP, @MJ_AIPromptRuns_RerunFromPromptRunID_TopK, @MJ_AIPromptRuns_RerunFromPromptRunID_MinP, @MJ_AIPromptRuns_RerunFromPromptRunID_FrequencyPenalty, @MJ_AIPromptRuns_RerunFromPromptRunID_PresencePenalty, @MJ_AIPromptRuns_RerunFromPromptRunID_Seed, @MJ_AIPromptRuns_RerunFromPromptRunID_StopSequences, @MJ_AIPromptRuns_RerunFromPromptRunID_ResponseFormat, @MJ_AIPromptRuns_RerunFromPromptRunID_LogProbs, @MJ_AIPromptRuns_RerunFromPromptRunID_TopLogProbs, @MJ_AIPromptRuns_RerunFromPromptRunID_DescendantCost, @MJ_AIPromptRuns_RerunFromPromptRunID_ValidationAttemptCount, @MJ_AIPromptRuns_RerunFromPromptRunID_SuccessfulValidationCount, @MJ_AIPromptRuns_RerunFromPromptRunID_FinalValidationPassed, @MJ_AIPromptRuns_RerunFromPromptRunID_ValidationBehavior, @MJ_AIPromptRuns_RerunFromPromptRunID_RetryStrategy, @MJ_AIPromptRuns_RerunFromPromptRunID_MaxRetriesConfigured, @MJ_AIPromptRuns_RerunFromPromptRunID_FinalValidationError, @MJ_AIPromptRuns_RerunFromPromptRunID_ValidationErrorCount, @MJ_AIPromptRuns_RerunFromPromptRunID_CommonValidationError, @MJ_AIPromptRuns_RerunFromPromptRunID_FirstAttemptAt, @MJ_AIPromptRuns_RerunFromPromptRunID_LastAttemptAt, @MJ_AIPromptRuns_RerunFromPromptRunID_TotalRetryDurationMS, @MJ_AIPromptRuns_RerunFromPromptRunID_ValidationAttempts, @MJ_AIPromptRuns_RerunFromPromptRunID_ValidationSummary, @MJ_AIPromptRuns_RerunFromPromptRunID_FailoverAttempts, @MJ_AIPromptRuns_RerunFromPromptRunID_FailoverErrors, @MJ_AIPromptRuns_RerunFromPromptRunID_FailoverDurations, @MJ_AIPromptRuns_RerunFromPromptRunID_OriginalModelID, @MJ_AIPromptRuns_RerunFromPromptRunID_OriginalRequestStartTime, @MJ_AIPromptRuns_RerunFromPromptRunID_TotalFailoverDuration, @MJ_AIPromptRuns_RerunFromPromptRunID_RerunFromPromptRunID, @MJ_AIPromptRuns_RerunFromPromptRunID_ModelSelection, @MJ_AIPromptRuns_RerunFromPromptRunID_Status, @MJ_AIPromptRuns_RerunFromPromptRunID_Cancelled, @MJ_AIPromptRuns_RerunFromPromptRunID_CancellationReason, @MJ_AIPromptRuns_RerunFromPromptRunID_ModelPowerRank, @MJ_AIPromptRuns_RerunFromPromptRunID_SelectionStrategy, @MJ_AIPromptRuns_RerunFromPromptRunID_CacheHit, @MJ_AIPromptRuns_RerunFromPromptRunID_CacheKey, @MJ_AIPromptRuns_RerunFromPromptRunID_JudgeID, @MJ_AIPromptRuns_RerunFromPromptRunID_JudgeScore, @MJ_AIPromptRuns_RerunFromPromptRunID_WasSelectedResult, @MJ_AIPromptRuns_RerunFromPromptRunID_StreamingEnabled, @MJ_AIPromptRuns_RerunFromPromptRunID_FirstTokenTime, @MJ_AIPromptRuns_RerunFromPromptRunID_ErrorDetails, @MJ_AIPromptRuns_RerunFromPromptRunID_ChildPromptID, @MJ_AIPromptRuns_RerunFromPromptRunID_QueueTime, @MJ_AIPromptRuns_RerunFromPromptRunID_PromptTime, @MJ_AIPromptRuns_RerunFromPromptRunID_CompletionTime, @MJ_AIPromptRuns_RerunFromPromptRunID_ModelSpecificResponseDetails, @MJ_AIPromptRuns_RerunFromPromptRunID_EffortLevel, @MJ_AIPromptRuns_RerunFromPromptRunID_RunName, @MJ_AIPromptRuns_RerunFromPromptRunID_Comments, @MJ_AIPromptRuns_RerunFromPromptRunID_TestRunID

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @MJ_AIPromptRuns_RerunFromPromptRunID_RerunFromPromptRunID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateAIPromptRun] @ID = @MJ_AIPromptRuns_RerunFromPromptRunIDID, @PromptID = @MJ_AIPromptRuns_RerunFromPromptRunID_PromptID, @ModelID = @MJ_AIPromptRuns_RerunFromPromptRunID_ModelID, @VendorID = @MJ_AIPromptRuns_RerunFromPromptRunID_VendorID, @AgentID = @MJ_AIPromptRuns_RerunFromPromptRunID_AgentID, @ConfigurationID = @MJ_AIPromptRuns_RerunFromPromptRunID_ConfigurationID, @RunAt = @MJ_AIPromptRuns_RerunFromPromptRunID_RunAt, @CompletedAt = @MJ_AIPromptRuns_RerunFromPromptRunID_CompletedAt, @ExecutionTimeMS = @MJ_AIPromptRuns_RerunFromPromptRunID_ExecutionTimeMS, @Messages = @MJ_AIPromptRuns_RerunFromPromptRunID_Messages, @Result = @MJ_AIPromptRuns_RerunFromPromptRunID_Result, @TokensUsed = @MJ_AIPromptRuns_RerunFromPromptRunID_TokensUsed, @TokensPrompt = @MJ_AIPromptRuns_RerunFromPromptRunID_TokensPrompt, @TokensCompletion = @MJ_AIPromptRuns_RerunFromPromptRunID_TokensCompletion, @TotalCost = @MJ_AIPromptRuns_RerunFromPromptRunID_TotalCost, @Success = @MJ_AIPromptRuns_RerunFromPromptRunID_Success, @ErrorMessage = @MJ_AIPromptRuns_RerunFromPromptRunID_ErrorMessage, @ParentID = @MJ_AIPromptRuns_RerunFromPromptRunID_ParentID, @RunType = @MJ_AIPromptRuns_RerunFromPromptRunID_RunType, @ExecutionOrder = @MJ_AIPromptRuns_RerunFromPromptRunID_ExecutionOrder, @AgentRunID = @MJ_AIPromptRuns_RerunFromPromptRunID_AgentRunID, @Cost = @MJ_AIPromptRuns_RerunFromPromptRunID_Cost, @CostCurrency = @MJ_AIPromptRuns_RerunFromPromptRunID_CostCurrency, @TokensUsedRollup = @MJ_AIPromptRuns_RerunFromPromptRunID_TokensUsedRollup, @TokensPromptRollup = @MJ_AIPromptRuns_RerunFromPromptRunID_TokensPromptRollup, @TokensCompletionRollup = @MJ_AIPromptRuns_RerunFromPromptRunID_TokensCompletionRollup, @Temperature = @MJ_AIPromptRuns_RerunFromPromptRunID_Temperature, @TopP = @MJ_AIPromptRuns_RerunFromPromptRunID_TopP, @TopK = @MJ_AIPromptRuns_RerunFromPromptRunID_TopK, @MinP = @MJ_AIPromptRuns_RerunFromPromptRunID_MinP, @FrequencyPenalty = @MJ_AIPromptRuns_RerunFromPromptRunID_FrequencyPenalty, @PresencePenalty = @MJ_AIPromptRuns_RerunFromPromptRunID_PresencePenalty, @Seed = @MJ_AIPromptRuns_RerunFromPromptRunID_Seed, @StopSequences = @MJ_AIPromptRuns_RerunFromPromptRunID_StopSequences, @ResponseFormat = @MJ_AIPromptRuns_RerunFromPromptRunID_ResponseFormat, @LogProbs = @MJ_AIPromptRuns_RerunFromPromptRunID_LogProbs, @TopLogProbs = @MJ_AIPromptRuns_RerunFromPromptRunID_TopLogProbs, @DescendantCost = @MJ_AIPromptRuns_RerunFromPromptRunID_DescendantCost, @ValidationAttemptCount = @MJ_AIPromptRuns_RerunFromPromptRunID_ValidationAttemptCount, @SuccessfulValidationCount = @MJ_AIPromptRuns_RerunFromPromptRunID_SuccessfulValidationCount, @FinalValidationPassed = @MJ_AIPromptRuns_RerunFromPromptRunID_FinalValidationPassed, @ValidationBehavior = @MJ_AIPromptRuns_RerunFromPromptRunID_ValidationBehavior, @RetryStrategy = @MJ_AIPromptRuns_RerunFromPromptRunID_RetryStrategy, @MaxRetriesConfigured = @MJ_AIPromptRuns_RerunFromPromptRunID_MaxRetriesConfigured, @FinalValidationError = @MJ_AIPromptRuns_RerunFromPromptRunID_FinalValidationError, @ValidationErrorCount = @MJ_AIPromptRuns_RerunFromPromptRunID_ValidationErrorCount, @CommonValidationError = @MJ_AIPromptRuns_RerunFromPromptRunID_CommonValidationError, @FirstAttemptAt = @MJ_AIPromptRuns_RerunFromPromptRunID_FirstAttemptAt, @LastAttemptAt = @MJ_AIPromptRuns_RerunFromPromptRunID_LastAttemptAt, @TotalRetryDurationMS = @MJ_AIPromptRuns_RerunFromPromptRunID_TotalRetryDurationMS, @ValidationAttempts = @MJ_AIPromptRuns_RerunFromPromptRunID_ValidationAttempts, @ValidationSummary = @MJ_AIPromptRuns_RerunFromPromptRunID_ValidationSummary, @FailoverAttempts = @MJ_AIPromptRuns_RerunFromPromptRunID_FailoverAttempts, @FailoverErrors = @MJ_AIPromptRuns_RerunFromPromptRunID_FailoverErrors, @FailoverDurations = @MJ_AIPromptRuns_RerunFromPromptRunID_FailoverDurations, @OriginalModelID = @MJ_AIPromptRuns_RerunFromPromptRunID_OriginalModelID, @OriginalRequestStartTime = @MJ_AIPromptRuns_RerunFromPromptRunID_OriginalRequestStartTime, @TotalFailoverDuration = @MJ_AIPromptRuns_RerunFromPromptRunID_TotalFailoverDuration, @RerunFromPromptRunID = @MJ_AIPromptRuns_RerunFromPromptRunID_RerunFromPromptRunID, @ModelSelection = @MJ_AIPromptRuns_RerunFromPromptRunID_ModelSelection, @Status = @MJ_AIPromptRuns_RerunFromPromptRunID_Status, @Cancelled = @MJ_AIPromptRuns_RerunFromPromptRunID_Cancelled, @CancellationReason = @MJ_AIPromptRuns_RerunFromPromptRunID_CancellationReason, @ModelPowerRank = @MJ_AIPromptRuns_RerunFromPromptRunID_ModelPowerRank, @SelectionStrategy = @MJ_AIPromptRuns_RerunFromPromptRunID_SelectionStrategy, @CacheHit = @MJ_AIPromptRuns_RerunFromPromptRunID_CacheHit, @CacheKey = @MJ_AIPromptRuns_RerunFromPromptRunID_CacheKey, @JudgeID = @MJ_AIPromptRuns_RerunFromPromptRunID_JudgeID, @JudgeScore = @MJ_AIPromptRuns_RerunFromPromptRunID_JudgeScore, @WasSelectedResult = @MJ_AIPromptRuns_RerunFromPromptRunID_WasSelectedResult, @StreamingEnabled = @MJ_AIPromptRuns_RerunFromPromptRunID_StreamingEnabled, @FirstTokenTime = @MJ_AIPromptRuns_RerunFromPromptRunID_FirstTokenTime, @ErrorDetails = @MJ_AIPromptRuns_RerunFromPromptRunID_ErrorDetails, @ChildPromptID = @MJ_AIPromptRuns_RerunFromPromptRunID_ChildPromptID, @QueueTime = @MJ_AIPromptRuns_RerunFromPromptRunID_QueueTime, @PromptTime = @MJ_AIPromptRuns_RerunFromPromptRunID_PromptTime, @CompletionTime = @MJ_AIPromptRuns_RerunFromPromptRunID_CompletionTime, @ModelSpecificResponseDetails = @MJ_AIPromptRuns_RerunFromPromptRunID_ModelSpecificResponseDetails, @EffortLevel = @MJ_AIPromptRuns_RerunFromPromptRunID_EffortLevel, @RunName = @MJ_AIPromptRuns_RerunFromPromptRunID_RunName, @Comments = @MJ_AIPromptRuns_RerunFromPromptRunID_Comments, @TestRunID = @MJ_AIPromptRuns_RerunFromPromptRunID_TestRunID

        FETCH NEXT FROM cascade_update_MJ_AIPromptRuns_RerunFromPromptRunID_cursor INTO @MJ_AIPromptRuns_RerunFromPromptRunIDID, @MJ_AIPromptRuns_RerunFromPromptRunID_PromptID, @MJ_AIPromptRuns_RerunFromPromptRunID_ModelID, @MJ_AIPromptRuns_RerunFromPromptRunID_VendorID, @MJ_AIPromptRuns_RerunFromPromptRunID_AgentID, @MJ_AIPromptRuns_RerunFromPromptRunID_ConfigurationID, @MJ_AIPromptRuns_RerunFromPromptRunID_RunAt, @MJ_AIPromptRuns_RerunFromPromptRunID_CompletedAt, @MJ_AIPromptRuns_RerunFromPromptRunID_ExecutionTimeMS, @MJ_AIPromptRuns_RerunFromPromptRunID_Messages, @MJ_AIPromptRuns_RerunFromPromptRunID_Result, @MJ_AIPromptRuns_RerunFromPromptRunID_TokensUsed, @MJ_AIPromptRuns_RerunFromPromptRunID_TokensPrompt, @MJ_AIPromptRuns_RerunFromPromptRunID_TokensCompletion, @MJ_AIPromptRuns_RerunFromPromptRunID_TotalCost, @MJ_AIPromptRuns_RerunFromPromptRunID_Success, @MJ_AIPromptRuns_RerunFromPromptRunID_ErrorMessage, @MJ_AIPromptRuns_RerunFromPromptRunID_ParentID, @MJ_AIPromptRuns_RerunFromPromptRunID_RunType, @MJ_AIPromptRuns_RerunFromPromptRunID_ExecutionOrder, @MJ_AIPromptRuns_RerunFromPromptRunID_AgentRunID, @MJ_AIPromptRuns_RerunFromPromptRunID_Cost, @MJ_AIPromptRuns_RerunFromPromptRunID_CostCurrency, @MJ_AIPromptRuns_RerunFromPromptRunID_TokensUsedRollup, @MJ_AIPromptRuns_RerunFromPromptRunID_TokensPromptRollup, @MJ_AIPromptRuns_RerunFromPromptRunID_TokensCompletionRollup, @MJ_AIPromptRuns_RerunFromPromptRunID_Temperature, @MJ_AIPromptRuns_RerunFromPromptRunID_TopP, @MJ_AIPromptRuns_RerunFromPromptRunID_TopK, @MJ_AIPromptRuns_RerunFromPromptRunID_MinP, @MJ_AIPromptRuns_RerunFromPromptRunID_FrequencyPenalty, @MJ_AIPromptRuns_RerunFromPromptRunID_PresencePenalty, @MJ_AIPromptRuns_RerunFromPromptRunID_Seed, @MJ_AIPromptRuns_RerunFromPromptRunID_StopSequences, @MJ_AIPromptRuns_RerunFromPromptRunID_ResponseFormat, @MJ_AIPromptRuns_RerunFromPromptRunID_LogProbs, @MJ_AIPromptRuns_RerunFromPromptRunID_TopLogProbs, @MJ_AIPromptRuns_RerunFromPromptRunID_DescendantCost, @MJ_AIPromptRuns_RerunFromPromptRunID_ValidationAttemptCount, @MJ_AIPromptRuns_RerunFromPromptRunID_SuccessfulValidationCount, @MJ_AIPromptRuns_RerunFromPromptRunID_FinalValidationPassed, @MJ_AIPromptRuns_RerunFromPromptRunID_ValidationBehavior, @MJ_AIPromptRuns_RerunFromPromptRunID_RetryStrategy, @MJ_AIPromptRuns_RerunFromPromptRunID_MaxRetriesConfigured, @MJ_AIPromptRuns_RerunFromPromptRunID_FinalValidationError, @MJ_AIPromptRuns_RerunFromPromptRunID_ValidationErrorCount, @MJ_AIPromptRuns_RerunFromPromptRunID_CommonValidationError, @MJ_AIPromptRuns_RerunFromPromptRunID_FirstAttemptAt, @MJ_AIPromptRuns_RerunFromPromptRunID_LastAttemptAt, @MJ_AIPromptRuns_RerunFromPromptRunID_TotalRetryDurationMS, @MJ_AIPromptRuns_RerunFromPromptRunID_ValidationAttempts, @MJ_AIPromptRuns_RerunFromPromptRunID_ValidationSummary, @MJ_AIPromptRuns_RerunFromPromptRunID_FailoverAttempts, @MJ_AIPromptRuns_RerunFromPromptRunID_FailoverErrors, @MJ_AIPromptRuns_RerunFromPromptRunID_FailoverDurations, @MJ_AIPromptRuns_RerunFromPromptRunID_OriginalModelID, @MJ_AIPromptRuns_RerunFromPromptRunID_OriginalRequestStartTime, @MJ_AIPromptRuns_RerunFromPromptRunID_TotalFailoverDuration, @MJ_AIPromptRuns_RerunFromPromptRunID_RerunFromPromptRunID, @MJ_AIPromptRuns_RerunFromPromptRunID_ModelSelection, @MJ_AIPromptRuns_RerunFromPromptRunID_Status, @MJ_AIPromptRuns_RerunFromPromptRunID_Cancelled, @MJ_AIPromptRuns_RerunFromPromptRunID_CancellationReason, @MJ_AIPromptRuns_RerunFromPromptRunID_ModelPowerRank, @MJ_AIPromptRuns_RerunFromPromptRunID_SelectionStrategy, @MJ_AIPromptRuns_RerunFromPromptRunID_CacheHit, @MJ_AIPromptRuns_RerunFromPromptRunID_CacheKey, @MJ_AIPromptRuns_RerunFromPromptRunID_JudgeID, @MJ_AIPromptRuns_RerunFromPromptRunID_JudgeScore, @MJ_AIPromptRuns_RerunFromPromptRunID_WasSelectedResult, @MJ_AIPromptRuns_RerunFromPromptRunID_StreamingEnabled, @MJ_AIPromptRuns_RerunFromPromptRunID_FirstTokenTime, @MJ_AIPromptRuns_RerunFromPromptRunID_ErrorDetails, @MJ_AIPromptRuns_RerunFromPromptRunID_ChildPromptID, @MJ_AIPromptRuns_RerunFromPromptRunID_QueueTime, @MJ_AIPromptRuns_RerunFromPromptRunID_PromptTime, @MJ_AIPromptRuns_RerunFromPromptRunID_CompletionTime, @MJ_AIPromptRuns_RerunFromPromptRunID_ModelSpecificResponseDetails, @MJ_AIPromptRuns_RerunFromPromptRunID_EffortLevel, @MJ_AIPromptRuns_RerunFromPromptRunID_RunName, @MJ_AIPromptRuns_RerunFromPromptRunID_Comments, @MJ_AIPromptRuns_RerunFromPromptRunID_TestRunID
    END

    CLOSE cascade_update_MJ_AIPromptRuns_RerunFromPromptRunID_cursor
    DEALLOCATE cascade_update_MJ_AIPromptRuns_RerunFromPromptRunID_cursor
    

    DELETE FROM
        [${flyway:defaultSchema}].[AIPromptRun]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteAIPromptRun] TO [cdp_Developer], [cdp_Integration]
    

/* spDelete Permissions for MJ: AI Prompt Runs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteAIPromptRun] TO [cdp_Developer], [cdp_Integration]
