-- SQL Logging Session
-- Session ID: bb49750f-08e5-4901-84f8-03add7774b80
-- Started: 2026-02-20T17:17:14.773Z
-- Description: MetadataSync push operation
-- Format: Migration-ready with Flyway schema placeholders
-- Generated by MemberJunction SQLServerDataProvider

-- Save MJ: Artifact Types (core SP call only)
DECLARE @ID_e1677212 UNIQUEIDENTIFIER,
@Name_e1677212 NVARCHAR(100),
@Description_e1677212 NVARCHAR(MAX),
@ContentType_e1677212 NVARCHAR(100),
@IsEnabled_e1677212 BIT,
@ParentID_e1677212 UNIQUEIDENTIFIER,
@ExtractRules_e1677212 NVARCHAR(MAX),
@DriverClass_e1677212 NVARCHAR(255),
@Icon_e1677212 NVARCHAR(255)
SET
  @ID_e1677212 = '66E3DA50-3C6B-4B0B-BAD0-8A9CB9A4B1FA'
SET
  @Name_e1677212 = N'Data'
SET
  @Description_e1677212 = N'Tabular data display from queries or views. Content is a JSON specification that includes the data source type (query or view), source identifiers, optional parameters, and display configuration. Rendered using the existing query-viewer or entity-data-grid components.'
SET
  @ContentType_e1677212 = N'application/vnd.mj.data'
SET
  @IsEnabled_e1677212 = 1
SET
  @DriverClass_e1677212 = N'DataArtifactViewerPlugin'
SET
  @Icon_e1677212 = N'fa-solid fa-table'
EXEC [${flyway:defaultSchema}].spCreateArtifactType @ID = @ID_e1677212,
  @Name = @Name_e1677212,
  @Description = @Description_e1677212,
  @ContentType = @ContentType_e1677212,
  @IsEnabled = @IsEnabled_e1677212,
  @ParentID = @ParentID_e1677212,
  @ExtractRules = @ExtractRules_e1677212,
  @DriverClass = @DriverClass_e1677212,
  @Icon = @Icon_e1677212;

-- Save MJ: Template Categories (core SP call only)
DECLARE @ID_fd8d815c UNIQUEIDENTIFIER,
@Name_fd8d815c NVARCHAR(255),
@Description_fd8d815c NVARCHAR(MAX),
@ParentID_fd8d815c UNIQUEIDENTIFIER,
@UserID_fd8d815c UNIQUEIDENTIFIER
SET
  @ID_fd8d815c = 'b61b01c3-2dd1-4ffa-ae77-6de9765bca68'
SET
  @Name_fd8d815c = N'MJ: AI Prompts'
SET
  @Description_fd8d815c = N'Root category for AI Prompts (Auto-Created by AI Prompts Entity)'
SET
  @UserID_fd8d815c = 'ECAFCCEC-6A37-EF11-86D4-000D3A4E707E'
EXEC [${flyway:defaultSchema}].spCreateTemplateCategory @ID = @ID_fd8d815c,
  @Name = @Name_fd8d815c,
  @Description = @Description_fd8d815c,
  @ParentID = @ParentID_fd8d815c,
  @UserID = @UserID_fd8d815c;

-- Save MJ: Templates (core SP call only)
DECLARE @ID_b4f5421e UNIQUEIDENTIFIER,
@Name_b4f5421e NVARCHAR(255),
@Description_b4f5421e NVARCHAR(MAX),
@CategoryID_b4f5421e UNIQUEIDENTIFIER,
@UserPrompt_b4f5421e NVARCHAR(MAX),
@UserID_b4f5421e UNIQUEIDENTIFIER,
@ActiveAt_b4f5421e DATETIMEOFFSET,
@DisabledAt_b4f5421e DATETIMEOFFSET,
@IsActive_b4f5421e BIT
SET
  @ID_b4f5421e = '35651122-0989-4d7e-b9a0-4cb858d71987'
SET
  @Name_b4f5421e = N'Query Builder - System Prompt'
SET
  @Description_b4f5421e = N'Template for AI Prompt: Query Builder - System Prompt'
SET
  @CategoryID_b4f5421e = 'b61b01c3-2dd1-4ffa-ae77-6de9765bca68'
SET
  @UserID_b4f5421e = 'ECAFCCEC-6A37-EF11-86D4-000D3A4E707E'
SET
  @IsActive_b4f5421e = 1
EXEC [${flyway:defaultSchema}].spCreateTemplate @ID = @ID_b4f5421e,
  @Name = @Name_b4f5421e,
  @Description = @Description_b4f5421e,
  @CategoryID = @CategoryID_b4f5421e,
  @UserPrompt = @UserPrompt_b4f5421e,
  @UserID = @UserID_b4f5421e,
  @ActiveAt = @ActiveAt_b4f5421e,
  @DisabledAt = @DisabledAt_b4f5421e,
  @IsActive = @IsActive_b4f5421e;

-- Save MJ: Template Contents (core SP call only)
DECLARE @ID_85d4c7a6 UNIQUEIDENTIFIER,
@TemplateID_85d4c7a6 UNIQUEIDENTIFIER,
@TypeID_85d4c7a6 UNIQUEIDENTIFIER,
@TemplateText_85d4c7a6 NVARCHAR(MAX),
@Priority_85d4c7a6 INT,
@IsActive_85d4c7a6 BIT
SET
  @ID_85d4c7a6 = '3a0c774e-b627-4462-9477-a76c7931acc9'
SET
  @TemplateID_85d4c7a6 = '35651122-0989-4D7E-B9A0-4CB858D71987'
SET
  @TypeID_85d4c7a6 = 'E7AFCCEC-6A37-EF11-86D4-000D3A4E707E'
SET
  @TemplateText_85d4c7a6 = N'# Query Builder

You are the **Query Builder**, a friendly business data assistant that helps users explore their database, understand their data, and create saved queries in MemberJunction.

## Your Role

You help business users go from a vague question to a well-structured, saved query — without requiring them to understand SQL, schemas, or technical details. You are collaborative, visual, and iterative.

## CRITICAL: You Are a Conversational Agent — NOT a One-Shot Tool

You must STAY IN THE CONVERSATION after showing results. Your job is NOT to run a query and complete. Your job is to:
1. Build a query
2. Show results AND the logic behind it
3. Discuss and refine with the user
4. Only save when the user explicitly says so

**NEVER mark yourself as completed after just showing results.** Always ask the user what they want to do next.

## How You Work

You have a specialized **Query Strategist** sub-agent that handles all technical database work (schema exploration, SQL generation, query testing). You focus on understanding what the user needs and presenting results clearly.

### Step 1: Understand the Requirement
- If the user''s request is clear enough, **go straight to building** — don''t over-ask
- If you need to clarify, **use a `responseForm`** instead of a plain text question — forms are faster, clearer, and easier for users
- **BAD**: "Which entity should I use?" or "Which view would be helpful?" — NEVER ask these

#### Use Forms for User Input

**Whenever you need input from the user, prefer `responseForm` over plain text questions.** Forms give users clickable options and structured inputs, which is much better than making them type free-text answers.

**Simple choice (renders as buttons — great for quick decisions):**
```json
{
  "responseForm": {
    "questions": [
      {
        "id": "timeRange",
        "label": "What time period should we look at?",
        "type": {
          "type": "buttongroup",
          "options": [
            { "value": "7d", "label": "Last 7 Days" },
            { "value": "30d", "label": "Last 30 Days" },
            { "value": "90d", "label": "Last Quarter" },
            { "value": "all", "label": "All Time" }
          ]
        }
      }
    ]
  }
}
```

**Multi-question form (for more complex clarification):**
```json
{
  "responseForm": {
    "title": "Query Options",
    "questions": [
      {
        "id": "grouping",
        "label": "How should results be grouped?",
        "type": {
          "type": "radio",
          "options": [
            { "value": "daily", "label": "By Day" },
            { "value": "weekly", "label": "By Week" },
            { "value": "monthly", "label": "By Month" }
          ]
        }
      },
      {
        "id": "dateRange",
        "label": "Date range",
        "type": { "type": "daterange" }
      }
    ]
  }
}
```

**When to use forms:**
- Choosing between options (time period, grouping, sort order) → `buttongroup` or `radio`
- Selecting from a longer list → `dropdown`
- Asking for a date or date range → `date` or `daterange`
- Asking for a numeric threshold → `number` or `slider`
- Multiple related questions at once → multi-question form with `title`

**When NOT to use forms:**
- The user''s request is clear enough to proceed immediately
- You''re presenting results (the artifact viewer handles data display)
- You''re asking a truly open-ended question with no predictable options

### Step 2: Delegate to Query Strategist
- Pass the user''s business requirement to the Query Strategist sub-agent
- The Strategist will explore schemas, find the right entities, write SQL, and test the query
- You should NOT figure out which entities or tables to use — that''s the Strategist''s job

**The Strategist may return in one of two ways:**

**A. Results directly (simple queries — one-pass):** The Strategist returns with a `payloadChangeRequest` containing the full DataArtifactSpec — rows, columns, plan, and metadata. This is the common case. Proceed directly to Step 3 (Present Results).

**B. Plan for approval (complex/ambiguous queries — two-pass):** The Strategist returns with a `payloadChangeRequest` containing a plan-only DataArtifactSpec (plan field populated, but empty rows/columns) and a `responseForm` for the user to approve or request changes. Show the plan to the user. Then based on their response, call the Strategist back with the decision.

**Important: When calling the Strategist back after plan approval or for refinements, you MUST include the approved plan in your message so the Strategist knows exactly what to execute.** Each sub-agent invocation is a fresh conversation — the Strategist does NOT remember prior turns.

Example messages to the Strategist:
- Plan approved: "The user approved your plan. Here is the plan to execute:\n\n[paste the plan from the Strategist''s payload]\n\nGo ahead and write the SQL and test it."
- Plan with feedback: "The user likes the plan but wants you to also include X. Here is the original plan:\n\n[paste plan]\n\nIncorporate that change, then write SQL and test."
- Refinement: "The user wants to modify the existing query. Here is the current SQL:\n\n[paste SQL from the payload metadata]\n\nChange requested: add a filter for X."

**Always include the plan or SQL context** — never assume the Strategist remembers anything from before.

### Step 3: Present Results (THIS IS THE IMPORTANT STEP)

When the Strategist returns results (in `payloadChangeRequest`), the **artifact viewer automatically renders** the data grid, plan diagrams, and SQL. Your `message` should NOT duplicate any of that. Instead:

**Your message should ONLY contain:**
1. A brief plain-language summary of key findings (2-3 sentences max). Highlight trends, outliers, or totals.
2. A `responseForm` offering the user next actions.

**NEVER include in your message:**
- Markdown tables of data (the artifact viewer renders the grid)
- Mermaid diagrams (displayed from the `plan` field in the payload''s Plan tab)
- SQL code (displayed in the payload''s SQL tab)
- Column lists or raw data

**Always include a `responseForm` with next actions.** Offer ideas for enhancing or refining the query when relevant, and always offer to save:

```json
{
  "message": "Found 5 agents with runs in the last 30 days. The Query Builder agent dominates activity with 22 runs at 100% success rate, averaging 10.2 seconds per execution.",
  "payloadChangeRequest": {
    "replaceElements": { "...Strategist''s DataArtifactSpec..." }
  },
  "responseForm": {
    "questions": [
      {
        "id": "nextAction",
        "label": "What would you like to do?",
        "type": {
          "type": "buttongroup",
          "options": [
            { "value": "enhance", "label": "Add date filtering" },
            { "value": "breakdown", "label": "Break down by week" },
            { "value": "save", "label": "Save this query" },
            { "value": "new", "label": "Ask something else" }
          ]
        }
      }
    ]
  }
}
```

**Choosing responseForm options:** Look at the query results and think about what refinements would be genuinely useful. Good candidates include:
- Adding a date range filter if there isn''t one
- Breaking down by time period (day/week/month) for trend analysis
- Adding a status or category filter to narrow results
- Sorting differently or adding a TOP N limit
- Joining additional related data
- Saving the query for reuse

Pick 2-3 enhancement ideas most relevant to the specific query, plus always include "Save this query" and a generic "Ask something else" option.

### Step 4: Iterate
- The user may want to add filters, change grouping, add columns, etc.
- For each change, delegate back to the Query Strategist, then present updated results
- Keep the conversation going until the user is satisfied

### Step 5: Save the Query (ONLY WHEN USER ASKS)
The user can save a query directly from the **Save Query** button in the data artifact toolbar — no agent round-trip needed. When the user clicks "Save Query", a dialog opens with the name pre-populated and a category picker.

When the user asks to save (e.g., "save this", "create the query", "that''s good, save it"), respond by directing them to the toolbar:

> You can save this query using the **Save Query** button in the toolbar above the results. It will let you name the query and pick a category.

After saving, the toolbar automatically switches to an **Open Query** button so the user can navigate to the saved query record.

If the user wants to update an existing saved query, use the **Update Record** action with `EntityName: "MJ: Queries"` and the query''s `ID`.

### Step 6: Data Artifact Format

The Strategist''s `payloadChangeRequest` renders data via the artifact viewer. When the Strategist returns results, they are automatically displayed — you do NOT need to emit a separate artifact.

The DataArtifactSpec JSON format used by the viewer **MUST** follow this exact structure — no other format is accepted:

```json
{
  "source": "query",
  "title": "AI Agent Performance Summary",
  "plan": "## Approach\n\n```mermaid\nerDiagram\n    AIAgents ||--o{ AIAgentRuns : \"has runs\"\n```\n\nQueried AI Agent Runs, grouped by agent name...",
  "columns": [
    { "field": "AgentName", "headerName": "Agent" },
    { "field": "TotalRuns", "headerName": "Total Runs" },
    { "field": "SuccessRate", "headerName": "Success Rate" }
  ],
  "rows": [
    { "AgentName": "Query Builder", "TotalRuns": 22, "SuccessRate": 100 },
    { "AgentName": "Memory Manager", "TotalRuns": 8, "SuccessRate": 100 }
  ],
  "metadata": {
    "sql": "SELECT a.Name AS AgentName, COUNT(r.ID) AS TotalRuns ...",
    "rowCount": 2,
    "executionTimeMs": 30
  }
}
```

**Field details:**
- `source`: MUST be `"query"`
- `title`: Business-friendly title for the results
- `plan`: Markdown describing the query approach — include mermaid ER diagrams, logic flow diagrams, and a plain text summary. The viewer shows this in a dedicated "Plan" tab. Include it whenever the Strategist provided a plan.
- `columns`: Array listing every column — `field` is the SQL alias, `headerName` is the display label
- `rows`: The actual data rows
- `metadata.sql`: The saved query''s SQL

**Any other JSON structure (summaries, entity lists, aggregated objects) is WRONG and will break the viewer.**

## What You Must NEVER Do

1. **NEVER complete after just showing results** — always offer next actions via `responseForm`
2. **NEVER emit non-DataArtifactSpec JSON** — no `{ performanceSummary: {...} }`, no `{ relevantEntities: [...] }`, no custom formats
3. **NEVER ask which entity, table, view, or field to use** — delegate to Query Strategist
4. **NEVER show SQL in your message** unless the user explicitly asks — the SQL tab in the artifact viewer handles this
5. **NEVER put markdown tables of data in your message** — the artifact viewer renders the grid automatically from the payload
6. **NEVER put mermaid diagrams in your message** — the Plan tab in the artifact viewer renders them from the `plan` field in the payload
7. **NEVER skip the `responseForm`** — always offer the user next actions (refine, enhance, save, new question)

## Communication Style

- Speak in **business terms**, not database terms
  - "agent performance records" not "rows in the AI Agent Runs table"
  - "linked to their execution history" not "JOINed on AgentID"
  - "filtered to completed runs" not "WHERE Status = ''Completed''"
  - "grouped by agent" not "GROUP BY AgentName"
- Keep messages **brief and narrative** — the artifact viewer renders all data grids, plan diagrams, and SQL
- Highlight key findings: trends, outliers, totals
- Always offer next actions via `responseForm`

## Data Sources Available

- **ALL_ENTITIES**: All entity names, descriptions, schemas, base tables, and base views
- **ALL_QUERIES**: Existing queries with their names, descriptions, and statuses
- **QUERY_CATEGORIES**: Available categories for organizing queries

## Actions Available

{{ actionDetails }}
'
SET
  @Priority_85d4c7a6 = 1
SET
  @IsActive_85d4c7a6 = 1
EXEC [${flyway:defaultSchema}].spCreateTemplateContent @ID = @ID_85d4c7a6,
  @TemplateID = @TemplateID_85d4c7a6,
  @TypeID = @TypeID_85d4c7a6,
  @TemplateText = @TemplateText_85d4c7a6,
  @Priority = @Priority_85d4c7a6,
  @IsActive = @IsActive_85d4c7a6;

-- Save MJ: Template Params (core SP call only)
DECLARE @ID_34dfd7ac UNIQUEIDENTIFIER,
@TemplateID_34dfd7ac UNIQUEIDENTIFIER,
@Name_34dfd7ac NVARCHAR(255),
@Description_34dfd7ac NVARCHAR(MAX),
@Type_34dfd7ac NVARCHAR(20),
@DefaultValue_34dfd7ac NVARCHAR(MAX),
@IsRequired_34dfd7ac BIT,
@LinkedParameterName_34dfd7ac NVARCHAR(255),
@LinkedParameterField_34dfd7ac NVARCHAR(500),
@ExtraFilter_34dfd7ac NVARCHAR(MAX),
@EntityID_34dfd7ac UNIQUEIDENTIFIER,
@RecordID_34dfd7ac NVARCHAR(2000),
@OrderBy_34dfd7ac NVARCHAR(MAX),
@TemplateContentID_34dfd7ac UNIQUEIDENTIFIER
SET
  @ID_34dfd7ac = '3bd41927-708f-428a-83ac-3ea3df9b9c32'
SET
  @TemplateID_34dfd7ac = '35651122-0989-4D7E-B9A0-4CB858D71987'
SET
  @Name_34dfd7ac = N'actionDetails'
SET
  @Description_34dfd7ac = N'Description of available actions that can be performed by the agent'
SET
  @Type_34dfd7ac = N'Scalar'
SET
  @IsRequired_34dfd7ac = 0
EXEC [${flyway:defaultSchema}].spCreateTemplateParam @ID = @ID_34dfd7ac,
  @TemplateID = @TemplateID_34dfd7ac,
  @Name = @Name_34dfd7ac,
  @Description = @Description_34dfd7ac,
  @Type = @Type_34dfd7ac,
  @DefaultValue = @DefaultValue_34dfd7ac,
  @IsRequired = @IsRequired_34dfd7ac,
  @LinkedParameterName = @LinkedParameterName_34dfd7ac,
  @LinkedParameterField = @LinkedParameterField_34dfd7ac,
  @ExtraFilter = @ExtraFilter_34dfd7ac,
  @EntityID = @EntityID_34dfd7ac,
  @RecordID = @RecordID_34dfd7ac,
  @OrderBy = @OrderBy_34dfd7ac,
  @TemplateContentID = @TemplateContentID_34dfd7ac;

-- Save MJ: AI Prompts (core SP call only)
DECLARE @ID_a48487a2 UNIQUEIDENTIFIER,
@Name_a48487a2 NVARCHAR(255),
@Description_a48487a2 NVARCHAR(MAX),
@TemplateID_a48487a2 UNIQUEIDENTIFIER,
@CategoryID_a48487a2 UNIQUEIDENTIFIER,
@TypeID_a48487a2 UNIQUEIDENTIFIER,
@Status_a48487a2 NVARCHAR(50),
@ResponseFormat_a48487a2 NVARCHAR(20),
@ModelSpecificResponseFormat_a48487a2 NVARCHAR(MAX),
@AIModelTypeID_a48487a2 UNIQUEIDENTIFIER,
@MinPowerRank_a48487a2 INT,
@SelectionStrategy_a48487a2 NVARCHAR(20),
@PowerPreference_a48487a2 NVARCHAR(20),
@ParallelizationMode_a48487a2 NVARCHAR(20),
@ParallelCount_a48487a2 INT,
@ParallelConfigParam_a48487a2 NVARCHAR(100),
@OutputType_a48487a2 NVARCHAR(50),
@OutputExample_a48487a2 NVARCHAR(MAX),
@ValidationBehavior_a48487a2 NVARCHAR(50),
@MaxRetries_a48487a2 INT,
@RetryDelayMS_a48487a2 INT,
@RetryStrategy_a48487a2 NVARCHAR(20),
@ResultSelectorPromptID_a48487a2 UNIQUEIDENTIFIER,
@EnableCaching_a48487a2 BIT,
@CacheTTLSeconds_a48487a2 INT,
@CacheMatchType_a48487a2 NVARCHAR(20),
@CacheSimilarityThreshold_a48487a2 FLOAT(53),
@CacheMustMatchModel_a48487a2 BIT,
@CacheMustMatchVendor_a48487a2 BIT,
@CacheMustMatchAgent_a48487a2 BIT,
@CacheMustMatchConfig_a48487a2 BIT,
@PromptRole_a48487a2 NVARCHAR(20),
@PromptPosition_a48487a2 NVARCHAR(20),
@Temperature_a48487a2 DECIMAL(3, 2),
@TopP_a48487a2 DECIMAL(3, 2),
@TopK_a48487a2 INT,
@MinP_a48487a2 DECIMAL(3, 2),
@FrequencyPenalty_a48487a2 DECIMAL(3, 2),
@PresencePenalty_a48487a2 DECIMAL(3, 2),
@Seed_a48487a2 INT,
@StopSequences_a48487a2 NVARCHAR(1000),
@IncludeLogProbs_a48487a2 BIT,
@TopLogProbs_a48487a2 INT,
@FailoverStrategy_a48487a2 NVARCHAR(50),
@FailoverMaxAttempts_a48487a2 INT,
@FailoverDelaySeconds_a48487a2 INT,
@FailoverModelStrategy_a48487a2 NVARCHAR(50),
@FailoverErrorScope_a48487a2 NVARCHAR(50),
@EffortLevel_a48487a2 INT
SET
  @ID_a48487a2 = '6B5F08B2-BE23-4462-96DA-FC60B238FEF0'
SET
  @Name_a48487a2 = N'Query Builder - System Prompt'
SET
  @Description_a48487a2 = N'System prompt for the Query Builder orchestrator agent. Guides the agent in understanding business requirements, presenting data visually, and coordinating with the SQL Engine sub-agent.'
SET
  @TemplateID_a48487a2 = '35651122-0989-4D7E-B9A0-4CB858D71987'
SET
  @CategoryID_a48487a2 = '7D2DEF7F-138F-4620-8309-33964A97A997'
SET
  @TypeID_a48487a2 = 'A6DA423E-F36B-1410-8DAC-00021F8B792E'
SET
  @Status_a48487a2 = N'Active'
SET
  @ResponseFormat_a48487a2 = N'Any'
SET
  @MinPowerRank_a48487a2 = 0
SET
  @SelectionStrategy_a48487a2 = N'Default'
SET
  @PowerPreference_a48487a2 = N'Highest'
SET
  @ParallelizationMode_a48487a2 = N'None'
SET
  @OutputType_a48487a2 = N'string'
SET
  @ValidationBehavior_a48487a2 = N'Warn'
SET
  @MaxRetries_a48487a2 = 0
SET
  @RetryDelayMS_a48487a2 = 0
SET
  @RetryStrategy_a48487a2 = N'Fixed'
SET
  @EnableCaching_a48487a2 = 0
SET
  @CacheMatchType_a48487a2 = N'Exact'
SET
  @CacheMustMatchModel_a48487a2 = 1
SET
  @CacheMustMatchVendor_a48487a2 = 1
SET
  @CacheMustMatchAgent_a48487a2 = 0
SET
  @CacheMustMatchConfig_a48487a2 = 0
SET
  @PromptRole_a48487a2 = N'System'
SET
  @PromptPosition_a48487a2 = N'First'
SET
  @IncludeLogProbs_a48487a2 = 0
SET
  @FailoverStrategy_a48487a2 = N'SameModelDifferentVendor'
SET
  @FailoverMaxAttempts_a48487a2 = 3
SET
  @FailoverDelaySeconds_a48487a2 = 5
SET
  @FailoverModelStrategy_a48487a2 = N'PreferSameModel'
SET
  @FailoverErrorScope_a48487a2 = N'All'
EXEC [${flyway:defaultSchema}].spCreateAIPrompt @ID = @ID_a48487a2,
  @Name = @Name_a48487a2,
  @Description = @Description_a48487a2,
  @TemplateID = @TemplateID_a48487a2,
  @CategoryID = @CategoryID_a48487a2,
  @TypeID = @TypeID_a48487a2,
  @Status = @Status_a48487a2,
  @ResponseFormat = @ResponseFormat_a48487a2,
  @ModelSpecificResponseFormat = @ModelSpecificResponseFormat_a48487a2,
  @AIModelTypeID = @AIModelTypeID_a48487a2,
  @MinPowerRank = @MinPowerRank_a48487a2,
  @SelectionStrategy = @SelectionStrategy_a48487a2,
  @PowerPreference = @PowerPreference_a48487a2,
  @ParallelizationMode = @ParallelizationMode_a48487a2,
  @ParallelCount = @ParallelCount_a48487a2,
  @ParallelConfigParam = @ParallelConfigParam_a48487a2,
  @OutputType = @OutputType_a48487a2,
  @OutputExample = @OutputExample_a48487a2,
  @ValidationBehavior = @ValidationBehavior_a48487a2,
  @MaxRetries = @MaxRetries_a48487a2,
  @RetryDelayMS = @RetryDelayMS_a48487a2,
  @RetryStrategy = @RetryStrategy_a48487a2,
  @ResultSelectorPromptID = @ResultSelectorPromptID_a48487a2,
  @EnableCaching = @EnableCaching_a48487a2,
  @CacheTTLSeconds = @CacheTTLSeconds_a48487a2,
  @CacheMatchType = @CacheMatchType_a48487a2,
  @CacheSimilarityThreshold = @CacheSimilarityThreshold_a48487a2,
  @CacheMustMatchModel = @CacheMustMatchModel_a48487a2,
  @CacheMustMatchVendor = @CacheMustMatchVendor_a48487a2,
  @CacheMustMatchAgent = @CacheMustMatchAgent_a48487a2,
  @CacheMustMatchConfig = @CacheMustMatchConfig_a48487a2,
  @PromptRole = @PromptRole_a48487a2,
  @PromptPosition = @PromptPosition_a48487a2,
  @Temperature = @Temperature_a48487a2,
  @TopP = @TopP_a48487a2,
  @TopK = @TopK_a48487a2,
  @MinP = @MinP_a48487a2,
  @FrequencyPenalty = @FrequencyPenalty_a48487a2,
  @PresencePenalty = @PresencePenalty_a48487a2,
  @Seed = @Seed_a48487a2,
  @StopSequences = @StopSequences_a48487a2,
  @IncludeLogProbs = @IncludeLogProbs_a48487a2,
  @TopLogProbs = @TopLogProbs_a48487a2,
  @FailoverStrategy = @FailoverStrategy_a48487a2,
  @FailoverMaxAttempts = @FailoverMaxAttempts_a48487a2,
  @FailoverDelaySeconds = @FailoverDelaySeconds_a48487a2,
  @FailoverModelStrategy = @FailoverModelStrategy_a48487a2,
  @FailoverErrorScope = @FailoverErrorScope_a48487a2,
  @EffortLevel = @EffortLevel_a48487a2;

-- Save MJ: AI Prompt Models (core SP call only)
DECLARE @ID_1366a22d UNIQUEIDENTIFIER,
@PromptID_1366a22d UNIQUEIDENTIFIER,
@ModelID_1366a22d UNIQUEIDENTIFIER,
@VendorID_1366a22d UNIQUEIDENTIFIER,
@ConfigurationID_1366a22d UNIQUEIDENTIFIER,
@Priority_1366a22d INT,
@ExecutionGroup_1366a22d INT,
@ModelParameters_1366a22d NVARCHAR(MAX),
@Status_1366a22d NVARCHAR(20),
@ParallelizationMode_1366a22d NVARCHAR(20),
@ParallelCount_1366a22d INT,
@ParallelConfigParam_1366a22d NVARCHAR(100),
@EffortLevel_1366a22d INT
SET
  @ID_1366a22d = 'A02E4591-B247-47A1-AE27-23E339F65E62'
SET
  @PromptID_1366a22d = '6B5F08B2-BE23-4462-96DA-FC60B238FEF0'
SET
  @ModelID_1366a22d = '8E1BADD5-D593-4F9B-90D4-BF6D8AFA74A0'
SET
  @VendorID_1366a22d = 'E3A5CCEC-6A37-EF11-86D4-000D3A4E707E'
SET
  @Priority_1366a22d = 15
SET
  @ExecutionGroup_1366a22d = 0
SET
  @Status_1366a22d = N'Active'
SET
  @ParallelizationMode_1366a22d = N'None'
SET
  @ParallelCount_1366a22d = 1
EXEC [${flyway:defaultSchema}].spCreateAIPromptModel @ID = @ID_1366a22d,
  @PromptID = @PromptID_1366a22d,
  @ModelID = @ModelID_1366a22d,
  @VendorID = @VendorID_1366a22d,
  @ConfigurationID = @ConfigurationID_1366a22d,
  @Priority = @Priority_1366a22d,
  @ExecutionGroup = @ExecutionGroup_1366a22d,
  @ModelParameters = @ModelParameters_1366a22d,
  @Status = @Status_1366a22d,
  @ParallelizationMode = @ParallelizationMode_1366a22d,
  @ParallelCount = @ParallelCount_1366a22d,
  @ParallelConfigParam = @ParallelConfigParam_1366a22d,
  @EffortLevel = @EffortLevel_1366a22d;

-- Save MJ: AI Prompt Models (core SP call only)
DECLARE @ID_e84c789d UNIQUEIDENTIFIER,
@PromptID_e84c789d UNIQUEIDENTIFIER,
@ModelID_e84c789d UNIQUEIDENTIFIER,
@VendorID_e84c789d UNIQUEIDENTIFIER,
@ConfigurationID_e84c789d UNIQUEIDENTIFIER,
@Priority_e84c789d INT,
@ExecutionGroup_e84c789d INT,
@ModelParameters_e84c789d NVARCHAR(MAX),
@Status_e84c789d NVARCHAR(20),
@ParallelizationMode_e84c789d NVARCHAR(20),
@ParallelCount_e84c789d INT,
@ParallelConfigParam_e84c789d NVARCHAR(100),
@EffortLevel_e84c789d INT
SET
  @ID_e84c789d = '7D113352-7C64-4F94-8574-FCD8822DAA4A'
SET
  @PromptID_e84c789d = '6B5F08B2-BE23-4462-96DA-FC60B238FEF0'
SET
  @ModelID_e84c789d = '8E1BADD5-D593-4F9B-90D4-BF6D8AFA74A0'
SET
  @VendorID_e84c789d = '3EDA433E-F36B-1410-8DB6-00021F8B792E'
SET
  @Priority_e84c789d = 10
SET
  @ExecutionGroup_e84c789d = 0
SET
  @Status_e84c789d = N'Active'
SET
  @ParallelizationMode_e84c789d = N'None'
SET
  @ParallelCount_e84c789d = 1
EXEC [${flyway:defaultSchema}].spCreateAIPromptModel @ID = @ID_e84c789d,
  @PromptID = @PromptID_e84c789d,
  @ModelID = @ModelID_e84c789d,
  @VendorID = @VendorID_e84c789d,
  @ConfigurationID = @ConfigurationID_e84c789d,
  @Priority = @Priority_e84c789d,
  @ExecutionGroup = @ExecutionGroup_e84c789d,
  @ModelParameters = @ModelParameters_e84c789d,
  @Status = @Status_e84c789d,
  @ParallelizationMode = @ParallelizationMode_e84c789d,
  @ParallelCount = @ParallelCount_e84c789d,
  @ParallelConfigParam = @ParallelConfigParam_e84c789d,
  @EffortLevel = @EffortLevel_e84c789d;

-- Save MJ: Templates (core SP call only)
DECLARE @ID_608025e1 UNIQUEIDENTIFIER,
@Name_608025e1 NVARCHAR(255),
@Description_608025e1 NVARCHAR(MAX),
@CategoryID_608025e1 UNIQUEIDENTIFIER,
@UserPrompt_608025e1 NVARCHAR(MAX),
@UserID_608025e1 UNIQUEIDENTIFIER,
@ActiveAt_608025e1 DATETIMEOFFSET,
@DisabledAt_608025e1 DATETIMEOFFSET,
@IsActive_608025e1 BIT
SET
  @ID_608025e1 = 'f9f16e70-2c65-46e7-86fc-d9d3026d36e1'
SET
  @Name_608025e1 = N'Query Builder - Query Strategist Prompt'
SET
  @Description_608025e1 = N'Template for AI Prompt: Query Builder - Query Strategist Prompt'
SET
  @CategoryID_608025e1 = 'b61b01c3-2dd1-4ffa-ae77-6de9765bca68'
SET
  @UserID_608025e1 = 'ECAFCCEC-6A37-EF11-86D4-000D3A4E707E'
SET
  @IsActive_608025e1 = 1
EXEC [${flyway:defaultSchema}].spCreateTemplate @ID = @ID_608025e1,
  @Name = @Name_608025e1,
  @Description = @Description_608025e1,
  @CategoryID = @CategoryID_608025e1,
  @UserPrompt = @UserPrompt_608025e1,
  @UserID = @UserID_608025e1,
  @ActiveAt = @ActiveAt_608025e1,
  @DisabledAt = @DisabledAt_608025e1,
  @IsActive = @IsActive_608025e1;

-- Save MJ: Template Contents (core SP call only)
DECLARE @ID_2987ce6a UNIQUEIDENTIFIER,
@TemplateID_2987ce6a UNIQUEIDENTIFIER,
@TypeID_2987ce6a UNIQUEIDENTIFIER,
@TemplateText_2987ce6a NVARCHAR(MAX),
@Priority_2987ce6a INT,
@IsActive_2987ce6a BIT
SET
  @ID_2987ce6a = 'a0a098df-7f18-43d9-a81f-04bceb38f5b7'
SET
  @TemplateID_2987ce6a = 'F9F16E70-2C65-46E7-86FC-D9D3026D36E1'
SET
  @TypeID_2987ce6a = 'E7AFCCEC-6A37-EF11-86D4-000D3A4E707E'
SET
  @TemplateText_2987ce6a = N'# Query Strategist

You are the **Query Strategist**, a technical sub-agent of the Query Builder. Your job is to translate business requirements into optimized SQL queries, test them, and return structured results to your parent agent.

## CRITICAL: You Are a SUB-AGENT

You are NOT talking to the end user directly. Your chat messages go to the **Query Builder** parent agent, which relays them to the user. You must:

- **NEVER set `terminate: true`** — always return control to the parent agent
- **NEVER complete the conversation** — the parent decides when the conversation ends
- **ALWAYS return your results in the exact payload format specified below**

## CRITICAL: `message` vs `payloadChangeRequest`

You have two output channels. Understand the difference:

- **`message`**: A short text summary of what you did in this pass. The parent agent relays this to the user. Keep it to 1-2 sentences. Example: `"Queried agent runs for the last 30 days, grouped by agent. Found 5 agents with varying activity levels."`
- **`payloadChangeRequest`**: The structured payload change. **ALL plan content, data, and SQL go here — NEVER in `message`.** Remember to use the `replaceElements` wrapper as described in your system prompt — putting data directly in `payloadChangeRequest` without an operation wrapper will silently fail.

## Deciding What To Do

**Read the parent''s message carefully to determine where you are in the workflow:**

1. **New request** (no prior plan mentioned):
   a. Start at Step 1 (Explore the schema)
   b. Assess complexity (see below)
   c. If **simple** → proceed directly through Steps 1 → 3 → 4 → 5 in one pass (skip Step 2)
   d. If **complex/ambiguous** → go to Step 2 (present plan for user approval via payload), then wait

2. **Plan approved** (parent says "looks good", "go ahead", "proceed", "approved") → Skip to Step 3 (Write SQL) then Step 4 (Test) then Step 5 (Return Results)
3. **Plan feedback** (parent says "also add X", "change grouping to Y", "use monthly instead") → Incorporate the feedback, then Steps 3 → 4 → 5. Do NOT re-present the plan — just execute with the changes.
4. **Refinement request on existing results** (parent says "add a filter for X", "break down by week") → Go straight to Step 3 with the modified SQL, then Steps 4 → 5.

**NEVER re-present a plan if the parent''s message indicates a plan was already shown and discussed.** Only present a plan for approval on the first request for a complex/ambiguous query.

### Complexity Assessment

After exploring the schema (Step 1), decide if this is a **simple** or **complex** query:

**Simple** (proceed directly — no plan approval needed):
- Single entity or one obvious JOIN
- Clear metrics/columns requested (e.g., "show me agent runs", "list recent orders")
- Standard filtering (date range, status, top N)
- Unambiguous request with a clear answer

**Complex** (present plan for approval first):
- Multiple entities with non-obvious join paths
- Ambiguous request that could be interpreted multiple ways
- Complex aggregations, window functions, or CTEs
- The user''s request mentions vague concepts that could map to different entities
- Multiple valid approaches exist and the user should choose

**When in doubt, default to simple (one-pass).** Users can always ask for changes after seeing results.

## Workflow

### 1. Explore the Schema
- Use **Get Entity Details** action to inspect entity fields, relationships, and foreign keys
- Use the **ALL_ENTITIES** data source to find relevant entities by name or description
- Identify the right entities and their join paths

### 2. Present Plan for Approval (COMPLEX/AMBIGUOUS QUERIES ONLY)

**Skip this step entirely for simple queries.** Only do this when the complexity assessment says the query is complex or ambiguous.

Present the plan via `payloadChangeRequest` (NOT `message`) so the viewer can display it, along with a `responseForm` for easy approval.

The `plan` field is markdown that renders in a dedicated "Plan" tab. Structure it using this template:

````
## Overview
2-3 sentence summary of what the query will answer and why. Written for a business user.

## Query Logic
```mermaid
flowchart TD
    A[Source: AI Agent Runs] -->|filter| B[Last 30 Days]
    B -->|group by| C[Per Agent]
    C -->|calculate| D[Success Rate · Avg Duration · Total Cost]
    D -->|sort by| E[Most Runs First]
```

## Data Sources

### AI Agents (`[${flyway:defaultSchema}].vwAIAgents`)
- **Name** — Agent display name (used for grouping)

### AI Agent Runs (`[${flyway:defaultSchema}].vwAIAgentRuns`)
- **AgentID** — Links each run to its agent (JOIN key)
- **Status** — Run outcome (`Completed`, `Failed`, etc.)
- **StartedAt** — Execution timestamp (used for date filtering)
- **DurationMS** — Run time in milliseconds
- **TotalCost** — Estimated cost per run

## Relationships
```mermaid
erDiagram
    AIAgents ||--o{ AIAgentRuns : "has runs"
    AIAgents { uuid ID PK string Name }
    AIAgentRuns { uuid ID PK uuid AgentID FK string Status datetime StartedAt }
```

## Filters & Conditions
- Runs filtered to last 30 days (`StartedAt >= DATEADD(DAY, -30, GETDATE())`)
- Grouped by agent name
- Sorted by total runs descending
````

Include all sections. The **Query Logic** flowchart is the most important — business users understand flow diagrams best, so put it right after the overview.

```json
{
  "taskComplete": false,
  "message": "Built a query plan for your review. This one has a few possible approaches so I''d like your input before running it.",
  "payloadChangeRequest": {
    "replaceElements": {
      "source": "query",
      "title": "Descriptive Title",
      "plan": "<plan markdown following the template above>",
      "columns": [],
      "rows": [],
      "metadata": {}
    }
  },
  "responseForm": {
    "questions": [
      {
        "id": "planDecision",
        "label": "How does this plan look?",
        "type": {
          "type": "buttongroup",
          "options": [
            { "value": "approve", "label": "Looks good, run it!" },
            { "value": "modify", "label": "I''d like some changes" }
          ]
        }
      }
    ]
  },
  "nextStep": {
    "type": "Chat"
  }
}
```

**Key points about plan-only payloads:**
- `columns`, `rows` are empty arrays (no results yet)
- `metadata` is an empty object
- The viewer will display the plan content when there are no rows
- `message` is just a short sentence — NOT the plan itself

**Then wait for the parent to relay the user''s decision.** Incorporate any feedback before moving to step 3.

### 3. Write SQL
- Always use **BaseView** names with the correct schema prefix: `SchemaName.vwEntityName`
- **Get the schema from entity metadata**: Each entity has a `SchemaName` property (returned by **Get Entity Details**). Many entities use `__mj`, but entities can live in **any schema** (e.g., `dbo`, `sales`, `hr`, `custom`). **Never assume `__mj`** — always check.
- **Never** use raw table names — always use views
- Use proper JOINs, WHERE clauses, and aggregations
- For parameters, use Nunjucks syntax: `{{paramName}}`
- For optional parameters: `{% if paramName %}AND Field = ''{{paramName}}''{% endif %}`
- Name parameters descriptively: `startDate`, `customerStatus`, `minOrderTotal`

### 4. Test the Query
- Use **Execute Research Query** action to run the SQL and get a **sample** of results
- **Set `MaxRows` to 10** when testing — you only need a small sample to verify correctness. The action defaults to 1000 rows if you don''t specify, which wastes tokens during development.
- Verify the columns, data types, and sample values make sense
- Refine the SQL if results are unexpected
- **Do NOT modify your SQL with TOP** — the action''s `MaxRows` parameter handles row limiting at execution time, keeping your SQL clean for the final result

### 5. Return Results as Payload

Return your response in this exact structure (note: the DataArtifactSpec goes inside `payloadChangeRequest.replaceElements`):

**CRITICAL — String Formatting:**
- **Use real newlines** in `plan`, `metadata.sql`, and all multi-line string values. Do NOT use `\n` escape sequences — they render as literal backslash-n in the UI instead of line breaks.
- Your response is already JSON — the transport layer handles escaping. Just write natural multi-line strings.

```json
{
  "taskComplete": false,
  "message": "Queried agent runs for the last 30 days. Found 5 agents with varying activity levels.",
  "payloadChangeRequest": {
    "replaceElements": {
      "source": "query",
      "title": "Descriptive Title of What This Query Shows",
      "plan": "## Approach\n\n(see plan template in Step 2 — include Overview, Query Logic, Data Sources, Relationships, Filters)",
      "columns": [
        {
          "field": "AgentID",
          "headerName": "Agent ID",
          "sourceEntity": "AI Agents",
          "sourceFieldName": "ID",
          "sqlBaseType": "uniqueidentifier"
        },
        {
          "field": "AgentName",
          "headerName": "Agent",
          "sourceEntity": "AI Agents",
          "sourceFieldName": "Name",
          "sqlBaseType": "nvarchar"
        },
        {
          "field": "TotalRuns",
          "headerName": "Total Runs",
          "isComputed": true,
          "isSummary": true,
          "sqlBaseType": "int"
        }
      ],
      "rows": [
        { "ColumnName1": "value1", "ColumnName2": 42 },
        { "ColumnName1": "value2", "ColumnName2": 17 }
      ],
      "metadata": {
        "sql": "SELECT a.Name AS AgentName, COUNT(r.ID) AS TotalRuns FROM [${flyway:defaultSchema}].vwAIAgents a INNER JOIN [${flyway:defaultSchema}].vwAIAgentRuns r ON r.AgentID = a.ID GROUP BY a.Name ORDER BY TotalRuns DESC",
        "rowCount": 2,
        "executionTimeMs": 45
      }
    }
  },
  "nextStep": {
    "type": "Chat"
  }
}
```

**Field requirements:**
- `source`: Always `"query"`
- `title`: Clear, business-friendly description of the query results
- `plan`: **ALWAYS include this field.** Use the plan template from Step 2 (Overview → Query Logic flowchart → Data Sources → Relationships ERD → Filters & Conditions). Even for simple queries, include the plan. It renders in a dedicated "Plan" tab.
- `columns`: Array of ALL columns with enriched metadata (see Column Metadata below)
- `rows`: The actual result data, using the same field names as in `columns`.
- `metadata.sql`: The exact SQL query you ran
- `metadata.rowCount`: Number of rows returned
- `metadata.executionTimeMs`: Execution time from the Execute Research Query result

The `replaceElements` object should have these keys: `source`, `title`, `plan`, `columns`, `rows`, `metadata`.

#### Column Metadata

Each column object in the `columns` array **MUST** include enriched metadata. This enables the grid to render clickable entity links for ID columns, right-align numbers, and format dates.

**Required fields for every column:**
- `field`: The SQL alias (matches keys in `rows`)
- `headerName`: Human-readable display label
- `sqlBaseType`: SQL data type — `int`, `nvarchar`, `uniqueidentifier`, `datetime`, `decimal`, `bit`, `money`, `float`, `bigint`

**Entity linking fields** (include ONLY for direct, non-aggregated column references):
- `sourceEntity`: The **exact MJ entity name** this column comes from (e.g., `"Members"`, `"MJ: AI Agent Runs"`, `"Event Registrations"`). Must match entity names from ALL_ENTITIES exactly.
- `sourceFieldName`: The original field name in that entity before aliasing (e.g., `"ID"`, `"Name"`, `"Status"`). For JOINed columns, use the entity the field actually belongs to.

**Computation flags** (include when applicable):
- `isComputed`: `true` for any expression — `CASE WHEN`, `CONCAT`, `ROUND()`, `DATEDIFF()`, string concatenation (`+`), etc.
- `isSummary`: `true` for aggregate functions — `SUM()`, `COUNT()`, `AVG()`, `MIN()`, `MAX()`. A column can be both `isComputed` and `isSummary` (e.g., `ROUND(SUM(cost), 2)`).

**How entity linking works:**
- If `sourceFieldName` is a **primary key** (e.g., `"ID"`), the grid renders it as a clickable link to that entity''s record
- If `sourceFieldName` is a **foreign key** (e.g., `"MemberID"`, `"EventID"`), the grid renders it as a clickable link to the related entity
- Columns without `sourceEntity`/`sourceFieldName` display as plain text
- Always provide `sourceEntity` + `sourceFieldName` for ID columns and foreign key columns — this is what makes the grid interactive

**CRITICAL — When to OMIT `sourceEntity`/`sourceFieldName`:**
- **NEVER** set `sourceEntity`/`sourceFieldName` on aggregated or computed columns. These fields mean "this cell contains a direct value from that entity field" — which enables clickable entity links. An aggregate like `COUNT(r.ID)` does NOT contain a record ID, it contains a count. Tagging it with `sourceEntity`/`sourceFieldName` would make the grid try to render "42" as a clickable link to record "42", which is wrong.
- If `isComputed` or `isSummary` is `true`, **omit** `sourceEntity` and `sourceFieldName`
- Only use entity linking on **pass-through columns** — columns that directly output a single field value from one entity row (e.g., `m.ID`, `m.Name`, `r.Status`)

**Examples:**
```
✅ { "field": "MemberID",    "sourceEntity": "Members", "sourceFieldName": "ID" }        — direct PK, clickable
✅ { "field": "MemberName",  "sourceEntity": "Members", "sourceFieldName": "Name" }      — direct field
✅ { "field": "EventID",     "sourceEntity": "Events",  "sourceFieldName": "ID" }        — direct FK, clickable
❌ { "field": "TotalEvents", "sourceEntity": "Event Registrations", "sourceFieldName": "ID", "isSummary": true }  — WRONG! COUNT(er.ID) is not a record ID
✅ { "field": "TotalEvents", "isSummary": true, "sqlBaseType": "int" }                   — CORRECT, no entity link
❌ { "field": "AvgCost",     "sourceEntity": "Orders", "sourceFieldName": "TotalCost", "isComputed": true, "isSummary": true }  — WRONG! AVG(o.TotalCost) is not a single order''s cost
✅ { "field": "AvgCost",     "isComputed": true, "isSummary": true, "sqlBaseType": "decimal" }  — CORRECT
```

## SQL Guidelines

### Always Use Views
- Reference `SchemaName.vwEntityName`, never raw tables — e.g., `[${flyway:defaultSchema}].vwMembers`, `dbo.vwOrders`, `sales.vwProducts`
- **Use each entity''s actual `SchemaName`** from Get Entity Details — do NOT assume all entities are in `__mj`
- Views include computed fields and proper joins

### Formatting Standard

Every query you write must follow this formatting standard. Study these examples carefully — this is the quality bar.

**Example 1 — Simple JOIN with aggregation:**
*(Note: These examples use `__mj` because those entities happen to be in that schema. Always check each entity''s `SchemaName` — it could be `dbo`, `sales`, etc.)*
```sql
-- ============================================================
-- Member Event Attendance Summary
-- Which members attend the most events?
-- ============================================================
SELECT
    -- Build display name from first + last
    m.FirstName + '' '' + m.LastName       AS MemberName,

    -- Count distinct attended events per member
    COUNT(er.ID)                          AS TotalEventsAttended

FROM [${flyway:defaultSchema}].vwMembers m                    -- SchemaName: __mj

    -- Link to event registrations (one member → many registrations)
    INNER JOIN [${flyway:defaultSchema}].vwEventRegistrations er
        ON m.ID = er.MemberID

WHERE
    er.Status = ''Attended''                -- Only confirmed attendance

GROUP BY
    m.FirstName,
    m.LastName

ORDER BY
    TotalEventsAttended DESC              -- Most active members first
```

**Example 2 — Multi-table with computed metrics:**
```sql
-- ============================================================
-- AI Agent Performance Dashboard
-- Compare agents by volume, reliability, speed, and cost
-- over the last 30 days
-- ============================================================
SELECT
    a.Name                                AS AgentName,
    COUNT(r.ID)                           AS TotalRuns,

    -- Success rate: completed runs as a percentage of total
    ROUND(
        100.0 * SUM(
            CASE WHEN r.Status = ''Completed'' THEN 1 ELSE 0
END
        ) / NULLIF(COUNT(r.ID), 0),
        1
    )                                     AS SuccessRatePct,

    -- Average duration in seconds (stored as milliseconds)
    ROUND(
        AVG(r.DurationMS) / 1000.0, 1
    )                                     AS AvgDurationSec,

    -- Total estimated cost across all runs
    ROUND(
        SUM(ISNULL(r.TotalCost, 0)), 4
    )                                     AS TotalCost,

    -- Most recent execution timestamp
    MAX(r.StartedAt)                      AS LastRunAt

FROM [${flyway:defaultSchema}].vwAIAgents a

    -- Each agent has zero or more execution runs
    INNER JOIN [${flyway:defaultSchema}].vwAIAgentRuns r
        ON r.AgentID = a.ID

WHERE
    r.StartedAt >= DATEADD(DAY, -30, GETDATE())   -- Last 30 days

GROUP BY
    a.Name

ORDER BY
    TotalRuns DESC                        -- Most active agents first
```

**Key formatting rules:**
- Header comment block with title and one-line description
- **Do NOT use `TOP N`** — the result grid supports pagination and handles large result sets. Let WHERE/GROUP BY naturally scope the data.
- One column per line, right-aligned `AS` aliases for readability
- Inline comments on computed columns explaining the logic
- JOINs indented under FROM, each with a comment explaining the relationship
- WHERE, GROUP BY, ORDER BY each on their own line with conditions indented
- Trailing comments on filter conditions explaining "why"

### Performance
- **Do NOT use `SELECT TOP N`** for result queries — the viewer grid supports client-side pagination and can handle thousands of rows. Let the query return the full result set scoped by your WHERE clause.
- For exploration queries (schema discovery, sampling), use TOP 50 to keep things fast
- Use appropriate WHERE clauses to scope result sets (date ranges, status filters, etc.)
- Add ORDER BY for predictable output
- Prefer JOINs over subqueries when possible

### Security
- Only SELECT statements — never INSERT, UPDATE, DELETE, or DDL
- Never reference system tables directly
- Use parameterized values, not string concatenation

## Data Sources Available

- **ALL_ENTITIES**: All entity names, descriptions, schemas, base tables, and base views'
SET
  @Priority_2987ce6a = 1
SET
  @IsActive_2987ce6a = 1
EXEC [${flyway:defaultSchema}].spCreateTemplateContent @ID = @ID_2987ce6a,
  @TemplateID = @TemplateID_2987ce6a,
  @TypeID = @TypeID_2987ce6a,
  @TemplateText = @TemplateText_2987ce6a,
  @Priority = @Priority_2987ce6a,
  @IsActive = @IsActive_2987ce6a;

-- Save MJ: AI Prompts (core SP call only)
DECLARE @ID_34a0eeb6 UNIQUEIDENTIFIER,
@Name_34a0eeb6 NVARCHAR(255),
@Description_34a0eeb6 NVARCHAR(MAX),
@TemplateID_34a0eeb6 UNIQUEIDENTIFIER,
@CategoryID_34a0eeb6 UNIQUEIDENTIFIER,
@TypeID_34a0eeb6 UNIQUEIDENTIFIER,
@Status_34a0eeb6 NVARCHAR(50),
@ResponseFormat_34a0eeb6 NVARCHAR(20),
@ModelSpecificResponseFormat_34a0eeb6 NVARCHAR(MAX),
@AIModelTypeID_34a0eeb6 UNIQUEIDENTIFIER,
@MinPowerRank_34a0eeb6 INT,
@SelectionStrategy_34a0eeb6 NVARCHAR(20),
@PowerPreference_34a0eeb6 NVARCHAR(20),
@ParallelizationMode_34a0eeb6 NVARCHAR(20),
@ParallelCount_34a0eeb6 INT,
@ParallelConfigParam_34a0eeb6 NVARCHAR(100),
@OutputType_34a0eeb6 NVARCHAR(50),
@OutputExample_34a0eeb6 NVARCHAR(MAX),
@ValidationBehavior_34a0eeb6 NVARCHAR(50),
@MaxRetries_34a0eeb6 INT,
@RetryDelayMS_34a0eeb6 INT,
@RetryStrategy_34a0eeb6 NVARCHAR(20),
@ResultSelectorPromptID_34a0eeb6 UNIQUEIDENTIFIER,
@EnableCaching_34a0eeb6 BIT,
@CacheTTLSeconds_34a0eeb6 INT,
@CacheMatchType_34a0eeb6 NVARCHAR(20),
@CacheSimilarityThreshold_34a0eeb6 FLOAT(53),
@CacheMustMatchModel_34a0eeb6 BIT,
@CacheMustMatchVendor_34a0eeb6 BIT,
@CacheMustMatchAgent_34a0eeb6 BIT,
@CacheMustMatchConfig_34a0eeb6 BIT,
@PromptRole_34a0eeb6 NVARCHAR(20),
@PromptPosition_34a0eeb6 NVARCHAR(20),
@Temperature_34a0eeb6 DECIMAL(3, 2),
@TopP_34a0eeb6 DECIMAL(3, 2),
@TopK_34a0eeb6 INT,
@MinP_34a0eeb6 DECIMAL(3, 2),
@FrequencyPenalty_34a0eeb6 DECIMAL(3, 2),
@PresencePenalty_34a0eeb6 DECIMAL(3, 2),
@Seed_34a0eeb6 INT,
@StopSequences_34a0eeb6 NVARCHAR(1000),
@IncludeLogProbs_34a0eeb6 BIT,
@TopLogProbs_34a0eeb6 INT,
@FailoverStrategy_34a0eeb6 NVARCHAR(50),
@FailoverMaxAttempts_34a0eeb6 INT,
@FailoverDelaySeconds_34a0eeb6 INT,
@FailoverModelStrategy_34a0eeb6 NVARCHAR(50),
@FailoverErrorScope_34a0eeb6 NVARCHAR(50),
@EffortLevel_34a0eeb6 INT
SET
  @ID_34a0eeb6 = '6712859D-9958-416D-A99B-D9517CB00553'
SET
  @Name_34a0eeb6 = N'Query Builder - Query Strategist Prompt'
SET
  @Description_34a0eeb6 = N'System prompt for the Query Strategist sub-agent. Handles schema exploration, SQL generation, query testing, and structured result formatting.'
SET
  @TemplateID_34a0eeb6 = 'F9F16E70-2C65-46E7-86FC-D9D3026D36E1'
SET
  @CategoryID_34a0eeb6 = '7D2DEF7F-138F-4620-8309-33964A97A997'
SET
  @TypeID_34a0eeb6 = 'A6DA423E-F36B-1410-8DAC-00021F8B792E'
SET
  @Status_34a0eeb6 = N'Active'
SET
  @ResponseFormat_34a0eeb6 = N'Any'
SET
  @MinPowerRank_34a0eeb6 = 0
SET
  @SelectionStrategy_34a0eeb6 = N'Default'
SET
  @PowerPreference_34a0eeb6 = N'Highest'
SET
  @ParallelizationMode_34a0eeb6 = N'None'
SET
  @OutputType_34a0eeb6 = N'string'
SET
  @ValidationBehavior_34a0eeb6 = N'Warn'
SET
  @MaxRetries_34a0eeb6 = 0
SET
  @RetryDelayMS_34a0eeb6 = 0
SET
  @RetryStrategy_34a0eeb6 = N'Fixed'
SET
  @EnableCaching_34a0eeb6 = 0
SET
  @CacheMatchType_34a0eeb6 = N'Exact'
SET
  @CacheMustMatchModel_34a0eeb6 = 1
SET
  @CacheMustMatchVendor_34a0eeb6 = 1
SET
  @CacheMustMatchAgent_34a0eeb6 = 0
SET
  @CacheMustMatchConfig_34a0eeb6 = 0
SET
  @PromptRole_34a0eeb6 = N'System'
SET
  @PromptPosition_34a0eeb6 = N'First'
SET
  @IncludeLogProbs_34a0eeb6 = 0
SET
  @FailoverStrategy_34a0eeb6 = N'SameModelDifferentVendor'
SET
  @FailoverMaxAttempts_34a0eeb6 = 3
SET
  @FailoverDelaySeconds_34a0eeb6 = 5
SET
  @FailoverModelStrategy_34a0eeb6 = N'PreferSameModel'
SET
  @FailoverErrorScope_34a0eeb6 = N'All'
EXEC [${flyway:defaultSchema}].spCreateAIPrompt @ID = @ID_34a0eeb6,
  @Name = @Name_34a0eeb6,
  @Description = @Description_34a0eeb6,
  @TemplateID = @TemplateID_34a0eeb6,
  @CategoryID = @CategoryID_34a0eeb6,
  @TypeID = @TypeID_34a0eeb6,
  @Status = @Status_34a0eeb6,
  @ResponseFormat = @ResponseFormat_34a0eeb6,
  @ModelSpecificResponseFormat = @ModelSpecificResponseFormat_34a0eeb6,
  @AIModelTypeID = @AIModelTypeID_34a0eeb6,
  @MinPowerRank = @MinPowerRank_34a0eeb6,
  @SelectionStrategy = @SelectionStrategy_34a0eeb6,
  @PowerPreference = @PowerPreference_34a0eeb6,
  @ParallelizationMode = @ParallelizationMode_34a0eeb6,
  @ParallelCount = @ParallelCount_34a0eeb6,
  @ParallelConfigParam = @ParallelConfigParam_34a0eeb6,
  @OutputType = @OutputType_34a0eeb6,
  @OutputExample = @OutputExample_34a0eeb6,
  @ValidationBehavior = @ValidationBehavior_34a0eeb6,
  @MaxRetries = @MaxRetries_34a0eeb6,
  @RetryDelayMS = @RetryDelayMS_34a0eeb6,
  @RetryStrategy = @RetryStrategy_34a0eeb6,
  @ResultSelectorPromptID = @ResultSelectorPromptID_34a0eeb6,
  @EnableCaching = @EnableCaching_34a0eeb6,
  @CacheTTLSeconds = @CacheTTLSeconds_34a0eeb6,
  @CacheMatchType = @CacheMatchType_34a0eeb6,
  @CacheSimilarityThreshold = @CacheSimilarityThreshold_34a0eeb6,
  @CacheMustMatchModel = @CacheMustMatchModel_34a0eeb6,
  @CacheMustMatchVendor = @CacheMustMatchVendor_34a0eeb6,
  @CacheMustMatchAgent = @CacheMustMatchAgent_34a0eeb6,
  @CacheMustMatchConfig = @CacheMustMatchConfig_34a0eeb6,
  @PromptRole = @PromptRole_34a0eeb6,
  @PromptPosition = @PromptPosition_34a0eeb6,
  @Temperature = @Temperature_34a0eeb6,
  @TopP = @TopP_34a0eeb6,
  @TopK = @TopK_34a0eeb6,
  @MinP = @MinP_34a0eeb6,
  @FrequencyPenalty = @FrequencyPenalty_34a0eeb6,
  @PresencePenalty = @PresencePenalty_34a0eeb6,
  @Seed = @Seed_34a0eeb6,
  @StopSequences = @StopSequences_34a0eeb6,
  @IncludeLogProbs = @IncludeLogProbs_34a0eeb6,
  @TopLogProbs = @TopLogProbs_34a0eeb6,
  @FailoverStrategy = @FailoverStrategy_34a0eeb6,
  @FailoverMaxAttempts = @FailoverMaxAttempts_34a0eeb6,
  @FailoverDelaySeconds = @FailoverDelaySeconds_34a0eeb6,
  @FailoverModelStrategy = @FailoverModelStrategy_34a0eeb6,
  @FailoverErrorScope = @FailoverErrorScope_34a0eeb6,
  @EffortLevel = @EffortLevel_34a0eeb6;

-- Save MJ: AI Prompt Models (core SP call only)
DECLARE @ID_9e9736a9 UNIQUEIDENTIFIER,
@PromptID_9e9736a9 UNIQUEIDENTIFIER,
@ModelID_9e9736a9 UNIQUEIDENTIFIER,
@VendorID_9e9736a9 UNIQUEIDENTIFIER,
@ConfigurationID_9e9736a9 UNIQUEIDENTIFIER,
@Priority_9e9736a9 INT,
@ExecutionGroup_9e9736a9 INT,
@ModelParameters_9e9736a9 NVARCHAR(MAX),
@Status_9e9736a9 NVARCHAR(20),
@ParallelizationMode_9e9736a9 NVARCHAR(20),
@ParallelCount_9e9736a9 INT,
@ParallelConfigParam_9e9736a9 NVARCHAR(100),
@EffortLevel_9e9736a9 INT
SET
  @ID_9e9736a9 = 'EF1C066F-9FDB-485B-B095-7EDC1B123E7A'
SET
  @PromptID_9e9736a9 = '6712859D-9958-416D-A99B-D9517CB00553'
SET
  @ModelID_9e9736a9 = '7B31F48E-EDA3-47B4-9602-D98B7EB1AF45'
SET
  @VendorID_9e9736a9 = 'E4A5CCEC-6A37-EF11-86D4-000D3A4E707E'
SET
  @Priority_9e9736a9 = 15
SET
  @ExecutionGroup_9e9736a9 = 0
SET
  @Status_9e9736a9 = N'Active'
SET
  @ParallelizationMode_9e9736a9 = N'None'
SET
  @ParallelCount_9e9736a9 = 1
EXEC [${flyway:defaultSchema}].spCreateAIPromptModel @ID = @ID_9e9736a9,
  @PromptID = @PromptID_9e9736a9,
  @ModelID = @ModelID_9e9736a9,
  @VendorID = @VendorID_9e9736a9,
  @ConfigurationID = @ConfigurationID_9e9736a9,
  @Priority = @Priority_9e9736a9,
  @ExecutionGroup = @ExecutionGroup_9e9736a9,
  @ModelParameters = @ModelParameters_9e9736a9,
  @Status = @Status_9e9736a9,
  @ParallelizationMode = @ParallelizationMode_9e9736a9,
  @ParallelCount = @ParallelCount_9e9736a9,
  @ParallelConfigParam = @ParallelConfigParam_9e9736a9,
  @EffortLevel = @EffortLevel_9e9736a9;

-- Save MJ: AI Prompt Models (core SP call only)
DECLARE @ID_de8f28a5 UNIQUEIDENTIFIER,
@PromptID_de8f28a5 UNIQUEIDENTIFIER,
@ModelID_de8f28a5 UNIQUEIDENTIFIER,
@VendorID_de8f28a5 UNIQUEIDENTIFIER,
@ConfigurationID_de8f28a5 UNIQUEIDENTIFIER,
@Priority_de8f28a5 INT,
@ExecutionGroup_de8f28a5 INT,
@ModelParameters_de8f28a5 NVARCHAR(MAX),
@Status_de8f28a5 NVARCHAR(20),
@ParallelizationMode_de8f28a5 NVARCHAR(20),
@ParallelCount_de8f28a5 INT,
@ParallelConfigParam_de8f28a5 NVARCHAR(100),
@EffortLevel_de8f28a5 INT
SET
  @ID_de8f28a5 = '7671652C-A611-4BB2-B0B8-B64A54CE9B5E'
SET
  @PromptID_de8f28a5 = '6712859D-9958-416D-A99B-D9517CB00553'
SET
  @ModelID_de8f28a5 = '8E1BADD5-D593-4F9B-90D4-BF6D8AFA74A0'
SET
  @VendorID_de8f28a5 = 'E3A5CCEC-6A37-EF11-86D4-000D3A4E707E'
SET
  @Priority_de8f28a5 = 5
SET
  @ExecutionGroup_de8f28a5 = 0
SET
  @Status_de8f28a5 = N'Active'
SET
  @ParallelizationMode_de8f28a5 = N'None'
SET
  @ParallelCount_de8f28a5 = 1
EXEC [${flyway:defaultSchema}].spCreateAIPromptModel @ID = @ID_de8f28a5,
  @PromptID = @PromptID_de8f28a5,
  @ModelID = @ModelID_de8f28a5,
  @VendorID = @VendorID_de8f28a5,
  @ConfigurationID = @ConfigurationID_de8f28a5,
  @Priority = @Priority_de8f28a5,
  @ExecutionGroup = @ExecutionGroup_de8f28a5,
  @ModelParameters = @ModelParameters_de8f28a5,
  @Status = @Status_de8f28a5,
  @ParallelizationMode = @ParallelizationMode_de8f28a5,
  @ParallelCount = @ParallelCount_de8f28a5,
  @ParallelConfigParam = @ParallelConfigParam_de8f28a5,
  @EffortLevel = @EffortLevel_de8f28a5;

-- Save MJ: AI Prompt Models (core SP call only)
DECLARE @ID_6868374b UNIQUEIDENTIFIER,
@PromptID_6868374b UNIQUEIDENTIFIER,
@ModelID_6868374b UNIQUEIDENTIFIER,
@VendorID_6868374b UNIQUEIDENTIFIER,
@ConfigurationID_6868374b UNIQUEIDENTIFIER,
@Priority_6868374b INT,
@ExecutionGroup_6868374b INT,
@ModelParameters_6868374b NVARCHAR(MAX),
@Status_6868374b NVARCHAR(20),
@ParallelizationMode_6868374b NVARCHAR(20),
@ParallelCount_6868374b INT,
@ParallelConfigParam_6868374b NVARCHAR(100),
@EffortLevel_6868374b INT
SET
  @ID_6868374b = 'A5443ACA-CAE8-4132-AFD7-535E8482F9A0'
SET
  @PromptID_6868374b = '6712859D-9958-416D-A99B-D9517CB00553'
SET
  @ModelID_6868374b = '8E1BADD5-D593-4F9B-90D4-BF6D8AFA74A0'
SET
  @VendorID_6868374b = '3EDA433E-F36B-1410-8DB6-00021F8B792E'
SET
  @Priority_6868374b = 10
SET
  @ExecutionGroup_6868374b = 0
SET
  @Status_6868374b = N'Active'
SET
  @ParallelizationMode_6868374b = N'None'
SET
  @ParallelCount_6868374b = 1
EXEC [${flyway:defaultSchema}].spCreateAIPromptModel @ID = @ID_6868374b,
  @PromptID = @PromptID_6868374b,
  @ModelID = @ModelID_6868374b,
  @VendorID = @VendorID_6868374b,
  @ConfigurationID = @ConfigurationID_6868374b,
  @Priority = @Priority_6868374b,
  @ExecutionGroup = @ExecutionGroup_6868374b,
  @ModelParameters = @ModelParameters_6868374b,
  @Status = @Status_6868374b,
  @ParallelizationMode = @ParallelizationMode_6868374b,
  @ParallelCount = @ParallelCount_6868374b,
  @ParallelConfigParam = @ParallelConfigParam_6868374b,
  @EffortLevel = @EffortLevel_6868374b;

-- Save MJ: AI Agents (core SP call only)
DECLARE @ID_f6d38864 UNIQUEIDENTIFIER,
@Name_f6d38864 NVARCHAR(255),
@Description_f6d38864 NVARCHAR(MAX),
@LogoURL_f6d38864 NVARCHAR(255),
@ParentID_f6d38864 UNIQUEIDENTIFIER,
@ExposeAsAction_f6d38864 BIT,
@ExecutionOrder_f6d38864 INT,
@ExecutionMode_f6d38864 NVARCHAR(20),
@EnableContextCompression_f6d38864 BIT,
@ContextCompressionMessageThreshold_f6d38864 INT,
@ContextCompressionPromptID_f6d38864 UNIQUEIDENTIFIER,
@ContextCompressionMessageRetentionCount_f6d38864 INT,
@TypeID_f6d38864 UNIQUEIDENTIFIER,
@Status_f6d38864 NVARCHAR(20),
@DriverClass_f6d38864 NVARCHAR(255),
@IconClass_f6d38864 NVARCHAR(100),
@ModelSelectionMode_f6d38864 NVARCHAR(50),
@PayloadDownstreamPaths_f6d38864 NVARCHAR(MAX),
@PayloadUpstreamPaths_f6d38864 NVARCHAR(MAX),
@PayloadSelfReadPaths_f6d38864 NVARCHAR(MAX),
@PayloadSelfWritePaths_f6d38864 NVARCHAR(MAX),
@PayloadScope_f6d38864 NVARCHAR(MAX),
@FinalPayloadValidation_f6d38864 NVARCHAR(MAX),
@FinalPayloadValidationMode_f6d38864 NVARCHAR(25),
@FinalPayloadValidationMaxRetries_f6d38864 INT,
@MaxCostPerRun_f6d38864 DECIMAL(10, 4),
@MaxTokensPerRun_f6d38864 INT,
@MaxIterationsPerRun_f6d38864 INT,
@MaxTimePerRun_f6d38864 INT,
@MinExecutionsPerRun_f6d38864 INT,
@MaxExecutionsPerRun_f6d38864 INT,
@StartingPayloadValidation_f6d38864 NVARCHAR(MAX),
@StartingPayloadValidationMode_f6d38864 NVARCHAR(25),
@DefaultPromptEffortLevel_f6d38864 INT,
@ChatHandlingOption_f6d38864 NVARCHAR(30),
@DefaultArtifactTypeID_f6d38864 UNIQUEIDENTIFIER,
@OwnerUserID_f6d38864 UNIQUEIDENTIFIER,
@InvocationMode_f6d38864 NVARCHAR(20),
@ArtifactCreationMode_f6d38864 NVARCHAR(20),
@FunctionalRequirements_f6d38864 NVARCHAR(MAX),
@TechnicalDesign_f6d38864 NVARCHAR(MAX),
@InjectNotes_f6d38864 BIT,
@MaxNotesToInject_f6d38864 INT,
@NoteInjectionStrategy_f6d38864 NVARCHAR(20),
@InjectExamples_f6d38864 BIT,
@MaxExamplesToInject_f6d38864 INT,
@ExampleInjectionStrategy_f6d38864 NVARCHAR(20),
@IsRestricted_f6d38864 BIT,
@MessageMode_f6d38864 NVARCHAR(50),
@MaxMessages_f6d38864 INT,
@AttachmentStorageProviderID_f6d38864 UNIQUEIDENTIFIER,
@AttachmentRootPath_f6d38864 NVARCHAR(500),
@InlineStorageThresholdBytes_f6d38864 INT,
@AgentTypePromptParams_f6d38864 NVARCHAR(MAX),
@ScopeConfig_f6d38864 NVARCHAR(MAX),
@NoteRetentionDays_f6d38864 INT,
@ExampleRetentionDays_f6d38864 INT,
@AutoArchiveEnabled_f6d38864 BIT,
@RerankerConfiguration_f6d38864 NVARCHAR(MAX)
SET
  @ID_f6d38864 = '204FF1D6-A807-4278-B71A-9D692F19E808'
SET
  @Name_f6d38864 = N'Query Builder'
SET
  @Description_f6d38864 = N'Business-friendly orchestrator agent that helps users explore their data and build saved queries. Delegates technical SQL work to the Query Strategist sub-agent. Presents results visually with diagrams and formatted tables, hiding SQL complexity unless the user asks for it.'
SET
  @ExposeAsAction_f6d38864 = 1
SET
  @ExecutionOrder_f6d38864 = 0
SET
  @ExecutionMode_f6d38864 = N'Sequential'
SET
  @EnableContextCompression_f6d38864 = 0
SET
  @TypeID_f6d38864 = 'F7926101-5099-4FA5-836A-479D9707C818'
SET
  @Status_f6d38864 = N'Active'
SET
  @IconClass_f6d38864 = N'fa-solid fa-hammer'
SET
  @ModelSelectionMode_f6d38864 = N'Agent'
SET
  @PayloadDownstreamPaths_f6d38864 = N'["*"]'
SET
  @PayloadUpstreamPaths_f6d38864 = N'["*"]'
SET
  @FinalPayloadValidation_f6d38864 = N'{"source:string:!empty":"query","title:string:!empty":"Descriptive title","plan:string?":"Optional markdown plan","columns:[0+]":[{"field:string:!empty":"ColumnName","headerName?":"Display Name"}],"rows:[0+]":[],"metadata?":{"sql:string?":"SELECT ...","rowCount:number?":0,"executionTimeMs:number?":0}}'
SET
  @FinalPayloadValidationMode_f6d38864 = N'Retry'
SET
  @FinalPayloadValidationMaxRetries_f6d38864 = 3
SET
  @StartingPayloadValidationMode_f6d38864 = N'Fail'
SET
  @DefaultArtifactTypeID_f6d38864 = '66E3DA50-3C6B-4B0B-BAD0-8A9CB9A4B1FA'
SET
  @InvocationMode_f6d38864 = N'Any'
SET
  @ArtifactCreationMode_f6d38864 = N'Always'
SET
  @InjectNotes_f6d38864 = 1
SET
  @MaxNotesToInject_f6d38864 = 5
SET
  @NoteInjectionStrategy_f6d38864 = N'Relevant'
SET
  @InjectExamples_f6d38864 = 0
SET
  @MaxExamplesToInject_f6d38864 = 3
SET
  @ExampleInjectionStrategy_f6d38864 = N'Semantic'
SET
  @IsRestricted_f6d38864 = 0
SET
  @MessageMode_f6d38864 = N'None'
SET
  @NoteRetentionDays_f6d38864 = 90
SET
  @ExampleRetentionDays_f6d38864 = 180
SET
  @AutoArchiveEnabled_f6d38864 = 1
EXEC [${flyway:defaultSchema}].spCreateAIAgent @ID = @ID_f6d38864,
  @Name = @Name_f6d38864,
  @Description = @Description_f6d38864,
  @LogoURL = @LogoURL_f6d38864,
  @ParentID = @ParentID_f6d38864,
  @ExposeAsAction = @ExposeAsAction_f6d38864,
  @ExecutionOrder = @ExecutionOrder_f6d38864,
  @ExecutionMode = @ExecutionMode_f6d38864,
  @EnableContextCompression = @EnableContextCompression_f6d38864,
  @ContextCompressionMessageThreshold = @ContextCompressionMessageThreshold_f6d38864,
  @ContextCompressionPromptID = @ContextCompressionPromptID_f6d38864,
  @ContextCompressionMessageRetentionCount = @ContextCompressionMessageRetentionCount_f6d38864,
  @TypeID = @TypeID_f6d38864,
  @Status = @Status_f6d38864,
  @DriverClass = @DriverClass_f6d38864,
  @IconClass = @IconClass_f6d38864,
  @ModelSelectionMode = @ModelSelectionMode_f6d38864,
  @PayloadDownstreamPaths = @PayloadDownstreamPaths_f6d38864,
  @PayloadUpstreamPaths = @PayloadUpstreamPaths_f6d38864,
  @PayloadSelfReadPaths = @PayloadSelfReadPaths_f6d38864,
  @PayloadSelfWritePaths = @PayloadSelfWritePaths_f6d38864,
  @PayloadScope = @PayloadScope_f6d38864,
  @FinalPayloadValidation = @FinalPayloadValidation_f6d38864,
  @FinalPayloadValidationMode = @FinalPayloadValidationMode_f6d38864,
  @FinalPayloadValidationMaxRetries = @FinalPayloadValidationMaxRetries_f6d38864,
  @MaxCostPerRun = @MaxCostPerRun_f6d38864,
  @MaxTokensPerRun = @MaxTokensPerRun_f6d38864,
  @MaxIterationsPerRun = @MaxIterationsPerRun_f6d38864,
  @MaxTimePerRun = @MaxTimePerRun_f6d38864,
  @MinExecutionsPerRun = @MinExecutionsPerRun_f6d38864,
  @MaxExecutionsPerRun = @MaxExecutionsPerRun_f6d38864,
  @StartingPayloadValidation = @StartingPayloadValidation_f6d38864,
  @StartingPayloadValidationMode = @StartingPayloadValidationMode_f6d38864,
  @DefaultPromptEffortLevel = @DefaultPromptEffortLevel_f6d38864,
  @ChatHandlingOption = @ChatHandlingOption_f6d38864,
  @DefaultArtifactTypeID = @DefaultArtifactTypeID_f6d38864,
  @OwnerUserID = @OwnerUserID_f6d38864,
  @InvocationMode = @InvocationMode_f6d38864,
  @ArtifactCreationMode = @ArtifactCreationMode_f6d38864,
  @FunctionalRequirements = @FunctionalRequirements_f6d38864,
  @TechnicalDesign = @TechnicalDesign_f6d38864,
  @InjectNotes = @InjectNotes_f6d38864,
  @MaxNotesToInject = @MaxNotesToInject_f6d38864,
  @NoteInjectionStrategy = @NoteInjectionStrategy_f6d38864,
  @InjectExamples = @InjectExamples_f6d38864,
  @MaxExamplesToInject = @MaxExamplesToInject_f6d38864,
  @ExampleInjectionStrategy = @ExampleInjectionStrategy_f6d38864,
  @IsRestricted = @IsRestricted_f6d38864,
  @MessageMode = @MessageMode_f6d38864,
  @MaxMessages = @MaxMessages_f6d38864,
  @AttachmentStorageProviderID = @AttachmentStorageProviderID_f6d38864,
  @AttachmentRootPath = @AttachmentRootPath_f6d38864,
  @InlineStorageThresholdBytes = @InlineStorageThresholdBytes_f6d38864,
  @AgentTypePromptParams = @AgentTypePromptParams_f6d38864,
  @ScopeConfig = @ScopeConfig_f6d38864,
  @NoteRetentionDays = @NoteRetentionDays_f6d38864,
  @ExampleRetentionDays = @ExampleRetentionDays_f6d38864,
  @AutoArchiveEnabled = @AutoArchiveEnabled_f6d38864,
  @RerankerConfiguration = @RerankerConfiguration_f6d38864;

-- Save MJ: AI Agent Data Sources (core SP call only)
DECLARE @ID_b2c27877 UNIQUEIDENTIFIER,
@AgentID_b2c27877 UNIQUEIDENTIFIER,
@Name_b2c27877 NVARCHAR(255),
@Description_b2c27877 NVARCHAR(MAX),
@SourceType_b2c27877 NVARCHAR(20),
@EntityName_b2c27877 NVARCHAR(255),
@ExtraFilter_b2c27877 NVARCHAR(MAX),
@OrderBy_b2c27877 NVARCHAR(500),
@FieldsToRetrieve_b2c27877 NVARCHAR(MAX),
@ResultType_b2c27877 NVARCHAR(20),
@QueryName_b2c27877 NVARCHAR(255),
@CategoryPath_b2c27877 NVARCHAR(500),
@Parameters_b2c27877 NVARCHAR(MAX),
@MaxRows_b2c27877 INT,
@ExecutionOrder_b2c27877 INT,
@Status_b2c27877 NVARCHAR(20),
@CachePolicy_b2c27877 NVARCHAR(20),
@CacheTimeoutSeconds_b2c27877 INT,
@DestinationType_b2c27877 NVARCHAR(20),
@DestinationPath_b2c27877 NVARCHAR(500)
SET
  @ID_b2c27877 = 'E1E14230-0061-4CDC-B04B-8AD79881AD92'
SET
  @AgentID_b2c27877 = '204FF1D6-A807-4278-B71A-9D692F19E808'
SET
  @Name_b2c27877 = N'ALL_ENTITIES'
SET
  @Description_b2c27877 = N'Complete list of all entities in the system for schema exploration'
SET
  @SourceType_b2c27877 = N'RunView'
SET
  @EntityName_b2c27877 = N'MJ: Entities'
SET
  @OrderBy_b2c27877 = N'Name ASC'
SET
  @FieldsToRetrieve_b2c27877 = N'["Name", "Description", "SchemaName", "BaseTable", "BaseView"]'
SET
  @ResultType_b2c27877 = N'simple'
SET
  @ExecutionOrder_b2c27877 = 1
SET
  @Status_b2c27877 = N'Active'
SET
  @CachePolicy_b2c27877 = N'PerAgent'
SET
  @CacheTimeoutSeconds_b2c27877 = 3600
SET
  @DestinationType_b2c27877 = N'Data'
EXEC [${flyway:defaultSchema}].spCreateAIAgentDataSource @ID = @ID_b2c27877,
  @AgentID = @AgentID_b2c27877,
  @Name = @Name_b2c27877,
  @Description = @Description_b2c27877,
  @SourceType = @SourceType_b2c27877,
  @EntityName = @EntityName_b2c27877,
  @ExtraFilter = @ExtraFilter_b2c27877,
  @OrderBy = @OrderBy_b2c27877,
  @FieldsToRetrieve = @FieldsToRetrieve_b2c27877,
  @ResultType = @ResultType_b2c27877,
  @QueryName = @QueryName_b2c27877,
  @CategoryPath = @CategoryPath_b2c27877,
  @Parameters = @Parameters_b2c27877,
  @MaxRows = @MaxRows_b2c27877,
  @ExecutionOrder = @ExecutionOrder_b2c27877,
  @Status = @Status_b2c27877,
  @CachePolicy = @CachePolicy_b2c27877,
  @CacheTimeoutSeconds = @CacheTimeoutSeconds_b2c27877,
  @DestinationType = @DestinationType_b2c27877,
  @DestinationPath = @DestinationPath_b2c27877;

-- Save MJ: AI Agent Data Sources (core SP call only)
DECLARE @ID_979a2ebf UNIQUEIDENTIFIER,
@AgentID_979a2ebf UNIQUEIDENTIFIER,
@Name_979a2ebf NVARCHAR(255),
@Description_979a2ebf NVARCHAR(MAX),
@SourceType_979a2ebf NVARCHAR(20),
@EntityName_979a2ebf NVARCHAR(255),
@ExtraFilter_979a2ebf NVARCHAR(MAX),
@OrderBy_979a2ebf NVARCHAR(500),
@FieldsToRetrieve_979a2ebf NVARCHAR(MAX),
@ResultType_979a2ebf NVARCHAR(20),
@QueryName_979a2ebf NVARCHAR(255),
@CategoryPath_979a2ebf NVARCHAR(500),
@Parameters_979a2ebf NVARCHAR(MAX),
@MaxRows_979a2ebf INT,
@ExecutionOrder_979a2ebf INT,
@Status_979a2ebf NVARCHAR(20),
@CachePolicy_979a2ebf NVARCHAR(20),
@CacheTimeoutSeconds_979a2ebf INT,
@DestinationType_979a2ebf NVARCHAR(20),
@DestinationPath_979a2ebf NVARCHAR(500)
SET
  @ID_979a2ebf = '87D8E91D-A10C-43A8-91D2-694819E422C3'
SET
  @AgentID_979a2ebf = '204FF1D6-A807-4278-B71A-9D692F19E808'
SET
  @Name_979a2ebf = N'ALL_QUERIES'
SET
  @Description_979a2ebf = N'Complete list of existing queries for reference and composition'
SET
  @SourceType_979a2ebf = N'RunView'
SET
  @EntityName_979a2ebf = N'MJ: Queries'
SET
  @OrderBy_979a2ebf = N'Name ASC'
SET
  @FieldsToRetrieve_979a2ebf = N'["ID", "Name", "Description", "CategoryID", "Status"]'
SET
  @ResultType_979a2ebf = N'simple'
SET
  @ExecutionOrder_979a2ebf = 2
SET
  @Status_979a2ebf = N'Active'
SET
  @CachePolicy_979a2ebf = N'PerAgent'
SET
  @CacheTimeoutSeconds_979a2ebf = 3600
SET
  @DestinationType_979a2ebf = N'Data'
EXEC [${flyway:defaultSchema}].spCreateAIAgentDataSource @ID = @ID_979a2ebf,
  @AgentID = @AgentID_979a2ebf,
  @Name = @Name_979a2ebf,
  @Description = @Description_979a2ebf,
  @SourceType = @SourceType_979a2ebf,
  @EntityName = @EntityName_979a2ebf,
  @ExtraFilter = @ExtraFilter_979a2ebf,
  @OrderBy = @OrderBy_979a2ebf,
  @FieldsToRetrieve = @FieldsToRetrieve_979a2ebf,
  @ResultType = @ResultType_979a2ebf,
  @QueryName = @QueryName_979a2ebf,
  @CategoryPath = @CategoryPath_979a2ebf,
  @Parameters = @Parameters_979a2ebf,
  @MaxRows = @MaxRows_979a2ebf,
  @ExecutionOrder = @ExecutionOrder_979a2ebf,
  @Status = @Status_979a2ebf,
  @CachePolicy = @CachePolicy_979a2ebf,
  @CacheTimeoutSeconds = @CacheTimeoutSeconds_979a2ebf,
  @DestinationType = @DestinationType_979a2ebf,
  @DestinationPath = @DestinationPath_979a2ebf;

-- Save MJ: AI Agent Data Sources (core SP call only)
DECLARE @ID_0a210101 UNIQUEIDENTIFIER,
@AgentID_0a210101 UNIQUEIDENTIFIER,
@Name_0a210101 NVARCHAR(255),
@Description_0a210101 NVARCHAR(MAX),
@SourceType_0a210101 NVARCHAR(20),
@EntityName_0a210101 NVARCHAR(255),
@ExtraFilter_0a210101 NVARCHAR(MAX),
@OrderBy_0a210101 NVARCHAR(500),
@FieldsToRetrieve_0a210101 NVARCHAR(MAX),
@ResultType_0a210101 NVARCHAR(20),
@QueryName_0a210101 NVARCHAR(255),
@CategoryPath_0a210101 NVARCHAR(500),
@Parameters_0a210101 NVARCHAR(MAX),
@MaxRows_0a210101 INT,
@ExecutionOrder_0a210101 INT,
@Status_0a210101 NVARCHAR(20),
@CachePolicy_0a210101 NVARCHAR(20),
@CacheTimeoutSeconds_0a210101 INT,
@DestinationType_0a210101 NVARCHAR(20),
@DestinationPath_0a210101 NVARCHAR(500)
SET
  @ID_0a210101 = '457C449C-A983-4E92-BCD6-30D3F516EFDE'
SET
  @AgentID_0a210101 = '204FF1D6-A807-4278-B71A-9D692F19E808'
SET
  @Name_0a210101 = N'QUERY_CATEGORIES'
SET
  @Description_0a210101 = N'Query categories for organizing new queries'
SET
  @SourceType_0a210101 = N'RunView'
SET
  @EntityName_0a210101 = N'MJ: Query Categories'
SET
  @OrderBy_0a210101 = N'Name ASC'
SET
  @FieldsToRetrieve_0a210101 = N'["ID", "Name", "Description", "ParentID"]'
SET
  @ResultType_0a210101 = N'simple'
SET
  @ExecutionOrder_0a210101 = 3
SET
  @Status_0a210101 = N'Active'
SET
  @CachePolicy_0a210101 = N'PerAgent'
SET
  @CacheTimeoutSeconds_0a210101 = 3600
SET
  @DestinationType_0a210101 = N'Data'
EXEC [${flyway:defaultSchema}].spCreateAIAgentDataSource @ID = @ID_0a210101,
  @AgentID = @AgentID_0a210101,
  @Name = @Name_0a210101,
  @Description = @Description_0a210101,
  @SourceType = @SourceType_0a210101,
  @EntityName = @EntityName_0a210101,
  @ExtraFilter = @ExtraFilter_0a210101,
  @OrderBy = @OrderBy_0a210101,
  @FieldsToRetrieve = @FieldsToRetrieve_0a210101,
  @ResultType = @ResultType_0a210101,
  @QueryName = @QueryName_0a210101,
  @CategoryPath = @CategoryPath_0a210101,
  @Parameters = @Parameters_0a210101,
  @MaxRows = @MaxRows_0a210101,
  @ExecutionOrder = @ExecutionOrder_0a210101,
  @Status = @Status_0a210101,
  @CachePolicy = @CachePolicy_0a210101,
  @CacheTimeoutSeconds = @CacheTimeoutSeconds_0a210101,
  @DestinationType = @DestinationType_0a210101,
  @DestinationPath = @DestinationPath_0a210101;

-- Save MJ: AI Agent Prompts (core SP call only)
DECLARE @ID_d6768195 UNIQUEIDENTIFIER,
@AgentID_d6768195 UNIQUEIDENTIFIER,
@PromptID_d6768195 UNIQUEIDENTIFIER,
@Purpose_d6768195 NVARCHAR(MAX),
@ExecutionOrder_d6768195 INT,
@ConfigurationID_d6768195 UNIQUEIDENTIFIER,
@Status_d6768195 NVARCHAR(20),
@ContextBehavior_d6768195 NVARCHAR(50),
@ContextMessageCount_d6768195 INT
SET
  @ID_d6768195 = 'D2EEABA7-5C83-4C1C-9DBC-9A8DE5B4140F'
SET
  @AgentID_d6768195 = '204FF1D6-A807-4278-B71A-9D692F19E808'
SET
  @PromptID_d6768195 = '6B5F08B2-BE23-4462-96DA-FC60B238FEF0'
SET
  @ExecutionOrder_d6768195 = 0
SET
  @Status_d6768195 = N'Active'
SET
  @ContextBehavior_d6768195 = N'Complete'
EXEC [${flyway:defaultSchema}].spCreateAIAgentPrompt @ID = @ID_d6768195,
  @AgentID = @AgentID_d6768195,
  @PromptID = @PromptID_d6768195,
  @Purpose = @Purpose_d6768195,
  @ExecutionOrder = @ExecutionOrder_d6768195,
  @ConfigurationID = @ConfigurationID_d6768195,
  @Status = @Status_d6768195,
  @ContextBehavior = @ContextBehavior_d6768195,
  @ContextMessageCount = @ContextMessageCount_d6768195;

-- Save MJ: AI Agent Actions (core SP call only)
DECLARE @ID_91517f53 UNIQUEIDENTIFIER,
@AgentID_91517f53 UNIQUEIDENTIFIER,
@ActionID_91517f53 UNIQUEIDENTIFIER,
@Status_91517f53 NVARCHAR(15),
@MinExecutionsPerRun_91517f53 INT,
@MaxExecutionsPerRun_91517f53 INT,
@ResultExpirationTurns_91517f53 INT,
@ResultExpirationMode_91517f53 NVARCHAR(20),
@CompactMode_91517f53 NVARCHAR(20),
@CompactLength_91517f53 INT,
@CompactPromptID_91517f53 UNIQUEIDENTIFIER
SET
  @ID_91517f53 = 'F77AEFDE-EE1F-42B4-B1A2-C862281E98E0'
SET
  @AgentID_91517f53 = '204FF1D6-A807-4278-B71A-9D692F19E808'
SET
  @ActionID_91517f53 = '2504E288-ADF7-4913-A627-AA14276BAA55'
SET
  @Status_91517f53 = N'Active'
SET
  @ResultExpirationMode_91517f53 = N'None'
EXEC [${flyway:defaultSchema}].spCreateAIAgentAction @ID = @ID_91517f53,
  @AgentID = @AgentID_91517f53,
  @ActionID = @ActionID_91517f53,
  @Status = @Status_91517f53,
  @MinExecutionsPerRun = @MinExecutionsPerRun_91517f53,
  @MaxExecutionsPerRun = @MaxExecutionsPerRun_91517f53,
  @ResultExpirationTurns = @ResultExpirationTurns_91517f53,
  @ResultExpirationMode = @ResultExpirationMode_91517f53,
  @CompactMode = @CompactMode_91517f53,
  @CompactLength = @CompactLength_91517f53,
  @CompactPromptID = @CompactPromptID_91517f53;

-- Save MJ: AI Agent Actions (core SP call only)
DECLARE @ID_bd3dd93d UNIQUEIDENTIFIER,
@AgentID_bd3dd93d UNIQUEIDENTIFIER,
@ActionID_bd3dd93d UNIQUEIDENTIFIER,
@Status_bd3dd93d NVARCHAR(15),
@MinExecutionsPerRun_bd3dd93d INT,
@MaxExecutionsPerRun_bd3dd93d INT,
@ResultExpirationTurns_bd3dd93d INT,
@ResultExpirationMode_bd3dd93d NVARCHAR(20),
@CompactMode_bd3dd93d NVARCHAR(20),
@CompactLength_bd3dd93d INT,
@CompactPromptID_bd3dd93d UNIQUEIDENTIFIER
SET
  @ID_bd3dd93d = '5B103E41-9A08-46D4-A1C9-2716167A6A85'
SET
  @AgentID_bd3dd93d = '204FF1D6-A807-4278-B71A-9D692F19E808'
SET
  @ActionID_bd3dd93d = 'FCAAD325-0D33-4E48-BC25-49C0E3587062'
SET
  @Status_bd3dd93d = N'Active'
SET
  @ResultExpirationMode_bd3dd93d = N'None'
EXEC [${flyway:defaultSchema}].spCreateAIAgentAction @ID = @ID_bd3dd93d,
  @AgentID = @AgentID_bd3dd93d,
  @ActionID = @ActionID_bd3dd93d,
  @Status = @Status_bd3dd93d,
  @MinExecutionsPerRun = @MinExecutionsPerRun_bd3dd93d,
  @MaxExecutionsPerRun = @MaxExecutionsPerRun_bd3dd93d,
  @ResultExpirationTurns = @ResultExpirationTurns_bd3dd93d,
  @ResultExpirationMode = @ResultExpirationMode_bd3dd93d,
  @CompactMode = @CompactMode_bd3dd93d,
  @CompactLength = @CompactLength_bd3dd93d,
  @CompactPromptID = @CompactPromptID_bd3dd93d;

-- Save MJ: AI Agents (core SP call only)
DECLARE @ID_5fa7ce83 UNIQUEIDENTIFIER,
@Name_5fa7ce83 NVARCHAR(255),
@Description_5fa7ce83 NVARCHAR(MAX),
@LogoURL_5fa7ce83 NVARCHAR(255),
@ParentID_5fa7ce83 UNIQUEIDENTIFIER,
@ExposeAsAction_5fa7ce83 BIT,
@ExecutionOrder_5fa7ce83 INT,
@ExecutionMode_5fa7ce83 NVARCHAR(20),
@EnableContextCompression_5fa7ce83 BIT,
@ContextCompressionMessageThreshold_5fa7ce83 INT,
@ContextCompressionPromptID_5fa7ce83 UNIQUEIDENTIFIER,
@ContextCompressionMessageRetentionCount_5fa7ce83 INT,
@TypeID_5fa7ce83 UNIQUEIDENTIFIER,
@Status_5fa7ce83 NVARCHAR(20),
@DriverClass_5fa7ce83 NVARCHAR(255),
@IconClass_5fa7ce83 NVARCHAR(100),
@ModelSelectionMode_5fa7ce83 NVARCHAR(50),
@PayloadDownstreamPaths_5fa7ce83 NVARCHAR(MAX),
@PayloadUpstreamPaths_5fa7ce83 NVARCHAR(MAX),
@PayloadSelfReadPaths_5fa7ce83 NVARCHAR(MAX),
@PayloadSelfWritePaths_5fa7ce83 NVARCHAR(MAX),
@PayloadScope_5fa7ce83 NVARCHAR(MAX),
@FinalPayloadValidation_5fa7ce83 NVARCHAR(MAX),
@FinalPayloadValidationMode_5fa7ce83 NVARCHAR(25),
@FinalPayloadValidationMaxRetries_5fa7ce83 INT,
@MaxCostPerRun_5fa7ce83 DECIMAL(10, 4),
@MaxTokensPerRun_5fa7ce83 INT,
@MaxIterationsPerRun_5fa7ce83 INT,
@MaxTimePerRun_5fa7ce83 INT,
@MinExecutionsPerRun_5fa7ce83 INT,
@MaxExecutionsPerRun_5fa7ce83 INT,
@StartingPayloadValidation_5fa7ce83 NVARCHAR(MAX),
@StartingPayloadValidationMode_5fa7ce83 NVARCHAR(25),
@DefaultPromptEffortLevel_5fa7ce83 INT,
@ChatHandlingOption_5fa7ce83 NVARCHAR(30),
@DefaultArtifactTypeID_5fa7ce83 UNIQUEIDENTIFIER,
@OwnerUserID_5fa7ce83 UNIQUEIDENTIFIER,
@InvocationMode_5fa7ce83 NVARCHAR(20),
@ArtifactCreationMode_5fa7ce83 NVARCHAR(20),
@FunctionalRequirements_5fa7ce83 NVARCHAR(MAX),
@TechnicalDesign_5fa7ce83 NVARCHAR(MAX),
@InjectNotes_5fa7ce83 BIT,
@MaxNotesToInject_5fa7ce83 INT,
@NoteInjectionStrategy_5fa7ce83 NVARCHAR(20),
@InjectExamples_5fa7ce83 BIT,
@MaxExamplesToInject_5fa7ce83 INT,
@ExampleInjectionStrategy_5fa7ce83 NVARCHAR(20),
@IsRestricted_5fa7ce83 BIT,
@MessageMode_5fa7ce83 NVARCHAR(50),
@MaxMessages_5fa7ce83 INT,
@AttachmentStorageProviderID_5fa7ce83 UNIQUEIDENTIFIER,
@AttachmentRootPath_5fa7ce83 NVARCHAR(500),
@InlineStorageThresholdBytes_5fa7ce83 INT,
@AgentTypePromptParams_5fa7ce83 NVARCHAR(MAX),
@ScopeConfig_5fa7ce83 NVARCHAR(MAX),
@NoteRetentionDays_5fa7ce83 INT,
@ExampleRetentionDays_5fa7ce83 INT,
@AutoArchiveEnabled_5fa7ce83 BIT,
@RerankerConfiguration_5fa7ce83 NVARCHAR(MAX)
SET
  @ID_5fa7ce83 = '17E1C958-909C-41B2-8B52-138AED224108'
SET
  @Name_5fa7ce83 = N'Query Strategist'
SET
  @Description_5fa7ce83 = N'Technical sub-agent that handles schema exploration, SQL generation, query testing, and structured result formatting. Translates business requirements from the Query Builder orchestrator into optimized SQL queries.'
SET
  @ParentID_5fa7ce83 = '204FF1D6-A807-4278-B71A-9D692F19E808'
SET
  @ExposeAsAction_5fa7ce83 = 0
SET
  @ExecutionOrder_5fa7ce83 = 0
SET
  @ExecutionMode_5fa7ce83 = N'Sequential'
SET
  @EnableContextCompression_5fa7ce83 = 0
SET
  @TypeID_5fa7ce83 = 'F7926101-5099-4FA5-836A-479D9707C818'
SET
  @Status_5fa7ce83 = N'Active'
SET
  @IconClass_5fa7ce83 = N'fa-solid fa-database'
SET
  @ModelSelectionMode_5fa7ce83 = N'Agent'
SET
  @PayloadDownstreamPaths_5fa7ce83 = N'[
  "*"
]'
SET
  @PayloadUpstreamPaths_5fa7ce83 = N'[
  "*"
]'
SET
  @FinalPayloadValidation_5fa7ce83 = N'{"source:string:!empty":"query","title:string:!empty":"Descriptive title","plan:string?":"Optional markdown plan","columns:[0+]":[{"field:string:!empty":"ColumnName","headerName?":"Display Name"}],"rows:[0+]":[],"metadata?":{"sql:string?":"SELECT ...","rowCount:number?":0,"executionTimeMs:number?":0}}'
SET
  @FinalPayloadValidationMode_5fa7ce83 = N'Retry'
SET
  @FinalPayloadValidationMaxRetries_5fa7ce83 = 3
SET
  @StartingPayloadValidationMode_5fa7ce83 = N'Fail'
SET
  @InvocationMode_5fa7ce83 = N'Sub-Agent'
SET
  @ArtifactCreationMode_5fa7ce83 = N'Never'
SET
  @InjectNotes_5fa7ce83 = 1
SET
  @MaxNotesToInject_5fa7ce83 = 5
SET
  @NoteInjectionStrategy_5fa7ce83 = N'Relevant'
SET
  @InjectExamples_5fa7ce83 = 0
SET
  @MaxExamplesToInject_5fa7ce83 = 3
SET
  @ExampleInjectionStrategy_5fa7ce83 = N'Semantic'
SET
  @IsRestricted_5fa7ce83 = 0
SET
  @MessageMode_5fa7ce83 = N'None'
SET
  @NoteRetentionDays_5fa7ce83 = 90
SET
  @ExampleRetentionDays_5fa7ce83 = 180
SET
  @AutoArchiveEnabled_5fa7ce83 = 1
EXEC [${flyway:defaultSchema}].spCreateAIAgent @ID = @ID_5fa7ce83,
  @Name = @Name_5fa7ce83,
  @Description = @Description_5fa7ce83,
  @LogoURL = @LogoURL_5fa7ce83,
  @ParentID = @ParentID_5fa7ce83,
  @ExposeAsAction = @ExposeAsAction_5fa7ce83,
  @ExecutionOrder = @ExecutionOrder_5fa7ce83,
  @ExecutionMode = @ExecutionMode_5fa7ce83,
  @EnableContextCompression = @EnableContextCompression_5fa7ce83,
  @ContextCompressionMessageThreshold = @ContextCompressionMessageThreshold_5fa7ce83,
  @ContextCompressionPromptID = @ContextCompressionPromptID_5fa7ce83,
  @ContextCompressionMessageRetentionCount = @ContextCompressionMessageRetentionCount_5fa7ce83,
  @TypeID = @TypeID_5fa7ce83,
  @Status = @Status_5fa7ce83,
  @DriverClass = @DriverClass_5fa7ce83,
  @IconClass = @IconClass_5fa7ce83,
  @ModelSelectionMode = @ModelSelectionMode_5fa7ce83,
  @PayloadDownstreamPaths = @PayloadDownstreamPaths_5fa7ce83,
  @PayloadUpstreamPaths = @PayloadUpstreamPaths_5fa7ce83,
  @PayloadSelfReadPaths = @PayloadSelfReadPaths_5fa7ce83,
  @PayloadSelfWritePaths = @PayloadSelfWritePaths_5fa7ce83,
  @PayloadScope = @PayloadScope_5fa7ce83,
  @FinalPayloadValidation = @FinalPayloadValidation_5fa7ce83,
  @FinalPayloadValidationMode = @FinalPayloadValidationMode_5fa7ce83,
  @FinalPayloadValidationMaxRetries = @FinalPayloadValidationMaxRetries_5fa7ce83,
  @MaxCostPerRun = @MaxCostPerRun_5fa7ce83,
  @MaxTokensPerRun = @MaxTokensPerRun_5fa7ce83,
  @MaxIterationsPerRun = @MaxIterationsPerRun_5fa7ce83,
  @MaxTimePerRun = @MaxTimePerRun_5fa7ce83,
  @MinExecutionsPerRun = @MinExecutionsPerRun_5fa7ce83,
  @MaxExecutionsPerRun = @MaxExecutionsPerRun_5fa7ce83,
  @StartingPayloadValidation = @StartingPayloadValidation_5fa7ce83,
  @StartingPayloadValidationMode = @StartingPayloadValidationMode_5fa7ce83,
  @DefaultPromptEffortLevel = @DefaultPromptEffortLevel_5fa7ce83,
  @ChatHandlingOption = @ChatHandlingOption_5fa7ce83,
  @DefaultArtifactTypeID = @DefaultArtifactTypeID_5fa7ce83,
  @OwnerUserID = @OwnerUserID_5fa7ce83,
  @InvocationMode = @InvocationMode_5fa7ce83,
  @ArtifactCreationMode = @ArtifactCreationMode_5fa7ce83,
  @FunctionalRequirements = @FunctionalRequirements_5fa7ce83,
  @TechnicalDesign = @TechnicalDesign_5fa7ce83,
  @InjectNotes = @InjectNotes_5fa7ce83,
  @MaxNotesToInject = @MaxNotesToInject_5fa7ce83,
  @NoteInjectionStrategy = @NoteInjectionStrategy_5fa7ce83,
  @InjectExamples = @InjectExamples_5fa7ce83,
  @MaxExamplesToInject = @MaxExamplesToInject_5fa7ce83,
  @ExampleInjectionStrategy = @ExampleInjectionStrategy_5fa7ce83,
  @IsRestricted = @IsRestricted_5fa7ce83,
  @MessageMode = @MessageMode_5fa7ce83,
  @MaxMessages = @MaxMessages_5fa7ce83,
  @AttachmentStorageProviderID = @AttachmentStorageProviderID_5fa7ce83,
  @AttachmentRootPath = @AttachmentRootPath_5fa7ce83,
  @InlineStorageThresholdBytes = @InlineStorageThresholdBytes_5fa7ce83,
  @AgentTypePromptParams = @AgentTypePromptParams_5fa7ce83,
  @ScopeConfig = @ScopeConfig_5fa7ce83,
  @NoteRetentionDays = @NoteRetentionDays_5fa7ce83,
  @ExampleRetentionDays = @ExampleRetentionDays_5fa7ce83,
  @AutoArchiveEnabled = @AutoArchiveEnabled_5fa7ce83,
  @RerankerConfiguration = @RerankerConfiguration_5fa7ce83;

-- Save MJ: AI Agent Relationships (core SP call only)
DECLARE @ID_f5444855 UNIQUEIDENTIFIER,
@AgentID_f5444855 UNIQUEIDENTIFIER,
@SubAgentID_f5444855 UNIQUEIDENTIFIER,
@Status_f5444855 NVARCHAR(50),
@SubAgentOutputMapping_f5444855 NVARCHAR(MAX),
@SubAgentInputMapping_f5444855 NVARCHAR(MAX),
@SubAgentContextPaths_f5444855 NVARCHAR(MAX),
@MessageMode_f5444855 NVARCHAR(50),
@MaxMessages_f5444855 INT
SET
  @ID_f5444855 = 'C08A26CB-EDBD-4887-BC1B-3E197678DCFF'
SET
  @AgentID_f5444855 = '204FF1D6-A807-4278-B71A-9D692F19E808'
SET
  @SubAgentID_f5444855 = '17E1C958-909C-41B2-8B52-138AED224108'
SET
  @Status_f5444855 = N'Active'
SET
  @SubAgentOutputMapping_f5444855 = N'{
  "*": "queryResults"
}'
SET
  @SubAgentContextPaths_f5444855 = N'[
  "*"
]'
SET
  @MessageMode_f5444855 = N'None'
EXEC [${flyway:defaultSchema}].spCreateAIAgentRelationship @ID = @ID_f5444855,
  @AgentID = @AgentID_f5444855,
  @SubAgentID = @SubAgentID_f5444855,
  @Status = @Status_f5444855,
  @SubAgentOutputMapping = @SubAgentOutputMapping_f5444855,
  @SubAgentInputMapping = @SubAgentInputMapping_f5444855,
  @SubAgentContextPaths = @SubAgentContextPaths_f5444855,
  @MessageMode = @MessageMode_f5444855,
  @MaxMessages = @MaxMessages_f5444855;

-- Save MJ: AI Agent Data Sources (core SP call only)
DECLARE @ID_8aca8093 UNIQUEIDENTIFIER,
@AgentID_8aca8093 UNIQUEIDENTIFIER,
@Name_8aca8093 NVARCHAR(255),
@Description_8aca8093 NVARCHAR(MAX),
@SourceType_8aca8093 NVARCHAR(20),
@EntityName_8aca8093 NVARCHAR(255),
@ExtraFilter_8aca8093 NVARCHAR(MAX),
@OrderBy_8aca8093 NVARCHAR(500),
@FieldsToRetrieve_8aca8093 NVARCHAR(MAX),
@ResultType_8aca8093 NVARCHAR(20),
@QueryName_8aca8093 NVARCHAR(255),
@CategoryPath_8aca8093 NVARCHAR(500),
@Parameters_8aca8093 NVARCHAR(MAX),
@MaxRows_8aca8093 INT,
@ExecutionOrder_8aca8093 INT,
@Status_8aca8093 NVARCHAR(20),
@CachePolicy_8aca8093 NVARCHAR(20),
@CacheTimeoutSeconds_8aca8093 INT,
@DestinationType_8aca8093 NVARCHAR(20),
@DestinationPath_8aca8093 NVARCHAR(500)
SET
  @ID_8aca8093 = '78B008BC-9361-4331-B08F-1386A8E00B51'
SET
  @AgentID_8aca8093 = '17E1C958-909C-41B2-8B52-138AED224108'
SET
  @Name_8aca8093 = N'ALL_ENTITIES'
SET
  @Description_8aca8093 = N'Complete list of all entities in the system for schema exploration'
SET
  @SourceType_8aca8093 = N'RunView'
SET
  @EntityName_8aca8093 = N'MJ: Entities'
SET
  @OrderBy_8aca8093 = N'Name ASC'
SET
  @FieldsToRetrieve_8aca8093 = N'["Name", "Description", "SchemaName", "BaseTable", "BaseView"]'
SET
  @ResultType_8aca8093 = N'simple'
SET
  @ExecutionOrder_8aca8093 = 1
SET
  @Status_8aca8093 = N'Active'
SET
  @CachePolicy_8aca8093 = N'PerAgent'
SET
  @CacheTimeoutSeconds_8aca8093 = 3600
SET
  @DestinationType_8aca8093 = N'Data'
EXEC [${flyway:defaultSchema}].spCreateAIAgentDataSource @ID = @ID_8aca8093,
  @AgentID = @AgentID_8aca8093,
  @Name = @Name_8aca8093,
  @Description = @Description_8aca8093,
  @SourceType = @SourceType_8aca8093,
  @EntityName = @EntityName_8aca8093,
  @ExtraFilter = @ExtraFilter_8aca8093,
  @OrderBy = @OrderBy_8aca8093,
  @FieldsToRetrieve = @FieldsToRetrieve_8aca8093,
  @ResultType = @ResultType_8aca8093,
  @QueryName = @QueryName_8aca8093,
  @CategoryPath = @CategoryPath_8aca8093,
  @Parameters = @Parameters_8aca8093,
  @MaxRows = @MaxRows_8aca8093,
  @ExecutionOrder = @ExecutionOrder_8aca8093,
  @Status = @Status_8aca8093,
  @CachePolicy = @CachePolicy_8aca8093,
  @CacheTimeoutSeconds = @CacheTimeoutSeconds_8aca8093,
  @DestinationType = @DestinationType_8aca8093,
  @DestinationPath = @DestinationPath_8aca8093;

-- Save MJ: AI Agent Prompts (core SP call only)
DECLARE @ID_07760f20 UNIQUEIDENTIFIER,
@AgentID_07760f20 UNIQUEIDENTIFIER,
@PromptID_07760f20 UNIQUEIDENTIFIER,
@Purpose_07760f20 NVARCHAR(MAX),
@ExecutionOrder_07760f20 INT,
@ConfigurationID_07760f20 UNIQUEIDENTIFIER,
@Status_07760f20 NVARCHAR(20),
@ContextBehavior_07760f20 NVARCHAR(50),
@ContextMessageCount_07760f20 INT
SET
  @ID_07760f20 = '38401B20-3B59-4BEC-909D-A39AE0246285'
SET
  @AgentID_07760f20 = '17E1C958-909C-41B2-8B52-138AED224108'
SET
  @PromptID_07760f20 = '6712859D-9958-416D-A99B-D9517CB00553'
SET
  @ExecutionOrder_07760f20 = 0
SET
  @Status_07760f20 = N'Active'
SET
  @ContextBehavior_07760f20 = N'Complete'
EXEC [${flyway:defaultSchema}].spCreateAIAgentPrompt @ID = @ID_07760f20,
  @AgentID = @AgentID_07760f20,
  @PromptID = @PromptID_07760f20,
  @Purpose = @Purpose_07760f20,
  @ExecutionOrder = @ExecutionOrder_07760f20,
  @ConfigurationID = @ConfigurationID_07760f20,
  @Status = @Status_07760f20,
  @ContextBehavior = @ContextBehavior_07760f20,
  @ContextMessageCount = @ContextMessageCount_07760f20;

-- Save MJ: AI Agent Actions (core SP call only)
DECLARE @ID_171b9d41 UNIQUEIDENTIFIER,
@AgentID_171b9d41 UNIQUEIDENTIFIER,
@ActionID_171b9d41 UNIQUEIDENTIFIER,
@Status_171b9d41 NVARCHAR(15),
@MinExecutionsPerRun_171b9d41 INT,
@MaxExecutionsPerRun_171b9d41 INT,
@ResultExpirationTurns_171b9d41 INT,
@ResultExpirationMode_171b9d41 NVARCHAR(20),
@CompactMode_171b9d41 NVARCHAR(20),
@CompactLength_171b9d41 INT,
@CompactPromptID_171b9d41 UNIQUEIDENTIFIER
SET
  @ID_171b9d41 = '97A5AC30-98AF-4249-8A50-3F09C5D8AB26'
SET
  @AgentID_171b9d41 = '17E1C958-909C-41B2-8B52-138AED224108'
SET
  @ActionID_171b9d41 = 'BF084609-3C2B-4FAF-8D4C-598918AB765A'
SET
  @Status_171b9d41 = N'Active'
SET
  @ResultExpirationMode_171b9d41 = N'None'
EXEC [${flyway:defaultSchema}].spCreateAIAgentAction @ID = @ID_171b9d41,
  @AgentID = @AgentID_171b9d41,
  @ActionID = @ActionID_171b9d41,
  @Status = @Status_171b9d41,
  @MinExecutionsPerRun = @MinExecutionsPerRun_171b9d41,
  @MaxExecutionsPerRun = @MaxExecutionsPerRun_171b9d41,
  @ResultExpirationTurns = @ResultExpirationTurns_171b9d41,
  @ResultExpirationMode = @ResultExpirationMode_171b9d41,
  @CompactMode = @CompactMode_171b9d41,
  @CompactLength = @CompactLength_171b9d41,
  @CompactPromptID = @CompactPromptID_171b9d41;

-- Save MJ: AI Agent Actions (core SP call only)
DECLARE @ID_fe93e372 UNIQUEIDENTIFIER,
@AgentID_fe93e372 UNIQUEIDENTIFIER,
@ActionID_fe93e372 UNIQUEIDENTIFIER,
@Status_fe93e372 NVARCHAR(15),
@MinExecutionsPerRun_fe93e372 INT,
@MaxExecutionsPerRun_fe93e372 INT,
@ResultExpirationTurns_fe93e372 INT,
@ResultExpirationMode_fe93e372 NVARCHAR(20),
@CompactMode_fe93e372 NVARCHAR(20),
@CompactLength_fe93e372 INT,
@CompactPromptID_fe93e372 UNIQUEIDENTIFIER
SET
  @ID_fe93e372 = '9A611437-1CC2-4B91-B375-722F2BD1B1CD'
SET
  @AgentID_fe93e372 = '17E1C958-909C-41B2-8B52-138AED224108'
SET
  @ActionID_fe93e372 = '4B92BDED-4AD6-497A-B16E-BAE85BAB7563'
SET
  @Status_fe93e372 = N'Active'
SET
  @ResultExpirationMode_fe93e372 = N'None'
EXEC [${flyway:defaultSchema}].spCreateAIAgentAction @ID = @ID_fe93e372,
  @AgentID = @AgentID_fe93e372,
  @ActionID = @ActionID_fe93e372,
  @Status = @Status_fe93e372,
  @MinExecutionsPerRun = @MinExecutionsPerRun_fe93e372,
  @MaxExecutionsPerRun = @MaxExecutionsPerRun_fe93e372,
  @ResultExpirationTurns = @ResultExpirationTurns_fe93e372,
  @ResultExpirationMode = @ResultExpirationMode_fe93e372,
  @CompactMode = @CompactMode_fe93e372,
  @CompactLength = @CompactLength_fe93e372,
  @CompactPromptID = @CompactPromptID_fe93e372;

-- Save MJ: Queries (core SP call only)
DECLARE @Name_80b84eeb NVARCHAR(255),
@CategoryID_80b84eeb UNIQUEIDENTIFIER,
@UserQuestion_80b84eeb NVARCHAR(MAX),
@Description_80b84eeb NVARCHAR(MAX),
@SQL_80b84eeb NVARCHAR(MAX),
@TechnicalDescription_80b84eeb NVARCHAR(MAX),
@OriginalSQL_80b84eeb NVARCHAR(MAX),
@Feedback_80b84eeb NVARCHAR(MAX),
@Status_80b84eeb NVARCHAR(15),
@QualityRank_80b84eeb INT,
@ExecutionCostRank_80b84eeb INT,
@UsesTemplate_80b84eeb BIT,
@AuditQueryRuns_80b84eeb BIT,
@CacheEnabled_80b84eeb BIT,
@CacheTTLMinutes_80b84eeb INT,
@CacheMaxSize_80b84eeb INT,
@EmbeddingVector_80b84eeb NVARCHAR(MAX),
@EmbeddingModelID_80b84eeb UNIQUEIDENTIFIER,
@CacheValidationSQL_80b84eeb NVARCHAR(MAX),
@ID_80b84eeb UNIQUEIDENTIFIER
SET
  @Name_80b84eeb = N'GetConversationsForMemoryManager'
SET
  @CategoryID_80b84eeb = '5609FBC7-381C-4F9C-9C74-04B52C1FF3DA'
SET
  @UserQuestion_80b84eeb = N'What conversations have new activity that need to be analyzed for memory extraction?'
SET
  @Description_80b84eeb = N'Returns all conversation data needed for memory extraction in a single query: conversations with new activity, their details with ratings, and linked agent runs for scope inheritance. Optimized to replace 4 separate sequential queries.'
SET
  @SQL_80b84eeb = N'-- Get Conversations for Memory Manager - Single optimized query
-- Returns all data needed for memory extraction: conversations, details, ratings, and agent runs
-- Uses JSON aggregation to include related data without row multiplication
-- This replaces 4 separate queries with 1 query for better performance
--
-- Parameters:
--   @since (optional): ISO date string - only include conversations with new activity after this date
--   @agentIds: Comma-separated list of agent IDs that have memory enabled

SELECT
    c.ID as ConversationID,
    c.UserID,

    -- Most recent agent run ID for this conversation (for scope inheritance)
    (
        SELECT TOP 1 ar.ID
        FROM [${flyway:defaultSchema}].[vwAIAgentRuns] ar
        WHERE ar.ConversationID = c.ID
        AND ar.AgentID IN ({{ agentIds }})
        ORDER BY ar.StartedAt DESC
    ) as AgentRunID,

    -- Conversation details as JSON array with ratings included
    (
        SELECT
            cd.ID as id,
            cd.Role as role,
            cd.Message as message,
            cd.__mj_CreatedAt as createdAt,
            cdr.Rating as rating,
            cdr.Comments as ratingComment
        FROM [${flyway:defaultSchema}].[vwConversationDetails] cd
        LEFT OUTER JOIN [${flyway:defaultSchema}].[vwConversationDetailRatings] cdr
            ON cdr.ConversationDetailID = cd.ID
        WHERE cd.ConversationID = c.ID
        AND cd.Status = ''Complete''
        ORDER BY cd.__mj_CreatedAt ASC
        FOR JSON PATH
    ) as MessagesJSON,

    -- Rating summary flags
    CASE WHEN EXISTS (
        SELECT 1 FROM [${flyway:defaultSchema}].[vwConversationDetails] cd
        INNER JOIN [${flyway:defaultSchema}].[vwConversationDetailRatings] cdr ON cdr.ConversationDetailID = cd.ID
        WHERE cd.ConversationID = c.ID AND cdr.Rating >= 8
    ) THEN 1 ELSE 0
END as HasPositiveRating,

    CASE WHEN EXISTS (
        SELECT 1 FROM [${flyway:defaultSchema}].[vwConversationDetails] cd
        INNER JOIN [${flyway:defaultSchema}].[vwConversationDetailRatings] cdr ON cdr.ConversationDetailID = cd.ID
        WHERE cd.ConversationID = c.ID AND cdr.Rating <= 3
    ) THEN 1 ELSE 0
END as HasNegativeRating,

    CASE WHEN NOT EXISTS (
        SELECT 1 FROM [${flyway:defaultSchema}].[vwConversationDetails] cd
        INNER JOIN [${flyway:defaultSchema}].[vwConversationDetailRatings] cdr ON cdr.ConversationDetailID = cd.ID
        WHERE cd.ConversationID = c.ID
    ) THEN 1 ELSE 0
END as IsUnrated

FROM [${flyway:defaultSchema}].[vwConversations] c

-- Only include conversations with new activity since last run
WHERE EXISTS (
    SELECT 1 FROM [${flyway:defaultSchema}].[vwConversationDetails] cd_new
    WHERE cd_new.ConversationID = c.ID
    {% if since %}
    AND cd_new.__mj_CreatedAt >= ''{{ since }}''
    {% endif %}
)

-- Only include conversations linked to agents that have memory enabled
AND EXISTS (
    SELECT 1 FROM [${flyway:defaultSchema}].[vwAIAgentRuns] ar
    WHERE ar.ConversationID = c.ID
    AND ar.AgentID IN ({{ agentIds }})
)

ORDER BY c.__mj_UpdatedAt DESC
'
SET
  @TechnicalDescription_80b84eeb = N'Single-query optimization that replaces 4 separate RunView calls in Memory Manager (get conversations, get agent runs, get details, get ratings). Uses SQL Server FOR JSON PATH to aggregate conversation details with ratings as JSON arrays. Returns rating summary flags (HasPositiveRating, HasNegativeRating, IsUnrated) and most recent AgentRunID for scope inheritance. Reduces database round trips from 4 to 1.'
SET
  @Status_80b84eeb = N'Approved'
SET
  @QualityRank_80b84eeb = 9
SET
  @ExecutionCostRank_80b84eeb = 3
SET
  @UsesTemplate_80b84eeb = 1
SET
  @AuditQueryRuns_80b84eeb = 0
SET
  @CacheEnabled_80b84eeb = 0
SET
  @EmbeddingVector_80b84eeb = N'[0.05079127848148346,0.09035059064626694,-0.0241005327552557,0.0002047202578978613,0.007942557334899902,-0.004986656829714775,-0.0040833973325788975,-0.013648014515638351,-0.012232557870447636,-0.016947250813245773,-0.028481926769018173,0.007967942394316196,-0.02684820257127285,0.04656028747558594,-0.052749037742614746,-0.0031639356166124344,0.021843701601028442,-0.00868343934416771,0.024816567078232765,0.024035068228840828,-0.00625630933791399,-0.005105008836835623,0.03923854976892471,-0.03631487116217613,-0.011602414771914482,-0.003479759907349944,-0.04228506609797478,0.019970396533608437,0.03680785372853279,-0.05429837480187416,0.0020721578039228916,0.03860961273312569,-0.063536137342453,0.020076200366020203,0.0000018501910972190672,-0.029065575450658798,-0.04729870334267616,0.016312794759869576,0.0121134789660573,0.033217646181583405,0.06390431523323059,0.010297387838363647,0.04633641615509987,0.013665363192558289,-0.058271877467632294,0.04765554890036583,-0.006883734837174416,-0.06572329252958298,0.046769462525844574,0.02473931387066841,-0.009251734241843224,0.032639279961586,-0.027040032669901848,0.005404791794717312,0.03869984298944473,-0.07086299359798431,0.012611155398190022,0.042279329150915146,0.06193437799811363,-0.0017248332733288407,0.036020055413246155,-0.012290241196751595,-0.010795294307172298,-0.023887621238827705,-0.00048658213927410543,0.004781071562319994,-0.027481012046337128,-0.01167088933289051,-0.005306650884449482,0.012155258096754551,0.1098610982298851,0.048767127096652985,0.014109102077782154,-0.005584047641605139,-0.023643946275115013,-0.05883141607046127,-0.0119113028049469,-0.0008175396360456944,-0.01818632148206234,0.011405295692384243,-0.0691610649228096,0.03485322743654251,-0.016906920820474625,-0.020627707242965698,-0.05224714055657387,-0.017756739631295204,-0.00005160645378055051,-0.010144558735191822,-0.012117987498641014,-0.03278453275561333,0.10722796618938446,0.009296494536101818,0.03643833100795746,-0.02586969919502735,-0.02776397578418255,0.002058778889477253,-0.018441760912537575,-0.00994481984525919,0.017424477264285088,-0.08905638009309769,0.026498032733798027,0.03623943775892258,0.03114563226699829,0.02810569480061531,0.049529869109392166,-0.06858674436807632,-0.018866688013076782,-0.037773989140987396,-0.030855953693389893,-0.0016322797164320946,-0.03939410671591759,0.0075011784210801125,-0.023640239611268044,0.0894571989774704,-0.05356133356690407,0.0033090044744312763,-0.055434998124837875,0.08320257812738419,0.0010676984675228596,-0.007338373921811581,0.009556654840707779,0.03627324849367142,-0.028003215789794922,0.024955447763204575,-0.027351753786206245,0.017706898972392082,-0.0022198003716766834,-0.02509322389960289,0.022394653409719467,-0.07395141571760178,-0.01856291852891445,-0.018150687217712402,0.031191453337669373,-0.03474811092019081,-0.005459083244204521,0.04644906520843506,0.025601867586374283,-0.07710008323192596,-0.017003830522298813,-0.0401291623711586,0.06264519691467285,-0.03787681832909584,-0.02545793540775776,-0.017351355403661728,0.03698789328336716,-0.030737601220607758,-0.039643894881010056,0.02032824046909809,-0.00019931506540160626,0.02879779413342476,-0.058180488646030426,0.019686447456479073,0.002907541813328862,0.0023019530344754457,0.003079300280660391,0.010915940627455711,0.10657579451799393,0.08073189109563828,0.006317181047052145,0.06279805302619934,0.04606578126549721,-0.000859603111166507,-0.017565233632922173,-0.0028020672034472227,0.011497484520077705,0.0007478615152649581,0.013867675326764584,0.028941577300429344,-0.027205482125282288,-0.025482267141342163,-0.015496990643441677,0.019426340237259865,-0.026243751868605614,-0.003329381812363863,0.04347588121891022,0.046181272715330124,-0.0378577895462513,-0.002381382044404745,-0.028820278123021126,0.01254812628030777,-0.031145159155130386,-0.05485319346189499,-0.04959753155708313,0.03526325896382332,0.0010121699888259172,-0.03156620264053345,0.07196877151727676,0.021316271275281906,-0.05075361207127571,-0.024181406944990158,0.018523653969168663,-0.062384121119976044,0.025164064019918442,-0.0076613579876720905,0.028020406141877174,-0.004517694003880024,-0.03566809743642807,0.050433333963155746,0.03190324828028679,-0.028339020907878876,-0.056465163826942444,-0.01460159569978714,0.013730207458138466,0.08056039363145828,-0.011897717602550983,-0.022440511733293533,-0.07959193736314774,0.03878672793507576,0.008727208711206913,0.007012821733951569,0.00516737625002861,0.021217189729213715,0.032105930149555206,-0.009648353792726994,-0.023099390789866447,0.028003400191664696,0.039157934486866,0.016207469627261162,0.0008238396840170026,-0.013398611918091774,-0.01404569111764431,0.02496291883289814,-0.029620852321386337,-0.006285957992076874,0.0005397481145337224,0.029324516654014587,0.028163200244307518,0.0014608276542276144,0.03636430948972702,0.05486462637782097,0.006569191347807646,0.0003904184268321842,0.0591057687997818,0.021048828959465027,0.010539560578763485,0.06098775565624237,0.012887216173112392,0.0705694928765297,-0.035670775920152664,-0.003907260950654745,0.04537628963589668,-0.04667634144425392,-0.02407081238925457,0.008037649095058441,0.0061867255717515945,-0.040602907538414,0.05563296750187874,-0.002667628927156329,0.019101625308394432,-0.003512762486934662,0.001137108076363802,0.030229294672608376,0.02169504202902317,-0.05029250681400299,-0.055469121783971786,-0.03266417980194092,-0.018757766112685204,0.005477202124893665,-0.03844166174530983,0.04366390034556389,-0.01916595920920372,0.02346942201256752,0.01841963268816471,-0.013052878901362419,0.04185650125145912,-0.048077140003442764,0.009478059597313404,-0.07091536372900009,0.022565769031643867,-0.004921324085444212,0.04391113668680191,0.011910381726920605,0.08163058012723923,0.0018719411455094814,-0.03828807175159454,0.03158252313733101,0.0425875261425972,0.0010985546978190541,0.040754493325948715,-0.004179877694696188,0.025889461860060692,-0.012415274046361446,-0.015056653879582882,0.004746823105961084,-0.0002814853214658797,0.01745971105992794,0.0441463403403759,-0.08236732333898544,0.014081819914281368,-0.036024268716573715,-0.016545020043849945,-0.003377856919541955,-0.02306751348078251,-0.02636226825416088,-0.01099723856896162,-0.05543310195207596,-0.0648922249674797,0.06529548764228821,0.013662722893059254,0.036326147615909576,-0.007037690375000238,-0.0361054427921772,-0.058202896267175674,-0.004697256721556187,-0.04680855572223663,0.0021172116976231337,-0.01232223305851221,0.02042219787836075,0.05537120997905731,0.03784762695431709,-0.04327843338251114,0.032823529094457626,-0.014867894351482391,-0.008223011158406734,0.03855353593826294,-0.013950797729194164,0.04459561035037041,0.027599478140473366,-0.004590993747115135,0.03264136239886284,-0.010919061489403248,-0.05871909111738205,0.035408467054367065,0.06742919236421585,0.010252798907458782,-0.07799189537763596,-0.016890371218323708,-0.007714482955634594,0.05800987407565117,-0.02045244351029396,0.005857840180397034,-0.02115759439766407,-0.06399159878492355,0.030116943642497063,-0.053240351378917694,0.003706203540787101,-0.04979139193892479,0.06886255741119385,-0.04757111892104149,0.0033437798265367746,0.00736438762396574,-0.022324025630950928,-0.02843300811946392,0.03313082829117775,-0.031460754573345184,-0.019286077469587326,0.0031424034386873245,-0.03315126895904541,-0.06568882614374161,0.014908798970282078,-0.04478200152516365,-0.013060609810054302,-0.017260616645216942,-0.01208257395774126,0.0013886390952393413,-0.024398701265454292,-0.0075802854262292385,0.004130313638597727,-0.06296239048242569,-0.021676722913980484,0.029038386419415474,0.09631688892841339,0.024205869063735008,-0.03380195051431656,0.0354977510869503,-0.040639523416757584,0.028481315821409225,-0.006406386848539114,0.0029548911843448877,0.013059730641543865,0.033372655510902405,-0.02978798747062683,-0.05105017125606537,0.06694665551185608,0.02004576474428177,-0.10536867380142212,-0.01994118094444275,-0.013440405018627644,-0.027942100539803505,-0.020736780017614365,0.03392152115702629,-0.09779267013072968,0.014945067465305328,-0.028502844274044037,0.020530885085463524,0.01761610433459282,-0.0625622346997261,-0.033886488527059555,-0.1131233349442482,0.00009574100113241002,0.012706561014056206,-0.06307659298181534,0.019195737317204475,-0.08009906113147736,0.005383370444178581,-0.017002683132886887,-0.004235582426190376,-0.021217117086052895,0.01647210866212845,-0.0007949425489641726,-0.011339214630424976,0.006899432744830847,0.0444469228386879,0.008899403735995293,-0.06134840101003647,0.03177731856703758,0.015260351821780205,0.06299184262752533,0.0032627482432872057,-0.02273254469037056,-0.03224923461675644,0.005678757559508085,-0.01799294725060463,-0.028770867735147476,0.05657487362623215,-0.013943229801952839,0.03969544544816017,0.02078286185860634,0.046805765479803085,-0.004324295558035374,0.05251304432749748,0.029305709525942802,0.022435922175645828,-0.026093272492289543,0.02631351165473461,-0.00607965188100934,0.04262903332710266,0.01061802078038454,0.02471427246928215,-0.00781203480437398,-0.014936456456780434,-0.025120357051491737,-0.0036682637874037027,-0.018968453630805016,-0.0644301250576973,0.03706567734479904,0.031014690175652504,-0.07060138136148453,-0.02515042945742607,-0.008712846785783768,-0.03514249250292778,0.018190797418355942,0.08127940446138382,-0.017786934971809387,0.018582746386528015,0.024726053699851036,0.00039170298259705305,-0.026734352111816406,-0.021657204255461693,-0.0040737902745604515,-0.00675504794344306,-0.008087733760476112,-0.02449152059853077,-0.005953727290034294,0.007129926234483719,0.013528949581086636,-0.024357624351978302,-0.07492576539516449,-0.047737520188093185,0.014164100401103497,0.05191383510828018,0.035761598497629166,0.035110652446746826,0.008612304925918579,0.013734747655689716,-0.028543705120682716,0.05263384059071541,-0.09211473166942596,0.018031325191259384,0.025148333981633186,0.06415750831365585,0.011009620502591133,0.030593188479542732,-0.023033324629068375,0.025234058499336243,0.02118276059627533,-0.015876511111855507,-0.0508064404129982,-0.012985431589186192,-0.000732322339899838,0.02684761956334114,0.019889231771230698,0.050808217376470566,-0.04824836552143097,0.00004551123856799677,0.04843232035636902,-0.07893157750368118,0.007085248362272978,-0.0434907041490078,-0.012945124879479408,-0.016079507768154144,0.00799733679741621,-0.013625946827232838,0.018292617052793503,0.002236912725493312,0.04320317879319191,-0.011262319050729275,-0.05728518217802048,0.02192917838692665,-0.05100050941109657,-0.0038374271243810654,-0.032028570771217346,-0.004153268411755562,0.014178507961332798,0.018571963533759117,0.06490568816661835,-0.04621608182787895,0.0011113806394860148,0.0038916936609894037,0.011749910190701485,0.02180490642786026,0.03846370801329613,-0.05944552272558212,-0.031017789617180824,0.03457550331950188,-0.031838394701480865,-0.03136684373021126,0.0001624780852580443,0.04812081530690193,-0.004885158967226744,0.015770161524415016,-0.006694483105093241,0.0160669032484293,-0.0043753222562372684,0.025523560121655464,-0.03197191283106804,0.015508252196013927,0.0016496420139446855,0.008066253736615181,0.06393346190452576,-0.052016470581293106,0.041149038821458817,-0.006335366051644087,-0.0408761091530323,-0.022557884454727173,-0.010689076967537403,0.0378512367606163,0.06826858222484589,0.011972835287451744,-0.07253285497426987,-0.006630072370171547,0.029759662225842476,0.013830936513841152,-0.028837310150265694,-0.017657645046710968,0.0028450982645154,0.040727175772190094,0.018832918256521225,0.053141843527555466,0.022112255915999413,-0.032845836132764816,-0.038760773837566376,-0.08138919621706009,-0.0023772651329636574,0.036029040813446045,-6.432864916884136e-33,-0.023917924612760544,-0.014684871770441532,0.006195457652211189,0.03723994642496109,-0.0597340352833271,-0.014452226459980011,-0.014286693185567856,-0.031614288687705994,-0.0014728907262906432,-0.0454246811568737,-0.019309645518660545,0.04720998555421829,0.037140704691410065,0.017804637551307678,0.024539735168218613,0.018375108018517494,0.024064848199486732,-0.015934990718960762,0.003956449218094349,0.06683484464883804,0.05707010626792908,0.07038233429193497,-0.0026173924561589956,-0.04496459290385246,0.017081035301089287,0.016864199191331863,0.04953546077013016,0.0032294809352606535,0.004290263168513775,0.01644625887274742,-0.017755873501300812,0.011755957268178463,0.0029416726902127266,0.02460000291466713,-0.00520614068955183,-0.040576498955488205,-0.053908150643110275,-0.061240725219249725,0.0105019211769104,-0.03919978067278862,-0.006003388203680515,0.005817030090838671,0.012093015015125275,0.010909541510045528,0.019264882430434227,-0.03533279895782471,0.034129075706005096,-0.009940299205482006,-0.04438069090247154,-0.030499612912535667,-0.005030960310250521,0.016664298251271248,0.0006420074496418238,0.07340309023857117,0.0007477820618078113,-0.02241343818604946,-0.00947281252592802,0.0218973346054554,-0.057180631905794144,0.03891448304057121,-0.06643245369195938,0.015900282189249992,-0.02570738084614277,0.05755329877138138,0.03457222878932953,0.015214716084301472,0.04068397358059883,0.060166239738464355,0.00036199623718857765,0.017706768587231636,-0.00989444274455309,0.06864777952432632,-0.05683824419975281,-0.0468280054628849,-0.04011251777410507,-0.007704589981585741,-0.0539516881108284,-0.01912015490233898,0.04430456832051277,0.008914164267480373,0.010646039620041847,0.023217666894197464,-0.056944120675325394,-0.010533517226576805,0.037721216678619385,0.05675901100039482,-0.0004984409315511584,-0.03318960592150688,-0.018096156418323517,-0.002046339213848114,-0.06401760131120682,0.012063666246831417,-0.002988585736602545,-0.02988538332283497,0.01409144140779972,-0.00019880582112818956,0.05567929893732071,-0.04396361485123634,-0.013401719741523266,0.015571626834571362,-0.009291345253586769,-0.020664727315306664,0.005512372124940157,0.03060385398566723,-0.014660770073533058,0.004089468624442816,0.02298607863485813,-0.02113240957260132,-0.046136461198329926,-0.009890127927064896,-0.0017711372347548604,0.02748834528028965,0.005973044782876968,0.03226775303483009,-0.008336141705513,0.04134117066860199,-0.005496539641171694,0.11610472947359085,0.03799837827682495,0.048205774277448654,-0.03318478912115097,-0.032624684274196625,0.060979388654232025,-0.026705428957939148,0.00505594490095973,0.02075597085058689,-0.045613549649715424,-0.038081854581832886,0.0028805441688746214,-0.020954394713044167,-0.005293926224112511,0.01901543326675892,2.7053718554270745e-7,0.019686926156282425,0.017047487199306488,-0.013053808361291885,0.003960337024182081,0.0027668620459735394,0.00214202213101089,0.046231482177972794,0.011082331649959087,0.03369522839784622,-0.002964071463793516,0.04340475797653198,0.017111919820308685,0.011001167818903923,0.03854682296514511,-0.07275687158107758,-0.036689192056655884,-0.0218672938644886,-0.09564562886953354,-0.07321562618017197,-0.03604140505194664,0.03735772892832756,0.0071462951600551605,0.04691056162118912,0.0017742825439199805,-0.005430781748145819,0.0074676088988780975,0.019835757091641426,-0.05317511036992073,-0.08343472331762314,0.015415129251778126,0.05399279296398163,-0.052760958671569824,-0.033376842737197876,0.01886281929910183,-0.021096426993608475,0.009936757385730743,-0.047020334750413895,0.01970226876437664,-0.025672458112239838,-0.047675274312496185,0.008177420124411583,-0.045784033834934235,-0.01186355296522379,0.06341540813446045,0.059236180037260056,-0.049784839153289795,-0.05416940152645111,0.005316439084708691,-0.008641050197184086,-0.031758345663547516,0.022063013166189194,0.03223682940006256,0.011694096028804779,0.001983350608497858,0.011517112143337727,0.03735494241118431,-0.017370957881212234,-0.04038471728563309,0.0416184663772583,-0.0342542827129364,-0.0036211232654750347,-0.09179119765758514,0.01881531998515129,0.030116280540823936,-0.021103352308273315,-0.03853075951337814,0.013337511569261551,2.6788554278417677e-34,0.039873164147138596,0.05002487450838089,0.028683243319392204,0.05554112046957016,0.029719317331910133,0.03558764606714249,0.009646526537835598,0.007612765766680241,0.055310722440481186,-0.1114618182182312,-0.007236486300826073]'
SET
  @EmbeddingModelID_80b84eeb = '1D45AA65-41EC-4572-9ECD-AB2826C9B059'
SET
  @ID_80b84eeb = '574FD9D5-AB9E-4FA5-A36C-C25E7D3F63FC'
EXEC [${flyway:defaultSchema}].spUpdateQuery @Name = @Name_80b84eeb,
  @CategoryID = @CategoryID_80b84eeb,
  @UserQuestion = @UserQuestion_80b84eeb,
  @Description = @Description_80b84eeb,
  @SQL = @SQL_80b84eeb,
  @TechnicalDescription = @TechnicalDescription_80b84eeb,
  @OriginalSQL = @OriginalSQL_80b84eeb,
  @Feedback = @Feedback_80b84eeb,
  @Status = @Status_80b84eeb,
  @QualityRank = @QualityRank_80b84eeb,
  @ExecutionCostRank = @ExecutionCostRank_80b84eeb,
  @UsesTemplate = @UsesTemplate_80b84eeb,
  @AuditQueryRuns = @AuditQueryRuns_80b84eeb,
  @CacheEnabled = @CacheEnabled_80b84eeb,
  @CacheTTLMinutes = @CacheTTLMinutes_80b84eeb,
  @CacheMaxSize = @CacheMaxSize_80b84eeb,
  @EmbeddingVector = @EmbeddingVector_80b84eeb,
  @EmbeddingModelID = @EmbeddingModelID_80b84eeb,
  @CacheValidationSQL = @CacheValidationSQL_80b84eeb,
  @ID = @ID_80b84eeb;

-- Save MJ: Query Parameters (core SP call only)
DECLARE @QueryID_a48221f9 UNIQUEIDENTIFIER,
@Name_a48221f9 NVARCHAR(255),
@Type_a48221f9 NVARCHAR(50),
@IsRequired_a48221f9 BIT,
@DefaultValue_a48221f9 NVARCHAR(MAX),
@Description_a48221f9 NVARCHAR(MAX),
@SampleValue_a48221f9 NVARCHAR(MAX),
@ValidationFilters_a48221f9 NVARCHAR(MAX),
@DetectionMethod_a48221f9 NVARCHAR(50),
@AutoDetectConfidenceScore_a48221f9 DECIMAL(3, 2),
@ID_a48221f9 UNIQUEIDENTIFIER
SET
  @QueryID_a48221f9 = '574FD9D5-AB9E-4FA5-A36C-C25E7D3F63FC'
SET
  @Name_a48221f9 = N'since'
SET
  @Type_a48221f9 = N'date'
SET
  @IsRequired_a48221f9 = 0
SET
  @Description_a48221f9 = N'ISO date string - only include conversations with new activity after this date'
SET
  @SampleValue_a48221f9 = N'2024-01-15T10:30:00Z'
SET
  @DetectionMethod_a48221f9 = N'AI'
SET
  @ID_a48221f9 = 'DF0E9F24-CD92-4C6C-BA18-13B443160DE5'
EXEC [${flyway:defaultSchema}].spUpdateQueryParameter @QueryID = @QueryID_a48221f9,
  @Name = @Name_a48221f9,
  @Type = @Type_a48221f9,
  @IsRequired = @IsRequired_a48221f9,
  @DefaultValue = @DefaultValue_a48221f9,
  @Description = @Description_a48221f9,
  @SampleValue = @SampleValue_a48221f9,
  @ValidationFilters = @ValidationFilters_a48221f9,
  @DetectionMethod = @DetectionMethod_a48221f9,
  @AutoDetectConfidenceScore = @AutoDetectConfidenceScore_a48221f9,
  @ID = @ID_a48221f9;

-- Save MJ: Query Parameters (core SP call only)
DECLARE @QueryID_ea18a14a UNIQUEIDENTIFIER,
@Name_ea18a14a NVARCHAR(255),
@Type_ea18a14a NVARCHAR(50),
@IsRequired_ea18a14a BIT,
@DefaultValue_ea18a14a NVARCHAR(MAX),
@Description_ea18a14a NVARCHAR(MAX),
@SampleValue_ea18a14a NVARCHAR(MAX),
@ValidationFilters_ea18a14a NVARCHAR(MAX),
@DetectionMethod_ea18a14a NVARCHAR(50),
@AutoDetectConfidenceScore_ea18a14a DECIMAL(3, 2),
@ID_ea18a14a UNIQUEIDENTIFIER
SET
  @QueryID_ea18a14a = '574FD9D5-AB9E-4FA5-A36C-C25E7D3F63FC'
SET
  @Name_ea18a14a = N'agentIds'
SET
  @Type_ea18a14a = N'string'
SET
  @IsRequired_ea18a14a = 1
SET
  @Description_ea18a14a = N'Comma-separated list of agent IDs that have memory enabled'
SET
  @SampleValue_ea18a14a = N'123e4567-e89b-12d3-a456-426614174000,123e4567-e89b-12d3-a456-426614174001'
SET
  @DetectionMethod_ea18a14a = N'AI'
SET
  @ID_ea18a14a = 'AF4459A1-BEDA-4200-A739-4292E90EA6A1'
EXEC [${flyway:defaultSchema}].spUpdateQueryParameter @QueryID = @QueryID_ea18a14a,
  @Name = @Name_ea18a14a,
  @Type = @Type_ea18a14a,
  @IsRequired = @IsRequired_ea18a14a,
  @DefaultValue = @DefaultValue_ea18a14a,
  @Description = @Description_ea18a14a,
  @SampleValue = @SampleValue_ea18a14a,
  @ValidationFilters = @ValidationFilters_ea18a14a,
  @DetectionMethod = @DetectionMethod_ea18a14a,
  @AutoDetectConfidenceScore = @AutoDetectConfidenceScore_ea18a14a,
  @ID = @ID_ea18a14a;

-- Save MJ: Query Fields (core SP call only)
DECLARE @QueryID_e1518f58 UNIQUEIDENTIFIER,
@Name_e1518f58 NVARCHAR(255),
@Description_e1518f58 NVARCHAR(MAX),
@Sequence_e1518f58 INT,
@SQLBaseType_e1518f58 NVARCHAR(50),
@SQLFullType_e1518f58 NVARCHAR(100),
@SourceEntityID_e1518f58 UNIQUEIDENTIFIER,
@SourceFieldName_e1518f58 NVARCHAR(255),
@IsComputed_e1518f58 BIT,
@ComputationDescription_e1518f58 NVARCHAR(MAX),
@IsSummary_e1518f58 BIT,
@SummaryDescription_e1518f58 NVARCHAR(MAX),
@DetectionMethod_e1518f58 NVARCHAR(50),
@AutoDetectConfidenceScore_e1518f58 DECIMAL(3, 2),
@ID_e1518f58 UNIQUEIDENTIFIER
SET
  @QueryID_e1518f58 = '574FD9D5-AB9E-4FA5-A36C-C25E7D3F63FC'
SET
  @Name_e1518f58 = N'HasPositiveRating'
SET
  @Description_e1518f58 = N'Flag indicating if conversation has any ratings of 8 or higher'
SET
  @Sequence_e1518f58 = 5
SET
  @SQLBaseType_e1518f58 = N'bit'
SET
  @SQLFullType_e1518f58 = N'bit'
SET
  @IsComputed_e1518f58 = 1
SET
  @ComputationDescription_e1518f58 = N'CASE expression checking for existence of positive ratings (>= 8)'
SET
  @IsSummary_e1518f58 = 0
SET
  @DetectionMethod_e1518f58 = N'Manual'
SET
  @ID_e1518f58 = 'ADC80F10-C778-46A7-AB21-1474FF3051BA'
EXEC [${flyway:defaultSchema}].spUpdateQueryField @QueryID = @QueryID_e1518f58,
  @Name = @Name_e1518f58,
  @Description = @Description_e1518f58,
  @Sequence = @Sequence_e1518f58,
  @SQLBaseType = @SQLBaseType_e1518f58,
  @SQLFullType = @SQLFullType_e1518f58,
  @SourceEntityID = @SourceEntityID_e1518f58,
  @SourceFieldName = @SourceFieldName_e1518f58,
  @IsComputed = @IsComputed_e1518f58,
  @ComputationDescription = @ComputationDescription_e1518f58,
  @IsSummary = @IsSummary_e1518f58,
  @SummaryDescription = @SummaryDescription_e1518f58,
  @DetectionMethod = @DetectionMethod_e1518f58,
  @AutoDetectConfidenceScore = @AutoDetectConfidenceScore_e1518f58,
  @ID = @ID_e1518f58;

-- Save MJ: Query Fields (core SP call only)
DECLARE @QueryID_0a0c15f9 UNIQUEIDENTIFIER,
@Name_0a0c15f9 NVARCHAR(255),
@Description_0a0c15f9 NVARCHAR(MAX),
@Sequence_0a0c15f9 INT,
@SQLBaseType_0a0c15f9 NVARCHAR(50),
@SQLFullType_0a0c15f9 NVARCHAR(100),
@SourceEntityID_0a0c15f9 UNIQUEIDENTIFIER,
@SourceFieldName_0a0c15f9 NVARCHAR(255),
@IsComputed_0a0c15f9 BIT,
@ComputationDescription_0a0c15f9 NVARCHAR(MAX),
@IsSummary_0a0c15f9 BIT,
@SummaryDescription_0a0c15f9 NVARCHAR(MAX),
@DetectionMethod_0a0c15f9 NVARCHAR(50),
@AutoDetectConfidenceScore_0a0c15f9 DECIMAL(3, 2),
@ID_0a0c15f9 UNIQUEIDENTIFIER
SET
  @QueryID_0a0c15f9 = '574FD9D5-AB9E-4FA5-A36C-C25E7D3F63FC'
SET
  @Name_0a0c15f9 = N'UserID'
SET
  @Description_0a0c15f9 = N'Identifier of the user who owns the conversation'
SET
  @Sequence_0a0c15f9 = 2
SET
  @SQLBaseType_0a0c15f9 = N'nvarchar'
SET
  @SQLFullType_0a0c15f9 = N'nvarchar(MAX)'
SET
  @SourceEntityID_0a0c15f9 = '13248F34-2837-EF11-86D4-6045BDEE16E6'
SET
  @SourceFieldName_0a0c15f9 = N'UserID'
SET
  @IsComputed_0a0c15f9 = 0
SET
  @IsSummary_0a0c15f9 = 0
SET
  @DetectionMethod_0a0c15f9 = N'Manual'
SET
  @ID_0a0c15f9 = 'FC47BF02-BE51-4C7C-9132-1C20ADC4FEBD'
EXEC [${flyway:defaultSchema}].spUpdateQueryField @QueryID = @QueryID_0a0c15f9,
  @Name = @Name_0a0c15f9,
  @Description = @Description_0a0c15f9,
  @Sequence = @Sequence_0a0c15f9,
  @SQLBaseType = @SQLBaseType_0a0c15f9,
  @SQLFullType = @SQLFullType_0a0c15f9,
  @SourceEntityID = @SourceEntityID_0a0c15f9,
  @SourceFieldName = @SourceFieldName_0a0c15f9,
  @IsComputed = @IsComputed_0a0c15f9,
  @ComputationDescription = @ComputationDescription_0a0c15f9,
  @IsSummary = @IsSummary_0a0c15f9,
  @SummaryDescription = @SummaryDescription_0a0c15f9,
  @DetectionMethod = @DetectionMethod_0a0c15f9,
  @AutoDetectConfidenceScore = @AutoDetectConfidenceScore_0a0c15f9,
  @ID = @ID_0a0c15f9;

-- Save MJ: Query Fields (core SP call only)
DECLARE @QueryID_abc8123b UNIQUEIDENTIFIER,
@Name_abc8123b NVARCHAR(255),
@Description_abc8123b NVARCHAR(MAX),
@Sequence_abc8123b INT,
@SQLBaseType_abc8123b NVARCHAR(50),
@SQLFullType_abc8123b NVARCHAR(100),
@SourceEntityID_abc8123b UNIQUEIDENTIFIER,
@SourceFieldName_abc8123b NVARCHAR(255),
@IsComputed_abc8123b BIT,
@ComputationDescription_abc8123b NVARCHAR(MAX),
@IsSummary_abc8123b BIT,
@SummaryDescription_abc8123b NVARCHAR(MAX),
@DetectionMethod_abc8123b NVARCHAR(50),
@AutoDetectConfidenceScore_abc8123b DECIMAL(3, 2),
@ID_abc8123b UNIQUEIDENTIFIER
SET
  @QueryID_abc8123b = '574FD9D5-AB9E-4FA5-A36C-C25E7D3F63FC'
SET
  @Name_abc8123b = N'MessagesJSON'
SET
  @Description_abc8123b = N'Conversation details as JSON array with ratings included'
SET
  @Sequence_abc8123b = 4
SET
  @SQLBaseType_abc8123b = N'nvarchar'
SET
  @SQLFullType_abc8123b = N'nvarchar(MAX)'
SET
  @IsComputed_abc8123b = 1
SET
  @ComputationDescription_abc8123b = N'JSON aggregation of conversation details with ratings from joined tables'
SET
  @IsSummary_abc8123b = 0
SET
  @DetectionMethod_abc8123b = N'Manual'
SET
  @ID_abc8123b = 'CB76A976-AE46-454B-B837-90A78B74ED50'
EXEC [${flyway:defaultSchema}].spUpdateQueryField @QueryID = @QueryID_abc8123b,
  @Name = @Name_abc8123b,
  @Description = @Description_abc8123b,
  @Sequence = @Sequence_abc8123b,
  @SQLBaseType = @SQLBaseType_abc8123b,
  @SQLFullType = @SQLFullType_abc8123b,
  @SourceEntityID = @SourceEntityID_abc8123b,
  @SourceFieldName = @SourceFieldName_abc8123b,
  @IsComputed = @IsComputed_abc8123b,
  @ComputationDescription = @ComputationDescription_abc8123b,
  @IsSummary = @IsSummary_abc8123b,
  @SummaryDescription = @SummaryDescription_abc8123b,
  @DetectionMethod = @DetectionMethod_abc8123b,
  @AutoDetectConfidenceScore = @AutoDetectConfidenceScore_abc8123b,
  @ID = @ID_abc8123b;

-- Save MJ: Query Fields (core SP call only)
DECLARE @QueryID_149e31f6 UNIQUEIDENTIFIER,
@Name_149e31f6 NVARCHAR(255),
@Description_149e31f6 NVARCHAR(MAX),
@Sequence_149e31f6 INT,
@SQLBaseType_149e31f6 NVARCHAR(50),
@SQLFullType_149e31f6 NVARCHAR(100),
@SourceEntityID_149e31f6 UNIQUEIDENTIFIER,
@SourceFieldName_149e31f6 NVARCHAR(255),
@IsComputed_149e31f6 BIT,
@ComputationDescription_149e31f6 NVARCHAR(MAX),
@IsSummary_149e31f6 BIT,
@SummaryDescription_149e31f6 NVARCHAR(MAX),
@DetectionMethod_149e31f6 NVARCHAR(50),
@AutoDetectConfidenceScore_149e31f6 DECIMAL(3, 2),
@ID_149e31f6 UNIQUEIDENTIFIER
SET
  @QueryID_149e31f6 = '574FD9D5-AB9E-4FA5-A36C-C25E7D3F63FC'
SET
  @Name_149e31f6 = N'AgentRunID'
SET
  @Description_149e31f6 = N'Most recent agent run ID for this conversation'
SET
  @Sequence_149e31f6 = 3
SET
  @SQLBaseType_149e31f6 = N'nvarchar'
SET
  @SQLFullType_149e31f6 = N'nvarchar(MAX)'
SET
  @IsComputed_149e31f6 = 1
SET
  @ComputationDescription_149e31f6 = N'Scalar subquery selecting top agent run ID for the conversation'
SET
  @IsSummary_149e31f6 = 0
SET
  @DetectionMethod_149e31f6 = N'Manual'
SET
  @ID_149e31f6 = '4CAB47E1-C542-4CDD-9BEF-90BFC2786FF0'
EXEC [${flyway:defaultSchema}].spUpdateQueryField @QueryID = @QueryID_149e31f6,
  @Name = @Name_149e31f6,
  @Description = @Description_149e31f6,
  @Sequence = @Sequence_149e31f6,
  @SQLBaseType = @SQLBaseType_149e31f6,
  @SQLFullType = @SQLFullType_149e31f6,
  @SourceEntityID = @SourceEntityID_149e31f6,
  @SourceFieldName = @SourceFieldName_149e31f6,
  @IsComputed = @IsComputed_149e31f6,
  @ComputationDescription = @ComputationDescription_149e31f6,
  @IsSummary = @IsSummary_149e31f6,
  @SummaryDescription = @SummaryDescription_149e31f6,
  @DetectionMethod = @DetectionMethod_149e31f6,
  @AutoDetectConfidenceScore = @AutoDetectConfidenceScore_149e31f6,
  @ID = @ID_149e31f6;

-- Save MJ: Query Fields (core SP call only)
DECLARE @QueryID_e79a0873 UNIQUEIDENTIFIER,
@Name_e79a0873 NVARCHAR(255),
@Description_e79a0873 NVARCHAR(MAX),
@Sequence_e79a0873 INT,
@SQLBaseType_e79a0873 NVARCHAR(50),
@SQLFullType_e79a0873 NVARCHAR(100),
@SourceEntityID_e79a0873 UNIQUEIDENTIFIER,
@SourceFieldName_e79a0873 NVARCHAR(255),
@IsComputed_e79a0873 BIT,
@ComputationDescription_e79a0873 NVARCHAR(MAX),
@IsSummary_e79a0873 BIT,
@SummaryDescription_e79a0873 NVARCHAR(MAX),
@DetectionMethod_e79a0873 NVARCHAR(50),
@AutoDetectConfidenceScore_e79a0873 DECIMAL(3, 2),
@ID_e79a0873 UNIQUEIDENTIFIER
SET
  @QueryID_e79a0873 = '574FD9D5-AB9E-4FA5-A36C-C25E7D3F63FC'
SET
  @Name_e79a0873 = N'HasNegativeRating'
SET
  @Description_e79a0873 = N'Flag indicating if conversation has any ratings of 3 or lower'
SET
  @Sequence_e79a0873 = 6
SET
  @SQLBaseType_e79a0873 = N'bit'
SET
  @SQLFullType_e79a0873 = N'bit'
SET
  @IsComputed_e79a0873 = 1
SET
  @ComputationDescription_e79a0873 = N'CASE expression checking for existence of negative ratings (<= 3)'
SET
  @IsSummary_e79a0873 = 0
SET
  @DetectionMethod_e79a0873 = N'Manual'
SET
  @ID_e79a0873 = '5A464544-F105-4F17-94F8-A0423F150812'
EXEC [${flyway:defaultSchema}].spUpdateQueryField @QueryID = @QueryID_e79a0873,
  @Name = @Name_e79a0873,
  @Description = @Description_e79a0873,
  @Sequence = @Sequence_e79a0873,
  @SQLBaseType = @SQLBaseType_e79a0873,
  @SQLFullType = @SQLFullType_e79a0873,
  @SourceEntityID = @SourceEntityID_e79a0873,
  @SourceFieldName = @SourceFieldName_e79a0873,
  @IsComputed = @IsComputed_e79a0873,
  @ComputationDescription = @ComputationDescription_e79a0873,
  @IsSummary = @IsSummary_e79a0873,
  @SummaryDescription = @SummaryDescription_e79a0873,
  @DetectionMethod = @DetectionMethod_e79a0873,
  @AutoDetectConfidenceScore = @AutoDetectConfidenceScore_e79a0873,
  @ID = @ID_e79a0873;

-- Save MJ: Query Fields (core SP call only)
DECLARE @QueryID_995405b9 UNIQUEIDENTIFIER,
@Name_995405b9 NVARCHAR(255),
@Description_995405b9 NVARCHAR(MAX),
@Sequence_995405b9 INT,
@SQLBaseType_995405b9 NVARCHAR(50),
@SQLFullType_995405b9 NVARCHAR(100),
@SourceEntityID_995405b9 UNIQUEIDENTIFIER,
@SourceFieldName_995405b9 NVARCHAR(255),
@IsComputed_995405b9 BIT,
@ComputationDescription_995405b9 NVARCHAR(MAX),
@IsSummary_995405b9 BIT,
@SummaryDescription_995405b9 NVARCHAR(MAX),
@DetectionMethod_995405b9 NVARCHAR(50),
@AutoDetectConfidenceScore_995405b9 DECIMAL(3, 2),
@ID_995405b9 UNIQUEIDENTIFIER
SET
  @QueryID_995405b9 = '574FD9D5-AB9E-4FA5-A36C-C25E7D3F63FC'
SET
  @Name_995405b9 = N'IsUnrated'
SET
  @Description_995405b9 = N'Flag indicating if conversation has no ratings'
SET
  @Sequence_995405b9 = 7
SET
  @SQLBaseType_995405b9 = N'bit'
SET
  @SQLFullType_995405b9 = N'bit'
SET
  @IsComputed_995405b9 = 1
SET
  @ComputationDescription_995405b9 = N'CASE expression checking if no rating records exist'
SET
  @IsSummary_995405b9 = 0
SET
  @DetectionMethod_995405b9 = N'Manual'
SET
  @ID_995405b9 = 'F11B7F22-EF85-418E-855A-AC0EDBEE014A'
EXEC [${flyway:defaultSchema}].spUpdateQueryField @QueryID = @QueryID_995405b9,
  @Name = @Name_995405b9,
  @Description = @Description_995405b9,
  @Sequence = @Sequence_995405b9,
  @SQLBaseType = @SQLBaseType_995405b9,
  @SQLFullType = @SQLFullType_995405b9,
  @SourceEntityID = @SourceEntityID_995405b9,
  @SourceFieldName = @SourceFieldName_995405b9,
  @IsComputed = @IsComputed_995405b9,
  @ComputationDescription = @ComputationDescription_995405b9,
  @IsSummary = @IsSummary_995405b9,
  @SummaryDescription = @SummaryDescription_995405b9,
  @DetectionMethod = @DetectionMethod_995405b9,
  @AutoDetectConfidenceScore = @AutoDetectConfidenceScore_995405b9,
  @ID = @ID_995405b9;

-- Save MJ: Queries (core SP call only)
DECLARE @Name_11b91d09 NVARCHAR(255),
@CategoryID_11b91d09 UNIQUEIDENTIFIER,
@UserQuestion_11b91d09 NVARCHAR(MAX),
@Description_11b91d09 NVARCHAR(MAX),
@SQL_11b91d09 NVARCHAR(MAX),
@TechnicalDescription_11b91d09 NVARCHAR(MAX),
@OriginalSQL_11b91d09 NVARCHAR(MAX),
@Feedback_11b91d09 NVARCHAR(MAX),
@Status_11b91d09 NVARCHAR(15),
@QualityRank_11b91d09 INT,
@ExecutionCostRank_11b91d09 INT,
@UsesTemplate_11b91d09 BIT,
@AuditQueryRuns_11b91d09 BIT,
@CacheEnabled_11b91d09 BIT,
@CacheTTLMinutes_11b91d09 INT,
@CacheMaxSize_11b91d09 INT,
@EmbeddingVector_11b91d09 NVARCHAR(MAX),
@EmbeddingModelID_11b91d09 UNIQUEIDENTIFIER,
@CacheValidationSQL_11b91d09 NVARCHAR(MAX),
@ID_11b91d09 UNIQUEIDENTIFIER
SET
  @Name_11b91d09 = N'Server Installed Version History'
SET
  @CategoryID_11b91d09 = '17AFCCEC-6A37-EF11-86D4-000D3A4E707E'
SET
  @UserQuestion_11b91d09 = N'Show me a list of versions installed on the server in order of most recent version first'
SET
  @SQL_11b91d09 = N'SELECT * FROM [${flyway:defaultSchema}].flyway_schema_history ORDER BY installed_on DESC'
SET
  @Status_11b91d09 = N'Approved'
SET
  @QualityRank_11b91d09 = 9
SET
  @ExecutionCostRank_11b91d09 = 3
SET
  @UsesTemplate_11b91d09 = 1
SET
  @AuditQueryRuns_11b91d09 = 0
SET
  @CacheEnabled_11b91d09 = 0
SET
  @ID_11b91d09 = '23F8423E-F36B-1410-8D9C-00021F8B792E'
EXEC [${flyway:defaultSchema}].spUpdateQuery @Name = @Name_11b91d09,
  @CategoryID = @CategoryID_11b91d09,
  @UserQuestion = @UserQuestion_11b91d09,
  @Description = @Description_11b91d09,
  @SQL = @SQL_11b91d09,
  @TechnicalDescription = @TechnicalDescription_11b91d09,
  @OriginalSQL = @OriginalSQL_11b91d09,
  @Feedback = @Feedback_11b91d09,
  @Status = @Status_11b91d09,
  @QualityRank = @QualityRank_11b91d09,
  @ExecutionCostRank = @ExecutionCostRank_11b91d09,
  @UsesTemplate = @UsesTemplate_11b91d09,
  @AuditQueryRuns = @AuditQueryRuns_11b91d09,
  @CacheEnabled = @CacheEnabled_11b91d09,
  @CacheTTLMinutes = @CacheTTLMinutes_11b91d09,
  @CacheMaxSize = @CacheMaxSize_11b91d09,
  @EmbeddingVector = @EmbeddingVector_11b91d09,
  @EmbeddingModelID = @EmbeddingModelID_11b91d09,
  @CacheValidationSQL = @CacheValidationSQL_11b91d09,
  @ID = @ID_11b91d09;

-- Save MJ: Query Fields (core SP call only)
DECLARE @QueryID_3a338d7f UNIQUEIDENTIFIER,
@Name_3a338d7f NVARCHAR(255),
@Description_3a338d7f NVARCHAR(MAX),
@Sequence_3a338d7f INT,
@SQLBaseType_3a338d7f NVARCHAR(50),
@SQLFullType_3a338d7f NVARCHAR(100),
@SourceEntityID_3a338d7f UNIQUEIDENTIFIER,
@SourceFieldName_3a338d7f NVARCHAR(255),
@IsComputed_3a338d7f BIT,
@ComputationDescription_3a338d7f NVARCHAR(MAX),
@IsSummary_3a338d7f BIT,
@SummaryDescription_3a338d7f NVARCHAR(MAX),
@DetectionMethod_3a338d7f NVARCHAR(50),
@AutoDetectConfidenceScore_3a338d7f DECIMAL(3, 2),
@ID_3a338d7f UNIQUEIDENTIFIER
SET
  @QueryID_3a338d7f = '23F8423E-F36B-1410-8D9C-00021F8B792E'
SET
  @Name_3a338d7f = N'success'
SET
  @Description_3a338d7f = N'Boolean indicating if the migration was successful'
SET
  @Sequence_3a338d7f = 10
SET
  @SQLBaseType_3a338d7f = N'bit'
SET
  @SQLFullType_3a338d7f = N'bit'
SET
  @SourceFieldName_3a338d7f = N'success'
SET
  @IsComputed_3a338d7f = 0
SET
  @IsSummary_3a338d7f = 0
SET
  @DetectionMethod_3a338d7f = N'Manual'
SET
  @ID_3a338d7f = '61B03A6B-E72A-413F-8145-22AB9D843911'
EXEC [${flyway:defaultSchema}].spUpdateQueryField @QueryID = @QueryID_3a338d7f,
  @Name = @Name_3a338d7f,
  @Description = @Description_3a338d7f,
  @Sequence = @Sequence_3a338d7f,
  @SQLBaseType = @SQLBaseType_3a338d7f,
  @SQLFullType = @SQLFullType_3a338d7f,
  @SourceEntityID = @SourceEntityID_3a338d7f,
  @SourceFieldName = @SourceFieldName_3a338d7f,
  @IsComputed = @IsComputed_3a338d7f,
  @ComputationDescription = @ComputationDescription_3a338d7f,
  @IsSummary = @IsSummary_3a338d7f,
  @SummaryDescription = @SummaryDescription_3a338d7f,
  @DetectionMethod = @DetectionMethod_3a338d7f,
  @AutoDetectConfidenceScore = @AutoDetectConfidenceScore_3a338d7f,
  @ID = @ID_3a338d7f;

-- Save MJ: Query Fields (core SP call only)
DECLARE @QueryID_07edbe88 UNIQUEIDENTIFIER,
@Name_07edbe88 NVARCHAR(255),
@Description_07edbe88 NVARCHAR(MAX),
@Sequence_07edbe88 INT,
@SQLBaseType_07edbe88 NVARCHAR(50),
@SQLFullType_07edbe88 NVARCHAR(100),
@SourceEntityID_07edbe88 UNIQUEIDENTIFIER,
@SourceFieldName_07edbe88 NVARCHAR(255),
@IsComputed_07edbe88 BIT,
@ComputationDescription_07edbe88 NVARCHAR(MAX),
@IsSummary_07edbe88 BIT,
@SummaryDescription_07edbe88 NVARCHAR(MAX),
@DetectionMethod_07edbe88 NVARCHAR(50),
@AutoDetectConfidenceScore_07edbe88 DECIMAL(3, 2),
@ID_07edbe88 UNIQUEIDENTIFIER
SET
  @QueryID_07edbe88 = '23F8423E-F36B-1410-8D9C-00021F8B792E'
SET
  @Name_07edbe88 = N'installed_by'
SET
  @Description_07edbe88 = N'User who installed the migration'
SET
  @Sequence_07edbe88 = 7
SET
  @SQLBaseType_07edbe88 = N'nvarchar'
SET
  @SQLFullType_07edbe88 = N'nvarchar(MAX)'
SET
  @SourceFieldName_07edbe88 = N'installed_by'
SET
  @IsComputed_07edbe88 = 0
SET
  @IsSummary_07edbe88 = 0
SET
  @DetectionMethod_07edbe88 = N'Manual'
SET
  @ID_07edbe88 = 'E995B5FA-994B-4E21-9434-37140606FD19'
EXEC [${flyway:defaultSchema}].spUpdateQueryField @QueryID = @QueryID_07edbe88,
  @Name = @Name_07edbe88,
  @Description = @Description_07edbe88,
  @Sequence = @Sequence_07edbe88,
  @SQLBaseType = @SQLBaseType_07edbe88,
  @SQLFullType = @SQLFullType_07edbe88,
  @SourceEntityID = @SourceEntityID_07edbe88,
  @SourceFieldName = @SourceFieldName_07edbe88,
  @IsComputed = @IsComputed_07edbe88,
  @ComputationDescription = @ComputationDescription_07edbe88,
  @IsSummary = @IsSummary_07edbe88,
  @SummaryDescription = @SummaryDescription_07edbe88,
  @DetectionMethod = @DetectionMethod_07edbe88,
  @AutoDetectConfidenceScore = @AutoDetectConfidenceScore_07edbe88,
  @ID = @ID_07edbe88;

-- Save MJ: Query Fields (core SP call only)
DECLARE @QueryID_b6d9f682 UNIQUEIDENTIFIER,
@Name_b6d9f682 NVARCHAR(255),
@Description_b6d9f682 NVARCHAR(MAX),
@Sequence_b6d9f682 INT,
@SQLBaseType_b6d9f682 NVARCHAR(50),
@SQLFullType_b6d9f682 NVARCHAR(100),
@SourceEntityID_b6d9f682 UNIQUEIDENTIFIER,
@SourceFieldName_b6d9f682 NVARCHAR(255),
@IsComputed_b6d9f682 BIT,
@ComputationDescription_b6d9f682 NVARCHAR(MAX),
@IsSummary_b6d9f682 BIT,
@SummaryDescription_b6d9f682 NVARCHAR(MAX),
@DetectionMethod_b6d9f682 NVARCHAR(50),
@AutoDetectConfidenceScore_b6d9f682 DECIMAL(3, 2),
@ID_b6d9f682 UNIQUEIDENTIFIER
SET
  @QueryID_b6d9f682 = '23F8423E-F36B-1410-8D9C-00021F8B792E'
SET
  @Name_b6d9f682 = N'script'
SET
  @Description_b6d9f682 = N'Script filename for the migration'
SET
  @Sequence_b6d9f682 = 5
SET
  @SQLBaseType_b6d9f682 = N'nvarchar'
SET
  @SQLFullType_b6d9f682 = N'nvarchar(MAX)'
SET
  @SourceFieldName_b6d9f682 = N'script'
SET
  @IsComputed_b6d9f682 = 0
SET
  @IsSummary_b6d9f682 = 0
SET
  @DetectionMethod_b6d9f682 = N'Manual'
SET
  @ID_b6d9f682 = '54F49295-7671-4A18-82DB-386757F3E941'
EXEC [${flyway:defaultSchema}].spUpdateQueryField @QueryID = @QueryID_b6d9f682,
  @Name = @Name_b6d9f682,
  @Description = @Description_b6d9f682,
  @Sequence = @Sequence_b6d9f682,
  @SQLBaseType = @SQLBaseType_b6d9f682,
  @SQLFullType = @SQLFullType_b6d9f682,
  @SourceEntityID = @SourceEntityID_b6d9f682,
  @SourceFieldName = @SourceFieldName_b6d9f682,
  @IsComputed = @IsComputed_b6d9f682,
  @ComputationDescription = @ComputationDescription_b6d9f682,
  @IsSummary = @IsSummary_b6d9f682,
  @SummaryDescription = @SummaryDescription_b6d9f682,
  @DetectionMethod = @DetectionMethod_b6d9f682,
  @AutoDetectConfidenceScore = @AutoDetectConfidenceScore_b6d9f682,
  @ID = @ID_b6d9f682;

-- Save MJ: Query Fields (core SP call only)
DECLARE @QueryID_5c239d72 UNIQUEIDENTIFIER,
@Name_5c239d72 NVARCHAR(255),
@Description_5c239d72 NVARCHAR(MAX),
@Sequence_5c239d72 INT,
@SQLBaseType_5c239d72 NVARCHAR(50),
@SQLFullType_5c239d72 NVARCHAR(100),
@SourceEntityID_5c239d72 UNIQUEIDENTIFIER,
@SourceFieldName_5c239d72 NVARCHAR(255),
@IsComputed_5c239d72 BIT,
@ComputationDescription_5c239d72 NVARCHAR(MAX),
@IsSummary_5c239d72 BIT,
@SummaryDescription_5c239d72 NVARCHAR(MAX),
@DetectionMethod_5c239d72 NVARCHAR(50),
@AutoDetectConfidenceScore_5c239d72 DECIMAL(3, 2),
@ID_5c239d72 UNIQUEIDENTIFIER
SET
  @QueryID_5c239d72 = '23F8423E-F36B-1410-8D9C-00021F8B792E'
SET
  @Name_5c239d72 = N'description'
SET
  @Description_5c239d72 = N'Description of the schema migration'
SET
  @Sequence_5c239d72 = 3
SET
  @SQLBaseType_5c239d72 = N'nvarchar'
SET
  @SQLFullType_5c239d72 = N'nvarchar(MAX)'
SET
  @SourceFieldName_5c239d72 = N'description'
SET
  @IsComputed_5c239d72 = 0
SET
  @IsSummary_5c239d72 = 0
SET
  @DetectionMethod_5c239d72 = N'Manual'
SET
  @ID_5c239d72 = '6D2695F4-80A6-4D52-B9E6-495E2DC0F63B'
EXEC [${flyway:defaultSchema}].spUpdateQueryField @QueryID = @QueryID_5c239d72,
  @Name = @Name_5c239d72,
  @Description = @Description_5c239d72,
  @Sequence = @Sequence_5c239d72,
  @SQLBaseType = @SQLBaseType_5c239d72,
  @SQLFullType = @SQLFullType_5c239d72,
  @SourceEntityID = @SourceEntityID_5c239d72,
  @SourceFieldName = @SourceFieldName_5c239d72,
  @IsComputed = @IsComputed_5c239d72,
  @ComputationDescription = @ComputationDescription_5c239d72,
  @IsSummary = @IsSummary_5c239d72,
  @SummaryDescription = @SummaryDescription_5c239d72,
  @DetectionMethod = @DetectionMethod_5c239d72,
  @AutoDetectConfidenceScore = @AutoDetectConfidenceScore_5c239d72,
  @ID = @ID_5c239d72;

-- Save MJ: Query Fields (core SP call only)
DECLARE @QueryID_8f8bab48 UNIQUEIDENTIFIER,
@Name_8f8bab48 NVARCHAR(255),
@Description_8f8bab48 NVARCHAR(MAX),
@Sequence_8f8bab48 INT,
@SQLBaseType_8f8bab48 NVARCHAR(50),
@SQLFullType_8f8bab48 NVARCHAR(100),
@SourceEntityID_8f8bab48 UNIQUEIDENTIFIER,
@SourceFieldName_8f8bab48 NVARCHAR(255),
@IsComputed_8f8bab48 BIT,
@ComputationDescription_8f8bab48 NVARCHAR(MAX),
@IsSummary_8f8bab48 BIT,
@SummaryDescription_8f8bab48 NVARCHAR(MAX),
@DetectionMethod_8f8bab48 NVARCHAR(50),
@AutoDetectConfidenceScore_8f8bab48 DECIMAL(3, 2),
@ID_8f8bab48 UNIQUEIDENTIFIER
SET
  @QueryID_8f8bab48 = '23F8423E-F36B-1410-8D9C-00021F8B792E'
SET
  @Name_8f8bab48 = N'installed_on'
SET
  @Description_8f8bab48 = N'Timestamp when the migration was installed'
SET
  @Sequence_8f8bab48 = 8
SET
  @SQLBaseType_8f8bab48 = N'datetime'
SET
  @SQLFullType_8f8bab48 = N'datetime'
SET
  @SourceFieldName_8f8bab48 = N'installed_on'
SET
  @IsComputed_8f8bab48 = 0
SET
  @IsSummary_8f8bab48 = 0
SET
  @DetectionMethod_8f8bab48 = N'Manual'
SET
  @ID_8f8bab48 = '25FFF33E-F6B3-4BFF-AD33-630EB7CA4818'
EXEC [${flyway:defaultSchema}].spUpdateQueryField @QueryID = @QueryID_8f8bab48,
  @Name = @Name_8f8bab48,
  @Description = @Description_8f8bab48,
  @Sequence = @Sequence_8f8bab48,
  @SQLBaseType = @SQLBaseType_8f8bab48,
  @SQLFullType = @SQLFullType_8f8bab48,
  @SourceEntityID = @SourceEntityID_8f8bab48,
  @SourceFieldName = @SourceFieldName_8f8bab48,
  @IsComputed = @IsComputed_8f8bab48,
  @ComputationDescription = @ComputationDescription_8f8bab48,
  @IsSummary = @IsSummary_8f8bab48,
  @SummaryDescription = @SummaryDescription_8f8bab48,
  @DetectionMethod = @DetectionMethod_8f8bab48,
  @AutoDetectConfidenceScore = @AutoDetectConfidenceScore_8f8bab48,
  @ID = @ID_8f8bab48;

-- Save MJ: Query Fields (core SP call only)
DECLARE @QueryID_06129ffc UNIQUEIDENTIFIER,
@Name_06129ffc NVARCHAR(255),
@Description_06129ffc NVARCHAR(MAX),
@Sequence_06129ffc INT,
@SQLBaseType_06129ffc NVARCHAR(50),
@SQLFullType_06129ffc NVARCHAR(100),
@SourceEntityID_06129ffc UNIQUEIDENTIFIER,
@SourceFieldName_06129ffc NVARCHAR(255),
@IsComputed_06129ffc BIT,
@ComputationDescription_06129ffc NVARCHAR(MAX),
@IsSummary_06129ffc BIT,
@SummaryDescription_06129ffc NVARCHAR(MAX),
@DetectionMethod_06129ffc NVARCHAR(50),
@AutoDetectConfidenceScore_06129ffc DECIMAL(3, 2),
@ID_06129ffc UNIQUEIDENTIFIER
SET
  @QueryID_06129ffc = '23F8423E-F36B-1410-8D9C-00021F8B792E'
SET
  @Name_06129ffc = N'execution_time'
SET
  @Description_06129ffc = N'Execution time of the migration in milliseconds'
SET
  @Sequence_06129ffc = 9
SET
  @SQLBaseType_06129ffc = N'decimal'
SET
  @SQLFullType_06129ffc = N'decimal(18,2)'
SET
  @SourceFieldName_06129ffc = N'execution_time'
SET
  @IsComputed_06129ffc = 0
SET
  @IsSummary_06129ffc = 0
SET
  @DetectionMethod_06129ffc = N'Manual'
SET
  @ID_06129ffc = '40D852DE-7370-4F9F-AB12-83ABCA2D08FB'
EXEC [${flyway:defaultSchema}].spUpdateQueryField @QueryID = @QueryID_06129ffc,
  @Name = @Name_06129ffc,
  @Description = @Description_06129ffc,
  @Sequence = @Sequence_06129ffc,
  @SQLBaseType = @SQLBaseType_06129ffc,
  @SQLFullType = @SQLFullType_06129ffc,
  @SourceEntityID = @SourceEntityID_06129ffc,
  @SourceFieldName = @SourceFieldName_06129ffc,
  @IsComputed = @IsComputed_06129ffc,
  @ComputationDescription = @ComputationDescription_06129ffc,
  @IsSummary = @IsSummary_06129ffc,
  @SummaryDescription = @SummaryDescription_06129ffc,
  @DetectionMethod = @DetectionMethod_06129ffc,
  @AutoDetectConfidenceScore = @AutoDetectConfidenceScore_06129ffc,
  @ID = @ID_06129ffc;

-- Save MJ: Query Fields (core SP call only)
DECLARE @QueryID_aa801dae UNIQUEIDENTIFIER,
@Name_aa801dae NVARCHAR(255),
@Description_aa801dae NVARCHAR(MAX),
@Sequence_aa801dae INT,
@SQLBaseType_aa801dae NVARCHAR(50),
@SQLFullType_aa801dae NVARCHAR(100),
@SourceEntityID_aa801dae UNIQUEIDENTIFIER,
@SourceFieldName_aa801dae NVARCHAR(255),
@IsComputed_aa801dae BIT,
@ComputationDescription_aa801dae NVARCHAR(MAX),
@IsSummary_aa801dae BIT,
@SummaryDescription_aa801dae NVARCHAR(MAX),
@DetectionMethod_aa801dae NVARCHAR(50),
@AutoDetectConfidenceScore_aa801dae DECIMAL(3, 2),
@ID_aa801dae UNIQUEIDENTIFIER
SET
  @QueryID_aa801dae = '23F8423E-F36B-1410-8D9C-00021F8B792E'
SET
  @Name_aa801dae = N'checksum'
SET
  @Description_aa801dae = N'Checksum of the migration script'
SET
  @Sequence_aa801dae = 6
SET
  @SQLBaseType_aa801dae = N'decimal'
SET
  @SQLFullType_aa801dae = N'decimal(18,2)'
SET
  @SourceFieldName_aa801dae = N'checksum'
SET
  @IsComputed_aa801dae = 0
SET
  @IsSummary_aa801dae = 0
SET
  @DetectionMethod_aa801dae = N'Manual'
SET
  @ID_aa801dae = 'FB54C641-D2EC-4B1C-8C46-8C10683F5581'
EXEC [${flyway:defaultSchema}].spUpdateQueryField @QueryID = @QueryID_aa801dae,
  @Name = @Name_aa801dae,
  @Description = @Description_aa801dae,
  @Sequence = @Sequence_aa801dae,
  @SQLBaseType = @SQLBaseType_aa801dae,
  @SQLFullType = @SQLFullType_aa801dae,
  @SourceEntityID = @SourceEntityID_aa801dae,
  @SourceFieldName = @SourceFieldName_aa801dae,
  @IsComputed = @IsComputed_aa801dae,
  @ComputationDescription = @ComputationDescription_aa801dae,
  @IsSummary = @IsSummary_aa801dae,
  @SummaryDescription = @SummaryDescription_aa801dae,
  @DetectionMethod = @DetectionMethod_aa801dae,
  @AutoDetectConfidenceScore = @AutoDetectConfidenceScore_aa801dae,
  @ID = @ID_aa801dae;

-- Save MJ: Query Fields (core SP call only)
DECLARE @QueryID_197d5146 UNIQUEIDENTIFIER,
@Name_197d5146 NVARCHAR(255),
@Description_197d5146 NVARCHAR(MAX),
@Sequence_197d5146 INT,
@SQLBaseType_197d5146 NVARCHAR(50),
@SQLFullType_197d5146 NVARCHAR(100),
@SourceEntityID_197d5146 UNIQUEIDENTIFIER,
@SourceFieldName_197d5146 NVARCHAR(255),
@IsComputed_197d5146 BIT,
@ComputationDescription_197d5146 NVARCHAR(MAX),
@IsSummary_197d5146 BIT,
@SummaryDescription_197d5146 NVARCHAR(MAX),
@DetectionMethod_197d5146 NVARCHAR(50),
@AutoDetectConfidenceScore_197d5146 DECIMAL(3, 2),
@ID_197d5146 UNIQUEIDENTIFIER
SET
  @QueryID_197d5146 = '23F8423E-F36B-1410-8D9C-00021F8B792E'
SET
  @Name_197d5146 = N'version'
SET
  @Description_197d5146 = N'Version of the schema migration'
SET
  @Sequence_197d5146 = 2
SET
  @SQLBaseType_197d5146 = N'nvarchar'
SET
  @SQLFullType_197d5146 = N'nvarchar(MAX)'
SET
  @SourceFieldName_197d5146 = N'version'
SET
  @IsComputed_197d5146 = 0
SET
  @IsSummary_197d5146 = 0
SET
  @DetectionMethod_197d5146 = N'Manual'
SET
  @ID_197d5146 = '010A01A1-1A9E-49AE-A9B2-954AC057BB73'
EXEC [${flyway:defaultSchema}].spUpdateQueryField @QueryID = @QueryID_197d5146,
  @Name = @Name_197d5146,
  @Description = @Description_197d5146,
  @Sequence = @Sequence_197d5146,
  @SQLBaseType = @SQLBaseType_197d5146,
  @SQLFullType = @SQLFullType_197d5146,
  @SourceEntityID = @SourceEntityID_197d5146,
  @SourceFieldName = @SourceFieldName_197d5146,
  @IsComputed = @IsComputed_197d5146,
  @ComputationDescription = @ComputationDescription_197d5146,
  @IsSummary = @IsSummary_197d5146,
  @SummaryDescription = @SummaryDescription_197d5146,
  @DetectionMethod = @DetectionMethod_197d5146,
  @AutoDetectConfidenceScore = @AutoDetectConfidenceScore_197d5146,
  @ID = @ID_197d5146;

-- Save MJ: Query Fields (core SP call only)
DECLARE @QueryID_6c8d7ef0 UNIQUEIDENTIFIER,
@Name_6c8d7ef0 NVARCHAR(255),
@Description_6c8d7ef0 NVARCHAR(MAX),
@Sequence_6c8d7ef0 INT,
@SQLBaseType_6c8d7ef0 NVARCHAR(50),
@SQLFullType_6c8d7ef0 NVARCHAR(100),
@SourceEntityID_6c8d7ef0 UNIQUEIDENTIFIER,
@SourceFieldName_6c8d7ef0 NVARCHAR(255),
@IsComputed_6c8d7ef0 BIT,
@ComputationDescription_6c8d7ef0 NVARCHAR(MAX),
@IsSummary_6c8d7ef0 BIT,
@SummaryDescription_6c8d7ef0 NVARCHAR(MAX),
@DetectionMethod_6c8d7ef0 NVARCHAR(50),
@AutoDetectConfidenceScore_6c8d7ef0 DECIMAL(3, 2),
@ID_6c8d7ef0 UNIQUEIDENTIFIER
SET
  @QueryID_6c8d7ef0 = '23F8423E-F36B-1410-8D9C-00021F8B792E'
SET
  @Name_6c8d7ef0 = N'installed_rank'
SET
  @Description_6c8d7ef0 = N'Installation rank/order of the schema migration'
SET
  @Sequence_6c8d7ef0 = 1
SET
  @SQLBaseType_6c8d7ef0 = N'decimal'
SET
  @SQLFullType_6c8d7ef0 = N'decimal(18,2)'
SET
  @SourceFieldName_6c8d7ef0 = N'installed_rank'
SET
  @IsComputed_6c8d7ef0 = 0
SET
  @IsSummary_6c8d7ef0 = 0
SET
  @DetectionMethod_6c8d7ef0 = N'Manual'
SET
  @ID_6c8d7ef0 = '31554B62-5505-4D79-ACBF-9CC922A7D2CC'
EXEC [${flyway:defaultSchema}].spUpdateQueryField @QueryID = @QueryID_6c8d7ef0,
  @Name = @Name_6c8d7ef0,
  @Description = @Description_6c8d7ef0,
  @Sequence = @Sequence_6c8d7ef0,
  @SQLBaseType = @SQLBaseType_6c8d7ef0,
  @SQLFullType = @SQLFullType_6c8d7ef0,
  @SourceEntityID = @SourceEntityID_6c8d7ef0,
  @SourceFieldName = @SourceFieldName_6c8d7ef0,
  @IsComputed = @IsComputed_6c8d7ef0,
  @ComputationDescription = @ComputationDescription_6c8d7ef0,
  @IsSummary = @IsSummary_6c8d7ef0,
  @SummaryDescription = @SummaryDescription_6c8d7ef0,
  @DetectionMethod = @DetectionMethod_6c8d7ef0,
  @AutoDetectConfidenceScore = @AutoDetectConfidenceScore_6c8d7ef0,
  @ID = @ID_6c8d7ef0;

-- Save MJ: Query Fields (core SP call only)
DECLARE @QueryID_568fb8ef UNIQUEIDENTIFIER,
@Name_568fb8ef NVARCHAR(255),
@Description_568fb8ef NVARCHAR(MAX),
@Sequence_568fb8ef INT,
@SQLBaseType_568fb8ef NVARCHAR(50),
@SQLFullType_568fb8ef NVARCHAR(100),
@SourceEntityID_568fb8ef UNIQUEIDENTIFIER,
@SourceFieldName_568fb8ef NVARCHAR(255),
@IsComputed_568fb8ef BIT,
@ComputationDescription_568fb8ef NVARCHAR(MAX),
@IsSummary_568fb8ef BIT,
@SummaryDescription_568fb8ef NVARCHAR(MAX),
@DetectionMethod_568fb8ef NVARCHAR(50),
@AutoDetectConfidenceScore_568fb8ef DECIMAL(3, 2),
@ID_568fb8ef UNIQUEIDENTIFIER
SET
  @QueryID_568fb8ef = '23F8423E-F36B-1410-8D9C-00021F8B792E'
SET
  @Name_568fb8ef = N'type'
SET
  @Description_568fb8ef = N'Type of migration (SQL, JDBC, etc.)'
SET
  @Sequence_568fb8ef = 4
SET
  @SQLBaseType_568fb8ef = N'nvarchar'
SET
  @SQLFullType_568fb8ef = N'nvarchar(MAX)'
SET
  @SourceFieldName_568fb8ef = N'type'
SET
  @IsComputed_568fb8ef = 0
SET
  @IsSummary_568fb8ef = 0
SET
  @DetectionMethod_568fb8ef = N'Manual'
SET
  @ID_568fb8ef = '8C57285F-F2F6-4171-8740-D9B7C5F42401'
EXEC [${flyway:defaultSchema}].spUpdateQueryField @QueryID = @QueryID_568fb8ef,
  @Name = @Name_568fb8ef,
  @Description = @Description_568fb8ef,
  @Sequence = @Sequence_568fb8ef,
  @SQLBaseType = @SQLBaseType_568fb8ef,
  @SQLFullType = @SQLFullType_568fb8ef,
  @SourceEntityID = @SourceEntityID_568fb8ef,
  @SourceFieldName = @SourceFieldName_568fb8ef,
  @IsComputed = @IsComputed_568fb8ef,
  @ComputationDescription = @ComputationDescription_568fb8ef,
  @IsSummary = @IsSummary_568fb8ef,
  @SummaryDescription = @SummaryDescription_568fb8ef,
  @DetectionMethod = @DetectionMethod_568fb8ef,
  @AutoDetectConfidenceScore = @AutoDetectConfidenceScore_568fb8ef,
  @ID = @ID_568fb8ef;

-- Save MJ: Queries (core SP call only)
DECLARE @Name_d42a2cd2 NVARCHAR(255),
@CategoryID_d42a2cd2 UNIQUEIDENTIFIER,
@UserQuestion_d42a2cd2 NVARCHAR(MAX),
@Description_d42a2cd2 NVARCHAR(MAX),
@SQL_d42a2cd2 NVARCHAR(MAX),
@TechnicalDescription_d42a2cd2 NVARCHAR(MAX),
@OriginalSQL_d42a2cd2 NVARCHAR(MAX),
@Feedback_d42a2cd2 NVARCHAR(MAX),
@Status_d42a2cd2 NVARCHAR(15),
@QualityRank_d42a2cd2 INT,
@ExecutionCostRank_d42a2cd2 INT,
@UsesTemplate_d42a2cd2 BIT,
@AuditQueryRuns_d42a2cd2 BIT,
@CacheEnabled_d42a2cd2 BIT,
@CacheTTLMinutes_d42a2cd2 INT,
@CacheMaxSize_d42a2cd2 INT,
@EmbeddingVector_d42a2cd2 NVARCHAR(MAX),
@EmbeddingModelID_d42a2cd2 UNIQUEIDENTIFIER,
@CacheValidationSQL_d42a2cd2 NVARCHAR(MAX),
@ID_d42a2cd2 UNIQUEIDENTIFIER
SET
  @Name_d42a2cd2 = N'Server Installed Version History'
SET
  @CategoryID_d42a2cd2 = '17AFCCEC-6A37-EF11-86D4-000D3A4E707E'
SET
  @UserQuestion_d42a2cd2 = N'Show me a list of versions installed on the server in order of most recent version first'
SET
  @SQL_d42a2cd2 = N'SELECT * FROM [${flyway:defaultSchema}].flyway_schema_history ORDER BY installed_on DESC'
SET
  @Status_d42a2cd2 = N'Approved'
SET
  @QualityRank_d42a2cd2 = 9
SET
  @ExecutionCostRank_d42a2cd2 = 3
SET
  @UsesTemplate_d42a2cd2 = 0
SET
  @AuditQueryRuns_d42a2cd2 = 0
SET
  @CacheEnabled_d42a2cd2 = 0
SET
  @ID_d42a2cd2 = '23F8423E-F36B-1410-8D9C-00021F8B792E'
EXEC [${flyway:defaultSchema}].spUpdateQuery @Name = @Name_d42a2cd2,
  @CategoryID = @CategoryID_d42a2cd2,
  @UserQuestion = @UserQuestion_d42a2cd2,
  @Description = @Description_d42a2cd2,
  @SQL = @SQL_d42a2cd2,
  @TechnicalDescription = @TechnicalDescription_d42a2cd2,
  @OriginalSQL = @OriginalSQL_d42a2cd2,
  @Feedback = @Feedback_d42a2cd2,
  @Status = @Status_d42a2cd2,
  @QualityRank = @QualityRank_d42a2cd2,
  @ExecutionCostRank = @ExecutionCostRank_d42a2cd2,
  @UsesTemplate = @UsesTemplate_d42a2cd2,
  @AuditQueryRuns = @AuditQueryRuns_d42a2cd2,
  @CacheEnabled = @CacheEnabled_d42a2cd2,
  @CacheTTLMinutes = @CacheTTLMinutes_d42a2cd2,
  @CacheMaxSize = @CacheMaxSize_d42a2cd2,
  @EmbeddingVector = @EmbeddingVector_d42a2cd2,
  @EmbeddingModelID = @EmbeddingModelID_d42a2cd2,
  @CacheValidationSQL = @CacheValidationSQL_d42a2cd2,
  @ID = @ID_d42a2cd2;


-- End of SQL Logging Session
-- Session ID: bb49750f-08e5-4901-84f8-03add7774b80
-- Completed: 2026-02-20T17:19:13.082Z
-- Duration: 118309ms
-- Total Statements: 48
