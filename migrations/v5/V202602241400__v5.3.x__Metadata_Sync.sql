-- SQL Logging Session
-- Session ID: 717e34ae-6607-45c7-9320-3fc747302dfe
-- Started: 2026-02-24T19:32:59.080Z
-- Description: MetadataSync push operation
-- Format: Migration-ready with Flyway schema placeholders
-- Generated by MemberJunction SQLServerDataProvider

-- Save MJ: Actions (core SP call only)
DECLARE @ID_71fbd4f4 UNIQUEIDENTIFIER,
@CategoryID_71fbd4f4 UNIQUEIDENTIFIER,
@Name_71fbd4f4 NVARCHAR(425),
@Description_71fbd4f4 NVARCHAR(MAX),
@Type_71fbd4f4 NVARCHAR(20),
@UserPrompt_71fbd4f4 NVARCHAR(MAX),
@UserComments_71fbd4f4 NVARCHAR(MAX),
@Code_71fbd4f4 NVARCHAR(MAX),
@CodeComments_71fbd4f4 NVARCHAR(MAX),
@CodeApprovalStatus_71fbd4f4 NVARCHAR(20),
@CodeApprovalComments_71fbd4f4 NVARCHAR(MAX),
@CodeApprovedByUserID_71fbd4f4 UNIQUEIDENTIFIER,
@CodeApprovedAt_71fbd4f4 DATETIMEOFFSET,
@CodeLocked_71fbd4f4 BIT,
@ForceCodeGeneration_71fbd4f4 BIT,
@RetentionPeriod_71fbd4f4 INT,
@Status_71fbd4f4 NVARCHAR(20),
@DriverClass_71fbd4f4 NVARCHAR(255),
@ParentID_71fbd4f4 UNIQUEIDENTIFIER,
@IconClass_71fbd4f4 NVARCHAR(100),
@DefaultCompactPromptID_71fbd4f4 UNIQUEIDENTIFIER
SET
  @ID_71fbd4f4 = '59B4E9C8-5408-480E-93EE-644B7EC197BB'
SET
  @CategoryID_71fbd4f4 = '75DD6103-E7B1-4B83-81C1-B5D135403344'
SET
  @Name_71fbd4f4 = N'Computer Use'
SET
  @Description_71fbd4f4 = N'Drives a web browser via LLM reasoning over screenshots to accomplish a natural-language goal. Uses a vision-to-action loop: captures screenshots, sends them to a controller LLM that plans browser actions (click, type, navigate, scroll), executes those actions via Playwright, and evaluates progress with a judge LLM. Supports per-domain authentication, domain allow/block lists, and configurable step limits.'
SET
  @Type_71fbd4f4 = N'Custom'
SET
  @CodeApprovalStatus_71fbd4f4 = N'Pending'
SET
  @CodeLocked_71fbd4f4 = 0
SET
  @ForceCodeGeneration_71fbd4f4 = 0
SET
  @Status_71fbd4f4 = N'Active'
SET
  @DriverClass_71fbd4f4 = N'Computer Use'
SET
  @IconClass_71fbd4f4 = N'fa-solid fa-desktop'
EXEC [${flyway:defaultSchema}].spCreateAction @ID = @ID_71fbd4f4,
  @CategoryID = @CategoryID_71fbd4f4,
  @Name = @Name_71fbd4f4,
  @Description = @Description_71fbd4f4,
  @Type = @Type_71fbd4f4,
  @UserPrompt = @UserPrompt_71fbd4f4,
  @UserComments = @UserComments_71fbd4f4,
  @Code = @Code_71fbd4f4,
  @CodeComments = @CodeComments_71fbd4f4,
  @CodeApprovalStatus = @CodeApprovalStatus_71fbd4f4,
  @CodeApprovalComments = @CodeApprovalComments_71fbd4f4,
  @CodeApprovedByUserID = @CodeApprovedByUserID_71fbd4f4,
  @CodeApprovedAt = @CodeApprovedAt_71fbd4f4,
  @CodeLocked = @CodeLocked_71fbd4f4,
  @ForceCodeGeneration = @ForceCodeGeneration_71fbd4f4,
  @RetentionPeriod = @RetentionPeriod_71fbd4f4,
  @Status = @Status_71fbd4f4,
  @DriverClass = @DriverClass_71fbd4f4,
  @ParentID = @ParentID_71fbd4f4,
  @IconClass = @IconClass_71fbd4f4,
  @DefaultCompactPromptID = @DefaultCompactPromptID_71fbd4f4;

-- Save MJ: Action Params (core SP call only)
DECLARE @ID_f6e442dc UNIQUEIDENTIFIER,
@ActionID_f6e442dc UNIQUEIDENTIFIER,
@Name_f6e442dc NVARCHAR(255),
@DefaultValue_f6e442dc NVARCHAR(MAX),
@Type_f6e442dc NCHAR(10),
@ValueType_f6e442dc NVARCHAR(30),
@IsArray_f6e442dc BIT,
@Description_f6e442dc NVARCHAR(MAX),
@IsRequired_f6e442dc BIT,
@MediaModality_f6e442dc NVARCHAR(20)
SET
  @ID_f6e442dc = '5E66A1DE-E671-4D6E-84D7-B8A7927F9F6E'
SET
  @ActionID_f6e442dc = '59B4E9C8-5408-480E-93EE-644B7EC197BB'
SET
  @Name_f6e442dc = N'Goal'
SET
  @Type_f6e442dc = N'Input'
SET
  @ValueType_f6e442dc = N'Scalar'
SET
  @IsArray_f6e442dc = 0
SET
  @Description_f6e442dc = N'Natural-language goal for the browser agent to accomplish. Example: ''Navigate to example.com and find the contact email address''.'
SET
  @IsRequired_f6e442dc = 1
EXEC [${flyway:defaultSchema}].spCreateActionParam @ID = @ID_f6e442dc,
  @ActionID = @ActionID_f6e442dc,
  @Name = @Name_f6e442dc,
  @DefaultValue = @DefaultValue_f6e442dc,
  @Type = @Type_f6e442dc,
  @ValueType = @ValueType_f6e442dc,
  @IsArray = @IsArray_f6e442dc,
  @Description = @Description_f6e442dc,
  @IsRequired = @IsRequired_f6e442dc,
  @MediaModality = @MediaModality_f6e442dc;

-- Save MJ: Action Params (core SP call only)
DECLARE @ID_8a8c33f5 UNIQUEIDENTIFIER,
@ActionID_8a8c33f5 UNIQUEIDENTIFIER,
@Name_8a8c33f5 NVARCHAR(255),
@DefaultValue_8a8c33f5 NVARCHAR(MAX),
@Type_8a8c33f5 NCHAR(10),
@ValueType_8a8c33f5 NVARCHAR(30),
@IsArray_8a8c33f5 BIT,
@Description_8a8c33f5 NVARCHAR(MAX),
@IsRequired_8a8c33f5 BIT,
@MediaModality_8a8c33f5 NVARCHAR(20)
SET
  @ID_8a8c33f5 = 'EDB44D87-C83C-440C-B93E-41D05DBF0288'
SET
  @ActionID_8a8c33f5 = '59B4E9C8-5408-480E-93EE-644B7EC197BB'
SET
  @Name_8a8c33f5 = N'StartUrl'
SET
  @Type_8a8c33f5 = N'Input'
SET
  @ValueType_8a8c33f5 = N'Scalar'
SET
  @IsArray_8a8c33f5 = 0
SET
  @Description_8a8c33f5 = N'Starting URL for the browser to navigate to before beginning the goal. If not provided, the controller LLM will decide where to start.'
SET
  @IsRequired_8a8c33f5 = 0
EXEC [${flyway:defaultSchema}].spCreateActionParam @ID = @ID_8a8c33f5,
  @ActionID = @ActionID_8a8c33f5,
  @Name = @Name_8a8c33f5,
  @DefaultValue = @DefaultValue_8a8c33f5,
  @Type = @Type_8a8c33f5,
  @ValueType = @ValueType_8a8c33f5,
  @IsArray = @IsArray_8a8c33f5,
  @Description = @Description_8a8c33f5,
  @IsRequired = @IsRequired_8a8c33f5,
  @MediaModality = @MediaModality_8a8c33f5;

-- Save MJ: Action Params (core SP call only)
DECLARE @ID_f5e389ed UNIQUEIDENTIFIER,
@ActionID_f5e389ed UNIQUEIDENTIFIER,
@Name_f5e389ed NVARCHAR(255),
@DefaultValue_f5e389ed NVARCHAR(MAX),
@Type_f5e389ed NCHAR(10),
@ValueType_f5e389ed NVARCHAR(30),
@IsArray_f5e389ed BIT,
@Description_f5e389ed NVARCHAR(MAX),
@IsRequired_f5e389ed BIT,
@MediaModality_f5e389ed NVARCHAR(20)
SET
  @ID_f5e389ed = '924528A3-2918-4644-889A-967135B2E2BF'
SET
  @ActionID_f5e389ed = '59B4E9C8-5408-480E-93EE-644B7EC197BB'
SET
  @Name_f5e389ed = N'Headless'
SET
  @DefaultValue_f5e389ed = N'true'
SET
  @Type_f5e389ed = N'Input'
SET
  @ValueType_f5e389ed = N'Scalar'
SET
  @IsArray_f5e389ed = 0
SET
  @Description_f5e389ed = N'Whether to run the browser in headless mode. Set to ''false'' to see the browser window during execution. Default: ''true''.'
SET
  @IsRequired_f5e389ed = 0
EXEC [${flyway:defaultSchema}].spCreateActionParam @ID = @ID_f5e389ed,
  @ActionID = @ActionID_f5e389ed,
  @Name = @Name_f5e389ed,
  @DefaultValue = @DefaultValue_f5e389ed,
  @Type = @Type_f5e389ed,
  @ValueType = @ValueType_f5e389ed,
  @IsArray = @IsArray_f5e389ed,
  @Description = @Description_f5e389ed,
  @IsRequired = @IsRequired_f5e389ed,
  @MediaModality = @MediaModality_f5e389ed;

-- Save MJ: Action Params (core SP call only)
DECLARE @ID_1721b59d UNIQUEIDENTIFIER,
@ActionID_1721b59d UNIQUEIDENTIFIER,
@Name_1721b59d NVARCHAR(255),
@DefaultValue_1721b59d NVARCHAR(MAX),
@Type_1721b59d NCHAR(10),
@ValueType_1721b59d NVARCHAR(30),
@IsArray_1721b59d BIT,
@Description_1721b59d NVARCHAR(MAX),
@IsRequired_1721b59d BIT,
@MediaModality_1721b59d NVARCHAR(20)
SET
  @ID_1721b59d = '4D5BD44D-F278-4FEC-96DE-9EF57961B7C5'
SET
  @ActionID_1721b59d = '59B4E9C8-5408-480E-93EE-644B7EC197BB'
SET
  @Name_1721b59d = N'AllowedDomains'
SET
  @Type_1721b59d = N'Input'
SET
  @ValueType_1721b59d = N'Scalar'
SET
  @IsArray_1721b59d = 0
SET
  @Description_1721b59d = N'Comma-delimited list of domains the browser is allowed to visit. If set, all other domains are blocked. Supports wildcards (e.g., ''*.example.com''). Example: ''example.com, *.example.com''.'
SET
  @IsRequired_1721b59d = 0
EXEC [${flyway:defaultSchema}].spCreateActionParam @ID = @ID_1721b59d,
  @ActionID = @ActionID_1721b59d,
  @Name = @Name_1721b59d,
  @DefaultValue = @DefaultValue_1721b59d,
  @Type = @Type_1721b59d,
  @ValueType = @ValueType_1721b59d,
  @IsArray = @IsArray_1721b59d,
  @Description = @Description_1721b59d,
  @IsRequired = @IsRequired_1721b59d,
  @MediaModality = @MediaModality_1721b59d;

-- Save MJ: Action Params (core SP call only)
DECLARE @ID_ce858baa UNIQUEIDENTIFIER,
@ActionID_ce858baa UNIQUEIDENTIFIER,
@Name_ce858baa NVARCHAR(255),
@DefaultValue_ce858baa NVARCHAR(MAX),
@Type_ce858baa NCHAR(10),
@ValueType_ce858baa NVARCHAR(30),
@IsArray_ce858baa BIT,
@Description_ce858baa NVARCHAR(MAX),
@IsRequired_ce858baa BIT,
@MediaModality_ce858baa NVARCHAR(20)
SET
  @ID_ce858baa = 'B7071B7A-A804-4C71-A861-032E3829AFEF'
SET
  @ActionID_ce858baa = '59B4E9C8-5408-480E-93EE-644B7EC197BB'
SET
  @Name_ce858baa = N'BlockedDomains'
SET
  @Type_ce858baa = N'Input'
SET
  @ValueType_ce858baa = N'Scalar'
SET
  @IsArray_ce858baa = 0
SET
  @Description_ce858baa = N'Comma-delimited list of domains explicitly blocked. BlockedDomains always takes precedence over AllowedDomains. Example: ''ads.example.com, tracker.example.com''.'
SET
  @IsRequired_ce858baa = 0
EXEC [${flyway:defaultSchema}].spCreateActionParam @ID = @ID_ce858baa,
  @ActionID = @ActionID_ce858baa,
  @Name = @Name_ce858baa,
  @DefaultValue = @DefaultValue_ce858baa,
  @Type = @Type_ce858baa,
  @ValueType = @ValueType_ce858baa,
  @IsArray = @IsArray_ce858baa,
  @Description = @Description_ce858baa,
  @IsRequired = @IsRequired_ce858baa,
  @MediaModality = @MediaModality_ce858baa;

-- Save MJ: Action Params (core SP call only)
DECLARE @ID_be9065c9 UNIQUEIDENTIFIER,
@ActionID_be9065c9 UNIQUEIDENTIFIER,
@Name_be9065c9 NVARCHAR(255),
@DefaultValue_be9065c9 NVARCHAR(MAX),
@Type_be9065c9 NCHAR(10),
@ValueType_be9065c9 NVARCHAR(30),
@IsArray_be9065c9 BIT,
@Description_be9065c9 NVARCHAR(MAX),
@IsRequired_be9065c9 BIT,
@MediaModality_be9065c9 NVARCHAR(20)
SET
  @ID_be9065c9 = 'D36C8E5E-FEB6-4137-9224-A41A23BA062D'
SET
  @ActionID_be9065c9 = '59B4E9C8-5408-480E-93EE-644B7EC197BB'
SET
  @Name_be9065c9 = N'MaxSteps'
SET
  @DefaultValue_be9065c9 = N'30'
SET
  @Type_be9065c9 = N'Input'
SET
  @ValueType_be9065c9 = N'Scalar'
SET
  @IsArray_be9065c9 = 0
SET
  @Description_be9065c9 = N'Maximum number of controller loop steps before forced termination. Each step captures a screenshot, calls the controller LLM, and executes actions. Default: 30.'
SET
  @IsRequired_be9065c9 = 0
EXEC [${flyway:defaultSchema}].spCreateActionParam @ID = @ID_be9065c9,
  @ActionID = @ActionID_be9065c9,
  @Name = @Name_be9065c9,
  @DefaultValue = @DefaultValue_be9065c9,
  @Type = @Type_be9065c9,
  @ValueType = @ValueType_be9065c9,
  @IsArray = @IsArray_be9065c9,
  @Description = @Description_be9065c9,
  @IsRequired = @IsRequired_be9065c9,
  @MediaModality = @MediaModality_be9065c9;

-- Save MJ: Action Params (core SP call only)
DECLARE @ID_dcaa9ec3 UNIQUEIDENTIFIER,
@ActionID_dcaa9ec3 UNIQUEIDENTIFIER,
@Name_dcaa9ec3 NVARCHAR(255),
@DefaultValue_dcaa9ec3 NVARCHAR(MAX),
@Type_dcaa9ec3 NCHAR(10),
@ValueType_dcaa9ec3 NVARCHAR(30),
@IsArray_dcaa9ec3 BIT,
@Description_dcaa9ec3 NVARCHAR(MAX),
@IsRequired_dcaa9ec3 BIT,
@MediaModality_dcaa9ec3 NVARCHAR(20)
SET
  @ID_dcaa9ec3 = 'DB672E72-22BB-4661-8B53-150DDD9F3598'
SET
  @ActionID_dcaa9ec3 = '59B4E9C8-5408-480E-93EE-644B7EC197BB'
SET
  @Name_dcaa9ec3 = N'ControllerPromptName'
SET
  @Type_dcaa9ec3 = N'Input'
SET
  @ValueType_dcaa9ec3 = N'Scalar'
SET
  @IsArray_dcaa9ec3 = 0
SET
  @Description_dcaa9ec3 = N'Name of an MJ AI Prompt entity to use for the controller LLM. When set, routes prompt execution through AIPromptRunner for template rendering, model selection, prompt run logging, and token tracking. Example: ''Computer Use Controller''.'
SET
  @IsRequired_dcaa9ec3 = 0
EXEC [${flyway:defaultSchema}].spCreateActionParam @ID = @ID_dcaa9ec3,
  @ActionID = @ActionID_dcaa9ec3,
  @Name = @Name_dcaa9ec3,
  @DefaultValue = @DefaultValue_dcaa9ec3,
  @Type = @Type_dcaa9ec3,
  @ValueType = @ValueType_dcaa9ec3,
  @IsArray = @IsArray_dcaa9ec3,
  @Description = @Description_dcaa9ec3,
  @IsRequired = @IsRequired_dcaa9ec3,
  @MediaModality = @MediaModality_dcaa9ec3;

-- Save MJ: Action Params (core SP call only)
DECLARE @ID_74185b78 UNIQUEIDENTIFIER,
@ActionID_74185b78 UNIQUEIDENTIFIER,
@Name_74185b78 NVARCHAR(255),
@DefaultValue_74185b78 NVARCHAR(MAX),
@Type_74185b78 NCHAR(10),
@ValueType_74185b78 NVARCHAR(30),
@IsArray_74185b78 BIT,
@Description_74185b78 NVARCHAR(MAX),
@IsRequired_74185b78 BIT,
@MediaModality_74185b78 NVARCHAR(20)
SET
  @ID_74185b78 = '7139FDF1-D84F-4F0E-8E94-B9A903AD5D4E'
SET
  @ActionID_74185b78 = '59B4E9C8-5408-480E-93EE-644B7EC197BB'
SET
  @Name_74185b78 = N'JudgePromptName'
SET
  @Type_74185b78 = N'Input'
SET
  @ValueType_74185b78 = N'Scalar'
SET
  @IsArray_74185b78 = 0
SET
  @Description_74185b78 = N'Name of an MJ AI Prompt entity to use for the judge LLM. When set, routes prompt execution through AIPromptRunner for template rendering, model selection, prompt run logging, and token tracking. Example: ''Computer Use Judge''.'
SET
  @IsRequired_74185b78 = 0
EXEC [${flyway:defaultSchema}].spCreateActionParam @ID = @ID_74185b78,
  @ActionID = @ActionID_74185b78,
  @Name = @Name_74185b78,
  @DefaultValue = @DefaultValue_74185b78,
  @Type = @Type_74185b78,
  @ValueType = @ValueType_74185b78,
  @IsArray = @IsArray_74185b78,
  @Description = @Description_74185b78,
  @IsRequired = @IsRequired_74185b78,
  @MediaModality = @MediaModality_74185b78;

-- Save MJ: Action Params (core SP call only)
DECLARE @ID_61e8a3c8 UNIQUEIDENTIFIER,
@ActionID_61e8a3c8 UNIQUEIDENTIFIER,
@Name_61e8a3c8 NVARCHAR(255),
@DefaultValue_61e8a3c8 NVARCHAR(MAX),
@Type_61e8a3c8 NCHAR(10),
@ValueType_61e8a3c8 NVARCHAR(30),
@IsArray_61e8a3c8 BIT,
@Description_61e8a3c8 NVARCHAR(MAX),
@IsRequired_61e8a3c8 BIT,
@MediaModality_61e8a3c8 NVARCHAR(20)
SET
  @ID_61e8a3c8 = '15568187-53BF-4372-AE68-D705C37F4215'
SET
  @ActionID_61e8a3c8 = '59B4E9C8-5408-480E-93EE-644B7EC197BB'
SET
  @Name_61e8a3c8 = N'JudgeFrequency'
SET
  @DefaultValue_61e8a3c8 = N'EveryStep'
SET
  @Type_61e8a3c8 = N'Input'
SET
  @ValueType_61e8a3c8 = N'Scalar'
SET
  @IsArray_61e8a3c8 = 0
SET
  @Description_61e8a3c8 = N'How often the judge evaluates progress. Options: ''EveryStep'' (every step, most accurate but highest cost), ''EveryNSteps:N'' (every N steps, e.g. ''EveryNSteps:3''), ''OnStagnation:N'' (only when N identical screenshots detected, e.g. ''OnStagnation:5''). Default: ''EveryStep''.'
SET
  @IsRequired_61e8a3c8 = 0
EXEC [${flyway:defaultSchema}].spCreateActionParam @ID = @ID_61e8a3c8,
  @ActionID = @ActionID_61e8a3c8,
  @Name = @Name_61e8a3c8,
  @DefaultValue = @DefaultValue_61e8a3c8,
  @Type = @Type_61e8a3c8,
  @ValueType = @ValueType_61e8a3c8,
  @IsArray = @IsArray_61e8a3c8,
  @Description = @Description_61e8a3c8,
  @IsRequired = @IsRequired_61e8a3c8,
  @MediaModality = @MediaModality_61e8a3c8;

-- Save MJ: Action Params (core SP call only)
DECLARE @ID_2d82347d UNIQUEIDENTIFIER,
@ActionID_2d82347d UNIQUEIDENTIFIER,
@Name_2d82347d NVARCHAR(255),
@DefaultValue_2d82347d NVARCHAR(MAX),
@Type_2d82347d NCHAR(10),
@ValueType_2d82347d NVARCHAR(30),
@IsArray_2d82347d BIT,
@Description_2d82347d NVARCHAR(MAX),
@IsRequired_2d82347d BIT,
@MediaModality_2d82347d NVARCHAR(20)
SET
  @ID_2d82347d = 'F4FE4CAC-CDD3-446D-972B-F7B2CBABE1ED'
SET
  @ActionID_2d82347d = '59B4E9C8-5408-480E-93EE-644B7EC197BB'
SET
  @Name_2d82347d = N'AgentRunId'
SET
  @Type_2d82347d = N'Input'
SET
  @ValueType_2d82347d = N'Scalar'
SET
  @IsArray_2d82347d = 0
SET
  @Description_2d82347d = N'Parent MJ agent run ID for linking prompt runs and media to the agent execution. When set, all AIPromptRun records created during the run will reference this agent run.'
SET
  @IsRequired_2d82347d = 0
EXEC [${flyway:defaultSchema}].spCreateActionParam @ID = @ID_2d82347d,
  @ActionID = @ActionID_2d82347d,
  @Name = @Name_2d82347d,
  @DefaultValue = @DefaultValue_2d82347d,
  @Type = @Type_2d82347d,
  @ValueType = @ValueType_2d82347d,
  @IsArray = @IsArray_2d82347d,
  @Description = @Description_2d82347d,
  @IsRequired = @IsRequired_2d82347d,
  @MediaModality = @MediaModality_2d82347d;

-- Save MJ: Action Params (core SP call only)
DECLARE @ID_77628252 UNIQUEIDENTIFIER,
@ActionID_77628252 UNIQUEIDENTIFIER,
@Name_77628252 NVARCHAR(255),
@DefaultValue_77628252 NVARCHAR(MAX),
@Type_77628252 NCHAR(10),
@ValueType_77628252 NVARCHAR(30),
@IsArray_77628252 BIT,
@Description_77628252 NVARCHAR(MAX),
@IsRequired_77628252 BIT,
@MediaModality_77628252 NVARCHAR(20)
SET
  @ID_77628252 = '2AA3E850-C948-4B31-B881-6010DCCBCF68'
SET
  @ActionID_77628252 = '59B4E9C8-5408-480E-93EE-644B7EC197BB'
SET
  @Name_77628252 = N'Success'
SET
  @Type_77628252 = N'Output'
SET
  @ValueType_77628252 = N'Scalar'
SET
  @IsArray_77628252 = 0
SET
  @Description_77628252 = N'Whether the goal was successfully achieved. ''true'' if the judge confirmed goal completion, ''false'' otherwise.'
SET
  @IsRequired_77628252 = 0
EXEC [${flyway:defaultSchema}].spCreateActionParam @ID = @ID_77628252,
  @ActionID = @ActionID_77628252,
  @Name = @Name_77628252,
  @DefaultValue = @DefaultValue_77628252,
  @Type = @Type_77628252,
  @ValueType = @ValueType_77628252,
  @IsArray = @IsArray_77628252,
  @Description = @Description_77628252,
  @IsRequired = @IsRequired_77628252,
  @MediaModality = @MediaModality_77628252;

-- Save MJ: Action Params (core SP call only)
DECLARE @ID_cb86a151 UNIQUEIDENTIFIER,
@ActionID_cb86a151 UNIQUEIDENTIFIER,
@Name_cb86a151 NVARCHAR(255),
@DefaultValue_cb86a151 NVARCHAR(MAX),
@Type_cb86a151 NCHAR(10),
@ValueType_cb86a151 NVARCHAR(30),
@IsArray_cb86a151 BIT,
@Description_cb86a151 NVARCHAR(MAX),
@IsRequired_cb86a151 BIT,
@MediaModality_cb86a151 NVARCHAR(20)
SET
  @ID_cb86a151 = 'CA0A67BD-81DA-4A8C-B967-68D2ACB953D2'
SET
  @ActionID_cb86a151 = '59B4E9C8-5408-480E-93EE-644B7EC197BB'
SET
  @Name_cb86a151 = N'Status'
SET
  @Type_cb86a151 = N'Output'
SET
  @ValueType_cb86a151 = N'Scalar'
SET
  @IsArray_cb86a151 = 0
SET
  @Description_cb86a151 = N'Final run status. One of: ''Completed'' (goal met), ''Failed'' (goal not met after max attempts), ''MaxStepsReached'' (hit step limit), ''Error'' (infrastructure error), ''Cancelled'' (externally cancelled).'
SET
  @IsRequired_cb86a151 = 0
EXEC [${flyway:defaultSchema}].spCreateActionParam @ID = @ID_cb86a151,
  @ActionID = @ActionID_cb86a151,
  @Name = @Name_cb86a151,
  @DefaultValue = @DefaultValue_cb86a151,
  @Type = @Type_cb86a151,
  @ValueType = @ValueType_cb86a151,
  @IsArray = @IsArray_cb86a151,
  @Description = @Description_cb86a151,
  @IsRequired = @IsRequired_cb86a151,
  @MediaModality = @MediaModality_cb86a151;

-- Save MJ: Action Params (core SP call only)
DECLARE @ID_5f949ebf UNIQUEIDENTIFIER,
@ActionID_5f949ebf UNIQUEIDENTIFIER,
@Name_5f949ebf NVARCHAR(255),
@DefaultValue_5f949ebf NVARCHAR(MAX),
@Type_5f949ebf NCHAR(10),
@ValueType_5f949ebf NVARCHAR(30),
@IsArray_5f949ebf BIT,
@Description_5f949ebf NVARCHAR(MAX),
@IsRequired_5f949ebf BIT,
@MediaModality_5f949ebf NVARCHAR(20)
SET
  @ID_5f949ebf = 'D21E5981-37B6-472B-951D-71A44476C902'
SET
  @ActionID_5f949ebf = '59B4E9C8-5408-480E-93EE-644B7EC197BB'
SET
  @Name_5f949ebf = N'TotalSteps'
SET
  @Type_5f949ebf = N'Output'
SET
  @ValueType_5f949ebf = N'Scalar'
SET
  @IsArray_5f949ebf = 0
SET
  @Description_5f949ebf = N'Total number of steps executed during the run.'
SET
  @IsRequired_5f949ebf = 0
EXEC [${flyway:defaultSchema}].spCreateActionParam @ID = @ID_5f949ebf,
  @ActionID = @ActionID_5f949ebf,
  @Name = @Name_5f949ebf,
  @DefaultValue = @DefaultValue_5f949ebf,
  @Type = @Type_5f949ebf,
  @ValueType = @ValueType_5f949ebf,
  @IsArray = @IsArray_5f949ebf,
  @Description = @Description_5f949ebf,
  @IsRequired = @IsRequired_5f949ebf,
  @MediaModality = @MediaModality_5f949ebf;

-- Save MJ: Action Params (core SP call only)
DECLARE @ID_f8f39986 UNIQUEIDENTIFIER,
@ActionID_f8f39986 UNIQUEIDENTIFIER,
@Name_f8f39986 NVARCHAR(255),
@DefaultValue_f8f39986 NVARCHAR(MAX),
@Type_f8f39986 NCHAR(10),
@ValueType_f8f39986 NVARCHAR(30),
@IsArray_f8f39986 BIT,
@Description_f8f39986 NVARCHAR(MAX),
@IsRequired_f8f39986 BIT,
@MediaModality_f8f39986 NVARCHAR(20)
SET
  @ID_f8f39986 = '230E913C-A051-4017-BE1E-F38F8095CC06'
SET
  @ActionID_f8f39986 = '59B4E9C8-5408-480E-93EE-644B7EC197BB'
SET
  @Name_f8f39986 = N'FinalUrl'
SET
  @Type_f8f39986 = N'Output'
SET
  @ValueType_f8f39986 = N'Scalar'
SET
  @IsArray_f8f39986 = 0
SET
  @Description_f8f39986 = N'The browser''s final URL when the run completed.'
SET
  @IsRequired_f8f39986 = 0
EXEC [${flyway:defaultSchema}].spCreateActionParam @ID = @ID_f8f39986,
  @ActionID = @ActionID_f8f39986,
  @Name = @Name_f8f39986,
  @DefaultValue = @DefaultValue_f8f39986,
  @Type = @Type_f8f39986,
  @ValueType = @ValueType_f8f39986,
  @IsArray = @IsArray_f8f39986,
  @Description = @Description_f8f39986,
  @IsRequired = @IsRequired_f8f39986,
  @MediaModality = @MediaModality_f8f39986;

-- Save MJ: Action Params (core SP call only)
DECLARE @ID_9600643d UNIQUEIDENTIFIER,
@ActionID_9600643d UNIQUEIDENTIFIER,
@Name_9600643d NVARCHAR(255),
@DefaultValue_9600643d NVARCHAR(MAX),
@Type_9600643d NCHAR(10),
@ValueType_9600643d NVARCHAR(30),
@IsArray_9600643d BIT,
@Description_9600643d NVARCHAR(MAX),
@IsRequired_9600643d BIT,
@MediaModality_9600643d NVARCHAR(20)
SET
  @ID_9600643d = 'F81DDC95-7DCD-459C-AB4D-380E60145E3F'
SET
  @ActionID_9600643d = '59B4E9C8-5408-480E-93EE-644B7EC197BB'
SET
  @Name_9600643d = N'FinalScreenshot'
SET
  @Type_9600643d = N'Output'
SET
  @ValueType_9600643d = N'Scalar'
SET
  @IsArray_9600643d = 0
SET
  @Description_9600643d = N'Base64-encoded PNG screenshot of the browser''s final state.'
SET
  @IsRequired_9600643d = 0
EXEC [${flyway:defaultSchema}].spCreateActionParam @ID = @ID_9600643d,
  @ActionID = @ActionID_9600643d,
  @Name = @Name_9600643d,
  @DefaultValue = @DefaultValue_9600643d,
  @Type = @Type_9600643d,
  @ValueType = @ValueType_9600643d,
  @IsArray = @IsArray_9600643d,
  @Description = @Description_9600643d,
  @IsRequired = @IsRequired_9600643d,
  @MediaModality = @MediaModality_9600643d;

-- Save MJ: Action Params (core SP call only)
DECLARE @ID_eca9d05d UNIQUEIDENTIFIER,
@ActionID_eca9d05d UNIQUEIDENTIFIER,
@Name_eca9d05d NVARCHAR(255),
@DefaultValue_eca9d05d NVARCHAR(MAX),
@Type_eca9d05d NCHAR(10),
@ValueType_eca9d05d NVARCHAR(30),
@IsArray_eca9d05d BIT,
@Description_eca9d05d NVARCHAR(MAX),
@IsRequired_eca9d05d BIT,
@MediaModality_eca9d05d NVARCHAR(20)
SET
  @ID_eca9d05d = '9BB7DC06-D916-461F-AA1D-BE5862B6E9B6'
SET
  @ActionID_eca9d05d = '59B4E9C8-5408-480E-93EE-644B7EC197BB'
SET
  @Name_eca9d05d = N'Error'
SET
  @Type_eca9d05d = N'Output'
SET
  @ValueType_eca9d05d = N'Scalar'
SET
  @IsArray_eca9d05d = 0
SET
  @Description_eca9d05d = N'Error message if the run failed. Empty if no error occurred.'
SET
  @IsRequired_eca9d05d = 0
EXEC [${flyway:defaultSchema}].spCreateActionParam @ID = @ID_eca9d05d,
  @ActionID = @ActionID_eca9d05d,
  @Name = @Name_eca9d05d,
  @DefaultValue = @DefaultValue_eca9d05d,
  @Type = @Type_eca9d05d,
  @ValueType = @ValueType_eca9d05d,
  @IsArray = @IsArray_eca9d05d,
  @Description = @Description_eca9d05d,
  @IsRequired = @IsRequired_eca9d05d,
  @MediaModality = @MediaModality_eca9d05d;

-- Save MJ: Action Params (core SP call only)
DECLARE @ID_f833817f UNIQUEIDENTIFIER,
@ActionID_f833817f UNIQUEIDENTIFIER,
@Name_f833817f NVARCHAR(255),
@DefaultValue_f833817f NVARCHAR(MAX),
@Type_f833817f NCHAR(10),
@ValueType_f833817f NVARCHAR(30),
@IsArray_f833817f BIT,
@Description_f833817f NVARCHAR(MAX),
@IsRequired_f833817f BIT,
@MediaModality_f833817f NVARCHAR(20)
SET
  @ID_f833817f = '156D3384-D5AF-4EE7-8765-D977DCA702E4'
SET
  @ActionID_f833817f = '59B4E9C8-5408-480E-93EE-644B7EC197BB'
SET
  @Name_f833817f = N'JudgeVerdict'
SET
  @Type_f833817f = N'Output'
SET
  @ValueType_f833817f = N'Simple Object'
SET
  @IsArray_f833817f = 0
SET
  @Description_f833817f = N'JSON object containing the final judge verdict with Done (boolean), Confidence (0.0-1.0), and Reason (string) fields.'
SET
  @IsRequired_f833817f = 0
EXEC [${flyway:defaultSchema}].spCreateActionParam @ID = @ID_f833817f,
  @ActionID = @ActionID_f833817f,
  @Name = @Name_f833817f,
  @DefaultValue = @DefaultValue_f833817f,
  @Type = @Type_f833817f,
  @ValueType = @ValueType_f833817f,
  @IsArray = @IsArray_f833817f,
  @Description = @Description_f833817f,
  @IsRequired = @IsRequired_f833817f,
  @MediaModality = @MediaModality_f833817f;

-- Save MJ: Action Result Codes (core SP call only)
DECLARE @ID_f46266b7 UNIQUEIDENTIFIER,
@ActionID_f46266b7 UNIQUEIDENTIFIER,
@ResultCode_f46266b7 NVARCHAR(255),
@IsSuccess_f46266b7 BIT,
@Description_f46266b7 NVARCHAR(MAX)
SET
  @ID_f46266b7 = '5A50A0E4-E49F-4917-A455-09FEA0A2042B'
SET
  @ActionID_f46266b7 = '59B4E9C8-5408-480E-93EE-644B7EC197BB'
SET
  @ResultCode_f46266b7 = N'Completed'
SET
  @IsSuccess_f46266b7 = 1
SET
  @Description_f46266b7 = N'The judge confirmed that the goal was successfully achieved.'
EXEC [${flyway:defaultSchema}].spCreateActionResultCode @ID = @ID_f46266b7,
  @ActionID = @ActionID_f46266b7,
  @ResultCode = @ResultCode_f46266b7,
  @IsSuccess = @IsSuccess_f46266b7,
  @Description = @Description_f46266b7;

-- Save MJ: Action Result Codes (core SP call only)
DECLARE @ID_c631493d UNIQUEIDENTIFIER,
@ActionID_c631493d UNIQUEIDENTIFIER,
@ResultCode_c631493d NVARCHAR(255),
@IsSuccess_c631493d BIT,
@Description_c631493d NVARCHAR(MAX)
SET
  @ID_c631493d = 'B93A054E-D12D-486B-82B5-498A0B296757'
SET
  @ActionID_c631493d = '59B4E9C8-5408-480E-93EE-644B7EC197BB'
SET
  @ResultCode_c631493d = N'Failed'
SET
  @IsSuccess_c631493d = 0
SET
  @Description_c631493d = N'The judge confirmed the goal was not met after maximum attempts.'
EXEC [${flyway:defaultSchema}].spCreateActionResultCode @ID = @ID_c631493d,
  @ActionID = @ActionID_c631493d,
  @ResultCode = @ResultCode_c631493d,
  @IsSuccess = @IsSuccess_c631493d,
  @Description = @Description_c631493d;

-- Save MJ: Action Result Codes (core SP call only)
DECLARE @ID_3a4f6502 UNIQUEIDENTIFIER,
@ActionID_3a4f6502 UNIQUEIDENTIFIER,
@ResultCode_3a4f6502 NVARCHAR(255),
@IsSuccess_3a4f6502 BIT,
@Description_3a4f6502 NVARCHAR(MAX)
SET
  @ID_3a4f6502 = '9B6F0C4C-06F1-4ACF-9E67-7B670AA7E591'
SET
  @ActionID_3a4f6502 = '59B4E9C8-5408-480E-93EE-644B7EC197BB'
SET
  @ResultCode_3a4f6502 = N'MaxStepsReached'
SET
  @IsSuccess_3a4f6502 = 0
SET
  @Description_3a4f6502 = N'The run hit the maximum step limit without the judge confirming goal completion.'
EXEC [${flyway:defaultSchema}].spCreateActionResultCode @ID = @ID_3a4f6502,
  @ActionID = @ActionID_3a4f6502,
  @ResultCode = @ResultCode_3a4f6502,
  @IsSuccess = @IsSuccess_3a4f6502,
  @Description = @Description_3a4f6502;

-- Save MJ: Action Result Codes (core SP call only)
DECLARE @ID_24a402d3 UNIQUEIDENTIFIER,
@ActionID_24a402d3 UNIQUEIDENTIFIER,
@ResultCode_24a402d3 NVARCHAR(255),
@IsSuccess_24a402d3 BIT,
@Description_24a402d3 NVARCHAR(MAX)
SET
  @ID_24a402d3 = '698DFDBD-227D-46E4-8C7D-9BC60BBB5DBD'
SET
  @ActionID_24a402d3 = '59B4E9C8-5408-480E-93EE-644B7EC197BB'
SET
  @ResultCode_24a402d3 = N'Error'
SET
  @IsSuccess_24a402d3 = 0
SET
  @Description_24a402d3 = N'An infrastructure or runtime error occurred during the run (browser crash, LLM failure, etc.).'
EXEC [${flyway:defaultSchema}].spCreateActionResultCode @ID = @ID_24a402d3,
  @ActionID = @ActionID_24a402d3,
  @ResultCode = @ResultCode_24a402d3,
  @IsSuccess = @IsSuccess_24a402d3,
  @Description = @Description_24a402d3;

-- Save MJ: Action Result Codes (core SP call only)
DECLARE @ID_551de98b UNIQUEIDENTIFIER,
@ActionID_551de98b UNIQUEIDENTIFIER,
@ResultCode_551de98b NVARCHAR(255),
@IsSuccess_551de98b BIT,
@Description_551de98b NVARCHAR(MAX)
SET
  @ID_551de98b = 'EA6B6A77-C401-4E77-A58F-85C696100204'
SET
  @ActionID_551de98b = '59B4E9C8-5408-480E-93EE-644B7EC197BB'
SET
  @ResultCode_551de98b = N'Cancelled'
SET
  @IsSuccess_551de98b = 0
SET
  @Description_551de98b = N'The run was externally cancelled via Stop().'
EXEC [${flyway:defaultSchema}].spCreateActionResultCode @ID = @ID_551de98b,
  @ActionID = @ActionID_551de98b,
  @ResultCode = @ResultCode_551de98b,
  @IsSuccess = @IsSuccess_551de98b,
  @Description = @Description_551de98b;

-- Save MJ: Action Result Codes (core SP call only)
DECLARE @ID_e3dc773d UNIQUEIDENTIFIER,
@ActionID_e3dc773d UNIQUEIDENTIFIER,
@ResultCode_e3dc773d NVARCHAR(255),
@IsSuccess_e3dc773d BIT,
@Description_e3dc773d NVARCHAR(MAX)
SET
  @ID_e3dc773d = '445E330F-1281-4CD2-89CF-0055754737AF'
SET
  @ActionID_e3dc773d = '59B4E9C8-5408-480E-93EE-644B7EC197BB'
SET
  @ResultCode_e3dc773d = N'ERROR'
SET
  @IsSuccess_e3dc773d = 0
SET
  @Description_e3dc773d = N'An unhandled exception occurred before or during engine execution.'
EXEC [${flyway:defaultSchema}].spCreateActionResultCode @ID = @ID_e3dc773d,
  @ActionID = @ActionID_e3dc773d,
  @ResultCode = @ResultCode_e3dc773d,
  @IsSuccess = @IsSuccess_e3dc773d,
  @Description = @Description_e3dc773d;

-- Save MJ: Templates (core SP call only)
DECLARE @ID_cc1a4185 UNIQUEIDENTIFIER,
@Name_cc1a4185 NVARCHAR(255),
@Description_cc1a4185 NVARCHAR(MAX),
@CategoryID_cc1a4185 UNIQUEIDENTIFIER,
@UserPrompt_cc1a4185 NVARCHAR(MAX),
@UserID_cc1a4185 UNIQUEIDENTIFIER,
@ActiveAt_cc1a4185 DATETIMEOFFSET,
@DisabledAt_cc1a4185 DATETIMEOFFSET,
@IsActive_cc1a4185 BIT
SET
  @ID_cc1a4185 = 'ebbe0b44-6a44-4f4d-b426-3da257cd6b1d'
SET
  @Name_cc1a4185 = N'Computer Use - Controller'
SET
  @Description_cc1a4185 = N'Template for AI Prompt: Computer Use - Controller'
SET
  @CategoryID_cc1a4185 = 'B61B01C3-2DD1-4FFA-AE77-6DE9765BCA68'
SET
  @UserID_cc1a4185 = 'ECAFCCEC-6A37-EF11-86D4-000D3A4E707E'
SET
  @IsActive_cc1a4185 = 1
EXEC [${flyway:defaultSchema}].spCreateTemplate @ID = @ID_cc1a4185,
  @Name = @Name_cc1a4185,
  @Description = @Description_cc1a4185,
  @CategoryID = @CategoryID_cc1a4185,
  @UserPrompt = @UserPrompt_cc1a4185,
  @UserID = @UserID_cc1a4185,
  @ActiveAt = @ActiveAt_cc1a4185,
  @DisabledAt = @DisabledAt_cc1a4185,
  @IsActive = @IsActive_cc1a4185;

-- Save MJ: Templates (core SP call only)
DECLARE @ID_4b741dac UNIQUEIDENTIFIER,
@Name_4b741dac NVARCHAR(255),
@Description_4b741dac NVARCHAR(MAX),
@CategoryID_4b741dac UNIQUEIDENTIFIER,
@UserPrompt_4b741dac NVARCHAR(MAX),
@UserID_4b741dac UNIQUEIDENTIFIER,
@ActiveAt_4b741dac DATETIMEOFFSET,
@DisabledAt_4b741dac DATETIMEOFFSET,
@IsActive_4b741dac BIT
SET
  @ID_4b741dac = '022fca9f-5ea9-4e7e-8ff7-bbef4365cd2a'
SET
  @Name_4b741dac = N'Computer Use - Judge'
SET
  @Description_4b741dac = N'Template for AI Prompt: Computer Use - Judge'
SET
  @CategoryID_4b741dac = 'B61B01C3-2DD1-4FFA-AE77-6DE9765BCA68'
SET
  @UserID_4b741dac = 'ECAFCCEC-6A37-EF11-86D4-000D3A4E707E'
SET
  @IsActive_4b741dac = 1
EXEC [${flyway:defaultSchema}].spCreateTemplate @ID = @ID_4b741dac,
  @Name = @Name_4b741dac,
  @Description = @Description_4b741dac,
  @CategoryID = @CategoryID_4b741dac,
  @UserPrompt = @UserPrompt_4b741dac,
  @UserID = @UserID_4b741dac,
  @ActiveAt = @ActiveAt_4b741dac,
  @DisabledAt = @DisabledAt_4b741dac,
  @IsActive = @IsActive_4b741dac;

-- Save MJ: Template Contents (core SP call only)
DECLARE @ID_5adc4981 UNIQUEIDENTIFIER,
@TemplateID_5adc4981 UNIQUEIDENTIFIER,
@TypeID_5adc4981 UNIQUEIDENTIFIER,
@TemplateText_5adc4981 NVARCHAR(MAX),
@Priority_5adc4981 INT,
@IsActive_5adc4981 BIT
SET
  @ID_5adc4981 = '557e8c46-9db3-4500-8ffb-6b6930b30be0'
SET
  @TemplateID_5adc4981 = 'EBBE0B44-6A44-4F4D-B426-3DA257CD6B1D'
SET
  @TypeID_5adc4981 = 'E7AFCCEC-6A37-EF11-86D4-000D3A4E707E'
SET
  @TemplateText_5adc4981 = N'You are a browser automation agent. You control a web browser to accomplish a goal by analyzing screenshots and deciding what actions to take.

## Your Goal
{{ goal }}

## Current State
- Step: {{ stepNumber }} of {{ maxSteps }}
- Current URL: {{ currentUrl }}

## Coordinate System
The screenshot uses a **normalized 1000x1000 coordinate space**. All X coordinates range from 0 (left edge) to 1000 (right edge), and all Y coordinates range from 0 (top edge) to 1000 (bottom edge). When specifying click positions, always use this 0-1000 range for both axes.

## Available Actions
You can perform the following browser actions:

- **Click**: Click at a target in the 1000x1000 coordinate space. **Prefer providing a BoundingBox** for better accuracy — the engine clicks the center of the box automatically. If you cannot determine the bounding box, fall back to X/Y point coordinates.
  With bounding box (preferred): `{ "Type": "Click", "BoundingBox": { "XMin": 420, "YMin": 270, "XMax": 580, "YMax": 330 } }`
  With point coordinates: `{ "Type": "Click", "X": 500, "Y": 300 }`
  All coordinate values (X, Y, XMin, YMin, XMax, YMax) must be between 0 and 1000.
- **Type**: Type text into the currently focused element
  `{ "Type": "Type", "Text": "hello world" }`
- **Keypress**: Press a key or key combination (e.g., "Enter", "Tab", "Shift+A", "ControlOrMeta+C")
  `{ "Type": "Keypress", "Key": "Enter" }`
- **KeyDown/KeyUp**: Hold or release a key (for drag, multi-select, etc.)
  `{ "Type": "KeyDown", "Key": "Shift" }` / `{ "Type": "KeyUp", "Key": "Shift" }`
- **Scroll**: Scroll the page in the 1000x1000 coordinate space (positive DeltaY = down, negative = up)
  `{ "Type": "Scroll", "DeltaY": 300 }`
- **Wait**: Wait for a specified duration in milliseconds
  `{ "Type": "Wait", "DurationMs": 1000 }`
- **Navigate**: Navigate to a URL
  `{ "Type": "Navigate", "Url": "https://example.com" }`
- **GoBack/GoForward**: Browser history navigation
  `{ "Type": "GoBack" }` / `{ "Type": "GoForward" }`
- **Refresh**: Refresh the current page
  `{ "Type": "Refresh" }`

{% if toolDefinitions and toolDefinitions.length > 0 %}
## Available Tools
You can also call the following tools:

{% for tool in toolDefinitions %}
### {{ tool.Name }}
{{ tool.Description }}
Input schema: `{{ tool.InputSchema | dump }}`

{% endfor %}
To call a tool, include it in the "toolCalls" array:
`{ "toolName": "tool_name", "arguments": { ... } }`
{% endif %}

{% if formLoginCredentials %}
## Login Credentials (IMPORTANT)
You MUST use exactly these credentials when filling in the login form on {{ formLoginCredentials.Domain }}. Do NOT use any other email, username, or password.
- Username/Email: {{ formLoginCredentials.Username }}
- Password: {{ formLoginCredentials.Password }}
Type these values exactly as shown. Do not guess or substitute other credentials.
{% endif %}

{% if judgeFeedback %}
## Feedback from Previous Evaluation
{{ judgeFeedback }}
Take this feedback into account when planning your next actions.
{% endif %}

{% if previousStepSummary %}
## Previous Actions
{{ previousStepSummary }}
{% endif %}

## Response Format
Respond with ONLY a JSON object (no other text):

**When you are still working** (goal NOT yet accomplished):
```json
{
  "reasoning": "Brief explanation of what you see and what you plan to do",
  "actions": [
    { "Type": "Click", "BoundingBox": { "XMin": 420, "YMin": 270, "XMax": 580, "YMax": 330 } }
  ],
  "toolCalls": [],
  "requestJudgement": false
}
```

**When you believe the goal is accomplished or a major milestone is reached:**
```json
{
  "reasoning": "I have completed the goal because [specific evidence visible on screen]",
  "actions": [],
  "toolCalls": [],
  "requestJudgement": true
}
```

**When you believe the goal is impossible to accomplish:**
```json
{
  "reasoning": "I believe this goal is impossible because [specific blocker — e.g., access denied, element does not exist, repeated failures with different approaches]",
  "actions": [],
  "toolCalls": [],
  "requestJudgement": true
}
```

### CRITICAL: `requestJudgement` Field
You MUST set `requestJudgement: true` when ANY of these apply:
- The goal appears to be accomplished based on what you see on screen
- You have completed the final action needed to achieve the goal (e.g., clicked Submit, saved a form, navigated to the target page)
- You have completed a significant milestone and need confirmation before proceeding
- You believe the goal is **impossible** to accomplish (e.g., access denied, page not found, feature doesn''t exist, repeated failures across different approaches)
- You are stuck in a loop — the same actions keep producing the same results with no progress
- You are unsure whether the current state meets the goal

**Do NOT** continue taking actions after you believe the goal is done or impossible. Instead, set `requestJudgement: true` and let the judge confirm. Failing to request judgement wastes steps.

The judge will analyze the current state and provide feedback. If the goal is met, the run will complete successfully. If the judge agrees the goal is impossible, the run will stop immediately. Otherwise, you''ll receive specific guidance on what to try next.

## Rules
1. **Request judgement immediately when the goal appears done or impossible** — this is the most important rule. Set `requestJudgement: true` as soon as you see evidence the goal is accomplished OR that it cannot be accomplished. Do not take unnecessary extra actions after completion, and do not keep retrying when a task is clearly blocked.
2. Analyze the screenshot carefully before deciding on actions
3. For clicks, always try to provide a BoundingBox that tightly encloses the target element — this is much more accurate than point coordinates. Estimate the element''s edges in the 0-1000 coordinate space. Only fall back to X/Y if you truly cannot determine the bounds
4. After clicking an input field, use Type to enter text
5. Use Keypress for keyboard shortcuts and form submission (e.g., "Enter")
6. If the page needs to load, use Wait with an appropriate duration
7. If you need to scroll to see more content, use Scroll
8. Keep your action list focused — do one logical step at a time
9. If available tools can accomplish a sub-task, prefer calling the tool over manual browser interaction
'
SET
  @Priority_5adc4981 = 1
SET
  @IsActive_5adc4981 = 1
EXEC [${flyway:defaultSchema}].spCreateTemplateContent @ID = @ID_5adc4981,
  @TemplateID = @TemplateID_5adc4981,
  @TypeID = @TypeID_5adc4981,
  @TemplateText = @TemplateText_5adc4981,
  @Priority = @Priority_5adc4981,
  @IsActive = @IsActive_5adc4981;

-- Save MJ: Template Contents (core SP call only)
DECLARE @ID_ce9711f8 UNIQUEIDENTIFIER,
@TemplateID_ce9711f8 UNIQUEIDENTIFIER,
@TypeID_ce9711f8 UNIQUEIDENTIFIER,
@TemplateText_ce9711f8 NVARCHAR(MAX),
@Priority_ce9711f8 INT,
@IsActive_ce9711f8 BIT
SET
  @ID_ce9711f8 = '1e4fa7d7-97ad-4a3b-919d-08905a936741'
SET
  @TemplateID_ce9711f8 = '022FCA9F-5EA9-4E7E-8FF7-BBEF4365CD2A'
SET
  @TypeID_ce9711f8 = 'E7AFCCEC-6A37-EF11-86D4-000D3A4E707E'
SET
  @TemplateText_ce9711f8 = N'You are a judge evaluating whether a browser automation agent has accomplished its goal.

## Your Task
Analyze the current screenshot and step history to determine if the goal has been achieved.

## Goal
{{ goal }}

## Step History
{{ stepSummary }}

## Current State
- Step: {{ stepNumber }} of {{ maxSteps }}
- Current URL: {{ currentUrl }}

## Visual Context
- The current browser screenshot is attached as the final image.
- If recent screenshot history is available, earlier screenshots are attached in chronological order (oldest first) before the current one. Use these to assess visual progression.

## Instructions
1. Carefully examine the current screenshot (and screenshot history if provided)
2. Compare the visible state against the stated goal
3. Consider both the step history and visual progression — is the agent making progress or stuck?
4. If the goal is partially complete, provide specific feedback on what remains
5. Determine if the goal is **impossible** to accomplish given the current state (see below)

## Response Format
Respond with ONLY a JSON object (no other text):

**Goal accomplished:**
```json
{
  "done": true,
  "impossible": false,
  "confidence": 0.95,
  "reason": "The goal has been accomplished — [specific evidence]",
  "feedback": ""
}
```

**Goal not yet accomplished but still achievable:**
```json
{
  "done": false,
  "impossible": false,
  "confidence": 0.7,
  "reason": "The agent is making progress but has not yet completed [specific remaining work]",
  "feedback": "Specific guidance on what the agent should do next"
}
```

**Goal is impossible to accomplish:**
```json
{
  "done": false,
  "impossible": true,
  "confidence": 0.9,
  "reason": "The goal cannot be accomplished because [specific blocker]",
  "feedback": ""
}
```

## Field Definitions
- **"done"**: `true` ONLY if the goal is fully accomplished and visible on screen
- **"impossible"**: `true` when you are confident the goal **cannot** be accomplished regardless of what actions the agent takes. Set this when you observe:
  - Access denied / permission errors that the agent cannot resolve
  - The target page, element, or feature does not exist
  - The agent is stuck in an unrecoverable loop (same actions, same results, no progress)
  - A prerequisite is missing that the agent has no way to fulfill
  - An error message on screen indicates a permanent failure (not a transient/retryable error)
  - The agent has tried multiple distinct approaches and all have failed
- **"confidence"**: how certain you are (0.0 = guessing, 1.0 = absolutely certain)
- **"reason"**: concise explanation of what you see and why you reached your verdict
- **"feedback"**: if not done and not impossible, specific guidance on what the agent should do next. Empty string if done or impossible.

**Important:** Be conservative with `"impossible": true`. Only use it when you are genuinely confident there is no path forward. If the agent has only tried one approach and it failed, suggest an alternative approach instead. Reserve impossibility for situations where all reasonable paths are clearly blocked.
'
SET
  @Priority_ce9711f8 = 1
SET
  @IsActive_ce9711f8 = 1
EXEC [${flyway:defaultSchema}].spCreateTemplateContent @ID = @ID_ce9711f8,
  @TemplateID = @TemplateID_ce9711f8,
  @TypeID = @TypeID_ce9711f8,
  @TemplateText = @TemplateText_ce9711f8,
  @Priority = @Priority_ce9711f8,
  @IsActive = @IsActive_ce9711f8;

-- Save MJ: Template Params (core SP call only)
DECLARE @ID_a59d9103 UNIQUEIDENTIFIER,
@TemplateID_a59d9103 UNIQUEIDENTIFIER,
@Name_a59d9103 NVARCHAR(255),
@Description_a59d9103 NVARCHAR(MAX),
@Type_a59d9103 NVARCHAR(20),
@DefaultValue_a59d9103 NVARCHAR(MAX),
@IsRequired_a59d9103 BIT,
@LinkedParameterName_a59d9103 NVARCHAR(255),
@LinkedParameterField_a59d9103 NVARCHAR(500),
@ExtraFilter_a59d9103 NVARCHAR(MAX),
@EntityID_a59d9103 UNIQUEIDENTIFIER,
@RecordID_a59d9103 NVARCHAR(2000),
@OrderBy_a59d9103 NVARCHAR(MAX),
@TemplateContentID_a59d9103 UNIQUEIDENTIFIER
SET
  @ID_a59d9103 = '84e1345d-0ca4-4a6f-856b-5090e2a9a9bc'
SET
  @TemplateID_a59d9103 = '022FCA9F-5EA9-4E7E-8FF7-BBEF4365CD2A'
SET
  @Name_a59d9103 = N'goal'
SET
  @Description_a59d9103 = N'The browser-automation goal that the agent is attempting to accomplish'
SET
  @Type_a59d9103 = N'Scalar'
SET
  @IsRequired_a59d9103 = 0
EXEC [${flyway:defaultSchema}].spCreateTemplateParam @ID = @ID_a59d9103,
  @TemplateID = @TemplateID_a59d9103,
  @Name = @Name_a59d9103,
  @Description = @Description_a59d9103,
  @Type = @Type_a59d9103,
  @DefaultValue = @DefaultValue_a59d9103,
  @IsRequired = @IsRequired_a59d9103,
  @LinkedParameterName = @LinkedParameterName_a59d9103,
  @LinkedParameterField = @LinkedParameterField_a59d9103,
  @ExtraFilter = @ExtraFilter_a59d9103,
  @EntityID = @EntityID_a59d9103,
  @RecordID = @RecordID_a59d9103,
  @OrderBy = @OrderBy_a59d9103,
  @TemplateContentID = @TemplateContentID_a59d9103;

-- Save MJ: Template Params (core SP call only)
DECLARE @ID_d3231b3a UNIQUEIDENTIFIER,
@TemplateID_d3231b3a UNIQUEIDENTIFIER,
@Name_d3231b3a NVARCHAR(255),
@Description_d3231b3a NVARCHAR(MAX),
@Type_d3231b3a NVARCHAR(20),
@DefaultValue_d3231b3a NVARCHAR(MAX),
@IsRequired_d3231b3a BIT,
@LinkedParameterName_d3231b3a NVARCHAR(255),
@LinkedParameterField_d3231b3a NVARCHAR(500),
@ExtraFilter_d3231b3a NVARCHAR(MAX),
@EntityID_d3231b3a UNIQUEIDENTIFIER,
@RecordID_d3231b3a NVARCHAR(2000),
@OrderBy_d3231b3a NVARCHAR(MAX),
@TemplateContentID_d3231b3a UNIQUEIDENTIFIER
SET
  @ID_d3231b3a = 'd98d9288-3d0c-42d7-9862-91182a3ade04'
SET
  @TemplateID_d3231b3a = '022FCA9F-5EA9-4E7E-8FF7-BBEF4365CD2A'
SET
  @Name_d3231b3a = N'stepSummary'
SET
  @Description_d3231b3a = N'Summary of the steps the agent has executed so far'
SET
  @Type_d3231b3a = N'Scalar'
SET
  @IsRequired_d3231b3a = 0
EXEC [${flyway:defaultSchema}].spCreateTemplateParam @ID = @ID_d3231b3a,
  @TemplateID = @TemplateID_d3231b3a,
  @Name = @Name_d3231b3a,
  @Description = @Description_d3231b3a,
  @Type = @Type_d3231b3a,
  @DefaultValue = @DefaultValue_d3231b3a,
  @IsRequired = @IsRequired_d3231b3a,
  @LinkedParameterName = @LinkedParameterName_d3231b3a,
  @LinkedParameterField = @LinkedParameterField_d3231b3a,
  @ExtraFilter = @ExtraFilter_d3231b3a,
  @EntityID = @EntityID_d3231b3a,
  @RecordID = @RecordID_d3231b3a,
  @OrderBy = @OrderBy_d3231b3a,
  @TemplateContentID = @TemplateContentID_d3231b3a;

-- Save MJ: Template Params (core SP call only)
DECLARE @ID_a060bd3d UNIQUEIDENTIFIER,
@TemplateID_a060bd3d UNIQUEIDENTIFIER,
@Name_a060bd3d NVARCHAR(255),
@Description_a060bd3d NVARCHAR(MAX),
@Type_a060bd3d NVARCHAR(20),
@DefaultValue_a060bd3d NVARCHAR(MAX),
@IsRequired_a060bd3d BIT,
@LinkedParameterName_a060bd3d NVARCHAR(255),
@LinkedParameterField_a060bd3d NVARCHAR(500),
@ExtraFilter_a060bd3d NVARCHAR(MAX),
@EntityID_a060bd3d UNIQUEIDENTIFIER,
@RecordID_a060bd3d NVARCHAR(2000),
@OrderBy_a060bd3d NVARCHAR(MAX),
@TemplateContentID_a060bd3d UNIQUEIDENTIFIER
SET
  @ID_a060bd3d = '48c082a9-c07f-476d-a589-1cb1a3ca9a27'
SET
  @TemplateID_a060bd3d = '022FCA9F-5EA9-4E7E-8FF7-BBEF4365CD2A'
SET
  @Name_a060bd3d = N'stepNumber'
SET
  @Description_a060bd3d = N'Current step index in the agent’s execution'
SET
  @Type_a060bd3d = N'Scalar'
SET
  @IsRequired_a060bd3d = 0
EXEC [${flyway:defaultSchema}].spCreateTemplateParam @ID = @ID_a060bd3d,
  @TemplateID = @TemplateID_a060bd3d,
  @Name = @Name_a060bd3d,
  @Description = @Description_a060bd3d,
  @Type = @Type_a060bd3d,
  @DefaultValue = @DefaultValue_a060bd3d,
  @IsRequired = @IsRequired_a060bd3d,
  @LinkedParameterName = @LinkedParameterName_a060bd3d,
  @LinkedParameterField = @LinkedParameterField_a060bd3d,
  @ExtraFilter = @ExtraFilter_a060bd3d,
  @EntityID = @EntityID_a060bd3d,
  @RecordID = @RecordID_a060bd3d,
  @OrderBy = @OrderBy_a060bd3d,
  @TemplateContentID = @TemplateContentID_a060bd3d;

-- Save MJ: Template Params (core SP call only)
DECLARE @ID_353bd1f7 UNIQUEIDENTIFIER,
@TemplateID_353bd1f7 UNIQUEIDENTIFIER,
@Name_353bd1f7 NVARCHAR(255),
@Description_353bd1f7 NVARCHAR(MAX),
@Type_353bd1f7 NVARCHAR(20),
@DefaultValue_353bd1f7 NVARCHAR(MAX),
@IsRequired_353bd1f7 BIT,
@LinkedParameterName_353bd1f7 NVARCHAR(255),
@LinkedParameterField_353bd1f7 NVARCHAR(500),
@ExtraFilter_353bd1f7 NVARCHAR(MAX),
@EntityID_353bd1f7 UNIQUEIDENTIFIER,
@RecordID_353bd1f7 NVARCHAR(2000),
@OrderBy_353bd1f7 NVARCHAR(MAX),
@TemplateContentID_353bd1f7 UNIQUEIDENTIFIER
SET
  @ID_353bd1f7 = '705fa3b9-ea14-4ccc-9dff-954036ff9cde'
SET
  @TemplateID_353bd1f7 = '022FCA9F-5EA9-4E7E-8FF7-BBEF4365CD2A'
SET
  @Name_353bd1f7 = N'maxSteps'
SET
  @Description_353bd1f7 = N'Maximum number of steps the agent is allowed to take'
SET
  @Type_353bd1f7 = N'Scalar'
SET
  @IsRequired_353bd1f7 = 0
EXEC [${flyway:defaultSchema}].spCreateTemplateParam @ID = @ID_353bd1f7,
  @TemplateID = @TemplateID_353bd1f7,
  @Name = @Name_353bd1f7,
  @Description = @Description_353bd1f7,
  @Type = @Type_353bd1f7,
  @DefaultValue = @DefaultValue_353bd1f7,
  @IsRequired = @IsRequired_353bd1f7,
  @LinkedParameterName = @LinkedParameterName_353bd1f7,
  @LinkedParameterField = @LinkedParameterField_353bd1f7,
  @ExtraFilter = @ExtraFilter_353bd1f7,
  @EntityID = @EntityID_353bd1f7,
  @RecordID = @RecordID_353bd1f7,
  @OrderBy = @OrderBy_353bd1f7,
  @TemplateContentID = @TemplateContentID_353bd1f7;

-- Save MJ: Template Params (core SP call only)
DECLARE @ID_3157bc53 UNIQUEIDENTIFIER,
@TemplateID_3157bc53 UNIQUEIDENTIFIER,
@Name_3157bc53 NVARCHAR(255),
@Description_3157bc53 NVARCHAR(MAX),
@Type_3157bc53 NVARCHAR(20),
@DefaultValue_3157bc53 NVARCHAR(MAX),
@IsRequired_3157bc53 BIT,
@LinkedParameterName_3157bc53 NVARCHAR(255),
@LinkedParameterField_3157bc53 NVARCHAR(500),
@ExtraFilter_3157bc53 NVARCHAR(MAX),
@EntityID_3157bc53 UNIQUEIDENTIFIER,
@RecordID_3157bc53 NVARCHAR(2000),
@OrderBy_3157bc53 NVARCHAR(MAX),
@TemplateContentID_3157bc53 UNIQUEIDENTIFIER
SET
  @ID_3157bc53 = 'e5acb813-cbbe-4f80-bca7-a92c1c818d4d'
SET
  @TemplateID_3157bc53 = '022FCA9F-5EA9-4E7E-8FF7-BBEF4365CD2A'
SET
  @Name_3157bc53 = N'currentUrl'
SET
  @Description_3157bc53 = N'Current browser URL for visual context'
SET
  @Type_3157bc53 = N'Scalar'
SET
  @IsRequired_3157bc53 = 0
EXEC [${flyway:defaultSchema}].spCreateTemplateParam @ID = @ID_3157bc53,
  @TemplateID = @TemplateID_3157bc53,
  @Name = @Name_3157bc53,
  @Description = @Description_3157bc53,
  @Type = @Type_3157bc53,
  @DefaultValue = @DefaultValue_3157bc53,
  @IsRequired = @IsRequired_3157bc53,
  @LinkedParameterName = @LinkedParameterName_3157bc53,
  @LinkedParameterField = @LinkedParameterField_3157bc53,
  @ExtraFilter = @ExtraFilter_3157bc53,
  @EntityID = @EntityID_3157bc53,
  @RecordID = @RecordID_3157bc53,
  @OrderBy = @OrderBy_3157bc53,
  @TemplateContentID = @TemplateContentID_3157bc53;

-- Save MJ: AI Prompts (core SP call only)
DECLARE @ID_c3c2440a UNIQUEIDENTIFIER,
@Name_c3c2440a NVARCHAR(255),
@Description_c3c2440a NVARCHAR(MAX),
@TemplateID_c3c2440a UNIQUEIDENTIFIER,
@CategoryID_c3c2440a UNIQUEIDENTIFIER,
@TypeID_c3c2440a UNIQUEIDENTIFIER,
@Status_c3c2440a NVARCHAR(50),
@ResponseFormat_c3c2440a NVARCHAR(20),
@ModelSpecificResponseFormat_c3c2440a NVARCHAR(MAX),
@AIModelTypeID_c3c2440a UNIQUEIDENTIFIER,
@MinPowerRank_c3c2440a INT,
@SelectionStrategy_c3c2440a NVARCHAR(20),
@PowerPreference_c3c2440a NVARCHAR(20),
@ParallelizationMode_c3c2440a NVARCHAR(20),
@ParallelCount_c3c2440a INT,
@ParallelConfigParam_c3c2440a NVARCHAR(100),
@OutputType_c3c2440a NVARCHAR(50),
@OutputExample_c3c2440a NVARCHAR(MAX),
@ValidationBehavior_c3c2440a NVARCHAR(50),
@MaxRetries_c3c2440a INT,
@RetryDelayMS_c3c2440a INT,
@RetryStrategy_c3c2440a NVARCHAR(20),
@ResultSelectorPromptID_c3c2440a UNIQUEIDENTIFIER,
@EnableCaching_c3c2440a BIT,
@CacheTTLSeconds_c3c2440a INT,
@CacheMatchType_c3c2440a NVARCHAR(20),
@CacheSimilarityThreshold_c3c2440a FLOAT(53),
@CacheMustMatchModel_c3c2440a BIT,
@CacheMustMatchVendor_c3c2440a BIT,
@CacheMustMatchAgent_c3c2440a BIT,
@CacheMustMatchConfig_c3c2440a BIT,
@PromptRole_c3c2440a NVARCHAR(20),
@PromptPosition_c3c2440a NVARCHAR(20),
@Temperature_c3c2440a DECIMAL(3, 2),
@TopP_c3c2440a DECIMAL(3, 2),
@TopK_c3c2440a INT,
@MinP_c3c2440a DECIMAL(3, 2),
@FrequencyPenalty_c3c2440a DECIMAL(3, 2),
@PresencePenalty_c3c2440a DECIMAL(3, 2),
@Seed_c3c2440a INT,
@StopSequences_c3c2440a NVARCHAR(1000),
@IncludeLogProbs_c3c2440a BIT,
@TopLogProbs_c3c2440a INT,
@FailoverStrategy_c3c2440a NVARCHAR(50),
@FailoverMaxAttempts_c3c2440a INT,
@FailoverDelaySeconds_c3c2440a INT,
@FailoverModelStrategy_c3c2440a NVARCHAR(50),
@FailoverErrorScope_c3c2440a NVARCHAR(50),
@EffortLevel_c3c2440a INT
SET
  @ID_c3c2440a = 'DAFE960C-1CDA-4612-965C-A3CD400387E6'
SET
  @Name_c3c2440a = N'Computer Use - Judge'
SET
  @Description_c3c2440a = N'System prompt for the Computer Use judge evaluator. Analyzes screenshots and step history to determine whether the browser automation agent has accomplished its stated goal. Returns a structured JSON verdict with done/confidence/reason/feedback fields.'
SET
  @TemplateID_c3c2440a = '022FCA9F-5EA9-4E7E-8FF7-BBEF4365CD2A'
SET
  @CategoryID_c3c2440a = '7D2DEF7F-138F-4620-8309-33964A97A997'
SET
  @TypeID_c3c2440a = 'A6DA423E-F36B-1410-8DAC-00021F8B792E'
SET
  @Status_c3c2440a = N'Active'
SET
  @ResponseFormat_c3c2440a = N'JSON'
SET
  @MinPowerRank_c3c2440a = 0
SET
  @SelectionStrategy_c3c2440a = N'Specific'
SET
  @PowerPreference_c3c2440a = N'Highest'
SET
  @ParallelizationMode_c3c2440a = N'None'
SET
  @OutputType_c3c2440a = N'object'
SET
  @OutputExample_c3c2440a = N'{"done":false,"confidence":0.3,"reason":"The agent has navigated to the page but has not yet completed the goal.","feedback":"Try clicking on the search input field next."}'
SET
  @ValidationBehavior_c3c2440a = N'Warn'
SET
  @MaxRetries_c3c2440a = 1
SET
  @RetryDelayMS_c3c2440a = 1000
SET
  @RetryStrategy_c3c2440a = N'Fixed'
SET
  @EnableCaching_c3c2440a = 0
SET
  @CacheMatchType_c3c2440a = N'Exact'
SET
  @CacheMustMatchModel_c3c2440a = 1
SET
  @CacheMustMatchVendor_c3c2440a = 1
SET
  @CacheMustMatchAgent_c3c2440a = 0
SET
  @CacheMustMatchConfig_c3c2440a = 0
SET
  @PromptRole_c3c2440a = N'System'
SET
  @PromptPosition_c3c2440a = N'First'
SET
  @IncludeLogProbs_c3c2440a = 0
SET
  @FailoverStrategy_c3c2440a = N'SameModelDifferentVendor'
SET
  @FailoverMaxAttempts_c3c2440a = 3
SET
  @FailoverDelaySeconds_c3c2440a = 5
SET
  @FailoverModelStrategy_c3c2440a = N'PreferSameModel'
SET
  @FailoverErrorScope_c3c2440a = N'All'
EXEC [${flyway:defaultSchema}].spCreateAIPrompt @ID = @ID_c3c2440a,
  @Name = @Name_c3c2440a,
  @Description = @Description_c3c2440a,
  @TemplateID = @TemplateID_c3c2440a,
  @CategoryID = @CategoryID_c3c2440a,
  @TypeID = @TypeID_c3c2440a,
  @Status = @Status_c3c2440a,
  @ResponseFormat = @ResponseFormat_c3c2440a,
  @ModelSpecificResponseFormat = @ModelSpecificResponseFormat_c3c2440a,
  @AIModelTypeID = @AIModelTypeID_c3c2440a,
  @MinPowerRank = @MinPowerRank_c3c2440a,
  @SelectionStrategy = @SelectionStrategy_c3c2440a,
  @PowerPreference = @PowerPreference_c3c2440a,
  @ParallelizationMode = @ParallelizationMode_c3c2440a,
  @ParallelCount = @ParallelCount_c3c2440a,
  @ParallelConfigParam = @ParallelConfigParam_c3c2440a,
  @OutputType = @OutputType_c3c2440a,
  @OutputExample = @OutputExample_c3c2440a,
  @ValidationBehavior = @ValidationBehavior_c3c2440a,
  @MaxRetries = @MaxRetries_c3c2440a,
  @RetryDelayMS = @RetryDelayMS_c3c2440a,
  @RetryStrategy = @RetryStrategy_c3c2440a,
  @ResultSelectorPromptID = @ResultSelectorPromptID_c3c2440a,
  @EnableCaching = @EnableCaching_c3c2440a,
  @CacheTTLSeconds = @CacheTTLSeconds_c3c2440a,
  @CacheMatchType = @CacheMatchType_c3c2440a,
  @CacheSimilarityThreshold = @CacheSimilarityThreshold_c3c2440a,
  @CacheMustMatchModel = @CacheMustMatchModel_c3c2440a,
  @CacheMustMatchVendor = @CacheMustMatchVendor_c3c2440a,
  @CacheMustMatchAgent = @CacheMustMatchAgent_c3c2440a,
  @CacheMustMatchConfig = @CacheMustMatchConfig_c3c2440a,
  @PromptRole = @PromptRole_c3c2440a,
  @PromptPosition = @PromptPosition_c3c2440a,
  @Temperature = @Temperature_c3c2440a,
  @TopP = @TopP_c3c2440a,
  @TopK = @TopK_c3c2440a,
  @MinP = @MinP_c3c2440a,
  @FrequencyPenalty = @FrequencyPenalty_c3c2440a,
  @PresencePenalty = @PresencePenalty_c3c2440a,
  @Seed = @Seed_c3c2440a,
  @StopSequences = @StopSequences_c3c2440a,
  @IncludeLogProbs = @IncludeLogProbs_c3c2440a,
  @TopLogProbs = @TopLogProbs_c3c2440a,
  @FailoverStrategy = @FailoverStrategy_c3c2440a,
  @FailoverMaxAttempts = @FailoverMaxAttempts_c3c2440a,
  @FailoverDelaySeconds = @FailoverDelaySeconds_c3c2440a,
  @FailoverModelStrategy = @FailoverModelStrategy_c3c2440a,
  @FailoverErrorScope = @FailoverErrorScope_c3c2440a,
  @EffortLevel = @EffortLevel_c3c2440a;

-- Save MJ: Template Params (core SP call only)
DECLARE @ID_78625134 UNIQUEIDENTIFIER,
@TemplateID_78625134 UNIQUEIDENTIFIER,
@Name_78625134 NVARCHAR(255),
@Description_78625134 NVARCHAR(MAX),
@Type_78625134 NVARCHAR(20),
@DefaultValue_78625134 NVARCHAR(MAX),
@IsRequired_78625134 BIT,
@LinkedParameterName_78625134 NVARCHAR(255),
@LinkedParameterField_78625134 NVARCHAR(500),
@ExtraFilter_78625134 NVARCHAR(MAX),
@EntityID_78625134 UNIQUEIDENTIFIER,
@RecordID_78625134 NVARCHAR(2000),
@OrderBy_78625134 NVARCHAR(MAX),
@TemplateContentID_78625134 UNIQUEIDENTIFIER
SET
  @ID_78625134 = '915667cb-c18b-45e2-a764-16fcd9dcde67'
SET
  @TemplateID_78625134 = 'EBBE0B44-6A44-4F4D-B426-3DA257CD6B1D'
SET
  @Name_78625134 = N'goal'
SET
  @Description_78625134 = N'The browser automation goal to accomplish'
SET
  @Type_78625134 = N'Scalar'
SET
  @IsRequired_78625134 = 0
EXEC [${flyway:defaultSchema}].spCreateTemplateParam @ID = @ID_78625134,
  @TemplateID = @TemplateID_78625134,
  @Name = @Name_78625134,
  @Description = @Description_78625134,
  @Type = @Type_78625134,
  @DefaultValue = @DefaultValue_78625134,
  @IsRequired = @IsRequired_78625134,
  @LinkedParameterName = @LinkedParameterName_78625134,
  @LinkedParameterField = @LinkedParameterField_78625134,
  @ExtraFilter = @ExtraFilter_78625134,
  @EntityID = @EntityID_78625134,
  @RecordID = @RecordID_78625134,
  @OrderBy = @OrderBy_78625134,
  @TemplateContentID = @TemplateContentID_78625134;

-- Save MJ: Template Params (core SP call only)
DECLARE @ID_2c1068b6 UNIQUEIDENTIFIER,
@TemplateID_2c1068b6 UNIQUEIDENTIFIER,
@Name_2c1068b6 NVARCHAR(255),
@Description_2c1068b6 NVARCHAR(MAX),
@Type_2c1068b6 NVARCHAR(20),
@DefaultValue_2c1068b6 NVARCHAR(MAX),
@IsRequired_2c1068b6 BIT,
@LinkedParameterName_2c1068b6 NVARCHAR(255),
@LinkedParameterField_2c1068b6 NVARCHAR(500),
@ExtraFilter_2c1068b6 NVARCHAR(MAX),
@EntityID_2c1068b6 UNIQUEIDENTIFIER,
@RecordID_2c1068b6 NVARCHAR(2000),
@OrderBy_2c1068b6 NVARCHAR(MAX),
@TemplateContentID_2c1068b6 UNIQUEIDENTIFIER
SET
  @ID_2c1068b6 = 'dad41572-2982-4a05-8384-79360e88dabd'
SET
  @TemplateID_2c1068b6 = 'EBBE0B44-6A44-4F4D-B426-3DA257CD6B1D'
SET
  @Name_2c1068b6 = N'stepNumber'
SET
  @Description_2c1068b6 = N'Current step number in the automation sequence'
SET
  @Type_2c1068b6 = N'Scalar'
SET
  @IsRequired_2c1068b6 = 0
EXEC [${flyway:defaultSchema}].spCreateTemplateParam @ID = @ID_2c1068b6,
  @TemplateID = @TemplateID_2c1068b6,
  @Name = @Name_2c1068b6,
  @Description = @Description_2c1068b6,
  @Type = @Type_2c1068b6,
  @DefaultValue = @DefaultValue_2c1068b6,
  @IsRequired = @IsRequired_2c1068b6,
  @LinkedParameterName = @LinkedParameterName_2c1068b6,
  @LinkedParameterField = @LinkedParameterField_2c1068b6,
  @ExtraFilter = @ExtraFilter_2c1068b6,
  @EntityID = @EntityID_2c1068b6,
  @RecordID = @RecordID_2c1068b6,
  @OrderBy = @OrderBy_2c1068b6,
  @TemplateContentID = @TemplateContentID_2c1068b6;

-- Save MJ: Template Params (core SP call only)
DECLARE @ID_431af877 UNIQUEIDENTIFIER,
@TemplateID_431af877 UNIQUEIDENTIFIER,
@Name_431af877 NVARCHAR(255),
@Description_431af877 NVARCHAR(MAX),
@Type_431af877 NVARCHAR(20),
@DefaultValue_431af877 NVARCHAR(MAX),
@IsRequired_431af877 BIT,
@LinkedParameterName_431af877 NVARCHAR(255),
@LinkedParameterField_431af877 NVARCHAR(500),
@ExtraFilter_431af877 NVARCHAR(MAX),
@EntityID_431af877 UNIQUEIDENTIFIER,
@RecordID_431af877 NVARCHAR(2000),
@OrderBy_431af877 NVARCHAR(MAX),
@TemplateContentID_431af877 UNIQUEIDENTIFIER
SET
  @ID_431af877 = '14d5d35b-2a7b-4b94-88cd-99ae787f64dc'
SET
  @TemplateID_431af877 = 'EBBE0B44-6A44-4F4D-B426-3DA257CD6B1D'
SET
  @Name_431af877 = N'maxSteps'
SET
  @Description_431af877 = N'Maximum number of steps allowed for the automation'
SET
  @Type_431af877 = N'Scalar'
SET
  @IsRequired_431af877 = 0
EXEC [${flyway:defaultSchema}].spCreateTemplateParam @ID = @ID_431af877,
  @TemplateID = @TemplateID_431af877,
  @Name = @Name_431af877,
  @Description = @Description_431af877,
  @Type = @Type_431af877,
  @DefaultValue = @DefaultValue_431af877,
  @IsRequired = @IsRequired_431af877,
  @LinkedParameterName = @LinkedParameterName_431af877,
  @LinkedParameterField = @LinkedParameterField_431af877,
  @ExtraFilter = @ExtraFilter_431af877,
  @EntityID = @EntityID_431af877,
  @RecordID = @RecordID_431af877,
  @OrderBy = @OrderBy_431af877,
  @TemplateContentID = @TemplateContentID_431af877;

-- Save MJ: Template Params (core SP call only)
DECLARE @ID_646d9b9d UNIQUEIDENTIFIER,
@TemplateID_646d9b9d UNIQUEIDENTIFIER,
@Name_646d9b9d NVARCHAR(255),
@Description_646d9b9d NVARCHAR(MAX),
@Type_646d9b9d NVARCHAR(20),
@DefaultValue_646d9b9d NVARCHAR(MAX),
@IsRequired_646d9b9d BIT,
@LinkedParameterName_646d9b9d NVARCHAR(255),
@LinkedParameterField_646d9b9d NVARCHAR(500),
@ExtraFilter_646d9b9d NVARCHAR(MAX),
@EntityID_646d9b9d UNIQUEIDENTIFIER,
@RecordID_646d9b9d NVARCHAR(2000),
@OrderBy_646d9b9d NVARCHAR(MAX),
@TemplateContentID_646d9b9d UNIQUEIDENTIFIER
SET
  @ID_646d9b9d = 'f88b1caa-0643-4bb4-b677-138db2dd177c'
SET
  @TemplateID_646d9b9d = 'EBBE0B44-6A44-4F4D-B426-3DA257CD6B1D'
SET
  @Name_646d9b9d = N'currentUrl'
SET
  @Description_646d9b9d = N'Current browser URL'
SET
  @Type_646d9b9d = N'Scalar'
SET
  @IsRequired_646d9b9d = 0
EXEC [${flyway:defaultSchema}].spCreateTemplateParam @ID = @ID_646d9b9d,
  @TemplateID = @TemplateID_646d9b9d,
  @Name = @Name_646d9b9d,
  @Description = @Description_646d9b9d,
  @Type = @Type_646d9b9d,
  @DefaultValue = @DefaultValue_646d9b9d,
  @IsRequired = @IsRequired_646d9b9d,
  @LinkedParameterName = @LinkedParameterName_646d9b9d,
  @LinkedParameterField = @LinkedParameterField_646d9b9d,
  @ExtraFilter = @ExtraFilter_646d9b9d,
  @EntityID = @EntityID_646d9b9d,
  @RecordID = @RecordID_646d9b9d,
  @OrderBy = @OrderBy_646d9b9d,
  @TemplateContentID = @TemplateContentID_646d9b9d;

-- Save MJ: Template Params (core SP call only)
DECLARE @ID_ace0656e UNIQUEIDENTIFIER,
@TemplateID_ace0656e UNIQUEIDENTIFIER,
@Name_ace0656e NVARCHAR(255),
@Description_ace0656e NVARCHAR(MAX),
@Type_ace0656e NVARCHAR(20),
@DefaultValue_ace0656e NVARCHAR(MAX),
@IsRequired_ace0656e BIT,
@LinkedParameterName_ace0656e NVARCHAR(255),
@LinkedParameterField_ace0656e NVARCHAR(500),
@ExtraFilter_ace0656e NVARCHAR(MAX),
@EntityID_ace0656e UNIQUEIDENTIFIER,
@RecordID_ace0656e NVARCHAR(2000),
@OrderBy_ace0656e NVARCHAR(MAX),
@TemplateContentID_ace0656e UNIQUEIDENTIFIER
SET
  @ID_ace0656e = 'ceb22413-2213-44bd-bfb8-c98e7c06216b'
SET
  @TemplateID_ace0656e = 'EBBE0B44-6A44-4F4D-B426-3DA257CD6B1D'
SET
  @Name_ace0656e = N'toolDefinitions'
SET
  @Description_ace0656e = N'List of available tool definitions with name, description, and input schema'
SET
  @Type_ace0656e = N'Array'
SET
  @IsRequired_ace0656e = 0
EXEC [${flyway:defaultSchema}].spCreateTemplateParam @ID = @ID_ace0656e,
  @TemplateID = @TemplateID_ace0656e,
  @Name = @Name_ace0656e,
  @Description = @Description_ace0656e,
  @Type = @Type_ace0656e,
  @DefaultValue = @DefaultValue_ace0656e,
  @IsRequired = @IsRequired_ace0656e,
  @LinkedParameterName = @LinkedParameterName_ace0656e,
  @LinkedParameterField = @LinkedParameterField_ace0656e,
  @ExtraFilter = @ExtraFilter_ace0656e,
  @EntityID = @EntityID_ace0656e,
  @RecordID = @RecordID_ace0656e,
  @OrderBy = @OrderBy_ace0656e,
  @TemplateContentID = @TemplateContentID_ace0656e;

-- Save MJ: Template Params (core SP call only)
DECLARE @ID_e1112545 UNIQUEIDENTIFIER,
@TemplateID_e1112545 UNIQUEIDENTIFIER,
@Name_e1112545 NVARCHAR(255),
@Description_e1112545 NVARCHAR(MAX),
@Type_e1112545 NVARCHAR(20),
@DefaultValue_e1112545 NVARCHAR(MAX),
@IsRequired_e1112545 BIT,
@LinkedParameterName_e1112545 NVARCHAR(255),
@LinkedParameterField_e1112545 NVARCHAR(500),
@ExtraFilter_e1112545 NVARCHAR(MAX),
@EntityID_e1112545 UNIQUEIDENTIFIER,
@RecordID_e1112545 NVARCHAR(2000),
@OrderBy_e1112545 NVARCHAR(MAX),
@TemplateContentID_e1112545 UNIQUEIDENTIFIER
SET
  @ID_e1112545 = '3de5f12f-8bfd-4ef4-abb5-1c161c0aa3d2'
SET
  @TemplateID_e1112545 = 'EBBE0B44-6A44-4F4D-B426-3DA257CD6B1D'
SET
  @Name_e1112545 = N'formLoginCredentials'
SET
  @Description_e1112545 = N'Login credentials object containing domain, username, and password'
SET
  @Type_e1112545 = N'Object'
SET
  @IsRequired_e1112545 = 0
EXEC [${flyway:defaultSchema}].spCreateTemplateParam @ID = @ID_e1112545,
  @TemplateID = @TemplateID_e1112545,
  @Name = @Name_e1112545,
  @Description = @Description_e1112545,
  @Type = @Type_e1112545,
  @DefaultValue = @DefaultValue_e1112545,
  @IsRequired = @IsRequired_e1112545,
  @LinkedParameterName = @LinkedParameterName_e1112545,
  @LinkedParameterField = @LinkedParameterField_e1112545,
  @ExtraFilter = @ExtraFilter_e1112545,
  @EntityID = @EntityID_e1112545,
  @RecordID = @RecordID_e1112545,
  @OrderBy = @OrderBy_e1112545,
  @TemplateContentID = @TemplateContentID_e1112545;

-- Save MJ: Template Params (core SP call only)
DECLARE @ID_2cdab08d UNIQUEIDENTIFIER,
@TemplateID_2cdab08d UNIQUEIDENTIFIER,
@Name_2cdab08d NVARCHAR(255),
@Description_2cdab08d NVARCHAR(MAX),
@Type_2cdab08d NVARCHAR(20),
@DefaultValue_2cdab08d NVARCHAR(MAX),
@IsRequired_2cdab08d BIT,
@LinkedParameterName_2cdab08d NVARCHAR(255),
@LinkedParameterField_2cdab08d NVARCHAR(500),
@ExtraFilter_2cdab08d NVARCHAR(MAX),
@EntityID_2cdab08d UNIQUEIDENTIFIER,
@RecordID_2cdab08d NVARCHAR(2000),
@OrderBy_2cdab08d NVARCHAR(MAX),
@TemplateContentID_2cdab08d UNIQUEIDENTIFIER
SET
  @ID_2cdab08d = 'ffb37f6a-59c7-441e-8e48-f628d1117c19'
SET
  @TemplateID_2cdab08d = 'EBBE0B44-6A44-4F4D-B426-3DA257CD6B1D'
SET
  @Name_2cdab08d = N'judgeFeedback'
SET
  @Description_2cdab08d = N'Feedback from previous evaluation to consider'
SET
  @Type_2cdab08d = N'Scalar'
SET
  @IsRequired_2cdab08d = 0
EXEC [${flyway:defaultSchema}].spCreateTemplateParam @ID = @ID_2cdab08d,
  @TemplateID = @TemplateID_2cdab08d,
  @Name = @Name_2cdab08d,
  @Description = @Description_2cdab08d,
  @Type = @Type_2cdab08d,
  @DefaultValue = @DefaultValue_2cdab08d,
  @IsRequired = @IsRequired_2cdab08d,
  @LinkedParameterName = @LinkedParameterName_2cdab08d,
  @LinkedParameterField = @LinkedParameterField_2cdab08d,
  @ExtraFilter = @ExtraFilter_2cdab08d,
  @EntityID = @EntityID_2cdab08d,
  @RecordID = @RecordID_2cdab08d,
  @OrderBy = @OrderBy_2cdab08d,
  @TemplateContentID = @TemplateContentID_2cdab08d;

-- Save MJ: Template Params (core SP call only)
DECLARE @ID_014a7046 UNIQUEIDENTIFIER,
@TemplateID_014a7046 UNIQUEIDENTIFIER,
@Name_014a7046 NVARCHAR(255),
@Description_014a7046 NVARCHAR(MAX),
@Type_014a7046 NVARCHAR(20),
@DefaultValue_014a7046 NVARCHAR(MAX),
@IsRequired_014a7046 BIT,
@LinkedParameterName_014a7046 NVARCHAR(255),
@LinkedParameterField_014a7046 NVARCHAR(500),
@ExtraFilter_014a7046 NVARCHAR(MAX),
@EntityID_014a7046 UNIQUEIDENTIFIER,
@RecordID_014a7046 NVARCHAR(2000),
@OrderBy_014a7046 NVARCHAR(MAX),
@TemplateContentID_014a7046 UNIQUEIDENTIFIER
SET
  @ID_014a7046 = '6a7fde58-12bf-4992-8e3e-a878bed34c43'
SET
  @TemplateID_014a7046 = 'EBBE0B44-6A44-4F4D-B426-3DA257CD6B1D'
SET
  @Name_014a7046 = N'previousStepSummary'
SET
  @Description_014a7046 = N'Summary of previous actions taken'
SET
  @Type_014a7046 = N'Scalar'
SET
  @IsRequired_014a7046 = 0
EXEC [${flyway:defaultSchema}].spCreateTemplateParam @ID = @ID_014a7046,
  @TemplateID = @TemplateID_014a7046,
  @Name = @Name_014a7046,
  @Description = @Description_014a7046,
  @Type = @Type_014a7046,
  @DefaultValue = @DefaultValue_014a7046,
  @IsRequired = @IsRequired_014a7046,
  @LinkedParameterName = @LinkedParameterName_014a7046,
  @LinkedParameterField = @LinkedParameterField_014a7046,
  @ExtraFilter = @ExtraFilter_014a7046,
  @EntityID = @EntityID_014a7046,
  @RecordID = @RecordID_014a7046,
  @OrderBy = @OrderBy_014a7046,
  @TemplateContentID = @TemplateContentID_014a7046;

-- Save MJ: AI Prompts (core SP call only)
DECLARE @ID_7ef35eab UNIQUEIDENTIFIER,
@Name_7ef35eab NVARCHAR(255),
@Description_7ef35eab NVARCHAR(MAX),
@TemplateID_7ef35eab UNIQUEIDENTIFIER,
@CategoryID_7ef35eab UNIQUEIDENTIFIER,
@TypeID_7ef35eab UNIQUEIDENTIFIER,
@Status_7ef35eab NVARCHAR(50),
@ResponseFormat_7ef35eab NVARCHAR(20),
@ModelSpecificResponseFormat_7ef35eab NVARCHAR(MAX),
@AIModelTypeID_7ef35eab UNIQUEIDENTIFIER,
@MinPowerRank_7ef35eab INT,
@SelectionStrategy_7ef35eab NVARCHAR(20),
@PowerPreference_7ef35eab NVARCHAR(20),
@ParallelizationMode_7ef35eab NVARCHAR(20),
@ParallelCount_7ef35eab INT,
@ParallelConfigParam_7ef35eab NVARCHAR(100),
@OutputType_7ef35eab NVARCHAR(50),
@OutputExample_7ef35eab NVARCHAR(MAX),
@ValidationBehavior_7ef35eab NVARCHAR(50),
@MaxRetries_7ef35eab INT,
@RetryDelayMS_7ef35eab INT,
@RetryStrategy_7ef35eab NVARCHAR(20),
@ResultSelectorPromptID_7ef35eab UNIQUEIDENTIFIER,
@EnableCaching_7ef35eab BIT,
@CacheTTLSeconds_7ef35eab INT,
@CacheMatchType_7ef35eab NVARCHAR(20),
@CacheSimilarityThreshold_7ef35eab FLOAT(53),
@CacheMustMatchModel_7ef35eab BIT,
@CacheMustMatchVendor_7ef35eab BIT,
@CacheMustMatchAgent_7ef35eab BIT,
@CacheMustMatchConfig_7ef35eab BIT,
@PromptRole_7ef35eab NVARCHAR(20),
@PromptPosition_7ef35eab NVARCHAR(20),
@Temperature_7ef35eab DECIMAL(3, 2),
@TopP_7ef35eab DECIMAL(3, 2),
@TopK_7ef35eab INT,
@MinP_7ef35eab DECIMAL(3, 2),
@FrequencyPenalty_7ef35eab DECIMAL(3, 2),
@PresencePenalty_7ef35eab DECIMAL(3, 2),
@Seed_7ef35eab INT,
@StopSequences_7ef35eab NVARCHAR(1000),
@IncludeLogProbs_7ef35eab BIT,
@TopLogProbs_7ef35eab INT,
@FailoverStrategy_7ef35eab NVARCHAR(50),
@FailoverMaxAttempts_7ef35eab INT,
@FailoverDelaySeconds_7ef35eab INT,
@FailoverModelStrategy_7ef35eab NVARCHAR(50),
@FailoverErrorScope_7ef35eab NVARCHAR(50),
@EffortLevel_7ef35eab INT
SET
  @ID_7ef35eab = '35FF7A4B-B64A-4052-AD78-9DA8FBCF021A'
SET
  @Name_7ef35eab = N'Computer Use - Controller'
SET
  @Description_7ef35eab = N'System prompt for the Computer Use browser automation controller. Instructs the LLM to analyze screenshots of a web browser and decide what actions to take (click, type, navigate, scroll, etc.) to accomplish a stated goal. Outputs structured JSON with reasoning, actions, and optional tool calls.'
SET
  @TemplateID_7ef35eab = 'EBBE0B44-6A44-4F4D-B426-3DA257CD6B1D'
SET
  @CategoryID_7ef35eab = '7D2DEF7F-138F-4620-8309-33964A97A997'
SET
  @TypeID_7ef35eab = 'A6DA423E-F36B-1410-8DAC-00021F8B792E'
SET
  @Status_7ef35eab = N'Active'
SET
  @ResponseFormat_7ef35eab = N'JSON'
SET
  @MinPowerRank_7ef35eab = 0
SET
  @SelectionStrategy_7ef35eab = N'Specific'
SET
  @PowerPreference_7ef35eab = N'Highest'
SET
  @ParallelizationMode_7ef35eab = N'None'
SET
  @OutputType_7ef35eab = N'object'
SET
  @OutputExample_7ef35eab = N'{"reasoning":"The page has loaded and I can see the text editor area. I will click on it to focus it.","actions":[{"Type":"Click","BoundingBox":{"XMin":100,"YMin":200,"XMax":900,"YMax":600}}],"toolCalls":[]}'
SET
  @ValidationBehavior_7ef35eab = N'Warn'
SET
  @MaxRetries_7ef35eab = 1
SET
  @RetryDelayMS_7ef35eab = 1000
SET
  @RetryStrategy_7ef35eab = N'Fixed'
SET
  @EnableCaching_7ef35eab = 0
SET
  @CacheMatchType_7ef35eab = N'Exact'
SET
  @CacheMustMatchModel_7ef35eab = 1
SET
  @CacheMustMatchVendor_7ef35eab = 1
SET
  @CacheMustMatchAgent_7ef35eab = 0
SET
  @CacheMustMatchConfig_7ef35eab = 0
SET
  @PromptRole_7ef35eab = N'System'
SET
  @PromptPosition_7ef35eab = N'First'
SET
  @IncludeLogProbs_7ef35eab = 0
SET
  @FailoverStrategy_7ef35eab = N'SameModelDifferentVendor'
SET
  @FailoverMaxAttempts_7ef35eab = 3
SET
  @FailoverDelaySeconds_7ef35eab = 5
SET
  @FailoverModelStrategy_7ef35eab = N'PreferSameModel'
SET
  @FailoverErrorScope_7ef35eab = N'All'
EXEC [${flyway:defaultSchema}].spCreateAIPrompt @ID = @ID_7ef35eab,
  @Name = @Name_7ef35eab,
  @Description = @Description_7ef35eab,
  @TemplateID = @TemplateID_7ef35eab,
  @CategoryID = @CategoryID_7ef35eab,
  @TypeID = @TypeID_7ef35eab,
  @Status = @Status_7ef35eab,
  @ResponseFormat = @ResponseFormat_7ef35eab,
  @ModelSpecificResponseFormat = @ModelSpecificResponseFormat_7ef35eab,
  @AIModelTypeID = @AIModelTypeID_7ef35eab,
  @MinPowerRank = @MinPowerRank_7ef35eab,
  @SelectionStrategy = @SelectionStrategy_7ef35eab,
  @PowerPreference = @PowerPreference_7ef35eab,
  @ParallelizationMode = @ParallelizationMode_7ef35eab,
  @ParallelCount = @ParallelCount_7ef35eab,
  @ParallelConfigParam = @ParallelConfigParam_7ef35eab,
  @OutputType = @OutputType_7ef35eab,
  @OutputExample = @OutputExample_7ef35eab,
  @ValidationBehavior = @ValidationBehavior_7ef35eab,
  @MaxRetries = @MaxRetries_7ef35eab,
  @RetryDelayMS = @RetryDelayMS_7ef35eab,
  @RetryStrategy = @RetryStrategy_7ef35eab,
  @ResultSelectorPromptID = @ResultSelectorPromptID_7ef35eab,
  @EnableCaching = @EnableCaching_7ef35eab,
  @CacheTTLSeconds = @CacheTTLSeconds_7ef35eab,
  @CacheMatchType = @CacheMatchType_7ef35eab,
  @CacheSimilarityThreshold = @CacheSimilarityThreshold_7ef35eab,
  @CacheMustMatchModel = @CacheMustMatchModel_7ef35eab,
  @CacheMustMatchVendor = @CacheMustMatchVendor_7ef35eab,
  @CacheMustMatchAgent = @CacheMustMatchAgent_7ef35eab,
  @CacheMustMatchConfig = @CacheMustMatchConfig_7ef35eab,
  @PromptRole = @PromptRole_7ef35eab,
  @PromptPosition = @PromptPosition_7ef35eab,
  @Temperature = @Temperature_7ef35eab,
  @TopP = @TopP_7ef35eab,
  @TopK = @TopK_7ef35eab,
  @MinP = @MinP_7ef35eab,
  @FrequencyPenalty = @FrequencyPenalty_7ef35eab,
  @PresencePenalty = @PresencePenalty_7ef35eab,
  @Seed = @Seed_7ef35eab,
  @StopSequences = @StopSequences_7ef35eab,
  @IncludeLogProbs = @IncludeLogProbs_7ef35eab,
  @TopLogProbs = @TopLogProbs_7ef35eab,
  @FailoverStrategy = @FailoverStrategy_7ef35eab,
  @FailoverMaxAttempts = @FailoverMaxAttempts_7ef35eab,
  @FailoverDelaySeconds = @FailoverDelaySeconds_7ef35eab,
  @FailoverModelStrategy = @FailoverModelStrategy_7ef35eab,
  @FailoverErrorScope = @FailoverErrorScope_7ef35eab,
  @EffortLevel = @EffortLevel_7ef35eab;

-- Save MJ: AI Prompt Models (core SP call only)
DECLARE @ID_d85aa8d4 UNIQUEIDENTIFIER,
@PromptID_d85aa8d4 UNIQUEIDENTIFIER,
@ModelID_d85aa8d4 UNIQUEIDENTIFIER,
@VendorID_d85aa8d4 UNIQUEIDENTIFIER,
@ConfigurationID_d85aa8d4 UNIQUEIDENTIFIER,
@Priority_d85aa8d4 INT,
@ExecutionGroup_d85aa8d4 INT,
@ModelParameters_d85aa8d4 NVARCHAR(MAX),
@Status_d85aa8d4 NVARCHAR(20),
@ParallelizationMode_d85aa8d4 NVARCHAR(20),
@ParallelCount_d85aa8d4 INT,
@ParallelConfigParam_d85aa8d4 NVARCHAR(100),
@EffortLevel_d85aa8d4 INT
SET
  @ID_d85aa8d4 = '8C56B221-225D-4AA0-ADDA-6804AEAE332A'
SET
  @PromptID_d85aa8d4 = '35FF7A4B-B64A-4052-AD78-9DA8FBCF021A'
SET
  @ModelID_d85aa8d4 = '7B31F48E-EDA3-47B4-9602-D98B7EB1AF45'
SET
  @VendorID_d85aa8d4 = 'E4A5CCEC-6A37-EF11-86D4-000D3A4E707E'
SET
  @Priority_d85aa8d4 = 1
SET
  @ExecutionGroup_d85aa8d4 = 0
SET
  @Status_d85aa8d4 = N'Active'
SET
  @ParallelizationMode_d85aa8d4 = N'None'
SET
  @ParallelCount_d85aa8d4 = 1
EXEC [${flyway:defaultSchema}].spCreateAIPromptModel @ID = @ID_d85aa8d4,
  @PromptID = @PromptID_d85aa8d4,
  @ModelID = @ModelID_d85aa8d4,
  @VendorID = @VendorID_d85aa8d4,
  @ConfigurationID = @ConfigurationID_d85aa8d4,
  @Priority = @Priority_d85aa8d4,
  @ExecutionGroup = @ExecutionGroup_d85aa8d4,
  @ModelParameters = @ModelParameters_d85aa8d4,
  @Status = @Status_d85aa8d4,
  @ParallelizationMode = @ParallelizationMode_d85aa8d4,
  @ParallelCount = @ParallelCount_d85aa8d4,
  @ParallelConfigParam = @ParallelConfigParam_d85aa8d4,
  @EffortLevel = @EffortLevel_d85aa8d4;

-- Save MJ: AI Prompt Models (core SP call only)
DECLARE @ID_4dc0d175 UNIQUEIDENTIFIER,
@PromptID_4dc0d175 UNIQUEIDENTIFIER,
@ModelID_4dc0d175 UNIQUEIDENTIFIER,
@VendorID_4dc0d175 UNIQUEIDENTIFIER,
@ConfigurationID_4dc0d175 UNIQUEIDENTIFIER,
@Priority_4dc0d175 INT,
@ExecutionGroup_4dc0d175 INT,
@ModelParameters_4dc0d175 NVARCHAR(MAX),
@Status_4dc0d175 NVARCHAR(20),
@ParallelizationMode_4dc0d175 NVARCHAR(20),
@ParallelCount_4dc0d175 INT,
@ParallelConfigParam_4dc0d175 NVARCHAR(100),
@EffortLevel_4dc0d175 INT
SET
  @ID_4dc0d175 = '855B1D42-9D3D-4B2B-9AFC-A61DB0993D47'
SET
  @PromptID_4dc0d175 = 'DAFE960C-1CDA-4612-965C-A3CD400387E6'
SET
  @ModelID_4dc0d175 = '7B31F48E-EDA3-47B4-9602-D98B7EB1AF45'
SET
  @VendorID_4dc0d175 = 'E4A5CCEC-6A37-EF11-86D4-000D3A4E707E'
SET
  @Priority_4dc0d175 = 1
SET
  @ExecutionGroup_4dc0d175 = 0
SET
  @Status_4dc0d175 = N'Active'
SET
  @ParallelizationMode_4dc0d175 = N'None'
SET
  @ParallelCount_4dc0d175 = 1
EXEC [${flyway:defaultSchema}].spCreateAIPromptModel @ID = @ID_4dc0d175,
  @PromptID = @PromptID_4dc0d175,
  @ModelID = @ModelID_4dc0d175,
  @VendorID = @VendorID_4dc0d175,
  @ConfigurationID = @ConfigurationID_4dc0d175,
  @Priority = @Priority_4dc0d175,
  @ExecutionGroup = @ExecutionGroup_4dc0d175,
  @ModelParameters = @ModelParameters_4dc0d175,
  @Status = @Status_4dc0d175,
  @ParallelizationMode = @ParallelizationMode_4dc0d175,
  @ParallelCount = @ParallelCount_4dc0d175,
  @ParallelConfigParam = @ParallelConfigParam_4dc0d175,
  @EffortLevel = @EffortLevel_4dc0d175;

-- Save MJ: Template Contents (core SP call only)
DECLARE @TemplateID_d5488260 UNIQUEIDENTIFIER,
@TypeID_d5488260 UNIQUEIDENTIFIER,
@TemplateText_d5488260 NVARCHAR(MAX),
@Priority_d5488260 INT,
@IsActive_d5488260 BIT,
@ID_d5488260 UNIQUEIDENTIFIER
SET
  @TemplateID_d5488260 = 'F9F16E70-2C65-46E7-86FC-D9D3026D36E1'
SET
  @TypeID_d5488260 = 'E7AFCCEC-6A37-EF11-86D4-000D3A4E707E'
SET
  @TemplateText_d5488260 = N'# Query Strategist

You are the **Query Strategist**, a technical sub-agent of the Query Builder. Your job is to translate business requirements into optimized SQL queries, test them, and return structured results to your parent agent.

## CRITICAL: You Are a SUB-AGENT

You are NOT talking to the end user directly. Your chat messages go to the **Query Builder** parent agent, which relays them to the user. You must:

- **NEVER set `terminate: true`** — always return control to the parent agent
- **NEVER complete the conversation** — the parent decides when the conversation ends
- **ALWAYS return your results in the exact payload format specified below**

## CRITICAL: `message` vs `payloadChangeRequest`

You have two output channels. Understand the difference:

- **`message`**: A short text summary of what you did in this pass. The parent agent relays this to the user. Keep it to 1-2 sentences. Example: `"Queried agent runs for the last 30 days, grouped by agent. Found 5 agents with varying activity levels."`
- **`payloadChangeRequest`**: The structured payload change. **ALL plan content, data, and SQL go here — NEVER in `message`.** Remember to use the `replaceElements` wrapper as described in your system prompt — putting data directly in `payloadChangeRequest` without an operation wrapper will silently fail.

## Deciding What To Do

**Read the parent''s message carefully to determine where you are in the workflow:**

1. **New request** (no prior plan mentioned):
   a. Start at Step 1 (Explore the schema)
   b. Assess complexity (see below)
   c. If **simple** → proceed directly through Steps 1 → 3 → 4 → 5 in one pass (skip Step 2)
   d. If **complex/ambiguous** → go to Step 2 (present plan for user approval via payload), then wait

2. **Plan approved** (parent says "looks good", "go ahead", "proceed", "approved") → Skip to Step 3 (Write SQL) then Step 4 (Test) then Step 5 (Return Results)
3. **Plan feedback** (parent says "also add X", "change grouping to Y", "use monthly instead") → Incorporate the feedback, then Steps 3 → 4 → 5. Do NOT re-present the plan — just execute with the changes.
4. **Refinement request on existing results** (parent says "add a filter for X", "break down by week") → Go straight to Step 3 with the modified SQL, then Steps 4 → 5.

**NEVER re-present a plan if the parent''s message indicates a plan was already shown and discussed.** Only present a plan for approval on the first request for a complex/ambiguous query.

### Complexity Assessment

After exploring the schema (Step 1), decide if this is a **simple** or **complex** query:

**Simple** (proceed directly — no plan approval needed):
- Single entity or one obvious JOIN
- Clear metrics/columns requested (e.g., "show me agent runs", "list recent orders")
- Standard filtering (date range, status, top N)
- Unambiguous request with a clear answer

**Complex** (present plan for approval first):
- Multiple entities with non-obvious join paths
- Ambiguous request that could be interpreted multiple ways
- Complex aggregations, window functions, or CTEs
- The user''s request mentions vague concepts that could map to different entities
- Multiple valid approaches exist and the user should choose

**When in doubt, default to simple (one-pass).** Users can always ask for changes after seeing results.

## Workflow

### 1. Explore the Schema
- Use **Get Entity Details** action to inspect entity fields, relationships, and foreign keys
- Use the **ALL_ENTITIES** data source to find relevant entities by name or description
- Identify the right entities and their join paths

### 2. Present Plan for Approval (COMPLEX/AMBIGUOUS QUERIES ONLY)

**Skip this step entirely for simple queries.** Only do this when the complexity assessment says the query is complex or ambiguous.

Present the plan via `payloadChangeRequest` (NOT `message`) so the viewer can display it, along with a `responseForm` for easy approval.

The `plan` field is markdown that renders in a dedicated "Plan" tab. Structure it using this template:

````
## Overview
2-3 sentence summary of what the query will answer and why. Written for a business user.

## Query Logic
```mermaid
flowchart TD
    A[Source: AI Agent Runs] -->|filter| B[Last 30 Days]
    B -->|group by| C[Per Agent]
    C -->|calculate| D[Success Rate · Avg Duration · Total Cost]
    D -->|sort by| E[Most Runs First]
```

## Data Sources

### AI Agents (`[${flyway:defaultSchema}].vwAIAgents`)
- **Name** — Agent display name (used for grouping)

### AI Agent Runs (`[${flyway:defaultSchema}].vwAIAgentRuns`)
- **AgentID** — Links each run to its agent (JOIN key)
- **Status** — Run outcome (`Completed`, `Failed`, etc.)
- **StartedAt** — Execution timestamp (used for date filtering)
- **DurationMS** — Run time in milliseconds
- **TotalCost** — Estimated cost per run

## Relationships
```mermaid
erDiagram
    AIAgents ||--o{ AIAgentRuns : "has runs"
    AIAgents { uuid ID PK string Name }
    AIAgentRuns { uuid ID PK uuid AgentID FK string Status datetime StartedAt }
```

## Filters & Conditions
- Runs filtered to last 30 days (`StartedAt >= DATEADD(DAY, -30, GETDATE())`)
- Grouped by agent name
- Sorted by total runs descending
````

Include all sections. The **Query Logic** flowchart is the most important — business users understand flow diagrams best, so put it right after the overview.

```json
{
  "taskComplete": false,
  "message": "Built a query plan for your review. This one has a few possible approaches so I''d like your input before running it.",
  "payloadChangeRequest": {
    "replaceElements": {
      "source": "query",
      "title": "Descriptive Title",
      "plan": "<plan markdown following the template above>",
      "columns": [],
      "rows": [],
      "metadata": {}
    }
  },
  "responseForm": {
    "questions": [
      {
        "id": "planDecision",
        "label": "How does this plan look?",
        "type": {
          "type": "buttongroup",
          "options": [
            { "value": "approve", "label": "Looks good, run it!" },
            { "value": "modify", "label": "I''d like some changes" }
          ]
        }
      }
    ]
  },
  "nextStep": {
    "type": "Chat"
  }
}
```

**Key points about plan-only payloads:**
- `columns`, `rows` are empty arrays (no results yet)
- `metadata` is an empty object
- The viewer will display the plan content when there are no rows
- `message` is just a short sentence — NOT the plan itself

**Then wait for the parent to relay the user''s decision.** Incorporate any feedback before moving to step 3.

### 3. Write SQL
- Always use **BaseView** names with the correct schema prefix: `SchemaName.vwEntityName`
- **Get the schema from entity metadata**: Each entity has a `SchemaName` property (returned by **Get Entity Details**). Many entities use `__mj`, but entities can live in **any schema** (e.g., `dbo`, `sales`, `hr`, `custom`). **Never assume `__mj`** — always check.
- **Never** use raw table names — always use views
- Use proper JOINs, WHERE clauses, and aggregations
- For parameters, use Nunjucks syntax: `{{paramName}}`
- For optional parameters: `{% if paramName %}AND Field = ''{{paramName}}''{% endif %}`
- Name parameters descriptively: `startDate`, `customerStatus`, `minOrderTotal`

### 4. Test the Query
- Use **Execute Research Query** action to run the SQL and get a **sample** of results
- **Set `MaxRows` to 10** when testing — you only need a small sample to verify correctness. The action defaults to 1000 rows if you don''t specify, which wastes tokens during development.
- Verify the columns, data types, and sample values make sense
- Refine the SQL if results are unexpected
- **Do NOT modify your SQL with TOP** — the action''s `MaxRows` parameter handles row limiting at execution time, keeping your SQL clean for the final result

### 5. Return Results as Payload

Return your response in this exact structure (note: the DataArtifactSpec goes inside `payloadChangeRequest.replaceElements`):

**CRITICAL — String Formatting:**
- **Use real newlines** in `plan`, `metadata.sql`, and all multi-line string values. Do NOT use `\n` escape sequences — they render as literal backslash-n in the UI instead of line breaks.
- Your response is already JSON — the transport layer handles escaping. Just write natural multi-line strings.

```json
{
  "taskComplete": false,
  "message": "Queried agent runs for the last 30 days. Found 5 agents with varying activity levels.",
  "payloadChangeRequest": {
    "replaceElements": {
      "source": "query",
      "title": "Descriptive Title of What This Query Shows",
      "plan": "## Approach\n\n(see plan template in Step 2 — include Overview, Query Logic, Data Sources, Relationships, Filters)",
      "columns": [
        {
          "field": "AgentID",
          "headerName": "Agent ID",
          "sourceEntity": "AI Agents",
          "sourceFieldName": "ID",
          "sqlBaseType": "uniqueidentifier"
        },
        {
          "field": "AgentName",
          "headerName": "Agent",
          "sourceEntity": "AI Agents",
          "sourceFieldName": "Name",
          "sqlBaseType": "nvarchar"
        },
        {
          "field": "TotalRuns",
          "headerName": "Total Runs",
          "isComputed": true,
          "isSummary": true,
          "sqlBaseType": "int"
        }
      ],
      "rows": [
        { "ColumnName1": "value1", "ColumnName2": 42 },
        { "ColumnName1": "value2", "ColumnName2": 17 }
      ],
      "metadata": {
        "sql": "SELECT a.Name AS AgentName, COUNT(r.ID) AS TotalRuns FROM [${flyway:defaultSchema}].vwAIAgents a INNER JOIN [${flyway:defaultSchema}].vwAIAgentRuns r ON r.AgentID = a.ID GROUP BY a.Name ORDER BY TotalRuns DESC",
        "rowCount": 2,
        "executionTimeMs": 45
      }
    }
  },
  "nextStep": {
    "type": "Chat"
  }
}
```

**Field requirements:**
- `source`: Always `"query"`
- `title`: Clear, business-friendly description of the query results
- `plan`: **ALWAYS include this field.** Use the plan template from Step 2 (Overview → Query Logic flowchart → Data Sources → Relationships ERD → Filters & Conditions). Even for simple queries, include the plan. It renders in a dedicated "Plan" tab.
- `columns`: Array of ALL columns with enriched metadata (see Column Metadata below)
- `rows`: The actual result data, using the same field names as in `columns`.
- `metadata.sql`: The exact SQL query you ran
- `metadata.rowCount`: Number of rows returned
- `metadata.executionTimeMs`: Execution time from the Execute Research Query result

The `replaceElements` object should have these keys: `source`, `title`, `plan`, `columns`, `rows`, `metadata`.

#### Column Metadata

Each column object in the `columns` array **MUST** include enriched metadata. This enables the grid to render clickable entity links for ID columns, right-align numbers, and format dates.

**Required fields for every column:**
- `field`: The SQL alias (matches keys in `rows`)
- `headerName`: Human-readable display label
- `sqlBaseType`: SQL data type — `int`, `nvarchar`, `uniqueidentifier`, `datetime`, `decimal`, `bit`, `money`, `float`, `bigint`

**Entity linking fields** (include ONLY for direct, non-aggregated column references):
- `sourceEntity`: The **exact MJ entity name** this column comes from (e.g., `"Members"`, `"MJ: AI Agent Runs"`, `"Event Registrations"`). Must match entity names from ALL_ENTITIES exactly.
- `sourceFieldName`: The original field name in that entity before aliasing (e.g., `"ID"`, `"Name"`, `"Status"`). For JOINed columns, use the entity the field actually belongs to.

**Computation flags** (include when applicable):
- `isComputed`: `true` for any expression — `CASE WHEN`, `CONCAT`, `ROUND()`, `DATEDIFF()`, string concatenation (`+`), etc.
- `isSummary`: `true` for aggregate functions — `SUM()`, `COUNT()`, `AVG()`, `MIN()`, `MAX()`. A column can be both `isComputed` and `isSummary` (e.g., `ROUND(SUM(cost), 2)`).

**How entity linking works:**
- If `sourceFieldName` is a **primary key** (e.g., `"ID"`), the grid renders it as a clickable link to that entity''s record
- If `sourceFieldName` is a **foreign key** (e.g., `"MemberID"`, `"EventID"`), the grid renders it as a clickable link to the related entity
- Columns without `sourceEntity`/`sourceFieldName` display as plain text
- Always provide `sourceEntity` + `sourceFieldName` for ID columns and foreign key columns — this is what makes the grid interactive

**CRITICAL — When to OMIT `sourceEntity`/`sourceFieldName`:**
- **NEVER** set `sourceEntity`/`sourceFieldName` on aggregated or computed columns. These fields mean "this cell contains a direct value from that entity field" — which enables clickable entity links. An aggregate like `COUNT(r.ID)` does NOT contain a record ID, it contains a count. Tagging it with `sourceEntity`/`sourceFieldName` would make the grid try to render "42" as a clickable link to record "42", which is wrong.
- If `isComputed` or `isSummary` is `true`, **omit** `sourceEntity` and `sourceFieldName`
- Only use entity linking on **pass-through columns** — columns that directly output a single field value from one entity row (e.g., `m.ID`, `m.Name`, `r.Status`)

**Examples:**
```
✅ { "field": "MemberID",    "sourceEntity": "Members", "sourceFieldName": "ID" }        — direct PK, clickable
✅ { "field": "MemberName",  "sourceEntity": "Members", "sourceFieldName": "Name" }      — direct field
✅ { "field": "EventID",     "sourceEntity": "Events",  "sourceFieldName": "ID" }        — direct FK, clickable
❌ { "field": "TotalEvents", "sourceEntity": "Event Registrations", "sourceFieldName": "ID", "isSummary": true }  — WRONG! COUNT(er.ID) is not a record ID
✅ { "field": "TotalEvents", "isSummary": true, "sqlBaseType": "int" }                   — CORRECT, no entity link
❌ { "field": "AvgCost",     "sourceEntity": "Orders", "sourceFieldName": "TotalCost", "isComputed": true, "isSummary": true }  — WRONG! AVG(o.TotalCost) is not a single order''s cost
✅ { "field": "AvgCost",     "isComputed": true, "isSummary": true, "sqlBaseType": "decimal" }  — CORRECT
```

## SQL Guidelines

### Always Use Views
- Reference `SchemaName.vwEntityName`, never raw tables — e.g., `[${flyway:defaultSchema}].vwMembers`, `dbo.vwOrders`, `sales.vwProducts`
- **Use each entity''s actual `SchemaName`** from Get Entity Details — do NOT assume all entities are in `__mj`
- Views include computed fields and proper joins

### Formatting Standard

Every query you write must follow this formatting standard. Study these examples carefully — this is the quality bar.

**Example 1 — Simple JOIN with aggregation:**
*(Note: These examples use `__mj` because those entities happen to be in that schema. Always check each entity''s `SchemaName` — it could be `dbo`, `sales`, etc.)*
```sql
-- ============================================================
-- Member Event Attendance Summary
-- Which members attend the most events?
-- ============================================================
SELECT
    -- Build display name from first + last
    m.FirstName + '' '' + m.LastName       AS MemberName,

    -- Count distinct attended events per member
    COUNT(er.ID)                          AS TotalEventsAttended

FROM [${flyway:defaultSchema}].vwMembers m                    -- SchemaName: __mj

    -- Link to event registrations (one member → many registrations)
    INNER JOIN [${flyway:defaultSchema}].vwEventRegistrations er
        ON m.ID = er.MemberID

WHERE
    er.Status = ''Attended''                -- Only confirmed attendance

GROUP BY
    m.FirstName,
    m.LastName

ORDER BY
    TotalEventsAttended DESC              -- Most active members first
```

**Example 2 — Multi-table with computed metrics:**
```sql
-- ============================================================
-- AI Agent Performance Dashboard
-- Compare agents by volume, reliability, speed, and cost
-- over the last 30 days
-- ============================================================
SELECT
    a.Name                                AS AgentName,
    COUNT(r.ID)                           AS TotalRuns,

    -- Success rate: completed runs as a percentage of total
    ROUND(
        100.0 * SUM(
            CASE WHEN r.Status = ''Completed'' THEN 1 ELSE 0
END
        ) / NULLIF(COUNT(r.ID), 0),
        1
    )                                     AS SuccessRatePct,

    -- Average duration in seconds (stored as milliseconds)
    ROUND(
        AVG(r.DurationMS) / 1000.0, 1
    )                                     AS AvgDurationSec,

    -- Total estimated cost across all runs
    ROUND(
        SUM(ISNULL(r.TotalCost, 0)), 4
    )                                     AS TotalCost,

    -- Most recent execution timestamp
    MAX(r.StartedAt)                      AS LastRunAt

FROM [${flyway:defaultSchema}].vwAIAgents a

    -- Each agent has zero or more execution runs
    INNER JOIN [${flyway:defaultSchema}].vwAIAgentRuns r
        ON r.AgentID = a.ID

WHERE
    r.StartedAt >= DATEADD(DAY, -30, GETDATE())   -- Last 30 days

GROUP BY
    a.Name

ORDER BY
    TotalRuns DESC                        -- Most active agents first
```

**Key formatting rules:**
- Header comment block with title and one-line description
- **Do NOT use `TOP N`** — the result grid supports pagination and handles large result sets. Let WHERE/GROUP BY naturally scope the data.
- One column per line, right-aligned `AS` aliases for readability
- Inline comments on computed columns explaining the logic
- JOINs indented under FROM, each with a comment explaining the relationship
- WHERE, GROUP BY, ORDER BY each on their own line with conditions indented
- Trailing comments on filter conditions explaining "why"

### Performance
- **Do NOT use `SELECT TOP N`** for result queries — the viewer grid supports client-side pagination and can handle thousands of rows. Let the query return the full result set scoped by your WHERE clause.
- For exploration queries (schema discovery, sampling), use TOP 50 to keep things fast
- Use appropriate WHERE clauses to scope result sets (date ranges, status filters, etc.)
- Add ORDER BY for predictable output
- Prefer JOINs over subqueries when possible

### Security
- Only SELECT statements — never INSERT, UPDATE, DELETE, or DDL
- Never reference system tables directly
- Use parameterized values, not string concatenation

## Data Sources Available

- **ALL_ENTITIES**: All entity names, descriptions, schemas, base tables, and base views'
SET
  @Priority_d5488260 = 1
SET
  @IsActive_d5488260 = 1
SET
  @ID_d5488260 = 'A0A098DF-7F18-43D9-A81F-04BCEB38F5B7'
EXEC [${flyway:defaultSchema}].spUpdateTemplateContent @TemplateID = @TemplateID_d5488260,
  @TypeID = @TypeID_d5488260,
  @TemplateText = @TemplateText_d5488260,
  @Priority = @Priority_d5488260,
  @IsActive = @IsActive_d5488260,
  @ID = @ID_d5488260;

-- Save MJ: Template Params (core SP call only)
DECLARE @ID_73fc9114 UNIQUEIDENTIFIER,
@TemplateID_73fc9114 UNIQUEIDENTIFIER,
@Name_73fc9114 NVARCHAR(255),
@Description_73fc9114 NVARCHAR(MAX),
@Type_73fc9114 NVARCHAR(20),
@DefaultValue_73fc9114 NVARCHAR(MAX),
@IsRequired_73fc9114 BIT,
@LinkedParameterName_73fc9114 NVARCHAR(255),
@LinkedParameterField_73fc9114 NVARCHAR(500),
@ExtraFilter_73fc9114 NVARCHAR(MAX),
@EntityID_73fc9114 UNIQUEIDENTIFIER,
@RecordID_73fc9114 NVARCHAR(2000),
@OrderBy_73fc9114 NVARCHAR(MAX),
@TemplateContentID_73fc9114 UNIQUEIDENTIFIER
SET
  @ID_73fc9114 = 'd7a9d32b-df3c-45f3-a4d9-a94289ca08a4'
SET
  @TemplateID_73fc9114 = 'F9F16E70-2C65-46E7-86FC-D9D3026D36E1'
SET
  @Name_73fc9114 = N'taskComplete'
SET
  @Description_73fc9114 = N'Boolean flag indicating whether the query task is complete'
SET
  @Type_73fc9114 = N'Scalar'
SET
  @IsRequired_73fc9114 = 0
EXEC [${flyway:defaultSchema}].spCreateTemplateParam @ID = @ID_73fc9114,
  @TemplateID = @TemplateID_73fc9114,
  @Name = @Name_73fc9114,
  @Description = @Description_73fc9114,
  @Type = @Type_73fc9114,
  @DefaultValue = @DefaultValue_73fc9114,
  @IsRequired = @IsRequired_73fc9114,
  @LinkedParameterName = @LinkedParameterName_73fc9114,
  @LinkedParameterField = @LinkedParameterField_73fc9114,
  @ExtraFilter = @ExtraFilter_73fc9114,
  @EntityID = @EntityID_73fc9114,
  @RecordID = @RecordID_73fc9114,
  @OrderBy = @OrderBy_73fc9114,
  @TemplateContentID = @TemplateContentID_73fc9114;

-- Save MJ: Template Params (core SP call only)
DECLARE @ID_7ff16a82 UNIQUEIDENTIFIER,
@TemplateID_7ff16a82 UNIQUEIDENTIFIER,
@Name_7ff16a82 NVARCHAR(255),
@Description_7ff16a82 NVARCHAR(MAX),
@Type_7ff16a82 NVARCHAR(20),
@DefaultValue_7ff16a82 NVARCHAR(MAX),
@IsRequired_7ff16a82 BIT,
@LinkedParameterName_7ff16a82 NVARCHAR(255),
@LinkedParameterField_7ff16a82 NVARCHAR(500),
@ExtraFilter_7ff16a82 NVARCHAR(MAX),
@EntityID_7ff16a82 UNIQUEIDENTIFIER,
@RecordID_7ff16a82 NVARCHAR(2000),
@OrderBy_7ff16a82 NVARCHAR(MAX),
@TemplateContentID_7ff16a82 UNIQUEIDENTIFIER
SET
  @ID_7ff16a82 = '5c7ab20f-4c72-41a0-a76f-a0cf2b129b94'
SET
  @TemplateID_7ff16a82 = 'F9F16E70-2C65-46E7-86FC-D9D3026D36E1'
SET
  @Name_7ff16a82 = N'message'
SET
  @Description_7ff16a82 = N'Short text summary of the query results for the user'
SET
  @Type_7ff16a82 = N'Scalar'
SET
  @IsRequired_7ff16a82 = 0
EXEC [${flyway:defaultSchema}].spCreateTemplateParam @ID = @ID_7ff16a82,
  @TemplateID = @TemplateID_7ff16a82,
  @Name = @Name_7ff16a82,
  @Description = @Description_7ff16a82,
  @Type = @Type_7ff16a82,
  @DefaultValue = @DefaultValue_7ff16a82,
  @IsRequired = @IsRequired_7ff16a82,
  @LinkedParameterName = @LinkedParameterName_7ff16a82,
  @LinkedParameterField = @LinkedParameterField_7ff16a82,
  @ExtraFilter = @ExtraFilter_7ff16a82,
  @EntityID = @EntityID_7ff16a82,
  @RecordID = @RecordID_7ff16a82,
  @OrderBy = @OrderBy_7ff16a82,
  @TemplateContentID = @TemplateContentID_7ff16a82;

-- Save MJ: Template Params (core SP call only)
DECLARE @ID_9fac28d6 UNIQUEIDENTIFIER,
@TemplateID_9fac28d6 UNIQUEIDENTIFIER,
@Name_9fac28d6 NVARCHAR(255),
@Description_9fac28d6 NVARCHAR(MAX),
@Type_9fac28d6 NVARCHAR(20),
@DefaultValue_9fac28d6 NVARCHAR(MAX),
@IsRequired_9fac28d6 BIT,
@LinkedParameterName_9fac28d6 NVARCHAR(255),
@LinkedParameterField_9fac28d6 NVARCHAR(500),
@ExtraFilter_9fac28d6 NVARCHAR(MAX),
@EntityID_9fac28d6 UNIQUEIDENTIFIER,
@RecordID_9fac28d6 NVARCHAR(2000),
@OrderBy_9fac28d6 NVARCHAR(MAX),
@TemplateContentID_9fac28d6 UNIQUEIDENTIFIER
SET
  @ID_9fac28d6 = 'ffce5d13-cc6b-49dc-b9cd-05a2d6b915ee'
SET
  @TemplateID_9fac28d6 = 'F9F16E70-2C65-46E7-86FC-D9D3026D36E1'
SET
  @Name_9fac28d6 = N'payloadChangeRequest'
SET
  @Description_9fac28d6 = N'Structured payload containing query results, metadata, and plan'
SET
  @Type_9fac28d6 = N'Object'
SET
  @IsRequired_9fac28d6 = 0
EXEC [${flyway:defaultSchema}].spCreateTemplateParam @ID = @ID_9fac28d6,
  @TemplateID = @TemplateID_9fac28d6,
  @Name = @Name_9fac28d6,
  @Description = @Description_9fac28d6,
  @Type = @Type_9fac28d6,
  @DefaultValue = @DefaultValue_9fac28d6,
  @IsRequired = @IsRequired_9fac28d6,
  @LinkedParameterName = @LinkedParameterName_9fac28d6,
  @LinkedParameterField = @LinkedParameterField_9fac28d6,
  @ExtraFilter = @ExtraFilter_9fac28d6,
  @EntityID = @EntityID_9fac28d6,
  @RecordID = @RecordID_9fac28d6,
  @OrderBy = @OrderBy_9fac28d6,
  @TemplateContentID = @TemplateContentID_9fac28d6;

-- Save MJ: Template Params (core SP call only)
DECLARE @ID_67178810 UNIQUEIDENTIFIER,
@TemplateID_67178810 UNIQUEIDENTIFIER,
@Name_67178810 NVARCHAR(255),
@Description_67178810 NVARCHAR(MAX),
@Type_67178810 NVARCHAR(20),
@DefaultValue_67178810 NVARCHAR(MAX),
@IsRequired_67178810 BIT,
@LinkedParameterName_67178810 NVARCHAR(255),
@LinkedParameterField_67178810 NVARCHAR(500),
@ExtraFilter_67178810 NVARCHAR(MAX),
@EntityID_67178810 UNIQUEIDENTIFIER,
@RecordID_67178810 NVARCHAR(2000),
@OrderBy_67178810 NVARCHAR(MAX),
@TemplateContentID_67178810 UNIQUEIDENTIFIER
SET
  @ID_67178810 = 'c5cebca3-ab8b-412d-8526-f16409d941f5'
SET
  @TemplateID_67178810 = 'F9F16E70-2C65-46E7-86FC-D9D3026D36E1'
SET
  @Name_67178810 = N'responseForm'
SET
  @Description_67178810 = N'Optional form configuration for user interaction'
SET
  @Type_67178810 = N'Object'
SET
  @IsRequired_67178810 = 0
EXEC [${flyway:defaultSchema}].spCreateTemplateParam @ID = @ID_67178810,
  @TemplateID = @TemplateID_67178810,
  @Name = @Name_67178810,
  @Description = @Description_67178810,
  @Type = @Type_67178810,
  @DefaultValue = @DefaultValue_67178810,
  @IsRequired = @IsRequired_67178810,
  @LinkedParameterName = @LinkedParameterName_67178810,
  @LinkedParameterField = @LinkedParameterField_67178810,
  @ExtraFilter = @ExtraFilter_67178810,
  @EntityID = @EntityID_67178810,
  @RecordID = @RecordID_67178810,
  @OrderBy = @OrderBy_67178810,
  @TemplateContentID = @TemplateContentID_67178810;

-- Save MJ: Template Params (core SP call only)
DECLARE @ID_65d88f8a UNIQUEIDENTIFIER,
@TemplateID_65d88f8a UNIQUEIDENTIFIER,
@Name_65d88f8a NVARCHAR(255),
@Description_65d88f8a NVARCHAR(MAX),
@Type_65d88f8a NVARCHAR(20),
@DefaultValue_65d88f8a NVARCHAR(MAX),
@IsRequired_65d88f8a BIT,
@LinkedParameterName_65d88f8a NVARCHAR(255),
@LinkedParameterField_65d88f8a NVARCHAR(500),
@ExtraFilter_65d88f8a NVARCHAR(MAX),
@EntityID_65d88f8a UNIQUEIDENTIFIER,
@RecordID_65d88f8a NVARCHAR(2000),
@OrderBy_65d88f8a NVARCHAR(MAX),
@TemplateContentID_65d88f8a UNIQUEIDENTIFIER
SET
  @ID_65d88f8a = '6ba6fb17-b5e4-41f7-891b-27eb82bcbcd7'
SET
  @TemplateID_65d88f8a = 'F9F16E70-2C65-46E7-86FC-D9D3026D36E1'
SET
  @Name_65d88f8a = N'nextStep'
SET
  @Description_65d88f8a = N'Configuration for the next step in the workflow'
SET
  @Type_65d88f8a = N'Object'
SET
  @IsRequired_65d88f8a = 0
EXEC [${flyway:defaultSchema}].spCreateTemplateParam @ID = @ID_65d88f8a,
  @TemplateID = @TemplateID_65d88f8a,
  @Name = @Name_65d88f8a,
  @Description = @Description_65d88f8a,
  @Type = @Type_65d88f8a,
  @DefaultValue = @DefaultValue_65d88f8a,
  @IsRequired = @IsRequired_65d88f8a,
  @LinkedParameterName = @LinkedParameterName_65d88f8a,
  @LinkedParameterField = @LinkedParameterField_65d88f8a,
  @ExtraFilter = @ExtraFilter_65d88f8a,
  @EntityID = @EntityID_65d88f8a,
  @RecordID = @RecordID_65d88f8a,
  @OrderBy = @OrderBy_65d88f8a,
  @TemplateContentID = @TemplateContentID_65d88f8a;

-- Save MJ: AI Prompts (core SP call only)
DECLARE @Name_16a82bf8 NVARCHAR(255),
@Description_16a82bf8 NVARCHAR(MAX),
@TemplateID_16a82bf8 UNIQUEIDENTIFIER,
@CategoryID_16a82bf8 UNIQUEIDENTIFIER,
@TypeID_16a82bf8 UNIQUEIDENTIFIER,
@Status_16a82bf8 NVARCHAR(50),
@ResponseFormat_16a82bf8 NVARCHAR(20),
@ModelSpecificResponseFormat_16a82bf8 NVARCHAR(MAX),
@AIModelTypeID_16a82bf8 UNIQUEIDENTIFIER,
@MinPowerRank_16a82bf8 INT,
@SelectionStrategy_16a82bf8 NVARCHAR(20),
@PowerPreference_16a82bf8 NVARCHAR(20),
@ParallelizationMode_16a82bf8 NVARCHAR(20),
@ParallelCount_16a82bf8 INT,
@ParallelConfigParam_16a82bf8 NVARCHAR(100),
@OutputType_16a82bf8 NVARCHAR(50),
@OutputExample_16a82bf8 NVARCHAR(MAX),
@ValidationBehavior_16a82bf8 NVARCHAR(50),
@MaxRetries_16a82bf8 INT,
@RetryDelayMS_16a82bf8 INT,
@RetryStrategy_16a82bf8 NVARCHAR(20),
@ResultSelectorPromptID_16a82bf8 UNIQUEIDENTIFIER,
@EnableCaching_16a82bf8 BIT,
@CacheTTLSeconds_16a82bf8 INT,
@CacheMatchType_16a82bf8 NVARCHAR(20),
@CacheSimilarityThreshold_16a82bf8 FLOAT(53),
@CacheMustMatchModel_16a82bf8 BIT,
@CacheMustMatchVendor_16a82bf8 BIT,
@CacheMustMatchAgent_16a82bf8 BIT,
@CacheMustMatchConfig_16a82bf8 BIT,
@PromptRole_16a82bf8 NVARCHAR(20),
@PromptPosition_16a82bf8 NVARCHAR(20),
@Temperature_16a82bf8 DECIMAL(3, 2),
@TopP_16a82bf8 DECIMAL(3, 2),
@TopK_16a82bf8 INT,
@MinP_16a82bf8 DECIMAL(3, 2),
@FrequencyPenalty_16a82bf8 DECIMAL(3, 2),
@PresencePenalty_16a82bf8 DECIMAL(3, 2),
@Seed_16a82bf8 INT,
@StopSequences_16a82bf8 NVARCHAR(1000),
@IncludeLogProbs_16a82bf8 BIT,
@TopLogProbs_16a82bf8 INT,
@FailoverStrategy_16a82bf8 NVARCHAR(50),
@FailoverMaxAttempts_16a82bf8 INT,
@FailoverDelaySeconds_16a82bf8 INT,
@FailoverModelStrategy_16a82bf8 NVARCHAR(50),
@FailoverErrorScope_16a82bf8 NVARCHAR(50),
@EffortLevel_16a82bf8 INT,
@ID_16a82bf8 UNIQUEIDENTIFIER
SET
  @Name_16a82bf8 = N'Query Builder - Query Strategist Prompt'
SET
  @Description_16a82bf8 = N'System prompt for the Query Strategist sub-agent. Handles schema exploration, SQL generation, query testing, and structured result formatting.'
SET
  @TemplateID_16a82bf8 = 'F9F16E70-2C65-46E7-86FC-D9D3026D36E1'
SET
  @CategoryID_16a82bf8 = '7D2DEF7F-138F-4620-8309-33964A97A997'
SET
  @TypeID_16a82bf8 = 'A6DA423E-F36B-1410-8DAC-00021F8B792E'
SET
  @Status_16a82bf8 = N'Active'
SET
  @ResponseFormat_16a82bf8 = N'Any'
SET
  @MinPowerRank_16a82bf8 = 0
SET
  @SelectionStrategy_16a82bf8 = N'Default'
SET
  @PowerPreference_16a82bf8 = N'Highest'
SET
  @ParallelizationMode_16a82bf8 = N'None'
SET
  @OutputType_16a82bf8 = N'string'
SET
  @ValidationBehavior_16a82bf8 = N'Warn'
SET
  @MaxRetries_16a82bf8 = 0
SET
  @RetryDelayMS_16a82bf8 = 0
SET
  @RetryStrategy_16a82bf8 = N'Fixed'
SET
  @EnableCaching_16a82bf8 = 0
SET
  @CacheMatchType_16a82bf8 = N'Exact'
SET
  @CacheMustMatchModel_16a82bf8 = 1
SET
  @CacheMustMatchVendor_16a82bf8 = 1
SET
  @CacheMustMatchAgent_16a82bf8 = 0
SET
  @CacheMustMatchConfig_16a82bf8 = 0
SET
  @PromptRole_16a82bf8 = N'System'
SET
  @PromptPosition_16a82bf8 = N'First'
SET
  @IncludeLogProbs_16a82bf8 = 0
SET
  @FailoverStrategy_16a82bf8 = N'SameModelDifferentVendor'
SET
  @FailoverMaxAttempts_16a82bf8 = 3
SET
  @FailoverDelaySeconds_16a82bf8 = 5
SET
  @FailoverModelStrategy_16a82bf8 = N'PreferSameModel'
SET
  @FailoverErrorScope_16a82bf8 = N'All'
SET
  @ID_16a82bf8 = '6712859D-9958-416D-A99B-D9517CB00553'
EXEC [${flyway:defaultSchema}].spUpdateAIPrompt @Name = @Name_16a82bf8,
  @Description = @Description_16a82bf8,
  @TemplateID = @TemplateID_16a82bf8,
  @CategoryID = @CategoryID_16a82bf8,
  @TypeID = @TypeID_16a82bf8,
  @Status = @Status_16a82bf8,
  @ResponseFormat = @ResponseFormat_16a82bf8,
  @ModelSpecificResponseFormat = @ModelSpecificResponseFormat_16a82bf8,
  @AIModelTypeID = @AIModelTypeID_16a82bf8,
  @MinPowerRank = @MinPowerRank_16a82bf8,
  @SelectionStrategy = @SelectionStrategy_16a82bf8,
  @PowerPreference = @PowerPreference_16a82bf8,
  @ParallelizationMode = @ParallelizationMode_16a82bf8,
  @ParallelCount = @ParallelCount_16a82bf8,
  @ParallelConfigParam = @ParallelConfigParam_16a82bf8,
  @OutputType = @OutputType_16a82bf8,
  @OutputExample = @OutputExample_16a82bf8,
  @ValidationBehavior = @ValidationBehavior_16a82bf8,
  @MaxRetries = @MaxRetries_16a82bf8,
  @RetryDelayMS = @RetryDelayMS_16a82bf8,
  @RetryStrategy = @RetryStrategy_16a82bf8,
  @ResultSelectorPromptID = @ResultSelectorPromptID_16a82bf8,
  @EnableCaching = @EnableCaching_16a82bf8,
  @CacheTTLSeconds = @CacheTTLSeconds_16a82bf8,
  @CacheMatchType = @CacheMatchType_16a82bf8,
  @CacheSimilarityThreshold = @CacheSimilarityThreshold_16a82bf8,
  @CacheMustMatchModel = @CacheMustMatchModel_16a82bf8,
  @CacheMustMatchVendor = @CacheMustMatchVendor_16a82bf8,
  @CacheMustMatchAgent = @CacheMustMatchAgent_16a82bf8,
  @CacheMustMatchConfig = @CacheMustMatchConfig_16a82bf8,
  @PromptRole = @PromptRole_16a82bf8,
  @PromptPosition = @PromptPosition_16a82bf8,
  @Temperature = @Temperature_16a82bf8,
  @TopP = @TopP_16a82bf8,
  @TopK = @TopK_16a82bf8,
  @MinP = @MinP_16a82bf8,
  @FrequencyPenalty = @FrequencyPenalty_16a82bf8,
  @PresencePenalty = @PresencePenalty_16a82bf8,
  @Seed = @Seed_16a82bf8,
  @StopSequences = @StopSequences_16a82bf8,
  @IncludeLogProbs = @IncludeLogProbs_16a82bf8,
  @TopLogProbs = @TopLogProbs_16a82bf8,
  @FailoverStrategy = @FailoverStrategy_16a82bf8,
  @FailoverMaxAttempts = @FailoverMaxAttempts_16a82bf8,
  @FailoverDelaySeconds = @FailoverDelaySeconds_16a82bf8,
  @FailoverModelStrategy = @FailoverModelStrategy_16a82bf8,
  @FailoverErrorScope = @FailoverErrorScope_16a82bf8,
  @EffortLevel = @EffortLevel_16a82bf8,
  @ID = @ID_16a82bf8;

-- Save MJ: AI Agents (core SP call only)
DECLARE @Name_9fc3b8f0 NVARCHAR(255),
@Description_9fc3b8f0 NVARCHAR(MAX),
@LogoURL_9fc3b8f0 NVARCHAR(255),
@ParentID_9fc3b8f0 UNIQUEIDENTIFIER,
@ExposeAsAction_9fc3b8f0 BIT,
@ExecutionOrder_9fc3b8f0 INT,
@ExecutionMode_9fc3b8f0 NVARCHAR(20),
@EnableContextCompression_9fc3b8f0 BIT,
@ContextCompressionMessageThreshold_9fc3b8f0 INT,
@ContextCompressionPromptID_9fc3b8f0 UNIQUEIDENTIFIER,
@ContextCompressionMessageRetentionCount_9fc3b8f0 INT,
@TypeID_9fc3b8f0 UNIQUEIDENTIFIER,
@Status_9fc3b8f0 NVARCHAR(20),
@DriverClass_9fc3b8f0 NVARCHAR(255),
@IconClass_9fc3b8f0 NVARCHAR(100),
@ModelSelectionMode_9fc3b8f0 NVARCHAR(50),
@PayloadDownstreamPaths_9fc3b8f0 NVARCHAR(MAX),
@PayloadUpstreamPaths_9fc3b8f0 NVARCHAR(MAX),
@PayloadSelfReadPaths_9fc3b8f0 NVARCHAR(MAX),
@PayloadSelfWritePaths_9fc3b8f0 NVARCHAR(MAX),
@PayloadScope_9fc3b8f0 NVARCHAR(MAX),
@FinalPayloadValidation_9fc3b8f0 NVARCHAR(MAX),
@FinalPayloadValidationMode_9fc3b8f0 NVARCHAR(25),
@FinalPayloadValidationMaxRetries_9fc3b8f0 INT,
@MaxCostPerRun_9fc3b8f0 DECIMAL(10, 4),
@MaxTokensPerRun_9fc3b8f0 INT,
@MaxIterationsPerRun_9fc3b8f0 INT,
@MaxTimePerRun_9fc3b8f0 INT,
@MinExecutionsPerRun_9fc3b8f0 INT,
@MaxExecutionsPerRun_9fc3b8f0 INT,
@StartingPayloadValidation_9fc3b8f0 NVARCHAR(MAX),
@StartingPayloadValidationMode_9fc3b8f0 NVARCHAR(25),
@DefaultPromptEffortLevel_9fc3b8f0 INT,
@ChatHandlingOption_9fc3b8f0 NVARCHAR(30),
@DefaultArtifactTypeID_9fc3b8f0 UNIQUEIDENTIFIER,
@OwnerUserID_9fc3b8f0 UNIQUEIDENTIFIER,
@InvocationMode_9fc3b8f0 NVARCHAR(20),
@ArtifactCreationMode_9fc3b8f0 NVARCHAR(20),
@FunctionalRequirements_9fc3b8f0 NVARCHAR(MAX),
@TechnicalDesign_9fc3b8f0 NVARCHAR(MAX),
@InjectNotes_9fc3b8f0 BIT,
@MaxNotesToInject_9fc3b8f0 INT,
@NoteInjectionStrategy_9fc3b8f0 NVARCHAR(20),
@InjectExamples_9fc3b8f0 BIT,
@MaxExamplesToInject_9fc3b8f0 INT,
@ExampleInjectionStrategy_9fc3b8f0 NVARCHAR(20),
@IsRestricted_9fc3b8f0 BIT,
@MessageMode_9fc3b8f0 NVARCHAR(50),
@MaxMessages_9fc3b8f0 INT,
@AttachmentStorageProviderID_9fc3b8f0 UNIQUEIDENTIFIER,
@AttachmentRootPath_9fc3b8f0 NVARCHAR(500),
@InlineStorageThresholdBytes_9fc3b8f0 INT,
@AgentTypePromptParams_9fc3b8f0 NVARCHAR(MAX),
@ScopeConfig_9fc3b8f0 NVARCHAR(MAX),
@NoteRetentionDays_9fc3b8f0 INT,
@ExampleRetentionDays_9fc3b8f0 INT,
@AutoArchiveEnabled_9fc3b8f0 BIT,
@RerankerConfiguration_9fc3b8f0 NVARCHAR(MAX),
@ID_9fc3b8f0 UNIQUEIDENTIFIER
SET
  @Name_9fc3b8f0 = N'Query Builder'
SET
  @Description_9fc3b8f0 = N'Business-friendly orchestrator agent that helps users explore their data and build saved queries. Delegates technical SQL work to the Query Strategist sub-agent. Presents results visually with diagrams and formatted tables, hiding SQL complexity unless the user asks for it.'
SET
  @ExposeAsAction_9fc3b8f0 = 1
SET
  @ExecutionOrder_9fc3b8f0 = 0
SET
  @ExecutionMode_9fc3b8f0 = N'Sequential'
SET
  @EnableContextCompression_9fc3b8f0 = 0
SET
  @TypeID_9fc3b8f0 = 'F7926101-5099-4FA5-836A-479D9707C818'
SET
  @Status_9fc3b8f0 = N'Active'
SET
  @DriverClass_9fc3b8f0 = N'QueryBuilderAgent'
SET
  @IconClass_9fc3b8f0 = N'fa-solid fa-hammer'
SET
  @ModelSelectionMode_9fc3b8f0 = N'Agent'
SET
  @PayloadDownstreamPaths_9fc3b8f0 = N'["*"]'
SET
  @PayloadUpstreamPaths_9fc3b8f0 = N'["*"]'
SET
  @PayloadSelfWritePaths_9fc3b8f0 = N'[
  "source",
  "title",
  "plan",
  "columns.*",
  "rows.*",
  "metadata.*"
]'
SET
  @FinalPayloadValidation_9fc3b8f0 = N'{"source:string:!empty":"query","title:string:!empty":"Descriptive title","plan:string?":"Optional markdown plan","columns:[0+]":[{"field:string:!empty":"ColumnName","headerName?":"Display Name"}],"rows:[0+]":[],"metadata?":{"sql:string?":"SELECT ...","rowCount:number?":0,"executionTimeMs:number?":0}}'
SET
  @FinalPayloadValidationMode_9fc3b8f0 = N'Retry'
SET
  @FinalPayloadValidationMaxRetries_9fc3b8f0 = 3
SET
  @StartingPayloadValidationMode_9fc3b8f0 = N'Fail'
SET
  @DefaultArtifactTypeID_9fc3b8f0 = '66E3DA50-3C6B-4B0B-BAD0-8A9CB9A4B1FA'
SET
  @OwnerUserID_9fc3b8f0 = 'ECAFCCEC-6A37-EF11-86D4-000D3A4E707E'
SET
  @InvocationMode_9fc3b8f0 = N'Any'
SET
  @ArtifactCreationMode_9fc3b8f0 = N'Always'
SET
  @InjectNotes_9fc3b8f0 = 1
SET
  @MaxNotesToInject_9fc3b8f0 = 5
SET
  @NoteInjectionStrategy_9fc3b8f0 = N'Relevant'
SET
  @InjectExamples_9fc3b8f0 = 0
SET
  @MaxExamplesToInject_9fc3b8f0 = 3
SET
  @ExampleInjectionStrategy_9fc3b8f0 = N'Semantic'
SET
  @IsRestricted_9fc3b8f0 = 0
SET
  @MessageMode_9fc3b8f0 = N'None'
SET
  @NoteRetentionDays_9fc3b8f0 = 90
SET
  @ExampleRetentionDays_9fc3b8f0 = 180
SET
  @AutoArchiveEnabled_9fc3b8f0 = 1
SET
  @ID_9fc3b8f0 = '204FF1D6-A807-4278-B71A-9D692F19E808'
EXEC [${flyway:defaultSchema}].spUpdateAIAgent @Name = @Name_9fc3b8f0,
  @Description = @Description_9fc3b8f0,
  @LogoURL = @LogoURL_9fc3b8f0,
  @ParentID = @ParentID_9fc3b8f0,
  @ExposeAsAction = @ExposeAsAction_9fc3b8f0,
  @ExecutionOrder = @ExecutionOrder_9fc3b8f0,
  @ExecutionMode = @ExecutionMode_9fc3b8f0,
  @EnableContextCompression = @EnableContextCompression_9fc3b8f0,
  @ContextCompressionMessageThreshold = @ContextCompressionMessageThreshold_9fc3b8f0,
  @ContextCompressionPromptID = @ContextCompressionPromptID_9fc3b8f0,
  @ContextCompressionMessageRetentionCount = @ContextCompressionMessageRetentionCount_9fc3b8f0,
  @TypeID = @TypeID_9fc3b8f0,
  @Status = @Status_9fc3b8f0,
  @DriverClass = @DriverClass_9fc3b8f0,
  @IconClass = @IconClass_9fc3b8f0,
  @ModelSelectionMode = @ModelSelectionMode_9fc3b8f0,
  @PayloadDownstreamPaths = @PayloadDownstreamPaths_9fc3b8f0,
  @PayloadUpstreamPaths = @PayloadUpstreamPaths_9fc3b8f0,
  @PayloadSelfReadPaths = @PayloadSelfReadPaths_9fc3b8f0,
  @PayloadSelfWritePaths = @PayloadSelfWritePaths_9fc3b8f0,
  @PayloadScope = @PayloadScope_9fc3b8f0,
  @FinalPayloadValidation = @FinalPayloadValidation_9fc3b8f0,
  @FinalPayloadValidationMode = @FinalPayloadValidationMode_9fc3b8f0,
  @FinalPayloadValidationMaxRetries = @FinalPayloadValidationMaxRetries_9fc3b8f0,
  @MaxCostPerRun = @MaxCostPerRun_9fc3b8f0,
  @MaxTokensPerRun = @MaxTokensPerRun_9fc3b8f0,
  @MaxIterationsPerRun = @MaxIterationsPerRun_9fc3b8f0,
  @MaxTimePerRun = @MaxTimePerRun_9fc3b8f0,
  @MinExecutionsPerRun = @MinExecutionsPerRun_9fc3b8f0,
  @MaxExecutionsPerRun = @MaxExecutionsPerRun_9fc3b8f0,
  @StartingPayloadValidation = @StartingPayloadValidation_9fc3b8f0,
  @StartingPayloadValidationMode = @StartingPayloadValidationMode_9fc3b8f0,
  @DefaultPromptEffortLevel = @DefaultPromptEffortLevel_9fc3b8f0,
  @ChatHandlingOption = @ChatHandlingOption_9fc3b8f0,
  @DefaultArtifactTypeID = @DefaultArtifactTypeID_9fc3b8f0,
  @OwnerUserID = @OwnerUserID_9fc3b8f0,
  @InvocationMode = @InvocationMode_9fc3b8f0,
  @ArtifactCreationMode = @ArtifactCreationMode_9fc3b8f0,
  @FunctionalRequirements = @FunctionalRequirements_9fc3b8f0,
  @TechnicalDesign = @TechnicalDesign_9fc3b8f0,
  @InjectNotes = @InjectNotes_9fc3b8f0,
  @MaxNotesToInject = @MaxNotesToInject_9fc3b8f0,
  @NoteInjectionStrategy = @NoteInjectionStrategy_9fc3b8f0,
  @InjectExamples = @InjectExamples_9fc3b8f0,
  @MaxExamplesToInject = @MaxExamplesToInject_9fc3b8f0,
  @ExampleInjectionStrategy = @ExampleInjectionStrategy_9fc3b8f0,
  @IsRestricted = @IsRestricted_9fc3b8f0,
  @MessageMode = @MessageMode_9fc3b8f0,
  @MaxMessages = @MaxMessages_9fc3b8f0,
  @AttachmentStorageProviderID = @AttachmentStorageProviderID_9fc3b8f0,
  @AttachmentRootPath = @AttachmentRootPath_9fc3b8f0,
  @InlineStorageThresholdBytes = @InlineStorageThresholdBytes_9fc3b8f0,
  @AgentTypePromptParams = @AgentTypePromptParams_9fc3b8f0,
  @ScopeConfig = @ScopeConfig_9fc3b8f0,
  @NoteRetentionDays = @NoteRetentionDays_9fc3b8f0,
  @ExampleRetentionDays = @ExampleRetentionDays_9fc3b8f0,
  @AutoArchiveEnabled = @AutoArchiveEnabled_9fc3b8f0,
  @RerankerConfiguration = @RerankerConfiguration_9fc3b8f0,
  @ID = @ID_9fc3b8f0;

-- Save MJ: AI Agents (core SP call only)
DECLARE @Name_e6a9b4a2 NVARCHAR(255),
@Description_e6a9b4a2 NVARCHAR(MAX),
@LogoURL_e6a9b4a2 NVARCHAR(255),
@ParentID_e6a9b4a2 UNIQUEIDENTIFIER,
@ExposeAsAction_e6a9b4a2 BIT,
@ExecutionOrder_e6a9b4a2 INT,
@ExecutionMode_e6a9b4a2 NVARCHAR(20),
@EnableContextCompression_e6a9b4a2 BIT,
@ContextCompressionMessageThreshold_e6a9b4a2 INT,
@ContextCompressionPromptID_e6a9b4a2 UNIQUEIDENTIFIER,
@ContextCompressionMessageRetentionCount_e6a9b4a2 INT,
@TypeID_e6a9b4a2 UNIQUEIDENTIFIER,
@Status_e6a9b4a2 NVARCHAR(20),
@DriverClass_e6a9b4a2 NVARCHAR(255),
@IconClass_e6a9b4a2 NVARCHAR(100),
@ModelSelectionMode_e6a9b4a2 NVARCHAR(50),
@PayloadDownstreamPaths_e6a9b4a2 NVARCHAR(MAX),
@PayloadUpstreamPaths_e6a9b4a2 NVARCHAR(MAX),
@PayloadSelfReadPaths_e6a9b4a2 NVARCHAR(MAX),
@PayloadSelfWritePaths_e6a9b4a2 NVARCHAR(MAX),
@PayloadScope_e6a9b4a2 NVARCHAR(MAX),
@FinalPayloadValidation_e6a9b4a2 NVARCHAR(MAX),
@FinalPayloadValidationMode_e6a9b4a2 NVARCHAR(25),
@FinalPayloadValidationMaxRetries_e6a9b4a2 INT,
@MaxCostPerRun_e6a9b4a2 DECIMAL(10, 4),
@MaxTokensPerRun_e6a9b4a2 INT,
@MaxIterationsPerRun_e6a9b4a2 INT,
@MaxTimePerRun_e6a9b4a2 INT,
@MinExecutionsPerRun_e6a9b4a2 INT,
@MaxExecutionsPerRun_e6a9b4a2 INT,
@StartingPayloadValidation_e6a9b4a2 NVARCHAR(MAX),
@StartingPayloadValidationMode_e6a9b4a2 NVARCHAR(25),
@DefaultPromptEffortLevel_e6a9b4a2 INT,
@ChatHandlingOption_e6a9b4a2 NVARCHAR(30),
@DefaultArtifactTypeID_e6a9b4a2 UNIQUEIDENTIFIER,
@OwnerUserID_e6a9b4a2 UNIQUEIDENTIFIER,
@InvocationMode_e6a9b4a2 NVARCHAR(20),
@ArtifactCreationMode_e6a9b4a2 NVARCHAR(20),
@FunctionalRequirements_e6a9b4a2 NVARCHAR(MAX),
@TechnicalDesign_e6a9b4a2 NVARCHAR(MAX),
@InjectNotes_e6a9b4a2 BIT,
@MaxNotesToInject_e6a9b4a2 INT,
@NoteInjectionStrategy_e6a9b4a2 NVARCHAR(20),
@InjectExamples_e6a9b4a2 BIT,
@MaxExamplesToInject_e6a9b4a2 INT,
@ExampleInjectionStrategy_e6a9b4a2 NVARCHAR(20),
@IsRestricted_e6a9b4a2 BIT,
@MessageMode_e6a9b4a2 NVARCHAR(50),
@MaxMessages_e6a9b4a2 INT,
@AttachmentStorageProviderID_e6a9b4a2 UNIQUEIDENTIFIER,
@AttachmentRootPath_e6a9b4a2 NVARCHAR(500),
@InlineStorageThresholdBytes_e6a9b4a2 INT,
@AgentTypePromptParams_e6a9b4a2 NVARCHAR(MAX),
@ScopeConfig_e6a9b4a2 NVARCHAR(MAX),
@NoteRetentionDays_e6a9b4a2 INT,
@ExampleRetentionDays_e6a9b4a2 INT,
@AutoArchiveEnabled_e6a9b4a2 BIT,
@RerankerConfiguration_e6a9b4a2 NVARCHAR(MAX),
@ID_e6a9b4a2 UNIQUEIDENTIFIER
SET
  @Name_e6a9b4a2 = N'Query Strategist'
SET
  @Description_e6a9b4a2 = N'Technical sub-agent that handles schema exploration, SQL generation, query testing, and structured result formatting. Translates business requirements from the Query Builder orchestrator into optimized SQL queries.'
SET
  @ParentID_e6a9b4a2 = '204FF1D6-A807-4278-B71A-9D692F19E808'
SET
  @ExposeAsAction_e6a9b4a2 = 0
SET
  @ExecutionOrder_e6a9b4a2 = 0
SET
  @ExecutionMode_e6a9b4a2 = N'Sequential'
SET
  @EnableContextCompression_e6a9b4a2 = 0
SET
  @TypeID_e6a9b4a2 = 'F7926101-5099-4FA5-836A-479D9707C818'
SET
  @Status_e6a9b4a2 = N'Active'
SET
  @IconClass_e6a9b4a2 = N'fa-solid fa-database'
SET
  @ModelSelectionMode_e6a9b4a2 = N'Agent'
SET
  @PayloadDownstreamPaths_e6a9b4a2 = N'[
  "*"
]'
SET
  @PayloadUpstreamPaths_e6a9b4a2 = N'[
  "source",
  "title",
  "plan",
  "columns.*",
  "rows.*",
  "metadata.*"
]'
SET
  @FinalPayloadValidation_e6a9b4a2 = N'{"source:string:!empty":"query","title:string:!empty":"Descriptive title","plan:string?":"Optional markdown plan","columns:[0+]":[{"field:string:!empty":"ColumnName","headerName?":"Display Name"}],"rows:[0+]":[],"metadata?":{"sql:string?":"SELECT ...","rowCount:number?":0,"executionTimeMs:number?":0}}'
SET
  @FinalPayloadValidationMode_e6a9b4a2 = N'Retry'
SET
  @FinalPayloadValidationMaxRetries_e6a9b4a2 = 3
SET
  @StartingPayloadValidationMode_e6a9b4a2 = N'Fail'
SET
  @OwnerUserID_e6a9b4a2 = 'ECAFCCEC-6A37-EF11-86D4-000D3A4E707E'
SET
  @InvocationMode_e6a9b4a2 = N'Sub-Agent'
SET
  @ArtifactCreationMode_e6a9b4a2 = N'Never'
SET
  @InjectNotes_e6a9b4a2 = 1
SET
  @MaxNotesToInject_e6a9b4a2 = 5
SET
  @NoteInjectionStrategy_e6a9b4a2 = N'Relevant'
SET
  @InjectExamples_e6a9b4a2 = 0
SET
  @MaxExamplesToInject_e6a9b4a2 = 3
SET
  @ExampleInjectionStrategy_e6a9b4a2 = N'Semantic'
SET
  @IsRestricted_e6a9b4a2 = 0
SET
  @MessageMode_e6a9b4a2 = N'None'
SET
  @NoteRetentionDays_e6a9b4a2 = 90
SET
  @ExampleRetentionDays_e6a9b4a2 = 180
SET
  @AutoArchiveEnabled_e6a9b4a2 = 1
SET
  @ID_e6a9b4a2 = '17E1C958-909C-41B2-8B52-138AED224108'
EXEC [${flyway:defaultSchema}].spUpdateAIAgent @Name = @Name_e6a9b4a2,
  @Description = @Description_e6a9b4a2,
  @LogoURL = @LogoURL_e6a9b4a2,
  @ParentID = @ParentID_e6a9b4a2,
  @ExposeAsAction = @ExposeAsAction_e6a9b4a2,
  @ExecutionOrder = @ExecutionOrder_e6a9b4a2,
  @ExecutionMode = @ExecutionMode_e6a9b4a2,
  @EnableContextCompression = @EnableContextCompression_e6a9b4a2,
  @ContextCompressionMessageThreshold = @ContextCompressionMessageThreshold_e6a9b4a2,
  @ContextCompressionPromptID = @ContextCompressionPromptID_e6a9b4a2,
  @ContextCompressionMessageRetentionCount = @ContextCompressionMessageRetentionCount_e6a9b4a2,
  @TypeID = @TypeID_e6a9b4a2,
  @Status = @Status_e6a9b4a2,
  @DriverClass = @DriverClass_e6a9b4a2,
  @IconClass = @IconClass_e6a9b4a2,
  @ModelSelectionMode = @ModelSelectionMode_e6a9b4a2,
  @PayloadDownstreamPaths = @PayloadDownstreamPaths_e6a9b4a2,
  @PayloadUpstreamPaths = @PayloadUpstreamPaths_e6a9b4a2,
  @PayloadSelfReadPaths = @PayloadSelfReadPaths_e6a9b4a2,
  @PayloadSelfWritePaths = @PayloadSelfWritePaths_e6a9b4a2,
  @PayloadScope = @PayloadScope_e6a9b4a2,
  @FinalPayloadValidation = @FinalPayloadValidation_e6a9b4a2,
  @FinalPayloadValidationMode = @FinalPayloadValidationMode_e6a9b4a2,
  @FinalPayloadValidationMaxRetries = @FinalPayloadValidationMaxRetries_e6a9b4a2,
  @MaxCostPerRun = @MaxCostPerRun_e6a9b4a2,
  @MaxTokensPerRun = @MaxTokensPerRun_e6a9b4a2,
  @MaxIterationsPerRun = @MaxIterationsPerRun_e6a9b4a2,
  @MaxTimePerRun = @MaxTimePerRun_e6a9b4a2,
  @MinExecutionsPerRun = @MinExecutionsPerRun_e6a9b4a2,
  @MaxExecutionsPerRun = @MaxExecutionsPerRun_e6a9b4a2,
  @StartingPayloadValidation = @StartingPayloadValidation_e6a9b4a2,
  @StartingPayloadValidationMode = @StartingPayloadValidationMode_e6a9b4a2,
  @DefaultPromptEffortLevel = @DefaultPromptEffortLevel_e6a9b4a2,
  @ChatHandlingOption = @ChatHandlingOption_e6a9b4a2,
  @DefaultArtifactTypeID = @DefaultArtifactTypeID_e6a9b4a2,
  @OwnerUserID = @OwnerUserID_e6a9b4a2,
  @InvocationMode = @InvocationMode_e6a9b4a2,
  @ArtifactCreationMode = @ArtifactCreationMode_e6a9b4a2,
  @FunctionalRequirements = @FunctionalRequirements_e6a9b4a2,
  @TechnicalDesign = @TechnicalDesign_e6a9b4a2,
  @InjectNotes = @InjectNotes_e6a9b4a2,
  @MaxNotesToInject = @MaxNotesToInject_e6a9b4a2,
  @NoteInjectionStrategy = @NoteInjectionStrategy_e6a9b4a2,
  @InjectExamples = @InjectExamples_e6a9b4a2,
  @MaxExamplesToInject = @MaxExamplesToInject_e6a9b4a2,
  @ExampleInjectionStrategy = @ExampleInjectionStrategy_e6a9b4a2,
  @IsRestricted = @IsRestricted_e6a9b4a2,
  @MessageMode = @MessageMode_e6a9b4a2,
  @MaxMessages = @MaxMessages_e6a9b4a2,
  @AttachmentStorageProviderID = @AttachmentStorageProviderID_e6a9b4a2,
  @AttachmentRootPath = @AttachmentRootPath_e6a9b4a2,
  @InlineStorageThresholdBytes = @InlineStorageThresholdBytes_e6a9b4a2,
  @AgentTypePromptParams = @AgentTypePromptParams_e6a9b4a2,
  @ScopeConfig = @ScopeConfig_e6a9b4a2,
  @NoteRetentionDays = @NoteRetentionDays_e6a9b4a2,
  @ExampleRetentionDays = @ExampleRetentionDays_e6a9b4a2,
  @AutoArchiveEnabled = @AutoArchiveEnabled_e6a9b4a2,
  @RerankerConfiguration = @RerankerConfiguration_e6a9b4a2,
  @ID = @ID_e6a9b4a2;

-- Save MJ: Queries (core SP call only)
DECLARE @Name_2638b156 NVARCHAR(255),
@CategoryID_2638b156 UNIQUEIDENTIFIER,
@UserQuestion_2638b156 NVARCHAR(MAX),
@Description_2638b156 NVARCHAR(MAX),
@SQL_2638b156 NVARCHAR(MAX),
@TechnicalDescription_2638b156 NVARCHAR(MAX),
@OriginalSQL_2638b156 NVARCHAR(MAX),
@Feedback_2638b156 NVARCHAR(MAX),
@Status_2638b156 NVARCHAR(15),
@QualityRank_2638b156 INT,
@ExecutionCostRank_2638b156 INT,
@UsesTemplate_2638b156 BIT,
@AuditQueryRuns_2638b156 BIT,
@CacheEnabled_2638b156 BIT,
@CacheTTLMinutes_2638b156 INT,
@CacheMaxSize_2638b156 INT,
@EmbeddingVector_2638b156 NVARCHAR(MAX),
@EmbeddingModelID_2638b156 UNIQUEIDENTIFIER,
@CacheValidationSQL_2638b156 NVARCHAR(MAX),
@ID_2638b156 UNIQUEIDENTIFIER
SET
  @Name_2638b156 = N'GetConversationsForMemoryManager'
SET
  @CategoryID_2638b156 = '5609FBC7-381C-4F9C-9C74-04B52C1FF3DA'
SET
  @UserQuestion_2638b156 = N'What conversations have new activity that need to be analyzed for memory extraction?'
SET
  @Description_2638b156 = N'Returns all conversation data needed for memory extraction in a single query: conversations with new activity, their details with ratings, and linked agent runs for scope inheritance. Optimized to replace 4 separate sequential queries.'
SET
  @SQL_2638b156 = N'-- Get Conversations for Memory Manager - Single optimized query
-- Returns all data needed for memory extraction: conversations, details, ratings, and agent runs
-- Uses JSON aggregation to include related data without row multiplication
-- This replaces 4 separate queries with 1 query for better performance
--
-- Parameters:
--   @since (optional): ISO date string - only include conversations with new activity after this date
--   @agentIds: Comma-separated list of agent IDs that have memory enabled

SELECT
    c.ID as ConversationID,
    c.UserID,

    -- Most recent agent run ID for this conversation (for scope inheritance)
    (
        SELECT TOP 1 ar.ID
        FROM [${flyway:defaultSchema}].[vwAIAgentRuns] ar
        WHERE ar.ConversationID = c.ID
        AND ar.AgentID IN ({{ agentIds }})
        ORDER BY ar.StartedAt DESC
    ) as AgentRunID,

    -- Conversation details as JSON array with ratings included
    (
        SELECT
            cd.ID as id,
            cd.Role as role,
            cd.Message as message,
            cd.__mj_CreatedAt as createdAt,
            cdr.Rating as rating,
            cdr.Comments as ratingComment
        FROM [${flyway:defaultSchema}].[vwConversationDetails] cd
        LEFT OUTER JOIN [${flyway:defaultSchema}].[vwConversationDetailRatings] cdr
            ON cdr.ConversationDetailID = cd.ID
        WHERE cd.ConversationID = c.ID
        AND cd.Status = ''Complete''
        ORDER BY cd.__mj_CreatedAt ASC
        FOR JSON PATH
    ) as MessagesJSON,

    -- Rating summary flags
    CASE WHEN EXISTS (
        SELECT 1 FROM [${flyway:defaultSchema}].[vwConversationDetails] cd
        INNER JOIN [${flyway:defaultSchema}].[vwConversationDetailRatings] cdr ON cdr.ConversationDetailID = cd.ID
        WHERE cd.ConversationID = c.ID AND cdr.Rating >= 8
    ) THEN 1 ELSE 0
END as HasPositiveRating,

    CASE WHEN EXISTS (
        SELECT 1 FROM [${flyway:defaultSchema}].[vwConversationDetails] cd
        INNER JOIN [${flyway:defaultSchema}].[vwConversationDetailRatings] cdr ON cdr.ConversationDetailID = cd.ID
        WHERE cd.ConversationID = c.ID AND cdr.Rating <= 3
    ) THEN 1 ELSE 0
END as HasNegativeRating,

    CASE WHEN NOT EXISTS (
        SELECT 1 FROM [${flyway:defaultSchema}].[vwConversationDetails] cd
        INNER JOIN [${flyway:defaultSchema}].[vwConversationDetailRatings] cdr ON cdr.ConversationDetailID = cd.ID
        WHERE cd.ConversationID = c.ID
    ) THEN 1 ELSE 0
END as IsUnrated

FROM [${flyway:defaultSchema}].[vwConversations] c

-- Only include conversations with new activity since last run
WHERE EXISTS (
    SELECT 1 FROM [${flyway:defaultSchema}].[vwConversationDetails] cd_new
    WHERE cd_new.ConversationID = c.ID
    {% if since %}
    AND cd_new.__mj_CreatedAt >= ''{{ since }}''
    {% endif %}
)

-- Only include conversations linked to agents that have memory enabled
AND EXISTS (
    SELECT 1 FROM [${flyway:defaultSchema}].[vwAIAgentRuns] ar
    WHERE ar.ConversationID = c.ID
    AND ar.AgentID IN ({{ agentIds }})
)

ORDER BY c.__mj_UpdatedAt DESC
'
SET
  @TechnicalDescription_2638b156 = N'Single-query optimization that replaces 4 separate RunView calls in Memory Manager (get conversations, get agent runs, get details, get ratings). Uses SQL Server FOR JSON PATH to aggregate conversation details with ratings as JSON arrays. Returns rating summary flags (HasPositiveRating, HasNegativeRating, IsUnrated) and most recent AgentRunID for scope inheritance. Reduces database round trips from 4 to 1.'
SET
  @Status_2638b156 = N'Approved'
SET
  @QualityRank_2638b156 = 9
SET
  @ExecutionCostRank_2638b156 = 3
SET
  @UsesTemplate_2638b156 = 1
SET
  @AuditQueryRuns_2638b156 = 0
SET
  @CacheEnabled_2638b156 = 0
SET
  @EmbeddingVector_2638b156 = N'[0.05079127848148346,0.09035059064626694,-0.0241005327552557,0.0002047202578978613,0.007942557334899902,-0.004986656829714775,-0.0040833973325788975,-0.013648014515638351,-0.012232557870447636,-0.016947250813245773,-0.028481926769018173,0.007967942394316196,-0.02684820257127285,0.04656028747558594,-0.052749037742614746,-0.0031639356166124344,0.021843701601028442,-0.00868343934416771,0.024816567078232765,0.024035068228840828,-0.00625630933791399,-0.005105008836835623,0.03923854976892471,-0.03631487116217613,-0.011602414771914482,-0.003479759907349944,-0.04228506609797478,0.019970396533608437,0.03680785372853279,-0.05429837480187416,0.0020721578039228916,0.03860961273312569,-0.063536137342453,0.020076200366020203,0.0000018501910972190672,-0.029065575450658798,-0.04729870334267616,0.016312794759869576,0.0121134789660573,0.033217646181583405,0.06390431523323059,0.010297387838363647,0.04633641615509987,0.013665363192558289,-0.058271877467632294,0.04765554890036583,-0.006883734837174416,-0.06572329252958298,0.046769462525844574,0.02473931387066841,-0.009251734241843224,0.032639279961586,-0.027040032669901848,0.005404791794717312,0.03869984298944473,-0.07086299359798431,0.012611155398190022,0.042279329150915146,0.06193437799811363,-0.0017248332733288407,0.036020055413246155,-0.012290241196751595,-0.010795294307172298,-0.023887621238827705,-0.00048658213927410543,0.004781071562319994,-0.027481012046337128,-0.01167088933289051,-0.005306650884449482,0.012155258096754551,0.1098610982298851,0.048767127096652985,0.014109102077782154,-0.005584047641605139,-0.023643946275115013,-0.05883141607046127,-0.0119113028049469,-0.0008175396360456944,-0.01818632148206234,0.011405295692384243,-0.0691610649228096,0.03485322743654251,-0.016906920820474625,-0.020627707242965698,-0.05224714055657387,-0.017756739631295204,-0.00005160645378055051,-0.010144558735191822,-0.012117987498641014,-0.03278453275561333,0.10722796618938446,0.009296494536101818,0.03643833100795746,-0.02586969919502735,-0.02776397578418255,0.002058778889477253,-0.018441760912537575,-0.00994481984525919,0.017424477264285088,-0.08905638009309769,0.026498032733798027,0.03623943775892258,0.03114563226699829,0.02810569480061531,0.049529869109392166,-0.06858674436807632,-0.018866688013076782,-0.037773989140987396,-0.030855953693389893,-0.0016322797164320946,-0.03939410671591759,0.0075011784210801125,-0.023640239611268044,0.0894571989774704,-0.05356133356690407,0.0033090044744312763,-0.055434998124837875,0.08320257812738419,0.0010676984675228596,-0.007338373921811581,0.009556654840707779,0.03627324849367142,-0.028003215789794922,0.024955447763204575,-0.027351753786206245,0.017706898972392082,-0.0022198003716766834,-0.02509322389960289,0.022394653409719467,-0.07395141571760178,-0.01856291852891445,-0.018150687217712402,0.031191453337669373,-0.03474811092019081,-0.005459083244204521,0.04644906520843506,0.025601867586374283,-0.07710008323192596,-0.017003830522298813,-0.0401291623711586,0.06264519691467285,-0.03787681832909584,-0.02545793540775776,-0.017351355403661728,0.03698789328336716,-0.030737601220607758,-0.039643894881010056,0.02032824046909809,-0.00019931506540160626,0.02879779413342476,-0.058180488646030426,0.019686447456479073,0.002907541813328862,0.0023019530344754457,0.003079300280660391,0.010915940627455711,0.10657579451799393,0.08073189109563828,0.006317181047052145,0.06279805302619934,0.04606578126549721,-0.000859603111166507,-0.017565233632922173,-0.0028020672034472227,0.011497484520077705,0.0007478615152649581,0.013867675326764584,0.028941577300429344,-0.027205482125282288,-0.025482267141342163,-0.015496990643441677,0.019426340237259865,-0.026243751868605614,-0.003329381812363863,0.04347588121891022,0.046181272715330124,-0.0378577895462513,-0.002381382044404745,-0.028820278123021126,0.01254812628030777,-0.031145159155130386,-0.05485319346189499,-0.04959753155708313,0.03526325896382332,0.0010121699888259172,-0.03156620264053345,0.07196877151727676,0.021316271275281906,-0.05075361207127571,-0.024181406944990158,0.018523653969168663,-0.062384121119976044,0.025164064019918442,-0.0076613579876720905,0.028020406141877174,-0.004517694003880024,-0.03566809743642807,0.050433333963155746,0.03190324828028679,-0.028339020907878876,-0.056465163826942444,-0.01460159569978714,0.013730207458138466,0.08056039363145828,-0.011897717602550983,-0.022440511733293533,-0.07959193736314774,0.03878672793507576,0.008727208711206913,0.007012821733951569,0.00516737625002861,0.021217189729213715,0.032105930149555206,-0.009648353792726994,-0.023099390789866447,0.028003400191664696,0.039157934486866,0.016207469627261162,0.0008238396840170026,-0.013398611918091774,-0.01404569111764431,0.02496291883289814,-0.029620852321386337,-0.006285957992076874,0.0005397481145337224,0.029324516654014587,0.028163200244307518,0.0014608276542276144,0.03636430948972702,0.05486462637782097,0.006569191347807646,0.0003904184268321842,0.0591057687997818,0.021048828959465027,0.010539560578763485,0.06098775565624237,0.012887216173112392,0.0705694928765297,-0.035670775920152664,-0.003907260950654745,0.04537628963589668,-0.04667634144425392,-0.02407081238925457,0.008037649095058441,0.0061867255717515945,-0.040602907538414,0.05563296750187874,-0.002667628927156329,0.019101625308394432,-0.003512762486934662,0.001137108076363802,0.030229294672608376,0.02169504202902317,-0.05029250681400299,-0.055469121783971786,-0.03266417980194092,-0.018757766112685204,0.005477202124893665,-0.03844166174530983,0.04366390034556389,-0.01916595920920372,0.02346942201256752,0.01841963268816471,-0.013052878901362419,0.04185650125145912,-0.048077140003442764,0.009478059597313404,-0.07091536372900009,0.022565769031643867,-0.004921324085444212,0.04391113668680191,0.011910381726920605,0.08163058012723923,0.0018719411455094814,-0.03828807175159454,0.03158252313733101,0.0425875261425972,0.0010985546978190541,0.040754493325948715,-0.004179877694696188,0.025889461860060692,-0.012415274046361446,-0.015056653879582882,0.004746823105961084,-0.0002814853214658797,0.01745971105992794,0.0441463403403759,-0.08236732333898544,0.014081819914281368,-0.036024268716573715,-0.016545020043849945,-0.003377856919541955,-0.02306751348078251,-0.02636226825416088,-0.01099723856896162,-0.05543310195207596,-0.0648922249674797,0.06529548764228821,0.013662722893059254,0.036326147615909576,-0.007037690375000238,-0.0361054427921772,-0.058202896267175674,-0.004697256721556187,-0.04680855572223663,0.0021172116976231337,-0.01232223305851221,0.02042219787836075,0.05537120997905731,0.03784762695431709,-0.04327843338251114,0.032823529094457626,-0.014867894351482391,-0.008223011158406734,0.03855353593826294,-0.013950797729194164,0.04459561035037041,0.027599478140473366,-0.004590993747115135,0.03264136239886284,-0.010919061489403248,-0.05871909111738205,0.035408467054367065,0.06742919236421585,0.010252798907458782,-0.07799189537763596,-0.016890371218323708,-0.007714482955634594,0.05800987407565117,-0.02045244351029396,0.005857840180397034,-0.02115759439766407,-0.06399159878492355,0.030116943642497063,-0.053240351378917694,0.003706203540787101,-0.04979139193892479,0.06886255741119385,-0.04757111892104149,0.0033437798265367746,0.00736438762396574,-0.022324025630950928,-0.02843300811946392,0.03313082829117775,-0.031460754573345184,-0.019286077469587326,0.0031424034386873245,-0.03315126895904541,-0.06568882614374161,0.014908798970282078,-0.04478200152516365,-0.013060609810054302,-0.017260616645216942,-0.01208257395774126,0.0013886390952393413,-0.024398701265454292,-0.0075802854262292385,0.004130313638597727,-0.06296239048242569,-0.021676722913980484,0.029038386419415474,0.09631688892841339,0.024205869063735008,-0.03380195051431656,0.0354977510869503,-0.040639523416757584,0.028481315821409225,-0.006406386848539114,0.0029548911843448877,0.013059730641543865,0.033372655510902405,-0.02978798747062683,-0.05105017125606537,0.06694665551185608,0.02004576474428177,-0.10536867380142212,-0.01994118094444275,-0.013440405018627644,-0.027942100539803505,-0.020736780017614365,0.03392152115702629,-0.09779267013072968,0.014945067465305328,-0.028502844274044037,0.020530885085463524,0.01761610433459282,-0.0625622346997261,-0.033886488527059555,-0.1131233349442482,0.00009574100113241002,0.012706561014056206,-0.06307659298181534,0.019195737317204475,-0.08009906113147736,0.005383370444178581,-0.017002683132886887,-0.004235582426190376,-0.021217117086052895,0.01647210866212845,-0.0007949425489641726,-0.011339214630424976,0.006899432744830847,0.0444469228386879,0.008899403735995293,-0.06134840101003647,0.03177731856703758,0.015260351821780205,0.06299184262752533,0.0032627482432872057,-0.02273254469037056,-0.03224923461675644,0.005678757559508085,-0.01799294725060463,-0.028770867735147476,0.05657487362623215,-0.013943229801952839,0.03969544544816017,0.02078286185860634,0.046805765479803085,-0.004324295558035374,0.05251304432749748,0.029305709525942802,0.022435922175645828,-0.026093272492289543,0.02631351165473461,-0.00607965188100934,0.04262903332710266,0.01061802078038454,0.02471427246928215,-0.00781203480437398,-0.014936456456780434,-0.025120357051491737,-0.0036682637874037027,-0.018968453630805016,-0.0644301250576973,0.03706567734479904,0.031014690175652504,-0.07060138136148453,-0.02515042945742607,-0.008712846785783768,-0.03514249250292778,0.018190797418355942,0.08127940446138382,-0.017786934971809387,0.018582746386528015,0.024726053699851036,0.00039170298259705305,-0.026734352111816406,-0.021657204255461693,-0.0040737902745604515,-0.00675504794344306,-0.008087733760476112,-0.02449152059853077,-0.005953727290034294,0.007129926234483719,0.013528949581086636,-0.024357624351978302,-0.07492576539516449,-0.047737520188093185,0.014164100401103497,0.05191383510828018,0.035761598497629166,0.035110652446746826,0.008612304925918579,0.013734747655689716,-0.028543705120682716,0.05263384059071541,-0.09211473166942596,0.018031325191259384,0.025148333981633186,0.06415750831365585,0.011009620502591133,0.030593188479542732,-0.023033324629068375,0.025234058499336243,0.02118276059627533,-0.015876511111855507,-0.0508064404129982,-0.012985431589186192,-0.000732322339899838,0.02684761956334114,0.019889231771230698,0.050808217376470566,-0.04824836552143097,0.00004551123856799677,0.04843232035636902,-0.07893157750368118,0.007085248362272978,-0.0434907041490078,-0.012945124879479408,-0.016079507768154144,0.00799733679741621,-0.013625946827232838,0.018292617052793503,0.002236912725493312,0.04320317879319191,-0.011262319050729275,-0.05728518217802048,0.02192917838692665,-0.05100050941109657,-0.0038374271243810654,-0.032028570771217346,-0.004153268411755562,0.014178507961332798,0.018571963533759117,0.06490568816661835,-0.04621608182787895,0.0011113806394860148,0.0038916936609894037,0.011749910190701485,0.02180490642786026,0.03846370801329613,-0.05944552272558212,-0.031017789617180824,0.03457550331950188,-0.031838394701480865,-0.03136684373021126,0.0001624780852580443,0.04812081530690193,-0.004885158967226744,0.015770161524415016,-0.006694483105093241,0.0160669032484293,-0.0043753222562372684,0.025523560121655464,-0.03197191283106804,0.015508252196013927,0.0016496420139446855,0.008066253736615181,0.06393346190452576,-0.052016470581293106,0.041149038821458817,-0.006335366051644087,-0.0408761091530323,-0.022557884454727173,-0.010689076967537403,0.0378512367606163,0.06826858222484589,0.011972835287451744,-0.07253285497426987,-0.006630072370171547,0.029759662225842476,0.013830936513841152,-0.028837310150265694,-0.017657645046710968,0.0028450982645154,0.040727175772190094,0.018832918256521225,0.053141843527555466,0.022112255915999413,-0.032845836132764816,-0.038760773837566376,-0.08138919621706009,-0.0023772651329636574,0.036029040813446045,-6.432864916884136e-33,-0.023917924612760544,-0.014684871770441532,0.006195457652211189,0.03723994642496109,-0.0597340352833271,-0.014452226459980011,-0.014286693185567856,-0.031614288687705994,-0.0014728907262906432,-0.0454246811568737,-0.019309645518660545,0.04720998555421829,0.037140704691410065,0.017804637551307678,0.024539735168218613,0.018375108018517494,0.024064848199486732,-0.015934990718960762,0.003956449218094349,0.06683484464883804,0.05707010626792908,0.07038233429193497,-0.0026173924561589956,-0.04496459290385246,0.017081035301089287,0.016864199191331863,0.04953546077013016,0.0032294809352606535,0.004290263168513775,0.01644625887274742,-0.017755873501300812,0.011755957268178463,0.0029416726902127266,0.02460000291466713,-0.00520614068955183,-0.040576498955488205,-0.053908150643110275,-0.061240725219249725,0.0105019211769104,-0.03919978067278862,-0.006003388203680515,0.005817030090838671,0.012093015015125275,0.010909541510045528,0.019264882430434227,-0.03533279895782471,0.034129075706005096,-0.009940299205482006,-0.04438069090247154,-0.030499612912535667,-0.005030960310250521,0.016664298251271248,0.0006420074496418238,0.07340309023857117,0.0007477820618078113,-0.02241343818604946,-0.00947281252592802,0.0218973346054554,-0.057180631905794144,0.03891448304057121,-0.06643245369195938,0.015900282189249992,-0.02570738084614277,0.05755329877138138,0.03457222878932953,0.015214716084301472,0.04068397358059883,0.060166239738464355,0.00036199623718857765,0.017706768587231636,-0.00989444274455309,0.06864777952432632,-0.05683824419975281,-0.0468280054628849,-0.04011251777410507,-0.007704589981585741,-0.0539516881108284,-0.01912015490233898,0.04430456832051277,0.008914164267480373,0.010646039620041847,0.023217666894197464,-0.056944120675325394,-0.010533517226576805,0.037721216678619385,0.05675901100039482,-0.0004984409315511584,-0.03318960592150688,-0.018096156418323517,-0.002046339213848114,-0.06401760131120682,0.012063666246831417,-0.002988585736602545,-0.02988538332283497,0.01409144140779972,-0.00019880582112818956,0.05567929893732071,-0.04396361485123634,-0.013401719741523266,0.015571626834571362,-0.009291345253586769,-0.020664727315306664,0.005512372124940157,0.03060385398566723,-0.014660770073533058,0.004089468624442816,0.02298607863485813,-0.02113240957260132,-0.046136461198329926,-0.009890127927064896,-0.0017711372347548604,0.02748834528028965,0.005973044782876968,0.03226775303483009,-0.008336141705513,0.04134117066860199,-0.005496539641171694,0.11610472947359085,0.03799837827682495,0.048205774277448654,-0.03318478912115097,-0.032624684274196625,0.060979388654232025,-0.026705428957939148,0.00505594490095973,0.02075597085058689,-0.045613549649715424,-0.038081854581832886,0.0028805441688746214,-0.020954394713044167,-0.005293926224112511,0.01901543326675892,2.7053718554270745e-7,0.019686926156282425,0.017047487199306488,-0.013053808361291885,0.003960337024182081,0.0027668620459735394,0.00214202213101089,0.046231482177972794,0.011082331649959087,0.03369522839784622,-0.002964071463793516,0.04340475797653198,0.017111919820308685,0.011001167818903923,0.03854682296514511,-0.07275687158107758,-0.036689192056655884,-0.0218672938644886,-0.09564562886953354,-0.07321562618017197,-0.03604140505194664,0.03735772892832756,0.0071462951600551605,0.04691056162118912,0.0017742825439199805,-0.005430781748145819,0.0074676088988780975,0.019835757091641426,-0.05317511036992073,-0.08343472331762314,0.015415129251778126,0.05399279296398163,-0.052760958671569824,-0.033376842737197876,0.01886281929910183,-0.021096426993608475,0.009936757385730743,-0.047020334750413895,0.01970226876437664,-0.025672458112239838,-0.047675274312496185,0.008177420124411583,-0.045784033834934235,-0.01186355296522379,0.06341540813446045,0.059236180037260056,-0.049784839153289795,-0.05416940152645111,0.005316439084708691,-0.008641050197184086,-0.031758345663547516,0.022063013166189194,0.03223682940006256,0.011694096028804779,0.001983350608497858,0.011517112143337727,0.03735494241118431,-0.017370957881212234,-0.04038471728563309,0.0416184663772583,-0.0342542827129364,-0.0036211232654750347,-0.09179119765758514,0.01881531998515129,0.030116280540823936,-0.021103352308273315,-0.03853075951337814,0.013337511569261551,2.6788554278417677e-34,0.039873164147138596,0.05002487450838089,0.028683243319392204,0.05554112046957016,0.029719317331910133,0.03558764606714249,0.009646526537835598,0.007612765766680241,0.055310722440481186,-0.1114618182182312,-0.007236486300826073]'
SET
  @EmbeddingModelID_2638b156 = '1D45AA65-41EC-4572-9ECD-AB2826C9B059'
SET
  @ID_2638b156 = '574FD9D5-AB9E-4FA5-A36C-C25E7D3F63FC'
EXEC [${flyway:defaultSchema}].spUpdateQuery @Name = @Name_2638b156,
  @CategoryID = @CategoryID_2638b156,
  @UserQuestion = @UserQuestion_2638b156,
  @Description = @Description_2638b156,
  @SQL = @SQL_2638b156,
  @TechnicalDescription = @TechnicalDescription_2638b156,
  @OriginalSQL = @OriginalSQL_2638b156,
  @Feedback = @Feedback_2638b156,
  @Status = @Status_2638b156,
  @QualityRank = @QualityRank_2638b156,
  @ExecutionCostRank = @ExecutionCostRank_2638b156,
  @UsesTemplate = @UsesTemplate_2638b156,
  @AuditQueryRuns = @AuditQueryRuns_2638b156,
  @CacheEnabled = @CacheEnabled_2638b156,
  @CacheTTLMinutes = @CacheTTLMinutes_2638b156,
  @CacheMaxSize = @CacheMaxSize_2638b156,
  @EmbeddingVector = @EmbeddingVector_2638b156,
  @EmbeddingModelID = @EmbeddingModelID_2638b156,
  @CacheValidationSQL = @CacheValidationSQL_2638b156,
  @ID = @ID_2638b156;

-- Save MJ: Query Parameters (core SP call only)
DECLARE @QueryID_16706b75 UNIQUEIDENTIFIER,
@Name_16706b75 NVARCHAR(255),
@Type_16706b75 NVARCHAR(50),
@IsRequired_16706b75 BIT,
@DefaultValue_16706b75 NVARCHAR(MAX),
@Description_16706b75 NVARCHAR(MAX),
@SampleValue_16706b75 NVARCHAR(MAX),
@ValidationFilters_16706b75 NVARCHAR(MAX),
@DetectionMethod_16706b75 NVARCHAR(50),
@AutoDetectConfidenceScore_16706b75 DECIMAL(3, 2),
@ID_16706b75 UNIQUEIDENTIFIER
SET
  @QueryID_16706b75 = '574FD9D5-AB9E-4FA5-A36C-C25E7D3F63FC'
SET
  @Name_16706b75 = N'since'
SET
  @Type_16706b75 = N'date'
SET
  @IsRequired_16706b75 = 0
SET
  @Description_16706b75 = N'ISO date string - only include conversations with new activity after this date'
SET
  @SampleValue_16706b75 = N'2024-01-15T10:30:00.000Z'
SET
  @DetectionMethod_16706b75 = N'AI'
SET
  @ID_16706b75 = 'DF0E9F24-CD92-4C6C-BA18-13B443160DE5'
EXEC [${flyway:defaultSchema}].spUpdateQueryParameter @QueryID = @QueryID_16706b75,
  @Name = @Name_16706b75,
  @Type = @Type_16706b75,
  @IsRequired = @IsRequired_16706b75,
  @DefaultValue = @DefaultValue_16706b75,
  @Description = @Description_16706b75,
  @SampleValue = @SampleValue_16706b75,
  @ValidationFilters = @ValidationFilters_16706b75,
  @DetectionMethod = @DetectionMethod_16706b75,
  @AutoDetectConfidenceScore = @AutoDetectConfidenceScore_16706b75,
  @ID = @ID_16706b75;

-- Save MJ: Query Parameters (core SP call only)
DECLARE @QueryID_9106024b UNIQUEIDENTIFIER,
@Name_9106024b NVARCHAR(255),
@Type_9106024b NVARCHAR(50),
@IsRequired_9106024b BIT,
@DefaultValue_9106024b NVARCHAR(MAX),
@Description_9106024b NVARCHAR(MAX),
@SampleValue_9106024b NVARCHAR(MAX),
@ValidationFilters_9106024b NVARCHAR(MAX),
@DetectionMethod_9106024b NVARCHAR(50),
@AutoDetectConfidenceScore_9106024b DECIMAL(3, 2),
@ID_9106024b UNIQUEIDENTIFIER
SET
  @QueryID_9106024b = '574FD9D5-AB9E-4FA5-A36C-C25E7D3F63FC'
SET
  @Name_9106024b = N'agentIds'
SET
  @Type_9106024b = N'string'
SET
  @IsRequired_9106024b = 1
SET
  @Description_9106024b = N'Comma-separated list of agent IDs that have memory enabled'
SET
  @SampleValue_9106024b = N'550e8400-e29b-41d4-a716-446655440000,6ba7b810-9dad-11d1-80b4-00c04fd430c8'
SET
  @DetectionMethod_9106024b = N'AI'
SET
  @ID_9106024b = 'AF4459A1-BEDA-4200-A739-4292E90EA6A1'
EXEC [${flyway:defaultSchema}].spUpdateQueryParameter @QueryID = @QueryID_9106024b,
  @Name = @Name_9106024b,
  @Type = @Type_9106024b,
  @IsRequired = @IsRequired_9106024b,
  @DefaultValue = @DefaultValue_9106024b,
  @Description = @Description_9106024b,
  @SampleValue = @SampleValue_9106024b,
  @ValidationFilters = @ValidationFilters_9106024b,
  @DetectionMethod = @DetectionMethod_9106024b,
  @AutoDetectConfidenceScore = @AutoDetectConfidenceScore_9106024b,
  @ID = @ID_9106024b;

-- Save MJ: Query Fields (core SP call only)
DECLARE @QueryID_c8d1aa27 UNIQUEIDENTIFIER,
@Name_c8d1aa27 NVARCHAR(255),
@Description_c8d1aa27 NVARCHAR(MAX),
@Sequence_c8d1aa27 INT,
@SQLBaseType_c8d1aa27 NVARCHAR(50),
@SQLFullType_c8d1aa27 NVARCHAR(100),
@SourceEntityID_c8d1aa27 UNIQUEIDENTIFIER,
@SourceFieldName_c8d1aa27 NVARCHAR(255),
@IsComputed_c8d1aa27 BIT,
@ComputationDescription_c8d1aa27 NVARCHAR(MAX),
@IsSummary_c8d1aa27 BIT,
@SummaryDescription_c8d1aa27 NVARCHAR(MAX),
@DetectionMethod_c8d1aa27 NVARCHAR(50),
@AutoDetectConfidenceScore_c8d1aa27 DECIMAL(3, 2),
@ID_c8d1aa27 UNIQUEIDENTIFIER
SET
  @QueryID_c8d1aa27 = '574FD9D5-AB9E-4FA5-A36C-C25E7D3F63FC'
SET
  @Name_c8d1aa27 = N'HasPositiveRating'
SET
  @Description_c8d1aa27 = N'Flag indicating if conversation has any rating >= 8'
SET
  @Sequence_c8d1aa27 = 5
SET
  @SQLBaseType_c8d1aa27 = N'bit'
SET
  @SQLFullType_c8d1aa27 = N'bit'
SET
  @IsComputed_c8d1aa27 = 1
SET
  @ComputationDescription_c8d1aa27 = N'EXISTS check for ratings >= 8 converted to 1/0'
SET
  @IsSummary_c8d1aa27 = 0
SET
  @DetectionMethod_c8d1aa27 = N'Manual'
SET
  @ID_c8d1aa27 = 'ADC80F10-C778-46A7-AB21-1474FF3051BA'
EXEC [${flyway:defaultSchema}].spUpdateQueryField @QueryID = @QueryID_c8d1aa27,
  @Name = @Name_c8d1aa27,
  @Description = @Description_c8d1aa27,
  @Sequence = @Sequence_c8d1aa27,
  @SQLBaseType = @SQLBaseType_c8d1aa27,
  @SQLFullType = @SQLFullType_c8d1aa27,
  @SourceEntityID = @SourceEntityID_c8d1aa27,
  @SourceFieldName = @SourceFieldName_c8d1aa27,
  @IsComputed = @IsComputed_c8d1aa27,
  @ComputationDescription = @ComputationDescription_c8d1aa27,
  @IsSummary = @IsSummary_c8d1aa27,
  @SummaryDescription = @SummaryDescription_c8d1aa27,
  @DetectionMethod = @DetectionMethod_c8d1aa27,
  @AutoDetectConfidenceScore = @AutoDetectConfidenceScore_c8d1aa27,
  @ID = @ID_c8d1aa27;

-- Save MJ: Query Fields (core SP call only)
DECLARE @QueryID_c18b1d19 UNIQUEIDENTIFIER,
@Name_c18b1d19 NVARCHAR(255),
@Description_c18b1d19 NVARCHAR(MAX),
@Sequence_c18b1d19 INT,
@SQLBaseType_c18b1d19 NVARCHAR(50),
@SQLFullType_c18b1d19 NVARCHAR(100),
@SourceEntityID_c18b1d19 UNIQUEIDENTIFIER,
@SourceFieldName_c18b1d19 NVARCHAR(255),
@IsComputed_c18b1d19 BIT,
@ComputationDescription_c18b1d19 NVARCHAR(MAX),
@IsSummary_c18b1d19 BIT,
@SummaryDescription_c18b1d19 NVARCHAR(MAX),
@DetectionMethod_c18b1d19 NVARCHAR(50),
@AutoDetectConfidenceScore_c18b1d19 DECIMAL(3, 2),
@ID_c18b1d19 UNIQUEIDENTIFIER
SET
  @QueryID_c18b1d19 = '574FD9D5-AB9E-4FA5-A36C-C25E7D3F63FC'
SET
  @Name_c18b1d19 = N'UserID'
SET
  @Description_c18b1d19 = N'Unique identifier for the user associated with the conversation'
SET
  @Sequence_c18b1d19 = 2
SET
  @SQLBaseType_c18b1d19 = N'nvarchar'
SET
  @SQLFullType_c18b1d19 = N'nvarchar(MAX)'
SET
  @SourceEntityID_c18b1d19 = '13248F34-2837-EF11-86D4-6045BDEE16E6'
SET
  @SourceFieldName_c18b1d19 = N'UserID'
SET
  @IsComputed_c18b1d19 = 0
SET
  @IsSummary_c18b1d19 = 0
SET
  @DetectionMethod_c18b1d19 = N'Manual'
SET
  @ID_c18b1d19 = 'FC47BF02-BE51-4C7C-9132-1C20ADC4FEBD'
EXEC [${flyway:defaultSchema}].spUpdateQueryField @QueryID = @QueryID_c18b1d19,
  @Name = @Name_c18b1d19,
  @Description = @Description_c18b1d19,
  @Sequence = @Sequence_c18b1d19,
  @SQLBaseType = @SQLBaseType_c18b1d19,
  @SQLFullType = @SQLFullType_c18b1d19,
  @SourceEntityID = @SourceEntityID_c18b1d19,
  @SourceFieldName = @SourceFieldName_c18b1d19,
  @IsComputed = @IsComputed_c18b1d19,
  @ComputationDescription = @ComputationDescription_c18b1d19,
  @IsSummary = @IsSummary_c18b1d19,
  @SummaryDescription = @SummaryDescription_c18b1d19,
  @DetectionMethod = @DetectionMethod_c18b1d19,
  @AutoDetectConfidenceScore = @AutoDetectConfidenceScore_c18b1d19,
  @ID = @ID_c18b1d19;

-- Save MJ: Query Fields (core SP call only)
DECLARE @QueryID_fc23bcaf UNIQUEIDENTIFIER,
@Name_fc23bcaf NVARCHAR(255),
@Description_fc23bcaf NVARCHAR(MAX),
@Sequence_fc23bcaf INT,
@SQLBaseType_fc23bcaf NVARCHAR(50),
@SQLFullType_fc23bcaf NVARCHAR(100),
@SourceEntityID_fc23bcaf UNIQUEIDENTIFIER,
@SourceFieldName_fc23bcaf NVARCHAR(255),
@IsComputed_fc23bcaf BIT,
@ComputationDescription_fc23bcaf NVARCHAR(MAX),
@IsSummary_fc23bcaf BIT,
@SummaryDescription_fc23bcaf NVARCHAR(MAX),
@DetectionMethod_fc23bcaf NVARCHAR(50),
@AutoDetectConfidenceScore_fc23bcaf DECIMAL(3, 2),
@ID_fc23bcaf UNIQUEIDENTIFIER
SET
  @QueryID_fc23bcaf = '574FD9D5-AB9E-4FA5-A36C-C25E7D3F63FC'
SET
  @Name_fc23bcaf = N'MessagesJSON'
SET
  @Description_fc23bcaf = N'Conversation details as JSON array with ratings included'
SET
  @Sequence_fc23bcaf = 4
SET
  @SQLBaseType_fc23bcaf = N'nvarchar'
SET
  @SQLFullType_fc23bcaf = N'nvarchar(MAX)'
SET
  @IsComputed_fc23bcaf = 1
SET
  @ComputationDescription_fc23bcaf = N'JSON aggregation of conversation details with ratings using FOR JSON PATH'
SET
  @IsSummary_fc23bcaf = 0
SET
  @DetectionMethod_fc23bcaf = N'Manual'
SET
  @ID_fc23bcaf = 'CB76A976-AE46-454B-B837-90A78B74ED50'
EXEC [${flyway:defaultSchema}].spUpdateQueryField @QueryID = @QueryID_fc23bcaf,
  @Name = @Name_fc23bcaf,
  @Description = @Description_fc23bcaf,
  @Sequence = @Sequence_fc23bcaf,
  @SQLBaseType = @SQLBaseType_fc23bcaf,
  @SQLFullType = @SQLFullType_fc23bcaf,
  @SourceEntityID = @SourceEntityID_fc23bcaf,
  @SourceFieldName = @SourceFieldName_fc23bcaf,
  @IsComputed = @IsComputed_fc23bcaf,
  @ComputationDescription = @ComputationDescription_fc23bcaf,
  @IsSummary = @IsSummary_fc23bcaf,
  @SummaryDescription = @SummaryDescription_fc23bcaf,
  @DetectionMethod = @DetectionMethod_fc23bcaf,
  @AutoDetectConfidenceScore = @AutoDetectConfidenceScore_fc23bcaf,
  @ID = @ID_fc23bcaf;

-- Save MJ: Query Fields (core SP call only)
DECLARE @QueryID_9fb6ef8b UNIQUEIDENTIFIER,
@Name_9fb6ef8b NVARCHAR(255),
@Description_9fb6ef8b NVARCHAR(MAX),
@Sequence_9fb6ef8b INT,
@SQLBaseType_9fb6ef8b NVARCHAR(50),
@SQLFullType_9fb6ef8b NVARCHAR(100),
@SourceEntityID_9fb6ef8b UNIQUEIDENTIFIER,
@SourceFieldName_9fb6ef8b NVARCHAR(255),
@IsComputed_9fb6ef8b BIT,
@ComputationDescription_9fb6ef8b NVARCHAR(MAX),
@IsSummary_9fb6ef8b BIT,
@SummaryDescription_9fb6ef8b NVARCHAR(MAX),
@DetectionMethod_9fb6ef8b NVARCHAR(50),
@AutoDetectConfidenceScore_9fb6ef8b DECIMAL(3, 2),
@ID_9fb6ef8b UNIQUEIDENTIFIER
SET
  @QueryID_9fb6ef8b = '574FD9D5-AB9E-4FA5-A36C-C25E7D3F63FC'
SET
  @Name_9fb6ef8b = N'AgentRunID'
SET
  @Description_9fb6ef8b = N'Most recent agent run ID for this conversation (for scope inheritance)'
SET
  @Sequence_9fb6ef8b = 3
SET
  @SQLBaseType_9fb6ef8b = N'nvarchar'
SET
  @SQLFullType_9fb6ef8b = N'nvarchar(MAX)'
SET
  @IsComputed_9fb6ef8b = 1
SET
  @ComputationDescription_9fb6ef8b = N'Scalar subquery selecting TOP 1 ID from AI Agent Runs ordered by StartedAt DESC'
SET
  @IsSummary_9fb6ef8b = 0
SET
  @DetectionMethod_9fb6ef8b = N'Manual'
SET
  @ID_9fb6ef8b = '4CAB47E1-C542-4CDD-9BEF-90BFC2786FF0'
EXEC [${flyway:defaultSchema}].spUpdateQueryField @QueryID = @QueryID_9fb6ef8b,
  @Name = @Name_9fb6ef8b,
  @Description = @Description_9fb6ef8b,
  @Sequence = @Sequence_9fb6ef8b,
  @SQLBaseType = @SQLBaseType_9fb6ef8b,
  @SQLFullType = @SQLFullType_9fb6ef8b,
  @SourceEntityID = @SourceEntityID_9fb6ef8b,
  @SourceFieldName = @SourceFieldName_9fb6ef8b,
  @IsComputed = @IsComputed_9fb6ef8b,
  @ComputationDescription = @ComputationDescription_9fb6ef8b,
  @IsSummary = @IsSummary_9fb6ef8b,
  @SummaryDescription = @SummaryDescription_9fb6ef8b,
  @DetectionMethod = @DetectionMethod_9fb6ef8b,
  @AutoDetectConfidenceScore = @AutoDetectConfidenceScore_9fb6ef8b,
  @ID = @ID_9fb6ef8b;

-- Save MJ: Query Fields (core SP call only)
DECLARE @QueryID_e6708f39 UNIQUEIDENTIFIER,
@Name_e6708f39 NVARCHAR(255),
@Description_e6708f39 NVARCHAR(MAX),
@Sequence_e6708f39 INT,
@SQLBaseType_e6708f39 NVARCHAR(50),
@SQLFullType_e6708f39 NVARCHAR(100),
@SourceEntityID_e6708f39 UNIQUEIDENTIFIER,
@SourceFieldName_e6708f39 NVARCHAR(255),
@IsComputed_e6708f39 BIT,
@ComputationDescription_e6708f39 NVARCHAR(MAX),
@IsSummary_e6708f39 BIT,
@SummaryDescription_e6708f39 NVARCHAR(MAX),
@DetectionMethod_e6708f39 NVARCHAR(50),
@AutoDetectConfidenceScore_e6708f39 DECIMAL(3, 2),
@ID_e6708f39 UNIQUEIDENTIFIER
SET
  @QueryID_e6708f39 = '574FD9D5-AB9E-4FA5-A36C-C25E7D3F63FC'
SET
  @Name_e6708f39 = N'HasNegativeRating'
SET
  @Description_e6708f39 = N'Flag indicating if conversation has any rating <= 3'
SET
  @Sequence_e6708f39 = 6
SET
  @SQLBaseType_e6708f39 = N'bit'
SET
  @SQLFullType_e6708f39 = N'bit'
SET
  @IsComputed_e6708f39 = 1
SET
  @ComputationDescription_e6708f39 = N'EXISTS check for ratings <= 3 converted to 1/0'
SET
  @IsSummary_e6708f39 = 0
SET
  @DetectionMethod_e6708f39 = N'Manual'
SET
  @ID_e6708f39 = '5A464544-F105-4F17-94F8-A0423F150812'
EXEC [${flyway:defaultSchema}].spUpdateQueryField @QueryID = @QueryID_e6708f39,
  @Name = @Name_e6708f39,
  @Description = @Description_e6708f39,
  @Sequence = @Sequence_e6708f39,
  @SQLBaseType = @SQLBaseType_e6708f39,
  @SQLFullType = @SQLFullType_e6708f39,
  @SourceEntityID = @SourceEntityID_e6708f39,
  @SourceFieldName = @SourceFieldName_e6708f39,
  @IsComputed = @IsComputed_e6708f39,
  @ComputationDescription = @ComputationDescription_e6708f39,
  @IsSummary = @IsSummary_e6708f39,
  @SummaryDescription = @SummaryDescription_e6708f39,
  @DetectionMethod = @DetectionMethod_e6708f39,
  @AutoDetectConfidenceScore = @AutoDetectConfidenceScore_e6708f39,
  @ID = @ID_e6708f39;

-- Save MJ: Query Fields (core SP call only)
DECLARE @QueryID_2c856875 UNIQUEIDENTIFIER,
@Name_2c856875 NVARCHAR(255),
@Description_2c856875 NVARCHAR(MAX),
@Sequence_2c856875 INT,
@SQLBaseType_2c856875 NVARCHAR(50),
@SQLFullType_2c856875 NVARCHAR(100),
@SourceEntityID_2c856875 UNIQUEIDENTIFIER,
@SourceFieldName_2c856875 NVARCHAR(255),
@IsComputed_2c856875 BIT,
@ComputationDescription_2c856875 NVARCHAR(MAX),
@IsSummary_2c856875 BIT,
@SummaryDescription_2c856875 NVARCHAR(MAX),
@DetectionMethod_2c856875 NVARCHAR(50),
@AutoDetectConfidenceScore_2c856875 DECIMAL(3, 2),
@ID_2c856875 UNIQUEIDENTIFIER
SET
  @QueryID_2c856875 = '574FD9D5-AB9E-4FA5-A36C-C25E7D3F63FC'
SET
  @Name_2c856875 = N'IsUnrated'
SET
  @Description_2c856875 = N'Flag indicating if conversation has no ratings'
SET
  @Sequence_2c856875 = 7
SET
  @SQLBaseType_2c856875 = N'bit'
SET
  @SQLFullType_2c856875 = N'bit'
SET
  @IsComputed_2c856875 = 1
SET
  @ComputationDescription_2c856875 = N'NOT EXISTS check for any ratings converted to 1/0'
SET
  @IsSummary_2c856875 = 0
SET
  @DetectionMethod_2c856875 = N'Manual'
SET
  @ID_2c856875 = 'F11B7F22-EF85-418E-855A-AC0EDBEE014A'
EXEC [${flyway:defaultSchema}].spUpdateQueryField @QueryID = @QueryID_2c856875,
  @Name = @Name_2c856875,
  @Description = @Description_2c856875,
  @Sequence = @Sequence_2c856875,
  @SQLBaseType = @SQLBaseType_2c856875,
  @SQLFullType = @SQLFullType_2c856875,
  @SourceEntityID = @SourceEntityID_2c856875,
  @SourceFieldName = @SourceFieldName_2c856875,
  @IsComputed = @IsComputed_2c856875,
  @ComputationDescription = @ComputationDescription_2c856875,
  @IsSummary = @IsSummary_2c856875,
  @SummaryDescription = @SummaryDescription_2c856875,
  @DetectionMethod = @DetectionMethod_2c856875,
  @AutoDetectConfidenceScore = @AutoDetectConfidenceScore_2c856875,
  @ID = @ID_2c856875;

-- Save MJ: Queries (core SP call only)
DECLARE @Name_4c584ed6 NVARCHAR(255),
@CategoryID_4c584ed6 UNIQUEIDENTIFIER,
@UserQuestion_4c584ed6 NVARCHAR(MAX),
@Description_4c584ed6 NVARCHAR(MAX),
@SQL_4c584ed6 NVARCHAR(MAX),
@TechnicalDescription_4c584ed6 NVARCHAR(MAX),
@OriginalSQL_4c584ed6 NVARCHAR(MAX),
@Feedback_4c584ed6 NVARCHAR(MAX),
@Status_4c584ed6 NVARCHAR(15),
@QualityRank_4c584ed6 INT,
@ExecutionCostRank_4c584ed6 INT,
@UsesTemplate_4c584ed6 BIT,
@AuditQueryRuns_4c584ed6 BIT,
@CacheEnabled_4c584ed6 BIT,
@CacheTTLMinutes_4c584ed6 INT,
@CacheMaxSize_4c584ed6 INT,
@EmbeddingVector_4c584ed6 NVARCHAR(MAX),
@EmbeddingModelID_4c584ed6 UNIQUEIDENTIFIER,
@CacheValidationSQL_4c584ed6 NVARCHAR(MAX),
@ID_4c584ed6 UNIQUEIDENTIFIER
SET
  @Name_4c584ed6 = N'Server Installed Version History'
SET
  @CategoryID_4c584ed6 = '17AFCCEC-6A37-EF11-86D4-000D3A4E707E'
SET
  @UserQuestion_4c584ed6 = N'Show me a list of versions installed on the server in order of most recent version first'
SET
  @SQL_4c584ed6 = N'SELECT * FROM [${flyway:defaultSchema}].flyway_schema_history ORDER BY installed_on DESC'
SET
  @Status_4c584ed6 = N'Approved'
SET
  @QualityRank_4c584ed6 = 9
SET
  @ExecutionCostRank_4c584ed6 = 3
SET
  @UsesTemplate_4c584ed6 = 1
SET
  @AuditQueryRuns_4c584ed6 = 0
SET
  @CacheEnabled_4c584ed6 = 0
SET
  @ID_4c584ed6 = '23F8423E-F36B-1410-8D9C-00021F8B792E'
EXEC [${flyway:defaultSchema}].spUpdateQuery @Name = @Name_4c584ed6,
  @CategoryID = @CategoryID_4c584ed6,
  @UserQuestion = @UserQuestion_4c584ed6,
  @Description = @Description_4c584ed6,
  @SQL = @SQL_4c584ed6,
  @TechnicalDescription = @TechnicalDescription_4c584ed6,
  @OriginalSQL = @OriginalSQL_4c584ed6,
  @Feedback = @Feedback_4c584ed6,
  @Status = @Status_4c584ed6,
  @QualityRank = @QualityRank_4c584ed6,
  @ExecutionCostRank = @ExecutionCostRank_4c584ed6,
  @UsesTemplate = @UsesTemplate_4c584ed6,
  @AuditQueryRuns = @AuditQueryRuns_4c584ed6,
  @CacheEnabled = @CacheEnabled_4c584ed6,
  @CacheTTLMinutes = @CacheTTLMinutes_4c584ed6,
  @CacheMaxSize = @CacheMaxSize_4c584ed6,
  @EmbeddingVector = @EmbeddingVector_4c584ed6,
  @EmbeddingModelID = @EmbeddingModelID_4c584ed6,
  @CacheValidationSQL = @CacheValidationSQL_4c584ed6,
  @ID = @ID_4c584ed6;

-- Save MJ: Query Fields (core SP call only)
DECLARE @QueryID_d9bac484 UNIQUEIDENTIFIER,
@Name_d9bac484 NVARCHAR(255),
@Description_d9bac484 NVARCHAR(MAX),
@Sequence_d9bac484 INT,
@SQLBaseType_d9bac484 NVARCHAR(50),
@SQLFullType_d9bac484 NVARCHAR(100),
@SourceEntityID_d9bac484 UNIQUEIDENTIFIER,
@SourceFieldName_d9bac484 NVARCHAR(255),
@IsComputed_d9bac484 BIT,
@ComputationDescription_d9bac484 NVARCHAR(MAX),
@IsSummary_d9bac484 BIT,
@SummaryDescription_d9bac484 NVARCHAR(MAX),
@DetectionMethod_d9bac484 NVARCHAR(50),
@AutoDetectConfidenceScore_d9bac484 DECIMAL(3, 2),
@ID_d9bac484 UNIQUEIDENTIFIER
SET
  @QueryID_d9bac484 = '23F8423E-F36B-1410-8D9C-00021F8B792E'
SET
  @Name_d9bac484 = N'success'
SET
  @Description_d9bac484 = N'Whether the migration was successful (1) or failed (0)'
SET
  @Sequence_d9bac484 = 10
SET
  @SQLBaseType_d9bac484 = N'bit'
SET
  @SQLFullType_d9bac484 = N'bit'
SET
  @SourceFieldName_d9bac484 = N'success'
SET
  @IsComputed_d9bac484 = 0
SET
  @IsSummary_d9bac484 = 0
SET
  @DetectionMethod_d9bac484 = N'Manual'
SET
  @ID_d9bac484 = '61B03A6B-E72A-413F-8145-22AB9D843911'
EXEC [${flyway:defaultSchema}].spUpdateQueryField @QueryID = @QueryID_d9bac484,
  @Name = @Name_d9bac484,
  @Description = @Description_d9bac484,
  @Sequence = @Sequence_d9bac484,
  @SQLBaseType = @SQLBaseType_d9bac484,
  @SQLFullType = @SQLFullType_d9bac484,
  @SourceEntityID = @SourceEntityID_d9bac484,
  @SourceFieldName = @SourceFieldName_d9bac484,
  @IsComputed = @IsComputed_d9bac484,
  @ComputationDescription = @ComputationDescription_d9bac484,
  @IsSummary = @IsSummary_d9bac484,
  @SummaryDescription = @SummaryDescription_d9bac484,
  @DetectionMethod = @DetectionMethod_d9bac484,
  @AutoDetectConfidenceScore = @AutoDetectConfidenceScore_d9bac484,
  @ID = @ID_d9bac484;

-- Save MJ: Query Fields (core SP call only)
DECLARE @QueryID_fba31937 UNIQUEIDENTIFIER,
@Name_fba31937 NVARCHAR(255),
@Description_fba31937 NVARCHAR(MAX),
@Sequence_fba31937 INT,
@SQLBaseType_fba31937 NVARCHAR(50),
@SQLFullType_fba31937 NVARCHAR(100),
@SourceEntityID_fba31937 UNIQUEIDENTIFIER,
@SourceFieldName_fba31937 NVARCHAR(255),
@IsComputed_fba31937 BIT,
@ComputationDescription_fba31937 NVARCHAR(MAX),
@IsSummary_fba31937 BIT,
@SummaryDescription_fba31937 NVARCHAR(MAX),
@DetectionMethod_fba31937 NVARCHAR(50),
@AutoDetectConfidenceScore_fba31937 DECIMAL(3, 2),
@ID_fba31937 UNIQUEIDENTIFIER
SET
  @QueryID_fba31937 = '23F8423E-F36B-1410-8D9C-00021F8B792E'
SET
  @Name_fba31937 = N'installed_by'
SET
  @Description_fba31937 = N'Database user that installed the migration'
SET
  @Sequence_fba31937 = 7
SET
  @SQLBaseType_fba31937 = N'nvarchar'
SET
  @SQLFullType_fba31937 = N'nvarchar(MAX)'
SET
  @SourceFieldName_fba31937 = N'installed_by'
SET
  @IsComputed_fba31937 = 0
SET
  @IsSummary_fba31937 = 0
SET
  @DetectionMethod_fba31937 = N'Manual'
SET
  @ID_fba31937 = 'E995B5FA-994B-4E21-9434-37140606FD19'
EXEC [${flyway:defaultSchema}].spUpdateQueryField @QueryID = @QueryID_fba31937,
  @Name = @Name_fba31937,
  @Description = @Description_fba31937,
  @Sequence = @Sequence_fba31937,
  @SQLBaseType = @SQLBaseType_fba31937,
  @SQLFullType = @SQLFullType_fba31937,
  @SourceEntityID = @SourceEntityID_fba31937,
  @SourceFieldName = @SourceFieldName_fba31937,
  @IsComputed = @IsComputed_fba31937,
  @ComputationDescription = @ComputationDescription_fba31937,
  @IsSummary = @IsSummary_fba31937,
  @SummaryDescription = @SummaryDescription_fba31937,
  @DetectionMethod = @DetectionMethod_fba31937,
  @AutoDetectConfidenceScore = @AutoDetectConfidenceScore_fba31937,
  @ID = @ID_fba31937;

-- Save MJ: Query Fields (core SP call only)
DECLARE @QueryID_cb9f8654 UNIQUEIDENTIFIER,
@Name_cb9f8654 NVARCHAR(255),
@Description_cb9f8654 NVARCHAR(MAX),
@Sequence_cb9f8654 INT,
@SQLBaseType_cb9f8654 NVARCHAR(50),
@SQLFullType_cb9f8654 NVARCHAR(100),
@SourceEntityID_cb9f8654 UNIQUEIDENTIFIER,
@SourceFieldName_cb9f8654 NVARCHAR(255),
@IsComputed_cb9f8654 BIT,
@ComputationDescription_cb9f8654 NVARCHAR(MAX),
@IsSummary_cb9f8654 BIT,
@SummaryDescription_cb9f8654 NVARCHAR(MAX),
@DetectionMethod_cb9f8654 NVARCHAR(50),
@AutoDetectConfidenceScore_cb9f8654 DECIMAL(3, 2),
@ID_cb9f8654 UNIQUEIDENTIFIER
SET
  @QueryID_cb9f8654 = '23F8423E-F36B-1410-8D9C-00021F8B792E'
SET
  @Name_cb9f8654 = N'script'
SET
  @Description_cb9f8654 = N'Name of the migration script file'
SET
  @Sequence_cb9f8654 = 5
SET
  @SQLBaseType_cb9f8654 = N'nvarchar'
SET
  @SQLFullType_cb9f8654 = N'nvarchar(MAX)'
SET
  @SourceFieldName_cb9f8654 = N'script'
SET
  @IsComputed_cb9f8654 = 0
SET
  @IsSummary_cb9f8654 = 0
SET
  @DetectionMethod_cb9f8654 = N'Manual'
SET
  @ID_cb9f8654 = '54F49295-7671-4A18-82DB-386757F3E941'
EXEC [${flyway:defaultSchema}].spUpdateQueryField @QueryID = @QueryID_cb9f8654,
  @Name = @Name_cb9f8654,
  @Description = @Description_cb9f8654,
  @Sequence = @Sequence_cb9f8654,
  @SQLBaseType = @SQLBaseType_cb9f8654,
  @SQLFullType = @SQLFullType_cb9f8654,
  @SourceEntityID = @SourceEntityID_cb9f8654,
  @SourceFieldName = @SourceFieldName_cb9f8654,
  @IsComputed = @IsComputed_cb9f8654,
  @ComputationDescription = @ComputationDescription_cb9f8654,
  @IsSummary = @IsSummary_cb9f8654,
  @SummaryDescription = @SummaryDescription_cb9f8654,
  @DetectionMethod = @DetectionMethod_cb9f8654,
  @AutoDetectConfidenceScore = @AutoDetectConfidenceScore_cb9f8654,
  @ID = @ID_cb9f8654;

-- Save MJ: Query Fields (core SP call only)
DECLARE @QueryID_5bfdbbd8 UNIQUEIDENTIFIER,
@Name_5bfdbbd8 NVARCHAR(255),
@Description_5bfdbbd8 NVARCHAR(MAX),
@Sequence_5bfdbbd8 INT,
@SQLBaseType_5bfdbbd8 NVARCHAR(50),
@SQLFullType_5bfdbbd8 NVARCHAR(100),
@SourceEntityID_5bfdbbd8 UNIQUEIDENTIFIER,
@SourceFieldName_5bfdbbd8 NVARCHAR(255),
@IsComputed_5bfdbbd8 BIT,
@ComputationDescription_5bfdbbd8 NVARCHAR(MAX),
@IsSummary_5bfdbbd8 BIT,
@SummaryDescription_5bfdbbd8 NVARCHAR(MAX),
@DetectionMethod_5bfdbbd8 NVARCHAR(50),
@AutoDetectConfidenceScore_5bfdbbd8 DECIMAL(3, 2),
@ID_5bfdbbd8 UNIQUEIDENTIFIER
SET
  @QueryID_5bfdbbd8 = '23F8423E-F36B-1410-8D9C-00021F8B792E'
SET
  @Name_5bfdbbd8 = N'execution_time'
SET
  @Description_5bfdbbd8 = N'Time in milliseconds that the migration took to execute'
SET
  @Sequence_5bfdbbd8 = 9
SET
  @SQLBaseType_5bfdbbd8 = N'decimal'
SET
  @SQLFullType_5bfdbbd8 = N'decimal(18,2)'
SET
  @SourceFieldName_5bfdbbd8 = N'execution_time'
SET
  @IsComputed_5bfdbbd8 = 0
SET
  @IsSummary_5bfdbbd8 = 0
SET
  @DetectionMethod_5bfdbbd8 = N'Manual'
SET
  @ID_5bfdbbd8 = '40D852DE-7370-4F9F-AB12-83ABCA2D08FB'
EXEC [${flyway:defaultSchema}].spUpdateQueryField @QueryID = @QueryID_5bfdbbd8,
  @Name = @Name_5bfdbbd8,
  @Description = @Description_5bfdbbd8,
  @Sequence = @Sequence_5bfdbbd8,
  @SQLBaseType = @SQLBaseType_5bfdbbd8,
  @SQLFullType = @SQLFullType_5bfdbbd8,
  @SourceEntityID = @SourceEntityID_5bfdbbd8,
  @SourceFieldName = @SourceFieldName_5bfdbbd8,
  @IsComputed = @IsComputed_5bfdbbd8,
  @ComputationDescription = @ComputationDescription_5bfdbbd8,
  @IsSummary = @IsSummary_5bfdbbd8,
  @SummaryDescription = @SummaryDescription_5bfdbbd8,
  @DetectionMethod = @DetectionMethod_5bfdbbd8,
  @AutoDetectConfidenceScore = @AutoDetectConfidenceScore_5bfdbbd8,
  @ID = @ID_5bfdbbd8;

-- Save MJ: Query Fields (core SP call only)
DECLARE @QueryID_d87f5ee6 UNIQUEIDENTIFIER,
@Name_d87f5ee6 NVARCHAR(255),
@Description_d87f5ee6 NVARCHAR(MAX),
@Sequence_d87f5ee6 INT,
@SQLBaseType_d87f5ee6 NVARCHAR(50),
@SQLFullType_d87f5ee6 NVARCHAR(100),
@SourceEntityID_d87f5ee6 UNIQUEIDENTIFIER,
@SourceFieldName_d87f5ee6 NVARCHAR(255),
@IsComputed_d87f5ee6 BIT,
@ComputationDescription_d87f5ee6 NVARCHAR(MAX),
@IsSummary_d87f5ee6 BIT,
@SummaryDescription_d87f5ee6 NVARCHAR(MAX),
@DetectionMethod_d87f5ee6 NVARCHAR(50),
@AutoDetectConfidenceScore_d87f5ee6 DECIMAL(3, 2),
@ID_d87f5ee6 UNIQUEIDENTIFIER
SET
  @QueryID_d87f5ee6 = '23F8423E-F36B-1410-8D9C-00021F8B792E'
SET
  @Name_d87f5ee6 = N'checksum'
SET
  @Description_d87f5ee6 = N'Checksum of the migration script for integrity verification'
SET
  @Sequence_d87f5ee6 = 6
SET
  @SQLBaseType_d87f5ee6 = N'decimal'
SET
  @SQLFullType_d87f5ee6 = N'decimal(18,2)'
SET
  @SourceFieldName_d87f5ee6 = N'checksum'
SET
  @IsComputed_d87f5ee6 = 0
SET
  @IsSummary_d87f5ee6 = 0
SET
  @DetectionMethod_d87f5ee6 = N'Manual'
SET
  @ID_d87f5ee6 = 'FB54C641-D2EC-4B1C-8C46-8C10683F5581'
EXEC [${flyway:defaultSchema}].spUpdateQueryField @QueryID = @QueryID_d87f5ee6,
  @Name = @Name_d87f5ee6,
  @Description = @Description_d87f5ee6,
  @Sequence = @Sequence_d87f5ee6,
  @SQLBaseType = @SQLBaseType_d87f5ee6,
  @SQLFullType = @SQLFullType_d87f5ee6,
  @SourceEntityID = @SourceEntityID_d87f5ee6,
  @SourceFieldName = @SourceFieldName_d87f5ee6,
  @IsComputed = @IsComputed_d87f5ee6,
  @ComputationDescription = @ComputationDescription_d87f5ee6,
  @IsSummary = @IsSummary_d87f5ee6,
  @SummaryDescription = @SummaryDescription_d87f5ee6,
  @DetectionMethod = @DetectionMethod_d87f5ee6,
  @AutoDetectConfidenceScore = @AutoDetectConfidenceScore_d87f5ee6,
  @ID = @ID_d87f5ee6;

-- Save MJ: Query Fields (core SP call only)
DECLARE @QueryID_1230cb8d UNIQUEIDENTIFIER,
@Name_1230cb8d NVARCHAR(255),
@Description_1230cb8d NVARCHAR(MAX),
@Sequence_1230cb8d INT,
@SQLBaseType_1230cb8d NVARCHAR(50),
@SQLFullType_1230cb8d NVARCHAR(100),
@SourceEntityID_1230cb8d UNIQUEIDENTIFIER,
@SourceFieldName_1230cb8d NVARCHAR(255),
@IsComputed_1230cb8d BIT,
@ComputationDescription_1230cb8d NVARCHAR(MAX),
@IsSummary_1230cb8d BIT,
@SummaryDescription_1230cb8d NVARCHAR(MAX),
@DetectionMethod_1230cb8d NVARCHAR(50),
@AutoDetectConfidenceScore_1230cb8d DECIMAL(3, 2),
@ID_1230cb8d UNIQUEIDENTIFIER
SET
  @QueryID_1230cb8d = '23F8423E-F36B-1410-8D9C-00021F8B792E'
SET
  @Name_1230cb8d = N'installed_rank'
SET
  @Description_1230cb8d = N'Sequential ranking of when the schema history entry was installed'
SET
  @Sequence_1230cb8d = 1
SET
  @SQLBaseType_1230cb8d = N'decimal'
SET
  @SQLFullType_1230cb8d = N'decimal(18,2)'
SET
  @SourceFieldName_1230cb8d = N'installed_rank'
SET
  @IsComputed_1230cb8d = 0
SET
  @IsSummary_1230cb8d = 0
SET
  @DetectionMethod_1230cb8d = N'Manual'
SET
  @ID_1230cb8d = '31554B62-5505-4D79-ACBF-9CC922A7D2CC'
EXEC [${flyway:defaultSchema}].spUpdateQueryField @QueryID = @QueryID_1230cb8d,
  @Name = @Name_1230cb8d,
  @Description = @Description_1230cb8d,
  @Sequence = @Sequence_1230cb8d,
  @SQLBaseType = @SQLBaseType_1230cb8d,
  @SQLFullType = @SQLFullType_1230cb8d,
  @SourceEntityID = @SourceEntityID_1230cb8d,
  @SourceFieldName = @SourceFieldName_1230cb8d,
  @IsComputed = @IsComputed_1230cb8d,
  @ComputationDescription = @ComputationDescription_1230cb8d,
  @IsSummary = @IsSummary_1230cb8d,
  @SummaryDescription = @SummaryDescription_1230cb8d,
  @DetectionMethod = @DetectionMethod_1230cb8d,
  @AutoDetectConfidenceScore = @AutoDetectConfidenceScore_1230cb8d,
  @ID = @ID_1230cb8d;

-- Save MJ: Queries (core SP call only)
DECLARE @Name_7c8126e0 NVARCHAR(255),
@CategoryID_7c8126e0 UNIQUEIDENTIFIER,
@UserQuestion_7c8126e0 NVARCHAR(MAX),
@Description_7c8126e0 NVARCHAR(MAX),
@SQL_7c8126e0 NVARCHAR(MAX),
@TechnicalDescription_7c8126e0 NVARCHAR(MAX),
@OriginalSQL_7c8126e0 NVARCHAR(MAX),
@Feedback_7c8126e0 NVARCHAR(MAX),
@Status_7c8126e0 NVARCHAR(15),
@QualityRank_7c8126e0 INT,
@ExecutionCostRank_7c8126e0 INT,
@UsesTemplate_7c8126e0 BIT,
@AuditQueryRuns_7c8126e0 BIT,
@CacheEnabled_7c8126e0 BIT,
@CacheTTLMinutes_7c8126e0 INT,
@CacheMaxSize_7c8126e0 INT,
@EmbeddingVector_7c8126e0 NVARCHAR(MAX),
@EmbeddingModelID_7c8126e0 UNIQUEIDENTIFIER,
@CacheValidationSQL_7c8126e0 NVARCHAR(MAX),
@ID_7c8126e0 UNIQUEIDENTIFIER
SET
  @Name_7c8126e0 = N'Server Installed Version History'
SET
  @CategoryID_7c8126e0 = '17AFCCEC-6A37-EF11-86D4-000D3A4E707E'
SET
  @UserQuestion_7c8126e0 = N'Show me a list of versions installed on the server in order of most recent version first'
SET
  @SQL_7c8126e0 = N'SELECT * FROM [${flyway:defaultSchema}].flyway_schema_history ORDER BY installed_on DESC'
SET
  @Status_7c8126e0 = N'Approved'
SET
  @QualityRank_7c8126e0 = 9
SET
  @ExecutionCostRank_7c8126e0 = 3
SET
  @UsesTemplate_7c8126e0 = 0
SET
  @AuditQueryRuns_7c8126e0 = 0
SET
  @CacheEnabled_7c8126e0 = 0
SET
  @ID_7c8126e0 = '23F8423E-F36B-1410-8D9C-00021F8B792E'
EXEC [${flyway:defaultSchema}].spUpdateQuery @Name = @Name_7c8126e0,
  @CategoryID = @CategoryID_7c8126e0,
  @UserQuestion = @UserQuestion_7c8126e0,
  @Description = @Description_7c8126e0,
  @SQL = @SQL_7c8126e0,
  @TechnicalDescription = @TechnicalDescription_7c8126e0,
  @OriginalSQL = @OriginalSQL_7c8126e0,
  @Feedback = @Feedback_7c8126e0,
  @Status = @Status_7c8126e0,
  @QualityRank = @QualityRank_7c8126e0,
  @ExecutionCostRank = @ExecutionCostRank_7c8126e0,
  @UsesTemplate = @UsesTemplate_7c8126e0,
  @AuditQueryRuns = @AuditQueryRuns_7c8126e0,
  @CacheEnabled = @CacheEnabled_7c8126e0,
  @CacheTTLMinutes = @CacheTTLMinutes_7c8126e0,
  @CacheMaxSize = @CacheMaxSize_7c8126e0,
  @EmbeddingVector = @EmbeddingVector_7c8126e0,
  @EmbeddingModelID = @EmbeddingModelID_7c8126e0,
  @CacheValidationSQL = @CacheValidationSQL_7c8126e0,
  @ID = @ID_7c8126e0;

-- Save MJ: Test Types (core SP call only)
DECLARE @ID_ebb552cc UNIQUEIDENTIFIER,
@Name_ebb552cc NVARCHAR(100),
@Description_ebb552cc NVARCHAR(MAX),
@DriverClass_ebb552cc NVARCHAR(255),
@Status_ebb552cc NVARCHAR(20),
@VariablesSchema_ebb552cc NVARCHAR(MAX)
SET
  @ID_ebb552cc = '2CB270C8-98B2-48B8-B582-51B49FD97C50'
SET
  @Name_ebb552cc = N'Computer Use'
SET
  @Description_ebb552cc = N'Evaluates browser-based automation through the Computer Use Vision-to-Action engine. Drives a web browser via LLM reasoning over screenshots, then evaluates results using goal-completion, URL matching, and step count oracles.'
SET
  @DriverClass_ebb552cc = N'ComputerUseTestDriver'
SET
  @Status_ebb552cc = N'Active'
EXEC [${flyway:defaultSchema}].spCreateTestType @ID = @ID_ebb552cc,
  @Name = @Name_ebb552cc,
  @Description = @Description_ebb552cc,
  @DriverClass = @DriverClass_ebb552cc,
  @Status = @Status_ebb552cc,
  @VariablesSchema = @VariablesSchema_ebb552cc;


-- End of SQL Logging Session
-- Session ID: 717e34ae-6607-45c7-9320-3fc747302dfe
-- Completed: 2026-02-24T19:34:12.162Z
-- Duration: 73082ms
-- Total Statements: 72
