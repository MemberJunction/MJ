/* SQL generated to create new entity Pipeline Stages */

      INSERT INTO [${flyway:defaultSchema}].Entity (
         ID,
         Name,
         DisplayName,
         Description,
         NameSuffix,
         BaseTable,
         BaseView,
         SchemaName,
         IncludeInAPI,
         AllowUserSearchAPI
         , TrackRecordChanges
         , AuditRecordAccess
         , AuditViewRuns
         , AllowAllRowsAPI
         , AllowCreateAPI
         , AllowUpdateAPI
         , AllowDeleteAPI
         , UserViewMaxRows
      )
      VALUES (
         'b39a8c3c-4f32-4fd7-af70-762fd92a5c56',
         'Pipeline Stages',
         NULL,
         NULL,
         NULL,
         'PipelineStage',
         'vwPipelineStages',
         'sample_crm',
         1,
         0
         , 1
         , 0
         , 0
         , 0
         , 1
         , 1
         , 1
         , 1000
      )
   

/* SQL generated to create new application sample_crm */
INSERT INTO [${flyway:defaultSchema}].Application (ID, Name, Description, SchemaAutoAddNewEntities, Path, AutoUpdatePath)
                       VALUES ('0d01724f-8163-472b-99d1-be9f435dd0eb', 'sample_crm', 'Generated for schema', 'sample_crm', 'samplecrm', 1)

/* SQL generated to add new entity Pipeline Stages to application ID: '0d01724f-8163-472b-99d1-be9f435dd0eb' */
INSERT INTO ${flyway:defaultSchema}.ApplicationEntity
                                       (ApplicationID, EntityID, Sequence) VALUES
                                       ('0d01724f-8163-472b-99d1-be9f435dd0eb', 'b39a8c3c-4f32-4fd7-af70-762fd92a5c56', (SELECT ISNULL(MAX(Sequence),0)+1 FROM ${flyway:defaultSchema}.ApplicationEntity WHERE ApplicationID = '0d01724f-8163-472b-99d1-be9f435dd0eb'))

/* SQL generated to add new permission for entity Pipeline Stages for role UI */
INSERT INTO ${flyway:defaultSchema}.EntityPermission
                                                   (EntityID, RoleID, CanRead, CanCreate, CanUpdate, CanDelete) VALUES
                                                   ('b39a8c3c-4f32-4fd7-af70-762fd92a5c56', 'E0AFCCEC-6A37-EF11-86D4-000D3A4E707E', 1, 0, 0, 0)

/* SQL generated to add new permission for entity Pipeline Stages for role Developer */
INSERT INTO ${flyway:defaultSchema}.EntityPermission
                                                   (EntityID, RoleID, CanRead, CanCreate, CanUpdate, CanDelete) VALUES
                                                   ('b39a8c3c-4f32-4fd7-af70-762fd92a5c56', 'DEAFCCEC-6A37-EF11-86D4-000D3A4E707E', 1, 1, 1, 0)

/* SQL generated to add new permission for entity Pipeline Stages for role Integration */
INSERT INTO ${flyway:defaultSchema}.EntityPermission
                                                   (EntityID, RoleID, CanRead, CanCreate, CanUpdate, CanDelete) VALUES
                                                   ('b39a8c3c-4f32-4fd7-af70-762fd92a5c56', 'DFAFCCEC-6A37-EF11-86D4-000D3A4E707E', 1, 1, 1, 1)

/* SQL generated to create new entity Companies */

      INSERT INTO [${flyway:defaultSchema}].Entity (
         ID,
         Name,
         DisplayName,
         Description,
         NameSuffix,
         BaseTable,
         BaseView,
         SchemaName,
         IncludeInAPI,
         AllowUserSearchAPI
         , TrackRecordChanges
         , AuditRecordAccess
         , AuditViewRuns
         , AllowAllRowsAPI
         , AllowCreateAPI
         , AllowUpdateAPI
         , AllowDeleteAPI
         , UserViewMaxRows
      )
      VALUES (
         'e1bf8043-c521-444a-8446-339ff0fa032b',
         'Companies',
         NULL,
         NULL,
         NULL,
         'Company',
         'vwCompanies',
         'sample_crm',
         1,
         0
         , 1
         , 0
         , 0
         , 0
         , 1
         , 1
         , 1
         , 1000
      )
   

/* SQL generated to add new entity Companies to application ID: '0D01724F-8163-472B-99D1-BE9F435DD0EB' */
INSERT INTO ${flyway:defaultSchema}.ApplicationEntity
                                       (ApplicationID, EntityID, Sequence) VALUES
                                       ('0D01724F-8163-472B-99D1-BE9F435DD0EB', 'e1bf8043-c521-444a-8446-339ff0fa032b', (SELECT ISNULL(MAX(Sequence),0)+1 FROM ${flyway:defaultSchema}.ApplicationEntity WHERE ApplicationID = '0D01724F-8163-472B-99D1-BE9F435DD0EB'))

/* SQL generated to add new permission for entity Companies for role UI */
INSERT INTO ${flyway:defaultSchema}.EntityPermission
                                                   (EntityID, RoleID, CanRead, CanCreate, CanUpdate, CanDelete) VALUES
                                                   ('e1bf8043-c521-444a-8446-339ff0fa032b', 'E0AFCCEC-6A37-EF11-86D4-000D3A4E707E', 1, 0, 0, 0)

/* SQL generated to add new permission for entity Companies for role Developer */
INSERT INTO ${flyway:defaultSchema}.EntityPermission
                                                   (EntityID, RoleID, CanRead, CanCreate, CanUpdate, CanDelete) VALUES
                                                   ('e1bf8043-c521-444a-8446-339ff0fa032b', 'DEAFCCEC-6A37-EF11-86D4-000D3A4E707E', 1, 1, 1, 0)

/* SQL generated to add new permission for entity Companies for role Integration */
INSERT INTO ${flyway:defaultSchema}.EntityPermission
                                                   (EntityID, RoleID, CanRead, CanCreate, CanUpdate, CanDelete) VALUES
                                                   ('e1bf8043-c521-444a-8446-339ff0fa032b', 'DFAFCCEC-6A37-EF11-86D4-000D3A4E707E', 1, 1, 1, 1)

/* SQL generated to create new entity Contacts */

      INSERT INTO [${flyway:defaultSchema}].Entity (
         ID,
         Name,
         DisplayName,
         Description,
         NameSuffix,
         BaseTable,
         BaseView,
         SchemaName,
         IncludeInAPI,
         AllowUserSearchAPI
         , TrackRecordChanges
         , AuditRecordAccess
         , AuditViewRuns
         , AllowAllRowsAPI
         , AllowCreateAPI
         , AllowUpdateAPI
         , AllowDeleteAPI
         , UserViewMaxRows
      )
      VALUES (
         '0b09f0bf-f617-4851-a15e-cb839a095bd6',
         'Contacts',
         NULL,
         NULL,
         NULL,
         'Contact',
         'vwContacts',
         'sample_crm',
         1,
         0
         , 1
         , 0
         , 0
         , 0
         , 1
         , 1
         , 1
         , 1000
      )
   

/* SQL generated to add new entity Contacts to application ID: '0D01724F-8163-472B-99D1-BE9F435DD0EB' */
INSERT INTO ${flyway:defaultSchema}.ApplicationEntity
                                       (ApplicationID, EntityID, Sequence) VALUES
                                       ('0D01724F-8163-472B-99D1-BE9F435DD0EB', '0b09f0bf-f617-4851-a15e-cb839a095bd6', (SELECT ISNULL(MAX(Sequence),0)+1 FROM ${flyway:defaultSchema}.ApplicationEntity WHERE ApplicationID = '0D01724F-8163-472B-99D1-BE9F435DD0EB'))

/* SQL generated to add new permission for entity Contacts for role UI */
INSERT INTO ${flyway:defaultSchema}.EntityPermission
                                                   (EntityID, RoleID, CanRead, CanCreate, CanUpdate, CanDelete) VALUES
                                                   ('0b09f0bf-f617-4851-a15e-cb839a095bd6', 'E0AFCCEC-6A37-EF11-86D4-000D3A4E707E', 1, 0, 0, 0)

/* SQL generated to add new permission for entity Contacts for role Developer */
INSERT INTO ${flyway:defaultSchema}.EntityPermission
                                                   (EntityID, RoleID, CanRead, CanCreate, CanUpdate, CanDelete) VALUES
                                                   ('0b09f0bf-f617-4851-a15e-cb839a095bd6', 'DEAFCCEC-6A37-EF11-86D4-000D3A4E707E', 1, 1, 1, 0)

/* SQL generated to add new permission for entity Contacts for role Integration */
INSERT INTO ${flyway:defaultSchema}.EntityPermission
                                                   (EntityID, RoleID, CanRead, CanCreate, CanUpdate, CanDelete) VALUES
                                                   ('0b09f0bf-f617-4851-a15e-cb839a095bd6', 'DFAFCCEC-6A37-EF11-86D4-000D3A4E707E', 1, 1, 1, 1)

/* SQL generated to create new entity Deals */

      INSERT INTO [${flyway:defaultSchema}].Entity (
         ID,
         Name,
         DisplayName,
         Description,
         NameSuffix,
         BaseTable,
         BaseView,
         SchemaName,
         IncludeInAPI,
         AllowUserSearchAPI
         , TrackRecordChanges
         , AuditRecordAccess
         , AuditViewRuns
         , AllowAllRowsAPI
         , AllowCreateAPI
         , AllowUpdateAPI
         , AllowDeleteAPI
         , UserViewMaxRows
      )
      VALUES (
         'efc8b3f3-69e7-48eb-bd3d-0373d6c6dd55',
         'Deals',
         NULL,
         NULL,
         NULL,
         'Deal',
         'vwDeals',
         'sample_crm',
         1,
         0
         , 1
         , 0
         , 0
         , 0
         , 1
         , 1
         , 1
         , 1000
      )
   

/* SQL generated to add new entity Deals to application ID: '0D01724F-8163-472B-99D1-BE9F435DD0EB' */
INSERT INTO ${flyway:defaultSchema}.ApplicationEntity
                                       (ApplicationID, EntityID, Sequence) VALUES
                                       ('0D01724F-8163-472B-99D1-BE9F435DD0EB', 'efc8b3f3-69e7-48eb-bd3d-0373d6c6dd55', (SELECT ISNULL(MAX(Sequence),0)+1 FROM ${flyway:defaultSchema}.ApplicationEntity WHERE ApplicationID = '0D01724F-8163-472B-99D1-BE9F435DD0EB'))

/* SQL generated to add new permission for entity Deals for role UI */
INSERT INTO ${flyway:defaultSchema}.EntityPermission
                                                   (EntityID, RoleID, CanRead, CanCreate, CanUpdate, CanDelete) VALUES
                                                   ('efc8b3f3-69e7-48eb-bd3d-0373d6c6dd55', 'E0AFCCEC-6A37-EF11-86D4-000D3A4E707E', 1, 0, 0, 0)

/* SQL generated to add new permission for entity Deals for role Developer */
INSERT INTO ${flyway:defaultSchema}.EntityPermission
                                                   (EntityID, RoleID, CanRead, CanCreate, CanUpdate, CanDelete) VALUES
                                                   ('efc8b3f3-69e7-48eb-bd3d-0373d6c6dd55', 'DEAFCCEC-6A37-EF11-86D4-000D3A4E707E', 1, 1, 1, 0)

/* SQL generated to add new permission for entity Deals for role Integration */
INSERT INTO ${flyway:defaultSchema}.EntityPermission
                                                   (EntityID, RoleID, CanRead, CanCreate, CanUpdate, CanDelete) VALUES
                                                   ('efc8b3f3-69e7-48eb-bd3d-0373d6c6dd55', 'DFAFCCEC-6A37-EF11-86D4-000D3A4E707E', 1, 1, 1, 1)

/* SQL generated to create new entity Activities */

      INSERT INTO [${flyway:defaultSchema}].Entity (
         ID,
         Name,
         DisplayName,
         Description,
         NameSuffix,
         BaseTable,
         BaseView,
         SchemaName,
         IncludeInAPI,
         AllowUserSearchAPI
         , TrackRecordChanges
         , AuditRecordAccess
         , AuditViewRuns
         , AllowAllRowsAPI
         , AllowCreateAPI
         , AllowUpdateAPI
         , AllowDeleteAPI
         , UserViewMaxRows
      )
      VALUES (
         '5460cfa8-0b07-4fad-8f84-6f9d1186ad05',
         'Activities',
         NULL,
         NULL,
         NULL,
         'Activity',
         'vwActivities',
         'sample_crm',
         1,
         0
         , 1
         , 0
         , 0
         , 0
         , 1
         , 1
         , 1
         , 1000
      )
   

/* SQL generated to add new entity Activities to application ID: '0D01724F-8163-472B-99D1-BE9F435DD0EB' */
INSERT INTO ${flyway:defaultSchema}.ApplicationEntity
                                       (ApplicationID, EntityID, Sequence) VALUES
                                       ('0D01724F-8163-472B-99D1-BE9F435DD0EB', '5460cfa8-0b07-4fad-8f84-6f9d1186ad05', (SELECT ISNULL(MAX(Sequence),0)+1 FROM ${flyway:defaultSchema}.ApplicationEntity WHERE ApplicationID = '0D01724F-8163-472B-99D1-BE9F435DD0EB'))

/* SQL generated to add new permission for entity Activities for role UI */
INSERT INTO ${flyway:defaultSchema}.EntityPermission
                                                   (EntityID, RoleID, CanRead, CanCreate, CanUpdate, CanDelete) VALUES
                                                   ('5460cfa8-0b07-4fad-8f84-6f9d1186ad05', 'E0AFCCEC-6A37-EF11-86D4-000D3A4E707E', 1, 0, 0, 0)

/* SQL generated to add new permission for entity Activities for role Developer */
INSERT INTO ${flyway:defaultSchema}.EntityPermission
                                                   (EntityID, RoleID, CanRead, CanCreate, CanUpdate, CanDelete) VALUES
                                                   ('5460cfa8-0b07-4fad-8f84-6f9d1186ad05', 'DEAFCCEC-6A37-EF11-86D4-000D3A4E707E', 1, 1, 1, 0)

/* SQL generated to add new permission for entity Activities for role Integration */
INSERT INTO ${flyway:defaultSchema}.EntityPermission
                                                   (EntityID, RoleID, CanRead, CanCreate, CanUpdate, CanDelete) VALUES
                                                   ('5460cfa8-0b07-4fad-8f84-6f9d1186ad05', 'DFAFCCEC-6A37-EF11-86D4-000D3A4E707E', 1, 1, 1, 1)

/* SQL generated to create new entity Products */

      INSERT INTO [${flyway:defaultSchema}].Entity (
         ID,
         Name,
         DisplayName,
         Description,
         NameSuffix,
         BaseTable,
         BaseView,
         SchemaName,
         IncludeInAPI,
         AllowUserSearchAPI
         , TrackRecordChanges
         , AuditRecordAccess
         , AuditViewRuns
         , AllowAllRowsAPI
         , AllowCreateAPI
         , AllowUpdateAPI
         , AllowDeleteAPI
         , UserViewMaxRows
      )
      VALUES (
         '00a21c35-b805-4dc6-abe9-be12b51450af',
         'Products',
         NULL,
         NULL,
         NULL,
         'Product',
         'vwProducts',
         'sample_crm',
         1,
         0
         , 1
         , 0
         , 0
         , 0
         , 1
         , 1
         , 1
         , 1000
      )
   

/* SQL generated to add new entity Products to application ID: '0D01724F-8163-472B-99D1-BE9F435DD0EB' */
INSERT INTO ${flyway:defaultSchema}.ApplicationEntity
                                       (ApplicationID, EntityID, Sequence) VALUES
                                       ('0D01724F-8163-472B-99D1-BE9F435DD0EB', '00a21c35-b805-4dc6-abe9-be12b51450af', (SELECT ISNULL(MAX(Sequence),0)+1 FROM ${flyway:defaultSchema}.ApplicationEntity WHERE ApplicationID = '0D01724F-8163-472B-99D1-BE9F435DD0EB'))

/* SQL generated to add new permission for entity Products for role UI */
INSERT INTO ${flyway:defaultSchema}.EntityPermission
                                                   (EntityID, RoleID, CanRead, CanCreate, CanUpdate, CanDelete) VALUES
                                                   ('00a21c35-b805-4dc6-abe9-be12b51450af', 'E0AFCCEC-6A37-EF11-86D4-000D3A4E707E', 1, 0, 0, 0)

/* SQL generated to add new permission for entity Products for role Developer */
INSERT INTO ${flyway:defaultSchema}.EntityPermission
                                                   (EntityID, RoleID, CanRead, CanCreate, CanUpdate, CanDelete) VALUES
                                                   ('00a21c35-b805-4dc6-abe9-be12b51450af', 'DEAFCCEC-6A37-EF11-86D4-000D3A4E707E', 1, 1, 1, 0)

/* SQL generated to add new permission for entity Products for role Integration */
INSERT INTO ${flyway:defaultSchema}.EntityPermission
                                                   (EntityID, RoleID, CanRead, CanCreate, CanUpdate, CanDelete) VALUES
                                                   ('00a21c35-b805-4dc6-abe9-be12b51450af', 'DFAFCCEC-6A37-EF11-86D4-000D3A4E707E', 1, 1, 1, 1)

/* SQL generated to create new entity Deal Products */

      INSERT INTO [${flyway:defaultSchema}].Entity (
         ID,
         Name,
         DisplayName,
         Description,
         NameSuffix,
         BaseTable,
         BaseView,
         SchemaName,
         IncludeInAPI,
         AllowUserSearchAPI
         , TrackRecordChanges
         , AuditRecordAccess
         , AuditViewRuns
         , AllowAllRowsAPI
         , AllowCreateAPI
         , AllowUpdateAPI
         , AllowDeleteAPI
         , UserViewMaxRows
      )
      VALUES (
         '2faf06fc-bbb0-4f84-8d11-3981dfc4bd37',
         'Deal Products',
         NULL,
         NULL,
         NULL,
         'DealProduct',
         'vwDealProducts',
         'sample_crm',
         1,
         0
         , 1
         , 0
         , 0
         , 0
         , 1
         , 1
         , 1
         , 1000
      )
   

/* SQL generated to add new entity Deal Products to application ID: '0D01724F-8163-472B-99D1-BE9F435DD0EB' */
INSERT INTO ${flyway:defaultSchema}.ApplicationEntity
                                       (ApplicationID, EntityID, Sequence) VALUES
                                       ('0D01724F-8163-472B-99D1-BE9F435DD0EB', '2faf06fc-bbb0-4f84-8d11-3981dfc4bd37', (SELECT ISNULL(MAX(Sequence),0)+1 FROM ${flyway:defaultSchema}.ApplicationEntity WHERE ApplicationID = '0D01724F-8163-472B-99D1-BE9F435DD0EB'))

/* SQL generated to add new permission for entity Deal Products for role UI */
INSERT INTO ${flyway:defaultSchema}.EntityPermission
                                                   (EntityID, RoleID, CanRead, CanCreate, CanUpdate, CanDelete) VALUES
                                                   ('2faf06fc-bbb0-4f84-8d11-3981dfc4bd37', 'E0AFCCEC-6A37-EF11-86D4-000D3A4E707E', 1, 0, 0, 0)

/* SQL generated to add new permission for entity Deal Products for role Developer */
INSERT INTO ${flyway:defaultSchema}.EntityPermission
                                                   (EntityID, RoleID, CanRead, CanCreate, CanUpdate, CanDelete) VALUES
                                                   ('2faf06fc-bbb0-4f84-8d11-3981dfc4bd37', 'DEAFCCEC-6A37-EF11-86D4-000D3A4E707E', 1, 1, 1, 0)

/* SQL generated to add new permission for entity Deal Products for role Integration */
INSERT INTO ${flyway:defaultSchema}.EntityPermission
                                                   (EntityID, RoleID, CanRead, CanCreate, CanUpdate, CanDelete) VALUES
                                                   ('2faf06fc-bbb0-4f84-8d11-3981dfc4bd37', 'DFAFCCEC-6A37-EF11-86D4-000D3A4E707E', 1, 1, 1, 1)

/* SQL generated to create new entity Tags */

      INSERT INTO [${flyway:defaultSchema}].Entity (
         ID,
         Name,
         DisplayName,
         Description,
         NameSuffix,
         BaseTable,
         BaseView,
         SchemaName,
         IncludeInAPI,
         AllowUserSearchAPI
         , TrackRecordChanges
         , AuditRecordAccess
         , AuditViewRuns
         , AllowAllRowsAPI
         , AllowCreateAPI
         , AllowUpdateAPI
         , AllowDeleteAPI
         , UserViewMaxRows
      )
      VALUES (
         '186842da-d62b-4f8b-a53a-dc2cf7604246',
         'Tags',
         NULL,
         NULL,
         NULL,
         'Tag',
         'vwTags',
         'sample_crm',
         1,
         0
         , 1
         , 0
         , 0
         , 0
         , 1
         , 1
         , 1
         , 1000
      )
   

/* SQL generated to add new entity Tags to application ID: '0D01724F-8163-472B-99D1-BE9F435DD0EB' */
INSERT INTO ${flyway:defaultSchema}.ApplicationEntity
                                       (ApplicationID, EntityID, Sequence) VALUES
                                       ('0D01724F-8163-472B-99D1-BE9F435DD0EB', '186842da-d62b-4f8b-a53a-dc2cf7604246', (SELECT ISNULL(MAX(Sequence),0)+1 FROM ${flyway:defaultSchema}.ApplicationEntity WHERE ApplicationID = '0D01724F-8163-472B-99D1-BE9F435DD0EB'))

/* SQL generated to add new permission for entity Tags for role UI */
INSERT INTO ${flyway:defaultSchema}.EntityPermission
                                                   (EntityID, RoleID, CanRead, CanCreate, CanUpdate, CanDelete) VALUES
                                                   ('186842da-d62b-4f8b-a53a-dc2cf7604246', 'E0AFCCEC-6A37-EF11-86D4-000D3A4E707E', 1, 0, 0, 0)

/* SQL generated to add new permission for entity Tags for role Developer */
INSERT INTO ${flyway:defaultSchema}.EntityPermission
                                                   (EntityID, RoleID, CanRead, CanCreate, CanUpdate, CanDelete) VALUES
                                                   ('186842da-d62b-4f8b-a53a-dc2cf7604246', 'DEAFCCEC-6A37-EF11-86D4-000D3A4E707E', 1, 1, 1, 0)

/* SQL generated to add new permission for entity Tags for role Integration */
INSERT INTO ${flyway:defaultSchema}.EntityPermission
                                                   (EntityID, RoleID, CanRead, CanCreate, CanUpdate, CanDelete) VALUES
                                                   ('186842da-d62b-4f8b-a53a-dc2cf7604246', 'DFAFCCEC-6A37-EF11-86D4-000D3A4E707E', 1, 1, 1, 1)

/* SQL generated to create new entity Company Tags */

      INSERT INTO [${flyway:defaultSchema}].Entity (
         ID,
         Name,
         DisplayName,
         Description,
         NameSuffix,
         BaseTable,
         BaseView,
         SchemaName,
         IncludeInAPI,
         AllowUserSearchAPI
         , TrackRecordChanges
         , AuditRecordAccess
         , AuditViewRuns
         , AllowAllRowsAPI
         , AllowCreateAPI
         , AllowUpdateAPI
         , AllowDeleteAPI
         , UserViewMaxRows
      )
      VALUES (
         '0862de5e-379e-453b-8cdd-c097dd82814b',
         'Company Tags',
         NULL,
         NULL,
         NULL,
         'CompanyTag',
         'vwCompanyTags',
         'sample_crm',
         1,
         0
         , 1
         , 0
         , 0
         , 0
         , 1
         , 1
         , 1
         , 1000
      )
   

/* SQL generated to add new entity Company Tags to application ID: '0D01724F-8163-472B-99D1-BE9F435DD0EB' */
INSERT INTO ${flyway:defaultSchema}.ApplicationEntity
                                       (ApplicationID, EntityID, Sequence) VALUES
                                       ('0D01724F-8163-472B-99D1-BE9F435DD0EB', '0862de5e-379e-453b-8cdd-c097dd82814b', (SELECT ISNULL(MAX(Sequence),0)+1 FROM ${flyway:defaultSchema}.ApplicationEntity WHERE ApplicationID = '0D01724F-8163-472B-99D1-BE9F435DD0EB'))

/* SQL generated to add new permission for entity Company Tags for role UI */
INSERT INTO ${flyway:defaultSchema}.EntityPermission
                                                   (EntityID, RoleID, CanRead, CanCreate, CanUpdate, CanDelete) VALUES
                                                   ('0862de5e-379e-453b-8cdd-c097dd82814b', 'E0AFCCEC-6A37-EF11-86D4-000D3A4E707E', 1, 0, 0, 0)

/* SQL generated to add new permission for entity Company Tags for role Developer */
INSERT INTO ${flyway:defaultSchema}.EntityPermission
                                                   (EntityID, RoleID, CanRead, CanCreate, CanUpdate, CanDelete) VALUES
                                                   ('0862de5e-379e-453b-8cdd-c097dd82814b', 'DEAFCCEC-6A37-EF11-86D4-000D3A4E707E', 1, 1, 1, 0)

/* SQL generated to add new permission for entity Company Tags for role Integration */
INSERT INTO ${flyway:defaultSchema}.EntityPermission
                                                   (EntityID, RoleID, CanRead, CanCreate, CanUpdate, CanDelete) VALUES
                                                   ('0862de5e-379e-453b-8cdd-c097dd82814b', 'DFAFCCEC-6A37-EF11-86D4-000D3A4E707E', 1, 1, 1, 1)

/* SQL generated to create new entity Contact Tags */

      INSERT INTO [${flyway:defaultSchema}].Entity (
         ID,
         Name,
         DisplayName,
         Description,
         NameSuffix,
         BaseTable,
         BaseView,
         SchemaName,
         IncludeInAPI,
         AllowUserSearchAPI
         , TrackRecordChanges
         , AuditRecordAccess
         , AuditViewRuns
         , AllowAllRowsAPI
         , AllowCreateAPI
         , AllowUpdateAPI
         , AllowDeleteAPI
         , UserViewMaxRows
      )
      VALUES (
         'fbe2251e-61b7-457d-b788-407b4a079c13',
         'Contact Tags',
         NULL,
         NULL,
         NULL,
         'ContactTag',
         'vwContactTags',
         'sample_crm',
         1,
         0
         , 1
         , 0
         , 0
         , 0
         , 1
         , 1
         , 1
         , 1000
      )
   

/* SQL generated to add new entity Contact Tags to application ID: '0D01724F-8163-472B-99D1-BE9F435DD0EB' */
INSERT INTO ${flyway:defaultSchema}.ApplicationEntity
                                       (ApplicationID, EntityID, Sequence) VALUES
                                       ('0D01724F-8163-472B-99D1-BE9F435DD0EB', 'fbe2251e-61b7-457d-b788-407b4a079c13', (SELECT ISNULL(MAX(Sequence),0)+1 FROM ${flyway:defaultSchema}.ApplicationEntity WHERE ApplicationID = '0D01724F-8163-472B-99D1-BE9F435DD0EB'))

/* SQL generated to add new permission for entity Contact Tags for role UI */
INSERT INTO ${flyway:defaultSchema}.EntityPermission
                                                   (EntityID, RoleID, CanRead, CanCreate, CanUpdate, CanDelete) VALUES
                                                   ('fbe2251e-61b7-457d-b788-407b4a079c13', 'E0AFCCEC-6A37-EF11-86D4-000D3A4E707E', 1, 0, 0, 0)

/* SQL generated to add new permission for entity Contact Tags for role Developer */
INSERT INTO ${flyway:defaultSchema}.EntityPermission
                                                   (EntityID, RoleID, CanRead, CanCreate, CanUpdate, CanDelete) VALUES
                                                   ('fbe2251e-61b7-457d-b788-407b4a079c13', 'DEAFCCEC-6A37-EF11-86D4-000D3A4E707E', 1, 1, 1, 0)

/* SQL generated to add new permission for entity Contact Tags for role Integration */
INSERT INTO ${flyway:defaultSchema}.EntityPermission
                                                   (EntityID, RoleID, CanRead, CanCreate, CanUpdate, CanDelete) VALUES
                                                   ('fbe2251e-61b7-457d-b788-407b4a079c13', 'DFAFCCEC-6A37-EF11-86D4-000D3A4E707E', 1, 1, 1, 1)

/* SQL generated to create new entity Deal Tags */

      INSERT INTO [${flyway:defaultSchema}].Entity (
         ID,
         Name,
         DisplayName,
         Description,
         NameSuffix,
         BaseTable,
         BaseView,
         SchemaName,
         IncludeInAPI,
         AllowUserSearchAPI
         , TrackRecordChanges
         , AuditRecordAccess
         , AuditViewRuns
         , AllowAllRowsAPI
         , AllowCreateAPI
         , AllowUpdateAPI
         , AllowDeleteAPI
         , UserViewMaxRows
      )
      VALUES (
         'bbcce24d-c17b-4cc2-992d-0df2cc14d210',
         'Deal Tags',
         NULL,
         NULL,
         NULL,
         'DealTag',
         'vwDealTags',
         'sample_crm',
         1,
         0
         , 1
         , 0
         , 0
         , 0
         , 1
         , 1
         , 1
         , 1000
      )
   

/* SQL generated to add new entity Deal Tags to application ID: '0D01724F-8163-472B-99D1-BE9F435DD0EB' */
INSERT INTO ${flyway:defaultSchema}.ApplicationEntity
                                       (ApplicationID, EntityID, Sequence) VALUES
                                       ('0D01724F-8163-472B-99D1-BE9F435DD0EB', 'bbcce24d-c17b-4cc2-992d-0df2cc14d210', (SELECT ISNULL(MAX(Sequence),0)+1 FROM ${flyway:defaultSchema}.ApplicationEntity WHERE ApplicationID = '0D01724F-8163-472B-99D1-BE9F435DD0EB'))

/* SQL generated to add new permission for entity Deal Tags for role UI */
INSERT INTO ${flyway:defaultSchema}.EntityPermission
                                                   (EntityID, RoleID, CanRead, CanCreate, CanUpdate, CanDelete) VALUES
                                                   ('bbcce24d-c17b-4cc2-992d-0df2cc14d210', 'E0AFCCEC-6A37-EF11-86D4-000D3A4E707E', 1, 0, 0, 0)

/* SQL generated to add new permission for entity Deal Tags for role Developer */
INSERT INTO ${flyway:defaultSchema}.EntityPermission
                                                   (EntityID, RoleID, CanRead, CanCreate, CanUpdate, CanDelete) VALUES
                                                   ('bbcce24d-c17b-4cc2-992d-0df2cc14d210', 'DEAFCCEC-6A37-EF11-86D4-000D3A4E707E', 1, 1, 1, 0)

/* SQL generated to add new permission for entity Deal Tags for role Integration */
INSERT INTO ${flyway:defaultSchema}.EntityPermission
                                                   (EntityID, RoleID, CanRead, CanCreate, CanUpdate, CanDelete) VALUES
                                                   ('bbcce24d-c17b-4cc2-992d-0df2cc14d210', 'DFAFCCEC-6A37-EF11-86D4-000D3A4E707E', 1, 1, 1, 1)

/* SQL generated to create new entity Pipelines */

      INSERT INTO [${flyway:defaultSchema}].Entity (
         ID,
         Name,
         DisplayName,
         Description,
         NameSuffix,
         BaseTable,
         BaseView,
         SchemaName,
         IncludeInAPI,
         AllowUserSearchAPI
         , TrackRecordChanges
         , AuditRecordAccess
         , AuditViewRuns
         , AllowAllRowsAPI
         , AllowCreateAPI
         , AllowUpdateAPI
         , AllowDeleteAPI
         , UserViewMaxRows
      )
      VALUES (
         'dbc820ec-bb8f-418e-92d8-85dee9f1c3f7',
         'Pipelines',
         NULL,
         NULL,
         NULL,
         'Pipeline',
         'vwPipelines',
         'sample_crm',
         1,
         0
         , 1
         , 0
         , 0
         , 0
         , 1
         , 1
         , 1
         , 1000
      )
   

/* SQL generated to add new entity Pipelines to application ID: '0D01724F-8163-472B-99D1-BE9F435DD0EB' */
INSERT INTO ${flyway:defaultSchema}.ApplicationEntity
                                       (ApplicationID, EntityID, Sequence) VALUES
                                       ('0D01724F-8163-472B-99D1-BE9F435DD0EB', 'dbc820ec-bb8f-418e-92d8-85dee9f1c3f7', (SELECT ISNULL(MAX(Sequence),0)+1 FROM ${flyway:defaultSchema}.ApplicationEntity WHERE ApplicationID = '0D01724F-8163-472B-99D1-BE9F435DD0EB'))

/* SQL generated to add new permission for entity Pipelines for role UI */
INSERT INTO ${flyway:defaultSchema}.EntityPermission
                                                   (EntityID, RoleID, CanRead, CanCreate, CanUpdate, CanDelete) VALUES
                                                   ('dbc820ec-bb8f-418e-92d8-85dee9f1c3f7', 'E0AFCCEC-6A37-EF11-86D4-000D3A4E707E', 1, 0, 0, 0)

/* SQL generated to add new permission for entity Pipelines for role Developer */
INSERT INTO ${flyway:defaultSchema}.EntityPermission
                                                   (EntityID, RoleID, CanRead, CanCreate, CanUpdate, CanDelete) VALUES
                                                   ('dbc820ec-bb8f-418e-92d8-85dee9f1c3f7', 'DEAFCCEC-6A37-EF11-86D4-000D3A4E707E', 1, 1, 1, 0)

/* SQL generated to add new permission for entity Pipelines for role Integration */
INSERT INTO ${flyway:defaultSchema}.EntityPermission
                                                   (EntityID, RoleID, CanRead, CanCreate, CanUpdate, CanDelete) VALUES
                                                   ('dbc820ec-bb8f-418e-92d8-85dee9f1c3f7', 'DFAFCCEC-6A37-EF11-86D4-000D3A4E707E', 1, 1, 1, 1)

/* SQL text to add special date field __mj_CreatedAt to entity sample_crm.Deal */
ALTER TABLE [sample_crm].[Deal] ADD __mj_CreatedAt DATETIMEOFFSET NOT NULL DEFAULT GETUTCDATE()

/* SQL text to add special date field __mj_UpdatedAt to entity sample_crm.Deal */
ALTER TABLE [sample_crm].[Deal] ADD __mj_UpdatedAt DATETIMEOFFSET NOT NULL DEFAULT GETUTCDATE()

/* SQL text to add special date field __mj_CreatedAt to entity sample_crm.DealTag */
ALTER TABLE [sample_crm].[DealTag] ADD __mj_CreatedAt DATETIMEOFFSET NOT NULL DEFAULT GETUTCDATE()

/* SQL text to add special date field __mj_UpdatedAt to entity sample_crm.DealTag */
ALTER TABLE [sample_crm].[DealTag] ADD __mj_UpdatedAt DATETIMEOFFSET NOT NULL DEFAULT GETUTCDATE()

/* SQL text to add special date field __mj_CreatedAt to entity sample_crm.Company */
ALTER TABLE [sample_crm].[Company] ADD __mj_CreatedAt DATETIMEOFFSET NOT NULL DEFAULT GETUTCDATE()

/* SQL text to add special date field __mj_UpdatedAt to entity sample_crm.Company */
ALTER TABLE [sample_crm].[Company] ADD __mj_UpdatedAt DATETIMEOFFSET NOT NULL DEFAULT GETUTCDATE()

/* SQL text to add special date field __mj_CreatedAt to entity sample_crm.DealProduct */
ALTER TABLE [sample_crm].[DealProduct] ADD __mj_CreatedAt DATETIMEOFFSET NOT NULL DEFAULT GETUTCDATE()

/* SQL text to add special date field __mj_UpdatedAt to entity sample_crm.DealProduct */
ALTER TABLE [sample_crm].[DealProduct] ADD __mj_UpdatedAt DATETIMEOFFSET NOT NULL DEFAULT GETUTCDATE()

/* SQL text to add special date field __mj_CreatedAt to entity sample_crm.ContactTag */
ALTER TABLE [sample_crm].[ContactTag] ADD __mj_CreatedAt DATETIMEOFFSET NOT NULL DEFAULT GETUTCDATE()

/* SQL text to add special date field __mj_UpdatedAt to entity sample_crm.ContactTag */
ALTER TABLE [sample_crm].[ContactTag] ADD __mj_UpdatedAt DATETIMEOFFSET NOT NULL DEFAULT GETUTCDATE()

/* SQL text to add special date field __mj_CreatedAt to entity sample_crm.Activity */
ALTER TABLE [sample_crm].[Activity] ADD __mj_CreatedAt DATETIMEOFFSET NOT NULL DEFAULT GETUTCDATE()

/* SQL text to add special date field __mj_UpdatedAt to entity sample_crm.Activity */
ALTER TABLE [sample_crm].[Activity] ADD __mj_UpdatedAt DATETIMEOFFSET NOT NULL DEFAULT GETUTCDATE()

/* SQL text to add special date field __mj_CreatedAt to entity sample_crm.PipelineStage */
ALTER TABLE [sample_crm].[PipelineStage] ADD __mj_CreatedAt DATETIMEOFFSET NOT NULL DEFAULT GETUTCDATE()

/* SQL text to add special date field __mj_UpdatedAt to entity sample_crm.PipelineStage */
ALTER TABLE [sample_crm].[PipelineStage] ADD __mj_UpdatedAt DATETIMEOFFSET NOT NULL DEFAULT GETUTCDATE()

/* SQL text to add special date field __mj_CreatedAt to entity sample_crm.Pipeline */
ALTER TABLE [sample_crm].[Pipeline] ADD __mj_CreatedAt DATETIMEOFFSET NOT NULL DEFAULT GETUTCDATE()

/* SQL text to add special date field __mj_UpdatedAt to entity sample_crm.Pipeline */
ALTER TABLE [sample_crm].[Pipeline] ADD __mj_UpdatedAt DATETIMEOFFSET NOT NULL DEFAULT GETUTCDATE()

/* SQL text to add special date field __mj_CreatedAt to entity sample_crm.Product */
ALTER TABLE [sample_crm].[Product] ADD __mj_CreatedAt DATETIMEOFFSET NOT NULL DEFAULT GETUTCDATE()

/* SQL text to add special date field __mj_UpdatedAt to entity sample_crm.Product */
ALTER TABLE [sample_crm].[Product] ADD __mj_UpdatedAt DATETIMEOFFSET NOT NULL DEFAULT GETUTCDATE()

/* SQL text to add special date field __mj_CreatedAt to entity sample_crm.CompanyTag */
ALTER TABLE [sample_crm].[CompanyTag] ADD __mj_CreatedAt DATETIMEOFFSET NOT NULL DEFAULT GETUTCDATE()

/* SQL text to add special date field __mj_UpdatedAt to entity sample_crm.CompanyTag */
ALTER TABLE [sample_crm].[CompanyTag] ADD __mj_UpdatedAt DATETIMEOFFSET NOT NULL DEFAULT GETUTCDATE()

/* SQL text to add special date field __mj_CreatedAt to entity sample_crm.Contact */
ALTER TABLE [sample_crm].[Contact] ADD __mj_CreatedAt DATETIMEOFFSET NOT NULL DEFAULT GETUTCDATE()

/* SQL text to add special date field __mj_UpdatedAt to entity sample_crm.Contact */
ALTER TABLE [sample_crm].[Contact] ADD __mj_UpdatedAt DATETIMEOFFSET NOT NULL DEFAULT GETUTCDATE()

/* SQL text to add special date field __mj_CreatedAt to entity sample_crm.Tag */
ALTER TABLE [sample_crm].[Tag] ADD __mj_CreatedAt DATETIMEOFFSET NOT NULL DEFAULT GETUTCDATE()

/* SQL text to add special date field __mj_UpdatedAt to entity sample_crm.Tag */
ALTER TABLE [sample_crm].[Tag] ADD __mj_UpdatedAt DATETIMEOFFSET NOT NULL DEFAULT GETUTCDATE()

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '4b3083d7-591f-4f3d-b77d-a8776c17a5a5'  OR 
               (EntityID = 'EFC8B3F3-69E7-48EB-BD3D-0373D6C6DD55' AND Name = 'ID')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '4b3083d7-591f-4f3d-b77d-a8776c17a5a5',
            'EFC8B3F3-69E7-48EB-BD3D-0373D6C6DD55', -- Entity: Deals
            100001,
            'ID',
            'ID',
            'Primary key for the deal record',
            'uniqueidentifier',
            16,
            0,
            0,
            0,
            'newsequentialid()',
            0,
            0,
            0,
            NULL,
            NULL,
            0,
            1,
            0,
            0,
            1,
            1,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '09b48e5d-448b-477f-85c4-366642a2d286'  OR 
               (EntityID = 'EFC8B3F3-69E7-48EB-BD3D-0373D6C6DD55' AND Name = 'CompanyID')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '09b48e5d-448b-477f-85c4-366642a2d286',
            'EFC8B3F3-69E7-48EB-BD3D-0373D6C6DD55', -- Entity: Deals
            100002,
            'CompanyID',
            'Company ID',
            'Company this deal is associated with',
            'uniqueidentifier',
            16,
            0,
            0,
            0,
            'null',
            0,
            1,
            0,
            'E1BF8043-C521-444A-8446-339FF0FA032B',
            'ID',
            0,
            0,
            1,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '8e3109bf-f13a-48ee-99fc-66bbcc164c0a'  OR 
               (EntityID = 'EFC8B3F3-69E7-48EB-BD3D-0373D6C6DD55' AND Name = 'ContactID')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '8e3109bf-f13a-48ee-99fc-66bbcc164c0a',
            'EFC8B3F3-69E7-48EB-BD3D-0373D6C6DD55', -- Entity: Deals
            100003,
            'ContactID',
            'Contact ID',
            'Primary contact for this deal',
            'uniqueidentifier',
            16,
            0,
            0,
            0,
            'null',
            0,
            1,
            0,
            '0B09F0BF-F617-4851-A15E-CB839A095BD6',
            'ID',
            0,
            0,
            1,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '761a39da-404a-47ee-8d28-959129537304'  OR 
               (EntityID = 'EFC8B3F3-69E7-48EB-BD3D-0373D6C6DD55' AND Name = 'Name')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '761a39da-404a-47ee-8d28-959129537304',
            'EFC8B3F3-69E7-48EB-BD3D-0373D6C6DD55', -- Entity: Deals
            100004,
            'Name',
            'Name',
            'Short name or title of the deal',
            'nvarchar',
            400,
            0,
            0,
            0,
            'null',
            0,
            1,
            0,
            NULL,
            NULL,
            1,
            1,
            0,
            1,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '2b0a4f06-ce05-4c69-a66b-ac0f239ea841'  OR 
               (EntityID = 'EFC8B3F3-69E7-48EB-BD3D-0373D6C6DD55' AND Name = 'Amount')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '2b0a4f06-ce05-4c69-a66b-ac0f239ea841',
            'EFC8B3F3-69E7-48EB-BD3D-0373D6C6DD55', -- Entity: Deals
            100005,
            'Amount',
            'Amount',
            'Total deal value in USD',
            'decimal',
            9,
            18,
            2,
            1,
            'null',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'cb46f0a1-d395-4aea-9474-51176e8906b2'  OR 
               (EntityID = 'EFC8B3F3-69E7-48EB-BD3D-0373D6C6DD55' AND Name = 'Stage')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'cb46f0a1-d395-4aea-9474-51176e8906b2',
            'EFC8B3F3-69E7-48EB-BD3D-0373D6C6DD55', -- Entity: Deals
            100006,
            'Stage',
            'Stage',
            'Current sales stage: Lead, Qualified, Proposal, Negotiation, Closed Won, or Closed Lost',
            'nvarchar',
            100,
            0,
            0,
            0,
            'null',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '769e285a-f756-4c15-8d0d-5f4b0eeff574'  OR 
               (EntityID = 'EFC8B3F3-69E7-48EB-BD3D-0373D6C6DD55' AND Name = 'Probability')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '769e285a-f756-4c15-8d0d-5f4b0eeff574',
            'EFC8B3F3-69E7-48EB-BD3D-0373D6C6DD55', -- Entity: Deals
            100007,
            'Probability',
            'Probability',
            'Win probability percentage from 0 to 100',
            'int',
            4,
            10,
            0,
            1,
            'null',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'c1e083c4-670a-4ae0-8ad8-929e31364354'  OR 
               (EntityID = 'EFC8B3F3-69E7-48EB-BD3D-0373D6C6DD55' AND Name = 'ExpectedCloseDate')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'c1e083c4-670a-4ae0-8ad8-929e31364354',
            'EFC8B3F3-69E7-48EB-BD3D-0373D6C6DD55', -- Entity: Deals
            100008,
            'ExpectedCloseDate',
            'Expected Close Date',
            'Projected close date',
            'datetime',
            8,
            23,
            3,
            1,
            'null',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '53ef5d5a-5d3f-4b7b-b862-385592e8c9f5'  OR 
               (EntityID = 'EFC8B3F3-69E7-48EB-BD3D-0373D6C6DD55' AND Name = 'ActualCloseDate')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '53ef5d5a-5d3f-4b7b-b862-385592e8c9f5',
            'EFC8B3F3-69E7-48EB-BD3D-0373D6C6DD55', -- Entity: Deals
            100009,
            'ActualCloseDate',
            'Actual Close Date',
            'Date the deal was actually closed, null if still open',
            'datetime',
            8,
            23,
            3,
            1,
            'null',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'eb37d1f0-0bc8-4c84-8f01-c6d109206f31'  OR 
               (EntityID = 'EFC8B3F3-69E7-48EB-BD3D-0373D6C6DD55' AND Name = 'AssignedToUserID')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'eb37d1f0-0bc8-4c84-8f01-c6d109206f31',
            'EFC8B3F3-69E7-48EB-BD3D-0373D6C6DD55', -- Entity: Deals
            100010,
            'AssignedToUserID',
            'Assigned To User ID',
            'Sales rep assigned to this deal',
            'uniqueidentifier',
            16,
            0,
            0,
            1,
            'null',
            0,
            1,
            0,
            'E1238F34-2837-EF11-86D4-6045BDEE16E6',
            'ID',
            0,
            0,
            1,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '7c1ef284-d324-4c86-90ee-b74a67e0b01e'  OR 
               (EntityID = 'EFC8B3F3-69E7-48EB-BD3D-0373D6C6DD55' AND Name = 'Notes')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '7c1ef284-d324-4c86-90ee-b74a67e0b01e',
            'EFC8B3F3-69E7-48EB-BD3D-0373D6C6DD55', -- Entity: Deals
            100011,
            'Notes',
            'Notes',
            'Free-form notes about the deal',
            'nvarchar',
            -1,
            0,
            0,
            1,
            'null',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'a83cbc9c-92d6-41ae-92db-e157bf17b421'  OR 
               (EntityID = 'EFC8B3F3-69E7-48EB-BD3D-0373D6C6DD55' AND Name = 'CreatedByUserID')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'a83cbc9c-92d6-41ae-92db-e157bf17b421',
            'EFC8B3F3-69E7-48EB-BD3D-0373D6C6DD55', -- Entity: Deals
            100012,
            'CreatedByUserID',
            'Created By User ID',
            'User who created this deal record',
            'uniqueidentifier',
            16,
            0,
            0,
            1,
            'null',
            0,
            1,
            0,
            'E1238F34-2837-EF11-86D4-6045BDEE16E6',
            'ID',
            0,
            0,
            1,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '53ea3069-808b-4c17-8787-4354406d5105'  OR 
               (EntityID = 'EFC8B3F3-69E7-48EB-BD3D-0373D6C6DD55' AND Name = '__mj_CreatedAt')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '53ea3069-808b-4c17-8787-4354406d5105',
            'EFC8B3F3-69E7-48EB-BD3D-0373D6C6DD55', -- Entity: Deals
            100013,
            '__mj_CreatedAt',
            'Created At',
            NULL,
            'datetimeoffset',
            10,
            34,
            7,
            0,
            'getutcdate()',
            0,
            0,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '68ead1e2-3719-402b-9704-1aea14255f58'  OR 
               (EntityID = 'EFC8B3F3-69E7-48EB-BD3D-0373D6C6DD55' AND Name = '__mj_UpdatedAt')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '68ead1e2-3719-402b-9704-1aea14255f58',
            'EFC8B3F3-69E7-48EB-BD3D-0373D6C6DD55', -- Entity: Deals
            100014,
            '__mj_UpdatedAt',
            'Updated At',
            NULL,
            'datetimeoffset',
            10,
            34,
            7,
            0,
            'getutcdate()',
            0,
            0,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '62babd23-31ab-4f1c-85ba-0f13bcddd0f7'  OR 
               (EntityID = 'BBCCE24D-C17B-4CC2-992D-0DF2CC14D210' AND Name = 'ID')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '62babd23-31ab-4f1c-85ba-0f13bcddd0f7',
            'BBCCE24D-C17B-4CC2-992D-0DF2CC14D210', -- Entity: Deal Tags
            100001,
            'ID',
            'ID',
            'Primary key',
            'uniqueidentifier',
            16,
            0,
            0,
            0,
            'newsequentialid()',
            0,
            0,
            0,
            NULL,
            NULL,
            0,
            1,
            0,
            0,
            1,
            1,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'd4e7e22e-37f3-4eb3-ac80-b1fbca4c2927'  OR 
               (EntityID = 'BBCCE24D-C17B-4CC2-992D-0DF2CC14D210' AND Name = 'DealID')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'd4e7e22e-37f3-4eb3-ac80-b1fbca4c2927',
            'BBCCE24D-C17B-4CC2-992D-0DF2CC14D210', -- Entity: Deal Tags
            100002,
            'DealID',
            'Deal ID',
            'The deal being tagged',
            'uniqueidentifier',
            16,
            0,
            0,
            0,
            'null',
            0,
            1,
            0,
            'EFC8B3F3-69E7-48EB-BD3D-0373D6C6DD55',
            'ID',
            0,
            0,
            1,
            0,
            0,
            1,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '930449a3-5c78-46cf-9a7d-86cab8e3ec38'  OR 
               (EntityID = 'BBCCE24D-C17B-4CC2-992D-0DF2CC14D210' AND Name = 'TagID')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '930449a3-5c78-46cf-9a7d-86cab8e3ec38',
            'BBCCE24D-C17B-4CC2-992D-0DF2CC14D210', -- Entity: Deal Tags
            100003,
            'TagID',
            'Tag ID',
            'The tag applied to the deal',
            'uniqueidentifier',
            16,
            0,
            0,
            0,
            'null',
            0,
            1,
            0,
            '186842DA-D62B-4F8B-A53A-DC2CF7604246',
            'ID',
            0,
            0,
            1,
            0,
            0,
            1,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'b290ec3c-6304-45c8-b283-80aae00abb78'  OR 
               (EntityID = 'BBCCE24D-C17B-4CC2-992D-0DF2CC14D210' AND Name = '__mj_CreatedAt')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'b290ec3c-6304-45c8-b283-80aae00abb78',
            'BBCCE24D-C17B-4CC2-992D-0DF2CC14D210', -- Entity: Deal Tags
            100004,
            '__mj_CreatedAt',
            'Created At',
            NULL,
            'datetimeoffset',
            10,
            34,
            7,
            0,
            'getutcdate()',
            0,
            0,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '05774bde-bb4e-44be-9d91-4d869cdfaff0'  OR 
               (EntityID = 'BBCCE24D-C17B-4CC2-992D-0DF2CC14D210' AND Name = '__mj_UpdatedAt')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '05774bde-bb4e-44be-9d91-4d869cdfaff0',
            'BBCCE24D-C17B-4CC2-992D-0DF2CC14D210', -- Entity: Deal Tags
            100005,
            '__mj_UpdatedAt',
            'Updated At',
            NULL,
            'datetimeoffset',
            10,
            34,
            7,
            0,
            'getutcdate()',
            0,
            0,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '11acb3a8-8ecc-4fab-ad40-517f8b2658db'  OR 
               (EntityID = 'E1BF8043-C521-444A-8446-339FF0FA032B' AND Name = 'ID')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '11acb3a8-8ecc-4fab-ad40-517f8b2658db',
            'E1BF8043-C521-444A-8446-339FF0FA032B', -- Entity: Companies
            100001,
            'ID',
            'ID',
            'Primary key for the company record',
            'uniqueidentifier',
            16,
            0,
            0,
            0,
            'newsequentialid()',
            0,
            0,
            0,
            NULL,
            NULL,
            0,
            1,
            0,
            0,
            1,
            1,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'd1483621-5a55-4e44-af2c-5a0c4d2d02fb'  OR 
               (EntityID = 'E1BF8043-C521-444A-8446-339FF0FA032B' AND Name = 'Name')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'd1483621-5a55-4e44-af2c-5a0c4d2d02fb',
            'E1BF8043-C521-444A-8446-339FF0FA032B', -- Entity: Companies
            100002,
            'Name',
            'Name',
            'Legal or trading name of the company',
            'nvarchar',
            400,
            0,
            0,
            0,
            'null',
            0,
            1,
            0,
            NULL,
            NULL,
            1,
            1,
            0,
            1,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '4ab79a33-ba4f-456e-a6bc-cbc6f1d6f3db'  OR 
               (EntityID = 'E1BF8043-C521-444A-8446-339FF0FA032B' AND Name = 'Industry')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '4ab79a33-ba4f-456e-a6bc-cbc6f1d6f3db',
            'E1BF8043-C521-444A-8446-339FF0FA032B', -- Entity: Companies
            100003,
            'Industry',
            'Industry',
            'Industry vertical the company operates in',
            'nvarchar',
            200,
            0,
            0,
            1,
            'null',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '8c5dbe94-a656-45b0-9f17-ce55f36b7e85'  OR 
               (EntityID = 'E1BF8043-C521-444A-8446-339FF0FA032B' AND Name = 'Website')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '8c5dbe94-a656-45b0-9f17-ce55f36b7e85',
            'E1BF8043-C521-444A-8446-339FF0FA032B', -- Entity: Companies
            100004,
            'Website',
            'Website',
            'Company website URL',
            'nvarchar',
            1000,
            0,
            0,
            1,
            'null',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '456bcdd7-46f4-45fc-9d85-85cb83f2d769'  OR 
               (EntityID = 'E1BF8043-C521-444A-8446-339FF0FA032B' AND Name = 'Phone')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '456bcdd7-46f4-45fc-9d85-85cb83f2d769',
            'E1BF8043-C521-444A-8446-339FF0FA032B', -- Entity: Companies
            100005,
            'Phone',
            'Phone',
            'Main phone number',
            'nvarchar',
            100,
            0,
            0,
            1,
            'null',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '1030d2e8-f9c0-4741-8950-3556892a55b6'  OR 
               (EntityID = 'E1BF8043-C521-444A-8446-339FF0FA032B' AND Name = 'AnnualRevenue')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '1030d2e8-f9c0-4741-8950-3556892a55b6',
            'E1BF8043-C521-444A-8446-339FF0FA032B', -- Entity: Companies
            100006,
            'AnnualRevenue',
            'Annual Revenue',
            'Estimated annual revenue in USD',
            'decimal',
            9,
            18,
            2,
            1,
            'null',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '0363c679-d6dc-4d48-9c36-222211c748b2'  OR 
               (EntityID = 'E1BF8043-C521-444A-8446-339FF0FA032B' AND Name = 'EmployeeCount')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '0363c679-d6dc-4d48-9c36-222211c748b2',
            'E1BF8043-C521-444A-8446-339FF0FA032B', -- Entity: Companies
            100007,
            'EmployeeCount',
            'Employee Count',
            'Approximate number of employees',
            'int',
            4,
            10,
            0,
            1,
            'null',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'acccbef9-6aff-4596-ba4c-ca0ee9aa174f'  OR 
               (EntityID = 'E1BF8043-C521-444A-8446-339FF0FA032B' AND Name = 'Status')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'acccbef9-6aff-4596-ba4c-ca0ee9aa174f',
            'E1BF8043-C521-444A-8446-339FF0FA032B', -- Entity: Companies
            100008,
            'Status',
            'Status',
            'Current relationship status: Active, Inactive, Prospect, or Churned',
            'nvarchar',
            40,
            0,
            0,
            0,
            'null',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '5d5bff02-3687-49c5-8012-06ddcd4e7e9c'  OR 
               (EntityID = 'E1BF8043-C521-444A-8446-339FF0FA032B' AND Name = 'Notes')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '5d5bff02-3687-49c5-8012-06ddcd4e7e9c',
            'E1BF8043-C521-444A-8446-339FF0FA032B', -- Entity: Companies
            100009,
            'Notes',
            'Notes',
            'Free-form notes about the company',
            'nvarchar',
            -1,
            0,
            0,
            1,
            'null',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'd4e9496a-bd23-4f2a-9985-833ca34d8838'  OR 
               (EntityID = 'E1BF8043-C521-444A-8446-339FF0FA032B' AND Name = 'CreatedByUserID')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'd4e9496a-bd23-4f2a-9985-833ca34d8838',
            'E1BF8043-C521-444A-8446-339FF0FA032B', -- Entity: Companies
            100010,
            'CreatedByUserID',
            'Created By User ID',
            'User who created this company record',
            'uniqueidentifier',
            16,
            0,
            0,
            1,
            'null',
            0,
            1,
            0,
            'E1238F34-2837-EF11-86D4-6045BDEE16E6',
            'ID',
            0,
            0,
            1,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '11dd2ae8-2aff-4cbf-9543-1b1221472d10'  OR 
               (EntityID = 'E1BF8043-C521-444A-8446-339FF0FA032B' AND Name = '__mj_CreatedAt')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '11dd2ae8-2aff-4cbf-9543-1b1221472d10',
            'E1BF8043-C521-444A-8446-339FF0FA032B', -- Entity: Companies
            100011,
            '__mj_CreatedAt',
            'Created At',
            NULL,
            'datetimeoffset',
            10,
            34,
            7,
            0,
            'getutcdate()',
            0,
            0,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'b8c33ef9-4325-4a4b-9970-62af45729c24'  OR 
               (EntityID = 'E1BF8043-C521-444A-8446-339FF0FA032B' AND Name = '__mj_UpdatedAt')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'b8c33ef9-4325-4a4b-9970-62af45729c24',
            'E1BF8043-C521-444A-8446-339FF0FA032B', -- Entity: Companies
            100012,
            '__mj_UpdatedAt',
            'Updated At',
            NULL,
            'datetimeoffset',
            10,
            34,
            7,
            0,
            'getutcdate()',
            0,
            0,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '2922aedd-83a6-40ca-8784-53bde4432206'  OR 
               (EntityID = '2FAF06FC-BBB0-4F84-8D11-3981DFC4BD37' AND Name = 'ID')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '2922aedd-83a6-40ca-8784-53bde4432206',
            '2FAF06FC-BBB0-4F84-8D11-3981DFC4BD37', -- Entity: Deal Products
            100001,
            'ID',
            'ID',
            'Primary key for the deal-product link',
            'uniqueidentifier',
            16,
            0,
            0,
            0,
            'newsequentialid()',
            0,
            0,
            0,
            NULL,
            NULL,
            0,
            1,
            0,
            0,
            1,
            1,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '6df34e22-7bbe-4b4d-a15a-83cf2f01db13'  OR 
               (EntityID = '2FAF06FC-BBB0-4F84-8D11-3981DFC4BD37' AND Name = 'DealID')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '6df34e22-7bbe-4b4d-a15a-83cf2f01db13',
            '2FAF06FC-BBB0-4F84-8D11-3981DFC4BD37', -- Entity: Deal Products
            100002,
            'DealID',
            'Deal ID',
            'Deal this product is part of',
            'uniqueidentifier',
            16,
            0,
            0,
            0,
            'null',
            0,
            1,
            0,
            'EFC8B3F3-69E7-48EB-BD3D-0373D6C6DD55',
            'ID',
            0,
            0,
            1,
            0,
            0,
            1,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '333411d9-ea1d-4783-b65b-af5061605e2a'  OR 
               (EntityID = '2FAF06FC-BBB0-4F84-8D11-3981DFC4BD37' AND Name = 'ProductID')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '333411d9-ea1d-4783-b65b-af5061605e2a',
            '2FAF06FC-BBB0-4F84-8D11-3981DFC4BD37', -- Entity: Deal Products
            100003,
            'ProductID',
            'Product ID',
            'Product being sold in this deal',
            'uniqueidentifier',
            16,
            0,
            0,
            0,
            'null',
            0,
            1,
            0,
            '00A21C35-B805-4DC6-ABE9-BE12B51450AF',
            'ID',
            0,
            0,
            1,
            0,
            0,
            1,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '0088a38b-b887-4559-a324-aa9bbc7ea41f'  OR 
               (EntityID = '2FAF06FC-BBB0-4F84-8D11-3981DFC4BD37' AND Name = 'Quantity')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '0088a38b-b887-4559-a324-aa9bbc7ea41f',
            '2FAF06FC-BBB0-4F84-8D11-3981DFC4BD37', -- Entity: Deal Products
            100004,
            'Quantity',
            'Quantity',
            'Number of units included in the deal',
            'int',
            4,
            10,
            0,
            0,
            '(1)',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '596cf2f9-9055-4762-bd2c-2013cb163b4b'  OR 
               (EntityID = '2FAF06FC-BBB0-4F84-8D11-3981DFC4BD37' AND Name = 'UnitPrice')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '596cf2f9-9055-4762-bd2c-2013cb163b4b',
            '2FAF06FC-BBB0-4F84-8D11-3981DFC4BD37', -- Entity: Deal Products
            100005,
            'UnitPrice',
            'Unit Price',
            'Price per unit for this deal, may differ from catalog price',
            'decimal',
            9,
            18,
            2,
            0,
            'null',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '204e99cd-2397-437c-8a57-707604364820'  OR 
               (EntityID = '2FAF06FC-BBB0-4F84-8D11-3981DFC4BD37' AND Name = 'Discount')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '204e99cd-2397-437c-8a57-707604364820',
            '2FAF06FC-BBB0-4F84-8D11-3981DFC4BD37', -- Entity: Deal Products
            100006,
            'Discount',
            'Discount',
            'Discount percentage from 0 to 100',
            'decimal',
            5,
            5,
            2,
            0,
            '(0)',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '3ef4a5d8-3a2b-41b6-b1f6-3094663973f9'  OR 
               (EntityID = '2FAF06FC-BBB0-4F84-8D11-3981DFC4BD37' AND Name = '__mj_CreatedAt')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '3ef4a5d8-3a2b-41b6-b1f6-3094663973f9',
            '2FAF06FC-BBB0-4F84-8D11-3981DFC4BD37', -- Entity: Deal Products
            100007,
            '__mj_CreatedAt',
            'Created At',
            NULL,
            'datetimeoffset',
            10,
            34,
            7,
            0,
            'getutcdate()',
            0,
            0,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'ad127c59-6d58-40b4-90f6-e1bdf090b604'  OR 
               (EntityID = '2FAF06FC-BBB0-4F84-8D11-3981DFC4BD37' AND Name = '__mj_UpdatedAt')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'ad127c59-6d58-40b4-90f6-e1bdf090b604',
            '2FAF06FC-BBB0-4F84-8D11-3981DFC4BD37', -- Entity: Deal Products
            100008,
            '__mj_UpdatedAt',
            'Updated At',
            NULL,
            'datetimeoffset',
            10,
            34,
            7,
            0,
            'getutcdate()',
            0,
            0,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '5c2dfb76-ad16-4477-9cca-303ed5a21c1e'  OR 
               (EntityID = 'FBE2251E-61B7-457D-B788-407B4A079C13' AND Name = 'ID')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '5c2dfb76-ad16-4477-9cca-303ed5a21c1e',
            'FBE2251E-61B7-457D-B788-407B4A079C13', -- Entity: Contact Tags
            100001,
            'ID',
            'ID',
            'Primary key',
            'uniqueidentifier',
            16,
            0,
            0,
            0,
            'newsequentialid()',
            0,
            0,
            0,
            NULL,
            NULL,
            0,
            1,
            0,
            0,
            1,
            1,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'ebf85935-a45a-470c-aad5-1471988f55a3'  OR 
               (EntityID = 'FBE2251E-61B7-457D-B788-407B4A079C13' AND Name = 'ContactID')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'ebf85935-a45a-470c-aad5-1471988f55a3',
            'FBE2251E-61B7-457D-B788-407B4A079C13', -- Entity: Contact Tags
            100002,
            'ContactID',
            'Contact ID',
            'The contact being tagged',
            'uniqueidentifier',
            16,
            0,
            0,
            0,
            'null',
            0,
            1,
            0,
            '0B09F0BF-F617-4851-A15E-CB839A095BD6',
            'ID',
            0,
            0,
            1,
            0,
            0,
            1,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '655f55fe-6834-4409-81ce-94eebb97c1f5'  OR 
               (EntityID = 'FBE2251E-61B7-457D-B788-407B4A079C13' AND Name = 'TagID')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '655f55fe-6834-4409-81ce-94eebb97c1f5',
            'FBE2251E-61B7-457D-B788-407B4A079C13', -- Entity: Contact Tags
            100003,
            'TagID',
            'Tag ID',
            'The tag applied to the contact',
            'uniqueidentifier',
            16,
            0,
            0,
            0,
            'null',
            0,
            1,
            0,
            '186842DA-D62B-4F8B-A53A-DC2CF7604246',
            'ID',
            0,
            0,
            1,
            0,
            0,
            1,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'fefa2f26-d4c4-4994-b82d-8706a7b1be2f'  OR 
               (EntityID = 'FBE2251E-61B7-457D-B788-407B4A079C13' AND Name = '__mj_CreatedAt')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'fefa2f26-d4c4-4994-b82d-8706a7b1be2f',
            'FBE2251E-61B7-457D-B788-407B4A079C13', -- Entity: Contact Tags
            100004,
            '__mj_CreatedAt',
            'Created At',
            NULL,
            'datetimeoffset',
            10,
            34,
            7,
            0,
            'getutcdate()',
            0,
            0,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '713f3757-9f26-4491-86c4-1e032ea44f35'  OR 
               (EntityID = 'FBE2251E-61B7-457D-B788-407B4A079C13' AND Name = '__mj_UpdatedAt')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '713f3757-9f26-4491-86c4-1e032ea44f35',
            'FBE2251E-61B7-457D-B788-407B4A079C13', -- Entity: Contact Tags
            100005,
            '__mj_UpdatedAt',
            'Updated At',
            NULL,
            'datetimeoffset',
            10,
            34,
            7,
            0,
            'getutcdate()',
            0,
            0,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '712f0ce1-64d0-4344-9b16-9d170ec41fb6'  OR 
               (EntityID = '5460CFA8-0B07-4FAD-8F84-6F9D1186AD05' AND Name = 'ID')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '712f0ce1-64d0-4344-9b16-9d170ec41fb6',
            '5460CFA8-0B07-4FAD-8F84-6F9D1186AD05', -- Entity: Activities
            100001,
            'ID',
            'ID',
            'Primary key for the activity record',
            'uniqueidentifier',
            16,
            0,
            0,
            0,
            'newsequentialid()',
            0,
            0,
            0,
            NULL,
            NULL,
            0,
            1,
            0,
            0,
            1,
            1,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '633d1e40-f506-4a2d-8d53-eaa1b34a6248'  OR 
               (EntityID = '5460CFA8-0B07-4FAD-8F84-6F9D1186AD05' AND Name = 'Type')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '633d1e40-f506-4a2d-8d53-eaa1b34a6248',
            '5460CFA8-0B07-4FAD-8F84-6F9D1186AD05', -- Entity: Activities
            100002,
            'Type',
            'Type',
            'Activity type: Call, Email, Meeting, Note, or Task',
            'nvarchar',
            40,
            0,
            0,
            0,
            'null',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'a68ce8f2-ef31-418a-af6f-7f78a640ccba'  OR 
               (EntityID = '5460CFA8-0B07-4FAD-8F84-6F9D1186AD05' AND Name = 'Subject')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'a68ce8f2-ef31-418a-af6f-7f78a640ccba',
            '5460CFA8-0B07-4FAD-8F84-6F9D1186AD05', -- Entity: Activities
            100003,
            'Subject',
            'Subject',
            'Brief subject line for the activity',
            'nvarchar',
            1000,
            0,
            0,
            0,
            'null',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '33c1fbac-3196-4d77-a8d0-4df718c9564f'  OR 
               (EntityID = '5460CFA8-0B07-4FAD-8F84-6F9D1186AD05' AND Name = 'Description')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '33c1fbac-3196-4d77-a8d0-4df718c9564f',
            '5460CFA8-0B07-4FAD-8F84-6F9D1186AD05', -- Entity: Activities
            100004,
            'Description',
            'Description',
            'Detailed description or body of the activity',
            'nvarchar',
            -1,
            0,
            0,
            1,
            'null',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '91265445-63c6-44ef-abfe-a1ab90764d62'  OR 
               (EntityID = '5460CFA8-0B07-4FAD-8F84-6F9D1186AD05' AND Name = 'ActivityDate')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '91265445-63c6-44ef-abfe-a1ab90764d62',
            '5460CFA8-0B07-4FAD-8F84-6F9D1186AD05', -- Entity: Activities
            100005,
            'ActivityDate',
            'Activity Date',
            'When the activity occurred or is scheduled',
            'datetime',
            8,
            23,
            3,
            0,
            'getutcdate()',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'e70f7cf4-c29b-4fd5-9e53-35439a8994f3'  OR 
               (EntityID = '5460CFA8-0B07-4FAD-8F84-6F9D1186AD05' AND Name = 'DurationMinutes')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'e70f7cf4-c29b-4fd5-9e53-35439a8994f3',
            '5460CFA8-0B07-4FAD-8F84-6F9D1186AD05', -- Entity: Activities
            100006,
            'DurationMinutes',
            'Duration Minutes',
            'Duration of the activity in minutes',
            'int',
            4,
            10,
            0,
            1,
            'null',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '9253c957-ca7a-42b9-b286-c51747d343dd'  OR 
               (EntityID = '5460CFA8-0B07-4FAD-8F84-6F9D1186AD05' AND Name = 'CompanyID')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '9253c957-ca7a-42b9-b286-c51747d343dd',
            '5460CFA8-0B07-4FAD-8F84-6F9D1186AD05', -- Entity: Activities
            100007,
            'CompanyID',
            'Company ID',
            'Optional link to a company',
            'uniqueidentifier',
            16,
            0,
            0,
            1,
            'null',
            0,
            1,
            0,
            'E1BF8043-C521-444A-8446-339FF0FA032B',
            'ID',
            0,
            0,
            1,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'f7dc9630-3748-4703-976c-d49662b6878a'  OR 
               (EntityID = '5460CFA8-0B07-4FAD-8F84-6F9D1186AD05' AND Name = 'ContactID')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'f7dc9630-3748-4703-976c-d49662b6878a',
            '5460CFA8-0B07-4FAD-8F84-6F9D1186AD05', -- Entity: Activities
            100008,
            'ContactID',
            'Contact ID',
            'Optional link to a contact',
            'uniqueidentifier',
            16,
            0,
            0,
            1,
            'null',
            0,
            1,
            0,
            '0B09F0BF-F617-4851-A15E-CB839A095BD6',
            'ID',
            0,
            0,
            1,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'aba02308-a4dc-41ea-9a52-d426cfa65e75'  OR 
               (EntityID = '5460CFA8-0B07-4FAD-8F84-6F9D1186AD05' AND Name = 'DealID')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'aba02308-a4dc-41ea-9a52-d426cfa65e75',
            '5460CFA8-0B07-4FAD-8F84-6F9D1186AD05', -- Entity: Activities
            100009,
            'DealID',
            'Deal ID',
            'Optional link to a deal',
            'uniqueidentifier',
            16,
            0,
            0,
            1,
            'null',
            0,
            1,
            0,
            'EFC8B3F3-69E7-48EB-BD3D-0373D6C6DD55',
            'ID',
            0,
            0,
            1,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '2fa41b22-42df-45d5-83e2-48466630d835'  OR 
               (EntityID = '5460CFA8-0B07-4FAD-8F84-6F9D1186AD05' AND Name = 'CompletedAt')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '2fa41b22-42df-45d5-83e2-48466630d835',
            '5460CFA8-0B07-4FAD-8F84-6F9D1186AD05', -- Entity: Activities
            100010,
            'CompletedAt',
            'Completed At',
            'Timestamp when the activity was completed, null if pending',
            'datetime',
            8,
            23,
            3,
            1,
            'null',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '34fead7b-b879-4fe9-b509-1e74212df8d0'  OR 
               (EntityID = '5460CFA8-0B07-4FAD-8F84-6F9D1186AD05' AND Name = 'CreatedByUserID')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '34fead7b-b879-4fe9-b509-1e74212df8d0',
            '5460CFA8-0B07-4FAD-8F84-6F9D1186AD05', -- Entity: Activities
            100011,
            'CreatedByUserID',
            'Created By User ID',
            'User who created this activity record',
            'uniqueidentifier',
            16,
            0,
            0,
            1,
            'null',
            0,
            1,
            0,
            'E1238F34-2837-EF11-86D4-6045BDEE16E6',
            'ID',
            0,
            0,
            1,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '19b6c69c-cb52-4fd9-9385-7dcdc38ebf88'  OR 
               (EntityID = '5460CFA8-0B07-4FAD-8F84-6F9D1186AD05' AND Name = '__mj_CreatedAt')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '19b6c69c-cb52-4fd9-9385-7dcdc38ebf88',
            '5460CFA8-0B07-4FAD-8F84-6F9D1186AD05', -- Entity: Activities
            100012,
            '__mj_CreatedAt',
            'Created At',
            NULL,
            'datetimeoffset',
            10,
            34,
            7,
            0,
            'getutcdate()',
            0,
            0,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '9a5980ce-87eb-4320-a25a-fd3758d096d4'  OR 
               (EntityID = '5460CFA8-0B07-4FAD-8F84-6F9D1186AD05' AND Name = '__mj_UpdatedAt')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '9a5980ce-87eb-4320-a25a-fd3758d096d4',
            '5460CFA8-0B07-4FAD-8F84-6F9D1186AD05', -- Entity: Activities
            100013,
            '__mj_UpdatedAt',
            'Updated At',
            NULL,
            'datetimeoffset',
            10,
            34,
            7,
            0,
            'getutcdate()',
            0,
            0,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '752287af-4d07-4898-a222-5ab43bd0c166'  OR 
               (EntityID = 'B39A8C3C-4F32-4FD7-AF70-762FD92A5C56' AND Name = 'ID')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '752287af-4d07-4898-a222-5ab43bd0c166',
            'B39A8C3C-4F32-4FD7-AF70-762FD92A5C56', -- Entity: Pipeline Stages
            100001,
            'ID',
            'ID',
            'Primary key for the pipeline stage',
            'uniqueidentifier',
            16,
            0,
            0,
            0,
            'newsequentialid()',
            0,
            0,
            0,
            NULL,
            NULL,
            0,
            1,
            0,
            0,
            1,
            1,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '5250ff72-c47e-4c12-9c4d-68b6a320c408'  OR 
               (EntityID = 'B39A8C3C-4F32-4FD7-AF70-762FD92A5C56' AND Name = 'PipelineID')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '5250ff72-c47e-4c12-9c4d-68b6a320c408',
            'B39A8C3C-4F32-4FD7-AF70-762FD92A5C56', -- Entity: Pipeline Stages
            100002,
            'PipelineID',
            'Pipeline ID',
            'Pipeline this stage belongs to',
            'uniqueidentifier',
            16,
            0,
            0,
            0,
            'null',
            0,
            1,
            0,
            'DBC820EC-BB8F-418E-92D8-85DEE9F1C3F7',
            'ID',
            0,
            0,
            1,
            0,
            0,
            1,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '1932b68a-0303-4c6c-86ee-19cbe42e90a9'  OR 
               (EntityID = 'B39A8C3C-4F32-4FD7-AF70-762FD92A5C56' AND Name = 'Name')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '1932b68a-0303-4c6c-86ee-19cbe42e90a9',
            'B39A8C3C-4F32-4FD7-AF70-762FD92A5C56', -- Entity: Pipeline Stages
            100003,
            'Name',
            'Name',
            'Stage display name',
            'nvarchar',
            200,
            0,
            0,
            0,
            'null',
            0,
            1,
            0,
            NULL,
            NULL,
            1,
            1,
            0,
            1,
            0,
            1,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '9c7e65ba-c796-41bb-b930-5a6e02a2cb1a'  OR 
               (EntityID = 'B39A8C3C-4F32-4FD7-AF70-762FD92A5C56' AND Name = 'DisplayOrder')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '9c7e65ba-c796-41bb-b930-5a6e02a2cb1a',
            'B39A8C3C-4F32-4FD7-AF70-762FD92A5C56', -- Entity: Pipeline Stages
            100004,
            'DisplayOrder',
            'Display Order',
            'Ordering position within the pipeline, lower numbers appear first',
            'int',
            4,
            10,
            0,
            0,
            'null',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'f7576563-eaf8-4702-b01b-1c908250adda'  OR 
               (EntityID = 'B39A8C3C-4F32-4FD7-AF70-762FD92A5C56' AND Name = 'Probability')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'f7576563-eaf8-4702-b01b-1c908250adda',
            'B39A8C3C-4F32-4FD7-AF70-762FD92A5C56', -- Entity: Pipeline Stages
            100005,
            'Probability',
            'Probability',
            'Default win probability percentage for deals entering this stage',
            'int',
            4,
            10,
            0,
            0,
            '(0)',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'e95fdf72-98f1-4229-b339-d473f6aaa0d2'  OR 
               (EntityID = 'B39A8C3C-4F32-4FD7-AF70-762FD92A5C56' AND Name = '__mj_CreatedAt')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'e95fdf72-98f1-4229-b339-d473f6aaa0d2',
            'B39A8C3C-4F32-4FD7-AF70-762FD92A5C56', -- Entity: Pipeline Stages
            100006,
            '__mj_CreatedAt',
            'Created At',
            NULL,
            'datetimeoffset',
            10,
            34,
            7,
            0,
            'getutcdate()',
            0,
            0,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '3545438e-af96-4d89-be35-6d25fa2bb584'  OR 
               (EntityID = 'B39A8C3C-4F32-4FD7-AF70-762FD92A5C56' AND Name = '__mj_UpdatedAt')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '3545438e-af96-4d89-be35-6d25fa2bb584',
            'B39A8C3C-4F32-4FD7-AF70-762FD92A5C56', -- Entity: Pipeline Stages
            100007,
            '__mj_UpdatedAt',
            'Updated At',
            NULL,
            'datetimeoffset',
            10,
            34,
            7,
            0,
            'getutcdate()',
            0,
            0,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'ea0001b2-0b09-4ea9-9cdf-eeecc7653b2a'  OR 
               (EntityID = 'DBC820EC-BB8F-418E-92D8-85DEE9F1C3F7' AND Name = 'ID')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'ea0001b2-0b09-4ea9-9cdf-eeecc7653b2a',
            'DBC820EC-BB8F-418E-92D8-85DEE9F1C3F7', -- Entity: Pipelines
            100001,
            'ID',
            'ID',
            'Primary key for the pipeline',
            'uniqueidentifier',
            16,
            0,
            0,
            0,
            'newsequentialid()',
            0,
            0,
            0,
            NULL,
            NULL,
            0,
            1,
            0,
            0,
            1,
            1,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '75245851-c035-4989-aa47-ecaf95f10b28'  OR 
               (EntityID = 'DBC820EC-BB8F-418E-92D8-85DEE9F1C3F7' AND Name = 'Name')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '75245851-c035-4989-aa47-ecaf95f10b28',
            'DBC820EC-BB8F-418E-92D8-85DEE9F1C3F7', -- Entity: Pipelines
            100002,
            'Name',
            'Name',
            'Display name of the pipeline',
            'nvarchar',
            400,
            0,
            0,
            0,
            'null',
            0,
            1,
            0,
            NULL,
            NULL,
            1,
            1,
            0,
            1,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '087a6070-10b5-43cd-9f53-f7e3ad19217b'  OR 
               (EntityID = 'DBC820EC-BB8F-418E-92D8-85DEE9F1C3F7' AND Name = 'Description')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '087a6070-10b5-43cd-9f53-f7e3ad19217b',
            'DBC820EC-BB8F-418E-92D8-85DEE9F1C3F7', -- Entity: Pipelines
            100003,
            'Description',
            'Description',
            'Description of the pipeline purpose and usage',
            'nvarchar',
            -1,
            0,
            0,
            1,
            'null',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '77aa89b5-3b5d-4372-b13e-a7272fb5094c'  OR 
               (EntityID = 'DBC820EC-BB8F-418E-92D8-85DEE9F1C3F7' AND Name = 'IsDefault')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '77aa89b5-3b5d-4372-b13e-a7272fb5094c',
            'DBC820EC-BB8F-418E-92D8-85DEE9F1C3F7', -- Entity: Pipelines
            100004,
            'IsDefault',
            'Is Default',
            'Whether this is the default pipeline for new deals',
            'bit',
            1,
            1,
            0,
            0,
            '(0)',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '1b92c8ca-c48b-4a9e-b0bd-b72ed7859fe7'  OR 
               (EntityID = 'DBC820EC-BB8F-418E-92D8-85DEE9F1C3F7' AND Name = '__mj_CreatedAt')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '1b92c8ca-c48b-4a9e-b0bd-b72ed7859fe7',
            'DBC820EC-BB8F-418E-92D8-85DEE9F1C3F7', -- Entity: Pipelines
            100005,
            '__mj_CreatedAt',
            'Created At',
            NULL,
            'datetimeoffset',
            10,
            34,
            7,
            0,
            'getutcdate()',
            0,
            0,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '6ecaacd9-27b2-48eb-a6be-6ed5e4b277de'  OR 
               (EntityID = 'DBC820EC-BB8F-418E-92D8-85DEE9F1C3F7' AND Name = '__mj_UpdatedAt')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '6ecaacd9-27b2-48eb-a6be-6ed5e4b277de',
            'DBC820EC-BB8F-418E-92D8-85DEE9F1C3F7', -- Entity: Pipelines
            100006,
            '__mj_UpdatedAt',
            'Updated At',
            NULL,
            'datetimeoffset',
            10,
            34,
            7,
            0,
            'getutcdate()',
            0,
            0,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '7db1cfde-ec9f-49fe-9c48-9160a54cb5fa'  OR 
               (EntityID = '00A21C35-B805-4DC6-ABE9-BE12B51450AF' AND Name = 'ID')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '7db1cfde-ec9f-49fe-9c48-9160a54cb5fa',
            '00A21C35-B805-4DC6-ABE9-BE12B51450AF', -- Entity: Products
            100001,
            'ID',
            'ID',
            'Primary key for the product record',
            'uniqueidentifier',
            16,
            0,
            0,
            0,
            'newsequentialid()',
            0,
            0,
            0,
            NULL,
            NULL,
            0,
            1,
            0,
            0,
            1,
            1,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '59c8e9db-12ec-473b-872a-87ba1d428d11'  OR 
               (EntityID = '00A21C35-B805-4DC6-ABE9-BE12B51450AF' AND Name = 'Name')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '59c8e9db-12ec-473b-872a-87ba1d428d11',
            '00A21C35-B805-4DC6-ABE9-BE12B51450AF', -- Entity: Products
            100002,
            'Name',
            'Name',
            'Product display name',
            'nvarchar',
            400,
            0,
            0,
            0,
            'null',
            0,
            1,
            0,
            NULL,
            NULL,
            1,
            1,
            0,
            1,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '9f3ee322-9e51-464a-bc93-52c372cd4c07'  OR 
               (EntityID = '00A21C35-B805-4DC6-ABE9-BE12B51450AF' AND Name = 'SKU')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '9f3ee322-9e51-464a-bc93-52c372cd4c07',
            '00A21C35-B805-4DC6-ABE9-BE12B51450AF', -- Entity: Products
            100003,
            'SKU',
            'SKU',
            'Stock keeping unit, unique product identifier',
            'nvarchar',
            100,
            0,
            0,
            1,
            'null',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            1,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'dfa96752-f611-4213-a1da-54ce8cff5dc9'  OR 
               (EntityID = '00A21C35-B805-4DC6-ABE9-BE12B51450AF' AND Name = 'Description')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'dfa96752-f611-4213-a1da-54ce8cff5dc9',
            '00A21C35-B805-4DC6-ABE9-BE12B51450AF', -- Entity: Products
            100004,
            'Description',
            'Description',
            'Detailed product description',
            'nvarchar',
            -1,
            0,
            0,
            1,
            'null',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '6ab187b5-de81-43e7-9445-5a02d53425cd'  OR 
               (EntityID = '00A21C35-B805-4DC6-ABE9-BE12B51450AF' AND Name = 'UnitPrice')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '6ab187b5-de81-43e7-9445-5a02d53425cd',
            '00A21C35-B805-4DC6-ABE9-BE12B51450AF', -- Entity: Products
            100005,
            'UnitPrice',
            'Unit Price',
            'Standard unit price in USD',
            'decimal',
            9,
            18,
            2,
            0,
            'null',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'fdcee05b-f7df-4cdc-a744-1108044bd992'  OR 
               (EntityID = '00A21C35-B805-4DC6-ABE9-BE12B51450AF' AND Name = 'IsActive')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'fdcee05b-f7df-4cdc-a744-1108044bd992',
            '00A21C35-B805-4DC6-ABE9-BE12B51450AF', -- Entity: Products
            100006,
            'IsActive',
            'Is Active',
            'Whether the product is currently available for sale',
            'bit',
            1,
            1,
            0,
            0,
            '(1)',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'c765137e-fe8c-4c28-a0c3-0ae1697849c3'  OR 
               (EntityID = '00A21C35-B805-4DC6-ABE9-BE12B51450AF' AND Name = 'Category')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'c765137e-fe8c-4c28-a0c3-0ae1697849c3',
            '00A21C35-B805-4DC6-ABE9-BE12B51450AF', -- Entity: Products
            100007,
            'Category',
            'Category',
            'Product category for grouping and filtering',
            'nvarchar',
            200,
            0,
            0,
            1,
            'null',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '2e3e4ae3-62f5-43f3-a45c-aa2bc3197ff3'  OR 
               (EntityID = '00A21C35-B805-4DC6-ABE9-BE12B51450AF' AND Name = '__mj_CreatedAt')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '2e3e4ae3-62f5-43f3-a45c-aa2bc3197ff3',
            '00A21C35-B805-4DC6-ABE9-BE12B51450AF', -- Entity: Products
            100008,
            '__mj_CreatedAt',
            'Created At',
            NULL,
            'datetimeoffset',
            10,
            34,
            7,
            0,
            'getutcdate()',
            0,
            0,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '7c31fa07-65aa-4c99-88a1-0c64f39481b1'  OR 
               (EntityID = '00A21C35-B805-4DC6-ABE9-BE12B51450AF' AND Name = '__mj_UpdatedAt')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '7c31fa07-65aa-4c99-88a1-0c64f39481b1',
            '00A21C35-B805-4DC6-ABE9-BE12B51450AF', -- Entity: Products
            100009,
            '__mj_UpdatedAt',
            'Updated At',
            NULL,
            'datetimeoffset',
            10,
            34,
            7,
            0,
            'getutcdate()',
            0,
            0,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'ea68271b-fdaa-4610-a4e7-b189d25cae2e'  OR 
               (EntityID = '0862DE5E-379E-453B-8CDD-C097DD82814B' AND Name = 'ID')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'ea68271b-fdaa-4610-a4e7-b189d25cae2e',
            '0862DE5E-379E-453B-8CDD-C097DD82814B', -- Entity: Company Tags
            100001,
            'ID',
            'ID',
            'Primary key',
            'uniqueidentifier',
            16,
            0,
            0,
            0,
            'newsequentialid()',
            0,
            0,
            0,
            NULL,
            NULL,
            0,
            1,
            0,
            0,
            1,
            1,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '7d04a09e-9822-4786-bcfa-c61d5626d942'  OR 
               (EntityID = '0862DE5E-379E-453B-8CDD-C097DD82814B' AND Name = 'CompanyID')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '7d04a09e-9822-4786-bcfa-c61d5626d942',
            '0862DE5E-379E-453B-8CDD-C097DD82814B', -- Entity: Company Tags
            100002,
            'CompanyID',
            'Company ID',
            'The company being tagged',
            'uniqueidentifier',
            16,
            0,
            0,
            0,
            'null',
            0,
            1,
            0,
            'E1BF8043-C521-444A-8446-339FF0FA032B',
            'ID',
            0,
            0,
            1,
            0,
            0,
            1,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '4423f88a-7abd-4c67-92f6-5cbf449ee15a'  OR 
               (EntityID = '0862DE5E-379E-453B-8CDD-C097DD82814B' AND Name = 'TagID')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '4423f88a-7abd-4c67-92f6-5cbf449ee15a',
            '0862DE5E-379E-453B-8CDD-C097DD82814B', -- Entity: Company Tags
            100003,
            'TagID',
            'Tag ID',
            'The tag applied to the company',
            'uniqueidentifier',
            16,
            0,
            0,
            0,
            'null',
            0,
            1,
            0,
            '186842DA-D62B-4F8B-A53A-DC2CF7604246',
            'ID',
            0,
            0,
            1,
            0,
            0,
            1,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '965ca5c8-ae78-41de-afc7-14debab51363'  OR 
               (EntityID = '0862DE5E-379E-453B-8CDD-C097DD82814B' AND Name = '__mj_CreatedAt')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '965ca5c8-ae78-41de-afc7-14debab51363',
            '0862DE5E-379E-453B-8CDD-C097DD82814B', -- Entity: Company Tags
            100004,
            '__mj_CreatedAt',
            'Created At',
            NULL,
            'datetimeoffset',
            10,
            34,
            7,
            0,
            'getutcdate()',
            0,
            0,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'e76c8e8a-ad1b-48be-add3-948c6b5ffb23'  OR 
               (EntityID = '0862DE5E-379E-453B-8CDD-C097DD82814B' AND Name = '__mj_UpdatedAt')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'e76c8e8a-ad1b-48be-add3-948c6b5ffb23',
            '0862DE5E-379E-453B-8CDD-C097DD82814B', -- Entity: Company Tags
            100005,
            '__mj_UpdatedAt',
            'Updated At',
            NULL,
            'datetimeoffset',
            10,
            34,
            7,
            0,
            'getutcdate()',
            0,
            0,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '93fe32d5-e96a-40a0-b54a-e68cfa82f44b'  OR 
               (EntityID = '0B09F0BF-F617-4851-A15E-CB839A095BD6' AND Name = 'ID')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '93fe32d5-e96a-40a0-b54a-e68cfa82f44b',
            '0B09F0BF-F617-4851-A15E-CB839A095BD6', -- Entity: Contacts
            100001,
            'ID',
            'ID',
            'Primary key for the contact record',
            'uniqueidentifier',
            16,
            0,
            0,
            0,
            'newsequentialid()',
            0,
            0,
            0,
            NULL,
            NULL,
            0,
            1,
            0,
            0,
            1,
            1,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'ac970af5-554d-4936-b53f-f5305c77412d'  OR 
               (EntityID = '0B09F0BF-F617-4851-A15E-CB839A095BD6' AND Name = 'CompanyID')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'ac970af5-554d-4936-b53f-f5305c77412d',
            '0B09F0BF-F617-4851-A15E-CB839A095BD6', -- Entity: Contacts
            100002,
            'CompanyID',
            'Company ID',
            'Company this contact belongs to',
            'uniqueidentifier',
            16,
            0,
            0,
            0,
            'null',
            0,
            1,
            0,
            'E1BF8043-C521-444A-8446-339FF0FA032B',
            'ID',
            0,
            0,
            1,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '95a1f9bd-e875-491e-9d0f-a92a22d1dfd8'  OR 
               (EntityID = '0B09F0BF-F617-4851-A15E-CB839A095BD6' AND Name = 'FirstName')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '95a1f9bd-e875-491e-9d0f-a92a22d1dfd8',
            '0B09F0BF-F617-4851-A15E-CB839A095BD6', -- Entity: Contacts
            100003,
            'FirstName',
            'First Name',
            'Contact first name',
            'nvarchar',
            200,
            0,
            0,
            0,
            'null',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'f65297ca-9ae2-42f6-a6f9-499c99d7645f'  OR 
               (EntityID = '0B09F0BF-F617-4851-A15E-CB839A095BD6' AND Name = 'LastName')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'f65297ca-9ae2-42f6-a6f9-499c99d7645f',
            '0B09F0BF-F617-4851-A15E-CB839A095BD6', -- Entity: Contacts
            100004,
            'LastName',
            'Last Name',
            'Contact last name',
            'nvarchar',
            200,
            0,
            0,
            0,
            'null',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '0e5d4d0a-b43e-4041-ab75-abe64eb88f1a'  OR 
               (EntityID = '0B09F0BF-F617-4851-A15E-CB839A095BD6' AND Name = 'Email')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '0e5d4d0a-b43e-4041-ab75-abe64eb88f1a',
            '0B09F0BF-F617-4851-A15E-CB839A095BD6', -- Entity: Contacts
            100005,
            'Email',
            'Email',
            'Email address',
            'nvarchar',
            400,
            0,
            0,
            1,
            'null',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'd89e70a9-0681-467b-b04a-148b0aeb9f0c'  OR 
               (EntityID = '0B09F0BF-F617-4851-A15E-CB839A095BD6' AND Name = 'Phone')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'd89e70a9-0681-467b-b04a-148b0aeb9f0c',
            '0B09F0BF-F617-4851-A15E-CB839A095BD6', -- Entity: Contacts
            100006,
            'Phone',
            'Phone',
            'Direct phone number',
            'nvarchar',
            100,
            0,
            0,
            1,
            'null',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'd6c3a5e8-a2df-4fba-9b6f-ba53742b7410'  OR 
               (EntityID = '0B09F0BF-F617-4851-A15E-CB839A095BD6' AND Name = 'Title')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'd6c3a5e8-a2df-4fba-9b6f-ba53742b7410',
            '0B09F0BF-F617-4851-A15E-CB839A095BD6', -- Entity: Contacts
            100007,
            'Title',
            'Title',
            'Job title',
            'nvarchar',
            200,
            0,
            0,
            1,
            'null',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'c72f380e-7000-40ab-9383-5da85cf3da20'  OR 
               (EntityID = '0B09F0BF-F617-4851-A15E-CB839A095BD6' AND Name = 'Department')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'c72f380e-7000-40ab-9383-5da85cf3da20',
            '0B09F0BF-F617-4851-A15E-CB839A095BD6', -- Entity: Contacts
            100008,
            'Department',
            'Department',
            'Department within the company',
            'nvarchar',
            200,
            0,
            0,
            1,
            'null',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'dba51f71-b5fa-400b-ab9c-9f78e72bd547'  OR 
               (EntityID = '0B09F0BF-F617-4851-A15E-CB839A095BD6' AND Name = 'ReportsToContactID')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'dba51f71-b5fa-400b-ab9c-9f78e72bd547',
            '0B09F0BF-F617-4851-A15E-CB839A095BD6', -- Entity: Contacts
            100009,
            'ReportsToContactID',
            'Reports To Contact ID',
            'Self-referential FK to the contact this person reports to',
            'uniqueidentifier',
            16,
            0,
            0,
            1,
            'null',
            0,
            1,
            0,
            '0B09F0BF-F617-4851-A15E-CB839A095BD6',
            'ID',
            0,
            0,
            1,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'face1c48-2194-43e4-9f80-211098f3abad'  OR 
               (EntityID = '0B09F0BF-F617-4851-A15E-CB839A095BD6' AND Name = 'IsPrimary')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'face1c48-2194-43e4-9f80-211098f3abad',
            '0B09F0BF-F617-4851-A15E-CB839A095BD6', -- Entity: Contacts
            100010,
            'IsPrimary',
            'Is Primary',
            'Whether this is the primary contact for the company',
            'bit',
            1,
            1,
            0,
            0,
            '(0)',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'e09cf3bd-562f-4067-9f1b-7214b5bbd5ea'  OR 
               (EntityID = '0B09F0BF-F617-4851-A15E-CB839A095BD6' AND Name = 'Status')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'e09cf3bd-562f-4067-9f1b-7214b5bbd5ea',
            '0B09F0BF-F617-4851-A15E-CB839A095BD6', -- Entity: Contacts
            100011,
            'Status',
            'Status',
            'Current status: Active, Inactive, Prospect, or Churned',
            'nvarchar',
            40,
            0,
            0,
            0,
            'null',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '81621f91-698a-49ed-a596-0eb3336f30ce'  OR 
               (EntityID = '0B09F0BF-F617-4851-A15E-CB839A095BD6' AND Name = 'Notes')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '81621f91-698a-49ed-a596-0eb3336f30ce',
            '0B09F0BF-F617-4851-A15E-CB839A095BD6', -- Entity: Contacts
            100012,
            'Notes',
            'Notes',
            'Free-form notes about the contact',
            'nvarchar',
            -1,
            0,
            0,
            1,
            'null',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'b252d344-9882-4018-a9fc-04ad114936ba'  OR 
               (EntityID = '0B09F0BF-F617-4851-A15E-CB839A095BD6' AND Name = 'CreatedByUserID')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'b252d344-9882-4018-a9fc-04ad114936ba',
            '0B09F0BF-F617-4851-A15E-CB839A095BD6', -- Entity: Contacts
            100013,
            'CreatedByUserID',
            'Created By User ID',
            'User who created this contact record',
            'uniqueidentifier',
            16,
            0,
            0,
            1,
            'null',
            0,
            1,
            0,
            'E1238F34-2837-EF11-86D4-6045BDEE16E6',
            'ID',
            0,
            0,
            1,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '309b27e0-a6b9-4971-87cf-9aa5f5e08d9c'  OR 
               (EntityID = '0B09F0BF-F617-4851-A15E-CB839A095BD6' AND Name = '__mj_CreatedAt')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '309b27e0-a6b9-4971-87cf-9aa5f5e08d9c',
            '0B09F0BF-F617-4851-A15E-CB839A095BD6', -- Entity: Contacts
            100014,
            '__mj_CreatedAt',
            'Created At',
            NULL,
            'datetimeoffset',
            10,
            34,
            7,
            0,
            'getutcdate()',
            0,
            0,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'ab030d13-34cf-438e-9681-575e116ecfb2'  OR 
               (EntityID = '0B09F0BF-F617-4851-A15E-CB839A095BD6' AND Name = '__mj_UpdatedAt')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'ab030d13-34cf-438e-9681-575e116ecfb2',
            '0B09F0BF-F617-4851-A15E-CB839A095BD6', -- Entity: Contacts
            100015,
            '__mj_UpdatedAt',
            'Updated At',
            NULL,
            'datetimeoffset',
            10,
            34,
            7,
            0,
            'getutcdate()',
            0,
            0,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '39831ec2-4372-4e95-81b4-4492a2fe3521'  OR 
               (EntityID = '186842DA-D62B-4F8B-A53A-DC2CF7604246' AND Name = 'ID')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '39831ec2-4372-4e95-81b4-4492a2fe3521',
            '186842DA-D62B-4F8B-A53A-DC2CF7604246', -- Entity: Tags
            100001,
            'ID',
            'ID',
            'Primary key for the tag',
            'uniqueidentifier',
            16,
            0,
            0,
            0,
            'newsequentialid()',
            0,
            0,
            0,
            NULL,
            NULL,
            0,
            1,
            0,
            0,
            1,
            1,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'badaf2cc-aca9-49c3-8c58-a07c327a193b'  OR 
               (EntityID = '186842DA-D62B-4F8B-A53A-DC2CF7604246' AND Name = 'Name')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'badaf2cc-aca9-49c3-8c58-a07c327a193b',
            '186842DA-D62B-4F8B-A53A-DC2CF7604246', -- Entity: Tags
            100002,
            'Name',
            'Name',
            'Display name of the tag, must be unique',
            'nvarchar',
            200,
            0,
            0,
            0,
            'null',
            0,
            1,
            0,
            NULL,
            NULL,
            1,
            1,
            0,
            1,
            0,
            1,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '8064b784-d95c-47d9-a8a7-f104cd2b048e'  OR 
               (EntityID = '186842DA-D62B-4F8B-A53A-DC2CF7604246' AND Name = 'Color')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '8064b784-d95c-47d9-a8a7-f104cd2b048e',
            '186842DA-D62B-4F8B-A53A-DC2CF7604246', -- Entity: Tags
            100003,
            'Color',
            'Color',
            'Hex color code for visual display, e.g. #FF5733',
            'nvarchar',
            14,
            0,
            0,
            1,
            'null',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '34876304-a7c1-4ee9-a6df-ec782261f9f5'  OR 
               (EntityID = '186842DA-D62B-4F8B-A53A-DC2CF7604246' AND Name = '__mj_CreatedAt')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '34876304-a7c1-4ee9-a6df-ec782261f9f5',
            '186842DA-D62B-4F8B-A53A-DC2CF7604246', -- Entity: Tags
            100004,
            '__mj_CreatedAt',
            'Created At',
            NULL,
            'datetimeoffset',
            10,
            34,
            7,
            0,
            'getutcdate()',
            0,
            0,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'b99e4bcc-1cc6-498d-a4bb-b9c45ead41bf'  OR 
               (EntityID = '186842DA-D62B-4F8B-A53A-DC2CF7604246' AND Name = '__mj_UpdatedAt')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'b99e4bcc-1cc6-498d-a4bb-b9c45ead41bf',
            '186842DA-D62B-4F8B-A53A-DC2CF7604246', -- Entity: Tags
            100005,
            '__mj_UpdatedAt',
            'Updated At',
            NULL,
            'datetimeoffset',
            10,
            34,
            7,
            0,
            'getutcdate()',
            0,
            0,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert entity field value with ID 057abea6-8605-4730-af64-b8f43aab1510 */
INSERT INTO [${flyway:defaultSchema}].EntityFieldValue
                                       (ID, EntityFieldID, Sequence, Value, Code)
                                    VALUES
                                       ('057abea6-8605-4730-af64-b8f43aab1510', 'ACCCBEF9-6AFF-4596-BA4C-CA0EE9AA174F', 1, 'Active', 'Active')

/* SQL text to insert entity field value with ID 6e10e469-8e7d-453a-b48c-fa7329b90d54 */
INSERT INTO [${flyway:defaultSchema}].EntityFieldValue
                                       (ID, EntityFieldID, Sequence, Value, Code)
                                    VALUES
                                       ('6e10e469-8e7d-453a-b48c-fa7329b90d54', 'ACCCBEF9-6AFF-4596-BA4C-CA0EE9AA174F', 2, 'Churned', 'Churned')

/* SQL text to insert entity field value with ID 9dcd7e2c-8678-4c13-82c4-58800c3663b0 */
INSERT INTO [${flyway:defaultSchema}].EntityFieldValue
                                       (ID, EntityFieldID, Sequence, Value, Code)
                                    VALUES
                                       ('9dcd7e2c-8678-4c13-82c4-58800c3663b0', 'ACCCBEF9-6AFF-4596-BA4C-CA0EE9AA174F', 3, 'Inactive', 'Inactive')

/* SQL text to insert entity field value with ID 91446b95-c324-49f1-8c70-645e9d0e7adc */
INSERT INTO [${flyway:defaultSchema}].EntityFieldValue
                                       (ID, EntityFieldID, Sequence, Value, Code)
                                    VALUES
                                       ('91446b95-c324-49f1-8c70-645e9d0e7adc', 'ACCCBEF9-6AFF-4596-BA4C-CA0EE9AA174F', 4, 'Prospect', 'Prospect')

/* SQL text to update ValueListType for entity field ID ACCCBEF9-6AFF-4596-BA4C-CA0EE9AA174F */
UPDATE [${flyway:defaultSchema}].EntityField SET ValueListType='List' WHERE ID='ACCCBEF9-6AFF-4596-BA4C-CA0EE9AA174F'

/* SQL text to insert entity field value with ID b896db37-5539-4b58-863d-713ba4df932e */
INSERT INTO [${flyway:defaultSchema}].EntityFieldValue
                                       (ID, EntityFieldID, Sequence, Value, Code)
                                    VALUES
                                       ('b896db37-5539-4b58-863d-713ba4df932e', 'E09CF3BD-562F-4067-9F1B-7214B5BBD5EA', 1, 'Active', 'Active')

/* SQL text to insert entity field value with ID fa381cd2-06c1-4dc6-9702-9fe2ed746123 */
INSERT INTO [${flyway:defaultSchema}].EntityFieldValue
                                       (ID, EntityFieldID, Sequence, Value, Code)
                                    VALUES
                                       ('fa381cd2-06c1-4dc6-9702-9fe2ed746123', 'E09CF3BD-562F-4067-9F1B-7214B5BBD5EA', 2, 'Churned', 'Churned')

/* SQL text to insert entity field value with ID 8dc3f5c3-1707-4d9d-a013-d5c1ddf2874f */
INSERT INTO [${flyway:defaultSchema}].EntityFieldValue
                                       (ID, EntityFieldID, Sequence, Value, Code)
                                    VALUES
                                       ('8dc3f5c3-1707-4d9d-a013-d5c1ddf2874f', 'E09CF3BD-562F-4067-9F1B-7214B5BBD5EA', 3, 'Inactive', 'Inactive')

/* SQL text to insert entity field value with ID 33dbd2e6-aba6-44e7-a44d-bd5e152d8f3b */
INSERT INTO [${flyway:defaultSchema}].EntityFieldValue
                                       (ID, EntityFieldID, Sequence, Value, Code)
                                    VALUES
                                       ('33dbd2e6-aba6-44e7-a44d-bd5e152d8f3b', 'E09CF3BD-562F-4067-9F1B-7214B5BBD5EA', 4, 'Prospect', 'Prospect')

/* SQL text to update ValueListType for entity field ID E09CF3BD-562F-4067-9F1B-7214B5BBD5EA */
UPDATE [${flyway:defaultSchema}].EntityField SET ValueListType='List' WHERE ID='E09CF3BD-562F-4067-9F1B-7214B5BBD5EA'

/* SQL text to insert entity field value with ID 2d65748d-0d30-49c6-8cb5-3aa5701b0bc4 */
INSERT INTO [${flyway:defaultSchema}].EntityFieldValue
                                       (ID, EntityFieldID, Sequence, Value, Code)
                                    VALUES
                                       ('2d65748d-0d30-49c6-8cb5-3aa5701b0bc4', 'CB46F0A1-D395-4AEA-9474-51176E8906B2', 1, 'Closed Lost', 'Closed Lost')

/* SQL text to insert entity field value with ID d1aa3356-ba9a-43f3-a339-d9c0bd970f59 */
INSERT INTO [${flyway:defaultSchema}].EntityFieldValue
                                       (ID, EntityFieldID, Sequence, Value, Code)
                                    VALUES
                                       ('d1aa3356-ba9a-43f3-a339-d9c0bd970f59', 'CB46F0A1-D395-4AEA-9474-51176E8906B2', 2, 'Closed Won', 'Closed Won')

/* SQL text to insert entity field value with ID e61bfea4-81a4-4eee-8f47-6bfc654935c8 */
INSERT INTO [${flyway:defaultSchema}].EntityFieldValue
                                       (ID, EntityFieldID, Sequence, Value, Code)
                                    VALUES
                                       ('e61bfea4-81a4-4eee-8f47-6bfc654935c8', 'CB46F0A1-D395-4AEA-9474-51176E8906B2', 3, 'Lead', 'Lead')

/* SQL text to insert entity field value with ID 557c032e-d9ab-4c23-9bb8-0456174ead3d */
INSERT INTO [${flyway:defaultSchema}].EntityFieldValue
                                       (ID, EntityFieldID, Sequence, Value, Code)
                                    VALUES
                                       ('557c032e-d9ab-4c23-9bb8-0456174ead3d', 'CB46F0A1-D395-4AEA-9474-51176E8906B2', 4, 'Negotiation', 'Negotiation')

/* SQL text to insert entity field value with ID b59d9072-818b-40dd-8ead-6a1eb0abddb0 */
INSERT INTO [${flyway:defaultSchema}].EntityFieldValue
                                       (ID, EntityFieldID, Sequence, Value, Code)
                                    VALUES
                                       ('b59d9072-818b-40dd-8ead-6a1eb0abddb0', 'CB46F0A1-D395-4AEA-9474-51176E8906B2', 5, 'Proposal', 'Proposal')

/* SQL text to insert entity field value with ID 0fe87571-198c-4b0c-9b1c-98f5684053d4 */
INSERT INTO [${flyway:defaultSchema}].EntityFieldValue
                                       (ID, EntityFieldID, Sequence, Value, Code)
                                    VALUES
                                       ('0fe87571-198c-4b0c-9b1c-98f5684053d4', 'CB46F0A1-D395-4AEA-9474-51176E8906B2', 6, 'Qualified', 'Qualified')

/* SQL text to update ValueListType for entity field ID CB46F0A1-D395-4AEA-9474-51176E8906B2 */
UPDATE [${flyway:defaultSchema}].EntityField SET ValueListType='List' WHERE ID='CB46F0A1-D395-4AEA-9474-51176E8906B2'

/* SQL text to insert entity field value with ID b4b98534-b612-4d4a-86c3-0762caa67201 */
INSERT INTO [${flyway:defaultSchema}].EntityFieldValue
                                       (ID, EntityFieldID, Sequence, Value, Code)
                                    VALUES
                                       ('b4b98534-b612-4d4a-86c3-0762caa67201', '633D1E40-F506-4A2D-8D53-EAA1B34A6248', 1, 'Call', 'Call')

/* SQL text to insert entity field value with ID 0b9b4399-a0a2-42f7-836d-12168bcaeffc */
INSERT INTO [${flyway:defaultSchema}].EntityFieldValue
                                       (ID, EntityFieldID, Sequence, Value, Code)
                                    VALUES
                                       ('0b9b4399-a0a2-42f7-836d-12168bcaeffc', '633D1E40-F506-4A2D-8D53-EAA1B34A6248', 2, 'Email', 'Email')

/* SQL text to insert entity field value with ID 18493727-da1d-41f2-97db-ead849080f0d */
INSERT INTO [${flyway:defaultSchema}].EntityFieldValue
                                       (ID, EntityFieldID, Sequence, Value, Code)
                                    VALUES
                                       ('18493727-da1d-41f2-97db-ead849080f0d', '633D1E40-F506-4A2D-8D53-EAA1B34A6248', 3, 'Meeting', 'Meeting')

/* SQL text to insert entity field value with ID ccfbfc1d-a6c2-4986-808f-189913291af8 */
INSERT INTO [${flyway:defaultSchema}].EntityFieldValue
                                       (ID, EntityFieldID, Sequence, Value, Code)
                                    VALUES
                                       ('ccfbfc1d-a6c2-4986-808f-189913291af8', '633D1E40-F506-4A2D-8D53-EAA1B34A6248', 4, 'Note', 'Note')

/* SQL text to insert entity field value with ID d9c5c638-ae8d-4af4-8604-9727462c66a6 */
INSERT INTO [${flyway:defaultSchema}].EntityFieldValue
                                       (ID, EntityFieldID, Sequence, Value, Code)
                                    VALUES
                                       ('d9c5c638-ae8d-4af4-8604-9727462c66a6', '633D1E40-F506-4A2D-8D53-EAA1B34A6248', 5, 'Task', 'Task')

/* SQL text to update ValueListType for entity field ID 633D1E40-F506-4A2D-8D53-EAA1B34A6248 */
UPDATE [${flyway:defaultSchema}].EntityField SET ValueListType='List' WHERE ID='633D1E40-F506-4A2D-8D53-EAA1B34A6248'


/* Create Entity Relationship: Deals -> Activities (One To Many via DealID) */
   IF NOT EXISTS (
      SELECT 1
      FROM [${flyway:defaultSchema}].EntityRelationship
      WHERE ID = 'f947927c-1216-44b0-8b9d-b37ef3a75be3'
   )
   BEGIN
      INSERT INTO ${flyway:defaultSchema}.EntityRelationship (ID, EntityID, RelatedEntityID, RelatedEntityJoinField, Type, BundleInAPI, DisplayInForm, DisplayName, Sequence)
                              VALUES ('f947927c-1216-44b0-8b9d-b37ef3a75be3', 'EFC8B3F3-69E7-48EB-BD3D-0373D6C6DD55', '5460CFA8-0B07-4FAD-8F84-6F9D1186AD05', 'DealID', 'One To Many', 1, 1, 'Activities', 1);
   END
                              
/* Create Entity Relationship: Deals -> Deal Tags (One To Many via DealID) */
   IF NOT EXISTS (
      SELECT 1
      FROM [${flyway:defaultSchema}].EntityRelationship
      WHERE ID = '9fa83909-1e2b-43b3-a33f-717c171ef871'
   )
   BEGIN
      INSERT INTO ${flyway:defaultSchema}.EntityRelationship (ID, EntityID, RelatedEntityID, RelatedEntityJoinField, Type, BundleInAPI, DisplayInForm, DisplayName, Sequence)
                              VALUES ('9fa83909-1e2b-43b3-a33f-717c171ef871', 'EFC8B3F3-69E7-48EB-BD3D-0373D6C6DD55', 'BBCCE24D-C17B-4CC2-992D-0DF2CC14D210', 'DealID', 'One To Many', 1, 1, 'Deal Tags', 1);
   END
                              


/* Create Entity Relationship: Deals -> Deal Products (One To Many via DealID) */
   IF NOT EXISTS (
      SELECT 1
      FROM [${flyway:defaultSchema}].EntityRelationship
      WHERE ID = 'a14ec9dd-5ef1-4875-9d3a-658bef3382fe'
   )
   BEGIN
      INSERT INTO ${flyway:defaultSchema}.EntityRelationship (ID, EntityID, RelatedEntityID, RelatedEntityJoinField, Type, BundleInAPI, DisplayInForm, DisplayName, Sequence)
                              VALUES ('a14ec9dd-5ef1-4875-9d3a-658bef3382fe', 'EFC8B3F3-69E7-48EB-BD3D-0373D6C6DD55', '2FAF06FC-BBB0-4F84-8D11-3981DFC4BD37', 'DealID', 'One To Many', 1, 1, 'Deal Products', 1);
   END
                              


/* Create Entity Relationship: Companies -> Deals (One To Many via CompanyID) */
   IF NOT EXISTS (
      SELECT 1
      FROM [${flyway:defaultSchema}].EntityRelationship
      WHERE ID = '9f3bc8a8-f4cd-4722-87cb-b20b83ebfb12'
   )
   BEGIN
      INSERT INTO ${flyway:defaultSchema}.EntityRelationship (ID, EntityID, RelatedEntityID, RelatedEntityJoinField, Type, BundleInAPI, DisplayInForm, DisplayName, Sequence)
                              VALUES ('9f3bc8a8-f4cd-4722-87cb-b20b83ebfb12', 'E1BF8043-C521-444A-8446-339FF0FA032B', 'EFC8B3F3-69E7-48EB-BD3D-0373D6C6DD55', 'CompanyID', 'One To Many', 1, 1, 'Deals', 1);
   END
                              


/* Create Entity Relationship: Companies -> Contacts (One To Many via CompanyID) */
   IF NOT EXISTS (
      SELECT 1
      FROM [${flyway:defaultSchema}].EntityRelationship
      WHERE ID = '95a91c09-b130-48e1-85a3-64c669aefd75'
   )
   BEGIN
      INSERT INTO ${flyway:defaultSchema}.EntityRelationship (ID, EntityID, RelatedEntityID, RelatedEntityJoinField, Type, BundleInAPI, DisplayInForm, DisplayName, Sequence)
                              VALUES ('95a91c09-b130-48e1-85a3-64c669aefd75', 'E1BF8043-C521-444A-8446-339FF0FA032B', '0B09F0BF-F617-4851-A15E-CB839A095BD6', 'CompanyID', 'One To Many', 1, 1, 'Contacts', 1);
   END
                              
/* Create Entity Relationship: Companies -> Company Tags (One To Many via CompanyID) */
   IF NOT EXISTS (
      SELECT 1
      FROM [${flyway:defaultSchema}].EntityRelationship
      WHERE ID = 'af7564c0-e72e-4122-bdca-cd0f96b841d0'
   )
   BEGIN
      INSERT INTO ${flyway:defaultSchema}.EntityRelationship (ID, EntityID, RelatedEntityID, RelatedEntityJoinField, Type, BundleInAPI, DisplayInForm, DisplayName, Sequence)
                              VALUES ('af7564c0-e72e-4122-bdca-cd0f96b841d0', 'E1BF8043-C521-444A-8446-339FF0FA032B', '0862DE5E-379E-453B-8CDD-C097DD82814B', 'CompanyID', 'One To Many', 1, 1, 'Company Tags', 1);
   END
                              
/* Create Entity Relationship: Companies -> Activities (One To Many via CompanyID) */
   IF NOT EXISTS (
      SELECT 1
      FROM [${flyway:defaultSchema}].EntityRelationship
      WHERE ID = '9ecfaec3-7149-402e-ac54-4a057abda861'
   )
   BEGIN
      INSERT INTO ${flyway:defaultSchema}.EntityRelationship (ID, EntityID, RelatedEntityID, RelatedEntityJoinField, Type, BundleInAPI, DisplayInForm, DisplayName, Sequence)
                              VALUES ('9ecfaec3-7149-402e-ac54-4a057abda861', 'E1BF8043-C521-444A-8446-339FF0FA032B', '5460CFA8-0B07-4FAD-8F84-6F9D1186AD05', 'CompanyID', 'One To Many', 1, 1, 'Activities', 2);
   END
                              


/* Create Entity Relationship: MJ: Users -> Activities (One To Many via CreatedByUserID) */
   IF NOT EXISTS (
      SELECT 1
      FROM [${flyway:defaultSchema}].EntityRelationship
      WHERE ID = 'ec3ab4cc-b15c-4578-bb91-b7c61e87b2b4'
   )
   BEGIN
      INSERT INTO ${flyway:defaultSchema}.EntityRelationship (ID, EntityID, RelatedEntityID, RelatedEntityJoinField, Type, BundleInAPI, DisplayInForm, DisplayName, Sequence)
                              VALUES ('ec3ab4cc-b15c-4578-bb91-b7c61e87b2b4', 'E1238F34-2837-EF11-86D4-6045BDEE16E6', '5460CFA8-0B07-4FAD-8F84-6F9D1186AD05', 'CreatedByUserID', 'One To Many', 1, 1, 'Activities', 3);
   END
                              


/* Create Entity Relationship: MJ: Users -> Contacts (One To Many via CreatedByUserID) */
   IF NOT EXISTS (
      SELECT 1
      FROM [${flyway:defaultSchema}].EntityRelationship
      WHERE ID = 'af0f4326-9a9b-44d8-a92e-90a2cb9866e8'
   )
   BEGIN
      INSERT INTO ${flyway:defaultSchema}.EntityRelationship (ID, EntityID, RelatedEntityID, RelatedEntityJoinField, Type, BundleInAPI, DisplayInForm, DisplayName, Sequence)
                              VALUES ('af0f4326-9a9b-44d8-a92e-90a2cb9866e8', 'E1238F34-2837-EF11-86D4-6045BDEE16E6', '0B09F0BF-F617-4851-A15E-CB839A095BD6', 'CreatedByUserID', 'One To Many', 1, 1, 'Contacts', 2);
   END
                              


/* Create Entity Relationship: MJ: Users -> Deals (One To Many via CreatedByUserID) */
   IF NOT EXISTS (
      SELECT 1
      FROM [${flyway:defaultSchema}].EntityRelationship
      WHERE ID = '9d6c86af-dec4-4806-a1e7-a216749c77a2'
   )
   BEGIN
      INSERT INTO ${flyway:defaultSchema}.EntityRelationship (ID, EntityID, RelatedEntityID, RelatedEntityJoinField, Type, BundleInAPI, DisplayInForm, DisplayName, Sequence)
                              VALUES ('9d6c86af-dec4-4806-a1e7-a216749c77a2', 'E1238F34-2837-EF11-86D4-6045BDEE16E6', 'EFC8B3F3-69E7-48EB-BD3D-0373D6C6DD55', 'CreatedByUserID', 'One To Many', 1, 1, 'Deals', 2);
   END
                              
/* Create Entity Relationship: MJ: Users -> Deals (One To Many via AssignedToUserID) */
   IF NOT EXISTS (
      SELECT 1
      FROM [${flyway:defaultSchema}].EntityRelationship
      WHERE ID = '510a203b-129e-4798-8de0-f8e5f5efa569'
   )
   BEGIN
      INSERT INTO ${flyway:defaultSchema}.EntityRelationship (ID, EntityID, RelatedEntityID, RelatedEntityJoinField, Type, BundleInAPI, DisplayInForm, DisplayName, Sequence)
                              VALUES ('510a203b-129e-4798-8de0-f8e5f5efa569', 'E1238F34-2837-EF11-86D4-6045BDEE16E6', 'EFC8B3F3-69E7-48EB-BD3D-0373D6C6DD55', 'AssignedToUserID', 'One To Many', 1, 1, 'Deals', 3);
   END
                              


/* Create Entity Relationship: MJ: Users -> Companies (One To Many via CreatedByUserID) */
   IF NOT EXISTS (
      SELECT 1
      FROM [${flyway:defaultSchema}].EntityRelationship
      WHERE ID = '927c4b06-7c5b-4850-a35a-d761834d65e6'
   )
   BEGIN
      INSERT INTO ${flyway:defaultSchema}.EntityRelationship (ID, EntityID, RelatedEntityID, RelatedEntityJoinField, Type, BundleInAPI, DisplayInForm, DisplayName, Sequence)
                              VALUES ('927c4b06-7c5b-4850-a35a-d761834d65e6', 'E1238F34-2837-EF11-86D4-6045BDEE16E6', 'E1BF8043-C521-444A-8446-339FF0FA032B', 'CreatedByUserID', 'One To Many', 1, 1, 'Companies', 1);
   END
                              


/* Create Entity Relationship: Pipelines -> Pipeline Stages (One To Many via PipelineID) */
   IF NOT EXISTS (
      SELECT 1
      FROM [${flyway:defaultSchema}].EntityRelationship
      WHERE ID = '0166c716-780f-4302-80dc-64af19a515c3'
   )
   BEGIN
      INSERT INTO ${flyway:defaultSchema}.EntityRelationship (ID, EntityID, RelatedEntityID, RelatedEntityJoinField, Type, BundleInAPI, DisplayInForm, DisplayName, Sequence)
                              VALUES ('0166c716-780f-4302-80dc-64af19a515c3', 'DBC820EC-BB8F-418E-92D8-85DEE9F1C3F7', 'B39A8C3C-4F32-4FD7-AF70-762FD92A5C56', 'PipelineID', 'One To Many', 1, 1, 'Pipeline Stages', 1);
   END
                              


/* Create Entity Relationship: Products -> Deal Products (One To Many via ProductID) */
   IF NOT EXISTS (
      SELECT 1
      FROM [${flyway:defaultSchema}].EntityRelationship
      WHERE ID = '5673664d-e819-48b3-9dc3-a4499862126a'
   )
   BEGIN
      INSERT INTO ${flyway:defaultSchema}.EntityRelationship (ID, EntityID, RelatedEntityID, RelatedEntityJoinField, Type, BundleInAPI, DisplayInForm, DisplayName, Sequence)
                              VALUES ('5673664d-e819-48b3-9dc3-a4499862126a', '00A21C35-B805-4DC6-ABE9-BE12B51450AF', '2FAF06FC-BBB0-4F84-8D11-3981DFC4BD37', 'ProductID', 'One To Many', 1, 1, 'Deal Products', 2);
   END
                              


/* Create Entity Relationship: Contacts -> Deals (One To Many via ContactID) */
   IF NOT EXISTS (
      SELECT 1
      FROM [${flyway:defaultSchema}].EntityRelationship
      WHERE ID = 'e6624b15-8fc7-4557-9732-5d34fa0bf202'
   )
   BEGIN
      INSERT INTO ${flyway:defaultSchema}.EntityRelationship (ID, EntityID, RelatedEntityID, RelatedEntityJoinField, Type, BundleInAPI, DisplayInForm, DisplayName, Sequence)
                              VALUES ('e6624b15-8fc7-4557-9732-5d34fa0bf202', '0B09F0BF-F617-4851-A15E-CB839A095BD6', 'EFC8B3F3-69E7-48EB-BD3D-0373D6C6DD55', 'ContactID', 'One To Many', 1, 1, 'Deals', 4);
   END
                              
/* Create Entity Relationship: Contacts -> Contact Tags (One To Many via ContactID) */
   IF NOT EXISTS (
      SELECT 1
      FROM [${flyway:defaultSchema}].EntityRelationship
      WHERE ID = 'e8b3a92c-ae1a-4c74-a43c-030346da51bd'
   )
   BEGIN
      INSERT INTO ${flyway:defaultSchema}.EntityRelationship (ID, EntityID, RelatedEntityID, RelatedEntityJoinField, Type, BundleInAPI, DisplayInForm, DisplayName, Sequence)
                              VALUES ('e8b3a92c-ae1a-4c74-a43c-030346da51bd', '0B09F0BF-F617-4851-A15E-CB839A095BD6', 'FBE2251E-61B7-457D-B788-407B4A079C13', 'ContactID', 'One To Many', 1, 1, 'Contact Tags', 1);
   END
                              
/* Create Entity Relationship: Contacts -> Contacts (One To Many via ReportsToContactID) */
   IF NOT EXISTS (
      SELECT 1
      FROM [${flyway:defaultSchema}].EntityRelationship
      WHERE ID = 'e1c18d91-325e-4e08-808f-ab3269a4805b'
   )
   BEGIN
      INSERT INTO ${flyway:defaultSchema}.EntityRelationship (ID, EntityID, RelatedEntityID, RelatedEntityJoinField, Type, BundleInAPI, DisplayInForm, DisplayName, Sequence)
                              VALUES ('e1c18d91-325e-4e08-808f-ab3269a4805b', '0B09F0BF-F617-4851-A15E-CB839A095BD6', '0B09F0BF-F617-4851-A15E-CB839A095BD6', 'ReportsToContactID', 'One To Many', 1, 1, 'Contacts', 3);
   END
                              
/* Create Entity Relationship: Contacts -> Activities (One To Many via ContactID) */
   IF NOT EXISTS (
      SELECT 1
      FROM [${flyway:defaultSchema}].EntityRelationship
      WHERE ID = '70b10923-edd3-49e7-bfe5-7656768bb971'
   )
   BEGIN
      INSERT INTO ${flyway:defaultSchema}.EntityRelationship (ID, EntityID, RelatedEntityID, RelatedEntityJoinField, Type, BundleInAPI, DisplayInForm, DisplayName, Sequence)
                              VALUES ('70b10923-edd3-49e7-bfe5-7656768bb971', '0B09F0BF-F617-4851-A15E-CB839A095BD6', '5460CFA8-0B07-4FAD-8F84-6F9D1186AD05', 'ContactID', 'One To Many', 1, 1, 'Activities', 4);
   END
                              


/* Create Entity Relationship: Tags -> Company Tags (One To Many via TagID) */
   IF NOT EXISTS (
      SELECT 1
      FROM [${flyway:defaultSchema}].EntityRelationship
      WHERE ID = '5b064bb7-504e-4e50-81e1-c262f1a727c0'
   )
   BEGIN
      INSERT INTO ${flyway:defaultSchema}.EntityRelationship (ID, EntityID, RelatedEntityID, RelatedEntityJoinField, Type, BundleInAPI, DisplayInForm, DisplayName, Sequence)
                              VALUES ('5b064bb7-504e-4e50-81e1-c262f1a727c0', '186842DA-D62B-4F8B-A53A-DC2CF7604246', '0862DE5E-379E-453B-8CDD-C097DD82814B', 'TagID', 'One To Many', 1, 1, 'Company Tags', 2);
   END
                              
/* Create Entity Relationship: Tags -> Contact Tags (One To Many via TagID) */
   IF NOT EXISTS (
      SELECT 1
      FROM [${flyway:defaultSchema}].EntityRelationship
      WHERE ID = 'd8d5361d-7a89-40fa-a78c-5693421e87c2'
   )
   BEGIN
      INSERT INTO ${flyway:defaultSchema}.EntityRelationship (ID, EntityID, RelatedEntityID, RelatedEntityJoinField, Type, BundleInAPI, DisplayInForm, DisplayName, Sequence)
                              VALUES ('d8d5361d-7a89-40fa-a78c-5693421e87c2', '186842DA-D62B-4F8B-A53A-DC2CF7604246', 'FBE2251E-61B7-457D-B788-407B4A079C13', 'TagID', 'One To Many', 1, 1, 'Contact Tags', 2);
   END
                              


/* Create Entity Relationship: Tags -> Deal Tags (One To Many via TagID) */
   IF NOT EXISTS (
      SELECT 1
      FROM [${flyway:defaultSchema}].EntityRelationship
      WHERE ID = 'dc5b2e17-3558-4df5-bcbe-31c53dc7b23c'
   )
   BEGIN
      INSERT INTO ${flyway:defaultSchema}.EntityRelationship (ID, EntityID, RelatedEntityID, RelatedEntityJoinField, Type, BundleInAPI, DisplayInForm, DisplayName, Sequence)
                              VALUES ('dc5b2e17-3558-4df5-bcbe-31c53dc7b23c', '186842DA-D62B-4F8B-A53A-DC2CF7604246', 'BBCCE24D-C17B-4CC2-992D-0DF2CC14D210', 'TagID', 'One To Many', 1, 1, 'Deal Tags', 2);
   END
                              

/* Index for Foreign Keys for Activity */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Activities
-- Item: Index for Foreign Keys
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------
-- Index for foreign key CompanyID in table Activity
IF NOT EXISTS (
    SELECT 1
    FROM sys.indexes
    WHERE name = 'IDX_AUTO_MJ_FKEY_Activity_CompanyID' 
    AND object_id = OBJECT_ID('[sample_crm].[Activity]')
)
CREATE INDEX IDX_AUTO_MJ_FKEY_Activity_CompanyID ON [sample_crm].[Activity] ([CompanyID]);

-- Index for foreign key ContactID in table Activity
IF NOT EXISTS (
    SELECT 1
    FROM sys.indexes
    WHERE name = 'IDX_AUTO_MJ_FKEY_Activity_ContactID' 
    AND object_id = OBJECT_ID('[sample_crm].[Activity]')
)
CREATE INDEX IDX_AUTO_MJ_FKEY_Activity_ContactID ON [sample_crm].[Activity] ([ContactID]);

-- Index for foreign key DealID in table Activity
IF NOT EXISTS (
    SELECT 1
    FROM sys.indexes
    WHERE name = 'IDX_AUTO_MJ_FKEY_Activity_DealID' 
    AND object_id = OBJECT_ID('[sample_crm].[Activity]')
)
CREATE INDEX IDX_AUTO_MJ_FKEY_Activity_DealID ON [sample_crm].[Activity] ([DealID]);

-- Index for foreign key CreatedByUserID in table Activity
IF NOT EXISTS (
    SELECT 1
    FROM sys.indexes
    WHERE name = 'IDX_AUTO_MJ_FKEY_Activity_CreatedByUserID' 
    AND object_id = OBJECT_ID('[sample_crm].[Activity]')
)
CREATE INDEX IDX_AUTO_MJ_FKEY_Activity_CreatedByUserID ON [sample_crm].[Activity] ([CreatedByUserID]);

/* SQL text to update entity field related entity name field map for entity field ID 9253C957-CA7A-42B9-B286-C51747D343DD */
EXEC [${flyway:defaultSchema}].spUpdateEntityFieldRelatedEntityNameFieldMap
         @EntityFieldID='9253C957-CA7A-42B9-B286-C51747D343DD',
         @RelatedEntityNameFieldMap='Company'

/* Index for Foreign Keys for Company */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Companies
-- Item: Index for Foreign Keys
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------
-- Index for foreign key CreatedByUserID in table Company
IF NOT EXISTS (
    SELECT 1
    FROM sys.indexes
    WHERE name = 'IDX_AUTO_MJ_FKEY_Company_CreatedByUserID' 
    AND object_id = OBJECT_ID('[sample_crm].[Company]')
)
CREATE INDEX IDX_AUTO_MJ_FKEY_Company_CreatedByUserID ON [sample_crm].[Company] ([CreatedByUserID]);

/* SQL text to update entity field related entity name field map for entity field ID D4E9496A-BD23-4F2A-9985-833CA34D8838 */
EXEC [${flyway:defaultSchema}].spUpdateEntityFieldRelatedEntityNameFieldMap
         @EntityFieldID='D4E9496A-BD23-4F2A-9985-833CA34D8838',
         @RelatedEntityNameFieldMap='CreatedByUser'

/* Index for Foreign Keys for CompanyTag */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Company Tags
-- Item: Index for Foreign Keys
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------
-- Index for foreign key CompanyID in table CompanyTag
IF NOT EXISTS (
    SELECT 1
    FROM sys.indexes
    WHERE name = 'IDX_AUTO_MJ_FKEY_CompanyTag_CompanyID' 
    AND object_id = OBJECT_ID('[sample_crm].[CompanyTag]')
)
CREATE INDEX IDX_AUTO_MJ_FKEY_CompanyTag_CompanyID ON [sample_crm].[CompanyTag] ([CompanyID]);

-- Index for foreign key TagID in table CompanyTag
IF NOT EXISTS (
    SELECT 1
    FROM sys.indexes
    WHERE name = 'IDX_AUTO_MJ_FKEY_CompanyTag_TagID' 
    AND object_id = OBJECT_ID('[sample_crm].[CompanyTag]')
)
CREATE INDEX IDX_AUTO_MJ_FKEY_CompanyTag_TagID ON [sample_crm].[CompanyTag] ([TagID]);

/* SQL text to update entity field related entity name field map for entity field ID 7D04A09E-9822-4786-BCFA-C61D5626D942 */
EXEC [${flyway:defaultSchema}].spUpdateEntityFieldRelatedEntityNameFieldMap
         @EntityFieldID='7D04A09E-9822-4786-BCFA-C61D5626D942',
         @RelatedEntityNameFieldMap='Company'

/* Index for Foreign Keys for ContactTag */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Contact Tags
-- Item: Index for Foreign Keys
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------
-- Index for foreign key ContactID in table ContactTag
IF NOT EXISTS (
    SELECT 1
    FROM sys.indexes
    WHERE name = 'IDX_AUTO_MJ_FKEY_ContactTag_ContactID' 
    AND object_id = OBJECT_ID('[sample_crm].[ContactTag]')
)
CREATE INDEX IDX_AUTO_MJ_FKEY_ContactTag_ContactID ON [sample_crm].[ContactTag] ([ContactID]);

-- Index for foreign key TagID in table ContactTag
IF NOT EXISTS (
    SELECT 1
    FROM sys.indexes
    WHERE name = 'IDX_AUTO_MJ_FKEY_ContactTag_TagID' 
    AND object_id = OBJECT_ID('[sample_crm].[ContactTag]')
)
CREATE INDEX IDX_AUTO_MJ_FKEY_ContactTag_TagID ON [sample_crm].[ContactTag] ([TagID]);

/* SQL text to update entity field related entity name field map for entity field ID 655F55FE-6834-4409-81CE-94EEBB97C1F5 */
EXEC [${flyway:defaultSchema}].spUpdateEntityFieldRelatedEntityNameFieldMap
         @EntityFieldID='655F55FE-6834-4409-81CE-94EEBB97C1F5',
         @RelatedEntityNameFieldMap='Tag'

/* Index for Foreign Keys for Contact */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Contacts
-- Item: Index for Foreign Keys
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------
-- Index for foreign key CompanyID in table Contact
IF NOT EXISTS (
    SELECT 1
    FROM sys.indexes
    WHERE name = 'IDX_AUTO_MJ_FKEY_Contact_CompanyID' 
    AND object_id = OBJECT_ID('[sample_crm].[Contact]')
)
CREATE INDEX IDX_AUTO_MJ_FKEY_Contact_CompanyID ON [sample_crm].[Contact] ([CompanyID]);

-- Index for foreign key ReportsToContactID in table Contact
IF NOT EXISTS (
    SELECT 1
    FROM sys.indexes
    WHERE name = 'IDX_AUTO_MJ_FKEY_Contact_ReportsToContactID' 
    AND object_id = OBJECT_ID('[sample_crm].[Contact]')
)
CREATE INDEX IDX_AUTO_MJ_FKEY_Contact_ReportsToContactID ON [sample_crm].[Contact] ([ReportsToContactID]);

-- Index for foreign key CreatedByUserID in table Contact
IF NOT EXISTS (
    SELECT 1
    FROM sys.indexes
    WHERE name = 'IDX_AUTO_MJ_FKEY_Contact_CreatedByUserID' 
    AND object_id = OBJECT_ID('[sample_crm].[Contact]')
)
CREATE INDEX IDX_AUTO_MJ_FKEY_Contact_CreatedByUserID ON [sample_crm].[Contact] ([CreatedByUserID]);

/* Root ID Function SQL for Contacts.ReportsToContactID */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Contacts
-- Item: fnContactReportsToContactID_GetRootID
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------
------------------------------------------------------------
----- ROOT ID FUNCTION FOR: [Contact].[ReportsToContactID]
------------------------------------------------------------
IF OBJECT_ID('[sample_crm].[fnContactReportsToContactID_GetRootID]', 'IF') IS NOT NULL
    DROP FUNCTION [sample_crm].[fnContactReportsToContactID_GetRootID];
GO

CREATE FUNCTION [sample_crm].[fnContactReportsToContactID_GetRootID]
(
    @RecordID uniqueidentifier,
    @ParentID uniqueidentifier
)
RETURNS TABLE
AS
RETURN
(
    WITH CTE_RootParent AS (
        -- Anchor: Start from @ParentID if not null, otherwise start from @RecordID
        SELECT
            [ID],
            [ReportsToContactID],
            [ID] AS [RootParentID],
            0 AS [Depth]
        FROM
            [sample_crm].[Contact]
        WHERE
            [ID] = COALESCE(@ParentID, @RecordID)

        UNION ALL

        -- Recursive: Keep going up the hierarchy until ReportsToContactID is NULL
        -- Includes depth counter to prevent infinite loops from circular references
        SELECT
            c.[ID],
            c.[ReportsToContactID],
            c.[ID] AS [RootParentID],
            p.[Depth] + 1 AS [Depth]
        FROM
            [sample_crm].[Contact] c
        INNER JOIN
            CTE_RootParent p ON c.[ID] = p.[ReportsToContactID]
        WHERE
            p.[Depth] < 100  -- Prevent infinite loops, max 100 levels
    )
    SELECT TOP 1
        [RootParentID] AS RootID
    FROM
        CTE_RootParent
    WHERE
        [ReportsToContactID] IS NULL
    ORDER BY
        [RootParentID]
);
GO


/* SQL text to update entity field related entity name field map for entity field ID AC970AF5-554D-4936-B53F-F5305C77412D */
EXEC [${flyway:defaultSchema}].spUpdateEntityFieldRelatedEntityNameFieldMap
         @EntityFieldID='AC970AF5-554D-4936-B53F-F5305C77412D',
         @RelatedEntityNameFieldMap='Company'

/* SQL text to update entity field related entity name field map for entity field ID 4423F88A-7ABD-4C67-92F6-5CBF449EE15A */
EXEC [${flyway:defaultSchema}].spUpdateEntityFieldRelatedEntityNameFieldMap
         @EntityFieldID='4423F88A-7ABD-4C67-92F6-5CBF449EE15A',
         @RelatedEntityNameFieldMap='Tag'

/* Base View SQL for Contact Tags */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Contact Tags
-- Item: vwContactTags
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      Contact Tags
-----               SCHEMA:      sample_crm
-----               BASE TABLE:  ContactTag
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[sample_crm].[vwContactTags]', 'V') IS NOT NULL
    DROP VIEW [sample_crm].[vwContactTags];
GO

CREATE VIEW [sample_crm].[vwContactTags]
AS
SELECT
    c.*,
    Tags_TagID.[Name] AS [Tag]
FROM
    [sample_crm].[ContactTag] AS c
INNER JOIN
    [sample_crm].[Tag] AS Tags_TagID
  ON
    [c].[TagID] = Tags_TagID.[ID]
GO
GRANT SELECT ON [sample_crm].[vwContactTags] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for Contact Tags */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Contact Tags
-- Item: Permissions for vwContactTags
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [sample_crm].[vwContactTags] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for Contact Tags */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Contact Tags
-- Item: spCreateContactTag
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR ContactTag
------------------------------------------------------------
IF OBJECT_ID('[sample_crm].[spCreateContactTag]', 'P') IS NOT NULL
    DROP PROCEDURE [sample_crm].[spCreateContactTag];
GO

CREATE PROCEDURE [sample_crm].[spCreateContactTag]
    @ID uniqueidentifier = NULL,
    @ContactID uniqueidentifier,
    @TagID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [sample_crm].[ContactTag]
            (
                [ID],
                [ContactID],
                [TagID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @ContactID,
                @TagID
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [sample_crm].[ContactTag]
            (
                [ContactID],
                [TagID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ContactID,
                @TagID
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [sample_crm].[vwContactTags] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [sample_crm].[spCreateContactTag] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for Contact Tags */

GRANT EXECUTE ON [sample_crm].[spCreateContactTag] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for Contact Tags */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Contact Tags
-- Item: spUpdateContactTag
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR ContactTag
------------------------------------------------------------
IF OBJECT_ID('[sample_crm].[spUpdateContactTag]', 'P') IS NOT NULL
    DROP PROCEDURE [sample_crm].[spUpdateContactTag];
GO

CREATE PROCEDURE [sample_crm].[spUpdateContactTag]
    @ID uniqueidentifier,
    @ContactID uniqueidentifier,
    @TagID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [sample_crm].[ContactTag]
    SET
        [ContactID] = @ContactID,
        [TagID] = @TagID
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [sample_crm].[vwContactTags] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [sample_crm].[vwContactTags]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [sample_crm].[spUpdateContactTag] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the ContactTag table
------------------------------------------------------------
IF OBJECT_ID('[sample_crm].[trgUpdateContactTag]', 'TR') IS NOT NULL
    DROP TRIGGER [sample_crm].[trgUpdateContactTag];
GO
CREATE TRIGGER [sample_crm].trgUpdateContactTag
ON [sample_crm].[ContactTag]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [sample_crm].[ContactTag]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [sample_crm].[ContactTag] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for Contact Tags */

GRANT EXECUTE ON [sample_crm].[spUpdateContactTag] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for Contact Tags */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Contact Tags
-- Item: spDeleteContactTag
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR ContactTag
------------------------------------------------------------
IF OBJECT_ID('[sample_crm].[spDeleteContactTag]', 'P') IS NOT NULL
    DROP PROCEDURE [sample_crm].[spDeleteContactTag];
GO

CREATE PROCEDURE [sample_crm].[spDeleteContactTag]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [sample_crm].[ContactTag]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [sample_crm].[spDeleteContactTag] TO [cdp_Integration]
    

/* spDelete Permissions for Contact Tags */

GRANT EXECUTE ON [sample_crm].[spDeleteContactTag] TO [cdp_Integration]



/* SQL text to update entity field related entity name field map for entity field ID ABA02308-A4DC-41EA-9A52-D426CFA65E75 */
EXEC [${flyway:defaultSchema}].spUpdateEntityFieldRelatedEntityNameFieldMap
         @EntityFieldID='ABA02308-A4DC-41EA-9A52-D426CFA65E75',
         @RelatedEntityNameFieldMap='Deal'

/* SQL text to update entity field related entity name field map for entity field ID B252D344-9882-4018-A9FC-04AD114936BA */
EXEC [${flyway:defaultSchema}].spUpdateEntityFieldRelatedEntityNameFieldMap
         @EntityFieldID='B252D344-9882-4018-A9FC-04AD114936BA',
         @RelatedEntityNameFieldMap='CreatedByUser'

/* Base View SQL for Companies */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Companies
-- Item: vwCompanies
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      Companies
-----               SCHEMA:      sample_crm
-----               BASE TABLE:  Company
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[sample_crm].[vwCompanies]', 'V') IS NOT NULL
    DROP VIEW [sample_crm].[vwCompanies];
GO

CREATE VIEW [sample_crm].[vwCompanies]
AS
SELECT
    c.*,
    MJUsers_CreatedByUserID.[Name] AS [CreatedByUser]
FROM
    [sample_crm].[Company] AS c
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_CreatedByUserID
  ON
    [c].[CreatedByUserID] = MJUsers_CreatedByUserID.[ID]
GO
GRANT SELECT ON [sample_crm].[vwCompanies] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for Companies */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Companies
-- Item: Permissions for vwCompanies
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [sample_crm].[vwCompanies] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for Companies */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Companies
-- Item: spCreateCompany
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR Company
------------------------------------------------------------
IF OBJECT_ID('[sample_crm].[spCreateCompany]', 'P') IS NOT NULL
    DROP PROCEDURE [sample_crm].[spCreateCompany];
GO

CREATE PROCEDURE [sample_crm].[spCreateCompany]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(200),
    @Industry nvarchar(100),
    @Website nvarchar(500),
    @Phone nvarchar(50),
    @AnnualRevenue decimal(18, 2),
    @EmployeeCount int,
    @Status nvarchar(20),
    @Notes nvarchar(MAX),
    @CreatedByUserID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [sample_crm].[Company]
            (
                [ID],
                [Name],
                [Industry],
                [Website],
                [Phone],
                [AnnualRevenue],
                [EmployeeCount],
                [Status],
                [Notes],
                [CreatedByUserID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Industry,
                @Website,
                @Phone,
                @AnnualRevenue,
                @EmployeeCount,
                @Status,
                @Notes,
                @CreatedByUserID
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [sample_crm].[Company]
            (
                [Name],
                [Industry],
                [Website],
                [Phone],
                [AnnualRevenue],
                [EmployeeCount],
                [Status],
                [Notes],
                [CreatedByUserID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Industry,
                @Website,
                @Phone,
                @AnnualRevenue,
                @EmployeeCount,
                @Status,
                @Notes,
                @CreatedByUserID
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [sample_crm].[vwCompanies] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [sample_crm].[spCreateCompany] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for Companies */

GRANT EXECUTE ON [sample_crm].[spCreateCompany] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for Companies */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Companies
-- Item: spUpdateCompany
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR Company
------------------------------------------------------------
IF OBJECT_ID('[sample_crm].[spUpdateCompany]', 'P') IS NOT NULL
    DROP PROCEDURE [sample_crm].[spUpdateCompany];
GO

CREATE PROCEDURE [sample_crm].[spUpdateCompany]
    @ID uniqueidentifier,
    @Name nvarchar(200),
    @Industry nvarchar(100),
    @Website nvarchar(500),
    @Phone nvarchar(50),
    @AnnualRevenue decimal(18, 2),
    @EmployeeCount int,
    @Status nvarchar(20),
    @Notes nvarchar(MAX),
    @CreatedByUserID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [sample_crm].[Company]
    SET
        [Name] = @Name,
        [Industry] = @Industry,
        [Website] = @Website,
        [Phone] = @Phone,
        [AnnualRevenue] = @AnnualRevenue,
        [EmployeeCount] = @EmployeeCount,
        [Status] = @Status,
        [Notes] = @Notes,
        [CreatedByUserID] = @CreatedByUserID
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [sample_crm].[vwCompanies] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [sample_crm].[vwCompanies]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [sample_crm].[spUpdateCompany] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the Company table
------------------------------------------------------------
IF OBJECT_ID('[sample_crm].[trgUpdateCompany]', 'TR') IS NOT NULL
    DROP TRIGGER [sample_crm].[trgUpdateCompany];
GO
CREATE TRIGGER [sample_crm].trgUpdateCompany
ON [sample_crm].[Company]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [sample_crm].[Company]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [sample_crm].[Company] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for Companies */

GRANT EXECUTE ON [sample_crm].[spUpdateCompany] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for Companies */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Companies
-- Item: spDeleteCompany
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR Company
------------------------------------------------------------
IF OBJECT_ID('[sample_crm].[spDeleteCompany]', 'P') IS NOT NULL
    DROP PROCEDURE [sample_crm].[spDeleteCompany];
GO

CREATE PROCEDURE [sample_crm].[spDeleteCompany]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [sample_crm].[Company]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [sample_crm].[spDeleteCompany] TO [cdp_Integration]
    

/* spDelete Permissions for Companies */

GRANT EXECUTE ON [sample_crm].[spDeleteCompany] TO [cdp_Integration]



/* Base View SQL for Contacts */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Contacts
-- Item: vwContacts
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      Contacts
-----               SCHEMA:      sample_crm
-----               BASE TABLE:  Contact
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[sample_crm].[vwContacts]', 'V') IS NOT NULL
    DROP VIEW [sample_crm].[vwContacts];
GO

CREATE VIEW [sample_crm].[vwContacts]
AS
SELECT
    c.*,
    Companies_CompanyID.[Name] AS [Company],
    MJUsers_CreatedByUserID.[Name] AS [CreatedByUser],
    root_ReportsToContactID.RootID AS [RootReportsToContactID]
FROM
    [sample_crm].[Contact] AS c
INNER JOIN
    [sample_crm].[Company] AS Companies_CompanyID
  ON
    [c].[CompanyID] = Companies_CompanyID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_CreatedByUserID
  ON
    [c].[CreatedByUserID] = MJUsers_CreatedByUserID.[ID]
OUTER APPLY
    [sample_crm].[fnContactReportsToContactID_GetRootID]([c].[ID], [c].[ReportsToContactID]) AS root_ReportsToContactID
GO
GRANT SELECT ON [sample_crm].[vwContacts] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for Contacts */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Contacts
-- Item: Permissions for vwContacts
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [sample_crm].[vwContacts] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for Contacts */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Contacts
-- Item: spCreateContact
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR Contact
------------------------------------------------------------
IF OBJECT_ID('[sample_crm].[spCreateContact]', 'P') IS NOT NULL
    DROP PROCEDURE [sample_crm].[spCreateContact];
GO

CREATE PROCEDURE [sample_crm].[spCreateContact]
    @ID uniqueidentifier = NULL,
    @CompanyID uniqueidentifier,
    @FirstName nvarchar(100),
    @LastName nvarchar(100),
    @Email nvarchar(200),
    @Phone nvarchar(50),
    @Title nvarchar(100),
    @Department nvarchar(100),
    @ReportsToContactID uniqueidentifier,
    @IsPrimary bit = NULL,
    @Status nvarchar(20),
    @Notes nvarchar(MAX),
    @CreatedByUserID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [sample_crm].[Contact]
            (
                [ID],
                [CompanyID],
                [FirstName],
                [LastName],
                [Email],
                [Phone],
                [Title],
                [Department],
                [ReportsToContactID],
                [IsPrimary],
                [Status],
                [Notes],
                [CreatedByUserID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @CompanyID,
                @FirstName,
                @LastName,
                @Email,
                @Phone,
                @Title,
                @Department,
                @ReportsToContactID,
                ISNULL(@IsPrimary, 0),
                @Status,
                @Notes,
                @CreatedByUserID
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [sample_crm].[Contact]
            (
                [CompanyID],
                [FirstName],
                [LastName],
                [Email],
                [Phone],
                [Title],
                [Department],
                [ReportsToContactID],
                [IsPrimary],
                [Status],
                [Notes],
                [CreatedByUserID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @CompanyID,
                @FirstName,
                @LastName,
                @Email,
                @Phone,
                @Title,
                @Department,
                @ReportsToContactID,
                ISNULL(@IsPrimary, 0),
                @Status,
                @Notes,
                @CreatedByUserID
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [sample_crm].[vwContacts] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [sample_crm].[spCreateContact] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for Contacts */

GRANT EXECUTE ON [sample_crm].[spCreateContact] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for Contacts */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Contacts
-- Item: spUpdateContact
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR Contact
------------------------------------------------------------
IF OBJECT_ID('[sample_crm].[spUpdateContact]', 'P') IS NOT NULL
    DROP PROCEDURE [sample_crm].[spUpdateContact];
GO

CREATE PROCEDURE [sample_crm].[spUpdateContact]
    @ID uniqueidentifier,
    @CompanyID uniqueidentifier,
    @FirstName nvarchar(100),
    @LastName nvarchar(100),
    @Email nvarchar(200),
    @Phone nvarchar(50),
    @Title nvarchar(100),
    @Department nvarchar(100),
    @ReportsToContactID uniqueidentifier,
    @IsPrimary bit,
    @Status nvarchar(20),
    @Notes nvarchar(MAX),
    @CreatedByUserID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [sample_crm].[Contact]
    SET
        [CompanyID] = @CompanyID,
        [FirstName] = @FirstName,
        [LastName] = @LastName,
        [Email] = @Email,
        [Phone] = @Phone,
        [Title] = @Title,
        [Department] = @Department,
        [ReportsToContactID] = @ReportsToContactID,
        [IsPrimary] = @IsPrimary,
        [Status] = @Status,
        [Notes] = @Notes,
        [CreatedByUserID] = @CreatedByUserID
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [sample_crm].[vwContacts] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [sample_crm].[vwContacts]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [sample_crm].[spUpdateContact] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the Contact table
------------------------------------------------------------
IF OBJECT_ID('[sample_crm].[trgUpdateContact]', 'TR') IS NOT NULL
    DROP TRIGGER [sample_crm].[trgUpdateContact];
GO
CREATE TRIGGER [sample_crm].trgUpdateContact
ON [sample_crm].[Contact]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [sample_crm].[Contact]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [sample_crm].[Contact] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for Contacts */

GRANT EXECUTE ON [sample_crm].[spUpdateContact] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for Contacts */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Contacts
-- Item: spDeleteContact
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR Contact
------------------------------------------------------------
IF OBJECT_ID('[sample_crm].[spDeleteContact]', 'P') IS NOT NULL
    DROP PROCEDURE [sample_crm].[spDeleteContact];
GO

CREATE PROCEDURE [sample_crm].[spDeleteContact]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [sample_crm].[Contact]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [sample_crm].[spDeleteContact] TO [cdp_Integration]
    

/* spDelete Permissions for Contacts */

GRANT EXECUTE ON [sample_crm].[spDeleteContact] TO [cdp_Integration]



/* Base View SQL for Company Tags */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Company Tags
-- Item: vwCompanyTags
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      Company Tags
-----               SCHEMA:      sample_crm
-----               BASE TABLE:  CompanyTag
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[sample_crm].[vwCompanyTags]', 'V') IS NOT NULL
    DROP VIEW [sample_crm].[vwCompanyTags];
GO

CREATE VIEW [sample_crm].[vwCompanyTags]
AS
SELECT
    c.*,
    Companies_CompanyID.[Name] AS [Company],
    Tags_TagID.[Name] AS [Tag]
FROM
    [sample_crm].[CompanyTag] AS c
INNER JOIN
    [sample_crm].[Company] AS Companies_CompanyID
  ON
    [c].[CompanyID] = Companies_CompanyID.[ID]
INNER JOIN
    [sample_crm].[Tag] AS Tags_TagID
  ON
    [c].[TagID] = Tags_TagID.[ID]
GO
GRANT SELECT ON [sample_crm].[vwCompanyTags] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for Company Tags */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Company Tags
-- Item: Permissions for vwCompanyTags
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [sample_crm].[vwCompanyTags] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for Company Tags */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Company Tags
-- Item: spCreateCompanyTag
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR CompanyTag
------------------------------------------------------------
IF OBJECT_ID('[sample_crm].[spCreateCompanyTag]', 'P') IS NOT NULL
    DROP PROCEDURE [sample_crm].[spCreateCompanyTag];
GO

CREATE PROCEDURE [sample_crm].[spCreateCompanyTag]
    @ID uniqueidentifier = NULL,
    @CompanyID uniqueidentifier,
    @TagID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [sample_crm].[CompanyTag]
            (
                [ID],
                [CompanyID],
                [TagID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @CompanyID,
                @TagID
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [sample_crm].[CompanyTag]
            (
                [CompanyID],
                [TagID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @CompanyID,
                @TagID
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [sample_crm].[vwCompanyTags] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [sample_crm].[spCreateCompanyTag] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for Company Tags */

GRANT EXECUTE ON [sample_crm].[spCreateCompanyTag] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for Company Tags */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Company Tags
-- Item: spUpdateCompanyTag
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR CompanyTag
------------------------------------------------------------
IF OBJECT_ID('[sample_crm].[spUpdateCompanyTag]', 'P') IS NOT NULL
    DROP PROCEDURE [sample_crm].[spUpdateCompanyTag];
GO

CREATE PROCEDURE [sample_crm].[spUpdateCompanyTag]
    @ID uniqueidentifier,
    @CompanyID uniqueidentifier,
    @TagID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [sample_crm].[CompanyTag]
    SET
        [CompanyID] = @CompanyID,
        [TagID] = @TagID
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [sample_crm].[vwCompanyTags] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [sample_crm].[vwCompanyTags]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [sample_crm].[spUpdateCompanyTag] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the CompanyTag table
------------------------------------------------------------
IF OBJECT_ID('[sample_crm].[trgUpdateCompanyTag]', 'TR') IS NOT NULL
    DROP TRIGGER [sample_crm].[trgUpdateCompanyTag];
GO
CREATE TRIGGER [sample_crm].trgUpdateCompanyTag
ON [sample_crm].[CompanyTag]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [sample_crm].[CompanyTag]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [sample_crm].[CompanyTag] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for Company Tags */

GRANT EXECUTE ON [sample_crm].[spUpdateCompanyTag] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for Company Tags */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Company Tags
-- Item: spDeleteCompanyTag
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR CompanyTag
------------------------------------------------------------
IF OBJECT_ID('[sample_crm].[spDeleteCompanyTag]', 'P') IS NOT NULL
    DROP PROCEDURE [sample_crm].[spDeleteCompanyTag];
GO

CREATE PROCEDURE [sample_crm].[spDeleteCompanyTag]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [sample_crm].[CompanyTag]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [sample_crm].[spDeleteCompanyTag] TO [cdp_Integration]
    

/* spDelete Permissions for Company Tags */

GRANT EXECUTE ON [sample_crm].[spDeleteCompanyTag] TO [cdp_Integration]



/* SQL text to update entity field related entity name field map for entity field ID 34FEAD7B-B879-4FE9-B509-1E74212DF8D0 */
EXEC [${flyway:defaultSchema}].spUpdateEntityFieldRelatedEntityNameFieldMap
         @EntityFieldID='34FEAD7B-B879-4FE9-B509-1E74212DF8D0',
         @RelatedEntityNameFieldMap='CreatedByUser'

/* Base View SQL for Activities */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Activities
-- Item: vwActivities
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      Activities
-----               SCHEMA:      sample_crm
-----               BASE TABLE:  Activity
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[sample_crm].[vwActivities]', 'V') IS NOT NULL
    DROP VIEW [sample_crm].[vwActivities];
GO

CREATE VIEW [sample_crm].[vwActivities]
AS
SELECT
    a.*,
    Companies_CompanyID.[Name] AS [Company],
    Deals_DealID.[Name] AS [Deal],
    MJUsers_CreatedByUserID.[Name] AS [CreatedByUser]
FROM
    [sample_crm].[Activity] AS a
LEFT OUTER JOIN
    [sample_crm].[Company] AS Companies_CompanyID
  ON
    [a].[CompanyID] = Companies_CompanyID.[ID]
LEFT OUTER JOIN
    [sample_crm].[Deal] AS Deals_DealID
  ON
    [a].[DealID] = Deals_DealID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_CreatedByUserID
  ON
    [a].[CreatedByUserID] = MJUsers_CreatedByUserID.[ID]
GO
GRANT SELECT ON [sample_crm].[vwActivities] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for Activities */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Activities
-- Item: Permissions for vwActivities
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [sample_crm].[vwActivities] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for Activities */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Activities
-- Item: spCreateActivity
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR Activity
------------------------------------------------------------
IF OBJECT_ID('[sample_crm].[spCreateActivity]', 'P') IS NOT NULL
    DROP PROCEDURE [sample_crm].[spCreateActivity];
GO

CREATE PROCEDURE [sample_crm].[spCreateActivity]
    @ID uniqueidentifier = NULL,
    @Type nvarchar(20),
    @Subject nvarchar(500),
    @Description nvarchar(MAX),
    @ActivityDate datetime = NULL,
    @DurationMinutes int,
    @CompanyID uniqueidentifier,
    @ContactID uniqueidentifier,
    @DealID uniqueidentifier,
    @CompletedAt datetime,
    @CreatedByUserID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [sample_crm].[Activity]
            (
                [ID],
                [Type],
                [Subject],
                [Description],
                [ActivityDate],
                [DurationMinutes],
                [CompanyID],
                [ContactID],
                [DealID],
                [CompletedAt],
                [CreatedByUserID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Type,
                @Subject,
                @Description,
                ISNULL(@ActivityDate, getutcdate()),
                @DurationMinutes,
                @CompanyID,
                @ContactID,
                @DealID,
                @CompletedAt,
                @CreatedByUserID
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [sample_crm].[Activity]
            (
                [Type],
                [Subject],
                [Description],
                [ActivityDate],
                [DurationMinutes],
                [CompanyID],
                [ContactID],
                [DealID],
                [CompletedAt],
                [CreatedByUserID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Type,
                @Subject,
                @Description,
                ISNULL(@ActivityDate, getutcdate()),
                @DurationMinutes,
                @CompanyID,
                @ContactID,
                @DealID,
                @CompletedAt,
                @CreatedByUserID
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [sample_crm].[vwActivities] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [sample_crm].[spCreateActivity] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for Activities */

GRANT EXECUTE ON [sample_crm].[spCreateActivity] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for Activities */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Activities
-- Item: spUpdateActivity
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR Activity
------------------------------------------------------------
IF OBJECT_ID('[sample_crm].[spUpdateActivity]', 'P') IS NOT NULL
    DROP PROCEDURE [sample_crm].[spUpdateActivity];
GO

CREATE PROCEDURE [sample_crm].[spUpdateActivity]
    @ID uniqueidentifier,
    @Type nvarchar(20),
    @Subject nvarchar(500),
    @Description nvarchar(MAX),
    @ActivityDate datetime,
    @DurationMinutes int,
    @CompanyID uniqueidentifier,
    @ContactID uniqueidentifier,
    @DealID uniqueidentifier,
    @CompletedAt datetime,
    @CreatedByUserID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [sample_crm].[Activity]
    SET
        [Type] = @Type,
        [Subject] = @Subject,
        [Description] = @Description,
        [ActivityDate] = @ActivityDate,
        [DurationMinutes] = @DurationMinutes,
        [CompanyID] = @CompanyID,
        [ContactID] = @ContactID,
        [DealID] = @DealID,
        [CompletedAt] = @CompletedAt,
        [CreatedByUserID] = @CreatedByUserID
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [sample_crm].[vwActivities] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [sample_crm].[vwActivities]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [sample_crm].[spUpdateActivity] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the Activity table
------------------------------------------------------------
IF OBJECT_ID('[sample_crm].[trgUpdateActivity]', 'TR') IS NOT NULL
    DROP TRIGGER [sample_crm].[trgUpdateActivity];
GO
CREATE TRIGGER [sample_crm].trgUpdateActivity
ON [sample_crm].[Activity]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [sample_crm].[Activity]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [sample_crm].[Activity] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for Activities */

GRANT EXECUTE ON [sample_crm].[spUpdateActivity] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for Activities */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Activities
-- Item: spDeleteActivity
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR Activity
------------------------------------------------------------
IF OBJECT_ID('[sample_crm].[spDeleteActivity]', 'P') IS NOT NULL
    DROP PROCEDURE [sample_crm].[spDeleteActivity];
GO

CREATE PROCEDURE [sample_crm].[spDeleteActivity]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [sample_crm].[Activity]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [sample_crm].[spDeleteActivity] TO [cdp_Integration]
    

/* spDelete Permissions for Activities */

GRANT EXECUTE ON [sample_crm].[spDeleteActivity] TO [cdp_Integration]



/* Index for Foreign Keys for DealProduct */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Deal Products
-- Item: Index for Foreign Keys
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------
-- Index for foreign key DealID in table DealProduct
IF NOT EXISTS (
    SELECT 1
    FROM sys.indexes
    WHERE name = 'IDX_AUTO_MJ_FKEY_DealProduct_DealID' 
    AND object_id = OBJECT_ID('[sample_crm].[DealProduct]')
)
CREATE INDEX IDX_AUTO_MJ_FKEY_DealProduct_DealID ON [sample_crm].[DealProduct] ([DealID]);

-- Index for foreign key ProductID in table DealProduct
IF NOT EXISTS (
    SELECT 1
    FROM sys.indexes
    WHERE name = 'IDX_AUTO_MJ_FKEY_DealProduct_ProductID' 
    AND object_id = OBJECT_ID('[sample_crm].[DealProduct]')
)
CREATE INDEX IDX_AUTO_MJ_FKEY_DealProduct_ProductID ON [sample_crm].[DealProduct] ([ProductID]);

/* SQL text to update entity field related entity name field map for entity field ID 6DF34E22-7BBE-4B4D-A15A-83CF2F01DB13 */
EXEC [${flyway:defaultSchema}].spUpdateEntityFieldRelatedEntityNameFieldMap
         @EntityFieldID='6DF34E22-7BBE-4B4D-A15A-83CF2F01DB13',
         @RelatedEntityNameFieldMap='Deal'

/* Index for Foreign Keys for DealTag */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Deal Tags
-- Item: Index for Foreign Keys
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------
-- Index for foreign key DealID in table DealTag
IF NOT EXISTS (
    SELECT 1
    FROM sys.indexes
    WHERE name = 'IDX_AUTO_MJ_FKEY_DealTag_DealID' 
    AND object_id = OBJECT_ID('[sample_crm].[DealTag]')
)
CREATE INDEX IDX_AUTO_MJ_FKEY_DealTag_DealID ON [sample_crm].[DealTag] ([DealID]);

-- Index for foreign key TagID in table DealTag
IF NOT EXISTS (
    SELECT 1
    FROM sys.indexes
    WHERE name = 'IDX_AUTO_MJ_FKEY_DealTag_TagID' 
    AND object_id = OBJECT_ID('[sample_crm].[DealTag]')
)
CREATE INDEX IDX_AUTO_MJ_FKEY_DealTag_TagID ON [sample_crm].[DealTag] ([TagID]);

/* SQL text to update entity field related entity name field map for entity field ID D4E7E22E-37F3-4EB3-AC80-B1FBCA4C2927 */
EXEC [${flyway:defaultSchema}].spUpdateEntityFieldRelatedEntityNameFieldMap
         @EntityFieldID='D4E7E22E-37F3-4EB3-AC80-B1FBCA4C2927',
         @RelatedEntityNameFieldMap='Deal'

/* Index for Foreign Keys for Deal */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Deals
-- Item: Index for Foreign Keys
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------
-- Index for foreign key CompanyID in table Deal
IF NOT EXISTS (
    SELECT 1
    FROM sys.indexes
    WHERE name = 'IDX_AUTO_MJ_FKEY_Deal_CompanyID' 
    AND object_id = OBJECT_ID('[sample_crm].[Deal]')
)
CREATE INDEX IDX_AUTO_MJ_FKEY_Deal_CompanyID ON [sample_crm].[Deal] ([CompanyID]);

-- Index for foreign key ContactID in table Deal
IF NOT EXISTS (
    SELECT 1
    FROM sys.indexes
    WHERE name = 'IDX_AUTO_MJ_FKEY_Deal_ContactID' 
    AND object_id = OBJECT_ID('[sample_crm].[Deal]')
)
CREATE INDEX IDX_AUTO_MJ_FKEY_Deal_ContactID ON [sample_crm].[Deal] ([ContactID]);

-- Index for foreign key AssignedToUserID in table Deal
IF NOT EXISTS (
    SELECT 1
    FROM sys.indexes
    WHERE name = 'IDX_AUTO_MJ_FKEY_Deal_AssignedToUserID' 
    AND object_id = OBJECT_ID('[sample_crm].[Deal]')
)
CREATE INDEX IDX_AUTO_MJ_FKEY_Deal_AssignedToUserID ON [sample_crm].[Deal] ([AssignedToUserID]);

-- Index for foreign key CreatedByUserID in table Deal
IF NOT EXISTS (
    SELECT 1
    FROM sys.indexes
    WHERE name = 'IDX_AUTO_MJ_FKEY_Deal_CreatedByUserID' 
    AND object_id = OBJECT_ID('[sample_crm].[Deal]')
)
CREATE INDEX IDX_AUTO_MJ_FKEY_Deal_CreatedByUserID ON [sample_crm].[Deal] ([CreatedByUserID]);

/* SQL text to update entity field related entity name field map for entity field ID 09B48E5D-448B-477F-85C4-366642A2D286 */
EXEC [${flyway:defaultSchema}].spUpdateEntityFieldRelatedEntityNameFieldMap
         @EntityFieldID='09B48E5D-448B-477F-85C4-366642A2D286',
         @RelatedEntityNameFieldMap='Company'

/* Base View SQL for MJ: Access Control Rules */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Access Control Rules
-- Item: vwAccessControlRules
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Access Control Rules
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  AccessControlRule
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwAccessControlRules]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwAccessControlRules];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwAccessControlRules]
AS
SELECT
    m.*,
    MJEntities_EntityID.[Name] AS [Entity],
    MJUsers_GrantedByUserID.[Name] AS [GrantedByUser]
FROM
    [${flyway:defaultSchema}].[AccessControlRule] AS m
INNER JOIN
    [${flyway:defaultSchema}].[Entity] AS MJEntities_EntityID
  ON
    [m].[EntityID] = MJEntities_EntityID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_GrantedByUserID
  ON
    [m].[GrantedByUserID] = MJUsers_GrantedByUserID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwAccessControlRules] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Access Control Rules */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Access Control Rules
-- Item: Permissions for vwAccessControlRules
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwAccessControlRules] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Access Control Rules */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Access Control Rules
-- Item: spCreateMJAccessControlRule
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR AccessControlRule
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJAccessControlRule]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJAccessControlRule];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJAccessControlRule]
    @ID uniqueidentifier = NULL,
    @EntityID uniqueidentifier,
    @RecordID nvarchar(500),
    @GranteeType nvarchar(50),
    @GranteeID uniqueidentifier,
    @CanRead bit = NULL,
    @CanCreate bit = NULL,
    @CanUpdate bit = NULL,
    @CanDelete bit = NULL,
    @CanShare bit = NULL,
    @ExpiresAt datetimeoffset,
    @GrantedByUserID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[AccessControlRule]
            (
                [ID],
                [EntityID],
                [RecordID],
                [GranteeType],
                [GranteeID],
                [CanRead],
                [CanCreate],
                [CanUpdate],
                [CanDelete],
                [CanShare],
                [ExpiresAt],
                [GrantedByUserID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @EntityID,
                @RecordID,
                @GranteeType,
                @GranteeID,
                ISNULL(@CanRead, 0),
                ISNULL(@CanCreate, 0),
                ISNULL(@CanUpdate, 0),
                ISNULL(@CanDelete, 0),
                ISNULL(@CanShare, 0),
                @ExpiresAt,
                @GrantedByUserID
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[AccessControlRule]
            (
                [EntityID],
                [RecordID],
                [GranteeType],
                [GranteeID],
                [CanRead],
                [CanCreate],
                [CanUpdate],
                [CanDelete],
                [CanShare],
                [ExpiresAt],
                [GrantedByUserID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @EntityID,
                @RecordID,
                @GranteeType,
                @GranteeID,
                ISNULL(@CanRead, 0),
                ISNULL(@CanCreate, 0),
                ISNULL(@CanUpdate, 0),
                ISNULL(@CanDelete, 0),
                ISNULL(@CanShare, 0),
                @ExpiresAt,
                @GrantedByUserID
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwAccessControlRules] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAccessControlRule] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Access Control Rules */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAccessControlRule] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Access Control Rules */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Access Control Rules
-- Item: spUpdateMJAccessControlRule
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR AccessControlRule
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJAccessControlRule]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAccessControlRule];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAccessControlRule]
    @ID uniqueidentifier,
    @EntityID uniqueidentifier,
    @RecordID nvarchar(500),
    @GranteeType nvarchar(50),
    @GranteeID uniqueidentifier,
    @CanRead bit,
    @CanCreate bit,
    @CanUpdate bit,
    @CanDelete bit,
    @CanShare bit,
    @ExpiresAt datetimeoffset,
    @GrantedByUserID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AccessControlRule]
    SET
        [EntityID] = @EntityID,
        [RecordID] = @RecordID,
        [GranteeType] = @GranteeType,
        [GranteeID] = @GranteeID,
        [CanRead] = @CanRead,
        [CanCreate] = @CanCreate,
        [CanUpdate] = @CanUpdate,
        [CanDelete] = @CanDelete,
        [CanShare] = @CanShare,
        [ExpiresAt] = @ExpiresAt,
        [GrantedByUserID] = @GrantedByUserID
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwAccessControlRules] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwAccessControlRules]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAccessControlRule] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the AccessControlRule table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJAccessControlRule]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJAccessControlRule];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJAccessControlRule
ON [${flyway:defaultSchema}].[AccessControlRule]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AccessControlRule]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[AccessControlRule] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Access Control Rules */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAccessControlRule] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Access Control Rules */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Access Control Rules
-- Item: spDeleteMJAccessControlRule
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR AccessControlRule
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJAccessControlRule]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAccessControlRule];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAccessControlRule]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[AccessControlRule]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAccessControlRule] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Access Control Rules */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAccessControlRule] TO [cdp_Integration]



/* Base View SQL for MJ: Action Authorizations */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Action Authorizations
-- Item: vwActionAuthorizations
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Action Authorizations
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  ActionAuthorization
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwActionAuthorizations]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwActionAuthorizations];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwActionAuthorizations]
AS
SELECT
    m.*,
    MJActions_ActionID.[Name] AS [Action],
    MJAuthorizations_AuthorizationID.[Name] AS [Authorization]
FROM
    [${flyway:defaultSchema}].[ActionAuthorization] AS m
INNER JOIN
    [${flyway:defaultSchema}].[Action] AS MJActions_ActionID
  ON
    [m].[ActionID] = MJActions_ActionID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[Authorization] AS MJAuthorizations_AuthorizationID
  ON
    [m].[AuthorizationID] = MJAuthorizations_AuthorizationID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwActionAuthorizations] TO [cdp_UI], [cdp_Integration], [cdp_Developer]
    

/* Base View Permissions SQL for MJ: Action Authorizations */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Action Authorizations
-- Item: Permissions for vwActionAuthorizations
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwActionAuthorizations] TO [cdp_UI], [cdp_Integration], [cdp_Developer]

/* spCreate SQL for MJ: Action Authorizations */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Action Authorizations
-- Item: spCreateMJActionAuthorization
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR ActionAuthorization
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJActionAuthorization]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJActionAuthorization];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJActionAuthorization]
    @ID uniqueidentifier = NULL,
    @ActionID uniqueidentifier,
    @AuthorizationID uniqueidentifier,
    @Comments nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[ActionAuthorization]
            (
                [ID],
                [ActionID],
                [AuthorizationID],
                [Comments]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @ActionID,
                @AuthorizationID,
                @Comments
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[ActionAuthorization]
            (
                [ActionID],
                [AuthorizationID],
                [Comments]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ActionID,
                @AuthorizationID,
                @Comments
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwActionAuthorizations] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJActionAuthorization] TO [cdp_Integration], [cdp_Developer]
    

/* spCreate Permissions for MJ: Action Authorizations */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJActionAuthorization] TO [cdp_Integration], [cdp_Developer]



/* spUpdate SQL for MJ: Action Authorizations */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Action Authorizations
-- Item: spUpdateMJActionAuthorization
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR ActionAuthorization
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJActionAuthorization]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJActionAuthorization];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJActionAuthorization]
    @ID uniqueidentifier,
    @ActionID uniqueidentifier,
    @AuthorizationID uniqueidentifier,
    @Comments nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ActionAuthorization]
    SET
        [ActionID] = @ActionID,
        [AuthorizationID] = @AuthorizationID,
        [Comments] = @Comments
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwActionAuthorizations] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwActionAuthorizations]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJActionAuthorization] TO [cdp_Integration], [cdp_Developer]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the ActionAuthorization table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJActionAuthorization]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJActionAuthorization];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJActionAuthorization
ON [${flyway:defaultSchema}].[ActionAuthorization]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ActionAuthorization]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[ActionAuthorization] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Action Authorizations */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJActionAuthorization] TO [cdp_Integration], [cdp_Developer]



/* spDelete SQL for MJ: Action Authorizations */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Action Authorizations
-- Item: spDeleteMJActionAuthorization
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR ActionAuthorization
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJActionAuthorization]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJActionAuthorization];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJActionAuthorization]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[ActionAuthorization]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJActionAuthorization] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Action Authorizations */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJActionAuthorization] TO [cdp_Integration]



/* SQL text to update entity field related entity name field map for entity field ID EB37D1F0-0BC8-4C84-8F01-C6D109206F31 */
EXEC [${flyway:defaultSchema}].spUpdateEntityFieldRelatedEntityNameFieldMap
         @EntityFieldID='EB37D1F0-0BC8-4C84-8F01-C6D109206F31',
         @RelatedEntityNameFieldMap='AssignedToUser'

/* SQL text to update entity field related entity name field map for entity field ID 930449A3-5C78-46CF-9A7D-86CAB8E3EC38 */
EXEC [${flyway:defaultSchema}].spUpdateEntityFieldRelatedEntityNameFieldMap
         @EntityFieldID='930449A3-5C78-46CF-9A7D-86CAB8E3EC38',
         @RelatedEntityNameFieldMap='Tag'

/* SQL text to update entity field related entity name field map for entity field ID 333411D9-EA1D-4783-B65B-AF5061605E2A */
EXEC [${flyway:defaultSchema}].spUpdateEntityFieldRelatedEntityNameFieldMap
         @EntityFieldID='333411D9-EA1D-4783-B65B-AF5061605E2A',
         @RelatedEntityNameFieldMap='Product'

/* Base View SQL for Deal Products */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Deal Products
-- Item: vwDealProducts
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      Deal Products
-----               SCHEMA:      sample_crm
-----               BASE TABLE:  DealProduct
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[sample_crm].[vwDealProducts]', 'V') IS NOT NULL
    DROP VIEW [sample_crm].[vwDealProducts];
GO

CREATE VIEW [sample_crm].[vwDealProducts]
AS
SELECT
    d.*,
    Deals_DealID.[Name] AS [Deal],
    Products_ProductID.[Name] AS [Product]
FROM
    [sample_crm].[DealProduct] AS d
INNER JOIN
    [sample_crm].[Deal] AS Deals_DealID
  ON
    [d].[DealID] = Deals_DealID.[ID]
INNER JOIN
    [sample_crm].[Product] AS Products_ProductID
  ON
    [d].[ProductID] = Products_ProductID.[ID]
GO
GRANT SELECT ON [sample_crm].[vwDealProducts] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for Deal Products */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Deal Products
-- Item: Permissions for vwDealProducts
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [sample_crm].[vwDealProducts] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for Deal Products */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Deal Products
-- Item: spCreateDealProduct
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR DealProduct
------------------------------------------------------------
IF OBJECT_ID('[sample_crm].[spCreateDealProduct]', 'P') IS NOT NULL
    DROP PROCEDURE [sample_crm].[spCreateDealProduct];
GO

CREATE PROCEDURE [sample_crm].[spCreateDealProduct]
    @ID uniqueidentifier = NULL,
    @DealID uniqueidentifier,
    @ProductID uniqueidentifier,
    @Quantity int = NULL,
    @UnitPrice decimal(18, 2),
    @Discount decimal(5, 2) = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [sample_crm].[DealProduct]
            (
                [ID],
                [DealID],
                [ProductID],
                [Quantity],
                [UnitPrice],
                [Discount]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @DealID,
                @ProductID,
                ISNULL(@Quantity, 1),
                @UnitPrice,
                ISNULL(@Discount, 0)
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [sample_crm].[DealProduct]
            (
                [DealID],
                [ProductID],
                [Quantity],
                [UnitPrice],
                [Discount]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @DealID,
                @ProductID,
                ISNULL(@Quantity, 1),
                @UnitPrice,
                ISNULL(@Discount, 0)
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [sample_crm].[vwDealProducts] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [sample_crm].[spCreateDealProduct] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for Deal Products */

GRANT EXECUTE ON [sample_crm].[spCreateDealProduct] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for Deal Products */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Deal Products
-- Item: spUpdateDealProduct
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR DealProduct
------------------------------------------------------------
IF OBJECT_ID('[sample_crm].[spUpdateDealProduct]', 'P') IS NOT NULL
    DROP PROCEDURE [sample_crm].[spUpdateDealProduct];
GO

CREATE PROCEDURE [sample_crm].[spUpdateDealProduct]
    @ID uniqueidentifier,
    @DealID uniqueidentifier,
    @ProductID uniqueidentifier,
    @Quantity int,
    @UnitPrice decimal(18, 2),
    @Discount decimal(5, 2)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [sample_crm].[DealProduct]
    SET
        [DealID] = @DealID,
        [ProductID] = @ProductID,
        [Quantity] = @Quantity,
        [UnitPrice] = @UnitPrice,
        [Discount] = @Discount
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [sample_crm].[vwDealProducts] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [sample_crm].[vwDealProducts]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [sample_crm].[spUpdateDealProduct] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the DealProduct table
------------------------------------------------------------
IF OBJECT_ID('[sample_crm].[trgUpdateDealProduct]', 'TR') IS NOT NULL
    DROP TRIGGER [sample_crm].[trgUpdateDealProduct];
GO
CREATE TRIGGER [sample_crm].trgUpdateDealProduct
ON [sample_crm].[DealProduct]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [sample_crm].[DealProduct]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [sample_crm].[DealProduct] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for Deal Products */

GRANT EXECUTE ON [sample_crm].[spUpdateDealProduct] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for Deal Products */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Deal Products
-- Item: spDeleteDealProduct
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR DealProduct
------------------------------------------------------------
IF OBJECT_ID('[sample_crm].[spDeleteDealProduct]', 'P') IS NOT NULL
    DROP PROCEDURE [sample_crm].[spDeleteDealProduct];
GO

CREATE PROCEDURE [sample_crm].[spDeleteDealProduct]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [sample_crm].[DealProduct]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [sample_crm].[spDeleteDealProduct] TO [cdp_Integration]
    

/* spDelete Permissions for Deal Products */

GRANT EXECUTE ON [sample_crm].[spDeleteDealProduct] TO [cdp_Integration]



/* SQL text to update entity field related entity name field map for entity field ID A83CBC9C-92D6-41AE-92DB-E157BF17B421 */
EXEC [${flyway:defaultSchema}].spUpdateEntityFieldRelatedEntityNameFieldMap
         @EntityFieldID='A83CBC9C-92D6-41AE-92DB-E157BF17B421',
         @RelatedEntityNameFieldMap='CreatedByUser'

/* Base View SQL for Deal Tags */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Deal Tags
-- Item: vwDealTags
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      Deal Tags
-----               SCHEMA:      sample_crm
-----               BASE TABLE:  DealTag
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[sample_crm].[vwDealTags]', 'V') IS NOT NULL
    DROP VIEW [sample_crm].[vwDealTags];
GO

CREATE VIEW [sample_crm].[vwDealTags]
AS
SELECT
    d.*,
    Deals_DealID.[Name] AS [Deal],
    Tags_TagID.[Name] AS [Tag]
FROM
    [sample_crm].[DealTag] AS d
INNER JOIN
    [sample_crm].[Deal] AS Deals_DealID
  ON
    [d].[DealID] = Deals_DealID.[ID]
INNER JOIN
    [sample_crm].[Tag] AS Tags_TagID
  ON
    [d].[TagID] = Tags_TagID.[ID]
GO
GRANT SELECT ON [sample_crm].[vwDealTags] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for Deal Tags */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Deal Tags
-- Item: Permissions for vwDealTags
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [sample_crm].[vwDealTags] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for Deal Tags */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Deal Tags
-- Item: spCreateDealTag
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR DealTag
------------------------------------------------------------
IF OBJECT_ID('[sample_crm].[spCreateDealTag]', 'P') IS NOT NULL
    DROP PROCEDURE [sample_crm].[spCreateDealTag];
GO

CREATE PROCEDURE [sample_crm].[spCreateDealTag]
    @ID uniqueidentifier = NULL,
    @DealID uniqueidentifier,
    @TagID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [sample_crm].[DealTag]
            (
                [ID],
                [DealID],
                [TagID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @DealID,
                @TagID
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [sample_crm].[DealTag]
            (
                [DealID],
                [TagID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @DealID,
                @TagID
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [sample_crm].[vwDealTags] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [sample_crm].[spCreateDealTag] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for Deal Tags */

GRANT EXECUTE ON [sample_crm].[spCreateDealTag] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for Deal Tags */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Deal Tags
-- Item: spUpdateDealTag
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR DealTag
------------------------------------------------------------
IF OBJECT_ID('[sample_crm].[spUpdateDealTag]', 'P') IS NOT NULL
    DROP PROCEDURE [sample_crm].[spUpdateDealTag];
GO

CREATE PROCEDURE [sample_crm].[spUpdateDealTag]
    @ID uniqueidentifier,
    @DealID uniqueidentifier,
    @TagID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [sample_crm].[DealTag]
    SET
        [DealID] = @DealID,
        [TagID] = @TagID
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [sample_crm].[vwDealTags] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [sample_crm].[vwDealTags]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [sample_crm].[spUpdateDealTag] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the DealTag table
------------------------------------------------------------
IF OBJECT_ID('[sample_crm].[trgUpdateDealTag]', 'TR') IS NOT NULL
    DROP TRIGGER [sample_crm].[trgUpdateDealTag];
GO
CREATE TRIGGER [sample_crm].trgUpdateDealTag
ON [sample_crm].[DealTag]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [sample_crm].[DealTag]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [sample_crm].[DealTag] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for Deal Tags */

GRANT EXECUTE ON [sample_crm].[spUpdateDealTag] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for Deal Tags */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Deal Tags
-- Item: spDeleteDealTag
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR DealTag
------------------------------------------------------------
IF OBJECT_ID('[sample_crm].[spDeleteDealTag]', 'P') IS NOT NULL
    DROP PROCEDURE [sample_crm].[spDeleteDealTag];
GO

CREATE PROCEDURE [sample_crm].[spDeleteDealTag]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [sample_crm].[DealTag]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [sample_crm].[spDeleteDealTag] TO [cdp_Integration]
    

/* spDelete Permissions for Deal Tags */

GRANT EXECUTE ON [sample_crm].[spDeleteDealTag] TO [cdp_Integration]



/* Base View SQL for Deals */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Deals
-- Item: vwDeals
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      Deals
-----               SCHEMA:      sample_crm
-----               BASE TABLE:  Deal
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[sample_crm].[vwDeals]', 'V') IS NOT NULL
    DROP VIEW [sample_crm].[vwDeals];
GO

CREATE VIEW [sample_crm].[vwDeals]
AS
SELECT
    d.*,
    Companies_CompanyID.[Name] AS [Company],
    MJUsers_AssignedToUserID.[Name] AS [AssignedToUser],
    MJUsers_CreatedByUserID.[Name] AS [CreatedByUser]
FROM
    [sample_crm].[Deal] AS d
INNER JOIN
    [sample_crm].[Company] AS Companies_CompanyID
  ON
    [d].[CompanyID] = Companies_CompanyID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_AssignedToUserID
  ON
    [d].[AssignedToUserID] = MJUsers_AssignedToUserID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_CreatedByUserID
  ON
    [d].[CreatedByUserID] = MJUsers_CreatedByUserID.[ID]
GO
GRANT SELECT ON [sample_crm].[vwDeals] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for Deals */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Deals
-- Item: Permissions for vwDeals
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [sample_crm].[vwDeals] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for Deals */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Deals
-- Item: spCreateDeal
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR Deal
------------------------------------------------------------
IF OBJECT_ID('[sample_crm].[spCreateDeal]', 'P') IS NOT NULL
    DROP PROCEDURE [sample_crm].[spCreateDeal];
GO

CREATE PROCEDURE [sample_crm].[spCreateDeal]
    @ID uniqueidentifier = NULL,
    @CompanyID uniqueidentifier,
    @ContactID uniqueidentifier,
    @Name nvarchar(200),
    @Amount decimal(18, 2),
    @Stage nvarchar(50),
    @Probability int,
    @ExpectedCloseDate datetime,
    @ActualCloseDate datetime,
    @AssignedToUserID uniqueidentifier,
    @Notes nvarchar(MAX),
    @CreatedByUserID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [sample_crm].[Deal]
            (
                [ID],
                [CompanyID],
                [ContactID],
                [Name],
                [Amount],
                [Stage],
                [Probability],
                [ExpectedCloseDate],
                [ActualCloseDate],
                [AssignedToUserID],
                [Notes],
                [CreatedByUserID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @CompanyID,
                @ContactID,
                @Name,
                @Amount,
                @Stage,
                @Probability,
                @ExpectedCloseDate,
                @ActualCloseDate,
                @AssignedToUserID,
                @Notes,
                @CreatedByUserID
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [sample_crm].[Deal]
            (
                [CompanyID],
                [ContactID],
                [Name],
                [Amount],
                [Stage],
                [Probability],
                [ExpectedCloseDate],
                [ActualCloseDate],
                [AssignedToUserID],
                [Notes],
                [CreatedByUserID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @CompanyID,
                @ContactID,
                @Name,
                @Amount,
                @Stage,
                @Probability,
                @ExpectedCloseDate,
                @ActualCloseDate,
                @AssignedToUserID,
                @Notes,
                @CreatedByUserID
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [sample_crm].[vwDeals] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [sample_crm].[spCreateDeal] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for Deals */

GRANT EXECUTE ON [sample_crm].[spCreateDeal] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for Deals */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Deals
-- Item: spUpdateDeal
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR Deal
------------------------------------------------------------
IF OBJECT_ID('[sample_crm].[spUpdateDeal]', 'P') IS NOT NULL
    DROP PROCEDURE [sample_crm].[spUpdateDeal];
GO

CREATE PROCEDURE [sample_crm].[spUpdateDeal]
    @ID uniqueidentifier,
    @CompanyID uniqueidentifier,
    @ContactID uniqueidentifier,
    @Name nvarchar(200),
    @Amount decimal(18, 2),
    @Stage nvarchar(50),
    @Probability int,
    @ExpectedCloseDate datetime,
    @ActualCloseDate datetime,
    @AssignedToUserID uniqueidentifier,
    @Notes nvarchar(MAX),
    @CreatedByUserID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [sample_crm].[Deal]
    SET
        [CompanyID] = @CompanyID,
        [ContactID] = @ContactID,
        [Name] = @Name,
        [Amount] = @Amount,
        [Stage] = @Stage,
        [Probability] = @Probability,
        [ExpectedCloseDate] = @ExpectedCloseDate,
        [ActualCloseDate] = @ActualCloseDate,
        [AssignedToUserID] = @AssignedToUserID,
        [Notes] = @Notes,
        [CreatedByUserID] = @CreatedByUserID
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [sample_crm].[vwDeals] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [sample_crm].[vwDeals]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [sample_crm].[spUpdateDeal] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the Deal table
------------------------------------------------------------
IF OBJECT_ID('[sample_crm].[trgUpdateDeal]', 'TR') IS NOT NULL
    DROP TRIGGER [sample_crm].[trgUpdateDeal];
GO
CREATE TRIGGER [sample_crm].trgUpdateDeal
ON [sample_crm].[Deal]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [sample_crm].[Deal]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [sample_crm].[Deal] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for Deals */

GRANT EXECUTE ON [sample_crm].[spUpdateDeal] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for Deals */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Deals
-- Item: spDeleteDeal
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR Deal
------------------------------------------------------------
IF OBJECT_ID('[sample_crm].[spDeleteDeal]', 'P') IS NOT NULL
    DROP PROCEDURE [sample_crm].[spDeleteDeal];
GO

CREATE PROCEDURE [sample_crm].[spDeleteDeal]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [sample_crm].[Deal]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [sample_crm].[spDeleteDeal] TO [cdp_Integration]
    

/* spDelete Permissions for Deals */

GRANT EXECUTE ON [sample_crm].[spDeleteDeal] TO [cdp_Integration]



/* Base View SQL for MJ: Action Categories */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Action Categories
-- Item: vwActionCategories
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Action Categories
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  ActionCategory
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwActionCategories]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwActionCategories];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwActionCategories]
AS
SELECT
    m.*,
    MJActionCategories_ParentID.[Name] AS [Parent],
    root_ParentID.RootID AS [RootParentID]
FROM
    [${flyway:defaultSchema}].[ActionCategory] AS m
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[ActionCategory] AS MJActionCategories_ParentID
  ON
    [m].[ParentID] = MJActionCategories_ParentID.[ID]
OUTER APPLY
    [${flyway:defaultSchema}].[fnActionCategoryParentID_GetRootID]([m].[ID], [m].[ParentID]) AS root_ParentID
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwActionCategories] TO [cdp_UI], [cdp_Integration], [cdp_Developer]
    

/* Base View Permissions SQL for MJ: Action Categories */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Action Categories
-- Item: Permissions for vwActionCategories
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwActionCategories] TO [cdp_UI], [cdp_Integration], [cdp_Developer]

/* spCreate SQL for MJ: Action Categories */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Action Categories
-- Item: spCreateMJActionCategory
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR ActionCategory
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJActionCategory]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJActionCategory];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJActionCategory]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @ParentID uniqueidentifier,
    @Status nvarchar(20) = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[ActionCategory]
            (
                [ID],
                [Name],
                [Description],
                [ParentID],
                [Status]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description,
                @ParentID,
                ISNULL(@Status, 'Pending')
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[ActionCategory]
            (
                [Name],
                [Description],
                [ParentID],
                [Status]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description,
                @ParentID,
                ISNULL(@Status, 'Pending')
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwActionCategories] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJActionCategory] TO [cdp_Integration], [cdp_Developer]
    

/* spCreate Permissions for MJ: Action Categories */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJActionCategory] TO [cdp_Integration], [cdp_Developer]



/* spUpdate SQL for MJ: Action Categories */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Action Categories
-- Item: spUpdateMJActionCategory
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR ActionCategory
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJActionCategory]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJActionCategory];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJActionCategory]
    @ID uniqueidentifier,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @ParentID uniqueidentifier,
    @Status nvarchar(20)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ActionCategory]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [ParentID] = @ParentID,
        [Status] = @Status
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwActionCategories] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwActionCategories]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJActionCategory] TO [cdp_Integration], [cdp_Developer]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the ActionCategory table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJActionCategory]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJActionCategory];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJActionCategory
ON [${flyway:defaultSchema}].[ActionCategory]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ActionCategory]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[ActionCategory] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Action Categories */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJActionCategory] TO [cdp_Integration], [cdp_Developer]



/* spDelete SQL for MJ: Action Categories */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Action Categories
-- Item: spDeleteMJActionCategory
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR ActionCategory
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJActionCategory]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJActionCategory];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJActionCategory]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[ActionCategory]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJActionCategory] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Action Categories */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJActionCategory] TO [cdp_Integration]



/* Base View SQL for MJ: Action Context Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Action Context Types
-- Item: vwActionContextTypes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Action Context Types
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  ActionContextType
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwActionContextTypes]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwActionContextTypes];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwActionContextTypes]
AS
SELECT
    m.*
FROM
    [${flyway:defaultSchema}].[ActionContextType] AS m
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwActionContextTypes] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Action Context Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Action Context Types
-- Item: Permissions for vwActionContextTypes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwActionContextTypes] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Action Context Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Action Context Types
-- Item: spCreateMJActionContextType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR ActionContextType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJActionContextType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJActionContextType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJActionContextType]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(255),
    @Description nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[ActionContextType]
            (
                [ID],
                [Name],
                [Description]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[ActionContextType]
            (
                [Name],
                [Description]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwActionContextTypes] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJActionContextType] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Action Context Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJActionContextType] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Action Context Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Action Context Types
-- Item: spUpdateMJActionContextType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR ActionContextType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJActionContextType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJActionContextType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJActionContextType]
    @ID uniqueidentifier,
    @Name nvarchar(255),
    @Description nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ActionContextType]
    SET
        [Name] = @Name,
        [Description] = @Description
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwActionContextTypes] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwActionContextTypes]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJActionContextType] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the ActionContextType table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJActionContextType]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJActionContextType];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJActionContextType
ON [${flyway:defaultSchema}].[ActionContextType]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ActionContextType]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[ActionContextType] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Action Context Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJActionContextType] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Action Context Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Action Context Types
-- Item: spDeleteMJActionContextType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR ActionContextType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJActionContextType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJActionContextType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJActionContextType]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[ActionContextType]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJActionContextType] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Action Context Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJActionContextType] TO [cdp_Integration]



/* Base View SQL for MJ: Action Execution Logs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Action Execution Logs
-- Item: vwActionExecutionLogs
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Action Execution Logs
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  ActionExecutionLog
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwActionExecutionLogs]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwActionExecutionLogs];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwActionExecutionLogs]
AS
SELECT
    m.*,
    MJActions_ActionID.[Name] AS [Action],
    MJUsers_UserID.[Name] AS [User]
FROM
    [${flyway:defaultSchema}].[ActionExecutionLog] AS m
INNER JOIN
    [${flyway:defaultSchema}].[Action] AS MJActions_ActionID
  ON
    [m].[ActionID] = MJActions_ActionID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_UserID
  ON
    [m].[UserID] = MJUsers_UserID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwActionExecutionLogs] TO [cdp_UI], [cdp_Integration], [cdp_Developer]
    

/* Base View Permissions SQL for MJ: Action Execution Logs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Action Execution Logs
-- Item: Permissions for vwActionExecutionLogs
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwActionExecutionLogs] TO [cdp_UI], [cdp_Integration], [cdp_Developer]

/* spCreate SQL for MJ: Action Execution Logs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Action Execution Logs
-- Item: spCreateMJActionExecutionLog
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR ActionExecutionLog
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJActionExecutionLog]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJActionExecutionLog];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJActionExecutionLog]
    @ID uniqueidentifier = NULL,
    @ActionID uniqueidentifier,
    @StartedAt datetimeoffset = NULL,
    @EndedAt datetimeoffset,
    @Params nvarchar(MAX),
    @ResultCode nvarchar(255),
    @UserID uniqueidentifier,
    @RetentionPeriod int,
    @Message nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[ActionExecutionLog]
            (
                [ID],
                [ActionID],
                [StartedAt],
                [EndedAt],
                [Params],
                [ResultCode],
                [UserID],
                [RetentionPeriod],
                [Message]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @ActionID,
                ISNULL(@StartedAt, sysdatetimeoffset()),
                @EndedAt,
                @Params,
                @ResultCode,
                @UserID,
                @RetentionPeriod,
                @Message
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[ActionExecutionLog]
            (
                [ActionID],
                [StartedAt],
                [EndedAt],
                [Params],
                [ResultCode],
                [UserID],
                [RetentionPeriod],
                [Message]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ActionID,
                ISNULL(@StartedAt, sysdatetimeoffset()),
                @EndedAt,
                @Params,
                @ResultCode,
                @UserID,
                @RetentionPeriod,
                @Message
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwActionExecutionLogs] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJActionExecutionLog] TO [cdp_Integration], [cdp_Developer]
    

/* spCreate Permissions for MJ: Action Execution Logs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJActionExecutionLog] TO [cdp_Integration], [cdp_Developer]



/* spUpdate SQL for MJ: Action Execution Logs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Action Execution Logs
-- Item: spUpdateMJActionExecutionLog
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR ActionExecutionLog
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJActionExecutionLog]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJActionExecutionLog];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJActionExecutionLog]
    @ID uniqueidentifier,
    @ActionID uniqueidentifier,
    @StartedAt datetimeoffset,
    @EndedAt datetimeoffset,
    @Params nvarchar(MAX),
    @ResultCode nvarchar(255),
    @UserID uniqueidentifier,
    @RetentionPeriod int,
    @Message nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ActionExecutionLog]
    SET
        [ActionID] = @ActionID,
        [StartedAt] = @StartedAt,
        [EndedAt] = @EndedAt,
        [Params] = @Params,
        [ResultCode] = @ResultCode,
        [UserID] = @UserID,
        [RetentionPeriod] = @RetentionPeriod,
        [Message] = @Message
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwActionExecutionLogs] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwActionExecutionLogs]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJActionExecutionLog] TO [cdp_Integration], [cdp_Developer]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the ActionExecutionLog table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJActionExecutionLog]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJActionExecutionLog];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJActionExecutionLog
ON [${flyway:defaultSchema}].[ActionExecutionLog]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ActionExecutionLog]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[ActionExecutionLog] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Action Execution Logs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJActionExecutionLog] TO [cdp_Integration], [cdp_Developer]



/* spDelete SQL for MJ: Action Execution Logs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Action Execution Logs
-- Item: spDeleteMJActionExecutionLog
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR ActionExecutionLog
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJActionExecutionLog]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJActionExecutionLog];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJActionExecutionLog]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[ActionExecutionLog]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJActionExecutionLog] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Action Execution Logs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJActionExecutionLog] TO [cdp_Integration]



/* Base View SQL for MJ: Action Filters */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Action Filters
-- Item: vwActionFilters
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Action Filters
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  ActionFilter
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwActionFilters]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwActionFilters];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwActionFilters]
AS
SELECT
    m.*
FROM
    [${flyway:defaultSchema}].[ActionFilter] AS m
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwActionFilters] TO [cdp_Integration], [cdp_Developer], [cdp_UI]
    

/* Base View Permissions SQL for MJ: Action Filters */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Action Filters
-- Item: Permissions for vwActionFilters
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwActionFilters] TO [cdp_Integration], [cdp_Developer], [cdp_UI]

/* spCreate SQL for MJ: Action Filters */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Action Filters
-- Item: spCreateMJActionFilter
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR ActionFilter
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJActionFilter]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJActionFilter];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJActionFilter]
    @ID uniqueidentifier = NULL,
    @UserDescription nvarchar(MAX),
    @UserComments nvarchar(MAX),
    @Code nvarchar(MAX),
    @CodeExplanation nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[ActionFilter]
            (
                [ID],
                [UserDescription],
                [UserComments],
                [Code],
                [CodeExplanation]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @UserDescription,
                @UserComments,
                @Code,
                @CodeExplanation
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[ActionFilter]
            (
                [UserDescription],
                [UserComments],
                [Code],
                [CodeExplanation]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @UserDescription,
                @UserComments,
                @Code,
                @CodeExplanation
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwActionFilters] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJActionFilter] TO [cdp_Integration], [cdp_Developer]
    

/* spCreate Permissions for MJ: Action Filters */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJActionFilter] TO [cdp_Integration], [cdp_Developer]



/* spUpdate SQL for MJ: Action Filters */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Action Filters
-- Item: spUpdateMJActionFilter
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR ActionFilter
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJActionFilter]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJActionFilter];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJActionFilter]
    @ID uniqueidentifier,
    @UserDescription nvarchar(MAX),
    @UserComments nvarchar(MAX),
    @Code nvarchar(MAX),
    @CodeExplanation nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ActionFilter]
    SET
        [UserDescription] = @UserDescription,
        [UserComments] = @UserComments,
        [Code] = @Code,
        [CodeExplanation] = @CodeExplanation
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwActionFilters] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwActionFilters]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJActionFilter] TO [cdp_Integration], [cdp_Developer]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the ActionFilter table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJActionFilter]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJActionFilter];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJActionFilter
ON [${flyway:defaultSchema}].[ActionFilter]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ActionFilter]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[ActionFilter] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Action Filters */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJActionFilter] TO [cdp_Integration], [cdp_Developer]



/* spDelete SQL for MJ: Action Filters */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Action Filters
-- Item: spDeleteMJActionFilter
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR ActionFilter
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJActionFilter]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJActionFilter];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJActionFilter]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[ActionFilter]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJActionFilter] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Action Filters */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJActionFilter] TO [cdp_Integration]



/* Base View SQL for MJ: Action Contexts */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Action Contexts
-- Item: vwActionContexts
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Action Contexts
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  ActionContext
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwActionContexts]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwActionContexts];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwActionContexts]
AS
SELECT
    m.*,
    MJActions_ActionID.[Name] AS [Action],
    MJActionContextTypes_ContextTypeID.[Name] AS [ContextType]
FROM
    [${flyway:defaultSchema}].[ActionContext] AS m
INNER JOIN
    [${flyway:defaultSchema}].[Action] AS MJActions_ActionID
  ON
    [m].[ActionID] = MJActions_ActionID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[ActionContextType] AS MJActionContextTypes_ContextTypeID
  ON
    [m].[ContextTypeID] = MJActionContextTypes_ContextTypeID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwActionContexts] TO [cdp_Integration], [cdp_UI], [cdp_Developer]
    

/* Base View Permissions SQL for MJ: Action Contexts */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Action Contexts
-- Item: Permissions for vwActionContexts
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwActionContexts] TO [cdp_Integration], [cdp_UI], [cdp_Developer]

/* spCreate SQL for MJ: Action Contexts */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Action Contexts
-- Item: spCreateMJActionContext
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR ActionContext
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJActionContext]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJActionContext];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJActionContext]
    @ID uniqueidentifier = NULL,
    @ActionID uniqueidentifier,
    @ContextTypeID uniqueidentifier,
    @Status nvarchar(20) = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[ActionContext]
            (
                [ID],
                [ActionID],
                [ContextTypeID],
                [Status]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @ActionID,
                @ContextTypeID,
                ISNULL(@Status, 'Pending')
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[ActionContext]
            (
                [ActionID],
                [ContextTypeID],
                [Status]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ActionID,
                @ContextTypeID,
                ISNULL(@Status, 'Pending')
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwActionContexts] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJActionContext] TO [cdp_Integration], [cdp_Developer]
    

/* spCreate Permissions for MJ: Action Contexts */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJActionContext] TO [cdp_Integration], [cdp_Developer]



/* spUpdate SQL for MJ: Action Contexts */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Action Contexts
-- Item: spUpdateMJActionContext
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR ActionContext
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJActionContext]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJActionContext];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJActionContext]
    @ID uniqueidentifier,
    @ActionID uniqueidentifier,
    @ContextTypeID uniqueidentifier,
    @Status nvarchar(20)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ActionContext]
    SET
        [ActionID] = @ActionID,
        [ContextTypeID] = @ContextTypeID,
        [Status] = @Status
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwActionContexts] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwActionContexts]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJActionContext] TO [cdp_Integration], [cdp_Developer]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the ActionContext table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJActionContext]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJActionContext];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJActionContext
ON [${flyway:defaultSchema}].[ActionContext]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ActionContext]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[ActionContext] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Action Contexts */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJActionContext] TO [cdp_Integration], [cdp_Developer]



/* spDelete SQL for MJ: Action Contexts */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Action Contexts
-- Item: spDeleteMJActionContext
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR ActionContext
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJActionContext]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJActionContext];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJActionContext]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[ActionContext]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJActionContext] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Action Contexts */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJActionContext] TO [cdp_Integration]



/* Base View SQL for MJ: Actions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Actions
-- Item: vwActions
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Actions
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  Action
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwActions]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwActions];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwActions]
AS
SELECT
    m.*,
    MJActionCategories_CategoryID.[Name] AS [Category],
    MJUsers_CodeApprovedByUserID.[Name] AS [CodeApprovedByUser],
    MJActions_ParentID.[Name] AS [Parent],
    MJAIPrompts_DefaultCompactPromptID.[Name] AS [DefaultCompactPrompt],
    root_ParentID.RootID AS [RootParentID]
FROM
    [${flyway:defaultSchema}].[Action] AS m
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[ActionCategory] AS MJActionCategories_CategoryID
  ON
    [m].[CategoryID] = MJActionCategories_CategoryID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_CodeApprovedByUserID
  ON
    [m].[CodeApprovedByUserID] = MJUsers_CodeApprovedByUserID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[Action] AS MJActions_ParentID
  ON
    [m].[ParentID] = MJActions_ParentID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[AIPrompt] AS MJAIPrompts_DefaultCompactPromptID
  ON
    [m].[DefaultCompactPromptID] = MJAIPrompts_DefaultCompactPromptID.[ID]
OUTER APPLY
    [${flyway:defaultSchema}].[fnActionParentID_GetRootID]([m].[ID], [m].[ParentID]) AS root_ParentID
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwActions] TO [cdp_UI], [cdp_Integration], [cdp_Developer]
    

/* Base View Permissions SQL for MJ: Actions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Actions
-- Item: Permissions for vwActions
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwActions] TO [cdp_UI], [cdp_Integration], [cdp_Developer]

/* spCreate SQL for MJ: Actions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Actions
-- Item: spCreateMJAction
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR Action
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJAction]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJAction];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJAction]
    @ID uniqueidentifier = NULL,
    @CategoryID uniqueidentifier,
    @Name nvarchar(425),
    @Description nvarchar(MAX),
    @Type nvarchar(20) = NULL,
    @UserPrompt nvarchar(MAX),
    @UserComments nvarchar(MAX),
    @Code nvarchar(MAX),
    @CodeComments nvarchar(MAX),
    @CodeApprovalStatus nvarchar(20) = NULL,
    @CodeApprovalComments nvarchar(MAX),
    @CodeApprovedByUserID uniqueidentifier,
    @CodeApprovedAt datetimeoffset,
    @CodeLocked bit = NULL,
    @ForceCodeGeneration bit = NULL,
    @RetentionPeriod int,
    @Status nvarchar(20) = NULL,
    @DriverClass nvarchar(255),
    @ParentID uniqueidentifier,
    @IconClass nvarchar(100),
    @DefaultCompactPromptID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[Action]
            (
                [ID],
                [CategoryID],
                [Name],
                [Description],
                [Type],
                [UserPrompt],
                [UserComments],
                [Code],
                [CodeComments],
                [CodeApprovalStatus],
                [CodeApprovalComments],
                [CodeApprovedByUserID],
                [CodeApprovedAt],
                [CodeLocked],
                [ForceCodeGeneration],
                [RetentionPeriod],
                [Status],
                [DriverClass],
                [ParentID],
                [IconClass],
                [DefaultCompactPromptID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @CategoryID,
                @Name,
                @Description,
                ISNULL(@Type, 'Generated'),
                @UserPrompt,
                @UserComments,
                @Code,
                @CodeComments,
                ISNULL(@CodeApprovalStatus, 'Pending'),
                @CodeApprovalComments,
                @CodeApprovedByUserID,
                @CodeApprovedAt,
                ISNULL(@CodeLocked, 0),
                ISNULL(@ForceCodeGeneration, 0),
                @RetentionPeriod,
                ISNULL(@Status, 'Pending'),
                @DriverClass,
                @ParentID,
                @IconClass,
                @DefaultCompactPromptID
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[Action]
            (
                [CategoryID],
                [Name],
                [Description],
                [Type],
                [UserPrompt],
                [UserComments],
                [Code],
                [CodeComments],
                [CodeApprovalStatus],
                [CodeApprovalComments],
                [CodeApprovedByUserID],
                [CodeApprovedAt],
                [CodeLocked],
                [ForceCodeGeneration],
                [RetentionPeriod],
                [Status],
                [DriverClass],
                [ParentID],
                [IconClass],
                [DefaultCompactPromptID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @CategoryID,
                @Name,
                @Description,
                ISNULL(@Type, 'Generated'),
                @UserPrompt,
                @UserComments,
                @Code,
                @CodeComments,
                ISNULL(@CodeApprovalStatus, 'Pending'),
                @CodeApprovalComments,
                @CodeApprovedByUserID,
                @CodeApprovedAt,
                ISNULL(@CodeLocked, 0),
                ISNULL(@ForceCodeGeneration, 0),
                @RetentionPeriod,
                ISNULL(@Status, 'Pending'),
                @DriverClass,
                @ParentID,
                @IconClass,
                @DefaultCompactPromptID
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwActions] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAction] TO [cdp_Integration], [cdp_Developer]
    

/* spCreate Permissions for MJ: Actions */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAction] TO [cdp_Integration], [cdp_Developer]



/* spUpdate SQL for MJ: Actions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Actions
-- Item: spUpdateMJAction
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR Action
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJAction]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAction];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAction]
    @ID uniqueidentifier,
    @CategoryID uniqueidentifier,
    @Name nvarchar(425),
    @Description nvarchar(MAX),
    @Type nvarchar(20),
    @UserPrompt nvarchar(MAX),
    @UserComments nvarchar(MAX),
    @Code nvarchar(MAX),
    @CodeComments nvarchar(MAX),
    @CodeApprovalStatus nvarchar(20),
    @CodeApprovalComments nvarchar(MAX),
    @CodeApprovedByUserID uniqueidentifier,
    @CodeApprovedAt datetimeoffset,
    @CodeLocked bit,
    @ForceCodeGeneration bit,
    @RetentionPeriod int,
    @Status nvarchar(20),
    @DriverClass nvarchar(255),
    @ParentID uniqueidentifier,
    @IconClass nvarchar(100),
    @DefaultCompactPromptID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[Action]
    SET
        [CategoryID] = @CategoryID,
        [Name] = @Name,
        [Description] = @Description,
        [Type] = @Type,
        [UserPrompt] = @UserPrompt,
        [UserComments] = @UserComments,
        [Code] = @Code,
        [CodeComments] = @CodeComments,
        [CodeApprovalStatus] = @CodeApprovalStatus,
        [CodeApprovalComments] = @CodeApprovalComments,
        [CodeApprovedByUserID] = @CodeApprovedByUserID,
        [CodeApprovedAt] = @CodeApprovedAt,
        [CodeLocked] = @CodeLocked,
        [ForceCodeGeneration] = @ForceCodeGeneration,
        [RetentionPeriod] = @RetentionPeriod,
        [Status] = @Status,
        [DriverClass] = @DriverClass,
        [ParentID] = @ParentID,
        [IconClass] = @IconClass,
        [DefaultCompactPromptID] = @DefaultCompactPromptID
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwActions] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwActions]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAction] TO [cdp_Integration], [cdp_Developer]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the Action table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJAction]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJAction];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJAction
ON [${flyway:defaultSchema}].[Action]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[Action]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[Action] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Actions */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAction] TO [cdp_Integration], [cdp_Developer]



/* Base View SQL for MJ: AI Actions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Actions
-- Item: vwAIActions
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: AI Actions
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  AIAction
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwAIActions]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwAIActions];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwAIActions]
AS
SELECT
    m.*,
    MJAIModels_DefaultModelID.[Name] AS [DefaultModel]
FROM
    [${flyway:defaultSchema}].[AIAction] AS m
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[AIModel] AS MJAIModels_DefaultModelID
  ON
    [m].[DefaultModelID] = MJAIModels_DefaultModelID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwAIActions] TO [cdp_Developer], [cdp_Integration], [cdp_UI]
    

/* Base View Permissions SQL for MJ: AI Actions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Actions
-- Item: Permissions for vwAIActions
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwAIActions] TO [cdp_Developer], [cdp_Integration], [cdp_UI]

/* spCreate SQL for MJ: AI Actions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Actions
-- Item: spCreateMJAIAction
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR AIAction
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJAIAction]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIAction];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIAction]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(50),
    @Description nvarchar(MAX),
    @DefaultPrompt nvarchar(MAX),
    @DefaultModelID uniqueidentifier,
    @IsActive bit = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[AIAction]
            (
                [ID],
                [Name],
                [Description],
                [DefaultPrompt],
                [DefaultModelID],
                [IsActive]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description,
                @DefaultPrompt,
                @DefaultModelID,
                ISNULL(@IsActive, 1)
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[AIAction]
            (
                [Name],
                [Description],
                [DefaultPrompt],
                [DefaultModelID],
                [IsActive]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description,
                @DefaultPrompt,
                @DefaultModelID,
                ISNULL(@IsActive, 1)
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwAIActions] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIAction] TO [cdp_Developer]
    

/* spCreate Permissions for MJ: AI Actions */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIAction] TO [cdp_Developer]



/* spUpdate SQL for MJ: AI Actions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Actions
-- Item: spUpdateMJAIAction
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR AIAction
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJAIAction]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIAction];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIAction]
    @ID uniqueidentifier,
    @Name nvarchar(50),
    @Description nvarchar(MAX),
    @DefaultPrompt nvarchar(MAX),
    @DefaultModelID uniqueidentifier,
    @IsActive bit
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIAction]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [DefaultPrompt] = @DefaultPrompt,
        [DefaultModelID] = @DefaultModelID,
        [IsActive] = @IsActive
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwAIActions] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwAIActions]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIAction] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the AIAction table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJAIAction]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJAIAction];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJAIAction
ON [${flyway:defaultSchema}].[AIAction]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIAction]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[AIAction] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: AI Actions */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIAction] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: AI Actions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Actions
-- Item: spDeleteMJAIAction
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR AIAction
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJAIAction]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIAction];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIAction]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[AIAction]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIAction] TO [cdp_Developer]
    

/* spDelete Permissions for MJ: AI Actions */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIAction] TO [cdp_Developer]



/* Base View SQL for MJ: Action Libraries */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Action Libraries
-- Item: vwActionLibraries
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Action Libraries
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  ActionLibrary
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwActionLibraries]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwActionLibraries];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwActionLibraries]
AS
SELECT
    m.*,
    MJActions_ActionID.[Name] AS [Action],
    MJLibraries_LibraryID.[Name] AS [Library]
FROM
    [${flyway:defaultSchema}].[ActionLibrary] AS m
INNER JOIN
    [${flyway:defaultSchema}].[Action] AS MJActions_ActionID
  ON
    [m].[ActionID] = MJActions_ActionID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[Library] AS MJLibraries_LibraryID
  ON
    [m].[LibraryID] = MJLibraries_LibraryID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwActionLibraries] TO [cdp_UI], [cdp_Integration], [cdp_Developer]
    

/* Base View Permissions SQL for MJ: Action Libraries */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Action Libraries
-- Item: Permissions for vwActionLibraries
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwActionLibraries] TO [cdp_UI], [cdp_Integration], [cdp_Developer]

/* spCreate SQL for MJ: Action Libraries */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Action Libraries
-- Item: spCreateMJActionLibrary
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR ActionLibrary
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJActionLibrary]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJActionLibrary];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJActionLibrary]
    @ID uniqueidentifier = NULL,
    @ActionID uniqueidentifier,
    @LibraryID uniqueidentifier,
    @ItemsUsed nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[ActionLibrary]
            (
                [ID],
                [ActionID],
                [LibraryID],
                [ItemsUsed]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @ActionID,
                @LibraryID,
                @ItemsUsed
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[ActionLibrary]
            (
                [ActionID],
                [LibraryID],
                [ItemsUsed]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ActionID,
                @LibraryID,
                @ItemsUsed
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwActionLibraries] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJActionLibrary] TO [cdp_Integration], [cdp_Developer]
    

/* spCreate Permissions for MJ: Action Libraries */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJActionLibrary] TO [cdp_Integration], [cdp_Developer]



/* spUpdate SQL for MJ: Action Libraries */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Action Libraries
-- Item: spUpdateMJActionLibrary
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR ActionLibrary
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJActionLibrary]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJActionLibrary];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJActionLibrary]
    @ID uniqueidentifier,
    @ActionID uniqueidentifier,
    @LibraryID uniqueidentifier,
    @ItemsUsed nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ActionLibrary]
    SET
        [ActionID] = @ActionID,
        [LibraryID] = @LibraryID,
        [ItemsUsed] = @ItemsUsed
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwActionLibraries] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwActionLibraries]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJActionLibrary] TO [cdp_Integration], [cdp_Developer]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the ActionLibrary table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJActionLibrary]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJActionLibrary];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJActionLibrary
ON [${flyway:defaultSchema}].[ActionLibrary]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ActionLibrary]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[ActionLibrary] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Action Libraries */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJActionLibrary] TO [cdp_Integration], [cdp_Developer]



/* spDelete SQL for MJ: Action Libraries */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Action Libraries
-- Item: spDeleteMJActionLibrary
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR ActionLibrary
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJActionLibrary]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJActionLibrary];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJActionLibrary]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[ActionLibrary]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJActionLibrary] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Action Libraries */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJActionLibrary] TO [cdp_Integration]



/* Base View SQL for MJ: Action Result Codes */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Action Result Codes
-- Item: vwActionResultCodes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Action Result Codes
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  ActionResultCode
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwActionResultCodes]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwActionResultCodes];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwActionResultCodes]
AS
SELECT
    m.*,
    MJActions_ActionID.[Name] AS [Action]
FROM
    [${flyway:defaultSchema}].[ActionResultCode] AS m
INNER JOIN
    [${flyway:defaultSchema}].[Action] AS MJActions_ActionID
  ON
    [m].[ActionID] = MJActions_ActionID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwActionResultCodes] TO [cdp_Integration], [cdp_Developer], [cdp_UI]
    

/* Base View Permissions SQL for MJ: Action Result Codes */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Action Result Codes
-- Item: Permissions for vwActionResultCodes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwActionResultCodes] TO [cdp_Integration], [cdp_Developer], [cdp_UI]

/* spCreate SQL for MJ: Action Result Codes */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Action Result Codes
-- Item: spCreateMJActionResultCode
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR ActionResultCode
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJActionResultCode]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJActionResultCode];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJActionResultCode]
    @ID uniqueidentifier = NULL,
    @ActionID uniqueidentifier,
    @ResultCode nvarchar(255),
    @IsSuccess bit = NULL,
    @Description nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[ActionResultCode]
            (
                [ID],
                [ActionID],
                [ResultCode],
                [IsSuccess],
                [Description]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @ActionID,
                @ResultCode,
                ISNULL(@IsSuccess, 0),
                @Description
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[ActionResultCode]
            (
                [ActionID],
                [ResultCode],
                [IsSuccess],
                [Description]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ActionID,
                @ResultCode,
                ISNULL(@IsSuccess, 0),
                @Description
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwActionResultCodes] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJActionResultCode] TO [cdp_Integration], [cdp_Developer]
    

/* spCreate Permissions for MJ: Action Result Codes */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJActionResultCode] TO [cdp_Integration], [cdp_Developer]



/* spUpdate SQL for MJ: Action Result Codes */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Action Result Codes
-- Item: spUpdateMJActionResultCode
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR ActionResultCode
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJActionResultCode]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJActionResultCode];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJActionResultCode]
    @ID uniqueidentifier,
    @ActionID uniqueidentifier,
    @ResultCode nvarchar(255),
    @IsSuccess bit,
    @Description nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ActionResultCode]
    SET
        [ActionID] = @ActionID,
        [ResultCode] = @ResultCode,
        [IsSuccess] = @IsSuccess,
        [Description] = @Description
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwActionResultCodes] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwActionResultCodes]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJActionResultCode] TO [cdp_Integration], [cdp_Developer]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the ActionResultCode table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJActionResultCode]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJActionResultCode];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJActionResultCode
ON [${flyway:defaultSchema}].[ActionResultCode]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ActionResultCode]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[ActionResultCode] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Action Result Codes */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJActionResultCode] TO [cdp_Integration], [cdp_Developer]



/* spDelete SQL for MJ: Action Result Codes */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Action Result Codes
-- Item: spDeleteMJActionResultCode
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR ActionResultCode
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJActionResultCode]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJActionResultCode];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJActionResultCode]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[ActionResultCode]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJActionResultCode] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Action Result Codes */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJActionResultCode] TO [cdp_Integration]



/* Base View SQL for MJ: Action Params */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Action Params
-- Item: vwActionParams
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Action Params
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  ActionParam
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwActionParams]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwActionParams];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwActionParams]
AS
SELECT
    m.*,
    MJActions_ActionID.[Name] AS [Action]
FROM
    [${flyway:defaultSchema}].[ActionParam] AS m
INNER JOIN
    [${flyway:defaultSchema}].[Action] AS MJActions_ActionID
  ON
    [m].[ActionID] = MJActions_ActionID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwActionParams] TO [cdp_Integration], [cdp_UI], [cdp_Developer]
    

/* Base View Permissions SQL for MJ: Action Params */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Action Params
-- Item: Permissions for vwActionParams
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwActionParams] TO [cdp_Integration], [cdp_UI], [cdp_Developer]

/* spCreate SQL for MJ: Action Params */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Action Params
-- Item: spCreateMJActionParam
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR ActionParam
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJActionParam]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJActionParam];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJActionParam]
    @ID uniqueidentifier = NULL,
    @ActionID uniqueidentifier,
    @Name nvarchar(255),
    @DefaultValue nvarchar(MAX),
    @Type nchar(10),
    @ValueType nvarchar(30),
    @IsArray bit = NULL,
    @Description nvarchar(MAX),
    @IsRequired bit = NULL,
    @MediaModality nvarchar(20)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[ActionParam]
            (
                [ID],
                [ActionID],
                [Name],
                [DefaultValue],
                [Type],
                [ValueType],
                [IsArray],
                [Description],
                [IsRequired],
                [MediaModality]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @ActionID,
                @Name,
                @DefaultValue,
                @Type,
                @ValueType,
                ISNULL(@IsArray, 0),
                @Description,
                ISNULL(@IsRequired, 1),
                @MediaModality
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[ActionParam]
            (
                [ActionID],
                [Name],
                [DefaultValue],
                [Type],
                [ValueType],
                [IsArray],
                [Description],
                [IsRequired],
                [MediaModality]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ActionID,
                @Name,
                @DefaultValue,
                @Type,
                @ValueType,
                ISNULL(@IsArray, 0),
                @Description,
                ISNULL(@IsRequired, 1),
                @MediaModality
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwActionParams] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJActionParam] TO [cdp_Integration], [cdp_Developer]
    

/* spCreate Permissions for MJ: Action Params */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJActionParam] TO [cdp_Integration], [cdp_Developer]



/* spUpdate SQL for MJ: Action Params */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Action Params
-- Item: spUpdateMJActionParam
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR ActionParam
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJActionParam]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJActionParam];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJActionParam]
    @ID uniqueidentifier,
    @ActionID uniqueidentifier,
    @Name nvarchar(255),
    @DefaultValue nvarchar(MAX),
    @Type nchar(10),
    @ValueType nvarchar(30),
    @IsArray bit,
    @Description nvarchar(MAX),
    @IsRequired bit,
    @MediaModality nvarchar(20)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ActionParam]
    SET
        [ActionID] = @ActionID,
        [Name] = @Name,
        [DefaultValue] = @DefaultValue,
        [Type] = @Type,
        [ValueType] = @ValueType,
        [IsArray] = @IsArray,
        [Description] = @Description,
        [IsRequired] = @IsRequired,
        [MediaModality] = @MediaModality
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwActionParams] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwActionParams]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJActionParam] TO [cdp_Integration], [cdp_Developer]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the ActionParam table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJActionParam]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJActionParam];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJActionParam
ON [${flyway:defaultSchema}].[ActionParam]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ActionParam]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[ActionParam] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Action Params */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJActionParam] TO [cdp_Integration], [cdp_Developer]



/* spDelete SQL for MJ: Action Params */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Action Params
-- Item: spDeleteMJActionParam
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR ActionParam
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJActionParam]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJActionParam];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJActionParam]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[ActionParam]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJActionParam] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Action Params */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJActionParam] TO [cdp_Integration]



/* spDelete SQL for MJ: Actions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Actions
-- Item: spDeleteMJAction
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR Action
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJAction]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAction];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAction]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    -- Cascade delete from ActionAuthorization using cursor to call spDeleteMJActionAuthorization
    DECLARE @false_ActionIDID uniqueidentifier
    DECLARE cascade_delete_false_ActionID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[ActionAuthorization]
        WHERE [ActionID] = @ID
    
    OPEN cascade_delete_false_ActionID_cursor
    FETCH NEXT FROM cascade_delete_false_ActionID_cursor INTO @false_ActionIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteMJActionAuthorization] @ID = @false_ActionIDID
        
        FETCH NEXT FROM cascade_delete_false_ActionID_cursor INTO @false_ActionIDID
    END
    
    CLOSE cascade_delete_false_ActionID_cursor
    DEALLOCATE cascade_delete_false_ActionID_cursor
    
    -- Cascade delete from ActionContext using cursor to call spDeleteMJActionContext
    DECLARE @false_ActionIDID uniqueidentifier
    DECLARE cascade_delete_false_ActionID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[ActionContext]
        WHERE [ActionID] = @ID
    
    OPEN cascade_delete_false_ActionID_cursor
    FETCH NEXT FROM cascade_delete_false_ActionID_cursor INTO @false_ActionIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteMJActionContext] @ID = @false_ActionIDID
        
        FETCH NEXT FROM cascade_delete_false_ActionID_cursor INTO @false_ActionIDID
    END
    
    CLOSE cascade_delete_false_ActionID_cursor
    DEALLOCATE cascade_delete_false_ActionID_cursor
    
    -- Cascade delete from ActionExecutionLog using cursor to call spDeleteMJActionExecutionLog
    DECLARE @false_ActionIDID uniqueidentifier
    DECLARE cascade_delete_false_ActionID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[ActionExecutionLog]
        WHERE [ActionID] = @ID
    
    OPEN cascade_delete_false_ActionID_cursor
    FETCH NEXT FROM cascade_delete_false_ActionID_cursor INTO @false_ActionIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteMJActionExecutionLog] @ID = @false_ActionIDID
        
        FETCH NEXT FROM cascade_delete_false_ActionID_cursor INTO @false_ActionIDID
    END
    
    CLOSE cascade_delete_false_ActionID_cursor
    DEALLOCATE cascade_delete_false_ActionID_cursor
    
    -- Cascade delete from ActionLibrary using cursor to call spDeleteMJActionLibrary
    DECLARE @false_ActionIDID uniqueidentifier
    DECLARE cascade_delete_false_ActionID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[ActionLibrary]
        WHERE [ActionID] = @ID
    
    OPEN cascade_delete_false_ActionID_cursor
    FETCH NEXT FROM cascade_delete_false_ActionID_cursor INTO @false_ActionIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteMJActionLibrary] @ID = @false_ActionIDID
        
        FETCH NEXT FROM cascade_delete_false_ActionID_cursor INTO @false_ActionIDID
    END
    
    CLOSE cascade_delete_false_ActionID_cursor
    DEALLOCATE cascade_delete_false_ActionID_cursor
    
    -- Cascade delete from ActionParam using cursor to call spDeleteMJActionParam
    DECLARE @false_ActionIDID uniqueidentifier
    DECLARE cascade_delete_false_ActionID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[ActionParam]
        WHERE [ActionID] = @ID
    
    OPEN cascade_delete_false_ActionID_cursor
    FETCH NEXT FROM cascade_delete_false_ActionID_cursor INTO @false_ActionIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteMJActionParam] @ID = @false_ActionIDID
        
        FETCH NEXT FROM cascade_delete_false_ActionID_cursor INTO @false_ActionIDID
    END
    
    CLOSE cascade_delete_false_ActionID_cursor
    DEALLOCATE cascade_delete_false_ActionID_cursor
    
    -- Cascade delete from ActionResultCode using cursor to call spDeleteMJActionResultCode
    DECLARE @false_ActionIDID uniqueidentifier
    DECLARE cascade_delete_false_ActionID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[ActionResultCode]
        WHERE [ActionID] = @ID
    
    OPEN cascade_delete_false_ActionID_cursor
    FETCH NEXT FROM cascade_delete_false_ActionID_cursor INTO @false_ActionIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteMJActionResultCode] @ID = @false_ActionIDID
        
        FETCH NEXT FROM cascade_delete_false_ActionID_cursor INTO @false_ActionIDID
    END
    
    CLOSE cascade_delete_false_ActionID_cursor
    DEALLOCATE cascade_delete_false_ActionID_cursor
    
    -- Cascade delete from Action using cursor to call spDeleteMJAction
    DECLARE @false_ParentIDID uniqueidentifier
    DECLARE cascade_delete_false_ParentID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[Action]
        WHERE [ParentID] = @ID
    
    OPEN cascade_delete_false_ParentID_cursor
    FETCH NEXT FROM cascade_delete_false_ParentID_cursor INTO @false_ParentIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteMJAction] @ID = @false_ParentIDID
        
        FETCH NEXT FROM cascade_delete_false_ParentID_cursor INTO @false_ParentIDID
    END
    
    CLOSE cascade_delete_false_ParentID_cursor
    DEALLOCATE cascade_delete_false_ParentID_cursor
    
    -- Cascade update on AIAgentAction using cursor to call spUpdateMJAIAgentAction
    DECLARE @false_ActionIDID uniqueidentifier
    DECLARE @false_ActionID_AgentID uniqueidentifier
    DECLARE @false_ActionID_ActionID uniqueidentifier
    DECLARE @false_ActionID_Status nvarchar(15)
    DECLARE @false_ActionID_MinExecutionsPerRun int
    DECLARE @false_ActionID_MaxExecutionsPerRun int
    DECLARE @false_ActionID_ResultExpirationTurns int
    DECLARE @false_ActionID_ResultExpirationMode nvarchar(20)
    DECLARE @false_ActionID_CompactMode nvarchar(20)
    DECLARE @false_ActionID_CompactLength int
    DECLARE @false_ActionID_CompactPromptID uniqueidentifier
    DECLARE cascade_update_false_ActionID_cursor CURSOR FOR
        SELECT [ID], [AgentID], [ActionID], [Status], [MinExecutionsPerRun], [MaxExecutionsPerRun], [ResultExpirationTurns], [ResultExpirationMode], [CompactMode], [CompactLength], [CompactPromptID]
        FROM [${flyway:defaultSchema}].[AIAgentAction]
        WHERE [ActionID] = @ID

    OPEN cascade_update_false_ActionID_cursor
    FETCH NEXT FROM cascade_update_false_ActionID_cursor INTO @false_ActionIDID, @false_ActionID_AgentID, @false_ActionID_ActionID, @false_ActionID_Status, @false_ActionID_MinExecutionsPerRun, @false_ActionID_MaxExecutionsPerRun, @false_ActionID_ResultExpirationTurns, @false_ActionID_ResultExpirationMode, @false_ActionID_CompactMode, @false_ActionID_CompactLength, @false_ActionID_CompactPromptID

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @false_ActionID_ActionID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateMJAIAgentAction] @ID = @false_ActionIDID, @AgentID = @false_ActionID_AgentID, @ActionID = @false_ActionID_ActionID, @Status = @false_ActionID_Status, @MinExecutionsPerRun = @false_ActionID_MinExecutionsPerRun, @MaxExecutionsPerRun = @false_ActionID_MaxExecutionsPerRun, @ResultExpirationTurns = @false_ActionID_ResultExpirationTurns, @ResultExpirationMode = @false_ActionID_ResultExpirationMode, @CompactMode = @false_ActionID_CompactMode, @CompactLength = @false_ActionID_CompactLength, @CompactPromptID = @false_ActionID_CompactPromptID

        FETCH NEXT FROM cascade_update_false_ActionID_cursor INTO @false_ActionIDID, @false_ActionID_AgentID, @false_ActionID_ActionID, @false_ActionID_Status, @false_ActionID_MinExecutionsPerRun, @false_ActionID_MaxExecutionsPerRun, @false_ActionID_ResultExpirationTurns, @false_ActionID_ResultExpirationMode, @false_ActionID_CompactMode, @false_ActionID_CompactLength, @false_ActionID_CompactPromptID
    END

    CLOSE cascade_update_false_ActionID_cursor
    DEALLOCATE cascade_update_false_ActionID_cursor
    
    -- Cascade update on AIAgentStep using cursor to call spUpdateMJAIAgentStep
    DECLARE @false_ActionIDID uniqueidentifier
    DECLARE @false_ActionID_AgentID uniqueidentifier
    DECLARE @false_ActionID_Name nvarchar(255)
    DECLARE @false_ActionID_Description nvarchar(MAX)
    DECLARE @false_ActionID_StepType nvarchar(20)
    DECLARE @false_ActionID_StartingStep bit
    DECLARE @false_ActionID_TimeoutSeconds int
    DECLARE @false_ActionID_RetryCount int
    DECLARE @false_ActionID_OnErrorBehavior nvarchar(20)
    DECLARE @false_ActionID_ActionID uniqueidentifier
    DECLARE @false_ActionID_SubAgentID uniqueidentifier
    DECLARE @false_ActionID_PromptID uniqueidentifier
    DECLARE @false_ActionID_ActionOutputMapping nvarchar(MAX)
    DECLARE @false_ActionID_PositionX int
    DECLARE @false_ActionID_PositionY int
    DECLARE @false_ActionID_Width int
    DECLARE @false_ActionID_Height int
    DECLARE @false_ActionID_Status nvarchar(20)
    DECLARE @false_ActionID_ActionInputMapping nvarchar(MAX)
    DECLARE @false_ActionID_LoopBodyType nvarchar(50)
    DECLARE @false_ActionID_Configuration nvarchar(MAX)
    DECLARE cascade_update_false_ActionID_cursor CURSOR FOR
        SELECT [ID], [AgentID], [Name], [Description], [StepType], [StartingStep], [TimeoutSeconds], [RetryCount], [OnErrorBehavior], [ActionID], [SubAgentID], [PromptID], [ActionOutputMapping], [PositionX], [PositionY], [Width], [Height], [Status], [ActionInputMapping], [LoopBodyType], [Configuration]
        FROM [${flyway:defaultSchema}].[AIAgentStep]
        WHERE [ActionID] = @ID

    OPEN cascade_update_false_ActionID_cursor
    FETCH NEXT FROM cascade_update_false_ActionID_cursor INTO @false_ActionIDID, @false_ActionID_AgentID, @false_ActionID_Name, @false_ActionID_Description, @false_ActionID_StepType, @false_ActionID_StartingStep, @false_ActionID_TimeoutSeconds, @false_ActionID_RetryCount, @false_ActionID_OnErrorBehavior, @false_ActionID_ActionID, @false_ActionID_SubAgentID, @false_ActionID_PromptID, @false_ActionID_ActionOutputMapping, @false_ActionID_PositionX, @false_ActionID_PositionY, @false_ActionID_Width, @false_ActionID_Height, @false_ActionID_Status, @false_ActionID_ActionInputMapping, @false_ActionID_LoopBodyType, @false_ActionID_Configuration

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @false_ActionID_ActionID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateMJAIAgentStep] @ID = @false_ActionIDID, @AgentID = @false_ActionID_AgentID, @Name = @false_ActionID_Name, @Description = @false_ActionID_Description, @StepType = @false_ActionID_StepType, @StartingStep = @false_ActionID_StartingStep, @TimeoutSeconds = @false_ActionID_TimeoutSeconds, @RetryCount = @false_ActionID_RetryCount, @OnErrorBehavior = @false_ActionID_OnErrorBehavior, @ActionID = @false_ActionID_ActionID, @SubAgentID = @false_ActionID_SubAgentID, @PromptID = @false_ActionID_PromptID, @ActionOutputMapping = @false_ActionID_ActionOutputMapping, @PositionX = @false_ActionID_PositionX, @PositionY = @false_ActionID_PositionY, @Width = @false_ActionID_Width, @Height = @false_ActionID_Height, @Status = @false_ActionID_Status, @ActionInputMapping = @false_ActionID_ActionInputMapping, @LoopBodyType = @false_ActionID_LoopBodyType, @Configuration = @false_ActionID_Configuration

        FETCH NEXT FROM cascade_update_false_ActionID_cursor INTO @false_ActionIDID, @false_ActionID_AgentID, @false_ActionID_Name, @false_ActionID_Description, @false_ActionID_StepType, @false_ActionID_StartingStep, @false_ActionID_TimeoutSeconds, @false_ActionID_RetryCount, @false_ActionID_OnErrorBehavior, @false_ActionID_ActionID, @false_ActionID_SubAgentID, @false_ActionID_PromptID, @false_ActionID_ActionOutputMapping, @false_ActionID_PositionX, @false_ActionID_PositionY, @false_ActionID_Width, @false_ActionID_Height, @false_ActionID_Status, @false_ActionID_ActionInputMapping, @false_ActionID_LoopBodyType, @false_ActionID_Configuration
    END

    CLOSE cascade_update_false_ActionID_cursor
    DEALLOCATE cascade_update_false_ActionID_cursor
    
    -- Cascade delete from EntityAction using cursor to call spDeleteMJEntityAction
    DECLARE @false_ActionIDID uniqueidentifier
    DECLARE cascade_delete_false_ActionID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[EntityAction]
        WHERE [ActionID] = @ID
    
    OPEN cascade_delete_false_ActionID_cursor
    FETCH NEXT FROM cascade_delete_false_ActionID_cursor INTO @false_ActionIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteMJEntityAction] @ID = @false_ActionIDID
        
        FETCH NEXT FROM cascade_delete_false_ActionID_cursor INTO @false_ActionIDID
    END
    
    CLOSE cascade_delete_false_ActionID_cursor
    DEALLOCATE cascade_delete_false_ActionID_cursor
    
    -- Cascade update on MCPServerTool using cursor to call spUpdateMJMCPServerTool
    DECLARE @false_GeneratedActionIDID uniqueidentifier
    DECLARE @false_GeneratedActionID_MCPServerID uniqueidentifier
    DECLARE @false_GeneratedActionID_ToolName nvarchar(255)
    DECLARE @false_GeneratedActionID_ToolTitle nvarchar(255)
    DECLARE @false_GeneratedActionID_ToolDescription nvarchar(MAX)
    DECLARE @false_GeneratedActionID_InputSchema nvarchar(MAX)
    DECLARE @false_GeneratedActionID_OutputSchema nvarchar(MAX)
    DECLARE @false_GeneratedActionID_Annotations nvarchar(MAX)
    DECLARE @false_GeneratedActionID_Status nvarchar(50)
    DECLARE @false_GeneratedActionID_DiscoveredAt datetimeoffset
    DECLARE @false_GeneratedActionID_LastSeenAt datetimeoffset
    DECLARE @false_GeneratedActionID_GeneratedActionID uniqueidentifier
    DECLARE @false_GeneratedActionID_GeneratedActionCategoryID uniqueidentifier
    DECLARE cascade_update_false_GeneratedActionID_cursor CURSOR FOR
        SELECT [ID], [MCPServerID], [ToolName], [ToolTitle], [ToolDescription], [InputSchema], [OutputSchema], [Annotations], [Status], [DiscoveredAt], [LastSeenAt], [GeneratedActionID], [GeneratedActionCategoryID]
        FROM [${flyway:defaultSchema}].[MCPServerTool]
        WHERE [GeneratedActionID] = @ID

    OPEN cascade_update_false_GeneratedActionID_cursor
    FETCH NEXT FROM cascade_update_false_GeneratedActionID_cursor INTO @false_GeneratedActionIDID, @false_GeneratedActionID_MCPServerID, @false_GeneratedActionID_ToolName, @false_GeneratedActionID_ToolTitle, @false_GeneratedActionID_ToolDescription, @false_GeneratedActionID_InputSchema, @false_GeneratedActionID_OutputSchema, @false_GeneratedActionID_Annotations, @false_GeneratedActionID_Status, @false_GeneratedActionID_DiscoveredAt, @false_GeneratedActionID_LastSeenAt, @false_GeneratedActionID_GeneratedActionID, @false_GeneratedActionID_GeneratedActionCategoryID

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @false_GeneratedActionID_GeneratedActionID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateMJMCPServerTool] @ID = @false_GeneratedActionIDID, @MCPServerID = @false_GeneratedActionID_MCPServerID, @ToolName = @false_GeneratedActionID_ToolName, @ToolTitle = @false_GeneratedActionID_ToolTitle, @ToolDescription = @false_GeneratedActionID_ToolDescription, @InputSchema = @false_GeneratedActionID_InputSchema, @OutputSchema = @false_GeneratedActionID_OutputSchema, @Annotations = @false_GeneratedActionID_Annotations, @Status = @false_GeneratedActionID_Status, @DiscoveredAt = @false_GeneratedActionID_DiscoveredAt, @LastSeenAt = @false_GeneratedActionID_LastSeenAt, @GeneratedActionID = @false_GeneratedActionID_GeneratedActionID, @GeneratedActionCategoryID = @false_GeneratedActionID_GeneratedActionCategoryID

        FETCH NEXT FROM cascade_update_false_GeneratedActionID_cursor INTO @false_GeneratedActionIDID, @false_GeneratedActionID_MCPServerID, @false_GeneratedActionID_ToolName, @false_GeneratedActionID_ToolTitle, @false_GeneratedActionID_ToolDescription, @false_GeneratedActionID_InputSchema, @false_GeneratedActionID_OutputSchema, @false_GeneratedActionID_Annotations, @false_GeneratedActionID_Status, @false_GeneratedActionID_DiscoveredAt, @false_GeneratedActionID_LastSeenAt, @false_GeneratedActionID_GeneratedActionID, @false_GeneratedActionID_GeneratedActionCategoryID
    END

    CLOSE cascade_update_false_GeneratedActionID_cursor
    DEALLOCATE cascade_update_false_GeneratedActionID_cursor
    
    -- Cascade delete from ScheduledAction using cursor to call spDeleteMJScheduledAction
    DECLARE @false_ActionIDID uniqueidentifier
    DECLARE cascade_delete_false_ActionID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[ScheduledAction]
        WHERE [ActionID] = @ID
    
    OPEN cascade_delete_false_ActionID_cursor
    FETCH NEXT FROM cascade_delete_false_ActionID_cursor INTO @false_ActionIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteMJScheduledAction] @ID = @false_ActionIDID
        
        FETCH NEXT FROM cascade_delete_false_ActionID_cursor INTO @false_ActionIDID
    END
    
    CLOSE cascade_delete_false_ActionID_cursor
    DEALLOCATE cascade_delete_false_ActionID_cursor
    

    DELETE FROM
        [${flyway:defaultSchema}].[Action]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAction] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Actions */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAction] TO [cdp_Integration]



/* Base View SQL for MJ: AI Agent Artifact Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Artifact Types
-- Item: vwAIAgentArtifactTypes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: AI Agent Artifact Types
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  AIAgentArtifactType
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwAIAgentArtifactTypes]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwAIAgentArtifactTypes];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwAIAgentArtifactTypes]
AS
SELECT
    m.*,
    MJAIAgents_AgentID.[Name] AS [Agent],
    MJArtifactTypes_ArtifactTypeID.[Name] AS [ArtifactType]
FROM
    [${flyway:defaultSchema}].[AIAgentArtifactType] AS m
INNER JOIN
    [${flyway:defaultSchema}].[AIAgent] AS MJAIAgents_AgentID
  ON
    [m].[AgentID] = MJAIAgents_AgentID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[ArtifactType] AS MJArtifactTypes_ArtifactTypeID
  ON
    [m].[ArtifactTypeID] = MJArtifactTypes_ArtifactTypeID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwAIAgentArtifactTypes] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: AI Agent Artifact Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Artifact Types
-- Item: Permissions for vwAIAgentArtifactTypes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwAIAgentArtifactTypes] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: AI Agent Artifact Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Artifact Types
-- Item: spCreateMJAIAgentArtifactType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR AIAgentArtifactType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJAIAgentArtifactType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIAgentArtifactType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIAgentArtifactType]
    @ID uniqueidentifier = NULL,
    @AgentID uniqueidentifier,
    @ArtifactTypeID uniqueidentifier,
    @Sequence int
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[AIAgentArtifactType]
            (
                [ID],
                [AgentID],
                [ArtifactTypeID],
                [Sequence]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @AgentID,
                @ArtifactTypeID,
                @Sequence
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[AIAgentArtifactType]
            (
                [AgentID],
                [ArtifactTypeID],
                [Sequence]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @AgentID,
                @ArtifactTypeID,
                @Sequence
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwAIAgentArtifactTypes] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIAgentArtifactType] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: AI Agent Artifact Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIAgentArtifactType] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: AI Agent Artifact Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Artifact Types
-- Item: spUpdateMJAIAgentArtifactType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR AIAgentArtifactType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJAIAgentArtifactType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIAgentArtifactType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIAgentArtifactType]
    @ID uniqueidentifier,
    @AgentID uniqueidentifier,
    @ArtifactTypeID uniqueidentifier,
    @Sequence int
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIAgentArtifactType]
    SET
        [AgentID] = @AgentID,
        [ArtifactTypeID] = @ArtifactTypeID,
        [Sequence] = @Sequence
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwAIAgentArtifactTypes] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwAIAgentArtifactTypes]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIAgentArtifactType] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the AIAgentArtifactType table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJAIAgentArtifactType]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJAIAgentArtifactType];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJAIAgentArtifactType
ON [${flyway:defaultSchema}].[AIAgentArtifactType]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIAgentArtifactType]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[AIAgentArtifactType] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: AI Agent Artifact Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIAgentArtifactType] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: AI Agent Artifact Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Artifact Types
-- Item: spDeleteMJAIAgentArtifactType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR AIAgentArtifactType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJAIAgentArtifactType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIAgentArtifactType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIAgentArtifactType]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[AIAgentArtifactType]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIAgentArtifactType] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: AI Agent Artifact Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIAgentArtifactType] TO [cdp_Integration]



/* Base View SQL for MJ: AI Agent Actions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Actions
-- Item: vwAIAgentActions
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: AI Agent Actions
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  AIAgentAction
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwAIAgentActions]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwAIAgentActions];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwAIAgentActions]
AS
SELECT
    m.*,
    MJAIAgents_AgentID.[Name] AS [Agent],
    MJActions_ActionID.[Name] AS [Action],
    MJAIPrompts_CompactPromptID.[Name] AS [CompactPrompt]
FROM
    [${flyway:defaultSchema}].[AIAgentAction] AS m
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[AIAgent] AS MJAIAgents_AgentID
  ON
    [m].[AgentID] = MJAIAgents_AgentID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[Action] AS MJActions_ActionID
  ON
    [m].[ActionID] = MJActions_ActionID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[AIPrompt] AS MJAIPrompts_CompactPromptID
  ON
    [m].[CompactPromptID] = MJAIPrompts_CompactPromptID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwAIAgentActions] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: AI Agent Actions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Actions
-- Item: Permissions for vwAIAgentActions
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwAIAgentActions] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: AI Agent Actions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Actions
-- Item: spCreateMJAIAgentAction
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR AIAgentAction
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJAIAgentAction]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIAgentAction];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIAgentAction]
    @ID uniqueidentifier = NULL,
    @AgentID uniqueidentifier,
    @ActionID uniqueidentifier,
    @Status nvarchar(15) = NULL,
    @MinExecutionsPerRun int,
    @MaxExecutionsPerRun int,
    @ResultExpirationTurns int,
    @ResultExpirationMode nvarchar(20) = NULL,
    @CompactMode nvarchar(20),
    @CompactLength int,
    @CompactPromptID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[AIAgentAction]
            (
                [ID],
                [AgentID],
                [ActionID],
                [Status],
                [MinExecutionsPerRun],
                [MaxExecutionsPerRun],
                [ResultExpirationTurns],
                [ResultExpirationMode],
                [CompactMode],
                [CompactLength],
                [CompactPromptID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @AgentID,
                @ActionID,
                ISNULL(@Status, 'Active'),
                @MinExecutionsPerRun,
                @MaxExecutionsPerRun,
                @ResultExpirationTurns,
                ISNULL(@ResultExpirationMode, 'None'),
                @CompactMode,
                @CompactLength,
                @CompactPromptID
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[AIAgentAction]
            (
                [AgentID],
                [ActionID],
                [Status],
                [MinExecutionsPerRun],
                [MaxExecutionsPerRun],
                [ResultExpirationTurns],
                [ResultExpirationMode],
                [CompactMode],
                [CompactLength],
                [CompactPromptID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @AgentID,
                @ActionID,
                ISNULL(@Status, 'Active'),
                @MinExecutionsPerRun,
                @MaxExecutionsPerRun,
                @ResultExpirationTurns,
                ISNULL(@ResultExpirationMode, 'None'),
                @CompactMode,
                @CompactLength,
                @CompactPromptID
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwAIAgentActions] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIAgentAction] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: AI Agent Actions */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIAgentAction] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: AI Agent Actions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Actions
-- Item: spUpdateMJAIAgentAction
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR AIAgentAction
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJAIAgentAction]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIAgentAction];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIAgentAction]
    @ID uniqueidentifier,
    @AgentID uniqueidentifier,
    @ActionID uniqueidentifier,
    @Status nvarchar(15),
    @MinExecutionsPerRun int,
    @MaxExecutionsPerRun int,
    @ResultExpirationTurns int,
    @ResultExpirationMode nvarchar(20),
    @CompactMode nvarchar(20),
    @CompactLength int,
    @CompactPromptID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIAgentAction]
    SET
        [AgentID] = @AgentID,
        [ActionID] = @ActionID,
        [Status] = @Status,
        [MinExecutionsPerRun] = @MinExecutionsPerRun,
        [MaxExecutionsPerRun] = @MaxExecutionsPerRun,
        [ResultExpirationTurns] = @ResultExpirationTurns,
        [ResultExpirationMode] = @ResultExpirationMode,
        [CompactMode] = @CompactMode,
        [CompactLength] = @CompactLength,
        [CompactPromptID] = @CompactPromptID
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwAIAgentActions] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwAIAgentActions]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIAgentAction] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the AIAgentAction table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJAIAgentAction]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJAIAgentAction];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJAIAgentAction
ON [${flyway:defaultSchema}].[AIAgentAction]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIAgentAction]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[AIAgentAction] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: AI Agent Actions */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIAgentAction] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: AI Agent Actions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Actions
-- Item: spDeleteMJAIAgentAction
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR AIAgentAction
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJAIAgentAction]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIAgentAction];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIAgentAction]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[AIAgentAction]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIAgentAction] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: AI Agent Actions */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIAgentAction] TO [cdp_Integration]



/* Base View SQL for MJ: AI Agent Examples */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Examples
-- Item: vwAIAgentExamples
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: AI Agent Examples
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  AIAgentExample
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwAIAgentExamples]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwAIAgentExamples];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwAIAgentExamples]
AS
SELECT
    m.*,
    MJAIAgents_AgentID.[Name] AS [Agent],
    MJUsers_UserID.[Name] AS [User],
    MJCompanies_CompanyID.[Name] AS [Company],
    MJConversations_SourceConversationID.[Name] AS [SourceConversation],
    MJConversationDetails_SourceConversationDetailID.[Message] AS [SourceConversationDetail],
    MJAIAgentRuns_SourceAIAgentRunID.[RunName] AS [SourceAIAgentRun],
    MJAIModels_EmbeddingModelID.[Name] AS [EmbeddingModel],
    MJEntities_PrimaryScopeEntityID.[Name] AS [PrimaryScopeEntity]
FROM
    [${flyway:defaultSchema}].[AIAgentExample] AS m
INNER JOIN
    [${flyway:defaultSchema}].[AIAgent] AS MJAIAgents_AgentID
  ON
    [m].[AgentID] = MJAIAgents_AgentID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_UserID
  ON
    [m].[UserID] = MJUsers_UserID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[Company] AS MJCompanies_CompanyID
  ON
    [m].[CompanyID] = MJCompanies_CompanyID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[Conversation] AS MJConversations_SourceConversationID
  ON
    [m].[SourceConversationID] = MJConversations_SourceConversationID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[ConversationDetail] AS MJConversationDetails_SourceConversationDetailID
  ON
    [m].[SourceConversationDetailID] = MJConversationDetails_SourceConversationDetailID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[AIAgentRun] AS MJAIAgentRuns_SourceAIAgentRunID
  ON
    [m].[SourceAIAgentRunID] = MJAIAgentRuns_SourceAIAgentRunID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[AIModel] AS MJAIModels_EmbeddingModelID
  ON
    [m].[EmbeddingModelID] = MJAIModels_EmbeddingModelID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[Entity] AS MJEntities_PrimaryScopeEntityID
  ON
    [m].[PrimaryScopeEntityID] = MJEntities_PrimaryScopeEntityID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwAIAgentExamples] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: AI Agent Examples */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Examples
-- Item: Permissions for vwAIAgentExamples
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwAIAgentExamples] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: AI Agent Examples */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Examples
-- Item: spCreateMJAIAgentExample
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR AIAgentExample
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJAIAgentExample]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIAgentExample];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIAgentExample]
    @ID uniqueidentifier = NULL,
    @AgentID uniqueidentifier,
    @UserID uniqueidentifier,
    @CompanyID uniqueidentifier,
    @Type nvarchar(20) = NULL,
    @ExampleInput nvarchar(MAX),
    @ExampleOutput nvarchar(MAX),
    @IsAutoGenerated bit = NULL,
    @SourceConversationID uniqueidentifier,
    @SourceConversationDetailID uniqueidentifier,
    @SourceAIAgentRunID uniqueidentifier,
    @SuccessScore decimal(5, 2),
    @Comments nvarchar(MAX),
    @Status nvarchar(20) = NULL,
    @EmbeddingVector nvarchar(MAX),
    @EmbeddingModelID uniqueidentifier,
    @PrimaryScopeEntityID uniqueidentifier,
    @PrimaryScopeRecordID nvarchar(100),
    @SecondaryScopes nvarchar(MAX),
    @LastAccessedAt datetimeoffset,
    @AccessCount int = NULL,
    @ExpiresAt datetimeoffset
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[AIAgentExample]
            (
                [ID],
                [AgentID],
                [UserID],
                [CompanyID],
                [Type],
                [ExampleInput],
                [ExampleOutput],
                [IsAutoGenerated],
                [SourceConversationID],
                [SourceConversationDetailID],
                [SourceAIAgentRunID],
                [SuccessScore],
                [Comments],
                [Status],
                [EmbeddingVector],
                [EmbeddingModelID],
                [PrimaryScopeEntityID],
                [PrimaryScopeRecordID],
                [SecondaryScopes],
                [LastAccessedAt],
                [AccessCount],
                [ExpiresAt]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @AgentID,
                @UserID,
                @CompanyID,
                ISNULL(@Type, 'Example'),
                @ExampleInput,
                @ExampleOutput,
                ISNULL(@IsAutoGenerated, 0),
                @SourceConversationID,
                @SourceConversationDetailID,
                @SourceAIAgentRunID,
                @SuccessScore,
                @Comments,
                ISNULL(@Status, 'Active'),
                @EmbeddingVector,
                @EmbeddingModelID,
                @PrimaryScopeEntityID,
                @PrimaryScopeRecordID,
                @SecondaryScopes,
                @LastAccessedAt,
                ISNULL(@AccessCount, 0),
                @ExpiresAt
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[AIAgentExample]
            (
                [AgentID],
                [UserID],
                [CompanyID],
                [Type],
                [ExampleInput],
                [ExampleOutput],
                [IsAutoGenerated],
                [SourceConversationID],
                [SourceConversationDetailID],
                [SourceAIAgentRunID],
                [SuccessScore],
                [Comments],
                [Status],
                [EmbeddingVector],
                [EmbeddingModelID],
                [PrimaryScopeEntityID],
                [PrimaryScopeRecordID],
                [SecondaryScopes],
                [LastAccessedAt],
                [AccessCount],
                [ExpiresAt]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @AgentID,
                @UserID,
                @CompanyID,
                ISNULL(@Type, 'Example'),
                @ExampleInput,
                @ExampleOutput,
                ISNULL(@IsAutoGenerated, 0),
                @SourceConversationID,
                @SourceConversationDetailID,
                @SourceAIAgentRunID,
                @SuccessScore,
                @Comments,
                ISNULL(@Status, 'Active'),
                @EmbeddingVector,
                @EmbeddingModelID,
                @PrimaryScopeEntityID,
                @PrimaryScopeRecordID,
                @SecondaryScopes,
                @LastAccessedAt,
                ISNULL(@AccessCount, 0),
                @ExpiresAt
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwAIAgentExamples] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIAgentExample] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: AI Agent Examples */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIAgentExample] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: AI Agent Examples */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Examples
-- Item: spUpdateMJAIAgentExample
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR AIAgentExample
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJAIAgentExample]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIAgentExample];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIAgentExample]
    @ID uniqueidentifier,
    @AgentID uniqueidentifier,
    @UserID uniqueidentifier,
    @CompanyID uniqueidentifier,
    @Type nvarchar(20),
    @ExampleInput nvarchar(MAX),
    @ExampleOutput nvarchar(MAX),
    @IsAutoGenerated bit,
    @SourceConversationID uniqueidentifier,
    @SourceConversationDetailID uniqueidentifier,
    @SourceAIAgentRunID uniqueidentifier,
    @SuccessScore decimal(5, 2),
    @Comments nvarchar(MAX),
    @Status nvarchar(20),
    @EmbeddingVector nvarchar(MAX),
    @EmbeddingModelID uniqueidentifier,
    @PrimaryScopeEntityID uniqueidentifier,
    @PrimaryScopeRecordID nvarchar(100),
    @SecondaryScopes nvarchar(MAX),
    @LastAccessedAt datetimeoffset,
    @AccessCount int,
    @ExpiresAt datetimeoffset
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIAgentExample]
    SET
        [AgentID] = @AgentID,
        [UserID] = @UserID,
        [CompanyID] = @CompanyID,
        [Type] = @Type,
        [ExampleInput] = @ExampleInput,
        [ExampleOutput] = @ExampleOutput,
        [IsAutoGenerated] = @IsAutoGenerated,
        [SourceConversationID] = @SourceConversationID,
        [SourceConversationDetailID] = @SourceConversationDetailID,
        [SourceAIAgentRunID] = @SourceAIAgentRunID,
        [SuccessScore] = @SuccessScore,
        [Comments] = @Comments,
        [Status] = @Status,
        [EmbeddingVector] = @EmbeddingVector,
        [EmbeddingModelID] = @EmbeddingModelID,
        [PrimaryScopeEntityID] = @PrimaryScopeEntityID,
        [PrimaryScopeRecordID] = @PrimaryScopeRecordID,
        [SecondaryScopes] = @SecondaryScopes,
        [LastAccessedAt] = @LastAccessedAt,
        [AccessCount] = @AccessCount,
        [ExpiresAt] = @ExpiresAt
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwAIAgentExamples] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwAIAgentExamples]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIAgentExample] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the AIAgentExample table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJAIAgentExample]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJAIAgentExample];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJAIAgentExample
ON [${flyway:defaultSchema}].[AIAgentExample]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIAgentExample]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[AIAgentExample] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: AI Agent Examples */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIAgentExample] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: AI Agent Examples */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Examples
-- Item: spDeleteMJAIAgentExample
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR AIAgentExample
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJAIAgentExample]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIAgentExample];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIAgentExample]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[AIAgentExample]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIAgentExample] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: AI Agent Examples */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIAgentExample] TO [cdp_Integration]



/* Base View SQL for MJ: AI Agent Configurations */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Configurations
-- Item: vwAIAgentConfigurations
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: AI Agent Configurations
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  AIAgentConfiguration
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwAIAgentConfigurations]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwAIAgentConfigurations];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwAIAgentConfigurations]
AS
SELECT
    m.*,
    MJAIAgents_AgentID.[Name] AS [Agent],
    MJAIConfigurations_AIConfigurationID.[Name] AS [AIConfiguration]
FROM
    [${flyway:defaultSchema}].[AIAgentConfiguration] AS m
INNER JOIN
    [${flyway:defaultSchema}].[AIAgent] AS MJAIAgents_AgentID
  ON
    [m].[AgentID] = MJAIAgents_AgentID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[AIConfiguration] AS MJAIConfigurations_AIConfigurationID
  ON
    [m].[AIConfigurationID] = MJAIConfigurations_AIConfigurationID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwAIAgentConfigurations] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: AI Agent Configurations */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Configurations
-- Item: Permissions for vwAIAgentConfigurations
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwAIAgentConfigurations] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: AI Agent Configurations */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Configurations
-- Item: spCreateMJAIAgentConfiguration
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR AIAgentConfiguration
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJAIAgentConfiguration]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIAgentConfiguration];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIAgentConfiguration]
    @ID uniqueidentifier = NULL,
    @AgentID uniqueidentifier,
    @Name nvarchar(100),
    @DisplayName nvarchar(200),
    @Description nvarchar(MAX),
    @AIConfigurationID uniqueidentifier,
    @IsDefault bit = NULL,
    @Priority int = NULL,
    @Status nvarchar(20) = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[AIAgentConfiguration]
            (
                [ID],
                [AgentID],
                [Name],
                [DisplayName],
                [Description],
                [AIConfigurationID],
                [IsDefault],
                [Priority],
                [Status]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @AgentID,
                @Name,
                @DisplayName,
                @Description,
                @AIConfigurationID,
                ISNULL(@IsDefault, 0),
                ISNULL(@Priority, 100),
                ISNULL(@Status, 'Active')
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[AIAgentConfiguration]
            (
                [AgentID],
                [Name],
                [DisplayName],
                [Description],
                [AIConfigurationID],
                [IsDefault],
                [Priority],
                [Status]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @AgentID,
                @Name,
                @DisplayName,
                @Description,
                @AIConfigurationID,
                ISNULL(@IsDefault, 0),
                ISNULL(@Priority, 100),
                ISNULL(@Status, 'Active')
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwAIAgentConfigurations] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIAgentConfiguration] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: AI Agent Configurations */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIAgentConfiguration] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: AI Agent Configurations */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Configurations
-- Item: spUpdateMJAIAgentConfiguration
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR AIAgentConfiguration
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJAIAgentConfiguration]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIAgentConfiguration];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIAgentConfiguration]
    @ID uniqueidentifier,
    @AgentID uniqueidentifier,
    @Name nvarchar(100),
    @DisplayName nvarchar(200),
    @Description nvarchar(MAX),
    @AIConfigurationID uniqueidentifier,
    @IsDefault bit,
    @Priority int,
    @Status nvarchar(20)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIAgentConfiguration]
    SET
        [AgentID] = @AgentID,
        [Name] = @Name,
        [DisplayName] = @DisplayName,
        [Description] = @Description,
        [AIConfigurationID] = @AIConfigurationID,
        [IsDefault] = @IsDefault,
        [Priority] = @Priority,
        [Status] = @Status
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwAIAgentConfigurations] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwAIAgentConfigurations]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIAgentConfiguration] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the AIAgentConfiguration table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJAIAgentConfiguration]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJAIAgentConfiguration];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJAIAgentConfiguration
ON [${flyway:defaultSchema}].[AIAgentConfiguration]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIAgentConfiguration]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[AIAgentConfiguration] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: AI Agent Configurations */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIAgentConfiguration] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: AI Agent Configurations */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Configurations
-- Item: spDeleteMJAIAgentConfiguration
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR AIAgentConfiguration
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJAIAgentConfiguration]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIAgentConfiguration];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIAgentConfiguration]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[AIAgentConfiguration]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIAgentConfiguration] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: AI Agent Configurations */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIAgentConfiguration] TO [cdp_Integration]



/* Base View SQL for MJ: AI Agent Data Sources */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Data Sources
-- Item: vwAIAgentDataSources
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: AI Agent Data Sources
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  AIAgentDataSource
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwAIAgentDataSources]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwAIAgentDataSources];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwAIAgentDataSources]
AS
SELECT
    m.*,
    MJAIAgents_AgentID.[Name] AS [Agent]
FROM
    [${flyway:defaultSchema}].[AIAgentDataSource] AS m
INNER JOIN
    [${flyway:defaultSchema}].[AIAgent] AS MJAIAgents_AgentID
  ON
    [m].[AgentID] = MJAIAgents_AgentID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwAIAgentDataSources] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: AI Agent Data Sources */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Data Sources
-- Item: Permissions for vwAIAgentDataSources
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwAIAgentDataSources] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: AI Agent Data Sources */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Data Sources
-- Item: spCreateMJAIAgentDataSource
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR AIAgentDataSource
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJAIAgentDataSource]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIAgentDataSource];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIAgentDataSource]
    @ID uniqueidentifier = NULL,
    @AgentID uniqueidentifier,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @SourceType nvarchar(20) = NULL,
    @EntityName nvarchar(255),
    @ExtraFilter nvarchar(MAX),
    @OrderBy nvarchar(500),
    @FieldsToRetrieve nvarchar(MAX),
    @ResultType nvarchar(20),
    @QueryName nvarchar(255),
    @CategoryPath nvarchar(500),
    @Parameters nvarchar(MAX),
    @MaxRows int,
    @ExecutionOrder int = NULL,
    @Status nvarchar(20) = NULL,
    @CachePolicy nvarchar(20) = NULL,
    @CacheTimeoutSeconds int,
    @DestinationType nvarchar(20) = NULL,
    @DestinationPath nvarchar(500)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[AIAgentDataSource]
            (
                [ID],
                [AgentID],
                [Name],
                [Description],
                [SourceType],
                [EntityName],
                [ExtraFilter],
                [OrderBy],
                [FieldsToRetrieve],
                [ResultType],
                [QueryName],
                [CategoryPath],
                [Parameters],
                [MaxRows],
                [ExecutionOrder],
                [Status],
                [CachePolicy],
                [CacheTimeoutSeconds],
                [DestinationType],
                [DestinationPath]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @AgentID,
                @Name,
                @Description,
                ISNULL(@SourceType, 'RunView'),
                @EntityName,
                @ExtraFilter,
                @OrderBy,
                @FieldsToRetrieve,
                @ResultType,
                @QueryName,
                @CategoryPath,
                @Parameters,
                @MaxRows,
                ISNULL(@ExecutionOrder, 0),
                ISNULL(@Status, 'Active'),
                ISNULL(@CachePolicy, 'None'),
                @CacheTimeoutSeconds,
                ISNULL(@DestinationType, 'Data'),
                @DestinationPath
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[AIAgentDataSource]
            (
                [AgentID],
                [Name],
                [Description],
                [SourceType],
                [EntityName],
                [ExtraFilter],
                [OrderBy],
                [FieldsToRetrieve],
                [ResultType],
                [QueryName],
                [CategoryPath],
                [Parameters],
                [MaxRows],
                [ExecutionOrder],
                [Status],
                [CachePolicy],
                [CacheTimeoutSeconds],
                [DestinationType],
                [DestinationPath]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @AgentID,
                @Name,
                @Description,
                ISNULL(@SourceType, 'RunView'),
                @EntityName,
                @ExtraFilter,
                @OrderBy,
                @FieldsToRetrieve,
                @ResultType,
                @QueryName,
                @CategoryPath,
                @Parameters,
                @MaxRows,
                ISNULL(@ExecutionOrder, 0),
                ISNULL(@Status, 'Active'),
                ISNULL(@CachePolicy, 'None'),
                @CacheTimeoutSeconds,
                ISNULL(@DestinationType, 'Data'),
                @DestinationPath
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwAIAgentDataSources] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIAgentDataSource] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: AI Agent Data Sources */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIAgentDataSource] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: AI Agent Data Sources */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Data Sources
-- Item: spUpdateMJAIAgentDataSource
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR AIAgentDataSource
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJAIAgentDataSource]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIAgentDataSource];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIAgentDataSource]
    @ID uniqueidentifier,
    @AgentID uniqueidentifier,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @SourceType nvarchar(20),
    @EntityName nvarchar(255),
    @ExtraFilter nvarchar(MAX),
    @OrderBy nvarchar(500),
    @FieldsToRetrieve nvarchar(MAX),
    @ResultType nvarchar(20),
    @QueryName nvarchar(255),
    @CategoryPath nvarchar(500),
    @Parameters nvarchar(MAX),
    @MaxRows int,
    @ExecutionOrder int,
    @Status nvarchar(20),
    @CachePolicy nvarchar(20),
    @CacheTimeoutSeconds int,
    @DestinationType nvarchar(20),
    @DestinationPath nvarchar(500)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIAgentDataSource]
    SET
        [AgentID] = @AgentID,
        [Name] = @Name,
        [Description] = @Description,
        [SourceType] = @SourceType,
        [EntityName] = @EntityName,
        [ExtraFilter] = @ExtraFilter,
        [OrderBy] = @OrderBy,
        [FieldsToRetrieve] = @FieldsToRetrieve,
        [ResultType] = @ResultType,
        [QueryName] = @QueryName,
        [CategoryPath] = @CategoryPath,
        [Parameters] = @Parameters,
        [MaxRows] = @MaxRows,
        [ExecutionOrder] = @ExecutionOrder,
        [Status] = @Status,
        [CachePolicy] = @CachePolicy,
        [CacheTimeoutSeconds] = @CacheTimeoutSeconds,
        [DestinationType] = @DestinationType,
        [DestinationPath] = @DestinationPath
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwAIAgentDataSources] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwAIAgentDataSources]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIAgentDataSource] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the AIAgentDataSource table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJAIAgentDataSource]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJAIAgentDataSource];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJAIAgentDataSource
ON [${flyway:defaultSchema}].[AIAgentDataSource]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIAgentDataSource]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[AIAgentDataSource] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: AI Agent Data Sources */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIAgentDataSource] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: AI Agent Data Sources */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Data Sources
-- Item: spDeleteMJAIAgentDataSource
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR AIAgentDataSource
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJAIAgentDataSource]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIAgentDataSource];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIAgentDataSource]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[AIAgentDataSource]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIAgentDataSource] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: AI Agent Data Sources */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIAgentDataSource] TO [cdp_Integration]



/* Base View SQL for MJ: AI Agent Learning Cycles */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Learning Cycles
-- Item: vwAIAgentLearningCycles
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: AI Agent Learning Cycles
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  AIAgentLearningCycle
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwAIAgentLearningCycles]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwAIAgentLearningCycles];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwAIAgentLearningCycles]
AS
SELECT
    m.*,
    MJAIAgents_AgentID.[Name] AS [Agent]
FROM
    [${flyway:defaultSchema}].[AIAgentLearningCycle] AS m
INNER JOIN
    [${flyway:defaultSchema}].[AIAgent] AS MJAIAgents_AgentID
  ON
    [m].[AgentID] = MJAIAgents_AgentID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwAIAgentLearningCycles] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: AI Agent Learning Cycles */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Learning Cycles
-- Item: Permissions for vwAIAgentLearningCycles
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwAIAgentLearningCycles] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: AI Agent Learning Cycles */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Learning Cycles
-- Item: spCreateMJAIAgentLearningCycle
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR AIAgentLearningCycle
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJAIAgentLearningCycle]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIAgentLearningCycle];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIAgentLearningCycle]
    @ID uniqueidentifier = NULL,
    @AgentID uniqueidentifier,
    @StartedAt datetimeoffset = NULL,
    @EndedAt datetimeoffset,
    @Status nvarchar(20),
    @AgentSummary nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[AIAgentLearningCycle]
            (
                [ID],
                [AgentID],
                [StartedAt],
                [EndedAt],
                [Status],
                [AgentSummary]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @AgentID,
                ISNULL(@StartedAt, getutcdate()),
                @EndedAt,
                @Status,
                @AgentSummary
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[AIAgentLearningCycle]
            (
                [AgentID],
                [StartedAt],
                [EndedAt],
                [Status],
                [AgentSummary]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @AgentID,
                ISNULL(@StartedAt, getutcdate()),
                @EndedAt,
                @Status,
                @AgentSummary
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwAIAgentLearningCycles] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIAgentLearningCycle] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: AI Agent Learning Cycles */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIAgentLearningCycle] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: AI Agent Learning Cycles */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Learning Cycles
-- Item: spUpdateMJAIAgentLearningCycle
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR AIAgentLearningCycle
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJAIAgentLearningCycle]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIAgentLearningCycle];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIAgentLearningCycle]
    @ID uniqueidentifier,
    @AgentID uniqueidentifier,
    @StartedAt datetimeoffset,
    @EndedAt datetimeoffset,
    @Status nvarchar(20),
    @AgentSummary nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIAgentLearningCycle]
    SET
        [AgentID] = @AgentID,
        [StartedAt] = @StartedAt,
        [EndedAt] = @EndedAt,
        [Status] = @Status,
        [AgentSummary] = @AgentSummary
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwAIAgentLearningCycles] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwAIAgentLearningCycles]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIAgentLearningCycle] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the AIAgentLearningCycle table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJAIAgentLearningCycle]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJAIAgentLearningCycle];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJAIAgentLearningCycle
ON [${flyway:defaultSchema}].[AIAgentLearningCycle]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIAgentLearningCycle]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[AIAgentLearningCycle] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: AI Agent Learning Cycles */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIAgentLearningCycle] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: AI Agent Learning Cycles */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Learning Cycles
-- Item: spDeleteMJAIAgentLearningCycle
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR AIAgentLearningCycle
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJAIAgentLearningCycle]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIAgentLearningCycle];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIAgentLearningCycle]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[AIAgentLearningCycle]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIAgentLearningCycle] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: AI Agent Learning Cycles */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIAgentLearningCycle] TO [cdp_Integration]



/* Base View SQL for MJ: AI Agent Models */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Models
-- Item: vwAIAgentModels
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: AI Agent Models
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  AIAgentModel
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwAIAgentModels]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwAIAgentModels];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwAIAgentModels]
AS
SELECT
    m.*,
    MJAIAgents_AgentID.[Name] AS [Agent],
    MJAIModels_ModelID.[Name] AS [Model]
FROM
    [${flyway:defaultSchema}].[AIAgentModel] AS m
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[AIAgent] AS MJAIAgents_AgentID
  ON
    [m].[AgentID] = MJAIAgents_AgentID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[AIModel] AS MJAIModels_ModelID
  ON
    [m].[ModelID] = MJAIModels_ModelID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwAIAgentModels] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: AI Agent Models */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Models
-- Item: Permissions for vwAIAgentModels
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwAIAgentModels] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: AI Agent Models */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Models
-- Item: spCreateMJAIAgentModel
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR AIAgentModel
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJAIAgentModel]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIAgentModel];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIAgentModel]
    @ID uniqueidentifier = NULL,
    @AgentID uniqueidentifier,
    @ModelID uniqueidentifier,
    @Active bit,
    @Priority int
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[AIAgentModel]
            (
                [ID],
                [AgentID],
                [ModelID],
                [Active],
                [Priority]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @AgentID,
                @ModelID,
                @Active,
                @Priority
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[AIAgentModel]
            (
                [AgentID],
                [ModelID],
                [Active],
                [Priority]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @AgentID,
                @ModelID,
                @Active,
                @Priority
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwAIAgentModels] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIAgentModel] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: AI Agent Models */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIAgentModel] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: AI Agent Models */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Models
-- Item: spUpdateMJAIAgentModel
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR AIAgentModel
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJAIAgentModel]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIAgentModel];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIAgentModel]
    @ID uniqueidentifier,
    @AgentID uniqueidentifier,
    @ModelID uniqueidentifier,
    @Active bit,
    @Priority int
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIAgentModel]
    SET
        [AgentID] = @AgentID,
        [ModelID] = @ModelID,
        [Active] = @Active,
        [Priority] = @Priority
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwAIAgentModels] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwAIAgentModels]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIAgentModel] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the AIAgentModel table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJAIAgentModel]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJAIAgentModel];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJAIAgentModel
ON [${flyway:defaultSchema}].[AIAgentModel]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIAgentModel]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[AIAgentModel] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: AI Agent Models */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIAgentModel] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: AI Agent Models */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Models
-- Item: spDeleteMJAIAgentModel
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR AIAgentModel
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJAIAgentModel]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIAgentModel];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIAgentModel]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[AIAgentModel]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIAgentModel] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: AI Agent Models */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIAgentModel] TO [cdp_Integration]



/* Base View SQL for MJ: AI Agent Modalities */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Modalities
-- Item: vwAIAgentModalities
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: AI Agent Modalities
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  AIAgentModality
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwAIAgentModalities]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwAIAgentModalities];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwAIAgentModalities]
AS
SELECT
    m.*,
    MJAIAgents_AgentID.[Name] AS [Agent],
    MJAIModalities_ModalityID.[Name] AS [Modality]
FROM
    [${flyway:defaultSchema}].[AIAgentModality] AS m
INNER JOIN
    [${flyway:defaultSchema}].[AIAgent] AS MJAIAgents_AgentID
  ON
    [m].[AgentID] = MJAIAgents_AgentID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[AIModality] AS MJAIModalities_ModalityID
  ON
    [m].[ModalityID] = MJAIModalities_ModalityID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwAIAgentModalities] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: AI Agent Modalities */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Modalities
-- Item: Permissions for vwAIAgentModalities
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwAIAgentModalities] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: AI Agent Modalities */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Modalities
-- Item: spCreateMJAIAgentModality
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR AIAgentModality
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJAIAgentModality]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIAgentModality];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIAgentModality]
    @ID uniqueidentifier = NULL,
    @AgentID uniqueidentifier,
    @ModalityID uniqueidentifier,
    @Direction nvarchar(10),
    @IsAllowed bit = NULL,
    @MaxSizeBytes int,
    @MaxCountPerMessage int
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[AIAgentModality]
            (
                [ID],
                [AgentID],
                [ModalityID],
                [Direction],
                [IsAllowed],
                [MaxSizeBytes],
                [MaxCountPerMessage]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @AgentID,
                @ModalityID,
                @Direction,
                ISNULL(@IsAllowed, 1),
                @MaxSizeBytes,
                @MaxCountPerMessage
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[AIAgentModality]
            (
                [AgentID],
                [ModalityID],
                [Direction],
                [IsAllowed],
                [MaxSizeBytes],
                [MaxCountPerMessage]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @AgentID,
                @ModalityID,
                @Direction,
                ISNULL(@IsAllowed, 1),
                @MaxSizeBytes,
                @MaxCountPerMessage
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwAIAgentModalities] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIAgentModality] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: AI Agent Modalities */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIAgentModality] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: AI Agent Modalities */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Modalities
-- Item: spUpdateMJAIAgentModality
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR AIAgentModality
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJAIAgentModality]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIAgentModality];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIAgentModality]
    @ID uniqueidentifier,
    @AgentID uniqueidentifier,
    @ModalityID uniqueidentifier,
    @Direction nvarchar(10),
    @IsAllowed bit,
    @MaxSizeBytes int,
    @MaxCountPerMessage int
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIAgentModality]
    SET
        [AgentID] = @AgentID,
        [ModalityID] = @ModalityID,
        [Direction] = @Direction,
        [IsAllowed] = @IsAllowed,
        [MaxSizeBytes] = @MaxSizeBytes,
        [MaxCountPerMessage] = @MaxCountPerMessage
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwAIAgentModalities] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwAIAgentModalities]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIAgentModality] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the AIAgentModality table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJAIAgentModality]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJAIAgentModality];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJAIAgentModality
ON [${flyway:defaultSchema}].[AIAgentModality]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIAgentModality]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[AIAgentModality] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: AI Agent Modalities */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIAgentModality] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: AI Agent Modalities */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Modalities
-- Item: spDeleteMJAIAgentModality
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR AIAgentModality
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJAIAgentModality]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIAgentModality];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIAgentModality]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[AIAgentModality]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIAgentModality] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: AI Agent Modalities */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIAgentModality] TO [cdp_Integration]



/* Base View SQL for MJ: AI Agent Notes */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Notes
-- Item: vwAIAgentNotes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: AI Agent Notes
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  AIAgentNote
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwAIAgentNotes]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwAIAgentNotes];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwAIAgentNotes]
AS
SELECT
    m.*,
    MJAIAgents_AgentID.[Name] AS [Agent],
    MJAIAgentNoteTypes_AgentNoteTypeID.[Name] AS [AgentNoteType],
    MJUsers_UserID.[Name] AS [User],
    MJConversations_SourceConversationID.[Name] AS [SourceConversation],
    MJConversationDetails_SourceConversationDetailID.[Message] AS [SourceConversationDetail],
    MJAIAgentRuns_SourceAIAgentRunID.[RunName] AS [SourceAIAgentRun],
    MJCompanies_CompanyID.[Name] AS [Company],
    MJAIModels_EmbeddingModelID.[Name] AS [EmbeddingModel],
    MJEntities_PrimaryScopeEntityID.[Name] AS [PrimaryScopeEntity]
FROM
    [${flyway:defaultSchema}].[AIAgentNote] AS m
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[AIAgent] AS MJAIAgents_AgentID
  ON
    [m].[AgentID] = MJAIAgents_AgentID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[AIAgentNoteType] AS MJAIAgentNoteTypes_AgentNoteTypeID
  ON
    [m].[AgentNoteTypeID] = MJAIAgentNoteTypes_AgentNoteTypeID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_UserID
  ON
    [m].[UserID] = MJUsers_UserID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[Conversation] AS MJConversations_SourceConversationID
  ON
    [m].[SourceConversationID] = MJConversations_SourceConversationID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[ConversationDetail] AS MJConversationDetails_SourceConversationDetailID
  ON
    [m].[SourceConversationDetailID] = MJConversationDetails_SourceConversationDetailID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[AIAgentRun] AS MJAIAgentRuns_SourceAIAgentRunID
  ON
    [m].[SourceAIAgentRunID] = MJAIAgentRuns_SourceAIAgentRunID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[Company] AS MJCompanies_CompanyID
  ON
    [m].[CompanyID] = MJCompanies_CompanyID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[AIModel] AS MJAIModels_EmbeddingModelID
  ON
    [m].[EmbeddingModelID] = MJAIModels_EmbeddingModelID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[Entity] AS MJEntities_PrimaryScopeEntityID
  ON
    [m].[PrimaryScopeEntityID] = MJEntities_PrimaryScopeEntityID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwAIAgentNotes] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: AI Agent Notes */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Notes
-- Item: Permissions for vwAIAgentNotes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwAIAgentNotes] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: AI Agent Notes */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Notes
-- Item: spCreateMJAIAgentNote
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR AIAgentNote
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJAIAgentNote]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIAgentNote];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIAgentNote]
    @ID uniqueidentifier = NULL,
    @AgentID uniqueidentifier,
    @AgentNoteTypeID uniqueidentifier,
    @Note nvarchar(MAX),
    @UserID uniqueidentifier,
    @Type nvarchar(20) = NULL,
    @IsAutoGenerated bit = NULL,
    @Comments nvarchar(MAX),
    @Status nvarchar(20) = NULL,
    @SourceConversationID uniqueidentifier,
    @SourceConversationDetailID uniqueidentifier,
    @SourceAIAgentRunID uniqueidentifier,
    @CompanyID uniqueidentifier,
    @EmbeddingVector nvarchar(MAX),
    @EmbeddingModelID uniqueidentifier,
    @PrimaryScopeEntityID uniqueidentifier,
    @PrimaryScopeRecordID nvarchar(100),
    @SecondaryScopes nvarchar(MAX),
    @LastAccessedAt datetimeoffset,
    @AccessCount int = NULL,
    @ExpiresAt datetimeoffset
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[AIAgentNote]
            (
                [ID],
                [AgentID],
                [AgentNoteTypeID],
                [Note],
                [UserID],
                [Type],
                [IsAutoGenerated],
                [Comments],
                [Status],
                [SourceConversationID],
                [SourceConversationDetailID],
                [SourceAIAgentRunID],
                [CompanyID],
                [EmbeddingVector],
                [EmbeddingModelID],
                [PrimaryScopeEntityID],
                [PrimaryScopeRecordID],
                [SecondaryScopes],
                [LastAccessedAt],
                [AccessCount],
                [ExpiresAt]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @AgentID,
                @AgentNoteTypeID,
                @Note,
                @UserID,
                ISNULL(@Type, 'Preference'),
                ISNULL(@IsAutoGenerated, 0),
                @Comments,
                ISNULL(@Status, 'Active'),
                @SourceConversationID,
                @SourceConversationDetailID,
                @SourceAIAgentRunID,
                @CompanyID,
                @EmbeddingVector,
                @EmbeddingModelID,
                @PrimaryScopeEntityID,
                @PrimaryScopeRecordID,
                @SecondaryScopes,
                @LastAccessedAt,
                ISNULL(@AccessCount, 0),
                @ExpiresAt
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[AIAgentNote]
            (
                [AgentID],
                [AgentNoteTypeID],
                [Note],
                [UserID],
                [Type],
                [IsAutoGenerated],
                [Comments],
                [Status],
                [SourceConversationID],
                [SourceConversationDetailID],
                [SourceAIAgentRunID],
                [CompanyID],
                [EmbeddingVector],
                [EmbeddingModelID],
                [PrimaryScopeEntityID],
                [PrimaryScopeRecordID],
                [SecondaryScopes],
                [LastAccessedAt],
                [AccessCount],
                [ExpiresAt]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @AgentID,
                @AgentNoteTypeID,
                @Note,
                @UserID,
                ISNULL(@Type, 'Preference'),
                ISNULL(@IsAutoGenerated, 0),
                @Comments,
                ISNULL(@Status, 'Active'),
                @SourceConversationID,
                @SourceConversationDetailID,
                @SourceAIAgentRunID,
                @CompanyID,
                @EmbeddingVector,
                @EmbeddingModelID,
                @PrimaryScopeEntityID,
                @PrimaryScopeRecordID,
                @SecondaryScopes,
                @LastAccessedAt,
                ISNULL(@AccessCount, 0),
                @ExpiresAt
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwAIAgentNotes] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIAgentNote] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: AI Agent Notes */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIAgentNote] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: AI Agent Notes */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Notes
-- Item: spUpdateMJAIAgentNote
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR AIAgentNote
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJAIAgentNote]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIAgentNote];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIAgentNote]
    @ID uniqueidentifier,
    @AgentID uniqueidentifier,
    @AgentNoteTypeID uniqueidentifier,
    @Note nvarchar(MAX),
    @UserID uniqueidentifier,
    @Type nvarchar(20),
    @IsAutoGenerated bit,
    @Comments nvarchar(MAX),
    @Status nvarchar(20),
    @SourceConversationID uniqueidentifier,
    @SourceConversationDetailID uniqueidentifier,
    @SourceAIAgentRunID uniqueidentifier,
    @CompanyID uniqueidentifier,
    @EmbeddingVector nvarchar(MAX),
    @EmbeddingModelID uniqueidentifier,
    @PrimaryScopeEntityID uniqueidentifier,
    @PrimaryScopeRecordID nvarchar(100),
    @SecondaryScopes nvarchar(MAX),
    @LastAccessedAt datetimeoffset,
    @AccessCount int,
    @ExpiresAt datetimeoffset
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIAgentNote]
    SET
        [AgentID] = @AgentID,
        [AgentNoteTypeID] = @AgentNoteTypeID,
        [Note] = @Note,
        [UserID] = @UserID,
        [Type] = @Type,
        [IsAutoGenerated] = @IsAutoGenerated,
        [Comments] = @Comments,
        [Status] = @Status,
        [SourceConversationID] = @SourceConversationID,
        [SourceConversationDetailID] = @SourceConversationDetailID,
        [SourceAIAgentRunID] = @SourceAIAgentRunID,
        [CompanyID] = @CompanyID,
        [EmbeddingVector] = @EmbeddingVector,
        [EmbeddingModelID] = @EmbeddingModelID,
        [PrimaryScopeEntityID] = @PrimaryScopeEntityID,
        [PrimaryScopeRecordID] = @PrimaryScopeRecordID,
        [SecondaryScopes] = @SecondaryScopes,
        [LastAccessedAt] = @LastAccessedAt,
        [AccessCount] = @AccessCount,
        [ExpiresAt] = @ExpiresAt
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwAIAgentNotes] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwAIAgentNotes]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIAgentNote] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the AIAgentNote table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJAIAgentNote]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJAIAgentNote];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJAIAgentNote
ON [${flyway:defaultSchema}].[AIAgentNote]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIAgentNote]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[AIAgentNote] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: AI Agent Notes */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIAgentNote] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: AI Agent Notes */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Notes
-- Item: spDeleteMJAIAgentNote
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR AIAgentNote
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJAIAgentNote]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIAgentNote];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIAgentNote]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[AIAgentNote]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIAgentNote] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: AI Agent Notes */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIAgentNote] TO [cdp_Integration]



/* Base View SQL for MJ: AI Agent Note Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Note Types
-- Item: vwAIAgentNoteTypes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: AI Agent Note Types
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  AIAgentNoteType
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwAIAgentNoteTypes]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwAIAgentNoteTypes];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwAIAgentNoteTypes]
AS
SELECT
    m.*
FROM
    [${flyway:defaultSchema}].[AIAgentNoteType] AS m
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwAIAgentNoteTypes] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: AI Agent Note Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Note Types
-- Item: Permissions for vwAIAgentNoteTypes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwAIAgentNoteTypes] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: AI Agent Note Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Note Types
-- Item: spCreateMJAIAgentNoteType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR AIAgentNoteType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJAIAgentNoteType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIAgentNoteType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIAgentNoteType]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @Priority int = NULL,
    @Status nvarchar(20) = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[AIAgentNoteType]
            (
                [ID],
                [Name],
                [Description],
                [Priority],
                [Status]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description,
                ISNULL(@Priority, 0),
                ISNULL(@Status, 'Active')
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[AIAgentNoteType]
            (
                [Name],
                [Description],
                [Priority],
                [Status]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description,
                ISNULL(@Priority, 0),
                ISNULL(@Status, 'Active')
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwAIAgentNoteTypes] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIAgentNoteType] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: AI Agent Note Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIAgentNoteType] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: AI Agent Note Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Note Types
-- Item: spUpdateMJAIAgentNoteType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR AIAgentNoteType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJAIAgentNoteType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIAgentNoteType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIAgentNoteType]
    @ID uniqueidentifier,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @Priority int,
    @Status nvarchar(20)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIAgentNoteType]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [Priority] = @Priority,
        [Status] = @Status
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwAIAgentNoteTypes] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwAIAgentNoteTypes]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIAgentNoteType] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the AIAgentNoteType table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJAIAgentNoteType]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJAIAgentNoteType];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJAIAgentNoteType
ON [${flyway:defaultSchema}].[AIAgentNoteType]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIAgentNoteType]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[AIAgentNoteType] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: AI Agent Note Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIAgentNoteType] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: AI Agent Note Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Note Types
-- Item: spDeleteMJAIAgentNoteType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR AIAgentNoteType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJAIAgentNoteType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIAgentNoteType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIAgentNoteType]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[AIAgentNoteType]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIAgentNoteType] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: AI Agent Note Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIAgentNoteType] TO [cdp_Integration]



/* Base View SQL for MJ: AI Agent Relationships */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Relationships
-- Item: vwAIAgentRelationships
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: AI Agent Relationships
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  AIAgentRelationship
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwAIAgentRelationships]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwAIAgentRelationships];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwAIAgentRelationships]
AS
SELECT
    m.*,
    MJAIAgents_AgentID.[Name] AS [Agent],
    MJAIAgents_SubAgentID.[Name] AS [SubAgent]
FROM
    [${flyway:defaultSchema}].[AIAgentRelationship] AS m
INNER JOIN
    [${flyway:defaultSchema}].[AIAgent] AS MJAIAgents_AgentID
  ON
    [m].[AgentID] = MJAIAgents_AgentID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[AIAgent] AS MJAIAgents_SubAgentID
  ON
    [m].[SubAgentID] = MJAIAgents_SubAgentID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwAIAgentRelationships] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: AI Agent Relationships */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Relationships
-- Item: Permissions for vwAIAgentRelationships
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwAIAgentRelationships] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: AI Agent Relationships */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Relationships
-- Item: spCreateMJAIAgentRelationship
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR AIAgentRelationship
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJAIAgentRelationship]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIAgentRelationship];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIAgentRelationship]
    @ID uniqueidentifier = NULL,
    @AgentID uniqueidentifier,
    @SubAgentID uniqueidentifier,
    @Status nvarchar(50),
    @SubAgentOutputMapping nvarchar(MAX),
    @SubAgentInputMapping nvarchar(MAX),
    @SubAgentContextPaths nvarchar(MAX),
    @MessageMode nvarchar(50) = NULL,
    @MaxMessages int
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[AIAgentRelationship]
            (
                [ID],
                [AgentID],
                [SubAgentID],
                [Status],
                [SubAgentOutputMapping],
                [SubAgentInputMapping],
                [SubAgentContextPaths],
                [MessageMode],
                [MaxMessages]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @AgentID,
                @SubAgentID,
                @Status,
                @SubAgentOutputMapping,
                @SubAgentInputMapping,
                @SubAgentContextPaths,
                ISNULL(@MessageMode, 'None'),
                @MaxMessages
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[AIAgentRelationship]
            (
                [AgentID],
                [SubAgentID],
                [Status],
                [SubAgentOutputMapping],
                [SubAgentInputMapping],
                [SubAgentContextPaths],
                [MessageMode],
                [MaxMessages]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @AgentID,
                @SubAgentID,
                @Status,
                @SubAgentOutputMapping,
                @SubAgentInputMapping,
                @SubAgentContextPaths,
                ISNULL(@MessageMode, 'None'),
                @MaxMessages
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwAIAgentRelationships] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIAgentRelationship] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: AI Agent Relationships */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIAgentRelationship] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: AI Agent Relationships */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Relationships
-- Item: spUpdateMJAIAgentRelationship
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR AIAgentRelationship
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJAIAgentRelationship]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIAgentRelationship];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIAgentRelationship]
    @ID uniqueidentifier,
    @AgentID uniqueidentifier,
    @SubAgentID uniqueidentifier,
    @Status nvarchar(50),
    @SubAgentOutputMapping nvarchar(MAX),
    @SubAgentInputMapping nvarchar(MAX),
    @SubAgentContextPaths nvarchar(MAX),
    @MessageMode nvarchar(50),
    @MaxMessages int
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIAgentRelationship]
    SET
        [AgentID] = @AgentID,
        [SubAgentID] = @SubAgentID,
        [Status] = @Status,
        [SubAgentOutputMapping] = @SubAgentOutputMapping,
        [SubAgentInputMapping] = @SubAgentInputMapping,
        [SubAgentContextPaths] = @SubAgentContextPaths,
        [MessageMode] = @MessageMode,
        [MaxMessages] = @MaxMessages
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwAIAgentRelationships] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwAIAgentRelationships]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIAgentRelationship] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the AIAgentRelationship table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJAIAgentRelationship]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJAIAgentRelationship];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJAIAgentRelationship
ON [${flyway:defaultSchema}].[AIAgentRelationship]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIAgentRelationship]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[AIAgentRelationship] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: AI Agent Relationships */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIAgentRelationship] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: AI Agent Relationships */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Relationships
-- Item: spDeleteMJAIAgentRelationship
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR AIAgentRelationship
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJAIAgentRelationship]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIAgentRelationship];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIAgentRelationship]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[AIAgentRelationship]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIAgentRelationship] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: AI Agent Relationships */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIAgentRelationship] TO [cdp_Integration]



/* Base View SQL for MJ: AI Agent Prompts */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Prompts
-- Item: vwAIAgentPrompts
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: AI Agent Prompts
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  AIAgentPrompt
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwAIAgentPrompts]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwAIAgentPrompts];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwAIAgentPrompts]
AS
SELECT
    m.*,
    MJAIAgents_AgentID.[Name] AS [Agent],
    MJAIPrompts_PromptID.[Name] AS [Prompt],
    MJAIConfigurations_ConfigurationID.[Name] AS [Configuration]
FROM
    [${flyway:defaultSchema}].[AIAgentPrompt] AS m
INNER JOIN
    [${flyway:defaultSchema}].[AIAgent] AS MJAIAgents_AgentID
  ON
    [m].[AgentID] = MJAIAgents_AgentID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[AIPrompt] AS MJAIPrompts_PromptID
  ON
    [m].[PromptID] = MJAIPrompts_PromptID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[AIConfiguration] AS MJAIConfigurations_ConfigurationID
  ON
    [m].[ConfigurationID] = MJAIConfigurations_ConfigurationID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwAIAgentPrompts] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: AI Agent Prompts */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Prompts
-- Item: Permissions for vwAIAgentPrompts
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwAIAgentPrompts] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: AI Agent Prompts */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Prompts
-- Item: spCreateMJAIAgentPrompt
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR AIAgentPrompt
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJAIAgentPrompt]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIAgentPrompt];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIAgentPrompt]
    @ID uniqueidentifier = NULL,
    @AgentID uniqueidentifier,
    @PromptID uniqueidentifier,
    @Purpose nvarchar(MAX),
    @ExecutionOrder int = NULL,
    @ConfigurationID uniqueidentifier,
    @Status nvarchar(20) = NULL,
    @ContextBehavior nvarchar(50) = NULL,
    @ContextMessageCount int
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[AIAgentPrompt]
            (
                [ID],
                [AgentID],
                [PromptID],
                [Purpose],
                [ExecutionOrder],
                [ConfigurationID],
                [Status],
                [ContextBehavior],
                [ContextMessageCount]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @AgentID,
                @PromptID,
                @Purpose,
                ISNULL(@ExecutionOrder, 0),
                @ConfigurationID,
                ISNULL(@Status, 'Active'),
                ISNULL(@ContextBehavior, 'Complete'),
                @ContextMessageCount
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[AIAgentPrompt]
            (
                [AgentID],
                [PromptID],
                [Purpose],
                [ExecutionOrder],
                [ConfigurationID],
                [Status],
                [ContextBehavior],
                [ContextMessageCount]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @AgentID,
                @PromptID,
                @Purpose,
                ISNULL(@ExecutionOrder, 0),
                @ConfigurationID,
                ISNULL(@Status, 'Active'),
                ISNULL(@ContextBehavior, 'Complete'),
                @ContextMessageCount
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwAIAgentPrompts] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIAgentPrompt] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: AI Agent Prompts */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIAgentPrompt] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: AI Agent Prompts */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Prompts
-- Item: spUpdateMJAIAgentPrompt
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR AIAgentPrompt
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJAIAgentPrompt]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIAgentPrompt];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIAgentPrompt]
    @ID uniqueidentifier,
    @AgentID uniqueidentifier,
    @PromptID uniqueidentifier,
    @Purpose nvarchar(MAX),
    @ExecutionOrder int,
    @ConfigurationID uniqueidentifier,
    @Status nvarchar(20),
    @ContextBehavior nvarchar(50),
    @ContextMessageCount int
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIAgentPrompt]
    SET
        [AgentID] = @AgentID,
        [PromptID] = @PromptID,
        [Purpose] = @Purpose,
        [ExecutionOrder] = @ExecutionOrder,
        [ConfigurationID] = @ConfigurationID,
        [Status] = @Status,
        [ContextBehavior] = @ContextBehavior,
        [ContextMessageCount] = @ContextMessageCount
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwAIAgentPrompts] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwAIAgentPrompts]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIAgentPrompt] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the AIAgentPrompt table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJAIAgentPrompt]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJAIAgentPrompt];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJAIAgentPrompt
ON [${flyway:defaultSchema}].[AIAgentPrompt]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIAgentPrompt]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[AIAgentPrompt] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: AI Agent Prompts */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIAgentPrompt] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: AI Agent Prompts */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Prompts
-- Item: spDeleteMJAIAgentPrompt
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR AIAgentPrompt
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJAIAgentPrompt]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIAgentPrompt];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIAgentPrompt]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[AIAgentPrompt]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIAgentPrompt] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: AI Agent Prompts */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIAgentPrompt] TO [cdp_Integration]



/* Base View SQL for MJ: AI Agent Requests */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Requests
-- Item: vwAIAgentRequests
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: AI Agent Requests
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  AIAgentRequest
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwAIAgentRequests]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwAIAgentRequests];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwAIAgentRequests]
AS
SELECT
    m.*,
    MJAIAgents_AgentID.[Name] AS [Agent],
    MJUsers_RequestForUserID.[Name] AS [RequestForUser],
    MJUsers_ResponseByUserID.[Name] AS [ResponseByUser]
FROM
    [${flyway:defaultSchema}].[AIAgentRequest] AS m
INNER JOIN
    [${flyway:defaultSchema}].[AIAgent] AS MJAIAgents_AgentID
  ON
    [m].[AgentID] = MJAIAgents_AgentID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_RequestForUserID
  ON
    [m].[RequestForUserID] = MJUsers_RequestForUserID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_ResponseByUserID
  ON
    [m].[ResponseByUserID] = MJUsers_ResponseByUserID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwAIAgentRequests] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: AI Agent Requests */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Requests
-- Item: Permissions for vwAIAgentRequests
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwAIAgentRequests] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: AI Agent Requests */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Requests
-- Item: spCreateMJAIAgentRequest
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR AIAgentRequest
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJAIAgentRequest]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIAgentRequest];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIAgentRequest]
    @ID uniqueidentifier = NULL,
    @AgentID uniqueidentifier,
    @RequestedAt datetimeoffset,
    @RequestForUserID uniqueidentifier,
    @Status nvarchar(20),
    @Request nvarchar(MAX),
    @Response nvarchar(MAX),
    @ResponseByUserID uniqueidentifier,
    @RespondedAt datetimeoffset,
    @Comments nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[AIAgentRequest]
            (
                [ID],
                [AgentID],
                [RequestedAt],
                [RequestForUserID],
                [Status],
                [Request],
                [Response],
                [ResponseByUserID],
                [RespondedAt],
                [Comments]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @AgentID,
                @RequestedAt,
                @RequestForUserID,
                @Status,
                @Request,
                @Response,
                @ResponseByUserID,
                @RespondedAt,
                @Comments
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[AIAgentRequest]
            (
                [AgentID],
                [RequestedAt],
                [RequestForUserID],
                [Status],
                [Request],
                [Response],
                [ResponseByUserID],
                [RespondedAt],
                [Comments]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @AgentID,
                @RequestedAt,
                @RequestForUserID,
                @Status,
                @Request,
                @Response,
                @ResponseByUserID,
                @RespondedAt,
                @Comments
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwAIAgentRequests] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIAgentRequest] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: AI Agent Requests */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIAgentRequest] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: AI Agent Requests */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Requests
-- Item: spUpdateMJAIAgentRequest
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR AIAgentRequest
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJAIAgentRequest]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIAgentRequest];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIAgentRequest]
    @ID uniqueidentifier,
    @AgentID uniqueidentifier,
    @RequestedAt datetimeoffset,
    @RequestForUserID uniqueidentifier,
    @Status nvarchar(20),
    @Request nvarchar(MAX),
    @Response nvarchar(MAX),
    @ResponseByUserID uniqueidentifier,
    @RespondedAt datetimeoffset,
    @Comments nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIAgentRequest]
    SET
        [AgentID] = @AgentID,
        [RequestedAt] = @RequestedAt,
        [RequestForUserID] = @RequestForUserID,
        [Status] = @Status,
        [Request] = @Request,
        [Response] = @Response,
        [ResponseByUserID] = @ResponseByUserID,
        [RespondedAt] = @RespondedAt,
        [Comments] = @Comments
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwAIAgentRequests] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwAIAgentRequests]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIAgentRequest] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the AIAgentRequest table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJAIAgentRequest]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJAIAgentRequest];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJAIAgentRequest
ON [${flyway:defaultSchema}].[AIAgentRequest]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIAgentRequest]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[AIAgentRequest] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: AI Agent Requests */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIAgentRequest] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: AI Agent Requests */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Requests
-- Item: spDeleteMJAIAgentRequest
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR AIAgentRequest
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJAIAgentRequest]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIAgentRequest];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIAgentRequest]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[AIAgentRequest]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIAgentRequest] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: AI Agent Requests */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIAgentRequest] TO [cdp_Integration]



/* Base View SQL for MJ: AI Agent Run Medias */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Run Medias
-- Item: vwAIAgentRunMedias
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: AI Agent Run Medias
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  AIAgentRunMedia
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwAIAgentRunMedias]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwAIAgentRunMedias];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwAIAgentRunMedias]
AS
SELECT
    m.*,
    MJAIAgentRuns_AgentRunID.[RunName] AS [AgentRun],
    MJAIPromptRunMedias_SourcePromptRunMediaID.[FileName] AS [SourcePromptRunMedia],
    MJAIModalities_ModalityID.[Name] AS [Modality],
    MJFiles_FileID.[Name] AS [File]
FROM
    [${flyway:defaultSchema}].[AIAgentRunMedia] AS m
INNER JOIN
    [${flyway:defaultSchema}].[AIAgentRun] AS MJAIAgentRuns_AgentRunID
  ON
    [m].[AgentRunID] = MJAIAgentRuns_AgentRunID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[AIPromptRunMedia] AS MJAIPromptRunMedias_SourcePromptRunMediaID
  ON
    [m].[SourcePromptRunMediaID] = MJAIPromptRunMedias_SourcePromptRunMediaID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[AIModality] AS MJAIModalities_ModalityID
  ON
    [m].[ModalityID] = MJAIModalities_ModalityID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[File] AS MJFiles_FileID
  ON
    [m].[FileID] = MJFiles_FileID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwAIAgentRunMedias] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: AI Agent Run Medias */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Run Medias
-- Item: Permissions for vwAIAgentRunMedias
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwAIAgentRunMedias] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: AI Agent Run Medias */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Run Medias
-- Item: spCreateMJAIAgentRunMedia
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR AIAgentRunMedia
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJAIAgentRunMedia]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIAgentRunMedia];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIAgentRunMedia]
    @ID uniqueidentifier = NULL,
    @AgentRunID uniqueidentifier,
    @SourcePromptRunMediaID uniqueidentifier,
    @ModalityID uniqueidentifier,
    @MimeType nvarchar(100),
    @FileName nvarchar(255),
    @FileSizeBytes int,
    @Width int,
    @Height int,
    @DurationSeconds decimal(10, 2),
    @InlineData nvarchar(MAX),
    @FileID uniqueidentifier,
    @ThumbnailBase64 nvarchar(MAX),
    @Label nvarchar(255),
    @Metadata nvarchar(MAX),
    @DisplayOrder int = NULL,
    @Description nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[AIAgentRunMedia]
            (
                [ID],
                [AgentRunID],
                [SourcePromptRunMediaID],
                [ModalityID],
                [MimeType],
                [FileName],
                [FileSizeBytes],
                [Width],
                [Height],
                [DurationSeconds],
                [InlineData],
                [FileID],
                [ThumbnailBase64],
                [Label],
                [Metadata],
                [DisplayOrder],
                [Description]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @AgentRunID,
                @SourcePromptRunMediaID,
                @ModalityID,
                @MimeType,
                @FileName,
                @FileSizeBytes,
                @Width,
                @Height,
                @DurationSeconds,
                @InlineData,
                @FileID,
                @ThumbnailBase64,
                @Label,
                @Metadata,
                ISNULL(@DisplayOrder, 0),
                @Description
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[AIAgentRunMedia]
            (
                [AgentRunID],
                [SourcePromptRunMediaID],
                [ModalityID],
                [MimeType],
                [FileName],
                [FileSizeBytes],
                [Width],
                [Height],
                [DurationSeconds],
                [InlineData],
                [FileID],
                [ThumbnailBase64],
                [Label],
                [Metadata],
                [DisplayOrder],
                [Description]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @AgentRunID,
                @SourcePromptRunMediaID,
                @ModalityID,
                @MimeType,
                @FileName,
                @FileSizeBytes,
                @Width,
                @Height,
                @DurationSeconds,
                @InlineData,
                @FileID,
                @ThumbnailBase64,
                @Label,
                @Metadata,
                ISNULL(@DisplayOrder, 0),
                @Description
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwAIAgentRunMedias] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIAgentRunMedia] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: AI Agent Run Medias */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIAgentRunMedia] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: AI Agent Run Medias */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Run Medias
-- Item: spUpdateMJAIAgentRunMedia
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR AIAgentRunMedia
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJAIAgentRunMedia]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIAgentRunMedia];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIAgentRunMedia]
    @ID uniqueidentifier,
    @AgentRunID uniqueidentifier,
    @SourcePromptRunMediaID uniqueidentifier,
    @ModalityID uniqueidentifier,
    @MimeType nvarchar(100),
    @FileName nvarchar(255),
    @FileSizeBytes int,
    @Width int,
    @Height int,
    @DurationSeconds decimal(10, 2),
    @InlineData nvarchar(MAX),
    @FileID uniqueidentifier,
    @ThumbnailBase64 nvarchar(MAX),
    @Label nvarchar(255),
    @Metadata nvarchar(MAX),
    @DisplayOrder int,
    @Description nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIAgentRunMedia]
    SET
        [AgentRunID] = @AgentRunID,
        [SourcePromptRunMediaID] = @SourcePromptRunMediaID,
        [ModalityID] = @ModalityID,
        [MimeType] = @MimeType,
        [FileName] = @FileName,
        [FileSizeBytes] = @FileSizeBytes,
        [Width] = @Width,
        [Height] = @Height,
        [DurationSeconds] = @DurationSeconds,
        [InlineData] = @InlineData,
        [FileID] = @FileID,
        [ThumbnailBase64] = @ThumbnailBase64,
        [Label] = @Label,
        [Metadata] = @Metadata,
        [DisplayOrder] = @DisplayOrder,
        [Description] = @Description
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwAIAgentRunMedias] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwAIAgentRunMedias]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIAgentRunMedia] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the AIAgentRunMedia table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJAIAgentRunMedia]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJAIAgentRunMedia];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJAIAgentRunMedia
ON [${flyway:defaultSchema}].[AIAgentRunMedia]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIAgentRunMedia]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[AIAgentRunMedia] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: AI Agent Run Medias */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIAgentRunMedia] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: AI Agent Run Medias */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Run Medias
-- Item: spDeleteMJAIAgentRunMedia
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR AIAgentRunMedia
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJAIAgentRunMedia]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIAgentRunMedia];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIAgentRunMedia]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[AIAgentRunMedia]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIAgentRunMedia] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: AI Agent Run Medias */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIAgentRunMedia] TO [cdp_Integration]



/* Base View SQL for MJ: AI Agent Permissions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Permissions
-- Item: vwAIAgentPermissions
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: AI Agent Permissions
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  AIAgentPermission
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwAIAgentPermissions]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwAIAgentPermissions];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwAIAgentPermissions]
AS
SELECT
    m.*,
    MJAIAgents_AgentID.[Name] AS [Agent],
    MJRoles_RoleID.[Name] AS [Role],
    MJUsers_UserID.[Name] AS [User]
FROM
    [${flyway:defaultSchema}].[AIAgentPermission] AS m
INNER JOIN
    [${flyway:defaultSchema}].[AIAgent] AS MJAIAgents_AgentID
  ON
    [m].[AgentID] = MJAIAgents_AgentID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[Role] AS MJRoles_RoleID
  ON
    [m].[RoleID] = MJRoles_RoleID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_UserID
  ON
    [m].[UserID] = MJUsers_UserID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwAIAgentPermissions] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: AI Agent Permissions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Permissions
-- Item: Permissions for vwAIAgentPermissions
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwAIAgentPermissions] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: AI Agent Permissions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Permissions
-- Item: spCreateMJAIAgentPermission
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR AIAgentPermission
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJAIAgentPermission]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIAgentPermission];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIAgentPermission]
    @ID uniqueidentifier = NULL,
    @AgentID uniqueidentifier,
    @RoleID uniqueidentifier,
    @UserID uniqueidentifier,
    @CanView bit = NULL,
    @CanRun bit = NULL,
    @CanEdit bit = NULL,
    @CanDelete bit = NULL,
    @Comments nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[AIAgentPermission]
            (
                [ID],
                [AgentID],
                [RoleID],
                [UserID],
                [CanView],
                [CanRun],
                [CanEdit],
                [CanDelete],
                [Comments]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @AgentID,
                @RoleID,
                @UserID,
                ISNULL(@CanView, 0),
                ISNULL(@CanRun, 0),
                ISNULL(@CanEdit, 0),
                ISNULL(@CanDelete, 0),
                @Comments
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[AIAgentPermission]
            (
                [AgentID],
                [RoleID],
                [UserID],
                [CanView],
                [CanRun],
                [CanEdit],
                [CanDelete],
                [Comments]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @AgentID,
                @RoleID,
                @UserID,
                ISNULL(@CanView, 0),
                ISNULL(@CanRun, 0),
                ISNULL(@CanEdit, 0),
                ISNULL(@CanDelete, 0),
                @Comments
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwAIAgentPermissions] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIAgentPermission] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: AI Agent Permissions */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIAgentPermission] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: AI Agent Permissions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Permissions
-- Item: spUpdateMJAIAgentPermission
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR AIAgentPermission
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJAIAgentPermission]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIAgentPermission];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIAgentPermission]
    @ID uniqueidentifier,
    @AgentID uniqueidentifier,
    @RoleID uniqueidentifier,
    @UserID uniqueidentifier,
    @CanView bit,
    @CanRun bit,
    @CanEdit bit,
    @CanDelete bit,
    @Comments nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIAgentPermission]
    SET
        [AgentID] = @AgentID,
        [RoleID] = @RoleID,
        [UserID] = @UserID,
        [CanView] = @CanView,
        [CanRun] = @CanRun,
        [CanEdit] = @CanEdit,
        [CanDelete] = @CanDelete,
        [Comments] = @Comments
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwAIAgentPermissions] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwAIAgentPermissions]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIAgentPermission] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the AIAgentPermission table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJAIAgentPermission]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJAIAgentPermission];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJAIAgentPermission
ON [${flyway:defaultSchema}].[AIAgentPermission]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIAgentPermission]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[AIAgentPermission] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: AI Agent Permissions */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIAgentPermission] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: AI Agent Permissions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Permissions
-- Item: spDeleteMJAIAgentPermission
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR AIAgentPermission
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJAIAgentPermission]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIAgentPermission];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIAgentPermission]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[AIAgentPermission]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIAgentPermission] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: AI Agent Permissions */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIAgentPermission] TO [cdp_Integration]



/* Base View SQL for MJ: AI Agent Runs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Runs
-- Item: vwAIAgentRuns
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: AI Agent Runs
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  AIAgentRun
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwAIAgentRuns]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwAIAgentRuns];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwAIAgentRuns]
AS
SELECT
    m.*,
    MJAIAgents_AgentID.[Name] AS [Agent],
    MJAIAgentRuns_ParentRunID.[RunName] AS [ParentRun],
    MJConversations_ConversationID.[Name] AS [Conversation],
    MJUsers_UserID.[Name] AS [User],
    MJConversationDetails_ConversationDetailID.[Message] AS [ConversationDetail],
    MJAIAgentRuns_LastRunID.[RunName] AS [LastRun],
    MJAIConfigurations_ConfigurationID.[Name] AS [Configuration],
    MJAIModels_OverrideModelID.[Name] AS [OverrideModel],
    MJAIVendors_OverrideVendorID.[Name] AS [OverrideVendor],
    MJScheduledJobRuns_ScheduledJobRunID.[ScheduledJob] AS [ScheduledJobRun],
    MJTestRuns_TestRunID.[Test] AS [TestRun],
    MJEntities_PrimaryScopeEntityID.[Name] AS [PrimaryScopeEntity],
    root_ParentRunID.RootID AS [RootParentRunID],
    root_LastRunID.RootID AS [RootLastRunID]
FROM
    [${flyway:defaultSchema}].[AIAgentRun] AS m
INNER JOIN
    [${flyway:defaultSchema}].[AIAgent] AS MJAIAgents_AgentID
  ON
    [m].[AgentID] = MJAIAgents_AgentID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[AIAgentRun] AS MJAIAgentRuns_ParentRunID
  ON
    [m].[ParentRunID] = MJAIAgentRuns_ParentRunID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[Conversation] AS MJConversations_ConversationID
  ON
    [m].[ConversationID] = MJConversations_ConversationID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_UserID
  ON
    [m].[UserID] = MJUsers_UserID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[ConversationDetail] AS MJConversationDetails_ConversationDetailID
  ON
    [m].[ConversationDetailID] = MJConversationDetails_ConversationDetailID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[AIAgentRun] AS MJAIAgentRuns_LastRunID
  ON
    [m].[LastRunID] = MJAIAgentRuns_LastRunID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[AIConfiguration] AS MJAIConfigurations_ConfigurationID
  ON
    [m].[ConfigurationID] = MJAIConfigurations_ConfigurationID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[AIModel] AS MJAIModels_OverrideModelID
  ON
    [m].[OverrideModelID] = MJAIModels_OverrideModelID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[AIVendor] AS MJAIVendors_OverrideVendorID
  ON
    [m].[OverrideVendorID] = MJAIVendors_OverrideVendorID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[vwScheduledJobRuns] AS MJScheduledJobRuns_ScheduledJobRunID
  ON
    [m].[ScheduledJobRunID] = MJScheduledJobRuns_ScheduledJobRunID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[vwTestRuns] AS MJTestRuns_TestRunID
  ON
    [m].[TestRunID] = MJTestRuns_TestRunID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[Entity] AS MJEntities_PrimaryScopeEntityID
  ON
    [m].[PrimaryScopeEntityID] = MJEntities_PrimaryScopeEntityID.[ID]
OUTER APPLY
    [${flyway:defaultSchema}].[fnAIAgentRunParentRunID_GetRootID]([m].[ID], [m].[ParentRunID]) AS root_ParentRunID
OUTER APPLY
    [${flyway:defaultSchema}].[fnAIAgentRunLastRunID_GetRootID]([m].[ID], [m].[LastRunID]) AS root_LastRunID
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwAIAgentRuns] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: AI Agent Runs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Runs
-- Item: Permissions for vwAIAgentRuns
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwAIAgentRuns] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: AI Agent Runs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Runs
-- Item: spCreateMJAIAgentRun
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR AIAgentRun
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJAIAgentRun]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIAgentRun];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIAgentRun]
    @ID uniqueidentifier = NULL,
    @AgentID uniqueidentifier,
    @ParentRunID uniqueidentifier,
    @Status nvarchar(50) = NULL,
    @StartedAt datetimeoffset = NULL,
    @CompletedAt datetimeoffset,
    @Success bit,
    @ErrorMessage nvarchar(MAX),
    @ConversationID uniqueidentifier,
    @UserID uniqueidentifier,
    @Result nvarchar(MAX),
    @AgentState nvarchar(MAX),
    @TotalTokensUsed int,
    @TotalCost decimal(18, 6),
    @TotalPromptTokensUsed int,
    @TotalCompletionTokensUsed int,
    @TotalTokensUsedRollup int,
    @TotalPromptTokensUsedRollup int,
    @TotalCompletionTokensUsedRollup int,
    @TotalCostRollup decimal(19, 8),
    @ConversationDetailID uniqueidentifier,
    @ConversationDetailSequence int,
    @CancellationReason nvarchar(30),
    @FinalStep nvarchar(30),
    @FinalPayload nvarchar(MAX),
    @Message nvarchar(MAX),
    @LastRunID uniqueidentifier,
    @StartingPayload nvarchar(MAX),
    @TotalPromptIterations int = NULL,
    @ConfigurationID uniqueidentifier,
    @OverrideModelID uniqueidentifier,
    @OverrideVendorID uniqueidentifier,
    @Data nvarchar(MAX),
    @Verbose bit,
    @EffortLevel int,
    @RunName nvarchar(255),
    @Comments nvarchar(MAX),
    @ScheduledJobRunID uniqueidentifier,
    @TestRunID uniqueidentifier,
    @PrimaryScopeEntityID uniqueidentifier,
    @PrimaryScopeRecordID nvarchar(100),
    @SecondaryScopes nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[AIAgentRun]
            (
                [ID],
                [AgentID],
                [ParentRunID],
                [Status],
                [StartedAt],
                [CompletedAt],
                [Success],
                [ErrorMessage],
                [ConversationID],
                [UserID],
                [Result],
                [AgentState],
                [TotalTokensUsed],
                [TotalCost],
                [TotalPromptTokensUsed],
                [TotalCompletionTokensUsed],
                [TotalTokensUsedRollup],
                [TotalPromptTokensUsedRollup],
                [TotalCompletionTokensUsedRollup],
                [TotalCostRollup],
                [ConversationDetailID],
                [ConversationDetailSequence],
                [CancellationReason],
                [FinalStep],
                [FinalPayload],
                [Message],
                [LastRunID],
                [StartingPayload],
                [TotalPromptIterations],
                [ConfigurationID],
                [OverrideModelID],
                [OverrideVendorID],
                [Data],
                [Verbose],
                [EffortLevel],
                [RunName],
                [Comments],
                [ScheduledJobRunID],
                [TestRunID],
                [PrimaryScopeEntityID],
                [PrimaryScopeRecordID],
                [SecondaryScopes]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @AgentID,
                @ParentRunID,
                ISNULL(@Status, 'Running'),
                ISNULL(@StartedAt, sysdatetimeoffset()),
                @CompletedAt,
                @Success,
                @ErrorMessage,
                @ConversationID,
                @UserID,
                @Result,
                @AgentState,
                @TotalTokensUsed,
                @TotalCost,
                @TotalPromptTokensUsed,
                @TotalCompletionTokensUsed,
                @TotalTokensUsedRollup,
                @TotalPromptTokensUsedRollup,
                @TotalCompletionTokensUsedRollup,
                @TotalCostRollup,
                @ConversationDetailID,
                @ConversationDetailSequence,
                @CancellationReason,
                @FinalStep,
                @FinalPayload,
                @Message,
                @LastRunID,
                @StartingPayload,
                ISNULL(@TotalPromptIterations, 0),
                @ConfigurationID,
                @OverrideModelID,
                @OverrideVendorID,
                @Data,
                @Verbose,
                @EffortLevel,
                @RunName,
                @Comments,
                @ScheduledJobRunID,
                @TestRunID,
                @PrimaryScopeEntityID,
                @PrimaryScopeRecordID,
                @SecondaryScopes
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[AIAgentRun]
            (
                [AgentID],
                [ParentRunID],
                [Status],
                [StartedAt],
                [CompletedAt],
                [Success],
                [ErrorMessage],
                [ConversationID],
                [UserID],
                [Result],
                [AgentState],
                [TotalTokensUsed],
                [TotalCost],
                [TotalPromptTokensUsed],
                [TotalCompletionTokensUsed],
                [TotalTokensUsedRollup],
                [TotalPromptTokensUsedRollup],
                [TotalCompletionTokensUsedRollup],
                [TotalCostRollup],
                [ConversationDetailID],
                [ConversationDetailSequence],
                [CancellationReason],
                [FinalStep],
                [FinalPayload],
                [Message],
                [LastRunID],
                [StartingPayload],
                [TotalPromptIterations],
                [ConfigurationID],
                [OverrideModelID],
                [OverrideVendorID],
                [Data],
                [Verbose],
                [EffortLevel],
                [RunName],
                [Comments],
                [ScheduledJobRunID],
                [TestRunID],
                [PrimaryScopeEntityID],
                [PrimaryScopeRecordID],
                [SecondaryScopes]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @AgentID,
                @ParentRunID,
                ISNULL(@Status, 'Running'),
                ISNULL(@StartedAt, sysdatetimeoffset()),
                @CompletedAt,
                @Success,
                @ErrorMessage,
                @ConversationID,
                @UserID,
                @Result,
                @AgentState,
                @TotalTokensUsed,
                @TotalCost,
                @TotalPromptTokensUsed,
                @TotalCompletionTokensUsed,
                @TotalTokensUsedRollup,
                @TotalPromptTokensUsedRollup,
                @TotalCompletionTokensUsedRollup,
                @TotalCostRollup,
                @ConversationDetailID,
                @ConversationDetailSequence,
                @CancellationReason,
                @FinalStep,
                @FinalPayload,
                @Message,
                @LastRunID,
                @StartingPayload,
                ISNULL(@TotalPromptIterations, 0),
                @ConfigurationID,
                @OverrideModelID,
                @OverrideVendorID,
                @Data,
                @Verbose,
                @EffortLevel,
                @RunName,
                @Comments,
                @ScheduledJobRunID,
                @TestRunID,
                @PrimaryScopeEntityID,
                @PrimaryScopeRecordID,
                @SecondaryScopes
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwAIAgentRuns] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIAgentRun] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: AI Agent Runs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIAgentRun] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: AI Agent Runs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Runs
-- Item: spUpdateMJAIAgentRun
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR AIAgentRun
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJAIAgentRun]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIAgentRun];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIAgentRun]
    @ID uniqueidentifier,
    @AgentID uniqueidentifier,
    @ParentRunID uniqueidentifier,
    @Status nvarchar(50),
    @StartedAt datetimeoffset,
    @CompletedAt datetimeoffset,
    @Success bit,
    @ErrorMessage nvarchar(MAX),
    @ConversationID uniqueidentifier,
    @UserID uniqueidentifier,
    @Result nvarchar(MAX),
    @AgentState nvarchar(MAX),
    @TotalTokensUsed int,
    @TotalCost decimal(18, 6),
    @TotalPromptTokensUsed int,
    @TotalCompletionTokensUsed int,
    @TotalTokensUsedRollup int,
    @TotalPromptTokensUsedRollup int,
    @TotalCompletionTokensUsedRollup int,
    @TotalCostRollup decimal(19, 8),
    @ConversationDetailID uniqueidentifier,
    @ConversationDetailSequence int,
    @CancellationReason nvarchar(30),
    @FinalStep nvarchar(30),
    @FinalPayload nvarchar(MAX),
    @Message nvarchar(MAX),
    @LastRunID uniqueidentifier,
    @StartingPayload nvarchar(MAX),
    @TotalPromptIterations int,
    @ConfigurationID uniqueidentifier,
    @OverrideModelID uniqueidentifier,
    @OverrideVendorID uniqueidentifier,
    @Data nvarchar(MAX),
    @Verbose bit,
    @EffortLevel int,
    @RunName nvarchar(255),
    @Comments nvarchar(MAX),
    @ScheduledJobRunID uniqueidentifier,
    @TestRunID uniqueidentifier,
    @PrimaryScopeEntityID uniqueidentifier,
    @PrimaryScopeRecordID nvarchar(100),
    @SecondaryScopes nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIAgentRun]
    SET
        [AgentID] = @AgentID,
        [ParentRunID] = @ParentRunID,
        [Status] = @Status,
        [StartedAt] = @StartedAt,
        [CompletedAt] = @CompletedAt,
        [Success] = @Success,
        [ErrorMessage] = @ErrorMessage,
        [ConversationID] = @ConversationID,
        [UserID] = @UserID,
        [Result] = @Result,
        [AgentState] = @AgentState,
        [TotalTokensUsed] = @TotalTokensUsed,
        [TotalCost] = @TotalCost,
        [TotalPromptTokensUsed] = @TotalPromptTokensUsed,
        [TotalCompletionTokensUsed] = @TotalCompletionTokensUsed,
        [TotalTokensUsedRollup] = @TotalTokensUsedRollup,
        [TotalPromptTokensUsedRollup] = @TotalPromptTokensUsedRollup,
        [TotalCompletionTokensUsedRollup] = @TotalCompletionTokensUsedRollup,
        [TotalCostRollup] = @TotalCostRollup,
        [ConversationDetailID] = @ConversationDetailID,
        [ConversationDetailSequence] = @ConversationDetailSequence,
        [CancellationReason] = @CancellationReason,
        [FinalStep] = @FinalStep,
        [FinalPayload] = @FinalPayload,
        [Message] = @Message,
        [LastRunID] = @LastRunID,
        [StartingPayload] = @StartingPayload,
        [TotalPromptIterations] = @TotalPromptIterations,
        [ConfigurationID] = @ConfigurationID,
        [OverrideModelID] = @OverrideModelID,
        [OverrideVendorID] = @OverrideVendorID,
        [Data] = @Data,
        [Verbose] = @Verbose,
        [EffortLevel] = @EffortLevel,
        [RunName] = @RunName,
        [Comments] = @Comments,
        [ScheduledJobRunID] = @ScheduledJobRunID,
        [TestRunID] = @TestRunID,
        [PrimaryScopeEntityID] = @PrimaryScopeEntityID,
        [PrimaryScopeRecordID] = @PrimaryScopeRecordID,
        [SecondaryScopes] = @SecondaryScopes
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwAIAgentRuns] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwAIAgentRuns]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIAgentRun] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the AIAgentRun table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJAIAgentRun]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJAIAgentRun];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJAIAgentRun
ON [${flyway:defaultSchema}].[AIAgentRun]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIAgentRun]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[AIAgentRun] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: AI Agent Runs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIAgentRun] TO [cdp_Developer], [cdp_Integration]



/* Base View SQL for MJ: AI Agent Run Steps */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Run Steps
-- Item: vwAIAgentRunSteps
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: AI Agent Run Steps
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  AIAgentRunStep
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwAIAgentRunSteps]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwAIAgentRunSteps];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwAIAgentRunSteps]
AS
SELECT
    m.*,
    MJAIAgentRuns_AgentRunID.[RunName] AS [AgentRun],
    MJAIAgentRunSteps_ParentID.[StepName] AS [Parent],
    root_ParentID.RootID AS [RootParentID]
FROM
    [${flyway:defaultSchema}].[AIAgentRunStep] AS m
INNER JOIN
    [${flyway:defaultSchema}].[AIAgentRun] AS MJAIAgentRuns_AgentRunID
  ON
    [m].[AgentRunID] = MJAIAgentRuns_AgentRunID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[AIAgentRunStep] AS MJAIAgentRunSteps_ParentID
  ON
    [m].[ParentID] = MJAIAgentRunSteps_ParentID.[ID]
OUTER APPLY
    [${flyway:defaultSchema}].[fnAIAgentRunStepParentID_GetRootID]([m].[ID], [m].[ParentID]) AS root_ParentID
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwAIAgentRunSteps] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: AI Agent Run Steps */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Run Steps
-- Item: Permissions for vwAIAgentRunSteps
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwAIAgentRunSteps] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: AI Agent Run Steps */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Run Steps
-- Item: spCreateMJAIAgentRunStep
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR AIAgentRunStep
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJAIAgentRunStep]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIAgentRunStep];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIAgentRunStep]
    @ID uniqueidentifier = NULL,
    @AgentRunID uniqueidentifier,
    @StepNumber int,
    @StepType nvarchar(50) = NULL,
    @StepName nvarchar(255),
    @TargetID uniqueidentifier,
    @Status nvarchar(50) = NULL,
    @StartedAt datetimeoffset = NULL,
    @CompletedAt datetimeoffset,
    @Success bit,
    @ErrorMessage nvarchar(MAX),
    @InputData nvarchar(MAX),
    @OutputData nvarchar(MAX),
    @TargetLogID uniqueidentifier,
    @PayloadAtStart nvarchar(MAX),
    @PayloadAtEnd nvarchar(MAX),
    @FinalPayloadValidationResult nvarchar(25),
    @FinalPayloadValidationMessages nvarchar(MAX),
    @ParentID uniqueidentifier,
    @Comments nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[AIAgentRunStep]
            (
                [ID],
                [AgentRunID],
                [StepNumber],
                [StepType],
                [StepName],
                [TargetID],
                [Status],
                [StartedAt],
                [CompletedAt],
                [Success],
                [ErrorMessage],
                [InputData],
                [OutputData],
                [TargetLogID],
                [PayloadAtStart],
                [PayloadAtEnd],
                [FinalPayloadValidationResult],
                [FinalPayloadValidationMessages],
                [ParentID],
                [Comments]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @AgentRunID,
                @StepNumber,
                ISNULL(@StepType, 'Prompt'),
                @StepName,
                @TargetID,
                ISNULL(@Status, 'Running'),
                ISNULL(@StartedAt, sysdatetimeoffset()),
                @CompletedAt,
                @Success,
                @ErrorMessage,
                @InputData,
                @OutputData,
                @TargetLogID,
                @PayloadAtStart,
                @PayloadAtEnd,
                @FinalPayloadValidationResult,
                @FinalPayloadValidationMessages,
                @ParentID,
                @Comments
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[AIAgentRunStep]
            (
                [AgentRunID],
                [StepNumber],
                [StepType],
                [StepName],
                [TargetID],
                [Status],
                [StartedAt],
                [CompletedAt],
                [Success],
                [ErrorMessage],
                [InputData],
                [OutputData],
                [TargetLogID],
                [PayloadAtStart],
                [PayloadAtEnd],
                [FinalPayloadValidationResult],
                [FinalPayloadValidationMessages],
                [ParentID],
                [Comments]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @AgentRunID,
                @StepNumber,
                ISNULL(@StepType, 'Prompt'),
                @StepName,
                @TargetID,
                ISNULL(@Status, 'Running'),
                ISNULL(@StartedAt, sysdatetimeoffset()),
                @CompletedAt,
                @Success,
                @ErrorMessage,
                @InputData,
                @OutputData,
                @TargetLogID,
                @PayloadAtStart,
                @PayloadAtEnd,
                @FinalPayloadValidationResult,
                @FinalPayloadValidationMessages,
                @ParentID,
                @Comments
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwAIAgentRunSteps] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIAgentRunStep] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: AI Agent Run Steps */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIAgentRunStep] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: AI Agent Run Steps */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Run Steps
-- Item: spUpdateMJAIAgentRunStep
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR AIAgentRunStep
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJAIAgentRunStep]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIAgentRunStep];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIAgentRunStep]
    @ID uniqueidentifier,
    @AgentRunID uniqueidentifier,
    @StepNumber int,
    @StepType nvarchar(50),
    @StepName nvarchar(255),
    @TargetID uniqueidentifier,
    @Status nvarchar(50),
    @StartedAt datetimeoffset,
    @CompletedAt datetimeoffset,
    @Success bit,
    @ErrorMessage nvarchar(MAX),
    @InputData nvarchar(MAX),
    @OutputData nvarchar(MAX),
    @TargetLogID uniqueidentifier,
    @PayloadAtStart nvarchar(MAX),
    @PayloadAtEnd nvarchar(MAX),
    @FinalPayloadValidationResult nvarchar(25),
    @FinalPayloadValidationMessages nvarchar(MAX),
    @ParentID uniqueidentifier,
    @Comments nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIAgentRunStep]
    SET
        [AgentRunID] = @AgentRunID,
        [StepNumber] = @StepNumber,
        [StepType] = @StepType,
        [StepName] = @StepName,
        [TargetID] = @TargetID,
        [Status] = @Status,
        [StartedAt] = @StartedAt,
        [CompletedAt] = @CompletedAt,
        [Success] = @Success,
        [ErrorMessage] = @ErrorMessage,
        [InputData] = @InputData,
        [OutputData] = @OutputData,
        [TargetLogID] = @TargetLogID,
        [PayloadAtStart] = @PayloadAtStart,
        [PayloadAtEnd] = @PayloadAtEnd,
        [FinalPayloadValidationResult] = @FinalPayloadValidationResult,
        [FinalPayloadValidationMessages] = @FinalPayloadValidationMessages,
        [ParentID] = @ParentID,
        [Comments] = @Comments
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwAIAgentRunSteps] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwAIAgentRunSteps]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIAgentRunStep] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the AIAgentRunStep table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJAIAgentRunStep]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJAIAgentRunStep];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJAIAgentRunStep
ON [${flyway:defaultSchema}].[AIAgentRunStep]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIAgentRunStep]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[AIAgentRunStep] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: AI Agent Run Steps */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIAgentRunStep] TO [cdp_Developer], [cdp_Integration]



/* Base View SQL for MJ: AI Agent Steps */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Steps
-- Item: vwAIAgentSteps
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: AI Agent Steps
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  AIAgentStep
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwAIAgentSteps]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwAIAgentSteps];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwAIAgentSteps]
AS
SELECT
    m.*,
    MJAIAgents_AgentID.[Name] AS [Agent],
    MJActions_ActionID.[Name] AS [Action],
    MJAIAgents_SubAgentID.[Name] AS [SubAgent],
    MJAIPrompts_PromptID.[Name] AS [Prompt]
FROM
    [${flyway:defaultSchema}].[AIAgentStep] AS m
INNER JOIN
    [${flyway:defaultSchema}].[AIAgent] AS MJAIAgents_AgentID
  ON
    [m].[AgentID] = MJAIAgents_AgentID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[Action] AS MJActions_ActionID
  ON
    [m].[ActionID] = MJActions_ActionID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[AIAgent] AS MJAIAgents_SubAgentID
  ON
    [m].[SubAgentID] = MJAIAgents_SubAgentID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[AIPrompt] AS MJAIPrompts_PromptID
  ON
    [m].[PromptID] = MJAIPrompts_PromptID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwAIAgentSteps] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: AI Agent Steps */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Steps
-- Item: Permissions for vwAIAgentSteps
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwAIAgentSteps] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: AI Agent Steps */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Steps
-- Item: spCreateMJAIAgentStep
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR AIAgentStep
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJAIAgentStep]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIAgentStep];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIAgentStep]
    @ID uniqueidentifier = NULL,
    @AgentID uniqueidentifier,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @StepType nvarchar(20),
    @StartingStep bit = NULL,
    @TimeoutSeconds int,
    @RetryCount int = NULL,
    @OnErrorBehavior nvarchar(20) = NULL,
    @ActionID uniqueidentifier,
    @SubAgentID uniqueidentifier,
    @PromptID uniqueidentifier,
    @ActionOutputMapping nvarchar(MAX),
    @PositionX int = NULL,
    @PositionY int = NULL,
    @Width int = NULL,
    @Height int = NULL,
    @Status nvarchar(20) = NULL,
    @ActionInputMapping nvarchar(MAX),
    @LoopBodyType nvarchar(50),
    @Configuration nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[AIAgentStep]
            (
                [ID],
                [AgentID],
                [Name],
                [Description],
                [StepType],
                [StartingStep],
                [TimeoutSeconds],
                [RetryCount],
                [OnErrorBehavior],
                [ActionID],
                [SubAgentID],
                [PromptID],
                [ActionOutputMapping],
                [PositionX],
                [PositionY],
                [Width],
                [Height],
                [Status],
                [ActionInputMapping],
                [LoopBodyType],
                [Configuration]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @AgentID,
                @Name,
                @Description,
                @StepType,
                ISNULL(@StartingStep, 0),
                @TimeoutSeconds,
                ISNULL(@RetryCount, 0),
                ISNULL(@OnErrorBehavior, 'fail'),
                @ActionID,
                @SubAgentID,
                @PromptID,
                @ActionOutputMapping,
                ISNULL(@PositionX, 0),
                ISNULL(@PositionY, 0),
                ISNULL(@Width, 200),
                ISNULL(@Height, 80),
                ISNULL(@Status, 'Active'),
                @ActionInputMapping,
                @LoopBodyType,
                @Configuration
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[AIAgentStep]
            (
                [AgentID],
                [Name],
                [Description],
                [StepType],
                [StartingStep],
                [TimeoutSeconds],
                [RetryCount],
                [OnErrorBehavior],
                [ActionID],
                [SubAgentID],
                [PromptID],
                [ActionOutputMapping],
                [PositionX],
                [PositionY],
                [Width],
                [Height],
                [Status],
                [ActionInputMapping],
                [LoopBodyType],
                [Configuration]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @AgentID,
                @Name,
                @Description,
                @StepType,
                ISNULL(@StartingStep, 0),
                @TimeoutSeconds,
                ISNULL(@RetryCount, 0),
                ISNULL(@OnErrorBehavior, 'fail'),
                @ActionID,
                @SubAgentID,
                @PromptID,
                @ActionOutputMapping,
                ISNULL(@PositionX, 0),
                ISNULL(@PositionY, 0),
                ISNULL(@Width, 200),
                ISNULL(@Height, 80),
                ISNULL(@Status, 'Active'),
                @ActionInputMapping,
                @LoopBodyType,
                @Configuration
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwAIAgentSteps] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIAgentStep] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: AI Agent Steps */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIAgentStep] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: AI Agent Steps */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Steps
-- Item: spUpdateMJAIAgentStep
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR AIAgentStep
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJAIAgentStep]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIAgentStep];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIAgentStep]
    @ID uniqueidentifier,
    @AgentID uniqueidentifier,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @StepType nvarchar(20),
    @StartingStep bit,
    @TimeoutSeconds int,
    @RetryCount int,
    @OnErrorBehavior nvarchar(20),
    @ActionID uniqueidentifier,
    @SubAgentID uniqueidentifier,
    @PromptID uniqueidentifier,
    @ActionOutputMapping nvarchar(MAX),
    @PositionX int,
    @PositionY int,
    @Width int,
    @Height int,
    @Status nvarchar(20),
    @ActionInputMapping nvarchar(MAX),
    @LoopBodyType nvarchar(50),
    @Configuration nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIAgentStep]
    SET
        [AgentID] = @AgentID,
        [Name] = @Name,
        [Description] = @Description,
        [StepType] = @StepType,
        [StartingStep] = @StartingStep,
        [TimeoutSeconds] = @TimeoutSeconds,
        [RetryCount] = @RetryCount,
        [OnErrorBehavior] = @OnErrorBehavior,
        [ActionID] = @ActionID,
        [SubAgentID] = @SubAgentID,
        [PromptID] = @PromptID,
        [ActionOutputMapping] = @ActionOutputMapping,
        [PositionX] = @PositionX,
        [PositionY] = @PositionY,
        [Width] = @Width,
        [Height] = @Height,
        [Status] = @Status,
        [ActionInputMapping] = @ActionInputMapping,
        [LoopBodyType] = @LoopBodyType,
        [Configuration] = @Configuration
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwAIAgentSteps] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwAIAgentSteps]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIAgentStep] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the AIAgentStep table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJAIAgentStep]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJAIAgentStep];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJAIAgentStep
ON [${flyway:defaultSchema}].[AIAgentStep]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIAgentStep]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[AIAgentStep] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: AI Agent Steps */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIAgentStep] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: AI Agent Steps */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Steps
-- Item: spDeleteMJAIAgentStep
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR AIAgentStep
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJAIAgentStep]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIAgentStep];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIAgentStep]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    -- Cascade delete from AIAgentStepPath using cursor to call spDeleteMJAIAgentStepPath
    DECLARE @false_OriginStepIDID uniqueidentifier
    DECLARE cascade_delete_false_OriginStepID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[AIAgentStepPath]
        WHERE [OriginStepID] = @ID
    
    OPEN cascade_delete_false_OriginStepID_cursor
    FETCH NEXT FROM cascade_delete_false_OriginStepID_cursor INTO @false_OriginStepIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteMJAIAgentStepPath] @ID = @false_OriginStepIDID
        
        FETCH NEXT FROM cascade_delete_false_OriginStepID_cursor INTO @false_OriginStepIDID
    END
    
    CLOSE cascade_delete_false_OriginStepID_cursor
    DEALLOCATE cascade_delete_false_OriginStepID_cursor
    
    -- Cascade delete from AIAgentStepPath using cursor to call spDeleteMJAIAgentStepPath
    DECLARE @false_DestinationStepIDID uniqueidentifier
    DECLARE cascade_delete_false_DestinationStepID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[AIAgentStepPath]
        WHERE [DestinationStepID] = @ID
    
    OPEN cascade_delete_false_DestinationStepID_cursor
    FETCH NEXT FROM cascade_delete_false_DestinationStepID_cursor INTO @false_DestinationStepIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteMJAIAgentStepPath] @ID = @false_DestinationStepIDID
        
        FETCH NEXT FROM cascade_delete_false_DestinationStepID_cursor INTO @false_DestinationStepIDID
    END
    
    CLOSE cascade_delete_false_DestinationStepID_cursor
    DEALLOCATE cascade_delete_false_DestinationStepID_cursor
    

    DELETE FROM
        [${flyway:defaultSchema}].[AIAgentStep]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIAgentStep] TO [cdp_Developer], [cdp_Integration]
    

/* spDelete Permissions for MJ: AI Agent Steps */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIAgentStep] TO [cdp_Developer], [cdp_Integration]



/* Base View SQL for MJ: AI Agent Step Paths */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Step Paths
-- Item: vwAIAgentStepPaths
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: AI Agent Step Paths
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  AIAgentStepPath
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwAIAgentStepPaths]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwAIAgentStepPaths];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwAIAgentStepPaths]
AS
SELECT
    m.*,
    MJAIAgentSteps_OriginStepID.[Name] AS [OriginStep],
    MJAIAgentSteps_DestinationStepID.[Name] AS [DestinationStep]
FROM
    [${flyway:defaultSchema}].[AIAgentStepPath] AS m
INNER JOIN
    [${flyway:defaultSchema}].[AIAgentStep] AS MJAIAgentSteps_OriginStepID
  ON
    [m].[OriginStepID] = MJAIAgentSteps_OriginStepID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[AIAgentStep] AS MJAIAgentSteps_DestinationStepID
  ON
    [m].[DestinationStepID] = MJAIAgentSteps_DestinationStepID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwAIAgentStepPaths] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: AI Agent Step Paths */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Step Paths
-- Item: Permissions for vwAIAgentStepPaths
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwAIAgentStepPaths] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: AI Agent Step Paths */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Step Paths
-- Item: spCreateMJAIAgentStepPath
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR AIAgentStepPath
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJAIAgentStepPath]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIAgentStepPath];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIAgentStepPath]
    @ID uniqueidentifier = NULL,
    @OriginStepID uniqueidentifier,
    @DestinationStepID uniqueidentifier,
    @Condition nvarchar(MAX),
    @Priority int = NULL,
    @Description nvarchar(255),
    @PathPoints nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[AIAgentStepPath]
            (
                [ID],
                [OriginStepID],
                [DestinationStepID],
                [Condition],
                [Priority],
                [Description],
                [PathPoints]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @OriginStepID,
                @DestinationStepID,
                @Condition,
                ISNULL(@Priority, 0),
                @Description,
                @PathPoints
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[AIAgentStepPath]
            (
                [OriginStepID],
                [DestinationStepID],
                [Condition],
                [Priority],
                [Description],
                [PathPoints]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @OriginStepID,
                @DestinationStepID,
                @Condition,
                ISNULL(@Priority, 0),
                @Description,
                @PathPoints
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwAIAgentStepPaths] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIAgentStepPath] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: AI Agent Step Paths */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIAgentStepPath] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: AI Agent Step Paths */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Step Paths
-- Item: spUpdateMJAIAgentStepPath
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR AIAgentStepPath
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJAIAgentStepPath]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIAgentStepPath];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIAgentStepPath]
    @ID uniqueidentifier,
    @OriginStepID uniqueidentifier,
    @DestinationStepID uniqueidentifier,
    @Condition nvarchar(MAX),
    @Priority int,
    @Description nvarchar(255),
    @PathPoints nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIAgentStepPath]
    SET
        [OriginStepID] = @OriginStepID,
        [DestinationStepID] = @DestinationStepID,
        [Condition] = @Condition,
        [Priority] = @Priority,
        [Description] = @Description,
        [PathPoints] = @PathPoints
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwAIAgentStepPaths] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwAIAgentStepPaths]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIAgentStepPath] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the AIAgentStepPath table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJAIAgentStepPath]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJAIAgentStepPath];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJAIAgentStepPath
ON [${flyway:defaultSchema}].[AIAgentStepPath]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIAgentStepPath]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[AIAgentStepPath] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: AI Agent Step Paths */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIAgentStepPath] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: AI Agent Step Paths */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Step Paths
-- Item: spDeleteMJAIAgentStepPath
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR AIAgentStepPath
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJAIAgentStepPath]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIAgentStepPath];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIAgentStepPath]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[AIAgentStepPath]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIAgentStepPath] TO [cdp_Developer], [cdp_Integration]
    

/* spDelete Permissions for MJ: AI Agent Step Paths */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIAgentStepPath] TO [cdp_Developer], [cdp_Integration]



/* Base View SQL for MJ: AI Agent Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Types
-- Item: vwAIAgentTypes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: AI Agent Types
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  AIAgentType
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwAIAgentTypes]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwAIAgentTypes];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwAIAgentTypes]
AS
SELECT
    m.*,
    MJAIPrompts_SystemPromptID.[Name] AS [SystemPrompt]
FROM
    [${flyway:defaultSchema}].[AIAgentType] AS m
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[AIPrompt] AS MJAIPrompts_SystemPromptID
  ON
    [m].[SystemPromptID] = MJAIPrompts_SystemPromptID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwAIAgentTypes] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: AI Agent Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Types
-- Item: Permissions for vwAIAgentTypes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwAIAgentTypes] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: AI Agent Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Types
-- Item: spCreateMJAIAgentType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR AIAgentType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJAIAgentType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIAgentType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIAgentType]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(100),
    @Description nvarchar(MAX),
    @SystemPromptID uniqueidentifier,
    @IsActive bit = NULL,
    @AgentPromptPlaceholder nvarchar(255),
    @DriverClass nvarchar(255),
    @UIFormSectionKey nvarchar(500),
    @UIFormKey nvarchar(500),
    @UIFormSectionExpandedByDefault bit = NULL,
    @PromptParamsSchema nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[AIAgentType]
            (
                [ID],
                [Name],
                [Description],
                [SystemPromptID],
                [IsActive],
                [AgentPromptPlaceholder],
                [DriverClass],
                [UIFormSectionKey],
                [UIFormKey],
                [UIFormSectionExpandedByDefault],
                [PromptParamsSchema]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description,
                @SystemPromptID,
                ISNULL(@IsActive, 1),
                @AgentPromptPlaceholder,
                @DriverClass,
                @UIFormSectionKey,
                @UIFormKey,
                ISNULL(@UIFormSectionExpandedByDefault, 1),
                @PromptParamsSchema
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[AIAgentType]
            (
                [Name],
                [Description],
                [SystemPromptID],
                [IsActive],
                [AgentPromptPlaceholder],
                [DriverClass],
                [UIFormSectionKey],
                [UIFormKey],
                [UIFormSectionExpandedByDefault],
                [PromptParamsSchema]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description,
                @SystemPromptID,
                ISNULL(@IsActive, 1),
                @AgentPromptPlaceholder,
                @DriverClass,
                @UIFormSectionKey,
                @UIFormKey,
                ISNULL(@UIFormSectionExpandedByDefault, 1),
                @PromptParamsSchema
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwAIAgentTypes] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIAgentType] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: AI Agent Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIAgentType] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: AI Agent Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Types
-- Item: spUpdateMJAIAgentType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR AIAgentType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJAIAgentType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIAgentType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIAgentType]
    @ID uniqueidentifier,
    @Name nvarchar(100),
    @Description nvarchar(MAX),
    @SystemPromptID uniqueidentifier,
    @IsActive bit,
    @AgentPromptPlaceholder nvarchar(255),
    @DriverClass nvarchar(255),
    @UIFormSectionKey nvarchar(500),
    @UIFormKey nvarchar(500),
    @UIFormSectionExpandedByDefault bit,
    @PromptParamsSchema nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIAgentType]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [SystemPromptID] = @SystemPromptID,
        [IsActive] = @IsActive,
        [AgentPromptPlaceholder] = @AgentPromptPlaceholder,
        [DriverClass] = @DriverClass,
        [UIFormSectionKey] = @UIFormSectionKey,
        [UIFormKey] = @UIFormKey,
        [UIFormSectionExpandedByDefault] = @UIFormSectionExpandedByDefault,
        [PromptParamsSchema] = @PromptParamsSchema
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwAIAgentTypes] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwAIAgentTypes]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIAgentType] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the AIAgentType table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJAIAgentType]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJAIAgentType];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJAIAgentType
ON [${flyway:defaultSchema}].[AIAgentType]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIAgentType]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[AIAgentType] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: AI Agent Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIAgentType] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: AI Agent Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Types
-- Item: spDeleteMJAIAgentType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR AIAgentType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJAIAgentType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIAgentType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIAgentType]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[AIAgentType]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIAgentType] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: AI Agent Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIAgentType] TO [cdp_Integration]



/* spDelete SQL for MJ: AI Agent Run Steps */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Run Steps
-- Item: spDeleteMJAIAgentRunStep
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR AIAgentRunStep
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJAIAgentRunStep]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIAgentRunStep];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIAgentRunStep]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    -- Cascade update on AIAgentRunStep using cursor to call spUpdateMJAIAgentRunStep
    DECLARE @false_ParentIDID uniqueidentifier
    DECLARE @false_ParentID_AgentRunID uniqueidentifier
    DECLARE @false_ParentID_StepNumber int
    DECLARE @false_ParentID_StepType nvarchar(50)
    DECLARE @false_ParentID_StepName nvarchar(255)
    DECLARE @false_ParentID_TargetID uniqueidentifier
    DECLARE @false_ParentID_Status nvarchar(50)
    DECLARE @false_ParentID_StartedAt datetimeoffset
    DECLARE @false_ParentID_CompletedAt datetimeoffset
    DECLARE @false_ParentID_Success bit
    DECLARE @false_ParentID_ErrorMessage nvarchar(MAX)
    DECLARE @false_ParentID_InputData nvarchar(MAX)
    DECLARE @false_ParentID_OutputData nvarchar(MAX)
    DECLARE @false_ParentID_TargetLogID uniqueidentifier
    DECLARE @false_ParentID_PayloadAtStart nvarchar(MAX)
    DECLARE @false_ParentID_PayloadAtEnd nvarchar(MAX)
    DECLARE @false_ParentID_FinalPayloadValidationResult nvarchar(25)
    DECLARE @false_ParentID_FinalPayloadValidationMessages nvarchar(MAX)
    DECLARE @false_ParentID_ParentID uniqueidentifier
    DECLARE @false_ParentID_Comments nvarchar(MAX)
    DECLARE cascade_update_false_ParentID_cursor CURSOR FOR
        SELECT [ID], [AgentRunID], [StepNumber], [StepType], [StepName], [TargetID], [Status], [StartedAt], [CompletedAt], [Success], [ErrorMessage], [InputData], [OutputData], [TargetLogID], [PayloadAtStart], [PayloadAtEnd], [FinalPayloadValidationResult], [FinalPayloadValidationMessages], [ParentID], [Comments]
        FROM [${flyway:defaultSchema}].[AIAgentRunStep]
        WHERE [ParentID] = @ID

    OPEN cascade_update_false_ParentID_cursor
    FETCH NEXT FROM cascade_update_false_ParentID_cursor INTO @false_ParentIDID, @false_ParentID_AgentRunID, @false_ParentID_StepNumber, @false_ParentID_StepType, @false_ParentID_StepName, @false_ParentID_TargetID, @false_ParentID_Status, @false_ParentID_StartedAt, @false_ParentID_CompletedAt, @false_ParentID_Success, @false_ParentID_ErrorMessage, @false_ParentID_InputData, @false_ParentID_OutputData, @false_ParentID_TargetLogID, @false_ParentID_PayloadAtStart, @false_ParentID_PayloadAtEnd, @false_ParentID_FinalPayloadValidationResult, @false_ParentID_FinalPayloadValidationMessages, @false_ParentID_ParentID, @false_ParentID_Comments

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @false_ParentID_ParentID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateMJAIAgentRunStep] @ID = @false_ParentIDID, @AgentRunID = @false_ParentID_AgentRunID, @StepNumber = @false_ParentID_StepNumber, @StepType = @false_ParentID_StepType, @StepName = @false_ParentID_StepName, @TargetID = @false_ParentID_TargetID, @Status = @false_ParentID_Status, @StartedAt = @false_ParentID_StartedAt, @CompletedAt = @false_ParentID_CompletedAt, @Success = @false_ParentID_Success, @ErrorMessage = @false_ParentID_ErrorMessage, @InputData = @false_ParentID_InputData, @OutputData = @false_ParentID_OutputData, @TargetLogID = @false_ParentID_TargetLogID, @PayloadAtStart = @false_ParentID_PayloadAtStart, @PayloadAtEnd = @false_ParentID_PayloadAtEnd, @FinalPayloadValidationResult = @false_ParentID_FinalPayloadValidationResult, @FinalPayloadValidationMessages = @false_ParentID_FinalPayloadValidationMessages, @ParentID = @false_ParentID_ParentID, @Comments = @false_ParentID_Comments

        FETCH NEXT FROM cascade_update_false_ParentID_cursor INTO @false_ParentIDID, @false_ParentID_AgentRunID, @false_ParentID_StepNumber, @false_ParentID_StepType, @false_ParentID_StepName, @false_ParentID_TargetID, @false_ParentID_Status, @false_ParentID_StartedAt, @false_ParentID_CompletedAt, @false_ParentID_Success, @false_ParentID_ErrorMessage, @false_ParentID_InputData, @false_ParentID_OutputData, @false_ParentID_TargetLogID, @false_ParentID_PayloadAtStart, @false_ParentID_PayloadAtEnd, @false_ParentID_FinalPayloadValidationResult, @false_ParentID_FinalPayloadValidationMessages, @false_ParentID_ParentID, @false_ParentID_Comments
    END

    CLOSE cascade_update_false_ParentID_cursor
    DEALLOCATE cascade_update_false_ParentID_cursor
    

    DELETE FROM
        [${flyway:defaultSchema}].[AIAgentRunStep]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIAgentRunStep] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: AI Agent Run Steps */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIAgentRunStep] TO [cdp_Integration]



/* spDelete SQL for MJ: AI Agent Runs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agent Runs
-- Item: spDeleteMJAIAgentRun
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR AIAgentRun
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJAIAgentRun]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIAgentRun];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIAgentRun]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    -- Cascade update on AIAgentExample using cursor to call spUpdateMJAIAgentExample
    DECLARE @false_SourceAIAgentRunIDID uniqueidentifier
    DECLARE @false_SourceAIAgentRunID_AgentID uniqueidentifier
    DECLARE @false_SourceAIAgentRunID_UserID uniqueidentifier
    DECLARE @false_SourceAIAgentRunID_CompanyID uniqueidentifier
    DECLARE @false_SourceAIAgentRunID_Type nvarchar(20)
    DECLARE @false_SourceAIAgentRunID_ExampleInput nvarchar(MAX)
    DECLARE @false_SourceAIAgentRunID_ExampleOutput nvarchar(MAX)
    DECLARE @false_SourceAIAgentRunID_IsAutoGenerated bit
    DECLARE @false_SourceAIAgentRunID_SourceConversationID uniqueidentifier
    DECLARE @false_SourceAIAgentRunID_SourceConversationDetailID uniqueidentifier
    DECLARE @false_SourceAIAgentRunID_SourceAIAgentRunID uniqueidentifier
    DECLARE @false_SourceAIAgentRunID_SuccessScore decimal(5, 2)
    DECLARE @false_SourceAIAgentRunID_Comments nvarchar(MAX)
    DECLARE @false_SourceAIAgentRunID_Status nvarchar(20)
    DECLARE @false_SourceAIAgentRunID_EmbeddingVector nvarchar(MAX)
    DECLARE @false_SourceAIAgentRunID_EmbeddingModelID uniqueidentifier
    DECLARE @false_SourceAIAgentRunID_PrimaryScopeEntityID uniqueidentifier
    DECLARE @false_SourceAIAgentRunID_PrimaryScopeRecordID nvarchar(100)
    DECLARE @false_SourceAIAgentRunID_SecondaryScopes nvarchar(MAX)
    DECLARE @false_SourceAIAgentRunID_LastAccessedAt datetimeoffset
    DECLARE @false_SourceAIAgentRunID_AccessCount int
    DECLARE @false_SourceAIAgentRunID_ExpiresAt datetimeoffset
    DECLARE cascade_update_false_SourceAIAgentRunID_cursor CURSOR FOR
        SELECT [ID], [AgentID], [UserID], [CompanyID], [Type], [ExampleInput], [ExampleOutput], [IsAutoGenerated], [SourceConversationID], [SourceConversationDetailID], [SourceAIAgentRunID], [SuccessScore], [Comments], [Status], [EmbeddingVector], [EmbeddingModelID], [PrimaryScopeEntityID], [PrimaryScopeRecordID], [SecondaryScopes], [LastAccessedAt], [AccessCount], [ExpiresAt]
        FROM [${flyway:defaultSchema}].[AIAgentExample]
        WHERE [SourceAIAgentRunID] = @ID

    OPEN cascade_update_false_SourceAIAgentRunID_cursor
    FETCH NEXT FROM cascade_update_false_SourceAIAgentRunID_cursor INTO @false_SourceAIAgentRunIDID, @false_SourceAIAgentRunID_AgentID, @false_SourceAIAgentRunID_UserID, @false_SourceAIAgentRunID_CompanyID, @false_SourceAIAgentRunID_Type, @false_SourceAIAgentRunID_ExampleInput, @false_SourceAIAgentRunID_ExampleOutput, @false_SourceAIAgentRunID_IsAutoGenerated, @false_SourceAIAgentRunID_SourceConversationID, @false_SourceAIAgentRunID_SourceConversationDetailID, @false_SourceAIAgentRunID_SourceAIAgentRunID, @false_SourceAIAgentRunID_SuccessScore, @false_SourceAIAgentRunID_Comments, @false_SourceAIAgentRunID_Status, @false_SourceAIAgentRunID_EmbeddingVector, @false_SourceAIAgentRunID_EmbeddingModelID, @false_SourceAIAgentRunID_PrimaryScopeEntityID, @false_SourceAIAgentRunID_PrimaryScopeRecordID, @false_SourceAIAgentRunID_SecondaryScopes, @false_SourceAIAgentRunID_LastAccessedAt, @false_SourceAIAgentRunID_AccessCount, @false_SourceAIAgentRunID_ExpiresAt

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @false_SourceAIAgentRunID_SourceAIAgentRunID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateMJAIAgentExample] @ID = @false_SourceAIAgentRunIDID, @AgentID = @false_SourceAIAgentRunID_AgentID, @UserID = @false_SourceAIAgentRunID_UserID, @CompanyID = @false_SourceAIAgentRunID_CompanyID, @Type = @false_SourceAIAgentRunID_Type, @ExampleInput = @false_SourceAIAgentRunID_ExampleInput, @ExampleOutput = @false_SourceAIAgentRunID_ExampleOutput, @IsAutoGenerated = @false_SourceAIAgentRunID_IsAutoGenerated, @SourceConversationID = @false_SourceAIAgentRunID_SourceConversationID, @SourceConversationDetailID = @false_SourceAIAgentRunID_SourceConversationDetailID, @SourceAIAgentRunID = @false_SourceAIAgentRunID_SourceAIAgentRunID, @SuccessScore = @false_SourceAIAgentRunID_SuccessScore, @Comments = @false_SourceAIAgentRunID_Comments, @Status = @false_SourceAIAgentRunID_Status, @EmbeddingVector = @false_SourceAIAgentRunID_EmbeddingVector, @EmbeddingModelID = @false_SourceAIAgentRunID_EmbeddingModelID, @PrimaryScopeEntityID = @false_SourceAIAgentRunID_PrimaryScopeEntityID, @PrimaryScopeRecordID = @false_SourceAIAgentRunID_PrimaryScopeRecordID, @SecondaryScopes = @false_SourceAIAgentRunID_SecondaryScopes, @LastAccessedAt = @false_SourceAIAgentRunID_LastAccessedAt, @AccessCount = @false_SourceAIAgentRunID_AccessCount, @ExpiresAt = @false_SourceAIAgentRunID_ExpiresAt

        FETCH NEXT FROM cascade_update_false_SourceAIAgentRunID_cursor INTO @false_SourceAIAgentRunIDID, @false_SourceAIAgentRunID_AgentID, @false_SourceAIAgentRunID_UserID, @false_SourceAIAgentRunID_CompanyID, @false_SourceAIAgentRunID_Type, @false_SourceAIAgentRunID_ExampleInput, @false_SourceAIAgentRunID_ExampleOutput, @false_SourceAIAgentRunID_IsAutoGenerated, @false_SourceAIAgentRunID_SourceConversationID, @false_SourceAIAgentRunID_SourceConversationDetailID, @false_SourceAIAgentRunID_SourceAIAgentRunID, @false_SourceAIAgentRunID_SuccessScore, @false_SourceAIAgentRunID_Comments, @false_SourceAIAgentRunID_Status, @false_SourceAIAgentRunID_EmbeddingVector, @false_SourceAIAgentRunID_EmbeddingModelID, @false_SourceAIAgentRunID_PrimaryScopeEntityID, @false_SourceAIAgentRunID_PrimaryScopeRecordID, @false_SourceAIAgentRunID_SecondaryScopes, @false_SourceAIAgentRunID_LastAccessedAt, @false_SourceAIAgentRunID_AccessCount, @false_SourceAIAgentRunID_ExpiresAt
    END

    CLOSE cascade_update_false_SourceAIAgentRunID_cursor
    DEALLOCATE cascade_update_false_SourceAIAgentRunID_cursor
    
    -- Cascade update on AIAgentNote using cursor to call spUpdateMJAIAgentNote
    DECLARE @false_SourceAIAgentRunIDID uniqueidentifier
    DECLARE @false_SourceAIAgentRunID_AgentID uniqueidentifier
    DECLARE @false_SourceAIAgentRunID_AgentNoteTypeID uniqueidentifier
    DECLARE @false_SourceAIAgentRunID_Note nvarchar(MAX)
    DECLARE @false_SourceAIAgentRunID_UserID uniqueidentifier
    DECLARE @false_SourceAIAgentRunID_Type nvarchar(20)
    DECLARE @false_SourceAIAgentRunID_IsAutoGenerated bit
    DECLARE @false_SourceAIAgentRunID_Comments nvarchar(MAX)
    DECLARE @false_SourceAIAgentRunID_Status nvarchar(20)
    DECLARE @false_SourceAIAgentRunID_SourceConversationID uniqueidentifier
    DECLARE @false_SourceAIAgentRunID_SourceConversationDetailID uniqueidentifier
    DECLARE @false_SourceAIAgentRunID_SourceAIAgentRunID uniqueidentifier
    DECLARE @false_SourceAIAgentRunID_CompanyID uniqueidentifier
    DECLARE @false_SourceAIAgentRunID_EmbeddingVector nvarchar(MAX)
    DECLARE @false_SourceAIAgentRunID_EmbeddingModelID uniqueidentifier
    DECLARE @false_SourceAIAgentRunID_PrimaryScopeEntityID uniqueidentifier
    DECLARE @false_SourceAIAgentRunID_PrimaryScopeRecordID nvarchar(100)
    DECLARE @false_SourceAIAgentRunID_SecondaryScopes nvarchar(MAX)
    DECLARE @false_SourceAIAgentRunID_LastAccessedAt datetimeoffset
    DECLARE @false_SourceAIAgentRunID_AccessCount int
    DECLARE @false_SourceAIAgentRunID_ExpiresAt datetimeoffset
    DECLARE cascade_update_false_SourceAIAgentRunID_cursor CURSOR FOR
        SELECT [ID], [AgentID], [AgentNoteTypeID], [Note], [UserID], [Type], [IsAutoGenerated], [Comments], [Status], [SourceConversationID], [SourceConversationDetailID], [SourceAIAgentRunID], [CompanyID], [EmbeddingVector], [EmbeddingModelID], [PrimaryScopeEntityID], [PrimaryScopeRecordID], [SecondaryScopes], [LastAccessedAt], [AccessCount], [ExpiresAt]
        FROM [${flyway:defaultSchema}].[AIAgentNote]
        WHERE [SourceAIAgentRunID] = @ID

    OPEN cascade_update_false_SourceAIAgentRunID_cursor
    FETCH NEXT FROM cascade_update_false_SourceAIAgentRunID_cursor INTO @false_SourceAIAgentRunIDID, @false_SourceAIAgentRunID_AgentID, @false_SourceAIAgentRunID_AgentNoteTypeID, @false_SourceAIAgentRunID_Note, @false_SourceAIAgentRunID_UserID, @false_SourceAIAgentRunID_Type, @false_SourceAIAgentRunID_IsAutoGenerated, @false_SourceAIAgentRunID_Comments, @false_SourceAIAgentRunID_Status, @false_SourceAIAgentRunID_SourceConversationID, @false_SourceAIAgentRunID_SourceConversationDetailID, @false_SourceAIAgentRunID_SourceAIAgentRunID, @false_SourceAIAgentRunID_CompanyID, @false_SourceAIAgentRunID_EmbeddingVector, @false_SourceAIAgentRunID_EmbeddingModelID, @false_SourceAIAgentRunID_PrimaryScopeEntityID, @false_SourceAIAgentRunID_PrimaryScopeRecordID, @false_SourceAIAgentRunID_SecondaryScopes, @false_SourceAIAgentRunID_LastAccessedAt, @false_SourceAIAgentRunID_AccessCount, @false_SourceAIAgentRunID_ExpiresAt

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @false_SourceAIAgentRunID_SourceAIAgentRunID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateMJAIAgentNote] @ID = @false_SourceAIAgentRunIDID, @AgentID = @false_SourceAIAgentRunID_AgentID, @AgentNoteTypeID = @false_SourceAIAgentRunID_AgentNoteTypeID, @Note = @false_SourceAIAgentRunID_Note, @UserID = @false_SourceAIAgentRunID_UserID, @Type = @false_SourceAIAgentRunID_Type, @IsAutoGenerated = @false_SourceAIAgentRunID_IsAutoGenerated, @Comments = @false_SourceAIAgentRunID_Comments, @Status = @false_SourceAIAgentRunID_Status, @SourceConversationID = @false_SourceAIAgentRunID_SourceConversationID, @SourceConversationDetailID = @false_SourceAIAgentRunID_SourceConversationDetailID, @SourceAIAgentRunID = @false_SourceAIAgentRunID_SourceAIAgentRunID, @CompanyID = @false_SourceAIAgentRunID_CompanyID, @EmbeddingVector = @false_SourceAIAgentRunID_EmbeddingVector, @EmbeddingModelID = @false_SourceAIAgentRunID_EmbeddingModelID, @PrimaryScopeEntityID = @false_SourceAIAgentRunID_PrimaryScopeEntityID, @PrimaryScopeRecordID = @false_SourceAIAgentRunID_PrimaryScopeRecordID, @SecondaryScopes = @false_SourceAIAgentRunID_SecondaryScopes, @LastAccessedAt = @false_SourceAIAgentRunID_LastAccessedAt, @AccessCount = @false_SourceAIAgentRunID_AccessCount, @ExpiresAt = @false_SourceAIAgentRunID_ExpiresAt

        FETCH NEXT FROM cascade_update_false_SourceAIAgentRunID_cursor INTO @false_SourceAIAgentRunIDID, @false_SourceAIAgentRunID_AgentID, @false_SourceAIAgentRunID_AgentNoteTypeID, @false_SourceAIAgentRunID_Note, @false_SourceAIAgentRunID_UserID, @false_SourceAIAgentRunID_Type, @false_SourceAIAgentRunID_IsAutoGenerated, @false_SourceAIAgentRunID_Comments, @false_SourceAIAgentRunID_Status, @false_SourceAIAgentRunID_SourceConversationID, @false_SourceAIAgentRunID_SourceConversationDetailID, @false_SourceAIAgentRunID_SourceAIAgentRunID, @false_SourceAIAgentRunID_CompanyID, @false_SourceAIAgentRunID_EmbeddingVector, @false_SourceAIAgentRunID_EmbeddingModelID, @false_SourceAIAgentRunID_PrimaryScopeEntityID, @false_SourceAIAgentRunID_PrimaryScopeRecordID, @false_SourceAIAgentRunID_SecondaryScopes, @false_SourceAIAgentRunID_LastAccessedAt, @false_SourceAIAgentRunID_AccessCount, @false_SourceAIAgentRunID_ExpiresAt
    END

    CLOSE cascade_update_false_SourceAIAgentRunID_cursor
    DEALLOCATE cascade_update_false_SourceAIAgentRunID_cursor
    
    -- Cascade delete from AIAgentRunMedia using cursor to call spDeleteMJAIAgentRunMedia
    DECLARE @false_AgentRunIDID uniqueidentifier
    DECLARE cascade_delete_false_AgentRunID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[AIAgentRunMedia]
        WHERE [AgentRunID] = @ID
    
    OPEN cascade_delete_false_AgentRunID_cursor
    FETCH NEXT FROM cascade_delete_false_AgentRunID_cursor INTO @false_AgentRunIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteMJAIAgentRunMedia] @ID = @false_AgentRunIDID
        
        FETCH NEXT FROM cascade_delete_false_AgentRunID_cursor INTO @false_AgentRunIDID
    END
    
    CLOSE cascade_delete_false_AgentRunID_cursor
    DEALLOCATE cascade_delete_false_AgentRunID_cursor
    
    -- Cascade delete from AIAgentRunStep using cursor to call spDeleteMJAIAgentRunStep
    DECLARE @false_AgentRunIDID uniqueidentifier
    DECLARE cascade_delete_false_AgentRunID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[AIAgentRunStep]
        WHERE [AgentRunID] = @ID
    
    OPEN cascade_delete_false_AgentRunID_cursor
    FETCH NEXT FROM cascade_delete_false_AgentRunID_cursor INTO @false_AgentRunIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteMJAIAgentRunStep] @ID = @false_AgentRunIDID
        
        FETCH NEXT FROM cascade_delete_false_AgentRunID_cursor INTO @false_AgentRunIDID
    END
    
    CLOSE cascade_delete_false_AgentRunID_cursor
    DEALLOCATE cascade_delete_false_AgentRunID_cursor
    
    -- Cascade update on AIAgentRun using cursor to call spUpdateMJAIAgentRun
    DECLARE @false_ParentRunIDID uniqueidentifier
    DECLARE @false_ParentRunID_AgentID uniqueidentifier
    DECLARE @false_ParentRunID_ParentRunID uniqueidentifier
    DECLARE @false_ParentRunID_Status nvarchar(50)
    DECLARE @false_ParentRunID_StartedAt datetimeoffset
    DECLARE @false_ParentRunID_CompletedAt datetimeoffset
    DECLARE @false_ParentRunID_Success bit
    DECLARE @false_ParentRunID_ErrorMessage nvarchar(MAX)
    DECLARE @false_ParentRunID_ConversationID uniqueidentifier
    DECLARE @false_ParentRunID_UserID uniqueidentifier
    DECLARE @false_ParentRunID_Result nvarchar(MAX)
    DECLARE @false_ParentRunID_AgentState nvarchar(MAX)
    DECLARE @false_ParentRunID_TotalTokensUsed int
    DECLARE @false_ParentRunID_TotalCost decimal(18, 6)
    DECLARE @false_ParentRunID_TotalPromptTokensUsed int
    DECLARE @false_ParentRunID_TotalCompletionTokensUsed int
    DECLARE @false_ParentRunID_TotalTokensUsedRollup int
    DECLARE @false_ParentRunID_TotalPromptTokensUsedRollup int
    DECLARE @false_ParentRunID_TotalCompletionTokensUsedRollup int
    DECLARE @false_ParentRunID_TotalCostRollup decimal(19, 8)
    DECLARE @false_ParentRunID_ConversationDetailID uniqueidentifier
    DECLARE @false_ParentRunID_ConversationDetailSequence int
    DECLARE @false_ParentRunID_CancellationReason nvarchar(30)
    DECLARE @false_ParentRunID_FinalStep nvarchar(30)
    DECLARE @false_ParentRunID_FinalPayload nvarchar(MAX)
    DECLARE @false_ParentRunID_Message nvarchar(MAX)
    DECLARE @false_ParentRunID_LastRunID uniqueidentifier
    DECLARE @false_ParentRunID_StartingPayload nvarchar(MAX)
    DECLARE @false_ParentRunID_TotalPromptIterations int
    DECLARE @false_ParentRunID_ConfigurationID uniqueidentifier
    DECLARE @false_ParentRunID_OverrideModelID uniqueidentifier
    DECLARE @false_ParentRunID_OverrideVendorID uniqueidentifier
    DECLARE @false_ParentRunID_Data nvarchar(MAX)
    DECLARE @false_ParentRunID_Verbose bit
    DECLARE @false_ParentRunID_EffortLevel int
    DECLARE @false_ParentRunID_RunName nvarchar(255)
    DECLARE @false_ParentRunID_Comments nvarchar(MAX)
    DECLARE @false_ParentRunID_ScheduledJobRunID uniqueidentifier
    DECLARE @false_ParentRunID_TestRunID uniqueidentifier
    DECLARE @false_ParentRunID_PrimaryScopeEntityID uniqueidentifier
    DECLARE @false_ParentRunID_PrimaryScopeRecordID nvarchar(100)
    DECLARE @false_ParentRunID_SecondaryScopes nvarchar(MAX)
    DECLARE cascade_update_false_ParentRunID_cursor CURSOR FOR
        SELECT [ID], [AgentID], [ParentRunID], [Status], [StartedAt], [CompletedAt], [Success], [ErrorMessage], [ConversationID], [UserID], [Result], [AgentState], [TotalTokensUsed], [TotalCost], [TotalPromptTokensUsed], [TotalCompletionTokensUsed], [TotalTokensUsedRollup], [TotalPromptTokensUsedRollup], [TotalCompletionTokensUsedRollup], [TotalCostRollup], [ConversationDetailID], [ConversationDetailSequence], [CancellationReason], [FinalStep], [FinalPayload], [Message], [LastRunID], [StartingPayload], [TotalPromptIterations], [ConfigurationID], [OverrideModelID], [OverrideVendorID], [Data], [Verbose], [EffortLevel], [RunName], [Comments], [ScheduledJobRunID], [TestRunID], [PrimaryScopeEntityID], [PrimaryScopeRecordID], [SecondaryScopes]
        FROM [${flyway:defaultSchema}].[AIAgentRun]
        WHERE [ParentRunID] = @ID

    OPEN cascade_update_false_ParentRunID_cursor
    FETCH NEXT FROM cascade_update_false_ParentRunID_cursor INTO @false_ParentRunIDID, @false_ParentRunID_AgentID, @false_ParentRunID_ParentRunID, @false_ParentRunID_Status, @false_ParentRunID_StartedAt, @false_ParentRunID_CompletedAt, @false_ParentRunID_Success, @false_ParentRunID_ErrorMessage, @false_ParentRunID_ConversationID, @false_ParentRunID_UserID, @false_ParentRunID_Result, @false_ParentRunID_AgentState, @false_ParentRunID_TotalTokensUsed, @false_ParentRunID_TotalCost, @false_ParentRunID_TotalPromptTokensUsed, @false_ParentRunID_TotalCompletionTokensUsed, @false_ParentRunID_TotalTokensUsedRollup, @false_ParentRunID_TotalPromptTokensUsedRollup, @false_ParentRunID_TotalCompletionTokensUsedRollup, @false_ParentRunID_TotalCostRollup, @false_ParentRunID_ConversationDetailID, @false_ParentRunID_ConversationDetailSequence, @false_ParentRunID_CancellationReason, @false_ParentRunID_FinalStep, @false_ParentRunID_FinalPayload, @false_ParentRunID_Message, @false_ParentRunID_LastRunID, @false_ParentRunID_StartingPayload, @false_ParentRunID_TotalPromptIterations, @false_ParentRunID_ConfigurationID, @false_ParentRunID_OverrideModelID, @false_ParentRunID_OverrideVendorID, @false_ParentRunID_Data, @false_ParentRunID_Verbose, @false_ParentRunID_EffortLevel, @false_ParentRunID_RunName, @false_ParentRunID_Comments, @false_ParentRunID_ScheduledJobRunID, @false_ParentRunID_TestRunID, @false_ParentRunID_PrimaryScopeEntityID, @false_ParentRunID_PrimaryScopeRecordID, @false_ParentRunID_SecondaryScopes

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @false_ParentRunID_ParentRunID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateMJAIAgentRun] @ID = @false_ParentRunIDID, @AgentID = @false_ParentRunID_AgentID, @ParentRunID = @false_ParentRunID_ParentRunID, @Status = @false_ParentRunID_Status, @StartedAt = @false_ParentRunID_StartedAt, @CompletedAt = @false_ParentRunID_CompletedAt, @Success = @false_ParentRunID_Success, @ErrorMessage = @false_ParentRunID_ErrorMessage, @ConversationID = @false_ParentRunID_ConversationID, @UserID = @false_ParentRunID_UserID, @Result = @false_ParentRunID_Result, @AgentState = @false_ParentRunID_AgentState, @TotalTokensUsed = @false_ParentRunID_TotalTokensUsed, @TotalCost = @false_ParentRunID_TotalCost, @TotalPromptTokensUsed = @false_ParentRunID_TotalPromptTokensUsed, @TotalCompletionTokensUsed = @false_ParentRunID_TotalCompletionTokensUsed, @TotalTokensUsedRollup = @false_ParentRunID_TotalTokensUsedRollup, @TotalPromptTokensUsedRollup = @false_ParentRunID_TotalPromptTokensUsedRollup, @TotalCompletionTokensUsedRollup = @false_ParentRunID_TotalCompletionTokensUsedRollup, @TotalCostRollup = @false_ParentRunID_TotalCostRollup, @ConversationDetailID = @false_ParentRunID_ConversationDetailID, @ConversationDetailSequence = @false_ParentRunID_ConversationDetailSequence, @CancellationReason = @false_ParentRunID_CancellationReason, @FinalStep = @false_ParentRunID_FinalStep, @FinalPayload = @false_ParentRunID_FinalPayload, @Message = @false_ParentRunID_Message, @LastRunID = @false_ParentRunID_LastRunID, @StartingPayload = @false_ParentRunID_StartingPayload, @TotalPromptIterations = @false_ParentRunID_TotalPromptIterations, @ConfigurationID = @false_ParentRunID_ConfigurationID, @OverrideModelID = @false_ParentRunID_OverrideModelID, @OverrideVendorID = @false_ParentRunID_OverrideVendorID, @Data = @false_ParentRunID_Data, @Verbose = @false_ParentRunID_Verbose, @EffortLevel = @false_ParentRunID_EffortLevel, @RunName = @false_ParentRunID_RunName, @Comments = @false_ParentRunID_Comments, @ScheduledJobRunID = @false_ParentRunID_ScheduledJobRunID, @TestRunID = @false_ParentRunID_TestRunID, @PrimaryScopeEntityID = @false_ParentRunID_PrimaryScopeEntityID, @PrimaryScopeRecordID = @false_ParentRunID_PrimaryScopeRecordID, @SecondaryScopes = @false_ParentRunID_SecondaryScopes

        FETCH NEXT FROM cascade_update_false_ParentRunID_cursor INTO @false_ParentRunIDID, @false_ParentRunID_AgentID, @false_ParentRunID_ParentRunID, @false_ParentRunID_Status, @false_ParentRunID_StartedAt, @false_ParentRunID_CompletedAt, @false_ParentRunID_Success, @false_ParentRunID_ErrorMessage, @false_ParentRunID_ConversationID, @false_ParentRunID_UserID, @false_ParentRunID_Result, @false_ParentRunID_AgentState, @false_ParentRunID_TotalTokensUsed, @false_ParentRunID_TotalCost, @false_ParentRunID_TotalPromptTokensUsed, @false_ParentRunID_TotalCompletionTokensUsed, @false_ParentRunID_TotalTokensUsedRollup, @false_ParentRunID_TotalPromptTokensUsedRollup, @false_ParentRunID_TotalCompletionTokensUsedRollup, @false_ParentRunID_TotalCostRollup, @false_ParentRunID_ConversationDetailID, @false_ParentRunID_ConversationDetailSequence, @false_ParentRunID_CancellationReason, @false_ParentRunID_FinalStep, @false_ParentRunID_FinalPayload, @false_ParentRunID_Message, @false_ParentRunID_LastRunID, @false_ParentRunID_StartingPayload, @false_ParentRunID_TotalPromptIterations, @false_ParentRunID_ConfigurationID, @false_ParentRunID_OverrideModelID, @false_ParentRunID_OverrideVendorID, @false_ParentRunID_Data, @false_ParentRunID_Verbose, @false_ParentRunID_EffortLevel, @false_ParentRunID_RunName, @false_ParentRunID_Comments, @false_ParentRunID_ScheduledJobRunID, @false_ParentRunID_TestRunID, @false_ParentRunID_PrimaryScopeEntityID, @false_ParentRunID_PrimaryScopeRecordID, @false_ParentRunID_SecondaryScopes
    END

    CLOSE cascade_update_false_ParentRunID_cursor
    DEALLOCATE cascade_update_false_ParentRunID_cursor
    
    -- Cascade update on AIAgentRun using cursor to call spUpdateMJAIAgentRun
    DECLARE @false_LastRunIDID uniqueidentifier
    DECLARE @false_LastRunID_AgentID uniqueidentifier
    DECLARE @false_LastRunID_ParentRunID uniqueidentifier
    DECLARE @false_LastRunID_Status nvarchar(50)
    DECLARE @false_LastRunID_StartedAt datetimeoffset
    DECLARE @false_LastRunID_CompletedAt datetimeoffset
    DECLARE @false_LastRunID_Success bit
    DECLARE @false_LastRunID_ErrorMessage nvarchar(MAX)
    DECLARE @false_LastRunID_ConversationID uniqueidentifier
    DECLARE @false_LastRunID_UserID uniqueidentifier
    DECLARE @false_LastRunID_Result nvarchar(MAX)
    DECLARE @false_LastRunID_AgentState nvarchar(MAX)
    DECLARE @false_LastRunID_TotalTokensUsed int
    DECLARE @false_LastRunID_TotalCost decimal(18, 6)
    DECLARE @false_LastRunID_TotalPromptTokensUsed int
    DECLARE @false_LastRunID_TotalCompletionTokensUsed int
    DECLARE @false_LastRunID_TotalTokensUsedRollup int
    DECLARE @false_LastRunID_TotalPromptTokensUsedRollup int
    DECLARE @false_LastRunID_TotalCompletionTokensUsedRollup int
    DECLARE @false_LastRunID_TotalCostRollup decimal(19, 8)
    DECLARE @false_LastRunID_ConversationDetailID uniqueidentifier
    DECLARE @false_LastRunID_ConversationDetailSequence int
    DECLARE @false_LastRunID_CancellationReason nvarchar(30)
    DECLARE @false_LastRunID_FinalStep nvarchar(30)
    DECLARE @false_LastRunID_FinalPayload nvarchar(MAX)
    DECLARE @false_LastRunID_Message nvarchar(MAX)
    DECLARE @false_LastRunID_LastRunID uniqueidentifier
    DECLARE @false_LastRunID_StartingPayload nvarchar(MAX)
    DECLARE @false_LastRunID_TotalPromptIterations int
    DECLARE @false_LastRunID_ConfigurationID uniqueidentifier
    DECLARE @false_LastRunID_OverrideModelID uniqueidentifier
    DECLARE @false_LastRunID_OverrideVendorID uniqueidentifier
    DECLARE @false_LastRunID_Data nvarchar(MAX)
    DECLARE @false_LastRunID_Verbose bit
    DECLARE @false_LastRunID_EffortLevel int
    DECLARE @false_LastRunID_RunName nvarchar(255)
    DECLARE @false_LastRunID_Comments nvarchar(MAX)
    DECLARE @false_LastRunID_ScheduledJobRunID uniqueidentifier
    DECLARE @false_LastRunID_TestRunID uniqueidentifier
    DECLARE @false_LastRunID_PrimaryScopeEntityID uniqueidentifier
    DECLARE @false_LastRunID_PrimaryScopeRecordID nvarchar(100)
    DECLARE @false_LastRunID_SecondaryScopes nvarchar(MAX)
    DECLARE cascade_update_false_LastRunID_cursor CURSOR FOR
        SELECT [ID], [AgentID], [ParentRunID], [Status], [StartedAt], [CompletedAt], [Success], [ErrorMessage], [ConversationID], [UserID], [Result], [AgentState], [TotalTokensUsed], [TotalCost], [TotalPromptTokensUsed], [TotalCompletionTokensUsed], [TotalTokensUsedRollup], [TotalPromptTokensUsedRollup], [TotalCompletionTokensUsedRollup], [TotalCostRollup], [ConversationDetailID], [ConversationDetailSequence], [CancellationReason], [FinalStep], [FinalPayload], [Message], [LastRunID], [StartingPayload], [TotalPromptIterations], [ConfigurationID], [OverrideModelID], [OverrideVendorID], [Data], [Verbose], [EffortLevel], [RunName], [Comments], [ScheduledJobRunID], [TestRunID], [PrimaryScopeEntityID], [PrimaryScopeRecordID], [SecondaryScopes]
        FROM [${flyway:defaultSchema}].[AIAgentRun]
        WHERE [LastRunID] = @ID

    OPEN cascade_update_false_LastRunID_cursor
    FETCH NEXT FROM cascade_update_false_LastRunID_cursor INTO @false_LastRunIDID, @false_LastRunID_AgentID, @false_LastRunID_ParentRunID, @false_LastRunID_Status, @false_LastRunID_StartedAt, @false_LastRunID_CompletedAt, @false_LastRunID_Success, @false_LastRunID_ErrorMessage, @false_LastRunID_ConversationID, @false_LastRunID_UserID, @false_LastRunID_Result, @false_LastRunID_AgentState, @false_LastRunID_TotalTokensUsed, @false_LastRunID_TotalCost, @false_LastRunID_TotalPromptTokensUsed, @false_LastRunID_TotalCompletionTokensUsed, @false_LastRunID_TotalTokensUsedRollup, @false_LastRunID_TotalPromptTokensUsedRollup, @false_LastRunID_TotalCompletionTokensUsedRollup, @false_LastRunID_TotalCostRollup, @false_LastRunID_ConversationDetailID, @false_LastRunID_ConversationDetailSequence, @false_LastRunID_CancellationReason, @false_LastRunID_FinalStep, @false_LastRunID_FinalPayload, @false_LastRunID_Message, @false_LastRunID_LastRunID, @false_LastRunID_StartingPayload, @false_LastRunID_TotalPromptIterations, @false_LastRunID_ConfigurationID, @false_LastRunID_OverrideModelID, @false_LastRunID_OverrideVendorID, @false_LastRunID_Data, @false_LastRunID_Verbose, @false_LastRunID_EffortLevel, @false_LastRunID_RunName, @false_LastRunID_Comments, @false_LastRunID_ScheduledJobRunID, @false_LastRunID_TestRunID, @false_LastRunID_PrimaryScopeEntityID, @false_LastRunID_PrimaryScopeRecordID, @false_LastRunID_SecondaryScopes

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @false_LastRunID_LastRunID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateMJAIAgentRun] @ID = @false_LastRunIDID, @AgentID = @false_LastRunID_AgentID, @ParentRunID = @false_LastRunID_ParentRunID, @Status = @false_LastRunID_Status, @StartedAt = @false_LastRunID_StartedAt, @CompletedAt = @false_LastRunID_CompletedAt, @Success = @false_LastRunID_Success, @ErrorMessage = @false_LastRunID_ErrorMessage, @ConversationID = @false_LastRunID_ConversationID, @UserID = @false_LastRunID_UserID, @Result = @false_LastRunID_Result, @AgentState = @false_LastRunID_AgentState, @TotalTokensUsed = @false_LastRunID_TotalTokensUsed, @TotalCost = @false_LastRunID_TotalCost, @TotalPromptTokensUsed = @false_LastRunID_TotalPromptTokensUsed, @TotalCompletionTokensUsed = @false_LastRunID_TotalCompletionTokensUsed, @TotalTokensUsedRollup = @false_LastRunID_TotalTokensUsedRollup, @TotalPromptTokensUsedRollup = @false_LastRunID_TotalPromptTokensUsedRollup, @TotalCompletionTokensUsedRollup = @false_LastRunID_TotalCompletionTokensUsedRollup, @TotalCostRollup = @false_LastRunID_TotalCostRollup, @ConversationDetailID = @false_LastRunID_ConversationDetailID, @ConversationDetailSequence = @false_LastRunID_ConversationDetailSequence, @CancellationReason = @false_LastRunID_CancellationReason, @FinalStep = @false_LastRunID_FinalStep, @FinalPayload = @false_LastRunID_FinalPayload, @Message = @false_LastRunID_Message, @LastRunID = @false_LastRunID_LastRunID, @StartingPayload = @false_LastRunID_StartingPayload, @TotalPromptIterations = @false_LastRunID_TotalPromptIterations, @ConfigurationID = @false_LastRunID_ConfigurationID, @OverrideModelID = @false_LastRunID_OverrideModelID, @OverrideVendorID = @false_LastRunID_OverrideVendorID, @Data = @false_LastRunID_Data, @Verbose = @false_LastRunID_Verbose, @EffortLevel = @false_LastRunID_EffortLevel, @RunName = @false_LastRunID_RunName, @Comments = @false_LastRunID_Comments, @ScheduledJobRunID = @false_LastRunID_ScheduledJobRunID, @TestRunID = @false_LastRunID_TestRunID, @PrimaryScopeEntityID = @false_LastRunID_PrimaryScopeEntityID, @PrimaryScopeRecordID = @false_LastRunID_PrimaryScopeRecordID, @SecondaryScopes = @false_LastRunID_SecondaryScopes

        FETCH NEXT FROM cascade_update_false_LastRunID_cursor INTO @false_LastRunIDID, @false_LastRunID_AgentID, @false_LastRunID_ParentRunID, @false_LastRunID_Status, @false_LastRunID_StartedAt, @false_LastRunID_CompletedAt, @false_LastRunID_Success, @false_LastRunID_ErrorMessage, @false_LastRunID_ConversationID, @false_LastRunID_UserID, @false_LastRunID_Result, @false_LastRunID_AgentState, @false_LastRunID_TotalTokensUsed, @false_LastRunID_TotalCost, @false_LastRunID_TotalPromptTokensUsed, @false_LastRunID_TotalCompletionTokensUsed, @false_LastRunID_TotalTokensUsedRollup, @false_LastRunID_TotalPromptTokensUsedRollup, @false_LastRunID_TotalCompletionTokensUsedRollup, @false_LastRunID_TotalCostRollup, @false_LastRunID_ConversationDetailID, @false_LastRunID_ConversationDetailSequence, @false_LastRunID_CancellationReason, @false_LastRunID_FinalStep, @false_LastRunID_FinalPayload, @false_LastRunID_Message, @false_LastRunID_LastRunID, @false_LastRunID_StartingPayload, @false_LastRunID_TotalPromptIterations, @false_LastRunID_ConfigurationID, @false_LastRunID_OverrideModelID, @false_LastRunID_OverrideVendorID, @false_LastRunID_Data, @false_LastRunID_Verbose, @false_LastRunID_EffortLevel, @false_LastRunID_RunName, @false_LastRunID_Comments, @false_LastRunID_ScheduledJobRunID, @false_LastRunID_TestRunID, @false_LastRunID_PrimaryScopeEntityID, @false_LastRunID_PrimaryScopeRecordID, @false_LastRunID_SecondaryScopes
    END

    CLOSE cascade_update_false_LastRunID_cursor
    DEALLOCATE cascade_update_false_LastRunID_cursor
    
    -- Cascade update on AIPromptRun using cursor to call spUpdateMJAIPromptRun
    DECLARE @false_AgentRunIDID uniqueidentifier
    DECLARE @false_AgentRunID_PromptID uniqueidentifier
    DECLARE @false_AgentRunID_ModelID uniqueidentifier
    DECLARE @false_AgentRunID_VendorID uniqueidentifier
    DECLARE @false_AgentRunID_AgentID uniqueidentifier
    DECLARE @false_AgentRunID_ConfigurationID uniqueidentifier
    DECLARE @false_AgentRunID_RunAt datetimeoffset
    DECLARE @false_AgentRunID_CompletedAt datetimeoffset
    DECLARE @false_AgentRunID_ExecutionTimeMS int
    DECLARE @false_AgentRunID_Messages nvarchar(MAX)
    DECLARE @false_AgentRunID_Result nvarchar(MAX)
    DECLARE @false_AgentRunID_TokensUsed int
    DECLARE @false_AgentRunID_TokensPrompt int
    DECLARE @false_AgentRunID_TokensCompletion int
    DECLARE @false_AgentRunID_TotalCost decimal(18, 6)
    DECLARE @false_AgentRunID_Success bit
    DECLARE @false_AgentRunID_ErrorMessage nvarchar(MAX)
    DECLARE @false_AgentRunID_ParentID uniqueidentifier
    DECLARE @false_AgentRunID_RunType nvarchar(20)
    DECLARE @false_AgentRunID_ExecutionOrder int
    DECLARE @false_AgentRunID_AgentRunID uniqueidentifier
    DECLARE @false_AgentRunID_Cost decimal(19, 8)
    DECLARE @false_AgentRunID_CostCurrency nvarchar(10)
    DECLARE @false_AgentRunID_TokensUsedRollup int
    DECLARE @false_AgentRunID_TokensPromptRollup int
    DECLARE @false_AgentRunID_TokensCompletionRollup int
    DECLARE @false_AgentRunID_Temperature decimal(3, 2)
    DECLARE @false_AgentRunID_TopP decimal(3, 2)
    DECLARE @false_AgentRunID_TopK int
    DECLARE @false_AgentRunID_MinP decimal(3, 2)
    DECLARE @false_AgentRunID_FrequencyPenalty decimal(3, 2)
    DECLARE @false_AgentRunID_PresencePenalty decimal(3, 2)
    DECLARE @false_AgentRunID_Seed int
    DECLARE @false_AgentRunID_StopSequences nvarchar(MAX)
    DECLARE @false_AgentRunID_ResponseFormat nvarchar(50)
    DECLARE @false_AgentRunID_LogProbs bit
    DECLARE @false_AgentRunID_TopLogProbs int
    DECLARE @false_AgentRunID_DescendantCost decimal(18, 6)
    DECLARE @false_AgentRunID_ValidationAttemptCount int
    DECLARE @false_AgentRunID_SuccessfulValidationCount int
    DECLARE @false_AgentRunID_FinalValidationPassed bit
    DECLARE @false_AgentRunID_ValidationBehavior nvarchar(50)
    DECLARE @false_AgentRunID_RetryStrategy nvarchar(50)
    DECLARE @false_AgentRunID_MaxRetriesConfigured int
    DECLARE @false_AgentRunID_FinalValidationError nvarchar(500)
    DECLARE @false_AgentRunID_ValidationErrorCount int
    DECLARE @false_AgentRunID_CommonValidationError nvarchar(255)
    DECLARE @false_AgentRunID_FirstAttemptAt datetimeoffset
    DECLARE @false_AgentRunID_LastAttemptAt datetimeoffset
    DECLARE @false_AgentRunID_TotalRetryDurationMS int
    DECLARE @false_AgentRunID_ValidationAttempts nvarchar(MAX)
    DECLARE @false_AgentRunID_ValidationSummary nvarchar(MAX)
    DECLARE @false_AgentRunID_FailoverAttempts int
    DECLARE @false_AgentRunID_FailoverErrors nvarchar(MAX)
    DECLARE @false_AgentRunID_FailoverDurations nvarchar(MAX)
    DECLARE @false_AgentRunID_OriginalModelID uniqueidentifier
    DECLARE @false_AgentRunID_OriginalRequestStartTime datetimeoffset
    DECLARE @false_AgentRunID_TotalFailoverDuration int
    DECLARE @false_AgentRunID_RerunFromPromptRunID uniqueidentifier
    DECLARE @false_AgentRunID_ModelSelection nvarchar(MAX)
    DECLARE @false_AgentRunID_Status nvarchar(50)
    DECLARE @false_AgentRunID_Cancelled bit
    DECLARE @false_AgentRunID_CancellationReason nvarchar(MAX)
    DECLARE @false_AgentRunID_ModelPowerRank int
    DECLARE @false_AgentRunID_SelectionStrategy nvarchar(50)
    DECLARE @false_AgentRunID_CacheHit bit
    DECLARE @false_AgentRunID_CacheKey nvarchar(500)
    DECLARE @false_AgentRunID_JudgeID uniqueidentifier
    DECLARE @false_AgentRunID_JudgeScore float(53)
    DECLARE @false_AgentRunID_WasSelectedResult bit
    DECLARE @false_AgentRunID_StreamingEnabled bit
    DECLARE @false_AgentRunID_FirstTokenTime int
    DECLARE @false_AgentRunID_ErrorDetails nvarchar(MAX)
    DECLARE @false_AgentRunID_ChildPromptID uniqueidentifier
    DECLARE @false_AgentRunID_QueueTime int
    DECLARE @false_AgentRunID_PromptTime int
    DECLARE @false_AgentRunID_CompletionTime int
    DECLARE @false_AgentRunID_ModelSpecificResponseDetails nvarchar(MAX)
    DECLARE @false_AgentRunID_EffortLevel int
    DECLARE @false_AgentRunID_RunName nvarchar(255)
    DECLARE @false_AgentRunID_Comments nvarchar(MAX)
    DECLARE @false_AgentRunID_TestRunID uniqueidentifier
    DECLARE cascade_update_false_AgentRunID_cursor CURSOR FOR
        SELECT [ID], [PromptID], [ModelID], [VendorID], [AgentID], [ConfigurationID], [RunAt], [CompletedAt], [ExecutionTimeMS], [Messages], [Result], [TokensUsed], [TokensPrompt], [TokensCompletion], [TotalCost], [Success], [ErrorMessage], [ParentID], [RunType], [ExecutionOrder], [AgentRunID], [Cost], [CostCurrency], [TokensUsedRollup], [TokensPromptRollup], [TokensCompletionRollup], [Temperature], [TopP], [TopK], [MinP], [FrequencyPenalty], [PresencePenalty], [Seed], [StopSequences], [ResponseFormat], [LogProbs], [TopLogProbs], [DescendantCost], [ValidationAttemptCount], [SuccessfulValidationCount], [FinalValidationPassed], [ValidationBehavior], [RetryStrategy], [MaxRetriesConfigured], [FinalValidationError], [ValidationErrorCount], [CommonValidationError], [FirstAttemptAt], [LastAttemptAt], [TotalRetryDurationMS], [ValidationAttempts], [ValidationSummary], [FailoverAttempts], [FailoverErrors], [FailoverDurations], [OriginalModelID], [OriginalRequestStartTime], [TotalFailoverDuration], [RerunFromPromptRunID], [ModelSelection], [Status], [Cancelled], [CancellationReason], [ModelPowerRank], [SelectionStrategy], [CacheHit], [CacheKey], [JudgeID], [JudgeScore], [WasSelectedResult], [StreamingEnabled], [FirstTokenTime], [ErrorDetails], [ChildPromptID], [QueueTime], [PromptTime], [CompletionTime], [ModelSpecificResponseDetails], [EffortLevel], [RunName], [Comments], [TestRunID]
        FROM [${flyway:defaultSchema}].[AIPromptRun]
        WHERE [AgentRunID] = @ID

    OPEN cascade_update_false_AgentRunID_cursor
    FETCH NEXT FROM cascade_update_false_AgentRunID_cursor INTO @false_AgentRunIDID, @false_AgentRunID_PromptID, @false_AgentRunID_ModelID, @false_AgentRunID_VendorID, @false_AgentRunID_AgentID, @false_AgentRunID_ConfigurationID, @false_AgentRunID_RunAt, @false_AgentRunID_CompletedAt, @false_AgentRunID_ExecutionTimeMS, @false_AgentRunID_Messages, @false_AgentRunID_Result, @false_AgentRunID_TokensUsed, @false_AgentRunID_TokensPrompt, @false_AgentRunID_TokensCompletion, @false_AgentRunID_TotalCost, @false_AgentRunID_Success, @false_AgentRunID_ErrorMessage, @false_AgentRunID_ParentID, @false_AgentRunID_RunType, @false_AgentRunID_ExecutionOrder, @false_AgentRunID_AgentRunID, @false_AgentRunID_Cost, @false_AgentRunID_CostCurrency, @false_AgentRunID_TokensUsedRollup, @false_AgentRunID_TokensPromptRollup, @false_AgentRunID_TokensCompletionRollup, @false_AgentRunID_Temperature, @false_AgentRunID_TopP, @false_AgentRunID_TopK, @false_AgentRunID_MinP, @false_AgentRunID_FrequencyPenalty, @false_AgentRunID_PresencePenalty, @false_AgentRunID_Seed, @false_AgentRunID_StopSequences, @false_AgentRunID_ResponseFormat, @false_AgentRunID_LogProbs, @false_AgentRunID_TopLogProbs, @false_AgentRunID_DescendantCost, @false_AgentRunID_ValidationAttemptCount, @false_AgentRunID_SuccessfulValidationCount, @false_AgentRunID_FinalValidationPassed, @false_AgentRunID_ValidationBehavior, @false_AgentRunID_RetryStrategy, @false_AgentRunID_MaxRetriesConfigured, @false_AgentRunID_FinalValidationError, @false_AgentRunID_ValidationErrorCount, @false_AgentRunID_CommonValidationError, @false_AgentRunID_FirstAttemptAt, @false_AgentRunID_LastAttemptAt, @false_AgentRunID_TotalRetryDurationMS, @false_AgentRunID_ValidationAttempts, @false_AgentRunID_ValidationSummary, @false_AgentRunID_FailoverAttempts, @false_AgentRunID_FailoverErrors, @false_AgentRunID_FailoverDurations, @false_AgentRunID_OriginalModelID, @false_AgentRunID_OriginalRequestStartTime, @false_AgentRunID_TotalFailoverDuration, @false_AgentRunID_RerunFromPromptRunID, @false_AgentRunID_ModelSelection, @false_AgentRunID_Status, @false_AgentRunID_Cancelled, @false_AgentRunID_CancellationReason, @false_AgentRunID_ModelPowerRank, @false_AgentRunID_SelectionStrategy, @false_AgentRunID_CacheHit, @false_AgentRunID_CacheKey, @false_AgentRunID_JudgeID, @false_AgentRunID_JudgeScore, @false_AgentRunID_WasSelectedResult, @false_AgentRunID_StreamingEnabled, @false_AgentRunID_FirstTokenTime, @false_AgentRunID_ErrorDetails, @false_AgentRunID_ChildPromptID, @false_AgentRunID_QueueTime, @false_AgentRunID_PromptTime, @false_AgentRunID_CompletionTime, @false_AgentRunID_ModelSpecificResponseDetails, @false_AgentRunID_EffortLevel, @false_AgentRunID_RunName, @false_AgentRunID_Comments, @false_AgentRunID_TestRunID

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @false_AgentRunID_AgentRunID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateMJAIPromptRun] @ID = @false_AgentRunIDID, @PromptID = @false_AgentRunID_PromptID, @ModelID = @false_AgentRunID_ModelID, @VendorID = @false_AgentRunID_VendorID, @AgentID = @false_AgentRunID_AgentID, @ConfigurationID = @false_AgentRunID_ConfigurationID, @RunAt = @false_AgentRunID_RunAt, @CompletedAt = @false_AgentRunID_CompletedAt, @ExecutionTimeMS = @false_AgentRunID_ExecutionTimeMS, @Messages = @false_AgentRunID_Messages, @Result = @false_AgentRunID_Result, @TokensUsed = @false_AgentRunID_TokensUsed, @TokensPrompt = @false_AgentRunID_TokensPrompt, @TokensCompletion = @false_AgentRunID_TokensCompletion, @TotalCost = @false_AgentRunID_TotalCost, @Success = @false_AgentRunID_Success, @ErrorMessage = @false_AgentRunID_ErrorMessage, @ParentID = @false_AgentRunID_ParentID, @RunType = @false_AgentRunID_RunType, @ExecutionOrder = @false_AgentRunID_ExecutionOrder, @AgentRunID = @false_AgentRunID_AgentRunID, @Cost = @false_AgentRunID_Cost, @CostCurrency = @false_AgentRunID_CostCurrency, @TokensUsedRollup = @false_AgentRunID_TokensUsedRollup, @TokensPromptRollup = @false_AgentRunID_TokensPromptRollup, @TokensCompletionRollup = @false_AgentRunID_TokensCompletionRollup, @Temperature = @false_AgentRunID_Temperature, @TopP = @false_AgentRunID_TopP, @TopK = @false_AgentRunID_TopK, @MinP = @false_AgentRunID_MinP, @FrequencyPenalty = @false_AgentRunID_FrequencyPenalty, @PresencePenalty = @false_AgentRunID_PresencePenalty, @Seed = @false_AgentRunID_Seed, @StopSequences = @false_AgentRunID_StopSequences, @ResponseFormat = @false_AgentRunID_ResponseFormat, @LogProbs = @false_AgentRunID_LogProbs, @TopLogProbs = @false_AgentRunID_TopLogProbs, @DescendantCost = @false_AgentRunID_DescendantCost, @ValidationAttemptCount = @false_AgentRunID_ValidationAttemptCount, @SuccessfulValidationCount = @false_AgentRunID_SuccessfulValidationCount, @FinalValidationPassed = @false_AgentRunID_FinalValidationPassed, @ValidationBehavior = @false_AgentRunID_ValidationBehavior, @RetryStrategy = @false_AgentRunID_RetryStrategy, @MaxRetriesConfigured = @false_AgentRunID_MaxRetriesConfigured, @FinalValidationError = @false_AgentRunID_FinalValidationError, @ValidationErrorCount = @false_AgentRunID_ValidationErrorCount, @CommonValidationError = @false_AgentRunID_CommonValidationError, @FirstAttemptAt = @false_AgentRunID_FirstAttemptAt, @LastAttemptAt = @false_AgentRunID_LastAttemptAt, @TotalRetryDurationMS = @false_AgentRunID_TotalRetryDurationMS, @ValidationAttempts = @false_AgentRunID_ValidationAttempts, @ValidationSummary = @false_AgentRunID_ValidationSummary, @FailoverAttempts = @false_AgentRunID_FailoverAttempts, @FailoverErrors = @false_AgentRunID_FailoverErrors, @FailoverDurations = @false_AgentRunID_FailoverDurations, @OriginalModelID = @false_AgentRunID_OriginalModelID, @OriginalRequestStartTime = @false_AgentRunID_OriginalRequestStartTime, @TotalFailoverDuration = @false_AgentRunID_TotalFailoverDuration, @RerunFromPromptRunID = @false_AgentRunID_RerunFromPromptRunID, @ModelSelection = @false_AgentRunID_ModelSelection, @Status = @false_AgentRunID_Status, @Cancelled = @false_AgentRunID_Cancelled, @CancellationReason = @false_AgentRunID_CancellationReason, @ModelPowerRank = @false_AgentRunID_ModelPowerRank, @SelectionStrategy = @false_AgentRunID_SelectionStrategy, @CacheHit = @false_AgentRunID_CacheHit, @CacheKey = @false_AgentRunID_CacheKey, @JudgeID = @false_AgentRunID_JudgeID, @JudgeScore = @false_AgentRunID_JudgeScore, @WasSelectedResult = @false_AgentRunID_WasSelectedResult, @StreamingEnabled = @false_AgentRunID_StreamingEnabled, @FirstTokenTime = @false_AgentRunID_FirstTokenTime, @ErrorDetails = @false_AgentRunID_ErrorDetails, @ChildPromptID = @false_AgentRunID_ChildPromptID, @QueueTime = @false_AgentRunID_QueueTime, @PromptTime = @false_AgentRunID_PromptTime, @CompletionTime = @false_AgentRunID_CompletionTime, @ModelSpecificResponseDetails = @false_AgentRunID_ModelSpecificResponseDetails, @EffortLevel = @false_AgentRunID_EffortLevel, @RunName = @false_AgentRunID_RunName, @Comments = @false_AgentRunID_Comments, @TestRunID = @false_AgentRunID_TestRunID

        FETCH NEXT FROM cascade_update_false_AgentRunID_cursor INTO @false_AgentRunIDID, @false_AgentRunID_PromptID, @false_AgentRunID_ModelID, @false_AgentRunID_VendorID, @false_AgentRunID_AgentID, @false_AgentRunID_ConfigurationID, @false_AgentRunID_RunAt, @false_AgentRunID_CompletedAt, @false_AgentRunID_ExecutionTimeMS, @false_AgentRunID_Messages, @false_AgentRunID_Result, @false_AgentRunID_TokensUsed, @false_AgentRunID_TokensPrompt, @false_AgentRunID_TokensCompletion, @false_AgentRunID_TotalCost, @false_AgentRunID_Success, @false_AgentRunID_ErrorMessage, @false_AgentRunID_ParentID, @false_AgentRunID_RunType, @false_AgentRunID_ExecutionOrder, @false_AgentRunID_AgentRunID, @false_AgentRunID_Cost, @false_AgentRunID_CostCurrency, @false_AgentRunID_TokensUsedRollup, @false_AgentRunID_TokensPromptRollup, @false_AgentRunID_TokensCompletionRollup, @false_AgentRunID_Temperature, @false_AgentRunID_TopP, @false_AgentRunID_TopK, @false_AgentRunID_MinP, @false_AgentRunID_FrequencyPenalty, @false_AgentRunID_PresencePenalty, @false_AgentRunID_Seed, @false_AgentRunID_StopSequences, @false_AgentRunID_ResponseFormat, @false_AgentRunID_LogProbs, @false_AgentRunID_TopLogProbs, @false_AgentRunID_DescendantCost, @false_AgentRunID_ValidationAttemptCount, @false_AgentRunID_SuccessfulValidationCount, @false_AgentRunID_FinalValidationPassed, @false_AgentRunID_ValidationBehavior, @false_AgentRunID_RetryStrategy, @false_AgentRunID_MaxRetriesConfigured, @false_AgentRunID_FinalValidationError, @false_AgentRunID_ValidationErrorCount, @false_AgentRunID_CommonValidationError, @false_AgentRunID_FirstAttemptAt, @false_AgentRunID_LastAttemptAt, @false_AgentRunID_TotalRetryDurationMS, @false_AgentRunID_ValidationAttempts, @false_AgentRunID_ValidationSummary, @false_AgentRunID_FailoverAttempts, @false_AgentRunID_FailoverErrors, @false_AgentRunID_FailoverDurations, @false_AgentRunID_OriginalModelID, @false_AgentRunID_OriginalRequestStartTime, @false_AgentRunID_TotalFailoverDuration, @false_AgentRunID_RerunFromPromptRunID, @false_AgentRunID_ModelSelection, @false_AgentRunID_Status, @false_AgentRunID_Cancelled, @false_AgentRunID_CancellationReason, @false_AgentRunID_ModelPowerRank, @false_AgentRunID_SelectionStrategy, @false_AgentRunID_CacheHit, @false_AgentRunID_CacheKey, @false_AgentRunID_JudgeID, @false_AgentRunID_JudgeScore, @false_AgentRunID_WasSelectedResult, @false_AgentRunID_StreamingEnabled, @false_AgentRunID_FirstTokenTime, @false_AgentRunID_ErrorDetails, @false_AgentRunID_ChildPromptID, @false_AgentRunID_QueueTime, @false_AgentRunID_PromptTime, @false_AgentRunID_CompletionTime, @false_AgentRunID_ModelSpecificResponseDetails, @false_AgentRunID_EffortLevel, @false_AgentRunID_RunName, @false_AgentRunID_Comments, @false_AgentRunID_TestRunID
    END

    CLOSE cascade_update_false_AgentRunID_cursor
    DEALLOCATE cascade_update_false_AgentRunID_cursor
    

    DELETE FROM
        [${flyway:defaultSchema}].[AIAgentRun]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIAgentRun] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: AI Agent Runs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIAgentRun] TO [cdp_Integration]



/* Base View SQL for MJ: AI Configurations */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Configurations
-- Item: vwAIConfigurations
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: AI Configurations
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  AIConfiguration
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwAIConfigurations]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwAIConfigurations];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwAIConfigurations]
AS
SELECT
    m.*,
    MJAIPrompts_DefaultPromptForContextCompressionID.[Name] AS [DefaultPromptForContextCompression],
    MJAIPrompts_DefaultPromptForContextSummarizationID.[Name] AS [DefaultPromptForContextSummarization],
    MJFileStorageProviders_DefaultStorageProviderID.[Name] AS [DefaultStorageProvider],
    MJAIConfigurations_ParentID.[Name] AS [Parent],
    root_ParentID.RootID AS [RootParentID]
FROM
    [${flyway:defaultSchema}].[AIConfiguration] AS m
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[AIPrompt] AS MJAIPrompts_DefaultPromptForContextCompressionID
  ON
    [m].[DefaultPromptForContextCompressionID] = MJAIPrompts_DefaultPromptForContextCompressionID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[AIPrompt] AS MJAIPrompts_DefaultPromptForContextSummarizationID
  ON
    [m].[DefaultPromptForContextSummarizationID] = MJAIPrompts_DefaultPromptForContextSummarizationID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[FileStorageProvider] AS MJFileStorageProviders_DefaultStorageProviderID
  ON
    [m].[DefaultStorageProviderID] = MJFileStorageProviders_DefaultStorageProviderID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[AIConfiguration] AS MJAIConfigurations_ParentID
  ON
    [m].[ParentID] = MJAIConfigurations_ParentID.[ID]
OUTER APPLY
    [${flyway:defaultSchema}].[fnAIConfigurationParentID_GetRootID]([m].[ID], [m].[ParentID]) AS root_ParentID
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwAIConfigurations] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: AI Configurations */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Configurations
-- Item: Permissions for vwAIConfigurations
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwAIConfigurations] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: AI Configurations */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Configurations
-- Item: spCreateMJAIConfiguration
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR AIConfiguration
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJAIConfiguration]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIConfiguration];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIConfiguration]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(100),
    @Description nvarchar(MAX),
    @IsDefault bit = NULL,
    @Status nvarchar(20) = NULL,
    @DefaultPromptForContextCompressionID uniqueidentifier,
    @DefaultPromptForContextSummarizationID uniqueidentifier,
    @DefaultStorageProviderID uniqueidentifier,
    @DefaultStorageRootPath nvarchar(500),
    @ParentID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[AIConfiguration]
            (
                [ID],
                [Name],
                [Description],
                [IsDefault],
                [Status],
                [DefaultPromptForContextCompressionID],
                [DefaultPromptForContextSummarizationID],
                [DefaultStorageProviderID],
                [DefaultStorageRootPath],
                [ParentID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description,
                ISNULL(@IsDefault, 0),
                ISNULL(@Status, 'Active'),
                @DefaultPromptForContextCompressionID,
                @DefaultPromptForContextSummarizationID,
                @DefaultStorageProviderID,
                @DefaultStorageRootPath,
                @ParentID
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[AIConfiguration]
            (
                [Name],
                [Description],
                [IsDefault],
                [Status],
                [DefaultPromptForContextCompressionID],
                [DefaultPromptForContextSummarizationID],
                [DefaultStorageProviderID],
                [DefaultStorageRootPath],
                [ParentID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description,
                ISNULL(@IsDefault, 0),
                ISNULL(@Status, 'Active'),
                @DefaultPromptForContextCompressionID,
                @DefaultPromptForContextSummarizationID,
                @DefaultStorageProviderID,
                @DefaultStorageRootPath,
                @ParentID
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwAIConfigurations] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIConfiguration] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: AI Configurations */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIConfiguration] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: AI Configurations */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Configurations
-- Item: spUpdateMJAIConfiguration
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR AIConfiguration
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJAIConfiguration]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIConfiguration];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIConfiguration]
    @ID uniqueidentifier,
    @Name nvarchar(100),
    @Description nvarchar(MAX),
    @IsDefault bit,
    @Status nvarchar(20),
    @DefaultPromptForContextCompressionID uniqueidentifier,
    @DefaultPromptForContextSummarizationID uniqueidentifier,
    @DefaultStorageProviderID uniqueidentifier,
    @DefaultStorageRootPath nvarchar(500),
    @ParentID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIConfiguration]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [IsDefault] = @IsDefault,
        [Status] = @Status,
        [DefaultPromptForContextCompressionID] = @DefaultPromptForContextCompressionID,
        [DefaultPromptForContextSummarizationID] = @DefaultPromptForContextSummarizationID,
        [DefaultStorageProviderID] = @DefaultStorageProviderID,
        [DefaultStorageRootPath] = @DefaultStorageRootPath,
        [ParentID] = @ParentID
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwAIConfigurations] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwAIConfigurations]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIConfiguration] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the AIConfiguration table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJAIConfiguration]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJAIConfiguration];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJAIConfiguration
ON [${flyway:defaultSchema}].[AIConfiguration]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIConfiguration]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[AIConfiguration] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: AI Configurations */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIConfiguration] TO [cdp_Developer], [cdp_Integration]



/* Base View SQL for MJ: AI Architectures */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Architectures
-- Item: vwAIArchitectures
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: AI Architectures
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  AIArchitecture
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwAIArchitectures]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwAIArchitectures];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwAIArchitectures]
AS
SELECT
    m.*,
    MJAIArchitectures_ParentArchitectureID.[Name] AS [ParentArchitecture],
    root_ParentArchitectureID.RootID AS [RootParentArchitectureID]
FROM
    [${flyway:defaultSchema}].[AIArchitecture] AS m
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[AIArchitecture] AS MJAIArchitectures_ParentArchitectureID
  ON
    [m].[ParentArchitectureID] = MJAIArchitectures_ParentArchitectureID.[ID]
OUTER APPLY
    [${flyway:defaultSchema}].[fnAIArchitectureParentArchitectureID_GetRootID]([m].[ID], [m].[ParentArchitectureID]) AS root_ParentArchitectureID
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwAIArchitectures] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: AI Architectures */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Architectures
-- Item: Permissions for vwAIArchitectures
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwAIArchitectures] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: AI Architectures */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Architectures
-- Item: spCreateMJAIArchitecture
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR AIArchitecture
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJAIArchitecture]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIArchitecture];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIArchitecture]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(100),
    @Description nvarchar(MAX),
    @Category nvarchar(50),
    @ParentArchitectureID uniqueidentifier,
    @WikipediaURL nvarchar(500),
    @YearIntroduced int,
    @KeyPaper nvarchar(500)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[AIArchitecture]
            (
                [ID],
                [Name],
                [Description],
                [Category],
                [ParentArchitectureID],
                [WikipediaURL],
                [YearIntroduced],
                [KeyPaper]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description,
                @Category,
                @ParentArchitectureID,
                @WikipediaURL,
                @YearIntroduced,
                @KeyPaper
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[AIArchitecture]
            (
                [Name],
                [Description],
                [Category],
                [ParentArchitectureID],
                [WikipediaURL],
                [YearIntroduced],
                [KeyPaper]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description,
                @Category,
                @ParentArchitectureID,
                @WikipediaURL,
                @YearIntroduced,
                @KeyPaper
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwAIArchitectures] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIArchitecture] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: AI Architectures */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIArchitecture] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: AI Architectures */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Architectures
-- Item: spUpdateMJAIArchitecture
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR AIArchitecture
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJAIArchitecture]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIArchitecture];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIArchitecture]
    @ID uniqueidentifier,
    @Name nvarchar(100),
    @Description nvarchar(MAX),
    @Category nvarchar(50),
    @ParentArchitectureID uniqueidentifier,
    @WikipediaURL nvarchar(500),
    @YearIntroduced int,
    @KeyPaper nvarchar(500)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIArchitecture]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [Category] = @Category,
        [ParentArchitectureID] = @ParentArchitectureID,
        [WikipediaURL] = @WikipediaURL,
        [YearIntroduced] = @YearIntroduced,
        [KeyPaper] = @KeyPaper
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwAIArchitectures] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwAIArchitectures]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIArchitecture] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the AIArchitecture table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJAIArchitecture]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJAIArchitecture];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJAIArchitecture
ON [${flyway:defaultSchema}].[AIArchitecture]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIArchitecture]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[AIArchitecture] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: AI Architectures */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIArchitecture] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: AI Architectures */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Architectures
-- Item: spDeleteMJAIArchitecture
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR AIArchitecture
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJAIArchitecture]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIArchitecture];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIArchitecture]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[AIArchitecture]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIArchitecture] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: AI Architectures */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIArchitecture] TO [cdp_Integration]



/* Base View SQL for MJ: AI Credential Bindings */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Credential Bindings
-- Item: vwAICredentialBindings
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: AI Credential Bindings
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  AICredentialBinding
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwAICredentialBindings]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwAICredentialBindings];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwAICredentialBindings]
AS
SELECT
    m.*,
    MJCredentials_CredentialID.[Name] AS [Credential],
    MJAIVendors_AIVendorID.[Name] AS [AIVendor],
    MJAIModelVendors_AIModelVendorID.[Model] AS [AIModelVendor],
    MJAIPromptModels_AIPromptModelID.[Prompt] AS [AIPromptModel]
FROM
    [${flyway:defaultSchema}].[AICredentialBinding] AS m
INNER JOIN
    [${flyway:defaultSchema}].[Credential] AS MJCredentials_CredentialID
  ON
    [m].[CredentialID] = MJCredentials_CredentialID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[AIVendor] AS MJAIVendors_AIVendorID
  ON
    [m].[AIVendorID] = MJAIVendors_AIVendorID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[vwAIModelVendors] AS MJAIModelVendors_AIModelVendorID
  ON
    [m].[AIModelVendorID] = MJAIModelVendors_AIModelVendorID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[vwAIPromptModels] AS MJAIPromptModels_AIPromptModelID
  ON
    [m].[AIPromptModelID] = MJAIPromptModels_AIPromptModelID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwAICredentialBindings] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: AI Credential Bindings */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Credential Bindings
-- Item: Permissions for vwAICredentialBindings
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwAICredentialBindings] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: AI Credential Bindings */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Credential Bindings
-- Item: spCreateMJAICredentialBinding
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR AICredentialBinding
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJAICredentialBinding]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJAICredentialBinding];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJAICredentialBinding]
    @ID uniqueidentifier = NULL,
    @CredentialID uniqueidentifier,
    @BindingType nvarchar(20),
    @AIVendorID uniqueidentifier,
    @AIModelVendorID uniqueidentifier,
    @AIPromptModelID uniqueidentifier,
    @Priority int = NULL,
    @IsActive bit = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[AICredentialBinding]
            (
                [ID],
                [CredentialID],
                [BindingType],
                [AIVendorID],
                [AIModelVendorID],
                [AIPromptModelID],
                [Priority],
                [IsActive]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @CredentialID,
                @BindingType,
                @AIVendorID,
                @AIModelVendorID,
                @AIPromptModelID,
                ISNULL(@Priority, 0),
                ISNULL(@IsActive, 1)
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[AICredentialBinding]
            (
                [CredentialID],
                [BindingType],
                [AIVendorID],
                [AIModelVendorID],
                [AIPromptModelID],
                [Priority],
                [IsActive]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @CredentialID,
                @BindingType,
                @AIVendorID,
                @AIModelVendorID,
                @AIPromptModelID,
                ISNULL(@Priority, 0),
                ISNULL(@IsActive, 1)
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwAICredentialBindings] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAICredentialBinding] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: AI Credential Bindings */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAICredentialBinding] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: AI Credential Bindings */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Credential Bindings
-- Item: spUpdateMJAICredentialBinding
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR AICredentialBinding
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJAICredentialBinding]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAICredentialBinding];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAICredentialBinding]
    @ID uniqueidentifier,
    @CredentialID uniqueidentifier,
    @BindingType nvarchar(20),
    @AIVendorID uniqueidentifier,
    @AIModelVendorID uniqueidentifier,
    @AIPromptModelID uniqueidentifier,
    @Priority int,
    @IsActive bit
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AICredentialBinding]
    SET
        [CredentialID] = @CredentialID,
        [BindingType] = @BindingType,
        [AIVendorID] = @AIVendorID,
        [AIModelVendorID] = @AIModelVendorID,
        [AIPromptModelID] = @AIPromptModelID,
        [Priority] = @Priority,
        [IsActive] = @IsActive
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwAICredentialBindings] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwAICredentialBindings]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAICredentialBinding] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the AICredentialBinding table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJAICredentialBinding]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJAICredentialBinding];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJAICredentialBinding
ON [${flyway:defaultSchema}].[AICredentialBinding]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AICredentialBinding]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[AICredentialBinding] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: AI Credential Bindings */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAICredentialBinding] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: AI Credential Bindings */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Credential Bindings
-- Item: spDeleteMJAICredentialBinding
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR AICredentialBinding
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJAICredentialBinding]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAICredentialBinding];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAICredentialBinding]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[AICredentialBinding]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAICredentialBinding] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: AI Credential Bindings */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAICredentialBinding] TO [cdp_Integration]



/* Base View SQL for MJ: AI Agents */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agents
-- Item: vwAIAgents
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: AI Agents
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  AIAgent
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwAIAgents]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwAIAgents];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwAIAgents]
AS
SELECT
    m.*,
    MJAIAgents_ParentID.[Name] AS [Parent],
    MJAIPrompts_ContextCompressionPromptID.[Name] AS [ContextCompressionPrompt],
    MJAIAgentTypes_TypeID.[Name] AS [Type],
    MJArtifactTypes_DefaultArtifactTypeID.[Name] AS [DefaultArtifactType],
    MJUsers_OwnerUserID.[Name] AS [OwnerUser],
    MJFileStorageProviders_AttachmentStorageProviderID.[Name] AS [AttachmentStorageProvider],
    root_ParentID.RootID AS [RootParentID]
FROM
    [${flyway:defaultSchema}].[AIAgent] AS m
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[AIAgent] AS MJAIAgents_ParentID
  ON
    [m].[ParentID] = MJAIAgents_ParentID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[AIPrompt] AS MJAIPrompts_ContextCompressionPromptID
  ON
    [m].[ContextCompressionPromptID] = MJAIPrompts_ContextCompressionPromptID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[AIAgentType] AS MJAIAgentTypes_TypeID
  ON
    [m].[TypeID] = MJAIAgentTypes_TypeID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[ArtifactType] AS MJArtifactTypes_DefaultArtifactTypeID
  ON
    [m].[DefaultArtifactTypeID] = MJArtifactTypes_DefaultArtifactTypeID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_OwnerUserID
  ON
    [m].[OwnerUserID] = MJUsers_OwnerUserID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[FileStorageProvider] AS MJFileStorageProviders_AttachmentStorageProviderID
  ON
    [m].[AttachmentStorageProviderID] = MJFileStorageProviders_AttachmentStorageProviderID.[ID]
OUTER APPLY
    [${flyway:defaultSchema}].[fnAIAgentParentID_GetRootID]([m].[ID], [m].[ParentID]) AS root_ParentID
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwAIAgents] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: AI Agents */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agents
-- Item: Permissions for vwAIAgents
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwAIAgents] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: AI Agents */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agents
-- Item: spCreateMJAIAgent
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR AIAgent
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJAIAgent]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIAgent];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIAgent]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @LogoURL nvarchar(255),
    @ParentID uniqueidentifier,
    @ExposeAsAction bit = NULL,
    @ExecutionOrder int = NULL,
    @ExecutionMode nvarchar(20) = NULL,
    @EnableContextCompression bit = NULL,
    @ContextCompressionMessageThreshold int,
    @ContextCompressionPromptID uniqueidentifier,
    @ContextCompressionMessageRetentionCount int,
    @TypeID uniqueidentifier,
    @Status nvarchar(20) = NULL,
    @DriverClass nvarchar(255),
    @IconClass nvarchar(100),
    @ModelSelectionMode nvarchar(50) = NULL,
    @PayloadDownstreamPaths nvarchar(MAX) = NULL,
    @PayloadUpstreamPaths nvarchar(MAX) = NULL,
    @PayloadSelfReadPaths nvarchar(MAX),
    @PayloadSelfWritePaths nvarchar(MAX),
    @PayloadScope nvarchar(MAX),
    @FinalPayloadValidation nvarchar(MAX),
    @FinalPayloadValidationMode nvarchar(25) = NULL,
    @FinalPayloadValidationMaxRetries int = NULL,
    @MaxCostPerRun decimal(10, 4),
    @MaxTokensPerRun int,
    @MaxIterationsPerRun int,
    @MaxTimePerRun int,
    @MinExecutionsPerRun int,
    @MaxExecutionsPerRun int,
    @StartingPayloadValidation nvarchar(MAX),
    @StartingPayloadValidationMode nvarchar(25) = NULL,
    @DefaultPromptEffortLevel int,
    @ChatHandlingOption nvarchar(30),
    @DefaultArtifactTypeID uniqueidentifier,
    @OwnerUserID uniqueidentifier = NULL,
    @InvocationMode nvarchar(20) = NULL,
    @ArtifactCreationMode nvarchar(20) = NULL,
    @FunctionalRequirements nvarchar(MAX),
    @TechnicalDesign nvarchar(MAX),
    @InjectNotes bit = NULL,
    @MaxNotesToInject int = NULL,
    @NoteInjectionStrategy nvarchar(20) = NULL,
    @InjectExamples bit = NULL,
    @MaxExamplesToInject int = NULL,
    @ExampleInjectionStrategy nvarchar(20) = NULL,
    @IsRestricted bit = NULL,
    @MessageMode nvarchar(50) = NULL,
    @MaxMessages int,
    @AttachmentStorageProviderID uniqueidentifier,
    @AttachmentRootPath nvarchar(500),
    @InlineStorageThresholdBytes int,
    @AgentTypePromptParams nvarchar(MAX),
    @ScopeConfig nvarchar(MAX),
    @NoteRetentionDays int,
    @ExampleRetentionDays int,
    @AutoArchiveEnabled bit = NULL,
    @RerankerConfiguration nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[AIAgent]
            (
                [ID],
                [Name],
                [Description],
                [LogoURL],
                [ParentID],
                [ExposeAsAction],
                [ExecutionOrder],
                [ExecutionMode],
                [EnableContextCompression],
                [ContextCompressionMessageThreshold],
                [ContextCompressionPromptID],
                [ContextCompressionMessageRetentionCount],
                [TypeID],
                [Status],
                [DriverClass],
                [IconClass],
                [ModelSelectionMode],
                [PayloadDownstreamPaths],
                [PayloadUpstreamPaths],
                [PayloadSelfReadPaths],
                [PayloadSelfWritePaths],
                [PayloadScope],
                [FinalPayloadValidation],
                [FinalPayloadValidationMode],
                [FinalPayloadValidationMaxRetries],
                [MaxCostPerRun],
                [MaxTokensPerRun],
                [MaxIterationsPerRun],
                [MaxTimePerRun],
                [MinExecutionsPerRun],
                [MaxExecutionsPerRun],
                [StartingPayloadValidation],
                [StartingPayloadValidationMode],
                [DefaultPromptEffortLevel],
                [ChatHandlingOption],
                [DefaultArtifactTypeID],
                [OwnerUserID],
                [InvocationMode],
                [ArtifactCreationMode],
                [FunctionalRequirements],
                [TechnicalDesign],
                [InjectNotes],
                [MaxNotesToInject],
                [NoteInjectionStrategy],
                [InjectExamples],
                [MaxExamplesToInject],
                [ExampleInjectionStrategy],
                [IsRestricted],
                [MessageMode],
                [MaxMessages],
                [AttachmentStorageProviderID],
                [AttachmentRootPath],
                [InlineStorageThresholdBytes],
                [AgentTypePromptParams],
                [ScopeConfig],
                [NoteRetentionDays],
                [ExampleRetentionDays],
                [AutoArchiveEnabled],
                [RerankerConfiguration]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description,
                @LogoURL,
                @ParentID,
                ISNULL(@ExposeAsAction, 0),
                ISNULL(@ExecutionOrder, 0),
                ISNULL(@ExecutionMode, 'Sequential'),
                ISNULL(@EnableContextCompression, 0),
                @ContextCompressionMessageThreshold,
                @ContextCompressionPromptID,
                @ContextCompressionMessageRetentionCount,
                @TypeID,
                ISNULL(@Status, 'Pending'),
                @DriverClass,
                @IconClass,
                ISNULL(@ModelSelectionMode, 'Agent Type'),
                ISNULL(@PayloadDownstreamPaths, '["*"]'),
                ISNULL(@PayloadUpstreamPaths, '["*"]'),
                @PayloadSelfReadPaths,
                @PayloadSelfWritePaths,
                @PayloadScope,
                @FinalPayloadValidation,
                ISNULL(@FinalPayloadValidationMode, 'Retry'),
                ISNULL(@FinalPayloadValidationMaxRetries, 3),
                @MaxCostPerRun,
                @MaxTokensPerRun,
                @MaxIterationsPerRun,
                @MaxTimePerRun,
                @MinExecutionsPerRun,
                @MaxExecutionsPerRun,
                @StartingPayloadValidation,
                ISNULL(@StartingPayloadValidationMode, 'Fail'),
                @DefaultPromptEffortLevel,
                @ChatHandlingOption,
                @DefaultArtifactTypeID,
                CASE @OwnerUserID WHEN '00000000-0000-0000-0000-000000000000' THEN 'ECAFCCEC-6A37-EF11-86D4-000D3A4E707E' ELSE ISNULL(@OwnerUserID, 'ECAFCCEC-6A37-EF11-86D4-000D3A4E707E') END,
                ISNULL(@InvocationMode, 'Any'),
                ISNULL(@ArtifactCreationMode, 'Always'),
                @FunctionalRequirements,
                @TechnicalDesign,
                ISNULL(@InjectNotes, 1),
                ISNULL(@MaxNotesToInject, 5),
                ISNULL(@NoteInjectionStrategy, 'Relevant'),
                ISNULL(@InjectExamples, 0),
                ISNULL(@MaxExamplesToInject, 3),
                ISNULL(@ExampleInjectionStrategy, 'Semantic'),
                ISNULL(@IsRestricted, 0),
                ISNULL(@MessageMode, 'None'),
                @MaxMessages,
                @AttachmentStorageProviderID,
                @AttachmentRootPath,
                @InlineStorageThresholdBytes,
                @AgentTypePromptParams,
                @ScopeConfig,
                @NoteRetentionDays,
                @ExampleRetentionDays,
                ISNULL(@AutoArchiveEnabled, 1),
                @RerankerConfiguration
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[AIAgent]
            (
                [Name],
                [Description],
                [LogoURL],
                [ParentID],
                [ExposeAsAction],
                [ExecutionOrder],
                [ExecutionMode],
                [EnableContextCompression],
                [ContextCompressionMessageThreshold],
                [ContextCompressionPromptID],
                [ContextCompressionMessageRetentionCount],
                [TypeID],
                [Status],
                [DriverClass],
                [IconClass],
                [ModelSelectionMode],
                [PayloadDownstreamPaths],
                [PayloadUpstreamPaths],
                [PayloadSelfReadPaths],
                [PayloadSelfWritePaths],
                [PayloadScope],
                [FinalPayloadValidation],
                [FinalPayloadValidationMode],
                [FinalPayloadValidationMaxRetries],
                [MaxCostPerRun],
                [MaxTokensPerRun],
                [MaxIterationsPerRun],
                [MaxTimePerRun],
                [MinExecutionsPerRun],
                [MaxExecutionsPerRun],
                [StartingPayloadValidation],
                [StartingPayloadValidationMode],
                [DefaultPromptEffortLevel],
                [ChatHandlingOption],
                [DefaultArtifactTypeID],
                [OwnerUserID],
                [InvocationMode],
                [ArtifactCreationMode],
                [FunctionalRequirements],
                [TechnicalDesign],
                [InjectNotes],
                [MaxNotesToInject],
                [NoteInjectionStrategy],
                [InjectExamples],
                [MaxExamplesToInject],
                [ExampleInjectionStrategy],
                [IsRestricted],
                [MessageMode],
                [MaxMessages],
                [AttachmentStorageProviderID],
                [AttachmentRootPath],
                [InlineStorageThresholdBytes],
                [AgentTypePromptParams],
                [ScopeConfig],
                [NoteRetentionDays],
                [ExampleRetentionDays],
                [AutoArchiveEnabled],
                [RerankerConfiguration]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description,
                @LogoURL,
                @ParentID,
                ISNULL(@ExposeAsAction, 0),
                ISNULL(@ExecutionOrder, 0),
                ISNULL(@ExecutionMode, 'Sequential'),
                ISNULL(@EnableContextCompression, 0),
                @ContextCompressionMessageThreshold,
                @ContextCompressionPromptID,
                @ContextCompressionMessageRetentionCount,
                @TypeID,
                ISNULL(@Status, 'Pending'),
                @DriverClass,
                @IconClass,
                ISNULL(@ModelSelectionMode, 'Agent Type'),
                ISNULL(@PayloadDownstreamPaths, '["*"]'),
                ISNULL(@PayloadUpstreamPaths, '["*"]'),
                @PayloadSelfReadPaths,
                @PayloadSelfWritePaths,
                @PayloadScope,
                @FinalPayloadValidation,
                ISNULL(@FinalPayloadValidationMode, 'Retry'),
                ISNULL(@FinalPayloadValidationMaxRetries, 3),
                @MaxCostPerRun,
                @MaxTokensPerRun,
                @MaxIterationsPerRun,
                @MaxTimePerRun,
                @MinExecutionsPerRun,
                @MaxExecutionsPerRun,
                @StartingPayloadValidation,
                ISNULL(@StartingPayloadValidationMode, 'Fail'),
                @DefaultPromptEffortLevel,
                @ChatHandlingOption,
                @DefaultArtifactTypeID,
                CASE @OwnerUserID WHEN '00000000-0000-0000-0000-000000000000' THEN 'ECAFCCEC-6A37-EF11-86D4-000D3A4E707E' ELSE ISNULL(@OwnerUserID, 'ECAFCCEC-6A37-EF11-86D4-000D3A4E707E') END,
                ISNULL(@InvocationMode, 'Any'),
                ISNULL(@ArtifactCreationMode, 'Always'),
                @FunctionalRequirements,
                @TechnicalDesign,
                ISNULL(@InjectNotes, 1),
                ISNULL(@MaxNotesToInject, 5),
                ISNULL(@NoteInjectionStrategy, 'Relevant'),
                ISNULL(@InjectExamples, 0),
                ISNULL(@MaxExamplesToInject, 3),
                ISNULL(@ExampleInjectionStrategy, 'Semantic'),
                ISNULL(@IsRestricted, 0),
                ISNULL(@MessageMode, 'None'),
                @MaxMessages,
                @AttachmentStorageProviderID,
                @AttachmentRootPath,
                @InlineStorageThresholdBytes,
                @AgentTypePromptParams,
                @ScopeConfig,
                @NoteRetentionDays,
                @ExampleRetentionDays,
                ISNULL(@AutoArchiveEnabled, 1),
                @RerankerConfiguration
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwAIAgents] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIAgent] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: AI Agents */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIAgent] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: AI Agents */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agents
-- Item: spUpdateMJAIAgent
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR AIAgent
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJAIAgent]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIAgent];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIAgent]
    @ID uniqueidentifier,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @LogoURL nvarchar(255),
    @ParentID uniqueidentifier,
    @ExposeAsAction bit,
    @ExecutionOrder int,
    @ExecutionMode nvarchar(20),
    @EnableContextCompression bit,
    @ContextCompressionMessageThreshold int,
    @ContextCompressionPromptID uniqueidentifier,
    @ContextCompressionMessageRetentionCount int,
    @TypeID uniqueidentifier,
    @Status nvarchar(20),
    @DriverClass nvarchar(255),
    @IconClass nvarchar(100),
    @ModelSelectionMode nvarchar(50),
    @PayloadDownstreamPaths nvarchar(MAX),
    @PayloadUpstreamPaths nvarchar(MAX),
    @PayloadSelfReadPaths nvarchar(MAX),
    @PayloadSelfWritePaths nvarchar(MAX),
    @PayloadScope nvarchar(MAX),
    @FinalPayloadValidation nvarchar(MAX),
    @FinalPayloadValidationMode nvarchar(25),
    @FinalPayloadValidationMaxRetries int,
    @MaxCostPerRun decimal(10, 4),
    @MaxTokensPerRun int,
    @MaxIterationsPerRun int,
    @MaxTimePerRun int,
    @MinExecutionsPerRun int,
    @MaxExecutionsPerRun int,
    @StartingPayloadValidation nvarchar(MAX),
    @StartingPayloadValidationMode nvarchar(25),
    @DefaultPromptEffortLevel int,
    @ChatHandlingOption nvarchar(30),
    @DefaultArtifactTypeID uniqueidentifier,
    @OwnerUserID uniqueidentifier,
    @InvocationMode nvarchar(20),
    @ArtifactCreationMode nvarchar(20),
    @FunctionalRequirements nvarchar(MAX),
    @TechnicalDesign nvarchar(MAX),
    @InjectNotes bit,
    @MaxNotesToInject int,
    @NoteInjectionStrategy nvarchar(20),
    @InjectExamples bit,
    @MaxExamplesToInject int,
    @ExampleInjectionStrategy nvarchar(20),
    @IsRestricted bit,
    @MessageMode nvarchar(50),
    @MaxMessages int,
    @AttachmentStorageProviderID uniqueidentifier,
    @AttachmentRootPath nvarchar(500),
    @InlineStorageThresholdBytes int,
    @AgentTypePromptParams nvarchar(MAX),
    @ScopeConfig nvarchar(MAX),
    @NoteRetentionDays int,
    @ExampleRetentionDays int,
    @AutoArchiveEnabled bit,
    @RerankerConfiguration nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIAgent]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [LogoURL] = @LogoURL,
        [ParentID] = @ParentID,
        [ExposeAsAction] = @ExposeAsAction,
        [ExecutionOrder] = @ExecutionOrder,
        [ExecutionMode] = @ExecutionMode,
        [EnableContextCompression] = @EnableContextCompression,
        [ContextCompressionMessageThreshold] = @ContextCompressionMessageThreshold,
        [ContextCompressionPromptID] = @ContextCompressionPromptID,
        [ContextCompressionMessageRetentionCount] = @ContextCompressionMessageRetentionCount,
        [TypeID] = @TypeID,
        [Status] = @Status,
        [DriverClass] = @DriverClass,
        [IconClass] = @IconClass,
        [ModelSelectionMode] = @ModelSelectionMode,
        [PayloadDownstreamPaths] = @PayloadDownstreamPaths,
        [PayloadUpstreamPaths] = @PayloadUpstreamPaths,
        [PayloadSelfReadPaths] = @PayloadSelfReadPaths,
        [PayloadSelfWritePaths] = @PayloadSelfWritePaths,
        [PayloadScope] = @PayloadScope,
        [FinalPayloadValidation] = @FinalPayloadValidation,
        [FinalPayloadValidationMode] = @FinalPayloadValidationMode,
        [FinalPayloadValidationMaxRetries] = @FinalPayloadValidationMaxRetries,
        [MaxCostPerRun] = @MaxCostPerRun,
        [MaxTokensPerRun] = @MaxTokensPerRun,
        [MaxIterationsPerRun] = @MaxIterationsPerRun,
        [MaxTimePerRun] = @MaxTimePerRun,
        [MinExecutionsPerRun] = @MinExecutionsPerRun,
        [MaxExecutionsPerRun] = @MaxExecutionsPerRun,
        [StartingPayloadValidation] = @StartingPayloadValidation,
        [StartingPayloadValidationMode] = @StartingPayloadValidationMode,
        [DefaultPromptEffortLevel] = @DefaultPromptEffortLevel,
        [ChatHandlingOption] = @ChatHandlingOption,
        [DefaultArtifactTypeID] = @DefaultArtifactTypeID,
        [OwnerUserID] = @OwnerUserID,
        [InvocationMode] = @InvocationMode,
        [ArtifactCreationMode] = @ArtifactCreationMode,
        [FunctionalRequirements] = @FunctionalRequirements,
        [TechnicalDesign] = @TechnicalDesign,
        [InjectNotes] = @InjectNotes,
        [MaxNotesToInject] = @MaxNotesToInject,
        [NoteInjectionStrategy] = @NoteInjectionStrategy,
        [InjectExamples] = @InjectExamples,
        [MaxExamplesToInject] = @MaxExamplesToInject,
        [ExampleInjectionStrategy] = @ExampleInjectionStrategy,
        [IsRestricted] = @IsRestricted,
        [MessageMode] = @MessageMode,
        [MaxMessages] = @MaxMessages,
        [AttachmentStorageProviderID] = @AttachmentStorageProviderID,
        [AttachmentRootPath] = @AttachmentRootPath,
        [InlineStorageThresholdBytes] = @InlineStorageThresholdBytes,
        [AgentTypePromptParams] = @AgentTypePromptParams,
        [ScopeConfig] = @ScopeConfig,
        [NoteRetentionDays] = @NoteRetentionDays,
        [ExampleRetentionDays] = @ExampleRetentionDays,
        [AutoArchiveEnabled] = @AutoArchiveEnabled,
        [RerankerConfiguration] = @RerankerConfiguration
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwAIAgents] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwAIAgents]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIAgent] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the AIAgent table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJAIAgent]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJAIAgent];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJAIAgent
ON [${flyway:defaultSchema}].[AIAgent]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIAgent]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[AIAgent] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: AI Agents */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIAgent] TO [cdp_Developer], [cdp_Integration]



/* Base View SQL for MJ: AI Configuration Params */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Configuration Params
-- Item: vwAIConfigurationParams
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: AI Configuration Params
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  AIConfigurationParam
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwAIConfigurationParams]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwAIConfigurationParams];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwAIConfigurationParams]
AS
SELECT
    m.*,
    MJAIConfigurations_ConfigurationID.[Name] AS [Configuration]
FROM
    [${flyway:defaultSchema}].[AIConfigurationParam] AS m
INNER JOIN
    [${flyway:defaultSchema}].[AIConfiguration] AS MJAIConfigurations_ConfigurationID
  ON
    [m].[ConfigurationID] = MJAIConfigurations_ConfigurationID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwAIConfigurationParams] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: AI Configuration Params */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Configuration Params
-- Item: Permissions for vwAIConfigurationParams
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwAIConfigurationParams] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: AI Configuration Params */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Configuration Params
-- Item: spCreateMJAIConfigurationParam
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR AIConfigurationParam
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJAIConfigurationParam]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIConfigurationParam];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIConfigurationParam]
    @ID uniqueidentifier = NULL,
    @ConfigurationID uniqueidentifier,
    @Name nvarchar(100),
    @Type nvarchar(20) = NULL,
    @Value nvarchar(MAX),
    @Description nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[AIConfigurationParam]
            (
                [ID],
                [ConfigurationID],
                [Name],
                [Type],
                [Value],
                [Description]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @ConfigurationID,
                @Name,
                ISNULL(@Type, 'string'),
                @Value,
                @Description
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[AIConfigurationParam]
            (
                [ConfigurationID],
                [Name],
                [Type],
                [Value],
                [Description]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ConfigurationID,
                @Name,
                ISNULL(@Type, 'string'),
                @Value,
                @Description
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwAIConfigurationParams] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIConfigurationParam] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: AI Configuration Params */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIConfigurationParam] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: AI Configuration Params */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Configuration Params
-- Item: spUpdateMJAIConfigurationParam
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR AIConfigurationParam
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJAIConfigurationParam]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIConfigurationParam];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIConfigurationParam]
    @ID uniqueidentifier,
    @ConfigurationID uniqueidentifier,
    @Name nvarchar(100),
    @Type nvarchar(20),
    @Value nvarchar(MAX),
    @Description nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIConfigurationParam]
    SET
        [ConfigurationID] = @ConfigurationID,
        [Name] = @Name,
        [Type] = @Type,
        [Value] = @Value,
        [Description] = @Description
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwAIConfigurationParams] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwAIConfigurationParams]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIConfigurationParam] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the AIConfigurationParam table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJAIConfigurationParam]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJAIConfigurationParam];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJAIConfigurationParam
ON [${flyway:defaultSchema}].[AIConfigurationParam]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIConfigurationParam]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[AIConfigurationParam] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: AI Configuration Params */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIConfigurationParam] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: AI Configuration Params */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Configuration Params
-- Item: spDeleteMJAIConfigurationParam
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR AIConfigurationParam
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJAIConfigurationParam]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIConfigurationParam];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIConfigurationParam]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[AIConfigurationParam]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIConfigurationParam] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: AI Configuration Params */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIConfigurationParam] TO [cdp_Integration]



/* spDelete SQL for MJ: AI Configurations */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Configurations
-- Item: spDeleteMJAIConfiguration
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR AIConfiguration
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJAIConfiguration]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIConfiguration];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIConfiguration]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    -- Cascade update on AIAgentConfiguration using cursor to call spUpdateMJAIAgentConfiguration
    DECLARE @false_AIConfigurationIDID uniqueidentifier
    DECLARE @false_AIConfigurationID_AgentID uniqueidentifier
    DECLARE @false_AIConfigurationID_Name nvarchar(100)
    DECLARE @false_AIConfigurationID_DisplayName nvarchar(200)
    DECLARE @false_AIConfigurationID_Description nvarchar(MAX)
    DECLARE @false_AIConfigurationID_AIConfigurationID uniqueidentifier
    DECLARE @false_AIConfigurationID_IsDefault bit
    DECLARE @false_AIConfigurationID_Priority int
    DECLARE @false_AIConfigurationID_Status nvarchar(20)
    DECLARE cascade_update_false_AIConfigurationID_cursor CURSOR FOR
        SELECT [ID], [AgentID], [Name], [DisplayName], [Description], [AIConfigurationID], [IsDefault], [Priority], [Status]
        FROM [${flyway:defaultSchema}].[AIAgentConfiguration]
        WHERE [AIConfigurationID] = @ID

    OPEN cascade_update_false_AIConfigurationID_cursor
    FETCH NEXT FROM cascade_update_false_AIConfigurationID_cursor INTO @false_AIConfigurationIDID, @false_AIConfigurationID_AgentID, @false_AIConfigurationID_Name, @false_AIConfigurationID_DisplayName, @false_AIConfigurationID_Description, @false_AIConfigurationID_AIConfigurationID, @false_AIConfigurationID_IsDefault, @false_AIConfigurationID_Priority, @false_AIConfigurationID_Status

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @false_AIConfigurationID_AIConfigurationID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateMJAIAgentConfiguration] @ID = @false_AIConfigurationIDID, @AgentID = @false_AIConfigurationID_AgentID, @Name = @false_AIConfigurationID_Name, @DisplayName = @false_AIConfigurationID_DisplayName, @Description = @false_AIConfigurationID_Description, @AIConfigurationID = @false_AIConfigurationID_AIConfigurationID, @IsDefault = @false_AIConfigurationID_IsDefault, @Priority = @false_AIConfigurationID_Priority, @Status = @false_AIConfigurationID_Status

        FETCH NEXT FROM cascade_update_false_AIConfigurationID_cursor INTO @false_AIConfigurationIDID, @false_AIConfigurationID_AgentID, @false_AIConfigurationID_Name, @false_AIConfigurationID_DisplayName, @false_AIConfigurationID_Description, @false_AIConfigurationID_AIConfigurationID, @false_AIConfigurationID_IsDefault, @false_AIConfigurationID_Priority, @false_AIConfigurationID_Status
    END

    CLOSE cascade_update_false_AIConfigurationID_cursor
    DEALLOCATE cascade_update_false_AIConfigurationID_cursor
    
    -- Cascade delete from AIAgentPrompt using cursor to call spDeleteMJAIAgentPrompt
    DECLARE @false_ConfigurationIDID uniqueidentifier
    DECLARE cascade_delete_false_ConfigurationID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[AIAgentPrompt]
        WHERE [ConfigurationID] = @ID
    
    OPEN cascade_delete_false_ConfigurationID_cursor
    FETCH NEXT FROM cascade_delete_false_ConfigurationID_cursor INTO @false_ConfigurationIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteMJAIAgentPrompt] @ID = @false_ConfigurationIDID
        
        FETCH NEXT FROM cascade_delete_false_ConfigurationID_cursor INTO @false_ConfigurationIDID
    END
    
    CLOSE cascade_delete_false_ConfigurationID_cursor
    DEALLOCATE cascade_delete_false_ConfigurationID_cursor
    
    -- Cascade update on AIAgentRun using cursor to call spUpdateMJAIAgentRun
    DECLARE @false_ConfigurationIDID uniqueidentifier
    DECLARE @false_ConfigurationID_AgentID uniqueidentifier
    DECLARE @false_ConfigurationID_ParentRunID uniqueidentifier
    DECLARE @false_ConfigurationID_Status nvarchar(50)
    DECLARE @false_ConfigurationID_StartedAt datetimeoffset
    DECLARE @false_ConfigurationID_CompletedAt datetimeoffset
    DECLARE @false_ConfigurationID_Success bit
    DECLARE @false_ConfigurationID_ErrorMessage nvarchar(MAX)
    DECLARE @false_ConfigurationID_ConversationID uniqueidentifier
    DECLARE @false_ConfigurationID_UserID uniqueidentifier
    DECLARE @false_ConfigurationID_Result nvarchar(MAX)
    DECLARE @false_ConfigurationID_AgentState nvarchar(MAX)
    DECLARE @false_ConfigurationID_TotalTokensUsed int
    DECLARE @false_ConfigurationID_TotalCost decimal(18, 6)
    DECLARE @false_ConfigurationID_TotalPromptTokensUsed int
    DECLARE @false_ConfigurationID_TotalCompletionTokensUsed int
    DECLARE @false_ConfigurationID_TotalTokensUsedRollup int
    DECLARE @false_ConfigurationID_TotalPromptTokensUsedRollup int
    DECLARE @false_ConfigurationID_TotalCompletionTokensUsedRollup int
    DECLARE @false_ConfigurationID_TotalCostRollup decimal(19, 8)
    DECLARE @false_ConfigurationID_ConversationDetailID uniqueidentifier
    DECLARE @false_ConfigurationID_ConversationDetailSequence int
    DECLARE @false_ConfigurationID_CancellationReason nvarchar(30)
    DECLARE @false_ConfigurationID_FinalStep nvarchar(30)
    DECLARE @false_ConfigurationID_FinalPayload nvarchar(MAX)
    DECLARE @false_ConfigurationID_Message nvarchar(MAX)
    DECLARE @false_ConfigurationID_LastRunID uniqueidentifier
    DECLARE @false_ConfigurationID_StartingPayload nvarchar(MAX)
    DECLARE @false_ConfigurationID_TotalPromptIterations int
    DECLARE @false_ConfigurationID_ConfigurationID uniqueidentifier
    DECLARE @false_ConfigurationID_OverrideModelID uniqueidentifier
    DECLARE @false_ConfigurationID_OverrideVendorID uniqueidentifier
    DECLARE @false_ConfigurationID_Data nvarchar(MAX)
    DECLARE @false_ConfigurationID_Verbose bit
    DECLARE @false_ConfigurationID_EffortLevel int
    DECLARE @false_ConfigurationID_RunName nvarchar(255)
    DECLARE @false_ConfigurationID_Comments nvarchar(MAX)
    DECLARE @false_ConfigurationID_ScheduledJobRunID uniqueidentifier
    DECLARE @false_ConfigurationID_TestRunID uniqueidentifier
    DECLARE @false_ConfigurationID_PrimaryScopeEntityID uniqueidentifier
    DECLARE @false_ConfigurationID_PrimaryScopeRecordID nvarchar(100)
    DECLARE @false_ConfigurationID_SecondaryScopes nvarchar(MAX)
    DECLARE cascade_update_false_ConfigurationID_cursor CURSOR FOR
        SELECT [ID], [AgentID], [ParentRunID], [Status], [StartedAt], [CompletedAt], [Success], [ErrorMessage], [ConversationID], [UserID], [Result], [AgentState], [TotalTokensUsed], [TotalCost], [TotalPromptTokensUsed], [TotalCompletionTokensUsed], [TotalTokensUsedRollup], [TotalPromptTokensUsedRollup], [TotalCompletionTokensUsedRollup], [TotalCostRollup], [ConversationDetailID], [ConversationDetailSequence], [CancellationReason], [FinalStep], [FinalPayload], [Message], [LastRunID], [StartingPayload], [TotalPromptIterations], [ConfigurationID], [OverrideModelID], [OverrideVendorID], [Data], [Verbose], [EffortLevel], [RunName], [Comments], [ScheduledJobRunID], [TestRunID], [PrimaryScopeEntityID], [PrimaryScopeRecordID], [SecondaryScopes]
        FROM [${flyway:defaultSchema}].[AIAgentRun]
        WHERE [ConfigurationID] = @ID

    OPEN cascade_update_false_ConfigurationID_cursor
    FETCH NEXT FROM cascade_update_false_ConfigurationID_cursor INTO @false_ConfigurationIDID, @false_ConfigurationID_AgentID, @false_ConfigurationID_ParentRunID, @false_ConfigurationID_Status, @false_ConfigurationID_StartedAt, @false_ConfigurationID_CompletedAt, @false_ConfigurationID_Success, @false_ConfigurationID_ErrorMessage, @false_ConfigurationID_ConversationID, @false_ConfigurationID_UserID, @false_ConfigurationID_Result, @false_ConfigurationID_AgentState, @false_ConfigurationID_TotalTokensUsed, @false_ConfigurationID_TotalCost, @false_ConfigurationID_TotalPromptTokensUsed, @false_ConfigurationID_TotalCompletionTokensUsed, @false_ConfigurationID_TotalTokensUsedRollup, @false_ConfigurationID_TotalPromptTokensUsedRollup, @false_ConfigurationID_TotalCompletionTokensUsedRollup, @false_ConfigurationID_TotalCostRollup, @false_ConfigurationID_ConversationDetailID, @false_ConfigurationID_ConversationDetailSequence, @false_ConfigurationID_CancellationReason, @false_ConfigurationID_FinalStep, @false_ConfigurationID_FinalPayload, @false_ConfigurationID_Message, @false_ConfigurationID_LastRunID, @false_ConfigurationID_StartingPayload, @false_ConfigurationID_TotalPromptIterations, @false_ConfigurationID_ConfigurationID, @false_ConfigurationID_OverrideModelID, @false_ConfigurationID_OverrideVendorID, @false_ConfigurationID_Data, @false_ConfigurationID_Verbose, @false_ConfigurationID_EffortLevel, @false_ConfigurationID_RunName, @false_ConfigurationID_Comments, @false_ConfigurationID_ScheduledJobRunID, @false_ConfigurationID_TestRunID, @false_ConfigurationID_PrimaryScopeEntityID, @false_ConfigurationID_PrimaryScopeRecordID, @false_ConfigurationID_SecondaryScopes

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @false_ConfigurationID_ConfigurationID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateMJAIAgentRun] @ID = @false_ConfigurationIDID, @AgentID = @false_ConfigurationID_AgentID, @ParentRunID = @false_ConfigurationID_ParentRunID, @Status = @false_ConfigurationID_Status, @StartedAt = @false_ConfigurationID_StartedAt, @CompletedAt = @false_ConfigurationID_CompletedAt, @Success = @false_ConfigurationID_Success, @ErrorMessage = @false_ConfigurationID_ErrorMessage, @ConversationID = @false_ConfigurationID_ConversationID, @UserID = @false_ConfigurationID_UserID, @Result = @false_ConfigurationID_Result, @AgentState = @false_ConfigurationID_AgentState, @TotalTokensUsed = @false_ConfigurationID_TotalTokensUsed, @TotalCost = @false_ConfigurationID_TotalCost, @TotalPromptTokensUsed = @false_ConfigurationID_TotalPromptTokensUsed, @TotalCompletionTokensUsed = @false_ConfigurationID_TotalCompletionTokensUsed, @TotalTokensUsedRollup = @false_ConfigurationID_TotalTokensUsedRollup, @TotalPromptTokensUsedRollup = @false_ConfigurationID_TotalPromptTokensUsedRollup, @TotalCompletionTokensUsedRollup = @false_ConfigurationID_TotalCompletionTokensUsedRollup, @TotalCostRollup = @false_ConfigurationID_TotalCostRollup, @ConversationDetailID = @false_ConfigurationID_ConversationDetailID, @ConversationDetailSequence = @false_ConfigurationID_ConversationDetailSequence, @CancellationReason = @false_ConfigurationID_CancellationReason, @FinalStep = @false_ConfigurationID_FinalStep, @FinalPayload = @false_ConfigurationID_FinalPayload, @Message = @false_ConfigurationID_Message, @LastRunID = @false_ConfigurationID_LastRunID, @StartingPayload = @false_ConfigurationID_StartingPayload, @TotalPromptIterations = @false_ConfigurationID_TotalPromptIterations, @ConfigurationID = @false_ConfigurationID_ConfigurationID, @OverrideModelID = @false_ConfigurationID_OverrideModelID, @OverrideVendorID = @false_ConfigurationID_OverrideVendorID, @Data = @false_ConfigurationID_Data, @Verbose = @false_ConfigurationID_Verbose, @EffortLevel = @false_ConfigurationID_EffortLevel, @RunName = @false_ConfigurationID_RunName, @Comments = @false_ConfigurationID_Comments, @ScheduledJobRunID = @false_ConfigurationID_ScheduledJobRunID, @TestRunID = @false_ConfigurationID_TestRunID, @PrimaryScopeEntityID = @false_ConfigurationID_PrimaryScopeEntityID, @PrimaryScopeRecordID = @false_ConfigurationID_PrimaryScopeRecordID, @SecondaryScopes = @false_ConfigurationID_SecondaryScopes

        FETCH NEXT FROM cascade_update_false_ConfigurationID_cursor INTO @false_ConfigurationIDID, @false_ConfigurationID_AgentID, @false_ConfigurationID_ParentRunID, @false_ConfigurationID_Status, @false_ConfigurationID_StartedAt, @false_ConfigurationID_CompletedAt, @false_ConfigurationID_Success, @false_ConfigurationID_ErrorMessage, @false_ConfigurationID_ConversationID, @false_ConfigurationID_UserID, @false_ConfigurationID_Result, @false_ConfigurationID_AgentState, @false_ConfigurationID_TotalTokensUsed, @false_ConfigurationID_TotalCost, @false_ConfigurationID_TotalPromptTokensUsed, @false_ConfigurationID_TotalCompletionTokensUsed, @false_ConfigurationID_TotalTokensUsedRollup, @false_ConfigurationID_TotalPromptTokensUsedRollup, @false_ConfigurationID_TotalCompletionTokensUsedRollup, @false_ConfigurationID_TotalCostRollup, @false_ConfigurationID_ConversationDetailID, @false_ConfigurationID_ConversationDetailSequence, @false_ConfigurationID_CancellationReason, @false_ConfigurationID_FinalStep, @false_ConfigurationID_FinalPayload, @false_ConfigurationID_Message, @false_ConfigurationID_LastRunID, @false_ConfigurationID_StartingPayload, @false_ConfigurationID_TotalPromptIterations, @false_ConfigurationID_ConfigurationID, @false_ConfigurationID_OverrideModelID, @false_ConfigurationID_OverrideVendorID, @false_ConfigurationID_Data, @false_ConfigurationID_Verbose, @false_ConfigurationID_EffortLevel, @false_ConfigurationID_RunName, @false_ConfigurationID_Comments, @false_ConfigurationID_ScheduledJobRunID, @false_ConfigurationID_TestRunID, @false_ConfigurationID_PrimaryScopeEntityID, @false_ConfigurationID_PrimaryScopeRecordID, @false_ConfigurationID_SecondaryScopes
    END

    CLOSE cascade_update_false_ConfigurationID_cursor
    DEALLOCATE cascade_update_false_ConfigurationID_cursor
    
    -- Cascade delete from AIConfigurationParam using cursor to call spDeleteMJAIConfigurationParam
    DECLARE @false_ConfigurationIDID uniqueidentifier
    DECLARE cascade_delete_false_ConfigurationID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[AIConfigurationParam]
        WHERE [ConfigurationID] = @ID
    
    OPEN cascade_delete_false_ConfigurationID_cursor
    FETCH NEXT FROM cascade_delete_false_ConfigurationID_cursor INTO @false_ConfigurationIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteMJAIConfigurationParam] @ID = @false_ConfigurationIDID
        
        FETCH NEXT FROM cascade_delete_false_ConfigurationID_cursor INTO @false_ConfigurationIDID
    END
    
    CLOSE cascade_delete_false_ConfigurationID_cursor
    DEALLOCATE cascade_delete_false_ConfigurationID_cursor
    
    -- Cascade update on AIConfiguration using cursor to call spUpdateMJAIConfiguration
    DECLARE @false_ParentIDID uniqueidentifier
    DECLARE @false_ParentID_Name nvarchar(100)
    DECLARE @false_ParentID_Description nvarchar(MAX)
    DECLARE @false_ParentID_IsDefault bit
    DECLARE @false_ParentID_Status nvarchar(20)
    DECLARE @false_ParentID_DefaultPromptForContextCompressionID uniqueidentifier
    DECLARE @false_ParentID_DefaultPromptForContextSummarizationID uniqueidentifier
    DECLARE @false_ParentID_DefaultStorageProviderID uniqueidentifier
    DECLARE @false_ParentID_DefaultStorageRootPath nvarchar(500)
    DECLARE @false_ParentID_ParentID uniqueidentifier
    DECLARE cascade_update_false_ParentID_cursor CURSOR FOR
        SELECT [ID], [Name], [Description], [IsDefault], [Status], [DefaultPromptForContextCompressionID], [DefaultPromptForContextSummarizationID], [DefaultStorageProviderID], [DefaultStorageRootPath], [ParentID]
        FROM [${flyway:defaultSchema}].[AIConfiguration]
        WHERE [ParentID] = @ID

    OPEN cascade_update_false_ParentID_cursor
    FETCH NEXT FROM cascade_update_false_ParentID_cursor INTO @false_ParentIDID, @false_ParentID_Name, @false_ParentID_Description, @false_ParentID_IsDefault, @false_ParentID_Status, @false_ParentID_DefaultPromptForContextCompressionID, @false_ParentID_DefaultPromptForContextSummarizationID, @false_ParentID_DefaultStorageProviderID, @false_ParentID_DefaultStorageRootPath, @false_ParentID_ParentID

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @false_ParentID_ParentID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateMJAIConfiguration] @ID = @false_ParentIDID, @Name = @false_ParentID_Name, @Description = @false_ParentID_Description, @IsDefault = @false_ParentID_IsDefault, @Status = @false_ParentID_Status, @DefaultPromptForContextCompressionID = @false_ParentID_DefaultPromptForContextCompressionID, @DefaultPromptForContextSummarizationID = @false_ParentID_DefaultPromptForContextSummarizationID, @DefaultStorageProviderID = @false_ParentID_DefaultStorageProviderID, @DefaultStorageRootPath = @false_ParentID_DefaultStorageRootPath, @ParentID = @false_ParentID_ParentID

        FETCH NEXT FROM cascade_update_false_ParentID_cursor INTO @false_ParentIDID, @false_ParentID_Name, @false_ParentID_Description, @false_ParentID_IsDefault, @false_ParentID_Status, @false_ParentID_DefaultPromptForContextCompressionID, @false_ParentID_DefaultPromptForContextSummarizationID, @false_ParentID_DefaultStorageProviderID, @false_ParentID_DefaultStorageRootPath, @false_ParentID_ParentID
    END

    CLOSE cascade_update_false_ParentID_cursor
    DEALLOCATE cascade_update_false_ParentID_cursor
    
    -- Cascade delete from AIPromptModel using cursor to call spDeleteMJAIPromptModel
    DECLARE @false_ConfigurationIDID uniqueidentifier
    DECLARE cascade_delete_false_ConfigurationID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[AIPromptModel]
        WHERE [ConfigurationID] = @ID
    
    OPEN cascade_delete_false_ConfigurationID_cursor
    FETCH NEXT FROM cascade_delete_false_ConfigurationID_cursor INTO @false_ConfigurationIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteMJAIPromptModel] @ID = @false_ConfigurationIDID
        
        FETCH NEXT FROM cascade_delete_false_ConfigurationID_cursor INTO @false_ConfigurationIDID
    END
    
    CLOSE cascade_delete_false_ConfigurationID_cursor
    DEALLOCATE cascade_delete_false_ConfigurationID_cursor
    
    -- Cascade update on AIPromptRun using cursor to call spUpdateMJAIPromptRun
    DECLARE @false_ConfigurationIDID uniqueidentifier
    DECLARE @false_ConfigurationID_PromptID uniqueidentifier
    DECLARE @false_ConfigurationID_ModelID uniqueidentifier
    DECLARE @false_ConfigurationID_VendorID uniqueidentifier
    DECLARE @false_ConfigurationID_AgentID uniqueidentifier
    DECLARE @false_ConfigurationID_ConfigurationID uniqueidentifier
    DECLARE @false_ConfigurationID_RunAt datetimeoffset
    DECLARE @false_ConfigurationID_CompletedAt datetimeoffset
    DECLARE @false_ConfigurationID_ExecutionTimeMS int
    DECLARE @false_ConfigurationID_Messages nvarchar(MAX)
    DECLARE @false_ConfigurationID_Result nvarchar(MAX)
    DECLARE @false_ConfigurationID_TokensUsed int
    DECLARE @false_ConfigurationID_TokensPrompt int
    DECLARE @false_ConfigurationID_TokensCompletion int
    DECLARE @false_ConfigurationID_TotalCost decimal(18, 6)
    DECLARE @false_ConfigurationID_Success bit
    DECLARE @false_ConfigurationID_ErrorMessage nvarchar(MAX)
    DECLARE @false_ConfigurationID_ParentID uniqueidentifier
    DECLARE @false_ConfigurationID_RunType nvarchar(20)
    DECLARE @false_ConfigurationID_ExecutionOrder int
    DECLARE @false_ConfigurationID_AgentRunID uniqueidentifier
    DECLARE @false_ConfigurationID_Cost decimal(19, 8)
    DECLARE @false_ConfigurationID_CostCurrency nvarchar(10)
    DECLARE @false_ConfigurationID_TokensUsedRollup int
    DECLARE @false_ConfigurationID_TokensPromptRollup int
    DECLARE @false_ConfigurationID_TokensCompletionRollup int
    DECLARE @false_ConfigurationID_Temperature decimal(3, 2)
    DECLARE @false_ConfigurationID_TopP decimal(3, 2)
    DECLARE @false_ConfigurationID_TopK int
    DECLARE @false_ConfigurationID_MinP decimal(3, 2)
    DECLARE @false_ConfigurationID_FrequencyPenalty decimal(3, 2)
    DECLARE @false_ConfigurationID_PresencePenalty decimal(3, 2)
    DECLARE @false_ConfigurationID_Seed int
    DECLARE @false_ConfigurationID_StopSequences nvarchar(MAX)
    DECLARE @false_ConfigurationID_ResponseFormat nvarchar(50)
    DECLARE @false_ConfigurationID_LogProbs bit
    DECLARE @false_ConfigurationID_TopLogProbs int
    DECLARE @false_ConfigurationID_DescendantCost decimal(18, 6)
    DECLARE @false_ConfigurationID_ValidationAttemptCount int
    DECLARE @false_ConfigurationID_SuccessfulValidationCount int
    DECLARE @false_ConfigurationID_FinalValidationPassed bit
    DECLARE @false_ConfigurationID_ValidationBehavior nvarchar(50)
    DECLARE @false_ConfigurationID_RetryStrategy nvarchar(50)
    DECLARE @false_ConfigurationID_MaxRetriesConfigured int
    DECLARE @false_ConfigurationID_FinalValidationError nvarchar(500)
    DECLARE @false_ConfigurationID_ValidationErrorCount int
    DECLARE @false_ConfigurationID_CommonValidationError nvarchar(255)
    DECLARE @false_ConfigurationID_FirstAttemptAt datetimeoffset
    DECLARE @false_ConfigurationID_LastAttemptAt datetimeoffset
    DECLARE @false_ConfigurationID_TotalRetryDurationMS int
    DECLARE @false_ConfigurationID_ValidationAttempts nvarchar(MAX)
    DECLARE @false_ConfigurationID_ValidationSummary nvarchar(MAX)
    DECLARE @false_ConfigurationID_FailoverAttempts int
    DECLARE @false_ConfigurationID_FailoverErrors nvarchar(MAX)
    DECLARE @false_ConfigurationID_FailoverDurations nvarchar(MAX)
    DECLARE @false_ConfigurationID_OriginalModelID uniqueidentifier
    DECLARE @false_ConfigurationID_OriginalRequestStartTime datetimeoffset
    DECLARE @false_ConfigurationID_TotalFailoverDuration int
    DECLARE @false_ConfigurationID_RerunFromPromptRunID uniqueidentifier
    DECLARE @false_ConfigurationID_ModelSelection nvarchar(MAX)
    DECLARE @false_ConfigurationID_Status nvarchar(50)
    DECLARE @false_ConfigurationID_Cancelled bit
    DECLARE @false_ConfigurationID_CancellationReason nvarchar(MAX)
    DECLARE @false_ConfigurationID_ModelPowerRank int
    DECLARE @false_ConfigurationID_SelectionStrategy nvarchar(50)
    DECLARE @false_ConfigurationID_CacheHit bit
    DECLARE @false_ConfigurationID_CacheKey nvarchar(500)
    DECLARE @false_ConfigurationID_JudgeID uniqueidentifier
    DECLARE @false_ConfigurationID_JudgeScore float(53)
    DECLARE @false_ConfigurationID_WasSelectedResult bit
    DECLARE @false_ConfigurationID_StreamingEnabled bit
    DECLARE @false_ConfigurationID_FirstTokenTime int
    DECLARE @false_ConfigurationID_ErrorDetails nvarchar(MAX)
    DECLARE @false_ConfigurationID_ChildPromptID uniqueidentifier
    DECLARE @false_ConfigurationID_QueueTime int
    DECLARE @false_ConfigurationID_PromptTime int
    DECLARE @false_ConfigurationID_CompletionTime int
    DECLARE @false_ConfigurationID_ModelSpecificResponseDetails nvarchar(MAX)
    DECLARE @false_ConfigurationID_EffortLevel int
    DECLARE @false_ConfigurationID_RunName nvarchar(255)
    DECLARE @false_ConfigurationID_Comments nvarchar(MAX)
    DECLARE @false_ConfigurationID_TestRunID uniqueidentifier
    DECLARE cascade_update_false_ConfigurationID_cursor CURSOR FOR
        SELECT [ID], [PromptID], [ModelID], [VendorID], [AgentID], [ConfigurationID], [RunAt], [CompletedAt], [ExecutionTimeMS], [Messages], [Result], [TokensUsed], [TokensPrompt], [TokensCompletion], [TotalCost], [Success], [ErrorMessage], [ParentID], [RunType], [ExecutionOrder], [AgentRunID], [Cost], [CostCurrency], [TokensUsedRollup], [TokensPromptRollup], [TokensCompletionRollup], [Temperature], [TopP], [TopK], [MinP], [FrequencyPenalty], [PresencePenalty], [Seed], [StopSequences], [ResponseFormat], [LogProbs], [TopLogProbs], [DescendantCost], [ValidationAttemptCount], [SuccessfulValidationCount], [FinalValidationPassed], [ValidationBehavior], [RetryStrategy], [MaxRetriesConfigured], [FinalValidationError], [ValidationErrorCount], [CommonValidationError], [FirstAttemptAt], [LastAttemptAt], [TotalRetryDurationMS], [ValidationAttempts], [ValidationSummary], [FailoverAttempts], [FailoverErrors], [FailoverDurations], [OriginalModelID], [OriginalRequestStartTime], [TotalFailoverDuration], [RerunFromPromptRunID], [ModelSelection], [Status], [Cancelled], [CancellationReason], [ModelPowerRank], [SelectionStrategy], [CacheHit], [CacheKey], [JudgeID], [JudgeScore], [WasSelectedResult], [StreamingEnabled], [FirstTokenTime], [ErrorDetails], [ChildPromptID], [QueueTime], [PromptTime], [CompletionTime], [ModelSpecificResponseDetails], [EffortLevel], [RunName], [Comments], [TestRunID]
        FROM [${flyway:defaultSchema}].[AIPromptRun]
        WHERE [ConfigurationID] = @ID

    OPEN cascade_update_false_ConfigurationID_cursor
    FETCH NEXT FROM cascade_update_false_ConfigurationID_cursor INTO @false_ConfigurationIDID, @false_ConfigurationID_PromptID, @false_ConfigurationID_ModelID, @false_ConfigurationID_VendorID, @false_ConfigurationID_AgentID, @false_ConfigurationID_ConfigurationID, @false_ConfigurationID_RunAt, @false_ConfigurationID_CompletedAt, @false_ConfigurationID_ExecutionTimeMS, @false_ConfigurationID_Messages, @false_ConfigurationID_Result, @false_ConfigurationID_TokensUsed, @false_ConfigurationID_TokensPrompt, @false_ConfigurationID_TokensCompletion, @false_ConfigurationID_TotalCost, @false_ConfigurationID_Success, @false_ConfigurationID_ErrorMessage, @false_ConfigurationID_ParentID, @false_ConfigurationID_RunType, @false_ConfigurationID_ExecutionOrder, @false_ConfigurationID_AgentRunID, @false_ConfigurationID_Cost, @false_ConfigurationID_CostCurrency, @false_ConfigurationID_TokensUsedRollup, @false_ConfigurationID_TokensPromptRollup, @false_ConfigurationID_TokensCompletionRollup, @false_ConfigurationID_Temperature, @false_ConfigurationID_TopP, @false_ConfigurationID_TopK, @false_ConfigurationID_MinP, @false_ConfigurationID_FrequencyPenalty, @false_ConfigurationID_PresencePenalty, @false_ConfigurationID_Seed, @false_ConfigurationID_StopSequences, @false_ConfigurationID_ResponseFormat, @false_ConfigurationID_LogProbs, @false_ConfigurationID_TopLogProbs, @false_ConfigurationID_DescendantCost, @false_ConfigurationID_ValidationAttemptCount, @false_ConfigurationID_SuccessfulValidationCount, @false_ConfigurationID_FinalValidationPassed, @false_ConfigurationID_ValidationBehavior, @false_ConfigurationID_RetryStrategy, @false_ConfigurationID_MaxRetriesConfigured, @false_ConfigurationID_FinalValidationError, @false_ConfigurationID_ValidationErrorCount, @false_ConfigurationID_CommonValidationError, @false_ConfigurationID_FirstAttemptAt, @false_ConfigurationID_LastAttemptAt, @false_ConfigurationID_TotalRetryDurationMS, @false_ConfigurationID_ValidationAttempts, @false_ConfigurationID_ValidationSummary, @false_ConfigurationID_FailoverAttempts, @false_ConfigurationID_FailoverErrors, @false_ConfigurationID_FailoverDurations, @false_ConfigurationID_OriginalModelID, @false_ConfigurationID_OriginalRequestStartTime, @false_ConfigurationID_TotalFailoverDuration, @false_ConfigurationID_RerunFromPromptRunID, @false_ConfigurationID_ModelSelection, @false_ConfigurationID_Status, @false_ConfigurationID_Cancelled, @false_ConfigurationID_CancellationReason, @false_ConfigurationID_ModelPowerRank, @false_ConfigurationID_SelectionStrategy, @false_ConfigurationID_CacheHit, @false_ConfigurationID_CacheKey, @false_ConfigurationID_JudgeID, @false_ConfigurationID_JudgeScore, @false_ConfigurationID_WasSelectedResult, @false_ConfigurationID_StreamingEnabled, @false_ConfigurationID_FirstTokenTime, @false_ConfigurationID_ErrorDetails, @false_ConfigurationID_ChildPromptID, @false_ConfigurationID_QueueTime, @false_ConfigurationID_PromptTime, @false_ConfigurationID_CompletionTime, @false_ConfigurationID_ModelSpecificResponseDetails, @false_ConfigurationID_EffortLevel, @false_ConfigurationID_RunName, @false_ConfigurationID_Comments, @false_ConfigurationID_TestRunID

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @false_ConfigurationID_ConfigurationID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateMJAIPromptRun] @ID = @false_ConfigurationIDID, @PromptID = @false_ConfigurationID_PromptID, @ModelID = @false_ConfigurationID_ModelID, @VendorID = @false_ConfigurationID_VendorID, @AgentID = @false_ConfigurationID_AgentID, @ConfigurationID = @false_ConfigurationID_ConfigurationID, @RunAt = @false_ConfigurationID_RunAt, @CompletedAt = @false_ConfigurationID_CompletedAt, @ExecutionTimeMS = @false_ConfigurationID_ExecutionTimeMS, @Messages = @false_ConfigurationID_Messages, @Result = @false_ConfigurationID_Result, @TokensUsed = @false_ConfigurationID_TokensUsed, @TokensPrompt = @false_ConfigurationID_TokensPrompt, @TokensCompletion = @false_ConfigurationID_TokensCompletion, @TotalCost = @false_ConfigurationID_TotalCost, @Success = @false_ConfigurationID_Success, @ErrorMessage = @false_ConfigurationID_ErrorMessage, @ParentID = @false_ConfigurationID_ParentID, @RunType = @false_ConfigurationID_RunType, @ExecutionOrder = @false_ConfigurationID_ExecutionOrder, @AgentRunID = @false_ConfigurationID_AgentRunID, @Cost = @false_ConfigurationID_Cost, @CostCurrency = @false_ConfigurationID_CostCurrency, @TokensUsedRollup = @false_ConfigurationID_TokensUsedRollup, @TokensPromptRollup = @false_ConfigurationID_TokensPromptRollup, @TokensCompletionRollup = @false_ConfigurationID_TokensCompletionRollup, @Temperature = @false_ConfigurationID_Temperature, @TopP = @false_ConfigurationID_TopP, @TopK = @false_ConfigurationID_TopK, @MinP = @false_ConfigurationID_MinP, @FrequencyPenalty = @false_ConfigurationID_FrequencyPenalty, @PresencePenalty = @false_ConfigurationID_PresencePenalty, @Seed = @false_ConfigurationID_Seed, @StopSequences = @false_ConfigurationID_StopSequences, @ResponseFormat = @false_ConfigurationID_ResponseFormat, @LogProbs = @false_ConfigurationID_LogProbs, @TopLogProbs = @false_ConfigurationID_TopLogProbs, @DescendantCost = @false_ConfigurationID_DescendantCost, @ValidationAttemptCount = @false_ConfigurationID_ValidationAttemptCount, @SuccessfulValidationCount = @false_ConfigurationID_SuccessfulValidationCount, @FinalValidationPassed = @false_ConfigurationID_FinalValidationPassed, @ValidationBehavior = @false_ConfigurationID_ValidationBehavior, @RetryStrategy = @false_ConfigurationID_RetryStrategy, @MaxRetriesConfigured = @false_ConfigurationID_MaxRetriesConfigured, @FinalValidationError = @false_ConfigurationID_FinalValidationError, @ValidationErrorCount = @false_ConfigurationID_ValidationErrorCount, @CommonValidationError = @false_ConfigurationID_CommonValidationError, @FirstAttemptAt = @false_ConfigurationID_FirstAttemptAt, @LastAttemptAt = @false_ConfigurationID_LastAttemptAt, @TotalRetryDurationMS = @false_ConfigurationID_TotalRetryDurationMS, @ValidationAttempts = @false_ConfigurationID_ValidationAttempts, @ValidationSummary = @false_ConfigurationID_ValidationSummary, @FailoverAttempts = @false_ConfigurationID_FailoverAttempts, @FailoverErrors = @false_ConfigurationID_FailoverErrors, @FailoverDurations = @false_ConfigurationID_FailoverDurations, @OriginalModelID = @false_ConfigurationID_OriginalModelID, @OriginalRequestStartTime = @false_ConfigurationID_OriginalRequestStartTime, @TotalFailoverDuration = @false_ConfigurationID_TotalFailoverDuration, @RerunFromPromptRunID = @false_ConfigurationID_RerunFromPromptRunID, @ModelSelection = @false_ConfigurationID_ModelSelection, @Status = @false_ConfigurationID_Status, @Cancelled = @false_ConfigurationID_Cancelled, @CancellationReason = @false_ConfigurationID_CancellationReason, @ModelPowerRank = @false_ConfigurationID_ModelPowerRank, @SelectionStrategy = @false_ConfigurationID_SelectionStrategy, @CacheHit = @false_ConfigurationID_CacheHit, @CacheKey = @false_ConfigurationID_CacheKey, @JudgeID = @false_ConfigurationID_JudgeID, @JudgeScore = @false_ConfigurationID_JudgeScore, @WasSelectedResult = @false_ConfigurationID_WasSelectedResult, @StreamingEnabled = @false_ConfigurationID_StreamingEnabled, @FirstTokenTime = @false_ConfigurationID_FirstTokenTime, @ErrorDetails = @false_ConfigurationID_ErrorDetails, @ChildPromptID = @false_ConfigurationID_ChildPromptID, @QueueTime = @false_ConfigurationID_QueueTime, @PromptTime = @false_ConfigurationID_PromptTime, @CompletionTime = @false_ConfigurationID_CompletionTime, @ModelSpecificResponseDetails = @false_ConfigurationID_ModelSpecificResponseDetails, @EffortLevel = @false_ConfigurationID_EffortLevel, @RunName = @false_ConfigurationID_RunName, @Comments = @false_ConfigurationID_Comments, @TestRunID = @false_ConfigurationID_TestRunID

        FETCH NEXT FROM cascade_update_false_ConfigurationID_cursor INTO @false_ConfigurationIDID, @false_ConfigurationID_PromptID, @false_ConfigurationID_ModelID, @false_ConfigurationID_VendorID, @false_ConfigurationID_AgentID, @false_ConfigurationID_ConfigurationID, @false_ConfigurationID_RunAt, @false_ConfigurationID_CompletedAt, @false_ConfigurationID_ExecutionTimeMS, @false_ConfigurationID_Messages, @false_ConfigurationID_Result, @false_ConfigurationID_TokensUsed, @false_ConfigurationID_TokensPrompt, @false_ConfigurationID_TokensCompletion, @false_ConfigurationID_TotalCost, @false_ConfigurationID_Success, @false_ConfigurationID_ErrorMessage, @false_ConfigurationID_ParentID, @false_ConfigurationID_RunType, @false_ConfigurationID_ExecutionOrder, @false_ConfigurationID_AgentRunID, @false_ConfigurationID_Cost, @false_ConfigurationID_CostCurrency, @false_ConfigurationID_TokensUsedRollup, @false_ConfigurationID_TokensPromptRollup, @false_ConfigurationID_TokensCompletionRollup, @false_ConfigurationID_Temperature, @false_ConfigurationID_TopP, @false_ConfigurationID_TopK, @false_ConfigurationID_MinP, @false_ConfigurationID_FrequencyPenalty, @false_ConfigurationID_PresencePenalty, @false_ConfigurationID_Seed, @false_ConfigurationID_StopSequences, @false_ConfigurationID_ResponseFormat, @false_ConfigurationID_LogProbs, @false_ConfigurationID_TopLogProbs, @false_ConfigurationID_DescendantCost, @false_ConfigurationID_ValidationAttemptCount, @false_ConfigurationID_SuccessfulValidationCount, @false_ConfigurationID_FinalValidationPassed, @false_ConfigurationID_ValidationBehavior, @false_ConfigurationID_RetryStrategy, @false_ConfigurationID_MaxRetriesConfigured, @false_ConfigurationID_FinalValidationError, @false_ConfigurationID_ValidationErrorCount, @false_ConfigurationID_CommonValidationError, @false_ConfigurationID_FirstAttemptAt, @false_ConfigurationID_LastAttemptAt, @false_ConfigurationID_TotalRetryDurationMS, @false_ConfigurationID_ValidationAttempts, @false_ConfigurationID_ValidationSummary, @false_ConfigurationID_FailoverAttempts, @false_ConfigurationID_FailoverErrors, @false_ConfigurationID_FailoverDurations, @false_ConfigurationID_OriginalModelID, @false_ConfigurationID_OriginalRequestStartTime, @false_ConfigurationID_TotalFailoverDuration, @false_ConfigurationID_RerunFromPromptRunID, @false_ConfigurationID_ModelSelection, @false_ConfigurationID_Status, @false_ConfigurationID_Cancelled, @false_ConfigurationID_CancellationReason, @false_ConfigurationID_ModelPowerRank, @false_ConfigurationID_SelectionStrategy, @false_ConfigurationID_CacheHit, @false_ConfigurationID_CacheKey, @false_ConfigurationID_JudgeID, @false_ConfigurationID_JudgeScore, @false_ConfigurationID_WasSelectedResult, @false_ConfigurationID_StreamingEnabled, @false_ConfigurationID_FirstTokenTime, @false_ConfigurationID_ErrorDetails, @false_ConfigurationID_ChildPromptID, @false_ConfigurationID_QueueTime, @false_ConfigurationID_PromptTime, @false_ConfigurationID_CompletionTime, @false_ConfigurationID_ModelSpecificResponseDetails, @false_ConfigurationID_EffortLevel, @false_ConfigurationID_RunName, @false_ConfigurationID_Comments, @false_ConfigurationID_TestRunID
    END

    CLOSE cascade_update_false_ConfigurationID_cursor
    DEALLOCATE cascade_update_false_ConfigurationID_cursor
    
    -- Cascade update on AIResultCache using cursor to call spUpdateMJAIResultCache
    DECLARE @false_ConfigurationIDID uniqueidentifier
    DECLARE @false_ConfigurationID_AIPromptID uniqueidentifier
    DECLARE @false_ConfigurationID_AIModelID uniqueidentifier
    DECLARE @false_ConfigurationID_RunAt datetimeoffset
    DECLARE @false_ConfigurationID_PromptText nvarchar(MAX)
    DECLARE @false_ConfigurationID_ResultText nvarchar(MAX)
    DECLARE @false_ConfigurationID_Status nvarchar(50)
    DECLARE @false_ConfigurationID_ExpiredOn datetimeoffset
    DECLARE @false_ConfigurationID_VendorID uniqueidentifier
    DECLARE @false_ConfigurationID_AgentID uniqueidentifier
    DECLARE @false_ConfigurationID_ConfigurationID uniqueidentifier
    DECLARE @false_ConfigurationID_PromptEmbedding varbinary
    DECLARE @false_ConfigurationID_PromptRunID uniqueidentifier
    DECLARE cascade_update_false_ConfigurationID_cursor CURSOR FOR
        SELECT [ID], [AIPromptID], [AIModelID], [RunAt], [PromptText], [ResultText], [Status], [ExpiredOn], [VendorID], [AgentID], [ConfigurationID], [PromptEmbedding], [PromptRunID]
        FROM [${flyway:defaultSchema}].[AIResultCache]
        WHERE [ConfigurationID] = @ID

    OPEN cascade_update_false_ConfigurationID_cursor
    FETCH NEXT FROM cascade_update_false_ConfigurationID_cursor INTO @false_ConfigurationIDID, @false_ConfigurationID_AIPromptID, @false_ConfigurationID_AIModelID, @false_ConfigurationID_RunAt, @false_ConfigurationID_PromptText, @false_ConfigurationID_ResultText, @false_ConfigurationID_Status, @false_ConfigurationID_ExpiredOn, @false_ConfigurationID_VendorID, @false_ConfigurationID_AgentID, @false_ConfigurationID_ConfigurationID, @false_ConfigurationID_PromptEmbedding, @false_ConfigurationID_PromptRunID

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @false_ConfigurationID_ConfigurationID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateMJAIResultCache] @ID = @false_ConfigurationIDID, @AIPromptID = @false_ConfigurationID_AIPromptID, @AIModelID = @false_ConfigurationID_AIModelID, @RunAt = @false_ConfigurationID_RunAt, @PromptText = @false_ConfigurationID_PromptText, @ResultText = @false_ConfigurationID_ResultText, @Status = @false_ConfigurationID_Status, @ExpiredOn = @false_ConfigurationID_ExpiredOn, @VendorID = @false_ConfigurationID_VendorID, @AgentID = @false_ConfigurationID_AgentID, @ConfigurationID = @false_ConfigurationID_ConfigurationID, @PromptEmbedding = @false_ConfigurationID_PromptEmbedding, @PromptRunID = @false_ConfigurationID_PromptRunID

        FETCH NEXT FROM cascade_update_false_ConfigurationID_cursor INTO @false_ConfigurationIDID, @false_ConfigurationID_AIPromptID, @false_ConfigurationID_AIModelID, @false_ConfigurationID_RunAt, @false_ConfigurationID_PromptText, @false_ConfigurationID_ResultText, @false_ConfigurationID_Status, @false_ConfigurationID_ExpiredOn, @false_ConfigurationID_VendorID, @false_ConfigurationID_AgentID, @false_ConfigurationID_ConfigurationID, @false_ConfigurationID_PromptEmbedding, @false_ConfigurationID_PromptRunID
    END

    CLOSE cascade_update_false_ConfigurationID_cursor
    DEALLOCATE cascade_update_false_ConfigurationID_cursor
    

    DELETE FROM
        [${flyway:defaultSchema}].[AIConfiguration]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIConfiguration] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: AI Configurations */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIConfiguration] TO [cdp_Integration]



/* spDelete SQL for MJ: AI Agents */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Agents
-- Item: spDeleteMJAIAgent
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR AIAgent
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJAIAgent]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIAgent];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIAgent]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    -- Cascade update on AIAgentAction using cursor to call spUpdateMJAIAgentAction
    DECLARE @false_AgentIDID uniqueidentifier
    DECLARE @false_AgentID_AgentID uniqueidentifier
    DECLARE @false_AgentID_ActionID uniqueidentifier
    DECLARE @false_AgentID_Status nvarchar(15)
    DECLARE @false_AgentID_MinExecutionsPerRun int
    DECLARE @false_AgentID_MaxExecutionsPerRun int
    DECLARE @false_AgentID_ResultExpirationTurns int
    DECLARE @false_AgentID_ResultExpirationMode nvarchar(20)
    DECLARE @false_AgentID_CompactMode nvarchar(20)
    DECLARE @false_AgentID_CompactLength int
    DECLARE @false_AgentID_CompactPromptID uniqueidentifier
    DECLARE cascade_update_false_AgentID_cursor CURSOR FOR
        SELECT [ID], [AgentID], [ActionID], [Status], [MinExecutionsPerRun], [MaxExecutionsPerRun], [ResultExpirationTurns], [ResultExpirationMode], [CompactMode], [CompactLength], [CompactPromptID]
        FROM [${flyway:defaultSchema}].[AIAgentAction]
        WHERE [AgentID] = @ID

    OPEN cascade_update_false_AgentID_cursor
    FETCH NEXT FROM cascade_update_false_AgentID_cursor INTO @false_AgentIDID, @false_AgentID_AgentID, @false_AgentID_ActionID, @false_AgentID_Status, @false_AgentID_MinExecutionsPerRun, @false_AgentID_MaxExecutionsPerRun, @false_AgentID_ResultExpirationTurns, @false_AgentID_ResultExpirationMode, @false_AgentID_CompactMode, @false_AgentID_CompactLength, @false_AgentID_CompactPromptID

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @false_AgentID_AgentID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateMJAIAgentAction] @ID = @false_AgentIDID, @AgentID = @false_AgentID_AgentID, @ActionID = @false_AgentID_ActionID, @Status = @false_AgentID_Status, @MinExecutionsPerRun = @false_AgentID_MinExecutionsPerRun, @MaxExecutionsPerRun = @false_AgentID_MaxExecutionsPerRun, @ResultExpirationTurns = @false_AgentID_ResultExpirationTurns, @ResultExpirationMode = @false_AgentID_ResultExpirationMode, @CompactMode = @false_AgentID_CompactMode, @CompactLength = @false_AgentID_CompactLength, @CompactPromptID = @false_AgentID_CompactPromptID

        FETCH NEXT FROM cascade_update_false_AgentID_cursor INTO @false_AgentIDID, @false_AgentID_AgentID, @false_AgentID_ActionID, @false_AgentID_Status, @false_AgentID_MinExecutionsPerRun, @false_AgentID_MaxExecutionsPerRun, @false_AgentID_ResultExpirationTurns, @false_AgentID_ResultExpirationMode, @false_AgentID_CompactMode, @false_AgentID_CompactLength, @false_AgentID_CompactPromptID
    END

    CLOSE cascade_update_false_AgentID_cursor
    DEALLOCATE cascade_update_false_AgentID_cursor
    
    -- Cascade delete from AIAgentArtifactType using cursor to call spDeleteMJAIAgentArtifactType
    DECLARE @false_AgentIDID uniqueidentifier
    DECLARE cascade_delete_false_AgentID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[AIAgentArtifactType]
        WHERE [AgentID] = @ID
    
    OPEN cascade_delete_false_AgentID_cursor
    FETCH NEXT FROM cascade_delete_false_AgentID_cursor INTO @false_AgentIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteMJAIAgentArtifactType] @ID = @false_AgentIDID
        
        FETCH NEXT FROM cascade_delete_false_AgentID_cursor INTO @false_AgentIDID
    END
    
    CLOSE cascade_delete_false_AgentID_cursor
    DEALLOCATE cascade_delete_false_AgentID_cursor
    
    -- Cascade delete from AIAgentConfiguration using cursor to call spDeleteMJAIAgentConfiguration
    DECLARE @false_AgentIDID uniqueidentifier
    DECLARE cascade_delete_false_AgentID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[AIAgentConfiguration]
        WHERE [AgentID] = @ID
    
    OPEN cascade_delete_false_AgentID_cursor
    FETCH NEXT FROM cascade_delete_false_AgentID_cursor INTO @false_AgentIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteMJAIAgentConfiguration] @ID = @false_AgentIDID
        
        FETCH NEXT FROM cascade_delete_false_AgentID_cursor INTO @false_AgentIDID
    END
    
    CLOSE cascade_delete_false_AgentID_cursor
    DEALLOCATE cascade_delete_false_AgentID_cursor
    
    -- Cascade delete from AIAgentDataSource using cursor to call spDeleteMJAIAgentDataSource
    DECLARE @false_AgentIDID uniqueidentifier
    DECLARE cascade_delete_false_AgentID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[AIAgentDataSource]
        WHERE [AgentID] = @ID
    
    OPEN cascade_delete_false_AgentID_cursor
    FETCH NEXT FROM cascade_delete_false_AgentID_cursor INTO @false_AgentIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteMJAIAgentDataSource] @ID = @false_AgentIDID
        
        FETCH NEXT FROM cascade_delete_false_AgentID_cursor INTO @false_AgentIDID
    END
    
    CLOSE cascade_delete_false_AgentID_cursor
    DEALLOCATE cascade_delete_false_AgentID_cursor
    
    -- Cascade delete from AIAgentExample using cursor to call spDeleteMJAIAgentExample
    DECLARE @false_AgentIDID uniqueidentifier
    DECLARE cascade_delete_false_AgentID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[AIAgentExample]
        WHERE [AgentID] = @ID
    
    OPEN cascade_delete_false_AgentID_cursor
    FETCH NEXT FROM cascade_delete_false_AgentID_cursor INTO @false_AgentIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteMJAIAgentExample] @ID = @false_AgentIDID
        
        FETCH NEXT FROM cascade_delete_false_AgentID_cursor INTO @false_AgentIDID
    END
    
    CLOSE cascade_delete_false_AgentID_cursor
    DEALLOCATE cascade_delete_false_AgentID_cursor
    
    -- Cascade delete from AIAgentLearningCycle using cursor to call spDeleteMJAIAgentLearningCycle
    DECLARE @false_AgentIDID uniqueidentifier
    DECLARE cascade_delete_false_AgentID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[AIAgentLearningCycle]
        WHERE [AgentID] = @ID
    
    OPEN cascade_delete_false_AgentID_cursor
    FETCH NEXT FROM cascade_delete_false_AgentID_cursor INTO @false_AgentIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteMJAIAgentLearningCycle] @ID = @false_AgentIDID
        
        FETCH NEXT FROM cascade_delete_false_AgentID_cursor INTO @false_AgentIDID
    END
    
    CLOSE cascade_delete_false_AgentID_cursor
    DEALLOCATE cascade_delete_false_AgentID_cursor
    
    -- Cascade delete from AIAgentModality using cursor to call spDeleteMJAIAgentModality
    DECLARE @false_AgentIDID uniqueidentifier
    DECLARE cascade_delete_false_AgentID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[AIAgentModality]
        WHERE [AgentID] = @ID
    
    OPEN cascade_delete_false_AgentID_cursor
    FETCH NEXT FROM cascade_delete_false_AgentID_cursor INTO @false_AgentIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteMJAIAgentModality] @ID = @false_AgentIDID
        
        FETCH NEXT FROM cascade_delete_false_AgentID_cursor INTO @false_AgentIDID
    END
    
    CLOSE cascade_delete_false_AgentID_cursor
    DEALLOCATE cascade_delete_false_AgentID_cursor
    
    -- Cascade update on AIAgentModel using cursor to call spUpdateMJAIAgentModel
    DECLARE @false_AgentIDID uniqueidentifier
    DECLARE @false_AgentID_AgentID uniqueidentifier
    DECLARE @false_AgentID_ModelID uniqueidentifier
    DECLARE @false_AgentID_Active bit
    DECLARE @false_AgentID_Priority int
    DECLARE cascade_update_false_AgentID_cursor CURSOR FOR
        SELECT [ID], [AgentID], [ModelID], [Active], [Priority]
        FROM [${flyway:defaultSchema}].[AIAgentModel]
        WHERE [AgentID] = @ID

    OPEN cascade_update_false_AgentID_cursor
    FETCH NEXT FROM cascade_update_false_AgentID_cursor INTO @false_AgentIDID, @false_AgentID_AgentID, @false_AgentID_ModelID, @false_AgentID_Active, @false_AgentID_Priority

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @false_AgentID_AgentID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateMJAIAgentModel] @ID = @false_AgentIDID, @AgentID = @false_AgentID_AgentID, @ModelID = @false_AgentID_ModelID, @Active = @false_AgentID_Active, @Priority = @false_AgentID_Priority

        FETCH NEXT FROM cascade_update_false_AgentID_cursor INTO @false_AgentIDID, @false_AgentID_AgentID, @false_AgentID_ModelID, @false_AgentID_Active, @false_AgentID_Priority
    END

    CLOSE cascade_update_false_AgentID_cursor
    DEALLOCATE cascade_update_false_AgentID_cursor
    
    -- Cascade update on AIAgentNote using cursor to call spUpdateMJAIAgentNote
    DECLARE @false_AgentIDID uniqueidentifier
    DECLARE @false_AgentID_AgentID uniqueidentifier
    DECLARE @false_AgentID_AgentNoteTypeID uniqueidentifier
    DECLARE @false_AgentID_Note nvarchar(MAX)
    DECLARE @false_AgentID_UserID uniqueidentifier
    DECLARE @false_AgentID_Type nvarchar(20)
    DECLARE @false_AgentID_IsAutoGenerated bit
    DECLARE @false_AgentID_Comments nvarchar(MAX)
    DECLARE @false_AgentID_Status nvarchar(20)
    DECLARE @false_AgentID_SourceConversationID uniqueidentifier
    DECLARE @false_AgentID_SourceConversationDetailID uniqueidentifier
    DECLARE @false_AgentID_SourceAIAgentRunID uniqueidentifier
    DECLARE @false_AgentID_CompanyID uniqueidentifier
    DECLARE @false_AgentID_EmbeddingVector nvarchar(MAX)
    DECLARE @false_AgentID_EmbeddingModelID uniqueidentifier
    DECLARE @false_AgentID_PrimaryScopeEntityID uniqueidentifier
    DECLARE @false_AgentID_PrimaryScopeRecordID nvarchar(100)
    DECLARE @false_AgentID_SecondaryScopes nvarchar(MAX)
    DECLARE @false_AgentID_LastAccessedAt datetimeoffset
    DECLARE @false_AgentID_AccessCount int
    DECLARE @false_AgentID_ExpiresAt datetimeoffset
    DECLARE cascade_update_false_AgentID_cursor CURSOR FOR
        SELECT [ID], [AgentID], [AgentNoteTypeID], [Note], [UserID], [Type], [IsAutoGenerated], [Comments], [Status], [SourceConversationID], [SourceConversationDetailID], [SourceAIAgentRunID], [CompanyID], [EmbeddingVector], [EmbeddingModelID], [PrimaryScopeEntityID], [PrimaryScopeRecordID], [SecondaryScopes], [LastAccessedAt], [AccessCount], [ExpiresAt]
        FROM [${flyway:defaultSchema}].[AIAgentNote]
        WHERE [AgentID] = @ID

    OPEN cascade_update_false_AgentID_cursor
    FETCH NEXT FROM cascade_update_false_AgentID_cursor INTO @false_AgentIDID, @false_AgentID_AgentID, @false_AgentID_AgentNoteTypeID, @false_AgentID_Note, @false_AgentID_UserID, @false_AgentID_Type, @false_AgentID_IsAutoGenerated, @false_AgentID_Comments, @false_AgentID_Status, @false_AgentID_SourceConversationID, @false_AgentID_SourceConversationDetailID, @false_AgentID_SourceAIAgentRunID, @false_AgentID_CompanyID, @false_AgentID_EmbeddingVector, @false_AgentID_EmbeddingModelID, @false_AgentID_PrimaryScopeEntityID, @false_AgentID_PrimaryScopeRecordID, @false_AgentID_SecondaryScopes, @false_AgentID_LastAccessedAt, @false_AgentID_AccessCount, @false_AgentID_ExpiresAt

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @false_AgentID_AgentID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateMJAIAgentNote] @ID = @false_AgentIDID, @AgentID = @false_AgentID_AgentID, @AgentNoteTypeID = @false_AgentID_AgentNoteTypeID, @Note = @false_AgentID_Note, @UserID = @false_AgentID_UserID, @Type = @false_AgentID_Type, @IsAutoGenerated = @false_AgentID_IsAutoGenerated, @Comments = @false_AgentID_Comments, @Status = @false_AgentID_Status, @SourceConversationID = @false_AgentID_SourceConversationID, @SourceConversationDetailID = @false_AgentID_SourceConversationDetailID, @SourceAIAgentRunID = @false_AgentID_SourceAIAgentRunID, @CompanyID = @false_AgentID_CompanyID, @EmbeddingVector = @false_AgentID_EmbeddingVector, @EmbeddingModelID = @false_AgentID_EmbeddingModelID, @PrimaryScopeEntityID = @false_AgentID_PrimaryScopeEntityID, @PrimaryScopeRecordID = @false_AgentID_PrimaryScopeRecordID, @SecondaryScopes = @false_AgentID_SecondaryScopes, @LastAccessedAt = @false_AgentID_LastAccessedAt, @AccessCount = @false_AgentID_AccessCount, @ExpiresAt = @false_AgentID_ExpiresAt

        FETCH NEXT FROM cascade_update_false_AgentID_cursor INTO @false_AgentIDID, @false_AgentID_AgentID, @false_AgentID_AgentNoteTypeID, @false_AgentID_Note, @false_AgentID_UserID, @false_AgentID_Type, @false_AgentID_IsAutoGenerated, @false_AgentID_Comments, @false_AgentID_Status, @false_AgentID_SourceConversationID, @false_AgentID_SourceConversationDetailID, @false_AgentID_SourceAIAgentRunID, @false_AgentID_CompanyID, @false_AgentID_EmbeddingVector, @false_AgentID_EmbeddingModelID, @false_AgentID_PrimaryScopeEntityID, @false_AgentID_PrimaryScopeRecordID, @false_AgentID_SecondaryScopes, @false_AgentID_LastAccessedAt, @false_AgentID_AccessCount, @false_AgentID_ExpiresAt
    END

    CLOSE cascade_update_false_AgentID_cursor
    DEALLOCATE cascade_update_false_AgentID_cursor
    
    -- Cascade delete from AIAgentPermission using cursor to call spDeleteMJAIAgentPermission
    DECLARE @false_AgentIDID uniqueidentifier
    DECLARE cascade_delete_false_AgentID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[AIAgentPermission]
        WHERE [AgentID] = @ID
    
    OPEN cascade_delete_false_AgentID_cursor
    FETCH NEXT FROM cascade_delete_false_AgentID_cursor INTO @false_AgentIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteMJAIAgentPermission] @ID = @false_AgentIDID
        
        FETCH NEXT FROM cascade_delete_false_AgentID_cursor INTO @false_AgentIDID
    END
    
    CLOSE cascade_delete_false_AgentID_cursor
    DEALLOCATE cascade_delete_false_AgentID_cursor
    
    -- Cascade delete from AIAgentPrompt using cursor to call spDeleteMJAIAgentPrompt
    DECLARE @false_AgentIDID uniqueidentifier
    DECLARE cascade_delete_false_AgentID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[AIAgentPrompt]
        WHERE [AgentID] = @ID
    
    OPEN cascade_delete_false_AgentID_cursor
    FETCH NEXT FROM cascade_delete_false_AgentID_cursor INTO @false_AgentIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteMJAIAgentPrompt] @ID = @false_AgentIDID
        
        FETCH NEXT FROM cascade_delete_false_AgentID_cursor INTO @false_AgentIDID
    END
    
    CLOSE cascade_delete_false_AgentID_cursor
    DEALLOCATE cascade_delete_false_AgentID_cursor
    
    -- Cascade delete from AIAgentRelationship using cursor to call spDeleteMJAIAgentRelationship
    DECLARE @false_AgentIDID uniqueidentifier
    DECLARE cascade_delete_false_AgentID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[AIAgentRelationship]
        WHERE [AgentID] = @ID
    
    OPEN cascade_delete_false_AgentID_cursor
    FETCH NEXT FROM cascade_delete_false_AgentID_cursor INTO @false_AgentIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteMJAIAgentRelationship] @ID = @false_AgentIDID
        
        FETCH NEXT FROM cascade_delete_false_AgentID_cursor INTO @false_AgentIDID
    END
    
    CLOSE cascade_delete_false_AgentID_cursor
    DEALLOCATE cascade_delete_false_AgentID_cursor
    
    -- Cascade delete from AIAgentRelationship using cursor to call spDeleteMJAIAgentRelationship
    DECLARE @false_SubAgentIDID uniqueidentifier
    DECLARE cascade_delete_false_SubAgentID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[AIAgentRelationship]
        WHERE [SubAgentID] = @ID
    
    OPEN cascade_delete_false_SubAgentID_cursor
    FETCH NEXT FROM cascade_delete_false_SubAgentID_cursor INTO @false_SubAgentIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteMJAIAgentRelationship] @ID = @false_SubAgentIDID
        
        FETCH NEXT FROM cascade_delete_false_SubAgentID_cursor INTO @false_SubAgentIDID
    END
    
    CLOSE cascade_delete_false_SubAgentID_cursor
    DEALLOCATE cascade_delete_false_SubAgentID_cursor
    
    -- Cascade delete from AIAgentRequest using cursor to call spDeleteMJAIAgentRequest
    DECLARE @false_AgentIDID uniqueidentifier
    DECLARE cascade_delete_false_AgentID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[AIAgentRequest]
        WHERE [AgentID] = @ID
    
    OPEN cascade_delete_false_AgentID_cursor
    FETCH NEXT FROM cascade_delete_false_AgentID_cursor INTO @false_AgentIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteMJAIAgentRequest] @ID = @false_AgentIDID
        
        FETCH NEXT FROM cascade_delete_false_AgentID_cursor INTO @false_AgentIDID
    END
    
    CLOSE cascade_delete_false_AgentID_cursor
    DEALLOCATE cascade_delete_false_AgentID_cursor
    
    -- Cascade delete from AIAgentRun using cursor to call spDeleteMJAIAgentRun
    DECLARE @false_AgentIDID uniqueidentifier
    DECLARE cascade_delete_false_AgentID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[AIAgentRun]
        WHERE [AgentID] = @ID
    
    OPEN cascade_delete_false_AgentID_cursor
    FETCH NEXT FROM cascade_delete_false_AgentID_cursor INTO @false_AgentIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteMJAIAgentRun] @ID = @false_AgentIDID
        
        FETCH NEXT FROM cascade_delete_false_AgentID_cursor INTO @false_AgentIDID
    END
    
    CLOSE cascade_delete_false_AgentID_cursor
    DEALLOCATE cascade_delete_false_AgentID_cursor
    
    -- Cascade delete from AIAgentStep using cursor to call spDeleteMJAIAgentStep
    DECLARE @false_AgentIDID uniqueidentifier
    DECLARE cascade_delete_false_AgentID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[AIAgentStep]
        WHERE [AgentID] = @ID
    
    OPEN cascade_delete_false_AgentID_cursor
    FETCH NEXT FROM cascade_delete_false_AgentID_cursor INTO @false_AgentIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteMJAIAgentStep] @ID = @false_AgentIDID
        
        FETCH NEXT FROM cascade_delete_false_AgentID_cursor INTO @false_AgentIDID
    END
    
    CLOSE cascade_delete_false_AgentID_cursor
    DEALLOCATE cascade_delete_false_AgentID_cursor
    
    -- Cascade update on AIAgentStep using cursor to call spUpdateMJAIAgentStep
    DECLARE @false_SubAgentIDID uniqueidentifier
    DECLARE @false_SubAgentID_AgentID uniqueidentifier
    DECLARE @false_SubAgentID_Name nvarchar(255)
    DECLARE @false_SubAgentID_Description nvarchar(MAX)
    DECLARE @false_SubAgentID_StepType nvarchar(20)
    DECLARE @false_SubAgentID_StartingStep bit
    DECLARE @false_SubAgentID_TimeoutSeconds int
    DECLARE @false_SubAgentID_RetryCount int
    DECLARE @false_SubAgentID_OnErrorBehavior nvarchar(20)
    DECLARE @false_SubAgentID_ActionID uniqueidentifier
    DECLARE @false_SubAgentID_SubAgentID uniqueidentifier
    DECLARE @false_SubAgentID_PromptID uniqueidentifier
    DECLARE @false_SubAgentID_ActionOutputMapping nvarchar(MAX)
    DECLARE @false_SubAgentID_PositionX int
    DECLARE @false_SubAgentID_PositionY int
    DECLARE @false_SubAgentID_Width int
    DECLARE @false_SubAgentID_Height int
    DECLARE @false_SubAgentID_Status nvarchar(20)
    DECLARE @false_SubAgentID_ActionInputMapping nvarchar(MAX)
    DECLARE @false_SubAgentID_LoopBodyType nvarchar(50)
    DECLARE @false_SubAgentID_Configuration nvarchar(MAX)
    DECLARE cascade_update_false_SubAgentID_cursor CURSOR FOR
        SELECT [ID], [AgentID], [Name], [Description], [StepType], [StartingStep], [TimeoutSeconds], [RetryCount], [OnErrorBehavior], [ActionID], [SubAgentID], [PromptID], [ActionOutputMapping], [PositionX], [PositionY], [Width], [Height], [Status], [ActionInputMapping], [LoopBodyType], [Configuration]
        FROM [${flyway:defaultSchema}].[AIAgentStep]
        WHERE [SubAgentID] = @ID

    OPEN cascade_update_false_SubAgentID_cursor
    FETCH NEXT FROM cascade_update_false_SubAgentID_cursor INTO @false_SubAgentIDID, @false_SubAgentID_AgentID, @false_SubAgentID_Name, @false_SubAgentID_Description, @false_SubAgentID_StepType, @false_SubAgentID_StartingStep, @false_SubAgentID_TimeoutSeconds, @false_SubAgentID_RetryCount, @false_SubAgentID_OnErrorBehavior, @false_SubAgentID_ActionID, @false_SubAgentID_SubAgentID, @false_SubAgentID_PromptID, @false_SubAgentID_ActionOutputMapping, @false_SubAgentID_PositionX, @false_SubAgentID_PositionY, @false_SubAgentID_Width, @false_SubAgentID_Height, @false_SubAgentID_Status, @false_SubAgentID_ActionInputMapping, @false_SubAgentID_LoopBodyType, @false_SubAgentID_Configuration

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @false_SubAgentID_SubAgentID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateMJAIAgentStep] @ID = @false_SubAgentIDID, @AgentID = @false_SubAgentID_AgentID, @Name = @false_SubAgentID_Name, @Description = @false_SubAgentID_Description, @StepType = @false_SubAgentID_StepType, @StartingStep = @false_SubAgentID_StartingStep, @TimeoutSeconds = @false_SubAgentID_TimeoutSeconds, @RetryCount = @false_SubAgentID_RetryCount, @OnErrorBehavior = @false_SubAgentID_OnErrorBehavior, @ActionID = @false_SubAgentID_ActionID, @SubAgentID = @false_SubAgentID_SubAgentID, @PromptID = @false_SubAgentID_PromptID, @ActionOutputMapping = @false_SubAgentID_ActionOutputMapping, @PositionX = @false_SubAgentID_PositionX, @PositionY = @false_SubAgentID_PositionY, @Width = @false_SubAgentID_Width, @Height = @false_SubAgentID_Height, @Status = @false_SubAgentID_Status, @ActionInputMapping = @false_SubAgentID_ActionInputMapping, @LoopBodyType = @false_SubAgentID_LoopBodyType, @Configuration = @false_SubAgentID_Configuration

        FETCH NEXT FROM cascade_update_false_SubAgentID_cursor INTO @false_SubAgentIDID, @false_SubAgentID_AgentID, @false_SubAgentID_Name, @false_SubAgentID_Description, @false_SubAgentID_StepType, @false_SubAgentID_StartingStep, @false_SubAgentID_TimeoutSeconds, @false_SubAgentID_RetryCount, @false_SubAgentID_OnErrorBehavior, @false_SubAgentID_ActionID, @false_SubAgentID_SubAgentID, @false_SubAgentID_PromptID, @false_SubAgentID_ActionOutputMapping, @false_SubAgentID_PositionX, @false_SubAgentID_PositionY, @false_SubAgentID_Width, @false_SubAgentID_Height, @false_SubAgentID_Status, @false_SubAgentID_ActionInputMapping, @false_SubAgentID_LoopBodyType, @false_SubAgentID_Configuration
    END

    CLOSE cascade_update_false_SubAgentID_cursor
    DEALLOCATE cascade_update_false_SubAgentID_cursor
    
    -- Cascade update on AIAgent using cursor to call spUpdateMJAIAgent
    DECLARE @false_ParentIDID uniqueidentifier
    DECLARE @false_ParentID_Name nvarchar(255)
    DECLARE @false_ParentID_Description nvarchar(MAX)
    DECLARE @false_ParentID_LogoURL nvarchar(255)
    DECLARE @false_ParentID_ParentID uniqueidentifier
    DECLARE @false_ParentID_ExposeAsAction bit
    DECLARE @false_ParentID_ExecutionOrder int
    DECLARE @false_ParentID_ExecutionMode nvarchar(20)
    DECLARE @false_ParentID_EnableContextCompression bit
    DECLARE @false_ParentID_ContextCompressionMessageThreshold int
    DECLARE @false_ParentID_ContextCompressionPromptID uniqueidentifier
    DECLARE @false_ParentID_ContextCompressionMessageRetentionCount int
    DECLARE @false_ParentID_TypeID uniqueidentifier
    DECLARE @false_ParentID_Status nvarchar(20)
    DECLARE @false_ParentID_DriverClass nvarchar(255)
    DECLARE @false_ParentID_IconClass nvarchar(100)
    DECLARE @false_ParentID_ModelSelectionMode nvarchar(50)
    DECLARE @false_ParentID_PayloadDownstreamPaths nvarchar(MAX)
    DECLARE @false_ParentID_PayloadUpstreamPaths nvarchar(MAX)
    DECLARE @false_ParentID_PayloadSelfReadPaths nvarchar(MAX)
    DECLARE @false_ParentID_PayloadSelfWritePaths nvarchar(MAX)
    DECLARE @false_ParentID_PayloadScope nvarchar(MAX)
    DECLARE @false_ParentID_FinalPayloadValidation nvarchar(MAX)
    DECLARE @false_ParentID_FinalPayloadValidationMode nvarchar(25)
    DECLARE @false_ParentID_FinalPayloadValidationMaxRetries int
    DECLARE @false_ParentID_MaxCostPerRun decimal(10, 4)
    DECLARE @false_ParentID_MaxTokensPerRun int
    DECLARE @false_ParentID_MaxIterationsPerRun int
    DECLARE @false_ParentID_MaxTimePerRun int
    DECLARE @false_ParentID_MinExecutionsPerRun int
    DECLARE @false_ParentID_MaxExecutionsPerRun int
    DECLARE @false_ParentID_StartingPayloadValidation nvarchar(MAX)
    DECLARE @false_ParentID_StartingPayloadValidationMode nvarchar(25)
    DECLARE @false_ParentID_DefaultPromptEffortLevel int
    DECLARE @false_ParentID_ChatHandlingOption nvarchar(30)
    DECLARE @false_ParentID_DefaultArtifactTypeID uniqueidentifier
    DECLARE @false_ParentID_OwnerUserID uniqueidentifier
    DECLARE @false_ParentID_InvocationMode nvarchar(20)
    DECLARE @false_ParentID_ArtifactCreationMode nvarchar(20)
    DECLARE @false_ParentID_FunctionalRequirements nvarchar(MAX)
    DECLARE @false_ParentID_TechnicalDesign nvarchar(MAX)
    DECLARE @false_ParentID_InjectNotes bit
    DECLARE @false_ParentID_MaxNotesToInject int
    DECLARE @false_ParentID_NoteInjectionStrategy nvarchar(20)
    DECLARE @false_ParentID_InjectExamples bit
    DECLARE @false_ParentID_MaxExamplesToInject int
    DECLARE @false_ParentID_ExampleInjectionStrategy nvarchar(20)
    DECLARE @false_ParentID_IsRestricted bit
    DECLARE @false_ParentID_MessageMode nvarchar(50)
    DECLARE @false_ParentID_MaxMessages int
    DECLARE @false_ParentID_AttachmentStorageProviderID uniqueidentifier
    DECLARE @false_ParentID_AttachmentRootPath nvarchar(500)
    DECLARE @false_ParentID_InlineStorageThresholdBytes int
    DECLARE @false_ParentID_AgentTypePromptParams nvarchar(MAX)
    DECLARE @false_ParentID_ScopeConfig nvarchar(MAX)
    DECLARE @false_ParentID_NoteRetentionDays int
    DECLARE @false_ParentID_ExampleRetentionDays int
    DECLARE @false_ParentID_AutoArchiveEnabled bit
    DECLARE @false_ParentID_RerankerConfiguration nvarchar(MAX)
    DECLARE cascade_update_false_ParentID_cursor CURSOR FOR
        SELECT [ID], [Name], [Description], [LogoURL], [ParentID], [ExposeAsAction], [ExecutionOrder], [ExecutionMode], [EnableContextCompression], [ContextCompressionMessageThreshold], [ContextCompressionPromptID], [ContextCompressionMessageRetentionCount], [TypeID], [Status], [DriverClass], [IconClass], [ModelSelectionMode], [PayloadDownstreamPaths], [PayloadUpstreamPaths], [PayloadSelfReadPaths], [PayloadSelfWritePaths], [PayloadScope], [FinalPayloadValidation], [FinalPayloadValidationMode], [FinalPayloadValidationMaxRetries], [MaxCostPerRun], [MaxTokensPerRun], [MaxIterationsPerRun], [MaxTimePerRun], [MinExecutionsPerRun], [MaxExecutionsPerRun], [StartingPayloadValidation], [StartingPayloadValidationMode], [DefaultPromptEffortLevel], [ChatHandlingOption], [DefaultArtifactTypeID], [OwnerUserID], [InvocationMode], [ArtifactCreationMode], [FunctionalRequirements], [TechnicalDesign], [InjectNotes], [MaxNotesToInject], [NoteInjectionStrategy], [InjectExamples], [MaxExamplesToInject], [ExampleInjectionStrategy], [IsRestricted], [MessageMode], [MaxMessages], [AttachmentStorageProviderID], [AttachmentRootPath], [InlineStorageThresholdBytes], [AgentTypePromptParams], [ScopeConfig], [NoteRetentionDays], [ExampleRetentionDays], [AutoArchiveEnabled], [RerankerConfiguration]
        FROM [${flyway:defaultSchema}].[AIAgent]
        WHERE [ParentID] = @ID

    OPEN cascade_update_false_ParentID_cursor
    FETCH NEXT FROM cascade_update_false_ParentID_cursor INTO @false_ParentIDID, @false_ParentID_Name, @false_ParentID_Description, @false_ParentID_LogoURL, @false_ParentID_ParentID, @false_ParentID_ExposeAsAction, @false_ParentID_ExecutionOrder, @false_ParentID_ExecutionMode, @false_ParentID_EnableContextCompression, @false_ParentID_ContextCompressionMessageThreshold, @false_ParentID_ContextCompressionPromptID, @false_ParentID_ContextCompressionMessageRetentionCount, @false_ParentID_TypeID, @false_ParentID_Status, @false_ParentID_DriverClass, @false_ParentID_IconClass, @false_ParentID_ModelSelectionMode, @false_ParentID_PayloadDownstreamPaths, @false_ParentID_PayloadUpstreamPaths, @false_ParentID_PayloadSelfReadPaths, @false_ParentID_PayloadSelfWritePaths, @false_ParentID_PayloadScope, @false_ParentID_FinalPayloadValidation, @false_ParentID_FinalPayloadValidationMode, @false_ParentID_FinalPayloadValidationMaxRetries, @false_ParentID_MaxCostPerRun, @false_ParentID_MaxTokensPerRun, @false_ParentID_MaxIterationsPerRun, @false_ParentID_MaxTimePerRun, @false_ParentID_MinExecutionsPerRun, @false_ParentID_MaxExecutionsPerRun, @false_ParentID_StartingPayloadValidation, @false_ParentID_StartingPayloadValidationMode, @false_ParentID_DefaultPromptEffortLevel, @false_ParentID_ChatHandlingOption, @false_ParentID_DefaultArtifactTypeID, @false_ParentID_OwnerUserID, @false_ParentID_InvocationMode, @false_ParentID_ArtifactCreationMode, @false_ParentID_FunctionalRequirements, @false_ParentID_TechnicalDesign, @false_ParentID_InjectNotes, @false_ParentID_MaxNotesToInject, @false_ParentID_NoteInjectionStrategy, @false_ParentID_InjectExamples, @false_ParentID_MaxExamplesToInject, @false_ParentID_ExampleInjectionStrategy, @false_ParentID_IsRestricted, @false_ParentID_MessageMode, @false_ParentID_MaxMessages, @false_ParentID_AttachmentStorageProviderID, @false_ParentID_AttachmentRootPath, @false_ParentID_InlineStorageThresholdBytes, @false_ParentID_AgentTypePromptParams, @false_ParentID_ScopeConfig, @false_ParentID_NoteRetentionDays, @false_ParentID_ExampleRetentionDays, @false_ParentID_AutoArchiveEnabled, @false_ParentID_RerankerConfiguration

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @false_ParentID_ParentID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateMJAIAgent] @ID = @false_ParentIDID, @Name = @false_ParentID_Name, @Description = @false_ParentID_Description, @LogoURL = @false_ParentID_LogoURL, @ParentID = @false_ParentID_ParentID, @ExposeAsAction = @false_ParentID_ExposeAsAction, @ExecutionOrder = @false_ParentID_ExecutionOrder, @ExecutionMode = @false_ParentID_ExecutionMode, @EnableContextCompression = @false_ParentID_EnableContextCompression, @ContextCompressionMessageThreshold = @false_ParentID_ContextCompressionMessageThreshold, @ContextCompressionPromptID = @false_ParentID_ContextCompressionPromptID, @ContextCompressionMessageRetentionCount = @false_ParentID_ContextCompressionMessageRetentionCount, @TypeID = @false_ParentID_TypeID, @Status = @false_ParentID_Status, @DriverClass = @false_ParentID_DriverClass, @IconClass = @false_ParentID_IconClass, @ModelSelectionMode = @false_ParentID_ModelSelectionMode, @PayloadDownstreamPaths = @false_ParentID_PayloadDownstreamPaths, @PayloadUpstreamPaths = @false_ParentID_PayloadUpstreamPaths, @PayloadSelfReadPaths = @false_ParentID_PayloadSelfReadPaths, @PayloadSelfWritePaths = @false_ParentID_PayloadSelfWritePaths, @PayloadScope = @false_ParentID_PayloadScope, @FinalPayloadValidation = @false_ParentID_FinalPayloadValidation, @FinalPayloadValidationMode = @false_ParentID_FinalPayloadValidationMode, @FinalPayloadValidationMaxRetries = @false_ParentID_FinalPayloadValidationMaxRetries, @MaxCostPerRun = @false_ParentID_MaxCostPerRun, @MaxTokensPerRun = @false_ParentID_MaxTokensPerRun, @MaxIterationsPerRun = @false_ParentID_MaxIterationsPerRun, @MaxTimePerRun = @false_ParentID_MaxTimePerRun, @MinExecutionsPerRun = @false_ParentID_MinExecutionsPerRun, @MaxExecutionsPerRun = @false_ParentID_MaxExecutionsPerRun, @StartingPayloadValidation = @false_ParentID_StartingPayloadValidation, @StartingPayloadValidationMode = @false_ParentID_StartingPayloadValidationMode, @DefaultPromptEffortLevel = @false_ParentID_DefaultPromptEffortLevel, @ChatHandlingOption = @false_ParentID_ChatHandlingOption, @DefaultArtifactTypeID = @false_ParentID_DefaultArtifactTypeID, @OwnerUserID = @false_ParentID_OwnerUserID, @InvocationMode = @false_ParentID_InvocationMode, @ArtifactCreationMode = @false_ParentID_ArtifactCreationMode, @FunctionalRequirements = @false_ParentID_FunctionalRequirements, @TechnicalDesign = @false_ParentID_TechnicalDesign, @InjectNotes = @false_ParentID_InjectNotes, @MaxNotesToInject = @false_ParentID_MaxNotesToInject, @NoteInjectionStrategy = @false_ParentID_NoteInjectionStrategy, @InjectExamples = @false_ParentID_InjectExamples, @MaxExamplesToInject = @false_ParentID_MaxExamplesToInject, @ExampleInjectionStrategy = @false_ParentID_ExampleInjectionStrategy, @IsRestricted = @false_ParentID_IsRestricted, @MessageMode = @false_ParentID_MessageMode, @MaxMessages = @false_ParentID_MaxMessages, @AttachmentStorageProviderID = @false_ParentID_AttachmentStorageProviderID, @AttachmentRootPath = @false_ParentID_AttachmentRootPath, @InlineStorageThresholdBytes = @false_ParentID_InlineStorageThresholdBytes, @AgentTypePromptParams = @false_ParentID_AgentTypePromptParams, @ScopeConfig = @false_ParentID_ScopeConfig, @NoteRetentionDays = @false_ParentID_NoteRetentionDays, @ExampleRetentionDays = @false_ParentID_ExampleRetentionDays, @AutoArchiveEnabled = @false_ParentID_AutoArchiveEnabled, @RerankerConfiguration = @false_ParentID_RerankerConfiguration

        FETCH NEXT FROM cascade_update_false_ParentID_cursor INTO @false_ParentIDID, @false_ParentID_Name, @false_ParentID_Description, @false_ParentID_LogoURL, @false_ParentID_ParentID, @false_ParentID_ExposeAsAction, @false_ParentID_ExecutionOrder, @false_ParentID_ExecutionMode, @false_ParentID_EnableContextCompression, @false_ParentID_ContextCompressionMessageThreshold, @false_ParentID_ContextCompressionPromptID, @false_ParentID_ContextCompressionMessageRetentionCount, @false_ParentID_TypeID, @false_ParentID_Status, @false_ParentID_DriverClass, @false_ParentID_IconClass, @false_ParentID_ModelSelectionMode, @false_ParentID_PayloadDownstreamPaths, @false_ParentID_PayloadUpstreamPaths, @false_ParentID_PayloadSelfReadPaths, @false_ParentID_PayloadSelfWritePaths, @false_ParentID_PayloadScope, @false_ParentID_FinalPayloadValidation, @false_ParentID_FinalPayloadValidationMode, @false_ParentID_FinalPayloadValidationMaxRetries, @false_ParentID_MaxCostPerRun, @false_ParentID_MaxTokensPerRun, @false_ParentID_MaxIterationsPerRun, @false_ParentID_MaxTimePerRun, @false_ParentID_MinExecutionsPerRun, @false_ParentID_MaxExecutionsPerRun, @false_ParentID_StartingPayloadValidation, @false_ParentID_StartingPayloadValidationMode, @false_ParentID_DefaultPromptEffortLevel, @false_ParentID_ChatHandlingOption, @false_ParentID_DefaultArtifactTypeID, @false_ParentID_OwnerUserID, @false_ParentID_InvocationMode, @false_ParentID_ArtifactCreationMode, @false_ParentID_FunctionalRequirements, @false_ParentID_TechnicalDesign, @false_ParentID_InjectNotes, @false_ParentID_MaxNotesToInject, @false_ParentID_NoteInjectionStrategy, @false_ParentID_InjectExamples, @false_ParentID_MaxExamplesToInject, @false_ParentID_ExampleInjectionStrategy, @false_ParentID_IsRestricted, @false_ParentID_MessageMode, @false_ParentID_MaxMessages, @false_ParentID_AttachmentStorageProviderID, @false_ParentID_AttachmentRootPath, @false_ParentID_InlineStorageThresholdBytes, @false_ParentID_AgentTypePromptParams, @false_ParentID_ScopeConfig, @false_ParentID_NoteRetentionDays, @false_ParentID_ExampleRetentionDays, @false_ParentID_AutoArchiveEnabled, @false_ParentID_RerankerConfiguration
    END

    CLOSE cascade_update_false_ParentID_cursor
    DEALLOCATE cascade_update_false_ParentID_cursor
    
    -- Cascade update on AIPromptRun using cursor to call spUpdateMJAIPromptRun
    DECLARE @false_AgentIDID uniqueidentifier
    DECLARE @false_AgentID_PromptID uniqueidentifier
    DECLARE @false_AgentID_ModelID uniqueidentifier
    DECLARE @false_AgentID_VendorID uniqueidentifier
    DECLARE @false_AgentID_AgentID uniqueidentifier
    DECLARE @false_AgentID_ConfigurationID uniqueidentifier
    DECLARE @false_AgentID_RunAt datetimeoffset
    DECLARE @false_AgentID_CompletedAt datetimeoffset
    DECLARE @false_AgentID_ExecutionTimeMS int
    DECLARE @false_AgentID_Messages nvarchar(MAX)
    DECLARE @false_AgentID_Result nvarchar(MAX)
    DECLARE @false_AgentID_TokensUsed int
    DECLARE @false_AgentID_TokensPrompt int
    DECLARE @false_AgentID_TokensCompletion int
    DECLARE @false_AgentID_TotalCost decimal(18, 6)
    DECLARE @false_AgentID_Success bit
    DECLARE @false_AgentID_ErrorMessage nvarchar(MAX)
    DECLARE @false_AgentID_ParentID uniqueidentifier
    DECLARE @false_AgentID_RunType nvarchar(20)
    DECLARE @false_AgentID_ExecutionOrder int
    DECLARE @false_AgentID_AgentRunID uniqueidentifier
    DECLARE @false_AgentID_Cost decimal(19, 8)
    DECLARE @false_AgentID_CostCurrency nvarchar(10)
    DECLARE @false_AgentID_TokensUsedRollup int
    DECLARE @false_AgentID_TokensPromptRollup int
    DECLARE @false_AgentID_TokensCompletionRollup int
    DECLARE @false_AgentID_Temperature decimal(3, 2)
    DECLARE @false_AgentID_TopP decimal(3, 2)
    DECLARE @false_AgentID_TopK int
    DECLARE @false_AgentID_MinP decimal(3, 2)
    DECLARE @false_AgentID_FrequencyPenalty decimal(3, 2)
    DECLARE @false_AgentID_PresencePenalty decimal(3, 2)
    DECLARE @false_AgentID_Seed int
    DECLARE @false_AgentID_StopSequences nvarchar(MAX)
    DECLARE @false_AgentID_ResponseFormat nvarchar(50)
    DECLARE @false_AgentID_LogProbs bit
    DECLARE @false_AgentID_TopLogProbs int
    DECLARE @false_AgentID_DescendantCost decimal(18, 6)
    DECLARE @false_AgentID_ValidationAttemptCount int
    DECLARE @false_AgentID_SuccessfulValidationCount int
    DECLARE @false_AgentID_FinalValidationPassed bit
    DECLARE @false_AgentID_ValidationBehavior nvarchar(50)
    DECLARE @false_AgentID_RetryStrategy nvarchar(50)
    DECLARE @false_AgentID_MaxRetriesConfigured int
    DECLARE @false_AgentID_FinalValidationError nvarchar(500)
    DECLARE @false_AgentID_ValidationErrorCount int
    DECLARE @false_AgentID_CommonValidationError nvarchar(255)
    DECLARE @false_AgentID_FirstAttemptAt datetimeoffset
    DECLARE @false_AgentID_LastAttemptAt datetimeoffset
    DECLARE @false_AgentID_TotalRetryDurationMS int
    DECLARE @false_AgentID_ValidationAttempts nvarchar(MAX)
    DECLARE @false_AgentID_ValidationSummary nvarchar(MAX)
    DECLARE @false_AgentID_FailoverAttempts int
    DECLARE @false_AgentID_FailoverErrors nvarchar(MAX)
    DECLARE @false_AgentID_FailoverDurations nvarchar(MAX)
    DECLARE @false_AgentID_OriginalModelID uniqueidentifier
    DECLARE @false_AgentID_OriginalRequestStartTime datetimeoffset
    DECLARE @false_AgentID_TotalFailoverDuration int
    DECLARE @false_AgentID_RerunFromPromptRunID uniqueidentifier
    DECLARE @false_AgentID_ModelSelection nvarchar(MAX)
    DECLARE @false_AgentID_Status nvarchar(50)
    DECLARE @false_AgentID_Cancelled bit
    DECLARE @false_AgentID_CancellationReason nvarchar(MAX)
    DECLARE @false_AgentID_ModelPowerRank int
    DECLARE @false_AgentID_SelectionStrategy nvarchar(50)
    DECLARE @false_AgentID_CacheHit bit
    DECLARE @false_AgentID_CacheKey nvarchar(500)
    DECLARE @false_AgentID_JudgeID uniqueidentifier
    DECLARE @false_AgentID_JudgeScore float(53)
    DECLARE @false_AgentID_WasSelectedResult bit
    DECLARE @false_AgentID_StreamingEnabled bit
    DECLARE @false_AgentID_FirstTokenTime int
    DECLARE @false_AgentID_ErrorDetails nvarchar(MAX)
    DECLARE @false_AgentID_ChildPromptID uniqueidentifier
    DECLARE @false_AgentID_QueueTime int
    DECLARE @false_AgentID_PromptTime int
    DECLARE @false_AgentID_CompletionTime int
    DECLARE @false_AgentID_ModelSpecificResponseDetails nvarchar(MAX)
    DECLARE @false_AgentID_EffortLevel int
    DECLARE @false_AgentID_RunName nvarchar(255)
    DECLARE @false_AgentID_Comments nvarchar(MAX)
    DECLARE @false_AgentID_TestRunID uniqueidentifier
    DECLARE cascade_update_false_AgentID_cursor CURSOR FOR
        SELECT [ID], [PromptID], [ModelID], [VendorID], [AgentID], [ConfigurationID], [RunAt], [CompletedAt], [ExecutionTimeMS], [Messages], [Result], [TokensUsed], [TokensPrompt], [TokensCompletion], [TotalCost], [Success], [ErrorMessage], [ParentID], [RunType], [ExecutionOrder], [AgentRunID], [Cost], [CostCurrency], [TokensUsedRollup], [TokensPromptRollup], [TokensCompletionRollup], [Temperature], [TopP], [TopK], [MinP], [FrequencyPenalty], [PresencePenalty], [Seed], [StopSequences], [ResponseFormat], [LogProbs], [TopLogProbs], [DescendantCost], [ValidationAttemptCount], [SuccessfulValidationCount], [FinalValidationPassed], [ValidationBehavior], [RetryStrategy], [MaxRetriesConfigured], [FinalValidationError], [ValidationErrorCount], [CommonValidationError], [FirstAttemptAt], [LastAttemptAt], [TotalRetryDurationMS], [ValidationAttempts], [ValidationSummary], [FailoverAttempts], [FailoverErrors], [FailoverDurations], [OriginalModelID], [OriginalRequestStartTime], [TotalFailoverDuration], [RerunFromPromptRunID], [ModelSelection], [Status], [Cancelled], [CancellationReason], [ModelPowerRank], [SelectionStrategy], [CacheHit], [CacheKey], [JudgeID], [JudgeScore], [WasSelectedResult], [StreamingEnabled], [FirstTokenTime], [ErrorDetails], [ChildPromptID], [QueueTime], [PromptTime], [CompletionTime], [ModelSpecificResponseDetails], [EffortLevel], [RunName], [Comments], [TestRunID]
        FROM [${flyway:defaultSchema}].[AIPromptRun]
        WHERE [AgentID] = @ID

    OPEN cascade_update_false_AgentID_cursor
    FETCH NEXT FROM cascade_update_false_AgentID_cursor INTO @false_AgentIDID, @false_AgentID_PromptID, @false_AgentID_ModelID, @false_AgentID_VendorID, @false_AgentID_AgentID, @false_AgentID_ConfigurationID, @false_AgentID_RunAt, @false_AgentID_CompletedAt, @false_AgentID_ExecutionTimeMS, @false_AgentID_Messages, @false_AgentID_Result, @false_AgentID_TokensUsed, @false_AgentID_TokensPrompt, @false_AgentID_TokensCompletion, @false_AgentID_TotalCost, @false_AgentID_Success, @false_AgentID_ErrorMessage, @false_AgentID_ParentID, @false_AgentID_RunType, @false_AgentID_ExecutionOrder, @false_AgentID_AgentRunID, @false_AgentID_Cost, @false_AgentID_CostCurrency, @false_AgentID_TokensUsedRollup, @false_AgentID_TokensPromptRollup, @false_AgentID_TokensCompletionRollup, @false_AgentID_Temperature, @false_AgentID_TopP, @false_AgentID_TopK, @false_AgentID_MinP, @false_AgentID_FrequencyPenalty, @false_AgentID_PresencePenalty, @false_AgentID_Seed, @false_AgentID_StopSequences, @false_AgentID_ResponseFormat, @false_AgentID_LogProbs, @false_AgentID_TopLogProbs, @false_AgentID_DescendantCost, @false_AgentID_ValidationAttemptCount, @false_AgentID_SuccessfulValidationCount, @false_AgentID_FinalValidationPassed, @false_AgentID_ValidationBehavior, @false_AgentID_RetryStrategy, @false_AgentID_MaxRetriesConfigured, @false_AgentID_FinalValidationError, @false_AgentID_ValidationErrorCount, @false_AgentID_CommonValidationError, @false_AgentID_FirstAttemptAt, @false_AgentID_LastAttemptAt, @false_AgentID_TotalRetryDurationMS, @false_AgentID_ValidationAttempts, @false_AgentID_ValidationSummary, @false_AgentID_FailoverAttempts, @false_AgentID_FailoverErrors, @false_AgentID_FailoverDurations, @false_AgentID_OriginalModelID, @false_AgentID_OriginalRequestStartTime, @false_AgentID_TotalFailoverDuration, @false_AgentID_RerunFromPromptRunID, @false_AgentID_ModelSelection, @false_AgentID_Status, @false_AgentID_Cancelled, @false_AgentID_CancellationReason, @false_AgentID_ModelPowerRank, @false_AgentID_SelectionStrategy, @false_AgentID_CacheHit, @false_AgentID_CacheKey, @false_AgentID_JudgeID, @false_AgentID_JudgeScore, @false_AgentID_WasSelectedResult, @false_AgentID_StreamingEnabled, @false_AgentID_FirstTokenTime, @false_AgentID_ErrorDetails, @false_AgentID_ChildPromptID, @false_AgentID_QueueTime, @false_AgentID_PromptTime, @false_AgentID_CompletionTime, @false_AgentID_ModelSpecificResponseDetails, @false_AgentID_EffortLevel, @false_AgentID_RunName, @false_AgentID_Comments, @false_AgentID_TestRunID

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @false_AgentID_AgentID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateMJAIPromptRun] @ID = @false_AgentIDID, @PromptID = @false_AgentID_PromptID, @ModelID = @false_AgentID_ModelID, @VendorID = @false_AgentID_VendorID, @AgentID = @false_AgentID_AgentID, @ConfigurationID = @false_AgentID_ConfigurationID, @RunAt = @false_AgentID_RunAt, @CompletedAt = @false_AgentID_CompletedAt, @ExecutionTimeMS = @false_AgentID_ExecutionTimeMS, @Messages = @false_AgentID_Messages, @Result = @false_AgentID_Result, @TokensUsed = @false_AgentID_TokensUsed, @TokensPrompt = @false_AgentID_TokensPrompt, @TokensCompletion = @false_AgentID_TokensCompletion, @TotalCost = @false_AgentID_TotalCost, @Success = @false_AgentID_Success, @ErrorMessage = @false_AgentID_ErrorMessage, @ParentID = @false_AgentID_ParentID, @RunType = @false_AgentID_RunType, @ExecutionOrder = @false_AgentID_ExecutionOrder, @AgentRunID = @false_AgentID_AgentRunID, @Cost = @false_AgentID_Cost, @CostCurrency = @false_AgentID_CostCurrency, @TokensUsedRollup = @false_AgentID_TokensUsedRollup, @TokensPromptRollup = @false_AgentID_TokensPromptRollup, @TokensCompletionRollup = @false_AgentID_TokensCompletionRollup, @Temperature = @false_AgentID_Temperature, @TopP = @false_AgentID_TopP, @TopK = @false_AgentID_TopK, @MinP = @false_AgentID_MinP, @FrequencyPenalty = @false_AgentID_FrequencyPenalty, @PresencePenalty = @false_AgentID_PresencePenalty, @Seed = @false_AgentID_Seed, @StopSequences = @false_AgentID_StopSequences, @ResponseFormat = @false_AgentID_ResponseFormat, @LogProbs = @false_AgentID_LogProbs, @TopLogProbs = @false_AgentID_TopLogProbs, @DescendantCost = @false_AgentID_DescendantCost, @ValidationAttemptCount = @false_AgentID_ValidationAttemptCount, @SuccessfulValidationCount = @false_AgentID_SuccessfulValidationCount, @FinalValidationPassed = @false_AgentID_FinalValidationPassed, @ValidationBehavior = @false_AgentID_ValidationBehavior, @RetryStrategy = @false_AgentID_RetryStrategy, @MaxRetriesConfigured = @false_AgentID_MaxRetriesConfigured, @FinalValidationError = @false_AgentID_FinalValidationError, @ValidationErrorCount = @false_AgentID_ValidationErrorCount, @CommonValidationError = @false_AgentID_CommonValidationError, @FirstAttemptAt = @false_AgentID_FirstAttemptAt, @LastAttemptAt = @false_AgentID_LastAttemptAt, @TotalRetryDurationMS = @false_AgentID_TotalRetryDurationMS, @ValidationAttempts = @false_AgentID_ValidationAttempts, @ValidationSummary = @false_AgentID_ValidationSummary, @FailoverAttempts = @false_AgentID_FailoverAttempts, @FailoverErrors = @false_AgentID_FailoverErrors, @FailoverDurations = @false_AgentID_FailoverDurations, @OriginalModelID = @false_AgentID_OriginalModelID, @OriginalRequestStartTime = @false_AgentID_OriginalRequestStartTime, @TotalFailoverDuration = @false_AgentID_TotalFailoverDuration, @RerunFromPromptRunID = @false_AgentID_RerunFromPromptRunID, @ModelSelection = @false_AgentID_ModelSelection, @Status = @false_AgentID_Status, @Cancelled = @false_AgentID_Cancelled, @CancellationReason = @false_AgentID_CancellationReason, @ModelPowerRank = @false_AgentID_ModelPowerRank, @SelectionStrategy = @false_AgentID_SelectionStrategy, @CacheHit = @false_AgentID_CacheHit, @CacheKey = @false_AgentID_CacheKey, @JudgeID = @false_AgentID_JudgeID, @JudgeScore = @false_AgentID_JudgeScore, @WasSelectedResult = @false_AgentID_WasSelectedResult, @StreamingEnabled = @false_AgentID_StreamingEnabled, @FirstTokenTime = @false_AgentID_FirstTokenTime, @ErrorDetails = @false_AgentID_ErrorDetails, @ChildPromptID = @false_AgentID_ChildPromptID, @QueueTime = @false_AgentID_QueueTime, @PromptTime = @false_AgentID_PromptTime, @CompletionTime = @false_AgentID_CompletionTime, @ModelSpecificResponseDetails = @false_AgentID_ModelSpecificResponseDetails, @EffortLevel = @false_AgentID_EffortLevel, @RunName = @false_AgentID_RunName, @Comments = @false_AgentID_Comments, @TestRunID = @false_AgentID_TestRunID

        FETCH NEXT FROM cascade_update_false_AgentID_cursor INTO @false_AgentIDID, @false_AgentID_PromptID, @false_AgentID_ModelID, @false_AgentID_VendorID, @false_AgentID_AgentID, @false_AgentID_ConfigurationID, @false_AgentID_RunAt, @false_AgentID_CompletedAt, @false_AgentID_ExecutionTimeMS, @false_AgentID_Messages, @false_AgentID_Result, @false_AgentID_TokensUsed, @false_AgentID_TokensPrompt, @false_AgentID_TokensCompletion, @false_AgentID_TotalCost, @false_AgentID_Success, @false_AgentID_ErrorMessage, @false_AgentID_ParentID, @false_AgentID_RunType, @false_AgentID_ExecutionOrder, @false_AgentID_AgentRunID, @false_AgentID_Cost, @false_AgentID_CostCurrency, @false_AgentID_TokensUsedRollup, @false_AgentID_TokensPromptRollup, @false_AgentID_TokensCompletionRollup, @false_AgentID_Temperature, @false_AgentID_TopP, @false_AgentID_TopK, @false_AgentID_MinP, @false_AgentID_FrequencyPenalty, @false_AgentID_PresencePenalty, @false_AgentID_Seed, @false_AgentID_StopSequences, @false_AgentID_ResponseFormat, @false_AgentID_LogProbs, @false_AgentID_TopLogProbs, @false_AgentID_DescendantCost, @false_AgentID_ValidationAttemptCount, @false_AgentID_SuccessfulValidationCount, @false_AgentID_FinalValidationPassed, @false_AgentID_ValidationBehavior, @false_AgentID_RetryStrategy, @false_AgentID_MaxRetriesConfigured, @false_AgentID_FinalValidationError, @false_AgentID_ValidationErrorCount, @false_AgentID_CommonValidationError, @false_AgentID_FirstAttemptAt, @false_AgentID_LastAttemptAt, @false_AgentID_TotalRetryDurationMS, @false_AgentID_ValidationAttempts, @false_AgentID_ValidationSummary, @false_AgentID_FailoverAttempts, @false_AgentID_FailoverErrors, @false_AgentID_FailoverDurations, @false_AgentID_OriginalModelID, @false_AgentID_OriginalRequestStartTime, @false_AgentID_TotalFailoverDuration, @false_AgentID_RerunFromPromptRunID, @false_AgentID_ModelSelection, @false_AgentID_Status, @false_AgentID_Cancelled, @false_AgentID_CancellationReason, @false_AgentID_ModelPowerRank, @false_AgentID_SelectionStrategy, @false_AgentID_CacheHit, @false_AgentID_CacheKey, @false_AgentID_JudgeID, @false_AgentID_JudgeScore, @false_AgentID_WasSelectedResult, @false_AgentID_StreamingEnabled, @false_AgentID_FirstTokenTime, @false_AgentID_ErrorDetails, @false_AgentID_ChildPromptID, @false_AgentID_QueueTime, @false_AgentID_PromptTime, @false_AgentID_CompletionTime, @false_AgentID_ModelSpecificResponseDetails, @false_AgentID_EffortLevel, @false_AgentID_RunName, @false_AgentID_Comments, @false_AgentID_TestRunID
    END

    CLOSE cascade_update_false_AgentID_cursor
    DEALLOCATE cascade_update_false_AgentID_cursor
    
    -- Cascade update on AIResultCache using cursor to call spUpdateMJAIResultCache
    DECLARE @false_AgentIDID uniqueidentifier
    DECLARE @false_AgentID_AIPromptID uniqueidentifier
    DECLARE @false_AgentID_AIModelID uniqueidentifier
    DECLARE @false_AgentID_RunAt datetimeoffset
    DECLARE @false_AgentID_PromptText nvarchar(MAX)
    DECLARE @false_AgentID_ResultText nvarchar(MAX)
    DECLARE @false_AgentID_Status nvarchar(50)
    DECLARE @false_AgentID_ExpiredOn datetimeoffset
    DECLARE @false_AgentID_VendorID uniqueidentifier
    DECLARE @false_AgentID_AgentID uniqueidentifier
    DECLARE @false_AgentID_ConfigurationID uniqueidentifier
    DECLARE @false_AgentID_PromptEmbedding varbinary
    DECLARE @false_AgentID_PromptRunID uniqueidentifier
    DECLARE cascade_update_false_AgentID_cursor CURSOR FOR
        SELECT [ID], [AIPromptID], [AIModelID], [RunAt], [PromptText], [ResultText], [Status], [ExpiredOn], [VendorID], [AgentID], [ConfigurationID], [PromptEmbedding], [PromptRunID]
        FROM [${flyway:defaultSchema}].[AIResultCache]
        WHERE [AgentID] = @ID

    OPEN cascade_update_false_AgentID_cursor
    FETCH NEXT FROM cascade_update_false_AgentID_cursor INTO @false_AgentIDID, @false_AgentID_AIPromptID, @false_AgentID_AIModelID, @false_AgentID_RunAt, @false_AgentID_PromptText, @false_AgentID_ResultText, @false_AgentID_Status, @false_AgentID_ExpiredOn, @false_AgentID_VendorID, @false_AgentID_AgentID, @false_AgentID_ConfigurationID, @false_AgentID_PromptEmbedding, @false_AgentID_PromptRunID

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @false_AgentID_AgentID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateMJAIResultCache] @ID = @false_AgentIDID, @AIPromptID = @false_AgentID_AIPromptID, @AIModelID = @false_AgentID_AIModelID, @RunAt = @false_AgentID_RunAt, @PromptText = @false_AgentID_PromptText, @ResultText = @false_AgentID_ResultText, @Status = @false_AgentID_Status, @ExpiredOn = @false_AgentID_ExpiredOn, @VendorID = @false_AgentID_VendorID, @AgentID = @false_AgentID_AgentID, @ConfigurationID = @false_AgentID_ConfigurationID, @PromptEmbedding = @false_AgentID_PromptEmbedding, @PromptRunID = @false_AgentID_PromptRunID

        FETCH NEXT FROM cascade_update_false_AgentID_cursor INTO @false_AgentIDID, @false_AgentID_AIPromptID, @false_AgentID_AIModelID, @false_AgentID_RunAt, @false_AgentID_PromptText, @false_AgentID_ResultText, @false_AgentID_Status, @false_AgentID_ExpiredOn, @false_AgentID_VendorID, @false_AgentID_AgentID, @false_AgentID_ConfigurationID, @false_AgentID_PromptEmbedding, @false_AgentID_PromptRunID
    END

    CLOSE cascade_update_false_AgentID_cursor
    DEALLOCATE cascade_update_false_AgentID_cursor
    
    -- Cascade update on ConversationDetail using cursor to call spUpdateMJConversationDetail
    DECLARE @false_AgentIDID uniqueidentifier
    DECLARE @false_AgentID_ConversationID uniqueidentifier
    DECLARE @false_AgentID_ExternalID nvarchar(100)
    DECLARE @false_AgentID_Role nvarchar(20)
    DECLARE @false_AgentID_Message nvarchar(MAX)
    DECLARE @false_AgentID_Error nvarchar(MAX)
    DECLARE @false_AgentID_HiddenToUser bit
    DECLARE @false_AgentID_UserRating int
    DECLARE @false_AgentID_UserFeedback nvarchar(MAX)
    DECLARE @false_AgentID_ReflectionInsights nvarchar(MAX)
    DECLARE @false_AgentID_SummaryOfEarlierConversation nvarchar(MAX)
    DECLARE @false_AgentID_UserID uniqueidentifier
    DECLARE @false_AgentID_ArtifactID uniqueidentifier
    DECLARE @false_AgentID_ArtifactVersionID uniqueidentifier
    DECLARE @false_AgentID_CompletionTime bigint
    DECLARE @false_AgentID_IsPinned bit
    DECLARE @false_AgentID_ParentID uniqueidentifier
    DECLARE @false_AgentID_AgentID uniqueidentifier
    DECLARE @false_AgentID_Status nvarchar(20)
    DECLARE @false_AgentID_SuggestedResponses nvarchar(MAX)
    DECLARE @false_AgentID_TestRunID uniqueidentifier
    DECLARE @false_AgentID_ResponseForm nvarchar(MAX)
    DECLARE @false_AgentID_ActionableCommands nvarchar(MAX)
    DECLARE @false_AgentID_AutomaticCommands nvarchar(MAX)
    DECLARE @false_AgentID_OriginalMessageChanged bit
    DECLARE cascade_update_false_AgentID_cursor CURSOR FOR
        SELECT [ID], [ConversationID], [ExternalID], [Role], [Message], [Error], [HiddenToUser], [UserRating], [UserFeedback], [ReflectionInsights], [SummaryOfEarlierConversation], [UserID], [ArtifactID], [ArtifactVersionID], [CompletionTime], [IsPinned], [ParentID], [AgentID], [Status], [SuggestedResponses], [TestRunID], [ResponseForm], [ActionableCommands], [AutomaticCommands], [OriginalMessageChanged]
        FROM [${flyway:defaultSchema}].[ConversationDetail]
        WHERE [AgentID] = @ID

    OPEN cascade_update_false_AgentID_cursor
    FETCH NEXT FROM cascade_update_false_AgentID_cursor INTO @false_AgentIDID, @false_AgentID_ConversationID, @false_AgentID_ExternalID, @false_AgentID_Role, @false_AgentID_Message, @false_AgentID_Error, @false_AgentID_HiddenToUser, @false_AgentID_UserRating, @false_AgentID_UserFeedback, @false_AgentID_ReflectionInsights, @false_AgentID_SummaryOfEarlierConversation, @false_AgentID_UserID, @false_AgentID_ArtifactID, @false_AgentID_ArtifactVersionID, @false_AgentID_CompletionTime, @false_AgentID_IsPinned, @false_AgentID_ParentID, @false_AgentID_AgentID, @false_AgentID_Status, @false_AgentID_SuggestedResponses, @false_AgentID_TestRunID, @false_AgentID_ResponseForm, @false_AgentID_ActionableCommands, @false_AgentID_AutomaticCommands, @false_AgentID_OriginalMessageChanged

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @false_AgentID_AgentID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateMJConversationDetail] @ID = @false_AgentIDID, @ConversationID = @false_AgentID_ConversationID, @ExternalID = @false_AgentID_ExternalID, @Role = @false_AgentID_Role, @Message = @false_AgentID_Message, @Error = @false_AgentID_Error, @HiddenToUser = @false_AgentID_HiddenToUser, @UserRating = @false_AgentID_UserRating, @UserFeedback = @false_AgentID_UserFeedback, @ReflectionInsights = @false_AgentID_ReflectionInsights, @SummaryOfEarlierConversation = @false_AgentID_SummaryOfEarlierConversation, @UserID = @false_AgentID_UserID, @ArtifactID = @false_AgentID_ArtifactID, @ArtifactVersionID = @false_AgentID_ArtifactVersionID, @CompletionTime = @false_AgentID_CompletionTime, @IsPinned = @false_AgentID_IsPinned, @ParentID = @false_AgentID_ParentID, @AgentID = @false_AgentID_AgentID, @Status = @false_AgentID_Status, @SuggestedResponses = @false_AgentID_SuggestedResponses, @TestRunID = @false_AgentID_TestRunID, @ResponseForm = @false_AgentID_ResponseForm, @ActionableCommands = @false_AgentID_ActionableCommands, @AutomaticCommands = @false_AgentID_AutomaticCommands, @OriginalMessageChanged = @false_AgentID_OriginalMessageChanged

        FETCH NEXT FROM cascade_update_false_AgentID_cursor INTO @false_AgentIDID, @false_AgentID_ConversationID, @false_AgentID_ExternalID, @false_AgentID_Role, @false_AgentID_Message, @false_AgentID_Error, @false_AgentID_HiddenToUser, @false_AgentID_UserRating, @false_AgentID_UserFeedback, @false_AgentID_ReflectionInsights, @false_AgentID_SummaryOfEarlierConversation, @false_AgentID_UserID, @false_AgentID_ArtifactID, @false_AgentID_ArtifactVersionID, @false_AgentID_CompletionTime, @false_AgentID_IsPinned, @false_AgentID_ParentID, @false_AgentID_AgentID, @false_AgentID_Status, @false_AgentID_SuggestedResponses, @false_AgentID_TestRunID, @false_AgentID_ResponseForm, @false_AgentID_ActionableCommands, @false_AgentID_AutomaticCommands, @false_AgentID_OriginalMessageChanged
    END

    CLOSE cascade_update_false_AgentID_cursor
    DEALLOCATE cascade_update_false_AgentID_cursor
    
    -- Cascade update on Task using cursor to call spUpdateMJTask
    DECLARE @false_AgentIDID uniqueidentifier
    DECLARE @false_AgentID_ParentID uniqueidentifier
    DECLARE @false_AgentID_Name nvarchar(255)
    DECLARE @false_AgentID_Description nvarchar(MAX)
    DECLARE @false_AgentID_TypeID uniqueidentifier
    DECLARE @false_AgentID_EnvironmentID uniqueidentifier
    DECLARE @false_AgentID_ProjectID uniqueidentifier
    DECLARE @false_AgentID_ConversationDetailID uniqueidentifier
    DECLARE @false_AgentID_UserID uniqueidentifier
    DECLARE @false_AgentID_AgentID uniqueidentifier
    DECLARE @false_AgentID_Status nvarchar(50)
    DECLARE @false_AgentID_PercentComplete int
    DECLARE @false_AgentID_DueAt datetimeoffset
    DECLARE @false_AgentID_StartedAt datetimeoffset
    DECLARE @false_AgentID_CompletedAt datetimeoffset
    DECLARE cascade_update_false_AgentID_cursor CURSOR FOR
        SELECT [ID], [ParentID], [Name], [Description], [TypeID], [EnvironmentID], [ProjectID], [ConversationDetailID], [UserID], [AgentID], [Status], [PercentComplete], [DueAt], [StartedAt], [CompletedAt]
        FROM [${flyway:defaultSchema}].[Task]
        WHERE [AgentID] = @ID

    OPEN cascade_update_false_AgentID_cursor
    FETCH NEXT FROM cascade_update_false_AgentID_cursor INTO @false_AgentIDID, @false_AgentID_ParentID, @false_AgentID_Name, @false_AgentID_Description, @false_AgentID_TypeID, @false_AgentID_EnvironmentID, @false_AgentID_ProjectID, @false_AgentID_ConversationDetailID, @false_AgentID_UserID, @false_AgentID_AgentID, @false_AgentID_Status, @false_AgentID_PercentComplete, @false_AgentID_DueAt, @false_AgentID_StartedAt, @false_AgentID_CompletedAt

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @false_AgentID_AgentID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateMJTask] @ID = @false_AgentIDID, @ParentID = @false_AgentID_ParentID, @Name = @false_AgentID_Name, @Description = @false_AgentID_Description, @TypeID = @false_AgentID_TypeID, @EnvironmentID = @false_AgentID_EnvironmentID, @ProjectID = @false_AgentID_ProjectID, @ConversationDetailID = @false_AgentID_ConversationDetailID, @UserID = @false_AgentID_UserID, @AgentID = @false_AgentID_AgentID, @Status = @false_AgentID_Status, @PercentComplete = @false_AgentID_PercentComplete, @DueAt = @false_AgentID_DueAt, @StartedAt = @false_AgentID_StartedAt, @CompletedAt = @false_AgentID_CompletedAt

        FETCH NEXT FROM cascade_update_false_AgentID_cursor INTO @false_AgentIDID, @false_AgentID_ParentID, @false_AgentID_Name, @false_AgentID_Description, @false_AgentID_TypeID, @false_AgentID_EnvironmentID, @false_AgentID_ProjectID, @false_AgentID_ConversationDetailID, @false_AgentID_UserID, @false_AgentID_AgentID, @false_AgentID_Status, @false_AgentID_PercentComplete, @false_AgentID_DueAt, @false_AgentID_StartedAt, @false_AgentID_CompletedAt
    END

    CLOSE cascade_update_false_AgentID_cursor
    DEALLOCATE cascade_update_false_AgentID_cursor
    

    DELETE FROM
        [${flyway:defaultSchema}].[AIAgent]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIAgent] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: AI Agents */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIAgent] TO [cdp_Integration]



/* Base View SQL for MJ: AI Modalities */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Modalities
-- Item: vwAIModalities
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: AI Modalities
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  AIModality
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwAIModalities]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwAIModalities];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwAIModalities]
AS
SELECT
    m.*
FROM
    [${flyway:defaultSchema}].[AIModality] AS m
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwAIModalities] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: AI Modalities */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Modalities
-- Item: Permissions for vwAIModalities
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwAIModalities] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: AI Modalities */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Modalities
-- Item: spCreateMJAIModality
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR AIModality
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJAIModality]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIModality];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIModality]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(50),
    @Description nvarchar(500),
    @ContentBlockType nvarchar(50),
    @MIMETypePattern nvarchar(100),
    @Type nvarchar(50) = NULL,
    @DefaultMaxSizeBytes int,
    @DefaultMaxCountPerMessage int,
    @DisplayOrder int = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[AIModality]
            (
                [ID],
                [Name],
                [Description],
                [ContentBlockType],
                [MIMETypePattern],
                [Type],
                [DefaultMaxSizeBytes],
                [DefaultMaxCountPerMessage],
                [DisplayOrder]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description,
                @ContentBlockType,
                @MIMETypePattern,
                ISNULL(@Type, 'Content'),
                @DefaultMaxSizeBytes,
                @DefaultMaxCountPerMessage,
                ISNULL(@DisplayOrder, 0)
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[AIModality]
            (
                [Name],
                [Description],
                [ContentBlockType],
                [MIMETypePattern],
                [Type],
                [DefaultMaxSizeBytes],
                [DefaultMaxCountPerMessage],
                [DisplayOrder]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description,
                @ContentBlockType,
                @MIMETypePattern,
                ISNULL(@Type, 'Content'),
                @DefaultMaxSizeBytes,
                @DefaultMaxCountPerMessage,
                ISNULL(@DisplayOrder, 0)
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwAIModalities] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIModality] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: AI Modalities */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIModality] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: AI Modalities */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Modalities
-- Item: spUpdateMJAIModality
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR AIModality
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJAIModality]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIModality];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIModality]
    @ID uniqueidentifier,
    @Name nvarchar(50),
    @Description nvarchar(500),
    @ContentBlockType nvarchar(50),
    @MIMETypePattern nvarchar(100),
    @Type nvarchar(50),
    @DefaultMaxSizeBytes int,
    @DefaultMaxCountPerMessage int,
    @DisplayOrder int
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIModality]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [ContentBlockType] = @ContentBlockType,
        [MIMETypePattern] = @MIMETypePattern,
        [Type] = @Type,
        [DefaultMaxSizeBytes] = @DefaultMaxSizeBytes,
        [DefaultMaxCountPerMessage] = @DefaultMaxCountPerMessage,
        [DisplayOrder] = @DisplayOrder
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwAIModalities] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwAIModalities]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIModality] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the AIModality table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJAIModality]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJAIModality];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJAIModality
ON [${flyway:defaultSchema}].[AIModality]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIModality]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[AIModality] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: AI Modalities */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIModality] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: AI Modalities */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Modalities
-- Item: spDeleteMJAIModality
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR AIModality
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJAIModality]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIModality];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIModality]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[AIModality]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIModality] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: AI Modalities */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIModality] TO [cdp_Integration]



/* Base View SQL for MJ: AI Model Actions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Model Actions
-- Item: vwAIModelActions
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: AI Model Actions
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  AIModelAction
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwAIModelActions]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwAIModelActions];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwAIModelActions]
AS
SELECT
    m.*,
    MJAIModels_AIModelID.[Name] AS [AIModel],
    MJAIActions_AIActionID.[Name] AS [AIAction]
FROM
    [${flyway:defaultSchema}].[AIModelAction] AS m
INNER JOIN
    [${flyway:defaultSchema}].[AIModel] AS MJAIModels_AIModelID
  ON
    [m].[AIModelID] = MJAIModels_AIModelID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[AIAction] AS MJAIActions_AIActionID
  ON
    [m].[AIActionID] = MJAIActions_AIActionID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwAIModelActions] TO [cdp_Integration], [cdp_Developer], [cdp_UI]
    

/* Base View Permissions SQL for MJ: AI Model Actions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Model Actions
-- Item: Permissions for vwAIModelActions
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwAIModelActions] TO [cdp_Integration], [cdp_Developer], [cdp_UI]

/* spCreate SQL for MJ: AI Model Actions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Model Actions
-- Item: spCreateMJAIModelAction
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR AIModelAction
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJAIModelAction]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIModelAction];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIModelAction]
    @ID uniqueidentifier = NULL,
    @AIModelID uniqueidentifier,
    @AIActionID uniqueidentifier,
    @IsActive bit = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[AIModelAction]
            (
                [ID],
                [AIModelID],
                [AIActionID],
                [IsActive]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @AIModelID,
                @AIActionID,
                ISNULL(@IsActive, 1)
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[AIModelAction]
            (
                [AIModelID],
                [AIActionID],
                [IsActive]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @AIModelID,
                @AIActionID,
                ISNULL(@IsActive, 1)
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwAIModelActions] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIModelAction] TO [cdp_Developer]
    

/* spCreate Permissions for MJ: AI Model Actions */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIModelAction] TO [cdp_Developer]



/* spUpdate SQL for MJ: AI Model Actions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Model Actions
-- Item: spUpdateMJAIModelAction
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR AIModelAction
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJAIModelAction]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIModelAction];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIModelAction]
    @ID uniqueidentifier,
    @AIModelID uniqueidentifier,
    @AIActionID uniqueidentifier,
    @IsActive bit
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIModelAction]
    SET
        [AIModelID] = @AIModelID,
        [AIActionID] = @AIActionID,
        [IsActive] = @IsActive
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwAIModelActions] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwAIModelActions]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIModelAction] TO [cdp_Integration], [cdp_Developer]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the AIModelAction table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJAIModelAction]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJAIModelAction];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJAIModelAction
ON [${flyway:defaultSchema}].[AIModelAction]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIModelAction]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[AIModelAction] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: AI Model Actions */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIModelAction] TO [cdp_Integration], [cdp_Developer]



/* spDelete SQL for MJ: AI Model Actions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Model Actions
-- Item: spDeleteMJAIModelAction
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR AIModelAction
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJAIModelAction]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIModelAction];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIModelAction]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[AIModelAction]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIModelAction] TO [cdp_Developer]
    

/* spDelete Permissions for MJ: AI Model Actions */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIModelAction] TO [cdp_Developer]



/* Base View SQL for MJ: AI Model Architectures */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Model Architectures
-- Item: vwAIModelArchitectures
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: AI Model Architectures
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  AIModelArchitecture
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwAIModelArchitectures]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwAIModelArchitectures];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwAIModelArchitectures]
AS
SELECT
    m.*,
    MJAIModels_ModelID.[Name] AS [Model],
    MJAIArchitectures_ArchitectureID.[Name] AS [Architecture]
FROM
    [${flyway:defaultSchema}].[AIModelArchitecture] AS m
INNER JOIN
    [${flyway:defaultSchema}].[AIModel] AS MJAIModels_ModelID
  ON
    [m].[ModelID] = MJAIModels_ModelID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[AIArchitecture] AS MJAIArchitectures_ArchitectureID
  ON
    [m].[ArchitectureID] = MJAIArchitectures_ArchitectureID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwAIModelArchitectures] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: AI Model Architectures */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Model Architectures
-- Item: Permissions for vwAIModelArchitectures
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwAIModelArchitectures] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: AI Model Architectures */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Model Architectures
-- Item: spCreateMJAIModelArchitecture
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR AIModelArchitecture
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJAIModelArchitecture]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIModelArchitecture];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIModelArchitecture]
    @ID uniqueidentifier = NULL,
    @ModelID uniqueidentifier,
    @ArchitectureID uniqueidentifier,
    @Rank int = NULL,
    @Weight decimal(5, 4),
    @Notes nvarchar(500)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[AIModelArchitecture]
            (
                [ID],
                [ModelID],
                [ArchitectureID],
                [Rank],
                [Weight],
                [Notes]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @ModelID,
                @ArchitectureID,
                ISNULL(@Rank, 1),
                @Weight,
                @Notes
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[AIModelArchitecture]
            (
                [ModelID],
                [ArchitectureID],
                [Rank],
                [Weight],
                [Notes]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ModelID,
                @ArchitectureID,
                ISNULL(@Rank, 1),
                @Weight,
                @Notes
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwAIModelArchitectures] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIModelArchitecture] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: AI Model Architectures */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIModelArchitecture] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: AI Model Architectures */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Model Architectures
-- Item: spUpdateMJAIModelArchitecture
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR AIModelArchitecture
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJAIModelArchitecture]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIModelArchitecture];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIModelArchitecture]
    @ID uniqueidentifier,
    @ModelID uniqueidentifier,
    @ArchitectureID uniqueidentifier,
    @Rank int,
    @Weight decimal(5, 4),
    @Notes nvarchar(500)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIModelArchitecture]
    SET
        [ModelID] = @ModelID,
        [ArchitectureID] = @ArchitectureID,
        [Rank] = @Rank,
        [Weight] = @Weight,
        [Notes] = @Notes
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwAIModelArchitectures] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwAIModelArchitectures]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIModelArchitecture] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the AIModelArchitecture table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJAIModelArchitecture]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJAIModelArchitecture];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJAIModelArchitecture
ON [${flyway:defaultSchema}].[AIModelArchitecture]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIModelArchitecture]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[AIModelArchitecture] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: AI Model Architectures */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIModelArchitecture] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: AI Model Architectures */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Model Architectures
-- Item: spDeleteMJAIModelArchitecture
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR AIModelArchitecture
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJAIModelArchitecture]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIModelArchitecture];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIModelArchitecture]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[AIModelArchitecture]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIModelArchitecture] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: AI Model Architectures */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIModelArchitecture] TO [cdp_Integration]



/* Base View SQL for MJ: AI Model Modalities */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Model Modalities
-- Item: vwAIModelModalities
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: AI Model Modalities
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  AIModelModality
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwAIModelModalities]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwAIModelModalities];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwAIModelModalities]
AS
SELECT
    m.*,
    MJAIModels_ModelID.[Name] AS [Model],
    MJAIModalities_ModalityID.[Name] AS [Modality]
FROM
    [${flyway:defaultSchema}].[AIModelModality] AS m
INNER JOIN
    [${flyway:defaultSchema}].[AIModel] AS MJAIModels_ModelID
  ON
    [m].[ModelID] = MJAIModels_ModelID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[AIModality] AS MJAIModalities_ModalityID
  ON
    [m].[ModalityID] = MJAIModalities_ModalityID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwAIModelModalities] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: AI Model Modalities */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Model Modalities
-- Item: Permissions for vwAIModelModalities
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwAIModelModalities] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: AI Model Modalities */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Model Modalities
-- Item: spCreateMJAIModelModality
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR AIModelModality
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJAIModelModality]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIModelModality];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIModelModality]
    @ID uniqueidentifier = NULL,
    @ModelID uniqueidentifier,
    @ModalityID uniqueidentifier,
    @Direction nvarchar(10),
    @IsSupported bit = NULL,
    @IsRequired bit = NULL,
    @SupportedFormats nvarchar(500),
    @MaxSizeBytes int,
    @MaxCountPerMessage int,
    @MaxDimension int,
    @Comments nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[AIModelModality]
            (
                [ID],
                [ModelID],
                [ModalityID],
                [Direction],
                [IsSupported],
                [IsRequired],
                [SupportedFormats],
                [MaxSizeBytes],
                [MaxCountPerMessage],
                [MaxDimension],
                [Comments]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @ModelID,
                @ModalityID,
                @Direction,
                ISNULL(@IsSupported, 1),
                ISNULL(@IsRequired, 0),
                @SupportedFormats,
                @MaxSizeBytes,
                @MaxCountPerMessage,
                @MaxDimension,
                @Comments
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[AIModelModality]
            (
                [ModelID],
                [ModalityID],
                [Direction],
                [IsSupported],
                [IsRequired],
                [SupportedFormats],
                [MaxSizeBytes],
                [MaxCountPerMessage],
                [MaxDimension],
                [Comments]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ModelID,
                @ModalityID,
                @Direction,
                ISNULL(@IsSupported, 1),
                ISNULL(@IsRequired, 0),
                @SupportedFormats,
                @MaxSizeBytes,
                @MaxCountPerMessage,
                @MaxDimension,
                @Comments
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwAIModelModalities] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIModelModality] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: AI Model Modalities */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIModelModality] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: AI Model Modalities */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Model Modalities
-- Item: spUpdateMJAIModelModality
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR AIModelModality
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJAIModelModality]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIModelModality];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIModelModality]
    @ID uniqueidentifier,
    @ModelID uniqueidentifier,
    @ModalityID uniqueidentifier,
    @Direction nvarchar(10),
    @IsSupported bit,
    @IsRequired bit,
    @SupportedFormats nvarchar(500),
    @MaxSizeBytes int,
    @MaxCountPerMessage int,
    @MaxDimension int,
    @Comments nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIModelModality]
    SET
        [ModelID] = @ModelID,
        [ModalityID] = @ModalityID,
        [Direction] = @Direction,
        [IsSupported] = @IsSupported,
        [IsRequired] = @IsRequired,
        [SupportedFormats] = @SupportedFormats,
        [MaxSizeBytes] = @MaxSizeBytes,
        [MaxCountPerMessage] = @MaxCountPerMessage,
        [MaxDimension] = @MaxDimension,
        [Comments] = @Comments
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwAIModelModalities] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwAIModelModalities]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIModelModality] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the AIModelModality table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJAIModelModality]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJAIModelModality];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJAIModelModality
ON [${flyway:defaultSchema}].[AIModelModality]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIModelModality]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[AIModelModality] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: AI Model Modalities */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIModelModality] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: AI Model Modalities */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Model Modalities
-- Item: spDeleteMJAIModelModality
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR AIModelModality
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJAIModelModality]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIModelModality];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIModelModality]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[AIModelModality]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIModelModality] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: AI Model Modalities */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIModelModality] TO [cdp_Integration]



/* Base View SQL for MJ: AI Model Costs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Model Costs
-- Item: vwAIModelCosts
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: AI Model Costs
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  AIModelCost
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwAIModelCosts]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwAIModelCosts];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwAIModelCosts]
AS
SELECT
    m.*,
    MJAIModels_ModelID.[Name] AS [Model],
    MJAIVendors_VendorID.[Name] AS [Vendor],
    MJAIModelPriceTypes_PriceTypeID.[Name] AS [PriceType],
    MJAIModelPriceUnitTypes_UnitTypeID.[Name] AS [UnitType]
FROM
    [${flyway:defaultSchema}].[AIModelCost] AS m
INNER JOIN
    [${flyway:defaultSchema}].[AIModel] AS MJAIModels_ModelID
  ON
    [m].[ModelID] = MJAIModels_ModelID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[AIVendor] AS MJAIVendors_VendorID
  ON
    [m].[VendorID] = MJAIVendors_VendorID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[AIModelPriceType] AS MJAIModelPriceTypes_PriceTypeID
  ON
    [m].[PriceTypeID] = MJAIModelPriceTypes_PriceTypeID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[AIModelPriceUnitType] AS MJAIModelPriceUnitTypes_UnitTypeID
  ON
    [m].[UnitTypeID] = MJAIModelPriceUnitTypes_UnitTypeID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwAIModelCosts] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: AI Model Costs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Model Costs
-- Item: Permissions for vwAIModelCosts
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwAIModelCosts] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: AI Model Costs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Model Costs
-- Item: spCreateMJAIModelCost
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR AIModelCost
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJAIModelCost]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIModelCost];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIModelCost]
    @ID uniqueidentifier = NULL,
    @ModelID uniqueidentifier,
    @VendorID uniqueidentifier,
    @StartedAt datetimeoffset,
    @EndedAt datetimeoffset,
    @Status nvarchar(20),
    @Currency nchar(3),
    @PriceTypeID uniqueidentifier,
    @InputPricePerUnit decimal(18, 8),
    @OutputPricePerUnit decimal(18, 8),
    @UnitTypeID uniqueidentifier,
    @ProcessingType nvarchar(20),
    @Comments nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[AIModelCost]
            (
                [ID],
                [ModelID],
                [VendorID],
                [StartedAt],
                [EndedAt],
                [Status],
                [Currency],
                [PriceTypeID],
                [InputPricePerUnit],
                [OutputPricePerUnit],
                [UnitTypeID],
                [ProcessingType],
                [Comments]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @ModelID,
                @VendorID,
                @StartedAt,
                @EndedAt,
                @Status,
                @Currency,
                @PriceTypeID,
                @InputPricePerUnit,
                @OutputPricePerUnit,
                @UnitTypeID,
                @ProcessingType,
                @Comments
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[AIModelCost]
            (
                [ModelID],
                [VendorID],
                [StartedAt],
                [EndedAt],
                [Status],
                [Currency],
                [PriceTypeID],
                [InputPricePerUnit],
                [OutputPricePerUnit],
                [UnitTypeID],
                [ProcessingType],
                [Comments]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ModelID,
                @VendorID,
                @StartedAt,
                @EndedAt,
                @Status,
                @Currency,
                @PriceTypeID,
                @InputPricePerUnit,
                @OutputPricePerUnit,
                @UnitTypeID,
                @ProcessingType,
                @Comments
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwAIModelCosts] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIModelCost] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: AI Model Costs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIModelCost] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: AI Model Costs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Model Costs
-- Item: spUpdateMJAIModelCost
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR AIModelCost
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJAIModelCost]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIModelCost];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIModelCost]
    @ID uniqueidentifier,
    @ModelID uniqueidentifier,
    @VendorID uniqueidentifier,
    @StartedAt datetimeoffset,
    @EndedAt datetimeoffset,
    @Status nvarchar(20),
    @Currency nchar(3),
    @PriceTypeID uniqueidentifier,
    @InputPricePerUnit decimal(18, 8),
    @OutputPricePerUnit decimal(18, 8),
    @UnitTypeID uniqueidentifier,
    @ProcessingType nvarchar(20),
    @Comments nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIModelCost]
    SET
        [ModelID] = @ModelID,
        [VendorID] = @VendorID,
        [StartedAt] = @StartedAt,
        [EndedAt] = @EndedAt,
        [Status] = @Status,
        [Currency] = @Currency,
        [PriceTypeID] = @PriceTypeID,
        [InputPricePerUnit] = @InputPricePerUnit,
        [OutputPricePerUnit] = @OutputPricePerUnit,
        [UnitTypeID] = @UnitTypeID,
        [ProcessingType] = @ProcessingType,
        [Comments] = @Comments
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwAIModelCosts] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwAIModelCosts]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIModelCost] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the AIModelCost table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJAIModelCost]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJAIModelCost];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJAIModelCost
ON [${flyway:defaultSchema}].[AIModelCost]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIModelCost]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[AIModelCost] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: AI Model Costs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIModelCost] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: AI Model Costs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Model Costs
-- Item: spDeleteMJAIModelCost
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR AIModelCost
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJAIModelCost]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIModelCost];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIModelCost]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[AIModelCost]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIModelCost] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: AI Model Costs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIModelCost] TO [cdp_Integration]



/* Base View SQL for MJ: AI Model Price Unit Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Model Price Unit Types
-- Item: vwAIModelPriceUnitTypes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: AI Model Price Unit Types
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  AIModelPriceUnitType
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwAIModelPriceUnitTypes]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwAIModelPriceUnitTypes];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwAIModelPriceUnitTypes]
AS
SELECT
    m.*
FROM
    [${flyway:defaultSchema}].[AIModelPriceUnitType] AS m
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwAIModelPriceUnitTypes] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: AI Model Price Unit Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Model Price Unit Types
-- Item: Permissions for vwAIModelPriceUnitTypes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwAIModelPriceUnitTypes] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: AI Model Price Unit Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Model Price Unit Types
-- Item: spCreateMJAIModelPriceUnitType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR AIModelPriceUnitType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJAIModelPriceUnitType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIModelPriceUnitType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIModelPriceUnitType]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(100),
    @Description nvarchar(MAX),
    @DriverClass nvarchar(255)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[AIModelPriceUnitType]
            (
                [ID],
                [Name],
                [Description],
                [DriverClass]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description,
                @DriverClass
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[AIModelPriceUnitType]
            (
                [Name],
                [Description],
                [DriverClass]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description,
                @DriverClass
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwAIModelPriceUnitTypes] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIModelPriceUnitType] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: AI Model Price Unit Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIModelPriceUnitType] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: AI Model Price Unit Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Model Price Unit Types
-- Item: spUpdateMJAIModelPriceUnitType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR AIModelPriceUnitType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJAIModelPriceUnitType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIModelPriceUnitType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIModelPriceUnitType]
    @ID uniqueidentifier,
    @Name nvarchar(100),
    @Description nvarchar(MAX),
    @DriverClass nvarchar(255)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIModelPriceUnitType]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [DriverClass] = @DriverClass
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwAIModelPriceUnitTypes] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwAIModelPriceUnitTypes]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIModelPriceUnitType] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the AIModelPriceUnitType table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJAIModelPriceUnitType]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJAIModelPriceUnitType];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJAIModelPriceUnitType
ON [${flyway:defaultSchema}].[AIModelPriceUnitType]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIModelPriceUnitType]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[AIModelPriceUnitType] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: AI Model Price Unit Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIModelPriceUnitType] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: AI Model Price Unit Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Model Price Unit Types
-- Item: spDeleteMJAIModelPriceUnitType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR AIModelPriceUnitType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJAIModelPriceUnitType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIModelPriceUnitType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIModelPriceUnitType]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[AIModelPriceUnitType]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIModelPriceUnitType] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: AI Model Price Unit Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIModelPriceUnitType] TO [cdp_Integration]



/* Base View SQL for MJ: AI Model Price Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Model Price Types
-- Item: vwAIModelPriceTypes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: AI Model Price Types
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  AIModelPriceType
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwAIModelPriceTypes]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwAIModelPriceTypes];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwAIModelPriceTypes]
AS
SELECT
    m.*
FROM
    [${flyway:defaultSchema}].[AIModelPriceType] AS m
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwAIModelPriceTypes] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: AI Model Price Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Model Price Types
-- Item: Permissions for vwAIModelPriceTypes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwAIModelPriceTypes] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: AI Model Price Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Model Price Types
-- Item: spCreateMJAIModelPriceType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR AIModelPriceType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJAIModelPriceType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIModelPriceType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIModelPriceType]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(100),
    @Description nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[AIModelPriceType]
            (
                [ID],
                [Name],
                [Description]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[AIModelPriceType]
            (
                [Name],
                [Description]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwAIModelPriceTypes] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIModelPriceType] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: AI Model Price Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIModelPriceType] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: AI Model Price Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Model Price Types
-- Item: spUpdateMJAIModelPriceType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR AIModelPriceType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJAIModelPriceType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIModelPriceType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIModelPriceType]
    @ID uniqueidentifier,
    @Name nvarchar(100),
    @Description nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIModelPriceType]
    SET
        [Name] = @Name,
        [Description] = @Description
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwAIModelPriceTypes] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwAIModelPriceTypes]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIModelPriceType] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the AIModelPriceType table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJAIModelPriceType]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJAIModelPriceType];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJAIModelPriceType
ON [${flyway:defaultSchema}].[AIModelPriceType]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIModelPriceType]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[AIModelPriceType] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: AI Model Price Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIModelPriceType] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: AI Model Price Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Model Price Types
-- Item: spDeleteMJAIModelPriceType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR AIModelPriceType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJAIModelPriceType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIModelPriceType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIModelPriceType]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[AIModelPriceType]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIModelPriceType] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: AI Model Price Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIModelPriceType] TO [cdp_Integration]



/* Base View SQL for MJ: AI Model Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Model Types
-- Item: vwAIModelTypes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: AI Model Types
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  AIModelType
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwAIModelTypes]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwAIModelTypes];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwAIModelTypes]
AS
SELECT
    m.*,
    MJAIModalities_DefaultInputModalityID.[Name] AS [DefaultInputModality],
    MJAIModalities_DefaultOutputModalityID.[Name] AS [DefaultOutputModality]
FROM
    [${flyway:defaultSchema}].[AIModelType] AS m
INNER JOIN
    [${flyway:defaultSchema}].[AIModality] AS MJAIModalities_DefaultInputModalityID
  ON
    [m].[DefaultInputModalityID] = MJAIModalities_DefaultInputModalityID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[AIModality] AS MJAIModalities_DefaultOutputModalityID
  ON
    [m].[DefaultOutputModalityID] = MJAIModalities_DefaultOutputModalityID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwAIModelTypes] TO [cdp_Integration], [cdp_Developer], [cdp_UI]
    

/* Base View Permissions SQL for MJ: AI Model Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Model Types
-- Item: Permissions for vwAIModelTypes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwAIModelTypes] TO [cdp_Integration], [cdp_Developer], [cdp_UI]

/* spCreate SQL for MJ: AI Model Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Model Types
-- Item: spCreateMJAIModelType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR AIModelType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJAIModelType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIModelType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIModelType]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(50),
    @Description nvarchar(MAX),
    @DefaultInputModalityID uniqueidentifier,
    @DefaultOutputModalityID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[AIModelType]
            (
                [ID],
                [Name],
                [Description],
                [DefaultInputModalityID],
                [DefaultOutputModalityID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description,
                @DefaultInputModalityID,
                @DefaultOutputModalityID
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[AIModelType]
            (
                [Name],
                [Description],
                [DefaultInputModalityID],
                [DefaultOutputModalityID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description,
                @DefaultInputModalityID,
                @DefaultOutputModalityID
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwAIModelTypes] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIModelType] TO [cdp_Integration], [cdp_Developer]
    

/* spCreate Permissions for MJ: AI Model Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIModelType] TO [cdp_Integration], [cdp_Developer]



/* spUpdate SQL for MJ: AI Model Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Model Types
-- Item: spUpdateMJAIModelType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR AIModelType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJAIModelType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIModelType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIModelType]
    @ID uniqueidentifier,
    @Name nvarchar(50),
    @Description nvarchar(MAX),
    @DefaultInputModalityID uniqueidentifier,
    @DefaultOutputModalityID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIModelType]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [DefaultInputModalityID] = @DefaultInputModalityID,
        [DefaultOutputModalityID] = @DefaultOutputModalityID
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwAIModelTypes] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwAIModelTypes]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIModelType] TO [cdp_Integration], [cdp_Developer]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the AIModelType table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJAIModelType]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJAIModelType];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJAIModelType
ON [${flyway:defaultSchema}].[AIModelType]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIModelType]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[AIModelType] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: AI Model Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIModelType] TO [cdp_Integration], [cdp_Developer]



/* spDelete SQL for MJ: AI Model Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Model Types
-- Item: spDeleteMJAIModelType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR AIModelType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJAIModelType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIModelType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIModelType]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[AIModelType]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIModelType] TO [cdp_Developer]
    

/* spDelete Permissions for MJ: AI Model Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIModelType] TO [cdp_Developer]



/* Base View SQL for MJ: AI Model Vendors */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Model Vendors
-- Item: vwAIModelVendors
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: AI Model Vendors
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  AIModelVendor
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwAIModelVendors]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwAIModelVendors];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwAIModelVendors]
AS
SELECT
    m.*,
    MJAIModels_ModelID.[Name] AS [Model],
    MJAIVendors_VendorID.[Name] AS [Vendor],
    MJAIVendorTypeDefinitions_TypeID.[Name] AS [Type]
FROM
    [${flyway:defaultSchema}].[AIModelVendor] AS m
INNER JOIN
    [${flyway:defaultSchema}].[AIModel] AS MJAIModels_ModelID
  ON
    [m].[ModelID] = MJAIModels_ModelID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[AIVendor] AS MJAIVendors_VendorID
  ON
    [m].[VendorID] = MJAIVendors_VendorID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[AIVendorTypeDefinition] AS MJAIVendorTypeDefinitions_TypeID
  ON
    [m].[TypeID] = MJAIVendorTypeDefinitions_TypeID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwAIModelVendors] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: AI Model Vendors */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Model Vendors
-- Item: Permissions for vwAIModelVendors
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwAIModelVendors] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: AI Model Vendors */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Model Vendors
-- Item: spCreateMJAIModelVendor
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR AIModelVendor
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJAIModelVendor]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIModelVendor];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIModelVendor]
    @ID uniqueidentifier = NULL,
    @ModelID uniqueidentifier,
    @VendorID uniqueidentifier,
    @Priority int = NULL,
    @Status nvarchar(20) = NULL,
    @DriverClass nvarchar(100),
    @DriverImportPath nvarchar(255),
    @APIName nvarchar(100),
    @MaxInputTokens int,
    @MaxOutputTokens int,
    @SupportedResponseFormats nvarchar(100) = NULL,
    @SupportsEffortLevel bit = NULL,
    @SupportsStreaming bit = NULL,
    @TypeID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[AIModelVendor]
            (
                [ID],
                [ModelID],
                [VendorID],
                [Priority],
                [Status],
                [DriverClass],
                [DriverImportPath],
                [APIName],
                [MaxInputTokens],
                [MaxOutputTokens],
                [SupportedResponseFormats],
                [SupportsEffortLevel],
                [SupportsStreaming],
                [TypeID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @ModelID,
                @VendorID,
                ISNULL(@Priority, 0),
                ISNULL(@Status, 'Active'),
                @DriverClass,
                @DriverImportPath,
                @APIName,
                @MaxInputTokens,
                @MaxOutputTokens,
                ISNULL(@SupportedResponseFormats, 'Any'),
                ISNULL(@SupportsEffortLevel, 0),
                ISNULL(@SupportsStreaming, 0),
                @TypeID
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[AIModelVendor]
            (
                [ModelID],
                [VendorID],
                [Priority],
                [Status],
                [DriverClass],
                [DriverImportPath],
                [APIName],
                [MaxInputTokens],
                [MaxOutputTokens],
                [SupportedResponseFormats],
                [SupportsEffortLevel],
                [SupportsStreaming],
                [TypeID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ModelID,
                @VendorID,
                ISNULL(@Priority, 0),
                ISNULL(@Status, 'Active'),
                @DriverClass,
                @DriverImportPath,
                @APIName,
                @MaxInputTokens,
                @MaxOutputTokens,
                ISNULL(@SupportedResponseFormats, 'Any'),
                ISNULL(@SupportsEffortLevel, 0),
                ISNULL(@SupportsStreaming, 0),
                @TypeID
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwAIModelVendors] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIModelVendor] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: AI Model Vendors */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIModelVendor] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: AI Model Vendors */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Model Vendors
-- Item: spUpdateMJAIModelVendor
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR AIModelVendor
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJAIModelVendor]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIModelVendor];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIModelVendor]
    @ID uniqueidentifier,
    @ModelID uniqueidentifier,
    @VendorID uniqueidentifier,
    @Priority int,
    @Status nvarchar(20),
    @DriverClass nvarchar(100),
    @DriverImportPath nvarchar(255),
    @APIName nvarchar(100),
    @MaxInputTokens int,
    @MaxOutputTokens int,
    @SupportedResponseFormats nvarchar(100),
    @SupportsEffortLevel bit,
    @SupportsStreaming bit,
    @TypeID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIModelVendor]
    SET
        [ModelID] = @ModelID,
        [VendorID] = @VendorID,
        [Priority] = @Priority,
        [Status] = @Status,
        [DriverClass] = @DriverClass,
        [DriverImportPath] = @DriverImportPath,
        [APIName] = @APIName,
        [MaxInputTokens] = @MaxInputTokens,
        [MaxOutputTokens] = @MaxOutputTokens,
        [SupportedResponseFormats] = @SupportedResponseFormats,
        [SupportsEffortLevel] = @SupportsEffortLevel,
        [SupportsStreaming] = @SupportsStreaming,
        [TypeID] = @TypeID
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwAIModelVendors] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwAIModelVendors]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIModelVendor] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the AIModelVendor table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJAIModelVendor]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJAIModelVendor];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJAIModelVendor
ON [${flyway:defaultSchema}].[AIModelVendor]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIModelVendor]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[AIModelVendor] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: AI Model Vendors */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIModelVendor] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: AI Model Vendors */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Model Vendors
-- Item: spDeleteMJAIModelVendor
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR AIModelVendor
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJAIModelVendor]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIModelVendor];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIModelVendor]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[AIModelVendor]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIModelVendor] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: AI Model Vendors */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIModelVendor] TO [cdp_Integration]



/* Base View SQL for MJ: AI Prompt Categories */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Prompt Categories
-- Item: vwAIPromptCategories
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: AI Prompt Categories
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  AIPromptCategory
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwAIPromptCategories]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwAIPromptCategories];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwAIPromptCategories]
AS
SELECT
    m.*,
    MJAIPromptCategories_ParentID.[Name] AS [Parent],
    root_ParentID.RootID AS [RootParentID]
FROM
    [${flyway:defaultSchema}].[AIPromptCategory] AS m
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[AIPromptCategory] AS MJAIPromptCategories_ParentID
  ON
    [m].[ParentID] = MJAIPromptCategories_ParentID.[ID]
OUTER APPLY
    [${flyway:defaultSchema}].[fnAIPromptCategoryParentID_GetRootID]([m].[ID], [m].[ParentID]) AS root_ParentID
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwAIPromptCategories] TO [cdp_UI], [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: AI Prompt Categories */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Prompt Categories
-- Item: Permissions for vwAIPromptCategories
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwAIPromptCategories] TO [cdp_UI], [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: AI Prompt Categories */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Prompt Categories
-- Item: spCreateMJAIPromptCategory
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR AIPromptCategory
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJAIPromptCategory]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIPromptCategory];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIPromptCategory]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(255),
    @ParentID uniqueidentifier,
    @Description nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[AIPromptCategory]
            (
                [ID],
                [Name],
                [ParentID],
                [Description]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @ParentID,
                @Description
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[AIPromptCategory]
            (
                [Name],
                [ParentID],
                [Description]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @ParentID,
                @Description
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwAIPromptCategories] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIPromptCategory] TO [cdp_Developer]
    

/* spCreate Permissions for MJ: AI Prompt Categories */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIPromptCategory] TO [cdp_Developer]



/* spUpdate SQL for MJ: AI Prompt Categories */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Prompt Categories
-- Item: spUpdateMJAIPromptCategory
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR AIPromptCategory
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJAIPromptCategory]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIPromptCategory];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIPromptCategory]
    @ID uniqueidentifier,
    @Name nvarchar(255),
    @ParentID uniqueidentifier,
    @Description nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIPromptCategory]
    SET
        [Name] = @Name,
        [ParentID] = @ParentID,
        [Description] = @Description
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwAIPromptCategories] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwAIPromptCategories]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIPromptCategory] TO [cdp_Developer]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the AIPromptCategory table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJAIPromptCategory]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJAIPromptCategory];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJAIPromptCategory
ON [${flyway:defaultSchema}].[AIPromptCategory]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIPromptCategory]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[AIPromptCategory] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: AI Prompt Categories */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIPromptCategory] TO [cdp_Developer]



/* spDelete SQL for MJ: AI Prompt Categories */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Prompt Categories
-- Item: spDeleteMJAIPromptCategory
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR AIPromptCategory
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJAIPromptCategory]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIPromptCategory];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIPromptCategory]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[AIPromptCategory]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIPromptCategory] TO [cdp_Developer]
    

/* spDelete Permissions for MJ: AI Prompt Categories */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIPromptCategory] TO [cdp_Developer]



/* Base View SQL for MJ: AI Prompt Runs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Prompt Runs
-- Item: vwAIPromptRuns
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: AI Prompt Runs
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  AIPromptRun
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwAIPromptRuns]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwAIPromptRuns];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwAIPromptRuns]
AS
SELECT
    m.*,
    MJAIPrompts_PromptID.[Name] AS [Prompt],
    MJAIModels_ModelID.[Name] AS [Model],
    MJAIVendors_VendorID.[Name] AS [Vendor],
    MJAIAgents_AgentID.[Name] AS [Agent],
    MJAIConfigurations_ConfigurationID.[Name] AS [Configuration],
    MJAIPromptRuns_ParentID.[RunName] AS [Parent],
    MJAIAgentRuns_AgentRunID.[RunName] AS [AgentRun],
    MJAIModels_OriginalModelID.[Name] AS [OriginalModel],
    MJAIPromptRuns_RerunFromPromptRunID.[RunName] AS [RerunFromPromptRun],
    MJAIPrompts_JudgeID.[Name] AS [Judge],
    MJAIPrompts_ChildPromptID.[Name] AS [ChildPrompt],
    MJTestRuns_TestRunID.[Test] AS [TestRun],
    root_ParentID.RootID AS [RootParentID],
    root_RerunFromPromptRunID.RootID AS [RootRerunFromPromptRunID]
FROM
    [${flyway:defaultSchema}].[AIPromptRun] AS m
INNER JOIN
    [${flyway:defaultSchema}].[AIPrompt] AS MJAIPrompts_PromptID
  ON
    [m].[PromptID] = MJAIPrompts_PromptID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[AIModel] AS MJAIModels_ModelID
  ON
    [m].[ModelID] = MJAIModels_ModelID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[AIVendor] AS MJAIVendors_VendorID
  ON
    [m].[VendorID] = MJAIVendors_VendorID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[AIAgent] AS MJAIAgents_AgentID
  ON
    [m].[AgentID] = MJAIAgents_AgentID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[AIConfiguration] AS MJAIConfigurations_ConfigurationID
  ON
    [m].[ConfigurationID] = MJAIConfigurations_ConfigurationID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[AIPromptRun] AS MJAIPromptRuns_ParentID
  ON
    [m].[ParentID] = MJAIPromptRuns_ParentID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[AIAgentRun] AS MJAIAgentRuns_AgentRunID
  ON
    [m].[AgentRunID] = MJAIAgentRuns_AgentRunID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[AIModel] AS MJAIModels_OriginalModelID
  ON
    [m].[OriginalModelID] = MJAIModels_OriginalModelID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[AIPromptRun] AS MJAIPromptRuns_RerunFromPromptRunID
  ON
    [m].[RerunFromPromptRunID] = MJAIPromptRuns_RerunFromPromptRunID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[AIPrompt] AS MJAIPrompts_JudgeID
  ON
    [m].[JudgeID] = MJAIPrompts_JudgeID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[AIPrompt] AS MJAIPrompts_ChildPromptID
  ON
    [m].[ChildPromptID] = MJAIPrompts_ChildPromptID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[vwTestRuns] AS MJTestRuns_TestRunID
  ON
    [m].[TestRunID] = MJTestRuns_TestRunID.[ID]
OUTER APPLY
    [${flyway:defaultSchema}].[fnAIPromptRunParentID_GetRootID]([m].[ID], [m].[ParentID]) AS root_ParentID
OUTER APPLY
    [${flyway:defaultSchema}].[fnAIPromptRunRerunFromPromptRunID_GetRootID]([m].[ID], [m].[RerunFromPromptRunID]) AS root_RerunFromPromptRunID
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwAIPromptRuns] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: AI Prompt Runs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Prompt Runs
-- Item: Permissions for vwAIPromptRuns
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwAIPromptRuns] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: AI Prompt Runs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Prompt Runs
-- Item: spCreateMJAIPromptRun
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR AIPromptRun
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJAIPromptRun]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIPromptRun];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIPromptRun]
    @ID uniqueidentifier = NULL,
    @PromptID uniqueidentifier,
    @ModelID uniqueidentifier,
    @VendorID uniqueidentifier,
    @AgentID uniqueidentifier,
    @ConfigurationID uniqueidentifier,
    @RunAt datetimeoffset = NULL,
    @CompletedAt datetimeoffset,
    @ExecutionTimeMS int,
    @Messages nvarchar(MAX),
    @Result nvarchar(MAX),
    @TokensUsed int,
    @TokensPrompt int,
    @TokensCompletion int,
    @TotalCost decimal(18, 6),
    @Success bit = NULL,
    @ErrorMessage nvarchar(MAX),
    @ParentID uniqueidentifier,
    @RunType nvarchar(20) = NULL,
    @ExecutionOrder int,
    @AgentRunID uniqueidentifier,
    @Cost decimal(19, 8),
    @CostCurrency nvarchar(10),
    @TokensUsedRollup int,
    @TokensPromptRollup int,
    @TokensCompletionRollup int,
    @Temperature decimal(3, 2),
    @TopP decimal(3, 2),
    @TopK int,
    @MinP decimal(3, 2),
    @FrequencyPenalty decimal(3, 2),
    @PresencePenalty decimal(3, 2),
    @Seed int,
    @StopSequences nvarchar(MAX),
    @ResponseFormat nvarchar(50),
    @LogProbs bit,
    @TopLogProbs int,
    @DescendantCost decimal(18, 6),
    @ValidationAttemptCount int,
    @SuccessfulValidationCount int,
    @FinalValidationPassed bit,
    @ValidationBehavior nvarchar(50),
    @RetryStrategy nvarchar(50),
    @MaxRetriesConfigured int,
    @FinalValidationError nvarchar(500),
    @ValidationErrorCount int,
    @CommonValidationError nvarchar(255),
    @FirstAttemptAt datetimeoffset,
    @LastAttemptAt datetimeoffset,
    @TotalRetryDurationMS int,
    @ValidationAttempts nvarchar(MAX),
    @ValidationSummary nvarchar(MAX),
    @FailoverAttempts int,
    @FailoverErrors nvarchar(MAX),
    @FailoverDurations nvarchar(MAX),
    @OriginalModelID uniqueidentifier,
    @OriginalRequestStartTime datetimeoffset,
    @TotalFailoverDuration int,
    @RerunFromPromptRunID uniqueidentifier,
    @ModelSelection nvarchar(MAX),
    @Status nvarchar(50) = NULL,
    @Cancelled bit = NULL,
    @CancellationReason nvarchar(MAX),
    @ModelPowerRank int,
    @SelectionStrategy nvarchar(50),
    @CacheHit bit = NULL,
    @CacheKey nvarchar(500),
    @JudgeID uniqueidentifier,
    @JudgeScore float(53),
    @WasSelectedResult bit = NULL,
    @StreamingEnabled bit = NULL,
    @FirstTokenTime int,
    @ErrorDetails nvarchar(MAX),
    @ChildPromptID uniqueidentifier,
    @QueueTime int,
    @PromptTime int,
    @CompletionTime int,
    @ModelSpecificResponseDetails nvarchar(MAX),
    @EffortLevel int,
    @RunName nvarchar(255),
    @Comments nvarchar(MAX),
    @TestRunID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[AIPromptRun]
            (
                [ID],
                [PromptID],
                [ModelID],
                [VendorID],
                [AgentID],
                [ConfigurationID],
                [RunAt],
                [CompletedAt],
                [ExecutionTimeMS],
                [Messages],
                [Result],
                [TokensUsed],
                [TokensPrompt],
                [TokensCompletion],
                [TotalCost],
                [Success],
                [ErrorMessage],
                [ParentID],
                [RunType],
                [ExecutionOrder],
                [AgentRunID],
                [Cost],
                [CostCurrency],
                [TokensUsedRollup],
                [TokensPromptRollup],
                [TokensCompletionRollup],
                [Temperature],
                [TopP],
                [TopK],
                [MinP],
                [FrequencyPenalty],
                [PresencePenalty],
                [Seed],
                [StopSequences],
                [ResponseFormat],
                [LogProbs],
                [TopLogProbs],
                [DescendantCost],
                [ValidationAttemptCount],
                [SuccessfulValidationCount],
                [FinalValidationPassed],
                [ValidationBehavior],
                [RetryStrategy],
                [MaxRetriesConfigured],
                [FinalValidationError],
                [ValidationErrorCount],
                [CommonValidationError],
                [FirstAttemptAt],
                [LastAttemptAt],
                [TotalRetryDurationMS],
                [ValidationAttempts],
                [ValidationSummary],
                [FailoverAttempts],
                [FailoverErrors],
                [FailoverDurations],
                [OriginalModelID],
                [OriginalRequestStartTime],
                [TotalFailoverDuration],
                [RerunFromPromptRunID],
                [ModelSelection],
                [Status],
                [Cancelled],
                [CancellationReason],
                [ModelPowerRank],
                [SelectionStrategy],
                [CacheHit],
                [CacheKey],
                [JudgeID],
                [JudgeScore],
                [WasSelectedResult],
                [StreamingEnabled],
                [FirstTokenTime],
                [ErrorDetails],
                [ChildPromptID],
                [QueueTime],
                [PromptTime],
                [CompletionTime],
                [ModelSpecificResponseDetails],
                [EffortLevel],
                [RunName],
                [Comments],
                [TestRunID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @PromptID,
                @ModelID,
                @VendorID,
                @AgentID,
                @ConfigurationID,
                ISNULL(@RunAt, sysdatetimeoffset()),
                @CompletedAt,
                @ExecutionTimeMS,
                @Messages,
                @Result,
                @TokensUsed,
                @TokensPrompt,
                @TokensCompletion,
                @TotalCost,
                ISNULL(@Success, 0),
                @ErrorMessage,
                @ParentID,
                ISNULL(@RunType, 'Single'),
                @ExecutionOrder,
                @AgentRunID,
                @Cost,
                @CostCurrency,
                @TokensUsedRollup,
                @TokensPromptRollup,
                @TokensCompletionRollup,
                @Temperature,
                @TopP,
                @TopK,
                @MinP,
                @FrequencyPenalty,
                @PresencePenalty,
                @Seed,
                @StopSequences,
                @ResponseFormat,
                @LogProbs,
                @TopLogProbs,
                @DescendantCost,
                @ValidationAttemptCount,
                @SuccessfulValidationCount,
                @FinalValidationPassed,
                @ValidationBehavior,
                @RetryStrategy,
                @MaxRetriesConfigured,
                @FinalValidationError,
                @ValidationErrorCount,
                @CommonValidationError,
                @FirstAttemptAt,
                @LastAttemptAt,
                @TotalRetryDurationMS,
                @ValidationAttempts,
                @ValidationSummary,
                @FailoverAttempts,
                @FailoverErrors,
                @FailoverDurations,
                @OriginalModelID,
                @OriginalRequestStartTime,
                @TotalFailoverDuration,
                @RerunFromPromptRunID,
                @ModelSelection,
                ISNULL(@Status, 'Pending'),
                ISNULL(@Cancelled, 0),
                @CancellationReason,
                @ModelPowerRank,
                @SelectionStrategy,
                ISNULL(@CacheHit, 0),
                @CacheKey,
                @JudgeID,
                @JudgeScore,
                ISNULL(@WasSelectedResult, 0),
                ISNULL(@StreamingEnabled, 0),
                @FirstTokenTime,
                @ErrorDetails,
                @ChildPromptID,
                @QueueTime,
                @PromptTime,
                @CompletionTime,
                @ModelSpecificResponseDetails,
                @EffortLevel,
                @RunName,
                @Comments,
                @TestRunID
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[AIPromptRun]
            (
                [PromptID],
                [ModelID],
                [VendorID],
                [AgentID],
                [ConfigurationID],
                [RunAt],
                [CompletedAt],
                [ExecutionTimeMS],
                [Messages],
                [Result],
                [TokensUsed],
                [TokensPrompt],
                [TokensCompletion],
                [TotalCost],
                [Success],
                [ErrorMessage],
                [ParentID],
                [RunType],
                [ExecutionOrder],
                [AgentRunID],
                [Cost],
                [CostCurrency],
                [TokensUsedRollup],
                [TokensPromptRollup],
                [TokensCompletionRollup],
                [Temperature],
                [TopP],
                [TopK],
                [MinP],
                [FrequencyPenalty],
                [PresencePenalty],
                [Seed],
                [StopSequences],
                [ResponseFormat],
                [LogProbs],
                [TopLogProbs],
                [DescendantCost],
                [ValidationAttemptCount],
                [SuccessfulValidationCount],
                [FinalValidationPassed],
                [ValidationBehavior],
                [RetryStrategy],
                [MaxRetriesConfigured],
                [FinalValidationError],
                [ValidationErrorCount],
                [CommonValidationError],
                [FirstAttemptAt],
                [LastAttemptAt],
                [TotalRetryDurationMS],
                [ValidationAttempts],
                [ValidationSummary],
                [FailoverAttempts],
                [FailoverErrors],
                [FailoverDurations],
                [OriginalModelID],
                [OriginalRequestStartTime],
                [TotalFailoverDuration],
                [RerunFromPromptRunID],
                [ModelSelection],
                [Status],
                [Cancelled],
                [CancellationReason],
                [ModelPowerRank],
                [SelectionStrategy],
                [CacheHit],
                [CacheKey],
                [JudgeID],
                [JudgeScore],
                [WasSelectedResult],
                [StreamingEnabled],
                [FirstTokenTime],
                [ErrorDetails],
                [ChildPromptID],
                [QueueTime],
                [PromptTime],
                [CompletionTime],
                [ModelSpecificResponseDetails],
                [EffortLevel],
                [RunName],
                [Comments],
                [TestRunID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @PromptID,
                @ModelID,
                @VendorID,
                @AgentID,
                @ConfigurationID,
                ISNULL(@RunAt, sysdatetimeoffset()),
                @CompletedAt,
                @ExecutionTimeMS,
                @Messages,
                @Result,
                @TokensUsed,
                @TokensPrompt,
                @TokensCompletion,
                @TotalCost,
                ISNULL(@Success, 0),
                @ErrorMessage,
                @ParentID,
                ISNULL(@RunType, 'Single'),
                @ExecutionOrder,
                @AgentRunID,
                @Cost,
                @CostCurrency,
                @TokensUsedRollup,
                @TokensPromptRollup,
                @TokensCompletionRollup,
                @Temperature,
                @TopP,
                @TopK,
                @MinP,
                @FrequencyPenalty,
                @PresencePenalty,
                @Seed,
                @StopSequences,
                @ResponseFormat,
                @LogProbs,
                @TopLogProbs,
                @DescendantCost,
                @ValidationAttemptCount,
                @SuccessfulValidationCount,
                @FinalValidationPassed,
                @ValidationBehavior,
                @RetryStrategy,
                @MaxRetriesConfigured,
                @FinalValidationError,
                @ValidationErrorCount,
                @CommonValidationError,
                @FirstAttemptAt,
                @LastAttemptAt,
                @TotalRetryDurationMS,
                @ValidationAttempts,
                @ValidationSummary,
                @FailoverAttempts,
                @FailoverErrors,
                @FailoverDurations,
                @OriginalModelID,
                @OriginalRequestStartTime,
                @TotalFailoverDuration,
                @RerunFromPromptRunID,
                @ModelSelection,
                ISNULL(@Status, 'Pending'),
                ISNULL(@Cancelled, 0),
                @CancellationReason,
                @ModelPowerRank,
                @SelectionStrategy,
                ISNULL(@CacheHit, 0),
                @CacheKey,
                @JudgeID,
                @JudgeScore,
                ISNULL(@WasSelectedResult, 0),
                ISNULL(@StreamingEnabled, 0),
                @FirstTokenTime,
                @ErrorDetails,
                @ChildPromptID,
                @QueueTime,
                @PromptTime,
                @CompletionTime,
                @ModelSpecificResponseDetails,
                @EffortLevel,
                @RunName,
                @Comments,
                @TestRunID
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwAIPromptRuns] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIPromptRun] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: AI Prompt Runs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIPromptRun] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: AI Prompt Runs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Prompt Runs
-- Item: spUpdateMJAIPromptRun
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR AIPromptRun
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJAIPromptRun]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIPromptRun];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIPromptRun]
    @ID uniqueidentifier,
    @PromptID uniqueidentifier,
    @ModelID uniqueidentifier,
    @VendorID uniqueidentifier,
    @AgentID uniqueidentifier,
    @ConfigurationID uniqueidentifier,
    @RunAt datetimeoffset,
    @CompletedAt datetimeoffset,
    @ExecutionTimeMS int,
    @Messages nvarchar(MAX),
    @Result nvarchar(MAX),
    @TokensUsed int,
    @TokensPrompt int,
    @TokensCompletion int,
    @TotalCost decimal(18, 6),
    @Success bit,
    @ErrorMessage nvarchar(MAX),
    @ParentID uniqueidentifier,
    @RunType nvarchar(20),
    @ExecutionOrder int,
    @AgentRunID uniqueidentifier,
    @Cost decimal(19, 8),
    @CostCurrency nvarchar(10),
    @TokensUsedRollup int,
    @TokensPromptRollup int,
    @TokensCompletionRollup int,
    @Temperature decimal(3, 2),
    @TopP decimal(3, 2),
    @TopK int,
    @MinP decimal(3, 2),
    @FrequencyPenalty decimal(3, 2),
    @PresencePenalty decimal(3, 2),
    @Seed int,
    @StopSequences nvarchar(MAX),
    @ResponseFormat nvarchar(50),
    @LogProbs bit,
    @TopLogProbs int,
    @DescendantCost decimal(18, 6),
    @ValidationAttemptCount int,
    @SuccessfulValidationCount int,
    @FinalValidationPassed bit,
    @ValidationBehavior nvarchar(50),
    @RetryStrategy nvarchar(50),
    @MaxRetriesConfigured int,
    @FinalValidationError nvarchar(500),
    @ValidationErrorCount int,
    @CommonValidationError nvarchar(255),
    @FirstAttemptAt datetimeoffset,
    @LastAttemptAt datetimeoffset,
    @TotalRetryDurationMS int,
    @ValidationAttempts nvarchar(MAX),
    @ValidationSummary nvarchar(MAX),
    @FailoverAttempts int,
    @FailoverErrors nvarchar(MAX),
    @FailoverDurations nvarchar(MAX),
    @OriginalModelID uniqueidentifier,
    @OriginalRequestStartTime datetimeoffset,
    @TotalFailoverDuration int,
    @RerunFromPromptRunID uniqueidentifier,
    @ModelSelection nvarchar(MAX),
    @Status nvarchar(50),
    @Cancelled bit,
    @CancellationReason nvarchar(MAX),
    @ModelPowerRank int,
    @SelectionStrategy nvarchar(50),
    @CacheHit bit,
    @CacheKey nvarchar(500),
    @JudgeID uniqueidentifier,
    @JudgeScore float(53),
    @WasSelectedResult bit,
    @StreamingEnabled bit,
    @FirstTokenTime int,
    @ErrorDetails nvarchar(MAX),
    @ChildPromptID uniqueidentifier,
    @QueueTime int,
    @PromptTime int,
    @CompletionTime int,
    @ModelSpecificResponseDetails nvarchar(MAX),
    @EffortLevel int,
    @RunName nvarchar(255),
    @Comments nvarchar(MAX),
    @TestRunID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIPromptRun]
    SET
        [PromptID] = @PromptID,
        [ModelID] = @ModelID,
        [VendorID] = @VendorID,
        [AgentID] = @AgentID,
        [ConfigurationID] = @ConfigurationID,
        [RunAt] = @RunAt,
        [CompletedAt] = @CompletedAt,
        [ExecutionTimeMS] = @ExecutionTimeMS,
        [Messages] = @Messages,
        [Result] = @Result,
        [TokensUsed] = @TokensUsed,
        [TokensPrompt] = @TokensPrompt,
        [TokensCompletion] = @TokensCompletion,
        [TotalCost] = @TotalCost,
        [Success] = @Success,
        [ErrorMessage] = @ErrorMessage,
        [ParentID] = @ParentID,
        [RunType] = @RunType,
        [ExecutionOrder] = @ExecutionOrder,
        [AgentRunID] = @AgentRunID,
        [Cost] = @Cost,
        [CostCurrency] = @CostCurrency,
        [TokensUsedRollup] = @TokensUsedRollup,
        [TokensPromptRollup] = @TokensPromptRollup,
        [TokensCompletionRollup] = @TokensCompletionRollup,
        [Temperature] = @Temperature,
        [TopP] = @TopP,
        [TopK] = @TopK,
        [MinP] = @MinP,
        [FrequencyPenalty] = @FrequencyPenalty,
        [PresencePenalty] = @PresencePenalty,
        [Seed] = @Seed,
        [StopSequences] = @StopSequences,
        [ResponseFormat] = @ResponseFormat,
        [LogProbs] = @LogProbs,
        [TopLogProbs] = @TopLogProbs,
        [DescendantCost] = @DescendantCost,
        [ValidationAttemptCount] = @ValidationAttemptCount,
        [SuccessfulValidationCount] = @SuccessfulValidationCount,
        [FinalValidationPassed] = @FinalValidationPassed,
        [ValidationBehavior] = @ValidationBehavior,
        [RetryStrategy] = @RetryStrategy,
        [MaxRetriesConfigured] = @MaxRetriesConfigured,
        [FinalValidationError] = @FinalValidationError,
        [ValidationErrorCount] = @ValidationErrorCount,
        [CommonValidationError] = @CommonValidationError,
        [FirstAttemptAt] = @FirstAttemptAt,
        [LastAttemptAt] = @LastAttemptAt,
        [TotalRetryDurationMS] = @TotalRetryDurationMS,
        [ValidationAttempts] = @ValidationAttempts,
        [ValidationSummary] = @ValidationSummary,
        [FailoverAttempts] = @FailoverAttempts,
        [FailoverErrors] = @FailoverErrors,
        [FailoverDurations] = @FailoverDurations,
        [OriginalModelID] = @OriginalModelID,
        [OriginalRequestStartTime] = @OriginalRequestStartTime,
        [TotalFailoverDuration] = @TotalFailoverDuration,
        [RerunFromPromptRunID] = @RerunFromPromptRunID,
        [ModelSelection] = @ModelSelection,
        [Status] = @Status,
        [Cancelled] = @Cancelled,
        [CancellationReason] = @CancellationReason,
        [ModelPowerRank] = @ModelPowerRank,
        [SelectionStrategy] = @SelectionStrategy,
        [CacheHit] = @CacheHit,
        [CacheKey] = @CacheKey,
        [JudgeID] = @JudgeID,
        [JudgeScore] = @JudgeScore,
        [WasSelectedResult] = @WasSelectedResult,
        [StreamingEnabled] = @StreamingEnabled,
        [FirstTokenTime] = @FirstTokenTime,
        [ErrorDetails] = @ErrorDetails,
        [ChildPromptID] = @ChildPromptID,
        [QueueTime] = @QueueTime,
        [PromptTime] = @PromptTime,
        [CompletionTime] = @CompletionTime,
        [ModelSpecificResponseDetails] = @ModelSpecificResponseDetails,
        [EffortLevel] = @EffortLevel,
        [RunName] = @RunName,
        [Comments] = @Comments,
        [TestRunID] = @TestRunID
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwAIPromptRuns] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwAIPromptRuns]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIPromptRun] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the AIPromptRun table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJAIPromptRun]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJAIPromptRun];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJAIPromptRun
ON [${flyway:defaultSchema}].[AIPromptRun]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIPromptRun]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[AIPromptRun] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: AI Prompt Runs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIPromptRun] TO [cdp_Developer], [cdp_Integration]



/* Base View SQL for MJ: AI Prompt Run Medias */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Prompt Run Medias
-- Item: vwAIPromptRunMedias
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: AI Prompt Run Medias
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  AIPromptRunMedia
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwAIPromptRunMedias]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwAIPromptRunMedias];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwAIPromptRunMedias]
AS
SELECT
    m.*,
    MJAIPromptRuns_PromptRunID.[RunName] AS [PromptRun],
    MJAIModalities_ModalityID.[Name] AS [Modality],
    MJFiles_FileID.[Name] AS [File]
FROM
    [${flyway:defaultSchema}].[AIPromptRunMedia] AS m
INNER JOIN
    [${flyway:defaultSchema}].[AIPromptRun] AS MJAIPromptRuns_PromptRunID
  ON
    [m].[PromptRunID] = MJAIPromptRuns_PromptRunID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[AIModality] AS MJAIModalities_ModalityID
  ON
    [m].[ModalityID] = MJAIModalities_ModalityID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[File] AS MJFiles_FileID
  ON
    [m].[FileID] = MJFiles_FileID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwAIPromptRunMedias] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: AI Prompt Run Medias */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Prompt Run Medias
-- Item: Permissions for vwAIPromptRunMedias
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwAIPromptRunMedias] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: AI Prompt Run Medias */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Prompt Run Medias
-- Item: spCreateMJAIPromptRunMedia
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR AIPromptRunMedia
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJAIPromptRunMedia]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIPromptRunMedia];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIPromptRunMedia]
    @ID uniqueidentifier = NULL,
    @PromptRunID uniqueidentifier,
    @ModalityID uniqueidentifier,
    @MimeType nvarchar(100),
    @FileName nvarchar(255),
    @FileSizeBytes int,
    @Width int,
    @Height int,
    @DurationSeconds decimal(10, 2),
    @InlineData nvarchar(MAX),
    @FileID uniqueidentifier,
    @ThumbnailBase64 nvarchar(MAX),
    @Metadata nvarchar(MAX),
    @DisplayOrder int = NULL,
    @Description nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[AIPromptRunMedia]
            (
                [ID],
                [PromptRunID],
                [ModalityID],
                [MimeType],
                [FileName],
                [FileSizeBytes],
                [Width],
                [Height],
                [DurationSeconds],
                [InlineData],
                [FileID],
                [ThumbnailBase64],
                [Metadata],
                [DisplayOrder],
                [Description]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @PromptRunID,
                @ModalityID,
                @MimeType,
                @FileName,
                @FileSizeBytes,
                @Width,
                @Height,
                @DurationSeconds,
                @InlineData,
                @FileID,
                @ThumbnailBase64,
                @Metadata,
                ISNULL(@DisplayOrder, 0),
                @Description
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[AIPromptRunMedia]
            (
                [PromptRunID],
                [ModalityID],
                [MimeType],
                [FileName],
                [FileSizeBytes],
                [Width],
                [Height],
                [DurationSeconds],
                [InlineData],
                [FileID],
                [ThumbnailBase64],
                [Metadata],
                [DisplayOrder],
                [Description]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @PromptRunID,
                @ModalityID,
                @MimeType,
                @FileName,
                @FileSizeBytes,
                @Width,
                @Height,
                @DurationSeconds,
                @InlineData,
                @FileID,
                @ThumbnailBase64,
                @Metadata,
                ISNULL(@DisplayOrder, 0),
                @Description
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwAIPromptRunMedias] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIPromptRunMedia] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: AI Prompt Run Medias */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIPromptRunMedia] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: AI Prompt Run Medias */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Prompt Run Medias
-- Item: spUpdateMJAIPromptRunMedia
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR AIPromptRunMedia
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJAIPromptRunMedia]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIPromptRunMedia];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIPromptRunMedia]
    @ID uniqueidentifier,
    @PromptRunID uniqueidentifier,
    @ModalityID uniqueidentifier,
    @MimeType nvarchar(100),
    @FileName nvarchar(255),
    @FileSizeBytes int,
    @Width int,
    @Height int,
    @DurationSeconds decimal(10, 2),
    @InlineData nvarchar(MAX),
    @FileID uniqueidentifier,
    @ThumbnailBase64 nvarchar(MAX),
    @Metadata nvarchar(MAX),
    @DisplayOrder int,
    @Description nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIPromptRunMedia]
    SET
        [PromptRunID] = @PromptRunID,
        [ModalityID] = @ModalityID,
        [MimeType] = @MimeType,
        [FileName] = @FileName,
        [FileSizeBytes] = @FileSizeBytes,
        [Width] = @Width,
        [Height] = @Height,
        [DurationSeconds] = @DurationSeconds,
        [InlineData] = @InlineData,
        [FileID] = @FileID,
        [ThumbnailBase64] = @ThumbnailBase64,
        [Metadata] = @Metadata,
        [DisplayOrder] = @DisplayOrder,
        [Description] = @Description
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwAIPromptRunMedias] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwAIPromptRunMedias]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIPromptRunMedia] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the AIPromptRunMedia table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJAIPromptRunMedia]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJAIPromptRunMedia];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJAIPromptRunMedia
ON [${flyway:defaultSchema}].[AIPromptRunMedia]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIPromptRunMedia]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[AIPromptRunMedia] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: AI Prompt Run Medias */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIPromptRunMedia] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: AI Prompt Run Medias */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Prompt Run Medias
-- Item: spDeleteMJAIPromptRunMedia
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR AIPromptRunMedia
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJAIPromptRunMedia]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIPromptRunMedia];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIPromptRunMedia]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[AIPromptRunMedia]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIPromptRunMedia] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: AI Prompt Run Medias */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIPromptRunMedia] TO [cdp_Integration]



/* Base View SQL for MJ: AI Prompt Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Prompt Types
-- Item: vwAIPromptTypes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: AI Prompt Types
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  AIPromptType
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwAIPromptTypes]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwAIPromptTypes];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwAIPromptTypes]
AS
SELECT
    m.*
FROM
    [${flyway:defaultSchema}].[AIPromptType] AS m
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwAIPromptTypes] TO [cdp_UI], [cdp_Developer], [cdp_Integration], [cdp_UI]
    

/* Base View Permissions SQL for MJ: AI Prompt Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Prompt Types
-- Item: Permissions for vwAIPromptTypes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwAIPromptTypes] TO [cdp_UI], [cdp_Developer], [cdp_Integration], [cdp_UI]

/* spCreate SQL for MJ: AI Prompt Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Prompt Types
-- Item: spCreateMJAIPromptType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR AIPromptType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJAIPromptType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIPromptType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIPromptType]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(255),
    @Description nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[AIPromptType]
            (
                [ID],
                [Name],
                [Description]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[AIPromptType]
            (
                [Name],
                [Description]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwAIPromptTypes] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIPromptType] TO [cdp_Developer]
    

/* spCreate Permissions for MJ: AI Prompt Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIPromptType] TO [cdp_Developer]



/* spUpdate SQL for MJ: AI Prompt Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Prompt Types
-- Item: spUpdateMJAIPromptType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR AIPromptType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJAIPromptType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIPromptType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIPromptType]
    @ID uniqueidentifier,
    @Name nvarchar(255),
    @Description nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIPromptType]
    SET
        [Name] = @Name,
        [Description] = @Description
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwAIPromptTypes] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwAIPromptTypes]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIPromptType] TO [cdp_Developer]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the AIPromptType table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJAIPromptType]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJAIPromptType];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJAIPromptType
ON [${flyway:defaultSchema}].[AIPromptType]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIPromptType]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[AIPromptType] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: AI Prompt Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIPromptType] TO [cdp_Developer]



/* spDelete SQL for MJ: AI Prompt Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Prompt Types
-- Item: spDeleteMJAIPromptType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR AIPromptType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJAIPromptType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIPromptType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIPromptType]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[AIPromptType]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIPromptType] TO [cdp_Developer]
    

/* spDelete Permissions for MJ: AI Prompt Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIPromptType] TO [cdp_Developer]



/* Base View SQL for MJ: AI Prompt Models */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Prompt Models
-- Item: vwAIPromptModels
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: AI Prompt Models
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  AIPromptModel
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwAIPromptModels]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwAIPromptModels];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwAIPromptModels]
AS
SELECT
    m.*,
    MJAIPrompts_PromptID.[Name] AS [Prompt],
    MJAIModels_ModelID.[Name] AS [Model],
    MJAIVendors_VendorID.[Name] AS [Vendor],
    MJAIConfigurations_ConfigurationID.[Name] AS [Configuration]
FROM
    [${flyway:defaultSchema}].[AIPromptModel] AS m
INNER JOIN
    [${flyway:defaultSchema}].[AIPrompt] AS MJAIPrompts_PromptID
  ON
    [m].[PromptID] = MJAIPrompts_PromptID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[AIModel] AS MJAIModels_ModelID
  ON
    [m].[ModelID] = MJAIModels_ModelID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[AIVendor] AS MJAIVendors_VendorID
  ON
    [m].[VendorID] = MJAIVendors_VendorID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[AIConfiguration] AS MJAIConfigurations_ConfigurationID
  ON
    [m].[ConfigurationID] = MJAIConfigurations_ConfigurationID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwAIPromptModels] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: AI Prompt Models */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Prompt Models
-- Item: Permissions for vwAIPromptModels
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwAIPromptModels] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: AI Prompt Models */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Prompt Models
-- Item: spCreateMJAIPromptModel
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR AIPromptModel
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJAIPromptModel]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIPromptModel];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIPromptModel]
    @ID uniqueidentifier = NULL,
    @PromptID uniqueidentifier,
    @ModelID uniqueidentifier,
    @VendorID uniqueidentifier,
    @ConfigurationID uniqueidentifier,
    @Priority int = NULL,
    @ExecutionGroup int = NULL,
    @ModelParameters nvarchar(MAX),
    @Status nvarchar(20) = NULL,
    @ParallelizationMode nvarchar(20) = NULL,
    @ParallelCount int = NULL,
    @ParallelConfigParam nvarchar(100),
    @EffortLevel int
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[AIPromptModel]
            (
                [ID],
                [PromptID],
                [ModelID],
                [VendorID],
                [ConfigurationID],
                [Priority],
                [ExecutionGroup],
                [ModelParameters],
                [Status],
                [ParallelizationMode],
                [ParallelCount],
                [ParallelConfigParam],
                [EffortLevel]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @PromptID,
                @ModelID,
                @VendorID,
                @ConfigurationID,
                ISNULL(@Priority, 0),
                ISNULL(@ExecutionGroup, 0),
                @ModelParameters,
                ISNULL(@Status, 'Active'),
                ISNULL(@ParallelizationMode, 'None'),
                ISNULL(@ParallelCount, 1),
                @ParallelConfigParam,
                @EffortLevel
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[AIPromptModel]
            (
                [PromptID],
                [ModelID],
                [VendorID],
                [ConfigurationID],
                [Priority],
                [ExecutionGroup],
                [ModelParameters],
                [Status],
                [ParallelizationMode],
                [ParallelCount],
                [ParallelConfigParam],
                [EffortLevel]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @PromptID,
                @ModelID,
                @VendorID,
                @ConfigurationID,
                ISNULL(@Priority, 0),
                ISNULL(@ExecutionGroup, 0),
                @ModelParameters,
                ISNULL(@Status, 'Active'),
                ISNULL(@ParallelizationMode, 'None'),
                ISNULL(@ParallelCount, 1),
                @ParallelConfigParam,
                @EffortLevel
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwAIPromptModels] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIPromptModel] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: AI Prompt Models */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIPromptModel] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: AI Prompt Models */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Prompt Models
-- Item: spUpdateMJAIPromptModel
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR AIPromptModel
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJAIPromptModel]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIPromptModel];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIPromptModel]
    @ID uniqueidentifier,
    @PromptID uniqueidentifier,
    @ModelID uniqueidentifier,
    @VendorID uniqueidentifier,
    @ConfigurationID uniqueidentifier,
    @Priority int,
    @ExecutionGroup int,
    @ModelParameters nvarchar(MAX),
    @Status nvarchar(20),
    @ParallelizationMode nvarchar(20),
    @ParallelCount int,
    @ParallelConfigParam nvarchar(100),
    @EffortLevel int
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIPromptModel]
    SET
        [PromptID] = @PromptID,
        [ModelID] = @ModelID,
        [VendorID] = @VendorID,
        [ConfigurationID] = @ConfigurationID,
        [Priority] = @Priority,
        [ExecutionGroup] = @ExecutionGroup,
        [ModelParameters] = @ModelParameters,
        [Status] = @Status,
        [ParallelizationMode] = @ParallelizationMode,
        [ParallelCount] = @ParallelCount,
        [ParallelConfigParam] = @ParallelConfigParam,
        [EffortLevel] = @EffortLevel
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwAIPromptModels] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwAIPromptModels]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIPromptModel] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the AIPromptModel table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJAIPromptModel]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJAIPromptModel];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJAIPromptModel
ON [${flyway:defaultSchema}].[AIPromptModel]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIPromptModel]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[AIPromptModel] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: AI Prompt Models */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIPromptModel] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: AI Prompt Models */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Prompt Models
-- Item: spDeleteMJAIPromptModel
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR AIPromptModel
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJAIPromptModel]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIPromptModel];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIPromptModel]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[AIPromptModel]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIPromptModel] TO [cdp_Developer], [cdp_Integration]
    

/* spDelete Permissions for MJ: AI Prompt Models */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIPromptModel] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: AI Prompt Runs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Prompt Runs
-- Item: spDeleteMJAIPromptRun
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR AIPromptRun
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJAIPromptRun]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIPromptRun];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIPromptRun]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    -- Cascade delete from AIPromptRunMedia using cursor to call spDeleteMJAIPromptRunMedia
    DECLARE @false_PromptRunIDID uniqueidentifier
    DECLARE cascade_delete_false_PromptRunID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[AIPromptRunMedia]
        WHERE [PromptRunID] = @ID
    
    OPEN cascade_delete_false_PromptRunID_cursor
    FETCH NEXT FROM cascade_delete_false_PromptRunID_cursor INTO @false_PromptRunIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteMJAIPromptRunMedia] @ID = @false_PromptRunIDID
        
        FETCH NEXT FROM cascade_delete_false_PromptRunID_cursor INTO @false_PromptRunIDID
    END
    
    CLOSE cascade_delete_false_PromptRunID_cursor
    DEALLOCATE cascade_delete_false_PromptRunID_cursor
    
    -- Cascade update on AIPromptRun using cursor to call spUpdateMJAIPromptRun
    DECLARE @false_ParentIDID uniqueidentifier
    DECLARE @false_ParentID_PromptID uniqueidentifier
    DECLARE @false_ParentID_ModelID uniqueidentifier
    DECLARE @false_ParentID_VendorID uniqueidentifier
    DECLARE @false_ParentID_AgentID uniqueidentifier
    DECLARE @false_ParentID_ConfigurationID uniqueidentifier
    DECLARE @false_ParentID_RunAt datetimeoffset
    DECLARE @false_ParentID_CompletedAt datetimeoffset
    DECLARE @false_ParentID_ExecutionTimeMS int
    DECLARE @false_ParentID_Messages nvarchar(MAX)
    DECLARE @false_ParentID_Result nvarchar(MAX)
    DECLARE @false_ParentID_TokensUsed int
    DECLARE @false_ParentID_TokensPrompt int
    DECLARE @false_ParentID_TokensCompletion int
    DECLARE @false_ParentID_TotalCost decimal(18, 6)
    DECLARE @false_ParentID_Success bit
    DECLARE @false_ParentID_ErrorMessage nvarchar(MAX)
    DECLARE @false_ParentID_ParentID uniqueidentifier
    DECLARE @false_ParentID_RunType nvarchar(20)
    DECLARE @false_ParentID_ExecutionOrder int
    DECLARE @false_ParentID_AgentRunID uniqueidentifier
    DECLARE @false_ParentID_Cost decimal(19, 8)
    DECLARE @false_ParentID_CostCurrency nvarchar(10)
    DECLARE @false_ParentID_TokensUsedRollup int
    DECLARE @false_ParentID_TokensPromptRollup int
    DECLARE @false_ParentID_TokensCompletionRollup int
    DECLARE @false_ParentID_Temperature decimal(3, 2)
    DECLARE @false_ParentID_TopP decimal(3, 2)
    DECLARE @false_ParentID_TopK int
    DECLARE @false_ParentID_MinP decimal(3, 2)
    DECLARE @false_ParentID_FrequencyPenalty decimal(3, 2)
    DECLARE @false_ParentID_PresencePenalty decimal(3, 2)
    DECLARE @false_ParentID_Seed int
    DECLARE @false_ParentID_StopSequences nvarchar(MAX)
    DECLARE @false_ParentID_ResponseFormat nvarchar(50)
    DECLARE @false_ParentID_LogProbs bit
    DECLARE @false_ParentID_TopLogProbs int
    DECLARE @false_ParentID_DescendantCost decimal(18, 6)
    DECLARE @false_ParentID_ValidationAttemptCount int
    DECLARE @false_ParentID_SuccessfulValidationCount int
    DECLARE @false_ParentID_FinalValidationPassed bit
    DECLARE @false_ParentID_ValidationBehavior nvarchar(50)
    DECLARE @false_ParentID_RetryStrategy nvarchar(50)
    DECLARE @false_ParentID_MaxRetriesConfigured int
    DECLARE @false_ParentID_FinalValidationError nvarchar(500)
    DECLARE @false_ParentID_ValidationErrorCount int
    DECLARE @false_ParentID_CommonValidationError nvarchar(255)
    DECLARE @false_ParentID_FirstAttemptAt datetimeoffset
    DECLARE @false_ParentID_LastAttemptAt datetimeoffset
    DECLARE @false_ParentID_TotalRetryDurationMS int
    DECLARE @false_ParentID_ValidationAttempts nvarchar(MAX)
    DECLARE @false_ParentID_ValidationSummary nvarchar(MAX)
    DECLARE @false_ParentID_FailoverAttempts int
    DECLARE @false_ParentID_FailoverErrors nvarchar(MAX)
    DECLARE @false_ParentID_FailoverDurations nvarchar(MAX)
    DECLARE @false_ParentID_OriginalModelID uniqueidentifier
    DECLARE @false_ParentID_OriginalRequestStartTime datetimeoffset
    DECLARE @false_ParentID_TotalFailoverDuration int
    DECLARE @false_ParentID_RerunFromPromptRunID uniqueidentifier
    DECLARE @false_ParentID_ModelSelection nvarchar(MAX)
    DECLARE @false_ParentID_Status nvarchar(50)
    DECLARE @false_ParentID_Cancelled bit
    DECLARE @false_ParentID_CancellationReason nvarchar(MAX)
    DECLARE @false_ParentID_ModelPowerRank int
    DECLARE @false_ParentID_SelectionStrategy nvarchar(50)
    DECLARE @false_ParentID_CacheHit bit
    DECLARE @false_ParentID_CacheKey nvarchar(500)
    DECLARE @false_ParentID_JudgeID uniqueidentifier
    DECLARE @false_ParentID_JudgeScore float(53)
    DECLARE @false_ParentID_WasSelectedResult bit
    DECLARE @false_ParentID_StreamingEnabled bit
    DECLARE @false_ParentID_FirstTokenTime int
    DECLARE @false_ParentID_ErrorDetails nvarchar(MAX)
    DECLARE @false_ParentID_ChildPromptID uniqueidentifier
    DECLARE @false_ParentID_QueueTime int
    DECLARE @false_ParentID_PromptTime int
    DECLARE @false_ParentID_CompletionTime int
    DECLARE @false_ParentID_ModelSpecificResponseDetails nvarchar(MAX)
    DECLARE @false_ParentID_EffortLevel int
    DECLARE @false_ParentID_RunName nvarchar(255)
    DECLARE @false_ParentID_Comments nvarchar(MAX)
    DECLARE @false_ParentID_TestRunID uniqueidentifier
    DECLARE cascade_update_false_ParentID_cursor CURSOR FOR
        SELECT [ID], [PromptID], [ModelID], [VendorID], [AgentID], [ConfigurationID], [RunAt], [CompletedAt], [ExecutionTimeMS], [Messages], [Result], [TokensUsed], [TokensPrompt], [TokensCompletion], [TotalCost], [Success], [ErrorMessage], [ParentID], [RunType], [ExecutionOrder], [AgentRunID], [Cost], [CostCurrency], [TokensUsedRollup], [TokensPromptRollup], [TokensCompletionRollup], [Temperature], [TopP], [TopK], [MinP], [FrequencyPenalty], [PresencePenalty], [Seed], [StopSequences], [ResponseFormat], [LogProbs], [TopLogProbs], [DescendantCost], [ValidationAttemptCount], [SuccessfulValidationCount], [FinalValidationPassed], [ValidationBehavior], [RetryStrategy], [MaxRetriesConfigured], [FinalValidationError], [ValidationErrorCount], [CommonValidationError], [FirstAttemptAt], [LastAttemptAt], [TotalRetryDurationMS], [ValidationAttempts], [ValidationSummary], [FailoverAttempts], [FailoverErrors], [FailoverDurations], [OriginalModelID], [OriginalRequestStartTime], [TotalFailoverDuration], [RerunFromPromptRunID], [ModelSelection], [Status], [Cancelled], [CancellationReason], [ModelPowerRank], [SelectionStrategy], [CacheHit], [CacheKey], [JudgeID], [JudgeScore], [WasSelectedResult], [StreamingEnabled], [FirstTokenTime], [ErrorDetails], [ChildPromptID], [QueueTime], [PromptTime], [CompletionTime], [ModelSpecificResponseDetails], [EffortLevel], [RunName], [Comments], [TestRunID]
        FROM [${flyway:defaultSchema}].[AIPromptRun]
        WHERE [ParentID] = @ID

    OPEN cascade_update_false_ParentID_cursor
    FETCH NEXT FROM cascade_update_false_ParentID_cursor INTO @false_ParentIDID, @false_ParentID_PromptID, @false_ParentID_ModelID, @false_ParentID_VendorID, @false_ParentID_AgentID, @false_ParentID_ConfigurationID, @false_ParentID_RunAt, @false_ParentID_CompletedAt, @false_ParentID_ExecutionTimeMS, @false_ParentID_Messages, @false_ParentID_Result, @false_ParentID_TokensUsed, @false_ParentID_TokensPrompt, @false_ParentID_TokensCompletion, @false_ParentID_TotalCost, @false_ParentID_Success, @false_ParentID_ErrorMessage, @false_ParentID_ParentID, @false_ParentID_RunType, @false_ParentID_ExecutionOrder, @false_ParentID_AgentRunID, @false_ParentID_Cost, @false_ParentID_CostCurrency, @false_ParentID_TokensUsedRollup, @false_ParentID_TokensPromptRollup, @false_ParentID_TokensCompletionRollup, @false_ParentID_Temperature, @false_ParentID_TopP, @false_ParentID_TopK, @false_ParentID_MinP, @false_ParentID_FrequencyPenalty, @false_ParentID_PresencePenalty, @false_ParentID_Seed, @false_ParentID_StopSequences, @false_ParentID_ResponseFormat, @false_ParentID_LogProbs, @false_ParentID_TopLogProbs, @false_ParentID_DescendantCost, @false_ParentID_ValidationAttemptCount, @false_ParentID_SuccessfulValidationCount, @false_ParentID_FinalValidationPassed, @false_ParentID_ValidationBehavior, @false_ParentID_RetryStrategy, @false_ParentID_MaxRetriesConfigured, @false_ParentID_FinalValidationError, @false_ParentID_ValidationErrorCount, @false_ParentID_CommonValidationError, @false_ParentID_FirstAttemptAt, @false_ParentID_LastAttemptAt, @false_ParentID_TotalRetryDurationMS, @false_ParentID_ValidationAttempts, @false_ParentID_ValidationSummary, @false_ParentID_FailoverAttempts, @false_ParentID_FailoverErrors, @false_ParentID_FailoverDurations, @false_ParentID_OriginalModelID, @false_ParentID_OriginalRequestStartTime, @false_ParentID_TotalFailoverDuration, @false_ParentID_RerunFromPromptRunID, @false_ParentID_ModelSelection, @false_ParentID_Status, @false_ParentID_Cancelled, @false_ParentID_CancellationReason, @false_ParentID_ModelPowerRank, @false_ParentID_SelectionStrategy, @false_ParentID_CacheHit, @false_ParentID_CacheKey, @false_ParentID_JudgeID, @false_ParentID_JudgeScore, @false_ParentID_WasSelectedResult, @false_ParentID_StreamingEnabled, @false_ParentID_FirstTokenTime, @false_ParentID_ErrorDetails, @false_ParentID_ChildPromptID, @false_ParentID_QueueTime, @false_ParentID_PromptTime, @false_ParentID_CompletionTime, @false_ParentID_ModelSpecificResponseDetails, @false_ParentID_EffortLevel, @false_ParentID_RunName, @false_ParentID_Comments, @false_ParentID_TestRunID

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @false_ParentID_ParentID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateMJAIPromptRun] @ID = @false_ParentIDID, @PromptID = @false_ParentID_PromptID, @ModelID = @false_ParentID_ModelID, @VendorID = @false_ParentID_VendorID, @AgentID = @false_ParentID_AgentID, @ConfigurationID = @false_ParentID_ConfigurationID, @RunAt = @false_ParentID_RunAt, @CompletedAt = @false_ParentID_CompletedAt, @ExecutionTimeMS = @false_ParentID_ExecutionTimeMS, @Messages = @false_ParentID_Messages, @Result = @false_ParentID_Result, @TokensUsed = @false_ParentID_TokensUsed, @TokensPrompt = @false_ParentID_TokensPrompt, @TokensCompletion = @false_ParentID_TokensCompletion, @TotalCost = @false_ParentID_TotalCost, @Success = @false_ParentID_Success, @ErrorMessage = @false_ParentID_ErrorMessage, @ParentID = @false_ParentID_ParentID, @RunType = @false_ParentID_RunType, @ExecutionOrder = @false_ParentID_ExecutionOrder, @AgentRunID = @false_ParentID_AgentRunID, @Cost = @false_ParentID_Cost, @CostCurrency = @false_ParentID_CostCurrency, @TokensUsedRollup = @false_ParentID_TokensUsedRollup, @TokensPromptRollup = @false_ParentID_TokensPromptRollup, @TokensCompletionRollup = @false_ParentID_TokensCompletionRollup, @Temperature = @false_ParentID_Temperature, @TopP = @false_ParentID_TopP, @TopK = @false_ParentID_TopK, @MinP = @false_ParentID_MinP, @FrequencyPenalty = @false_ParentID_FrequencyPenalty, @PresencePenalty = @false_ParentID_PresencePenalty, @Seed = @false_ParentID_Seed, @StopSequences = @false_ParentID_StopSequences, @ResponseFormat = @false_ParentID_ResponseFormat, @LogProbs = @false_ParentID_LogProbs, @TopLogProbs = @false_ParentID_TopLogProbs, @DescendantCost = @false_ParentID_DescendantCost, @ValidationAttemptCount = @false_ParentID_ValidationAttemptCount, @SuccessfulValidationCount = @false_ParentID_SuccessfulValidationCount, @FinalValidationPassed = @false_ParentID_FinalValidationPassed, @ValidationBehavior = @false_ParentID_ValidationBehavior, @RetryStrategy = @false_ParentID_RetryStrategy, @MaxRetriesConfigured = @false_ParentID_MaxRetriesConfigured, @FinalValidationError = @false_ParentID_FinalValidationError, @ValidationErrorCount = @false_ParentID_ValidationErrorCount, @CommonValidationError = @false_ParentID_CommonValidationError, @FirstAttemptAt = @false_ParentID_FirstAttemptAt, @LastAttemptAt = @false_ParentID_LastAttemptAt, @TotalRetryDurationMS = @false_ParentID_TotalRetryDurationMS, @ValidationAttempts = @false_ParentID_ValidationAttempts, @ValidationSummary = @false_ParentID_ValidationSummary, @FailoverAttempts = @false_ParentID_FailoverAttempts, @FailoverErrors = @false_ParentID_FailoverErrors, @FailoverDurations = @false_ParentID_FailoverDurations, @OriginalModelID = @false_ParentID_OriginalModelID, @OriginalRequestStartTime = @false_ParentID_OriginalRequestStartTime, @TotalFailoverDuration = @false_ParentID_TotalFailoverDuration, @RerunFromPromptRunID = @false_ParentID_RerunFromPromptRunID, @ModelSelection = @false_ParentID_ModelSelection, @Status = @false_ParentID_Status, @Cancelled = @false_ParentID_Cancelled, @CancellationReason = @false_ParentID_CancellationReason, @ModelPowerRank = @false_ParentID_ModelPowerRank, @SelectionStrategy = @false_ParentID_SelectionStrategy, @CacheHit = @false_ParentID_CacheHit, @CacheKey = @false_ParentID_CacheKey, @JudgeID = @false_ParentID_JudgeID, @JudgeScore = @false_ParentID_JudgeScore, @WasSelectedResult = @false_ParentID_WasSelectedResult, @StreamingEnabled = @false_ParentID_StreamingEnabled, @FirstTokenTime = @false_ParentID_FirstTokenTime, @ErrorDetails = @false_ParentID_ErrorDetails, @ChildPromptID = @false_ParentID_ChildPromptID, @QueueTime = @false_ParentID_QueueTime, @PromptTime = @false_ParentID_PromptTime, @CompletionTime = @false_ParentID_CompletionTime, @ModelSpecificResponseDetails = @false_ParentID_ModelSpecificResponseDetails, @EffortLevel = @false_ParentID_EffortLevel, @RunName = @false_ParentID_RunName, @Comments = @false_ParentID_Comments, @TestRunID = @false_ParentID_TestRunID

        FETCH NEXT FROM cascade_update_false_ParentID_cursor INTO @false_ParentIDID, @false_ParentID_PromptID, @false_ParentID_ModelID, @false_ParentID_VendorID, @false_ParentID_AgentID, @false_ParentID_ConfigurationID, @false_ParentID_RunAt, @false_ParentID_CompletedAt, @false_ParentID_ExecutionTimeMS, @false_ParentID_Messages, @false_ParentID_Result, @false_ParentID_TokensUsed, @false_ParentID_TokensPrompt, @false_ParentID_TokensCompletion, @false_ParentID_TotalCost, @false_ParentID_Success, @false_ParentID_ErrorMessage, @false_ParentID_ParentID, @false_ParentID_RunType, @false_ParentID_ExecutionOrder, @false_ParentID_AgentRunID, @false_ParentID_Cost, @false_ParentID_CostCurrency, @false_ParentID_TokensUsedRollup, @false_ParentID_TokensPromptRollup, @false_ParentID_TokensCompletionRollup, @false_ParentID_Temperature, @false_ParentID_TopP, @false_ParentID_TopK, @false_ParentID_MinP, @false_ParentID_FrequencyPenalty, @false_ParentID_PresencePenalty, @false_ParentID_Seed, @false_ParentID_StopSequences, @false_ParentID_ResponseFormat, @false_ParentID_LogProbs, @false_ParentID_TopLogProbs, @false_ParentID_DescendantCost, @false_ParentID_ValidationAttemptCount, @false_ParentID_SuccessfulValidationCount, @false_ParentID_FinalValidationPassed, @false_ParentID_ValidationBehavior, @false_ParentID_RetryStrategy, @false_ParentID_MaxRetriesConfigured, @false_ParentID_FinalValidationError, @false_ParentID_ValidationErrorCount, @false_ParentID_CommonValidationError, @false_ParentID_FirstAttemptAt, @false_ParentID_LastAttemptAt, @false_ParentID_TotalRetryDurationMS, @false_ParentID_ValidationAttempts, @false_ParentID_ValidationSummary, @false_ParentID_FailoverAttempts, @false_ParentID_FailoverErrors, @false_ParentID_FailoverDurations, @false_ParentID_OriginalModelID, @false_ParentID_OriginalRequestStartTime, @false_ParentID_TotalFailoverDuration, @false_ParentID_RerunFromPromptRunID, @false_ParentID_ModelSelection, @false_ParentID_Status, @false_ParentID_Cancelled, @false_ParentID_CancellationReason, @false_ParentID_ModelPowerRank, @false_ParentID_SelectionStrategy, @false_ParentID_CacheHit, @false_ParentID_CacheKey, @false_ParentID_JudgeID, @false_ParentID_JudgeScore, @false_ParentID_WasSelectedResult, @false_ParentID_StreamingEnabled, @false_ParentID_FirstTokenTime, @false_ParentID_ErrorDetails, @false_ParentID_ChildPromptID, @false_ParentID_QueueTime, @false_ParentID_PromptTime, @false_ParentID_CompletionTime, @false_ParentID_ModelSpecificResponseDetails, @false_ParentID_EffortLevel, @false_ParentID_RunName, @false_ParentID_Comments, @false_ParentID_TestRunID
    END

    CLOSE cascade_update_false_ParentID_cursor
    DEALLOCATE cascade_update_false_ParentID_cursor
    
    -- Cascade update on AIPromptRun using cursor to call spUpdateMJAIPromptRun
    DECLARE @false_RerunFromPromptRunIDID uniqueidentifier
    DECLARE @false_RerunFromPromptRunID_PromptID uniqueidentifier
    DECLARE @false_RerunFromPromptRunID_ModelID uniqueidentifier
    DECLARE @false_RerunFromPromptRunID_VendorID uniqueidentifier
    DECLARE @false_RerunFromPromptRunID_AgentID uniqueidentifier
    DECLARE @false_RerunFromPromptRunID_ConfigurationID uniqueidentifier
    DECLARE @false_RerunFromPromptRunID_RunAt datetimeoffset
    DECLARE @false_RerunFromPromptRunID_CompletedAt datetimeoffset
    DECLARE @false_RerunFromPromptRunID_ExecutionTimeMS int
    DECLARE @false_RerunFromPromptRunID_Messages nvarchar(MAX)
    DECLARE @false_RerunFromPromptRunID_Result nvarchar(MAX)
    DECLARE @false_RerunFromPromptRunID_TokensUsed int
    DECLARE @false_RerunFromPromptRunID_TokensPrompt int
    DECLARE @false_RerunFromPromptRunID_TokensCompletion int
    DECLARE @false_RerunFromPromptRunID_TotalCost decimal(18, 6)
    DECLARE @false_RerunFromPromptRunID_Success bit
    DECLARE @false_RerunFromPromptRunID_ErrorMessage nvarchar(MAX)
    DECLARE @false_RerunFromPromptRunID_ParentID uniqueidentifier
    DECLARE @false_RerunFromPromptRunID_RunType nvarchar(20)
    DECLARE @false_RerunFromPromptRunID_ExecutionOrder int
    DECLARE @false_RerunFromPromptRunID_AgentRunID uniqueidentifier
    DECLARE @false_RerunFromPromptRunID_Cost decimal(19, 8)
    DECLARE @false_RerunFromPromptRunID_CostCurrency nvarchar(10)
    DECLARE @false_RerunFromPromptRunID_TokensUsedRollup int
    DECLARE @false_RerunFromPromptRunID_TokensPromptRollup int
    DECLARE @false_RerunFromPromptRunID_TokensCompletionRollup int
    DECLARE @false_RerunFromPromptRunID_Temperature decimal(3, 2)
    DECLARE @false_RerunFromPromptRunID_TopP decimal(3, 2)
    DECLARE @false_RerunFromPromptRunID_TopK int
    DECLARE @false_RerunFromPromptRunID_MinP decimal(3, 2)
    DECLARE @false_RerunFromPromptRunID_FrequencyPenalty decimal(3, 2)
    DECLARE @false_RerunFromPromptRunID_PresencePenalty decimal(3, 2)
    DECLARE @false_RerunFromPromptRunID_Seed int
    DECLARE @false_RerunFromPromptRunID_StopSequences nvarchar(MAX)
    DECLARE @false_RerunFromPromptRunID_ResponseFormat nvarchar(50)
    DECLARE @false_RerunFromPromptRunID_LogProbs bit
    DECLARE @false_RerunFromPromptRunID_TopLogProbs int
    DECLARE @false_RerunFromPromptRunID_DescendantCost decimal(18, 6)
    DECLARE @false_RerunFromPromptRunID_ValidationAttemptCount int
    DECLARE @false_RerunFromPromptRunID_SuccessfulValidationCount int
    DECLARE @false_RerunFromPromptRunID_FinalValidationPassed bit
    DECLARE @false_RerunFromPromptRunID_ValidationBehavior nvarchar(50)
    DECLARE @false_RerunFromPromptRunID_RetryStrategy nvarchar(50)
    DECLARE @false_RerunFromPromptRunID_MaxRetriesConfigured int
    DECLARE @false_RerunFromPromptRunID_FinalValidationError nvarchar(500)
    DECLARE @false_RerunFromPromptRunID_ValidationErrorCount int
    DECLARE @false_RerunFromPromptRunID_CommonValidationError nvarchar(255)
    DECLARE @false_RerunFromPromptRunID_FirstAttemptAt datetimeoffset
    DECLARE @false_RerunFromPromptRunID_LastAttemptAt datetimeoffset
    DECLARE @false_RerunFromPromptRunID_TotalRetryDurationMS int
    DECLARE @false_RerunFromPromptRunID_ValidationAttempts nvarchar(MAX)
    DECLARE @false_RerunFromPromptRunID_ValidationSummary nvarchar(MAX)
    DECLARE @false_RerunFromPromptRunID_FailoverAttempts int
    DECLARE @false_RerunFromPromptRunID_FailoverErrors nvarchar(MAX)
    DECLARE @false_RerunFromPromptRunID_FailoverDurations nvarchar(MAX)
    DECLARE @false_RerunFromPromptRunID_OriginalModelID uniqueidentifier
    DECLARE @false_RerunFromPromptRunID_OriginalRequestStartTime datetimeoffset
    DECLARE @false_RerunFromPromptRunID_TotalFailoverDuration int
    DECLARE @false_RerunFromPromptRunID_RerunFromPromptRunID uniqueidentifier
    DECLARE @false_RerunFromPromptRunID_ModelSelection nvarchar(MAX)
    DECLARE @false_RerunFromPromptRunID_Status nvarchar(50)
    DECLARE @false_RerunFromPromptRunID_Cancelled bit
    DECLARE @false_RerunFromPromptRunID_CancellationReason nvarchar(MAX)
    DECLARE @false_RerunFromPromptRunID_ModelPowerRank int
    DECLARE @false_RerunFromPromptRunID_SelectionStrategy nvarchar(50)
    DECLARE @false_RerunFromPromptRunID_CacheHit bit
    DECLARE @false_RerunFromPromptRunID_CacheKey nvarchar(500)
    DECLARE @false_RerunFromPromptRunID_JudgeID uniqueidentifier
    DECLARE @false_RerunFromPromptRunID_JudgeScore float(53)
    DECLARE @false_RerunFromPromptRunID_WasSelectedResult bit
    DECLARE @false_RerunFromPromptRunID_StreamingEnabled bit
    DECLARE @false_RerunFromPromptRunID_FirstTokenTime int
    DECLARE @false_RerunFromPromptRunID_ErrorDetails nvarchar(MAX)
    DECLARE @false_RerunFromPromptRunID_ChildPromptID uniqueidentifier
    DECLARE @false_RerunFromPromptRunID_QueueTime int
    DECLARE @false_RerunFromPromptRunID_PromptTime int
    DECLARE @false_RerunFromPromptRunID_CompletionTime int
    DECLARE @false_RerunFromPromptRunID_ModelSpecificResponseDetails nvarchar(MAX)
    DECLARE @false_RerunFromPromptRunID_EffortLevel int
    DECLARE @false_RerunFromPromptRunID_RunName nvarchar(255)
    DECLARE @false_RerunFromPromptRunID_Comments nvarchar(MAX)
    DECLARE @false_RerunFromPromptRunID_TestRunID uniqueidentifier
    DECLARE cascade_update_false_RerunFromPromptRunID_cursor CURSOR FOR
        SELECT [ID], [PromptID], [ModelID], [VendorID], [AgentID], [ConfigurationID], [RunAt], [CompletedAt], [ExecutionTimeMS], [Messages], [Result], [TokensUsed], [TokensPrompt], [TokensCompletion], [TotalCost], [Success], [ErrorMessage], [ParentID], [RunType], [ExecutionOrder], [AgentRunID], [Cost], [CostCurrency], [TokensUsedRollup], [TokensPromptRollup], [TokensCompletionRollup], [Temperature], [TopP], [TopK], [MinP], [FrequencyPenalty], [PresencePenalty], [Seed], [StopSequences], [ResponseFormat], [LogProbs], [TopLogProbs], [DescendantCost], [ValidationAttemptCount], [SuccessfulValidationCount], [FinalValidationPassed], [ValidationBehavior], [RetryStrategy], [MaxRetriesConfigured], [FinalValidationError], [ValidationErrorCount], [CommonValidationError], [FirstAttemptAt], [LastAttemptAt], [TotalRetryDurationMS], [ValidationAttempts], [ValidationSummary], [FailoverAttempts], [FailoverErrors], [FailoverDurations], [OriginalModelID], [OriginalRequestStartTime], [TotalFailoverDuration], [RerunFromPromptRunID], [ModelSelection], [Status], [Cancelled], [CancellationReason], [ModelPowerRank], [SelectionStrategy], [CacheHit], [CacheKey], [JudgeID], [JudgeScore], [WasSelectedResult], [StreamingEnabled], [FirstTokenTime], [ErrorDetails], [ChildPromptID], [QueueTime], [PromptTime], [CompletionTime], [ModelSpecificResponseDetails], [EffortLevel], [RunName], [Comments], [TestRunID]
        FROM [${flyway:defaultSchema}].[AIPromptRun]
        WHERE [RerunFromPromptRunID] = @ID

    OPEN cascade_update_false_RerunFromPromptRunID_cursor
    FETCH NEXT FROM cascade_update_false_RerunFromPromptRunID_cursor INTO @false_RerunFromPromptRunIDID, @false_RerunFromPromptRunID_PromptID, @false_RerunFromPromptRunID_ModelID, @false_RerunFromPromptRunID_VendorID, @false_RerunFromPromptRunID_AgentID, @false_RerunFromPromptRunID_ConfigurationID, @false_RerunFromPromptRunID_RunAt, @false_RerunFromPromptRunID_CompletedAt, @false_RerunFromPromptRunID_ExecutionTimeMS, @false_RerunFromPromptRunID_Messages, @false_RerunFromPromptRunID_Result, @false_RerunFromPromptRunID_TokensUsed, @false_RerunFromPromptRunID_TokensPrompt, @false_RerunFromPromptRunID_TokensCompletion, @false_RerunFromPromptRunID_TotalCost, @false_RerunFromPromptRunID_Success, @false_RerunFromPromptRunID_ErrorMessage, @false_RerunFromPromptRunID_ParentID, @false_RerunFromPromptRunID_RunType, @false_RerunFromPromptRunID_ExecutionOrder, @false_RerunFromPromptRunID_AgentRunID, @false_RerunFromPromptRunID_Cost, @false_RerunFromPromptRunID_CostCurrency, @false_RerunFromPromptRunID_TokensUsedRollup, @false_RerunFromPromptRunID_TokensPromptRollup, @false_RerunFromPromptRunID_TokensCompletionRollup, @false_RerunFromPromptRunID_Temperature, @false_RerunFromPromptRunID_TopP, @false_RerunFromPromptRunID_TopK, @false_RerunFromPromptRunID_MinP, @false_RerunFromPromptRunID_FrequencyPenalty, @false_RerunFromPromptRunID_PresencePenalty, @false_RerunFromPromptRunID_Seed, @false_RerunFromPromptRunID_StopSequences, @false_RerunFromPromptRunID_ResponseFormat, @false_RerunFromPromptRunID_LogProbs, @false_RerunFromPromptRunID_TopLogProbs, @false_RerunFromPromptRunID_DescendantCost, @false_RerunFromPromptRunID_ValidationAttemptCount, @false_RerunFromPromptRunID_SuccessfulValidationCount, @false_RerunFromPromptRunID_FinalValidationPassed, @false_RerunFromPromptRunID_ValidationBehavior, @false_RerunFromPromptRunID_RetryStrategy, @false_RerunFromPromptRunID_MaxRetriesConfigured, @false_RerunFromPromptRunID_FinalValidationError, @false_RerunFromPromptRunID_ValidationErrorCount, @false_RerunFromPromptRunID_CommonValidationError, @false_RerunFromPromptRunID_FirstAttemptAt, @false_RerunFromPromptRunID_LastAttemptAt, @false_RerunFromPromptRunID_TotalRetryDurationMS, @false_RerunFromPromptRunID_ValidationAttempts, @false_RerunFromPromptRunID_ValidationSummary, @false_RerunFromPromptRunID_FailoverAttempts, @false_RerunFromPromptRunID_FailoverErrors, @false_RerunFromPromptRunID_FailoverDurations, @false_RerunFromPromptRunID_OriginalModelID, @false_RerunFromPromptRunID_OriginalRequestStartTime, @false_RerunFromPromptRunID_TotalFailoverDuration, @false_RerunFromPromptRunID_RerunFromPromptRunID, @false_RerunFromPromptRunID_ModelSelection, @false_RerunFromPromptRunID_Status, @false_RerunFromPromptRunID_Cancelled, @false_RerunFromPromptRunID_CancellationReason, @false_RerunFromPromptRunID_ModelPowerRank, @false_RerunFromPromptRunID_SelectionStrategy, @false_RerunFromPromptRunID_CacheHit, @false_RerunFromPromptRunID_CacheKey, @false_RerunFromPromptRunID_JudgeID, @false_RerunFromPromptRunID_JudgeScore, @false_RerunFromPromptRunID_WasSelectedResult, @false_RerunFromPromptRunID_StreamingEnabled, @false_RerunFromPromptRunID_FirstTokenTime, @false_RerunFromPromptRunID_ErrorDetails, @false_RerunFromPromptRunID_ChildPromptID, @false_RerunFromPromptRunID_QueueTime, @false_RerunFromPromptRunID_PromptTime, @false_RerunFromPromptRunID_CompletionTime, @false_RerunFromPromptRunID_ModelSpecificResponseDetails, @false_RerunFromPromptRunID_EffortLevel, @false_RerunFromPromptRunID_RunName, @false_RerunFromPromptRunID_Comments, @false_RerunFromPromptRunID_TestRunID

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @false_RerunFromPromptRunID_RerunFromPromptRunID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateMJAIPromptRun] @ID = @false_RerunFromPromptRunIDID, @PromptID = @false_RerunFromPromptRunID_PromptID, @ModelID = @false_RerunFromPromptRunID_ModelID, @VendorID = @false_RerunFromPromptRunID_VendorID, @AgentID = @false_RerunFromPromptRunID_AgentID, @ConfigurationID = @false_RerunFromPromptRunID_ConfigurationID, @RunAt = @false_RerunFromPromptRunID_RunAt, @CompletedAt = @false_RerunFromPromptRunID_CompletedAt, @ExecutionTimeMS = @false_RerunFromPromptRunID_ExecutionTimeMS, @Messages = @false_RerunFromPromptRunID_Messages, @Result = @false_RerunFromPromptRunID_Result, @TokensUsed = @false_RerunFromPromptRunID_TokensUsed, @TokensPrompt = @false_RerunFromPromptRunID_TokensPrompt, @TokensCompletion = @false_RerunFromPromptRunID_TokensCompletion, @TotalCost = @false_RerunFromPromptRunID_TotalCost, @Success = @false_RerunFromPromptRunID_Success, @ErrorMessage = @false_RerunFromPromptRunID_ErrorMessage, @ParentID = @false_RerunFromPromptRunID_ParentID, @RunType = @false_RerunFromPromptRunID_RunType, @ExecutionOrder = @false_RerunFromPromptRunID_ExecutionOrder, @AgentRunID = @false_RerunFromPromptRunID_AgentRunID, @Cost = @false_RerunFromPromptRunID_Cost, @CostCurrency = @false_RerunFromPromptRunID_CostCurrency, @TokensUsedRollup = @false_RerunFromPromptRunID_TokensUsedRollup, @TokensPromptRollup = @false_RerunFromPromptRunID_TokensPromptRollup, @TokensCompletionRollup = @false_RerunFromPromptRunID_TokensCompletionRollup, @Temperature = @false_RerunFromPromptRunID_Temperature, @TopP = @false_RerunFromPromptRunID_TopP, @TopK = @false_RerunFromPromptRunID_TopK, @MinP = @false_RerunFromPromptRunID_MinP, @FrequencyPenalty = @false_RerunFromPromptRunID_FrequencyPenalty, @PresencePenalty = @false_RerunFromPromptRunID_PresencePenalty, @Seed = @false_RerunFromPromptRunID_Seed, @StopSequences = @false_RerunFromPromptRunID_StopSequences, @ResponseFormat = @false_RerunFromPromptRunID_ResponseFormat, @LogProbs = @false_RerunFromPromptRunID_LogProbs, @TopLogProbs = @false_RerunFromPromptRunID_TopLogProbs, @DescendantCost = @false_RerunFromPromptRunID_DescendantCost, @ValidationAttemptCount = @false_RerunFromPromptRunID_ValidationAttemptCount, @SuccessfulValidationCount = @false_RerunFromPromptRunID_SuccessfulValidationCount, @FinalValidationPassed = @false_RerunFromPromptRunID_FinalValidationPassed, @ValidationBehavior = @false_RerunFromPromptRunID_ValidationBehavior, @RetryStrategy = @false_RerunFromPromptRunID_RetryStrategy, @MaxRetriesConfigured = @false_RerunFromPromptRunID_MaxRetriesConfigured, @FinalValidationError = @false_RerunFromPromptRunID_FinalValidationError, @ValidationErrorCount = @false_RerunFromPromptRunID_ValidationErrorCount, @CommonValidationError = @false_RerunFromPromptRunID_CommonValidationError, @FirstAttemptAt = @false_RerunFromPromptRunID_FirstAttemptAt, @LastAttemptAt = @false_RerunFromPromptRunID_LastAttemptAt, @TotalRetryDurationMS = @false_RerunFromPromptRunID_TotalRetryDurationMS, @ValidationAttempts = @false_RerunFromPromptRunID_ValidationAttempts, @ValidationSummary = @false_RerunFromPromptRunID_ValidationSummary, @FailoverAttempts = @false_RerunFromPromptRunID_FailoverAttempts, @FailoverErrors = @false_RerunFromPromptRunID_FailoverErrors, @FailoverDurations = @false_RerunFromPromptRunID_FailoverDurations, @OriginalModelID = @false_RerunFromPromptRunID_OriginalModelID, @OriginalRequestStartTime = @false_RerunFromPromptRunID_OriginalRequestStartTime, @TotalFailoverDuration = @false_RerunFromPromptRunID_TotalFailoverDuration, @RerunFromPromptRunID = @false_RerunFromPromptRunID_RerunFromPromptRunID, @ModelSelection = @false_RerunFromPromptRunID_ModelSelection, @Status = @false_RerunFromPromptRunID_Status, @Cancelled = @false_RerunFromPromptRunID_Cancelled, @CancellationReason = @false_RerunFromPromptRunID_CancellationReason, @ModelPowerRank = @false_RerunFromPromptRunID_ModelPowerRank, @SelectionStrategy = @false_RerunFromPromptRunID_SelectionStrategy, @CacheHit = @false_RerunFromPromptRunID_CacheHit, @CacheKey = @false_RerunFromPromptRunID_CacheKey, @JudgeID = @false_RerunFromPromptRunID_JudgeID, @JudgeScore = @false_RerunFromPromptRunID_JudgeScore, @WasSelectedResult = @false_RerunFromPromptRunID_WasSelectedResult, @StreamingEnabled = @false_RerunFromPromptRunID_StreamingEnabled, @FirstTokenTime = @false_RerunFromPromptRunID_FirstTokenTime, @ErrorDetails = @false_RerunFromPromptRunID_ErrorDetails, @ChildPromptID = @false_RerunFromPromptRunID_ChildPromptID, @QueueTime = @false_RerunFromPromptRunID_QueueTime, @PromptTime = @false_RerunFromPromptRunID_PromptTime, @CompletionTime = @false_RerunFromPromptRunID_CompletionTime, @ModelSpecificResponseDetails = @false_RerunFromPromptRunID_ModelSpecificResponseDetails, @EffortLevel = @false_RerunFromPromptRunID_EffortLevel, @RunName = @false_RerunFromPromptRunID_RunName, @Comments = @false_RerunFromPromptRunID_Comments, @TestRunID = @false_RerunFromPromptRunID_TestRunID

        FETCH NEXT FROM cascade_update_false_RerunFromPromptRunID_cursor INTO @false_RerunFromPromptRunIDID, @false_RerunFromPromptRunID_PromptID, @false_RerunFromPromptRunID_ModelID, @false_RerunFromPromptRunID_VendorID, @false_RerunFromPromptRunID_AgentID, @false_RerunFromPromptRunID_ConfigurationID, @false_RerunFromPromptRunID_RunAt, @false_RerunFromPromptRunID_CompletedAt, @false_RerunFromPromptRunID_ExecutionTimeMS, @false_RerunFromPromptRunID_Messages, @false_RerunFromPromptRunID_Result, @false_RerunFromPromptRunID_TokensUsed, @false_RerunFromPromptRunID_TokensPrompt, @false_RerunFromPromptRunID_TokensCompletion, @false_RerunFromPromptRunID_TotalCost, @false_RerunFromPromptRunID_Success, @false_RerunFromPromptRunID_ErrorMessage, @false_RerunFromPromptRunID_ParentID, @false_RerunFromPromptRunID_RunType, @false_RerunFromPromptRunID_ExecutionOrder, @false_RerunFromPromptRunID_AgentRunID, @false_RerunFromPromptRunID_Cost, @false_RerunFromPromptRunID_CostCurrency, @false_RerunFromPromptRunID_TokensUsedRollup, @false_RerunFromPromptRunID_TokensPromptRollup, @false_RerunFromPromptRunID_TokensCompletionRollup, @false_RerunFromPromptRunID_Temperature, @false_RerunFromPromptRunID_TopP, @false_RerunFromPromptRunID_TopK, @false_RerunFromPromptRunID_MinP, @false_RerunFromPromptRunID_FrequencyPenalty, @false_RerunFromPromptRunID_PresencePenalty, @false_RerunFromPromptRunID_Seed, @false_RerunFromPromptRunID_StopSequences, @false_RerunFromPromptRunID_ResponseFormat, @false_RerunFromPromptRunID_LogProbs, @false_RerunFromPromptRunID_TopLogProbs, @false_RerunFromPromptRunID_DescendantCost, @false_RerunFromPromptRunID_ValidationAttemptCount, @false_RerunFromPromptRunID_SuccessfulValidationCount, @false_RerunFromPromptRunID_FinalValidationPassed, @false_RerunFromPromptRunID_ValidationBehavior, @false_RerunFromPromptRunID_RetryStrategy, @false_RerunFromPromptRunID_MaxRetriesConfigured, @false_RerunFromPromptRunID_FinalValidationError, @false_RerunFromPromptRunID_ValidationErrorCount, @false_RerunFromPromptRunID_CommonValidationError, @false_RerunFromPromptRunID_FirstAttemptAt, @false_RerunFromPromptRunID_LastAttemptAt, @false_RerunFromPromptRunID_TotalRetryDurationMS, @false_RerunFromPromptRunID_ValidationAttempts, @false_RerunFromPromptRunID_ValidationSummary, @false_RerunFromPromptRunID_FailoverAttempts, @false_RerunFromPromptRunID_FailoverErrors, @false_RerunFromPromptRunID_FailoverDurations, @false_RerunFromPromptRunID_OriginalModelID, @false_RerunFromPromptRunID_OriginalRequestStartTime, @false_RerunFromPromptRunID_TotalFailoverDuration, @false_RerunFromPromptRunID_RerunFromPromptRunID, @false_RerunFromPromptRunID_ModelSelection, @false_RerunFromPromptRunID_Status, @false_RerunFromPromptRunID_Cancelled, @false_RerunFromPromptRunID_CancellationReason, @false_RerunFromPromptRunID_ModelPowerRank, @false_RerunFromPromptRunID_SelectionStrategy, @false_RerunFromPromptRunID_CacheHit, @false_RerunFromPromptRunID_CacheKey, @false_RerunFromPromptRunID_JudgeID, @false_RerunFromPromptRunID_JudgeScore, @false_RerunFromPromptRunID_WasSelectedResult, @false_RerunFromPromptRunID_StreamingEnabled, @false_RerunFromPromptRunID_FirstTokenTime, @false_RerunFromPromptRunID_ErrorDetails, @false_RerunFromPromptRunID_ChildPromptID, @false_RerunFromPromptRunID_QueueTime, @false_RerunFromPromptRunID_PromptTime, @false_RerunFromPromptRunID_CompletionTime, @false_RerunFromPromptRunID_ModelSpecificResponseDetails, @false_RerunFromPromptRunID_EffortLevel, @false_RerunFromPromptRunID_RunName, @false_RerunFromPromptRunID_Comments, @false_RerunFromPromptRunID_TestRunID
    END

    CLOSE cascade_update_false_RerunFromPromptRunID_cursor
    DEALLOCATE cascade_update_false_RerunFromPromptRunID_cursor
    
    -- Cascade update on AIResultCache using cursor to call spUpdateMJAIResultCache
    DECLARE @false_PromptRunIDID uniqueidentifier
    DECLARE @false_PromptRunID_AIPromptID uniqueidentifier
    DECLARE @false_PromptRunID_AIModelID uniqueidentifier
    DECLARE @false_PromptRunID_RunAt datetimeoffset
    DECLARE @false_PromptRunID_PromptText nvarchar(MAX)
    DECLARE @false_PromptRunID_ResultText nvarchar(MAX)
    DECLARE @false_PromptRunID_Status nvarchar(50)
    DECLARE @false_PromptRunID_ExpiredOn datetimeoffset
    DECLARE @false_PromptRunID_VendorID uniqueidentifier
    DECLARE @false_PromptRunID_AgentID uniqueidentifier
    DECLARE @false_PromptRunID_ConfigurationID uniqueidentifier
    DECLARE @false_PromptRunID_PromptEmbedding varbinary
    DECLARE @false_PromptRunID_PromptRunID uniqueidentifier
    DECLARE cascade_update_false_PromptRunID_cursor CURSOR FOR
        SELECT [ID], [AIPromptID], [AIModelID], [RunAt], [PromptText], [ResultText], [Status], [ExpiredOn], [VendorID], [AgentID], [ConfigurationID], [PromptEmbedding], [PromptRunID]
        FROM [${flyway:defaultSchema}].[AIResultCache]
        WHERE [PromptRunID] = @ID

    OPEN cascade_update_false_PromptRunID_cursor
    FETCH NEXT FROM cascade_update_false_PromptRunID_cursor INTO @false_PromptRunIDID, @false_PromptRunID_AIPromptID, @false_PromptRunID_AIModelID, @false_PromptRunID_RunAt, @false_PromptRunID_PromptText, @false_PromptRunID_ResultText, @false_PromptRunID_Status, @false_PromptRunID_ExpiredOn, @false_PromptRunID_VendorID, @false_PromptRunID_AgentID, @false_PromptRunID_ConfigurationID, @false_PromptRunID_PromptEmbedding, @false_PromptRunID_PromptRunID

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @false_PromptRunID_PromptRunID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateMJAIResultCache] @ID = @false_PromptRunIDID, @AIPromptID = @false_PromptRunID_AIPromptID, @AIModelID = @false_PromptRunID_AIModelID, @RunAt = @false_PromptRunID_RunAt, @PromptText = @false_PromptRunID_PromptText, @ResultText = @false_PromptRunID_ResultText, @Status = @false_PromptRunID_Status, @ExpiredOn = @false_PromptRunID_ExpiredOn, @VendorID = @false_PromptRunID_VendorID, @AgentID = @false_PromptRunID_AgentID, @ConfigurationID = @false_PromptRunID_ConfigurationID, @PromptEmbedding = @false_PromptRunID_PromptEmbedding, @PromptRunID = @false_PromptRunID_PromptRunID

        FETCH NEXT FROM cascade_update_false_PromptRunID_cursor INTO @false_PromptRunIDID, @false_PromptRunID_AIPromptID, @false_PromptRunID_AIModelID, @false_PromptRunID_RunAt, @false_PromptRunID_PromptText, @false_PromptRunID_ResultText, @false_PromptRunID_Status, @false_PromptRunID_ExpiredOn, @false_PromptRunID_VendorID, @false_PromptRunID_AgentID, @false_PromptRunID_ConfigurationID, @false_PromptRunID_PromptEmbedding, @false_PromptRunID_PromptRunID
    END

    CLOSE cascade_update_false_PromptRunID_cursor
    DEALLOCATE cascade_update_false_PromptRunID_cursor
    

    DELETE FROM
        [${flyway:defaultSchema}].[AIPromptRun]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIPromptRun] TO [cdp_Developer], [cdp_Integration]
    

/* spDelete Permissions for MJ: AI Prompt Runs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIPromptRun] TO [cdp_Developer], [cdp_Integration]



/* Base View SQL for MJ: AI Vendor Type Definitions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Vendor Type Definitions
-- Item: vwAIVendorTypeDefinitions
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: AI Vendor Type Definitions
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  AIVendorTypeDefinition
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwAIVendorTypeDefinitions]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwAIVendorTypeDefinitions];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwAIVendorTypeDefinitions]
AS
SELECT
    m.*
FROM
    [${flyway:defaultSchema}].[AIVendorTypeDefinition] AS m
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwAIVendorTypeDefinitions] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: AI Vendor Type Definitions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Vendor Type Definitions
-- Item: Permissions for vwAIVendorTypeDefinitions
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwAIVendorTypeDefinitions] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: AI Vendor Type Definitions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Vendor Type Definitions
-- Item: spCreateMJAIVendorTypeDefinition
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR AIVendorTypeDefinition
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJAIVendorTypeDefinition]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIVendorTypeDefinition];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIVendorTypeDefinition]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(50),
    @Description nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @ActualID UNIQUEIDENTIFIER = ISNULL(@ID, NEWID())
    INSERT INTO
    [${flyway:defaultSchema}].[AIVendorTypeDefinition]
        (
            [Name],
                [Description],
                [ID]
        )
    VALUES
        (
            @Name,
                @Description,
                @ActualID
        )
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwAIVendorTypeDefinitions] WHERE [ID] = @ActualID
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIVendorTypeDefinition] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: AI Vendor Type Definitions */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIVendorTypeDefinition] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: AI Vendor Type Definitions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Vendor Type Definitions
-- Item: spUpdateMJAIVendorTypeDefinition
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR AIVendorTypeDefinition
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJAIVendorTypeDefinition]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIVendorTypeDefinition];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIVendorTypeDefinition]
    @ID uniqueidentifier,
    @Name nvarchar(50),
    @Description nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIVendorTypeDefinition]
    SET
        [Name] = @Name,
        [Description] = @Description
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwAIVendorTypeDefinitions] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwAIVendorTypeDefinitions]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIVendorTypeDefinition] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the AIVendorTypeDefinition table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJAIVendorTypeDefinition]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJAIVendorTypeDefinition];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJAIVendorTypeDefinition
ON [${flyway:defaultSchema}].[AIVendorTypeDefinition]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIVendorTypeDefinition]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[AIVendorTypeDefinition] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: AI Vendor Type Definitions */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIVendorTypeDefinition] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: AI Vendor Type Definitions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Vendor Type Definitions
-- Item: spDeleteMJAIVendorTypeDefinition
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR AIVendorTypeDefinition
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJAIVendorTypeDefinition]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIVendorTypeDefinition];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIVendorTypeDefinition]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[AIVendorTypeDefinition]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIVendorTypeDefinition] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: AI Vendor Type Definitions */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIVendorTypeDefinition] TO [cdp_Integration]



/* Base View SQL for MJ: AI Prompts */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Prompts
-- Item: vwAIPrompts
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: AI Prompts
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  AIPrompt
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwAIPrompts]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwAIPrompts];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwAIPrompts]
AS
SELECT
    m.*,
    MJTemplates_TemplateID.[Name] AS [Template],
    MJAIPromptCategories_CategoryID.[Name] AS [Category],
    MJAIPromptTypes_TypeID.[Name] AS [Type],
    MJAIModelTypes_AIModelTypeID.[Name] AS [AIModelType],
    MJAIPrompts_ResultSelectorPromptID.[Name] AS [ResultSelectorPrompt],
    root_ResultSelectorPromptID.RootID AS [RootResultSelectorPromptID]
FROM
    [${flyway:defaultSchema}].[AIPrompt] AS m
INNER JOIN
    [${flyway:defaultSchema}].[Template] AS MJTemplates_TemplateID
  ON
    [m].[TemplateID] = MJTemplates_TemplateID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[AIPromptCategory] AS MJAIPromptCategories_CategoryID
  ON
    [m].[CategoryID] = MJAIPromptCategories_CategoryID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[AIPromptType] AS MJAIPromptTypes_TypeID
  ON
    [m].[TypeID] = MJAIPromptTypes_TypeID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[AIModelType] AS MJAIModelTypes_AIModelTypeID
  ON
    [m].[AIModelTypeID] = MJAIModelTypes_AIModelTypeID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[AIPrompt] AS MJAIPrompts_ResultSelectorPromptID
  ON
    [m].[ResultSelectorPromptID] = MJAIPrompts_ResultSelectorPromptID.[ID]
OUTER APPLY
    [${flyway:defaultSchema}].[fnAIPromptResultSelectorPromptID_GetRootID]([m].[ID], [m].[ResultSelectorPromptID]) AS root_ResultSelectorPromptID
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwAIPrompts] TO [cdp_UI], [cdp_Integration], [cdp_UI], [cdp_Developer]
    

/* Base View Permissions SQL for MJ: AI Prompts */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Prompts
-- Item: Permissions for vwAIPrompts
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwAIPrompts] TO [cdp_UI], [cdp_Integration], [cdp_UI], [cdp_Developer]

/* spCreate SQL for MJ: AI Prompts */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Prompts
-- Item: spCreateMJAIPrompt
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR AIPrompt
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJAIPrompt]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIPrompt];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIPrompt]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @TemplateID uniqueidentifier,
    @CategoryID uniqueidentifier,
    @TypeID uniqueidentifier,
    @Status nvarchar(50),
    @ResponseFormat nvarchar(20) = NULL,
    @ModelSpecificResponseFormat nvarchar(MAX),
    @AIModelTypeID uniqueidentifier,
    @MinPowerRank int,
    @SelectionStrategy nvarchar(20) = NULL,
    @PowerPreference nvarchar(20) = NULL,
    @ParallelizationMode nvarchar(20) = NULL,
    @ParallelCount int,
    @ParallelConfigParam nvarchar(100),
    @OutputType nvarchar(50) = NULL,
    @OutputExample nvarchar(MAX),
    @ValidationBehavior nvarchar(50) = NULL,
    @MaxRetries int = NULL,
    @RetryDelayMS int = NULL,
    @RetryStrategy nvarchar(20) = NULL,
    @ResultSelectorPromptID uniqueidentifier,
    @EnableCaching bit = NULL,
    @CacheTTLSeconds int,
    @CacheMatchType nvarchar(20) = NULL,
    @CacheSimilarityThreshold float(53),
    @CacheMustMatchModel bit = NULL,
    @CacheMustMatchVendor bit = NULL,
    @CacheMustMatchAgent bit = NULL,
    @CacheMustMatchConfig bit = NULL,
    @PromptRole nvarchar(20) = NULL,
    @PromptPosition nvarchar(20) = NULL,
    @Temperature decimal(3, 2),
    @TopP decimal(3, 2),
    @TopK int,
    @MinP decimal(3, 2),
    @FrequencyPenalty decimal(3, 2),
    @PresencePenalty decimal(3, 2),
    @Seed int,
    @StopSequences nvarchar(1000),
    @IncludeLogProbs bit,
    @TopLogProbs int,
    @FailoverStrategy nvarchar(50) = NULL,
    @FailoverMaxAttempts int,
    @FailoverDelaySeconds int,
    @FailoverModelStrategy nvarchar(50) = NULL,
    @FailoverErrorScope nvarchar(50) = NULL,
    @EffortLevel int
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[AIPrompt]
            (
                [ID],
                [Name],
                [Description],
                [TemplateID],
                [CategoryID],
                [TypeID],
                [Status],
                [ResponseFormat],
                [ModelSpecificResponseFormat],
                [AIModelTypeID],
                [MinPowerRank],
                [SelectionStrategy],
                [PowerPreference],
                [ParallelizationMode],
                [ParallelCount],
                [ParallelConfigParam],
                [OutputType],
                [OutputExample],
                [ValidationBehavior],
                [MaxRetries],
                [RetryDelayMS],
                [RetryStrategy],
                [ResultSelectorPromptID],
                [EnableCaching],
                [CacheTTLSeconds],
                [CacheMatchType],
                [CacheSimilarityThreshold],
                [CacheMustMatchModel],
                [CacheMustMatchVendor],
                [CacheMustMatchAgent],
                [CacheMustMatchConfig],
                [PromptRole],
                [PromptPosition],
                [Temperature],
                [TopP],
                [TopK],
                [MinP],
                [FrequencyPenalty],
                [PresencePenalty],
                [Seed],
                [StopSequences],
                [IncludeLogProbs],
                [TopLogProbs],
                [FailoverStrategy],
                [FailoverMaxAttempts],
                [FailoverDelaySeconds],
                [FailoverModelStrategy],
                [FailoverErrorScope],
                [EffortLevel]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description,
                @TemplateID,
                @CategoryID,
                @TypeID,
                @Status,
                ISNULL(@ResponseFormat, 'Any'),
                @ModelSpecificResponseFormat,
                @AIModelTypeID,
                @MinPowerRank,
                ISNULL(@SelectionStrategy, 'Default'),
                ISNULL(@PowerPreference, 'Highest'),
                ISNULL(@ParallelizationMode, 'None'),
                @ParallelCount,
                @ParallelConfigParam,
                ISNULL(@OutputType, 'string'),
                @OutputExample,
                ISNULL(@ValidationBehavior, 'Warn'),
                ISNULL(@MaxRetries, 0),
                ISNULL(@RetryDelayMS, 0),
                ISNULL(@RetryStrategy, 'Fixed'),
                @ResultSelectorPromptID,
                ISNULL(@EnableCaching, 0),
                @CacheTTLSeconds,
                ISNULL(@CacheMatchType, 'Exact'),
                @CacheSimilarityThreshold,
                ISNULL(@CacheMustMatchModel, 1),
                ISNULL(@CacheMustMatchVendor, 1),
                ISNULL(@CacheMustMatchAgent, 0),
                ISNULL(@CacheMustMatchConfig, 0),
                ISNULL(@PromptRole, 'System'),
                ISNULL(@PromptPosition, 'First'),
                @Temperature,
                @TopP,
                @TopK,
                @MinP,
                @FrequencyPenalty,
                @PresencePenalty,
                @Seed,
                @StopSequences,
                @IncludeLogProbs,
                @TopLogProbs,
                ISNULL(@FailoverStrategy, 'SameModelDifferentVendor'),
                @FailoverMaxAttempts,
                @FailoverDelaySeconds,
                ISNULL(@FailoverModelStrategy, 'PreferSameModel'),
                ISNULL(@FailoverErrorScope, 'All'),
                @EffortLevel
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[AIPrompt]
            (
                [Name],
                [Description],
                [TemplateID],
                [CategoryID],
                [TypeID],
                [Status],
                [ResponseFormat],
                [ModelSpecificResponseFormat],
                [AIModelTypeID],
                [MinPowerRank],
                [SelectionStrategy],
                [PowerPreference],
                [ParallelizationMode],
                [ParallelCount],
                [ParallelConfigParam],
                [OutputType],
                [OutputExample],
                [ValidationBehavior],
                [MaxRetries],
                [RetryDelayMS],
                [RetryStrategy],
                [ResultSelectorPromptID],
                [EnableCaching],
                [CacheTTLSeconds],
                [CacheMatchType],
                [CacheSimilarityThreshold],
                [CacheMustMatchModel],
                [CacheMustMatchVendor],
                [CacheMustMatchAgent],
                [CacheMustMatchConfig],
                [PromptRole],
                [PromptPosition],
                [Temperature],
                [TopP],
                [TopK],
                [MinP],
                [FrequencyPenalty],
                [PresencePenalty],
                [Seed],
                [StopSequences],
                [IncludeLogProbs],
                [TopLogProbs],
                [FailoverStrategy],
                [FailoverMaxAttempts],
                [FailoverDelaySeconds],
                [FailoverModelStrategy],
                [FailoverErrorScope],
                [EffortLevel]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description,
                @TemplateID,
                @CategoryID,
                @TypeID,
                @Status,
                ISNULL(@ResponseFormat, 'Any'),
                @ModelSpecificResponseFormat,
                @AIModelTypeID,
                @MinPowerRank,
                ISNULL(@SelectionStrategy, 'Default'),
                ISNULL(@PowerPreference, 'Highest'),
                ISNULL(@ParallelizationMode, 'None'),
                @ParallelCount,
                @ParallelConfigParam,
                ISNULL(@OutputType, 'string'),
                @OutputExample,
                ISNULL(@ValidationBehavior, 'Warn'),
                ISNULL(@MaxRetries, 0),
                ISNULL(@RetryDelayMS, 0),
                ISNULL(@RetryStrategy, 'Fixed'),
                @ResultSelectorPromptID,
                ISNULL(@EnableCaching, 0),
                @CacheTTLSeconds,
                ISNULL(@CacheMatchType, 'Exact'),
                @CacheSimilarityThreshold,
                ISNULL(@CacheMustMatchModel, 1),
                ISNULL(@CacheMustMatchVendor, 1),
                ISNULL(@CacheMustMatchAgent, 0),
                ISNULL(@CacheMustMatchConfig, 0),
                ISNULL(@PromptRole, 'System'),
                ISNULL(@PromptPosition, 'First'),
                @Temperature,
                @TopP,
                @TopK,
                @MinP,
                @FrequencyPenalty,
                @PresencePenalty,
                @Seed,
                @StopSequences,
                @IncludeLogProbs,
                @TopLogProbs,
                ISNULL(@FailoverStrategy, 'SameModelDifferentVendor'),
                @FailoverMaxAttempts,
                @FailoverDelaySeconds,
                ISNULL(@FailoverModelStrategy, 'PreferSameModel'),
                ISNULL(@FailoverErrorScope, 'All'),
                @EffortLevel
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwAIPrompts] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIPrompt] TO [cdp_Developer]
    

/* spCreate Permissions for MJ: AI Prompts */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIPrompt] TO [cdp_Developer]



/* spUpdate SQL for MJ: AI Prompts */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Prompts
-- Item: spUpdateMJAIPrompt
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR AIPrompt
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJAIPrompt]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIPrompt];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIPrompt]
    @ID uniqueidentifier,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @TemplateID uniqueidentifier,
    @CategoryID uniqueidentifier,
    @TypeID uniqueidentifier,
    @Status nvarchar(50),
    @ResponseFormat nvarchar(20),
    @ModelSpecificResponseFormat nvarchar(MAX),
    @AIModelTypeID uniqueidentifier,
    @MinPowerRank int,
    @SelectionStrategy nvarchar(20),
    @PowerPreference nvarchar(20),
    @ParallelizationMode nvarchar(20),
    @ParallelCount int,
    @ParallelConfigParam nvarchar(100),
    @OutputType nvarchar(50),
    @OutputExample nvarchar(MAX),
    @ValidationBehavior nvarchar(50),
    @MaxRetries int,
    @RetryDelayMS int,
    @RetryStrategy nvarchar(20),
    @ResultSelectorPromptID uniqueidentifier,
    @EnableCaching bit,
    @CacheTTLSeconds int,
    @CacheMatchType nvarchar(20),
    @CacheSimilarityThreshold float(53),
    @CacheMustMatchModel bit,
    @CacheMustMatchVendor bit,
    @CacheMustMatchAgent bit,
    @CacheMustMatchConfig bit,
    @PromptRole nvarchar(20),
    @PromptPosition nvarchar(20),
    @Temperature decimal(3, 2),
    @TopP decimal(3, 2),
    @TopK int,
    @MinP decimal(3, 2),
    @FrequencyPenalty decimal(3, 2),
    @PresencePenalty decimal(3, 2),
    @Seed int,
    @StopSequences nvarchar(1000),
    @IncludeLogProbs bit,
    @TopLogProbs int,
    @FailoverStrategy nvarchar(50),
    @FailoverMaxAttempts int,
    @FailoverDelaySeconds int,
    @FailoverModelStrategy nvarchar(50),
    @FailoverErrorScope nvarchar(50),
    @EffortLevel int
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIPrompt]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [TemplateID] = @TemplateID,
        [CategoryID] = @CategoryID,
        [TypeID] = @TypeID,
        [Status] = @Status,
        [ResponseFormat] = @ResponseFormat,
        [ModelSpecificResponseFormat] = @ModelSpecificResponseFormat,
        [AIModelTypeID] = @AIModelTypeID,
        [MinPowerRank] = @MinPowerRank,
        [SelectionStrategy] = @SelectionStrategy,
        [PowerPreference] = @PowerPreference,
        [ParallelizationMode] = @ParallelizationMode,
        [ParallelCount] = @ParallelCount,
        [ParallelConfigParam] = @ParallelConfigParam,
        [OutputType] = @OutputType,
        [OutputExample] = @OutputExample,
        [ValidationBehavior] = @ValidationBehavior,
        [MaxRetries] = @MaxRetries,
        [RetryDelayMS] = @RetryDelayMS,
        [RetryStrategy] = @RetryStrategy,
        [ResultSelectorPromptID] = @ResultSelectorPromptID,
        [EnableCaching] = @EnableCaching,
        [CacheTTLSeconds] = @CacheTTLSeconds,
        [CacheMatchType] = @CacheMatchType,
        [CacheSimilarityThreshold] = @CacheSimilarityThreshold,
        [CacheMustMatchModel] = @CacheMustMatchModel,
        [CacheMustMatchVendor] = @CacheMustMatchVendor,
        [CacheMustMatchAgent] = @CacheMustMatchAgent,
        [CacheMustMatchConfig] = @CacheMustMatchConfig,
        [PromptRole] = @PromptRole,
        [PromptPosition] = @PromptPosition,
        [Temperature] = @Temperature,
        [TopP] = @TopP,
        [TopK] = @TopK,
        [MinP] = @MinP,
        [FrequencyPenalty] = @FrequencyPenalty,
        [PresencePenalty] = @PresencePenalty,
        [Seed] = @Seed,
        [StopSequences] = @StopSequences,
        [IncludeLogProbs] = @IncludeLogProbs,
        [TopLogProbs] = @TopLogProbs,
        [FailoverStrategy] = @FailoverStrategy,
        [FailoverMaxAttempts] = @FailoverMaxAttempts,
        [FailoverDelaySeconds] = @FailoverDelaySeconds,
        [FailoverModelStrategy] = @FailoverModelStrategy,
        [FailoverErrorScope] = @FailoverErrorScope,
        [EffortLevel] = @EffortLevel
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwAIPrompts] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwAIPrompts]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIPrompt] TO [cdp_Developer]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the AIPrompt table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJAIPrompt]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJAIPrompt];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJAIPrompt
ON [${flyway:defaultSchema}].[AIPrompt]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIPrompt]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[AIPrompt] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: AI Prompts */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIPrompt] TO [cdp_Developer]



/* Base View SQL for MJ: AI Vendors */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Vendors
-- Item: vwAIVendors
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: AI Vendors
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  AIVendor
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwAIVendors]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwAIVendors];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwAIVendors]
AS
SELECT
    m.*,
    MJCredentialTypes_CredentialTypeID.[Name] AS [CredentialType]
FROM
    [${flyway:defaultSchema}].[AIVendor] AS m
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[CredentialType] AS MJCredentialTypes_CredentialTypeID
  ON
    [m].[CredentialTypeID] = MJCredentialTypes_CredentialTypeID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwAIVendors] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: AI Vendors */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Vendors
-- Item: Permissions for vwAIVendors
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwAIVendors] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: AI Vendors */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Vendors
-- Item: spCreateMJAIVendor
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR AIVendor
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJAIVendor]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIVendor];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIVendor]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(50),
    @Description nvarchar(MAX),
    @CredentialTypeID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[AIVendor]
            (
                [ID],
                [Name],
                [Description],
                [CredentialTypeID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description,
                @CredentialTypeID
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[AIVendor]
            (
                [Name],
                [Description],
                [CredentialTypeID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description,
                @CredentialTypeID
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwAIVendors] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIVendor] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: AI Vendors */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIVendor] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: AI Vendors */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Vendors
-- Item: spUpdateMJAIVendor
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR AIVendor
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJAIVendor]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIVendor];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIVendor]
    @ID uniqueidentifier,
    @Name nvarchar(50),
    @Description nvarchar(MAX),
    @CredentialTypeID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIVendor]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [CredentialTypeID] = @CredentialTypeID
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwAIVendors] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwAIVendors]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIVendor] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the AIVendor table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJAIVendor]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJAIVendor];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJAIVendor
ON [${flyway:defaultSchema}].[AIVendor]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIVendor]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[AIVendor] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: AI Vendors */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIVendor] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: AI Vendors */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Vendors
-- Item: spDeleteMJAIVendor
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR AIVendor
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJAIVendor]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIVendor];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIVendor]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[AIVendor]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIVendor] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: AI Vendors */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIVendor] TO [cdp_Integration]



/* Base View SQL for MJ: AI Result Cache */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Result Cache
-- Item: vwAIResultCaches
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: AI Result Cache
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  AIResultCache
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwAIResultCaches]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwAIResultCaches];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwAIResultCaches]
AS
SELECT
    m.*,
    MJAIPrompts_AIPromptID.[Name] AS [AIPrompt],
    MJAIModels_AIModelID.[Name] AS [AIModel],
    MJAIVendors_VendorID.[Name] AS [Vendor],
    MJAIAgents_AgentID.[Name] AS [Agent],
    MJAIConfigurations_ConfigurationID.[Name] AS [Configuration],
    MJAIPromptRuns_PromptRunID.[RunName] AS [PromptRun]
FROM
    [${flyway:defaultSchema}].[AIResultCache] AS m
INNER JOIN
    [${flyway:defaultSchema}].[AIPrompt] AS MJAIPrompts_AIPromptID
  ON
    [m].[AIPromptID] = MJAIPrompts_AIPromptID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[AIModel] AS MJAIModels_AIModelID
  ON
    [m].[AIModelID] = MJAIModels_AIModelID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[AIVendor] AS MJAIVendors_VendorID
  ON
    [m].[VendorID] = MJAIVendors_VendorID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[AIAgent] AS MJAIAgents_AgentID
  ON
    [m].[AgentID] = MJAIAgents_AgentID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[AIConfiguration] AS MJAIConfigurations_ConfigurationID
  ON
    [m].[ConfigurationID] = MJAIConfigurations_ConfigurationID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[AIPromptRun] AS MJAIPromptRuns_PromptRunID
  ON
    [m].[PromptRunID] = MJAIPromptRuns_PromptRunID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwAIResultCaches] TO [cdp_Developer], [cdp_Integration], [cdp_UI]
    

/* Base View Permissions SQL for MJ: AI Result Cache */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Result Cache
-- Item: Permissions for vwAIResultCaches
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwAIResultCaches] TO [cdp_Developer], [cdp_Integration], [cdp_UI]

/* spCreate SQL for MJ: AI Result Cache */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Result Cache
-- Item: spCreateMJAIResultCache
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR AIResultCache
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJAIResultCache]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIResultCache];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIResultCache]
    @ID uniqueidentifier = NULL,
    @AIPromptID uniqueidentifier,
    @AIModelID uniqueidentifier,
    @RunAt datetimeoffset,
    @PromptText nvarchar(MAX),
    @ResultText nvarchar(MAX),
    @Status nvarchar(50),
    @ExpiredOn datetimeoffset,
    @VendorID uniqueidentifier,
    @AgentID uniqueidentifier,
    @ConfigurationID uniqueidentifier,
    @PromptEmbedding varbinary,
    @PromptRunID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[AIResultCache]
            (
                [ID],
                [AIPromptID],
                [AIModelID],
                [RunAt],
                [PromptText],
                [ResultText],
                [Status],
                [ExpiredOn],
                [VendorID],
                [AgentID],
                [ConfigurationID],
                [PromptEmbedding],
                [PromptRunID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @AIPromptID,
                @AIModelID,
                @RunAt,
                @PromptText,
                @ResultText,
                @Status,
                @ExpiredOn,
                @VendorID,
                @AgentID,
                @ConfigurationID,
                @PromptEmbedding,
                @PromptRunID
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[AIResultCache]
            (
                [AIPromptID],
                [AIModelID],
                [RunAt],
                [PromptText],
                [ResultText],
                [Status],
                [ExpiredOn],
                [VendorID],
                [AgentID],
                [ConfigurationID],
                [PromptEmbedding],
                [PromptRunID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @AIPromptID,
                @AIModelID,
                @RunAt,
                @PromptText,
                @ResultText,
                @Status,
                @ExpiredOn,
                @VendorID,
                @AgentID,
                @ConfigurationID,
                @PromptEmbedding,
                @PromptRunID
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwAIResultCaches] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
    

/* spCreate Permissions for MJ: AI Result Cache */




/* spUpdate SQL for MJ: AI Result Cache */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Result Cache
-- Item: spUpdateMJAIResultCache
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR AIResultCache
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJAIResultCache]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIResultCache];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIResultCache]
    @ID uniqueidentifier,
    @AIPromptID uniqueidentifier,
    @AIModelID uniqueidentifier,
    @RunAt datetimeoffset,
    @PromptText nvarchar(MAX),
    @ResultText nvarchar(MAX),
    @Status nvarchar(50),
    @ExpiredOn datetimeoffset,
    @VendorID uniqueidentifier,
    @AgentID uniqueidentifier,
    @ConfigurationID uniqueidentifier,
    @PromptEmbedding varbinary,
    @PromptRunID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIResultCache]
    SET
        [AIPromptID] = @AIPromptID,
        [AIModelID] = @AIModelID,
        [RunAt] = @RunAt,
        [PromptText] = @PromptText,
        [ResultText] = @ResultText,
        [Status] = @Status,
        [ExpiredOn] = @ExpiredOn,
        [VendorID] = @VendorID,
        [AgentID] = @AgentID,
        [ConfigurationID] = @ConfigurationID,
        [PromptEmbedding] = @PromptEmbedding,
        [PromptRunID] = @PromptRunID
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwAIResultCaches] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwAIResultCaches]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the AIResultCache table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJAIResultCache]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJAIResultCache];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJAIResultCache
ON [${flyway:defaultSchema}].[AIResultCache]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIResultCache]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[AIResultCache] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: AI Result Cache */




/* spDelete SQL for MJ: AI Result Cache */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Result Cache
-- Item: spDeleteMJAIResultCache
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR AIResultCache
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJAIResultCache]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIResultCache];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIResultCache]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[AIResultCache]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
    

/* spDelete Permissions for MJ: AI Result Cache */




/* Base View SQL for MJ: AI Vendor Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Vendor Types
-- Item: vwAIVendorTypes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: AI Vendor Types
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  AIVendorType
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwAIVendorTypes]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwAIVendorTypes];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwAIVendorTypes]
AS
SELECT
    m.*,
    MJAIVendors_VendorID.[Name] AS [Vendor],
    MJAIVendorTypeDefinitions_TypeID.[Name] AS [Type]
FROM
    [${flyway:defaultSchema}].[AIVendorType] AS m
INNER JOIN
    [${flyway:defaultSchema}].[AIVendor] AS MJAIVendors_VendorID
  ON
    [m].[VendorID] = MJAIVendors_VendorID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[AIVendorTypeDefinition] AS MJAIVendorTypeDefinitions_TypeID
  ON
    [m].[TypeID] = MJAIVendorTypeDefinitions_TypeID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwAIVendorTypes] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: AI Vendor Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Vendor Types
-- Item: Permissions for vwAIVendorTypes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwAIVendorTypes] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: AI Vendor Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Vendor Types
-- Item: spCreateMJAIVendorType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR AIVendorType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJAIVendorType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIVendorType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJAIVendorType]
    @ID uniqueidentifier = NULL,
    @VendorID uniqueidentifier,
    @TypeID uniqueidentifier,
    @Rank int = NULL,
    @Status nvarchar(20) = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[AIVendorType]
            (
                [ID],
                [VendorID],
                [TypeID],
                [Rank],
                [Status]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @VendorID,
                @TypeID,
                ISNULL(@Rank, 0),
                ISNULL(@Status, 'Active')
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[AIVendorType]
            (
                [VendorID],
                [TypeID],
                [Rank],
                [Status]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @VendorID,
                @TypeID,
                ISNULL(@Rank, 0),
                ISNULL(@Status, 'Active')
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwAIVendorTypes] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIVendorType] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: AI Vendor Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAIVendorType] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: AI Vendor Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Vendor Types
-- Item: spUpdateMJAIVendorType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR AIVendorType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJAIVendorType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIVendorType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAIVendorType]
    @ID uniqueidentifier,
    @VendorID uniqueidentifier,
    @TypeID uniqueidentifier,
    @Rank int,
    @Status nvarchar(20)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIVendorType]
    SET
        [VendorID] = @VendorID,
        [TypeID] = @TypeID,
        [Rank] = @Rank,
        [Status] = @Status
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwAIVendorTypes] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwAIVendorTypes]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIVendorType] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the AIVendorType table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJAIVendorType]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJAIVendorType];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJAIVendorType
ON [${flyway:defaultSchema}].[AIVendorType]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AIVendorType]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[AIVendorType] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: AI Vendor Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAIVendorType] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: AI Vendor Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Vendor Types
-- Item: spDeleteMJAIVendorType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR AIVendorType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJAIVendorType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIVendorType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIVendorType]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[AIVendorType]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIVendorType] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: AI Vendor Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIVendorType] TO [cdp_Integration]



/* spDelete SQL for MJ: AI Prompts */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: AI Prompts
-- Item: spDeleteMJAIPrompt
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR AIPrompt
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJAIPrompt]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIPrompt];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAIPrompt]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    -- Cascade update on Action using cursor to call spUpdateMJAction
    DECLARE @false_DefaultCompactPromptIDID uniqueidentifier
    DECLARE @false_DefaultCompactPromptID_CategoryID uniqueidentifier
    DECLARE @false_DefaultCompactPromptID_Name nvarchar(425)
    DECLARE @false_DefaultCompactPromptID_Description nvarchar(MAX)
    DECLARE @false_DefaultCompactPromptID_Type nvarchar(20)
    DECLARE @false_DefaultCompactPromptID_UserPrompt nvarchar(MAX)
    DECLARE @false_DefaultCompactPromptID_UserComments nvarchar(MAX)
    DECLARE @false_DefaultCompactPromptID_Code nvarchar(MAX)
    DECLARE @false_DefaultCompactPromptID_CodeComments nvarchar(MAX)
    DECLARE @false_DefaultCompactPromptID_CodeApprovalStatus nvarchar(20)
    DECLARE @false_DefaultCompactPromptID_CodeApprovalComments nvarchar(MAX)
    DECLARE @false_DefaultCompactPromptID_CodeApprovedByUserID uniqueidentifier
    DECLARE @false_DefaultCompactPromptID_CodeApprovedAt datetimeoffset
    DECLARE @false_DefaultCompactPromptID_CodeLocked bit
    DECLARE @false_DefaultCompactPromptID_ForceCodeGeneration bit
    DECLARE @false_DefaultCompactPromptID_RetentionPeriod int
    DECLARE @false_DefaultCompactPromptID_Status nvarchar(20)
    DECLARE @false_DefaultCompactPromptID_DriverClass nvarchar(255)
    DECLARE @false_DefaultCompactPromptID_ParentID uniqueidentifier
    DECLARE @false_DefaultCompactPromptID_IconClass nvarchar(100)
    DECLARE @false_DefaultCompactPromptID_DefaultCompactPromptID uniqueidentifier
    DECLARE cascade_update_false_DefaultCompactPromptID_cursor CURSOR FOR
        SELECT [ID], [CategoryID], [Name], [Description], [Type], [UserPrompt], [UserComments], [Code], [CodeComments], [CodeApprovalStatus], [CodeApprovalComments], [CodeApprovedByUserID], [CodeApprovedAt], [CodeLocked], [ForceCodeGeneration], [RetentionPeriod], [Status], [DriverClass], [ParentID], [IconClass], [DefaultCompactPromptID]
        FROM [${flyway:defaultSchema}].[Action]
        WHERE [DefaultCompactPromptID] = @ID

    OPEN cascade_update_false_DefaultCompactPromptID_cursor
    FETCH NEXT FROM cascade_update_false_DefaultCompactPromptID_cursor INTO @false_DefaultCompactPromptIDID, @false_DefaultCompactPromptID_CategoryID, @false_DefaultCompactPromptID_Name, @false_DefaultCompactPromptID_Description, @false_DefaultCompactPromptID_Type, @false_DefaultCompactPromptID_UserPrompt, @false_DefaultCompactPromptID_UserComments, @false_DefaultCompactPromptID_Code, @false_DefaultCompactPromptID_CodeComments, @false_DefaultCompactPromptID_CodeApprovalStatus, @false_DefaultCompactPromptID_CodeApprovalComments, @false_DefaultCompactPromptID_CodeApprovedByUserID, @false_DefaultCompactPromptID_CodeApprovedAt, @false_DefaultCompactPromptID_CodeLocked, @false_DefaultCompactPromptID_ForceCodeGeneration, @false_DefaultCompactPromptID_RetentionPeriod, @false_DefaultCompactPromptID_Status, @false_DefaultCompactPromptID_DriverClass, @false_DefaultCompactPromptID_ParentID, @false_DefaultCompactPromptID_IconClass, @false_DefaultCompactPromptID_DefaultCompactPromptID

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @false_DefaultCompactPromptID_DefaultCompactPromptID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateMJAction] @ID = @false_DefaultCompactPromptIDID, @CategoryID = @false_DefaultCompactPromptID_CategoryID, @Name = @false_DefaultCompactPromptID_Name, @Description = @false_DefaultCompactPromptID_Description, @Type = @false_DefaultCompactPromptID_Type, @UserPrompt = @false_DefaultCompactPromptID_UserPrompt, @UserComments = @false_DefaultCompactPromptID_UserComments, @Code = @false_DefaultCompactPromptID_Code, @CodeComments = @false_DefaultCompactPromptID_CodeComments, @CodeApprovalStatus = @false_DefaultCompactPromptID_CodeApprovalStatus, @CodeApprovalComments = @false_DefaultCompactPromptID_CodeApprovalComments, @CodeApprovedByUserID = @false_DefaultCompactPromptID_CodeApprovedByUserID, @CodeApprovedAt = @false_DefaultCompactPromptID_CodeApprovedAt, @CodeLocked = @false_DefaultCompactPromptID_CodeLocked, @ForceCodeGeneration = @false_DefaultCompactPromptID_ForceCodeGeneration, @RetentionPeriod = @false_DefaultCompactPromptID_RetentionPeriod, @Status = @false_DefaultCompactPromptID_Status, @DriverClass = @false_DefaultCompactPromptID_DriverClass, @ParentID = @false_DefaultCompactPromptID_ParentID, @IconClass = @false_DefaultCompactPromptID_IconClass, @DefaultCompactPromptID = @false_DefaultCompactPromptID_DefaultCompactPromptID

        FETCH NEXT FROM cascade_update_false_DefaultCompactPromptID_cursor INTO @false_DefaultCompactPromptIDID, @false_DefaultCompactPromptID_CategoryID, @false_DefaultCompactPromptID_Name, @false_DefaultCompactPromptID_Description, @false_DefaultCompactPromptID_Type, @false_DefaultCompactPromptID_UserPrompt, @false_DefaultCompactPromptID_UserComments, @false_DefaultCompactPromptID_Code, @false_DefaultCompactPromptID_CodeComments, @false_DefaultCompactPromptID_CodeApprovalStatus, @false_DefaultCompactPromptID_CodeApprovalComments, @false_DefaultCompactPromptID_CodeApprovedByUserID, @false_DefaultCompactPromptID_CodeApprovedAt, @false_DefaultCompactPromptID_CodeLocked, @false_DefaultCompactPromptID_ForceCodeGeneration, @false_DefaultCompactPromptID_RetentionPeriod, @false_DefaultCompactPromptID_Status, @false_DefaultCompactPromptID_DriverClass, @false_DefaultCompactPromptID_ParentID, @false_DefaultCompactPromptID_IconClass, @false_DefaultCompactPromptID_DefaultCompactPromptID
    END

    CLOSE cascade_update_false_DefaultCompactPromptID_cursor
    DEALLOCATE cascade_update_false_DefaultCompactPromptID_cursor
    
    -- Cascade update on AIAgentAction using cursor to call spUpdateMJAIAgentAction
    DECLARE @false_CompactPromptIDID uniqueidentifier
    DECLARE @false_CompactPromptID_AgentID uniqueidentifier
    DECLARE @false_CompactPromptID_ActionID uniqueidentifier
    DECLARE @false_CompactPromptID_Status nvarchar(15)
    DECLARE @false_CompactPromptID_MinExecutionsPerRun int
    DECLARE @false_CompactPromptID_MaxExecutionsPerRun int
    DECLARE @false_CompactPromptID_ResultExpirationTurns int
    DECLARE @false_CompactPromptID_ResultExpirationMode nvarchar(20)
    DECLARE @false_CompactPromptID_CompactMode nvarchar(20)
    DECLARE @false_CompactPromptID_CompactLength int
    DECLARE @false_CompactPromptID_CompactPromptID uniqueidentifier
    DECLARE cascade_update_false_CompactPromptID_cursor CURSOR FOR
        SELECT [ID], [AgentID], [ActionID], [Status], [MinExecutionsPerRun], [MaxExecutionsPerRun], [ResultExpirationTurns], [ResultExpirationMode], [CompactMode], [CompactLength], [CompactPromptID]
        FROM [${flyway:defaultSchema}].[AIAgentAction]
        WHERE [CompactPromptID] = @ID

    OPEN cascade_update_false_CompactPromptID_cursor
    FETCH NEXT FROM cascade_update_false_CompactPromptID_cursor INTO @false_CompactPromptIDID, @false_CompactPromptID_AgentID, @false_CompactPromptID_ActionID, @false_CompactPromptID_Status, @false_CompactPromptID_MinExecutionsPerRun, @false_CompactPromptID_MaxExecutionsPerRun, @false_CompactPromptID_ResultExpirationTurns, @false_CompactPromptID_ResultExpirationMode, @false_CompactPromptID_CompactMode, @false_CompactPromptID_CompactLength, @false_CompactPromptID_CompactPromptID

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @false_CompactPromptID_CompactPromptID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateMJAIAgentAction] @ID = @false_CompactPromptIDID, @AgentID = @false_CompactPromptID_AgentID, @ActionID = @false_CompactPromptID_ActionID, @Status = @false_CompactPromptID_Status, @MinExecutionsPerRun = @false_CompactPromptID_MinExecutionsPerRun, @MaxExecutionsPerRun = @false_CompactPromptID_MaxExecutionsPerRun, @ResultExpirationTurns = @false_CompactPromptID_ResultExpirationTurns, @ResultExpirationMode = @false_CompactPromptID_ResultExpirationMode, @CompactMode = @false_CompactPromptID_CompactMode, @CompactLength = @false_CompactPromptID_CompactLength, @CompactPromptID = @false_CompactPromptID_CompactPromptID

        FETCH NEXT FROM cascade_update_false_CompactPromptID_cursor INTO @false_CompactPromptIDID, @false_CompactPromptID_AgentID, @false_CompactPromptID_ActionID, @false_CompactPromptID_Status, @false_CompactPromptID_MinExecutionsPerRun, @false_CompactPromptID_MaxExecutionsPerRun, @false_CompactPromptID_ResultExpirationTurns, @false_CompactPromptID_ResultExpirationMode, @false_CompactPromptID_CompactMode, @false_CompactPromptID_CompactLength, @false_CompactPromptID_CompactPromptID
    END

    CLOSE cascade_update_false_CompactPromptID_cursor
    DEALLOCATE cascade_update_false_CompactPromptID_cursor
    
    -- Cascade delete from AIAgentPrompt using cursor to call spDeleteMJAIAgentPrompt
    DECLARE @false_PromptIDID uniqueidentifier
    DECLARE cascade_delete_false_PromptID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[AIAgentPrompt]
        WHERE [PromptID] = @ID
    
    OPEN cascade_delete_false_PromptID_cursor
    FETCH NEXT FROM cascade_delete_false_PromptID_cursor INTO @false_PromptIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteMJAIAgentPrompt] @ID = @false_PromptIDID
        
        FETCH NEXT FROM cascade_delete_false_PromptID_cursor INTO @false_PromptIDID
    END
    
    CLOSE cascade_delete_false_PromptID_cursor
    DEALLOCATE cascade_delete_false_PromptID_cursor
    
    -- Cascade update on AIAgentStep using cursor to call spUpdateMJAIAgentStep
    DECLARE @false_PromptIDID uniqueidentifier
    DECLARE @false_PromptID_AgentID uniqueidentifier
    DECLARE @false_PromptID_Name nvarchar(255)
    DECLARE @false_PromptID_Description nvarchar(MAX)
    DECLARE @false_PromptID_StepType nvarchar(20)
    DECLARE @false_PromptID_StartingStep bit
    DECLARE @false_PromptID_TimeoutSeconds int
    DECLARE @false_PromptID_RetryCount int
    DECLARE @false_PromptID_OnErrorBehavior nvarchar(20)
    DECLARE @false_PromptID_ActionID uniqueidentifier
    DECLARE @false_PromptID_SubAgentID uniqueidentifier
    DECLARE @false_PromptID_PromptID uniqueidentifier
    DECLARE @false_PromptID_ActionOutputMapping nvarchar(MAX)
    DECLARE @false_PromptID_PositionX int
    DECLARE @false_PromptID_PositionY int
    DECLARE @false_PromptID_Width int
    DECLARE @false_PromptID_Height int
    DECLARE @false_PromptID_Status nvarchar(20)
    DECLARE @false_PromptID_ActionInputMapping nvarchar(MAX)
    DECLARE @false_PromptID_LoopBodyType nvarchar(50)
    DECLARE @false_PromptID_Configuration nvarchar(MAX)
    DECLARE cascade_update_false_PromptID_cursor CURSOR FOR
        SELECT [ID], [AgentID], [Name], [Description], [StepType], [StartingStep], [TimeoutSeconds], [RetryCount], [OnErrorBehavior], [ActionID], [SubAgentID], [PromptID], [ActionOutputMapping], [PositionX], [PositionY], [Width], [Height], [Status], [ActionInputMapping], [LoopBodyType], [Configuration]
        FROM [${flyway:defaultSchema}].[AIAgentStep]
        WHERE [PromptID] = @ID

    OPEN cascade_update_false_PromptID_cursor
    FETCH NEXT FROM cascade_update_false_PromptID_cursor INTO @false_PromptIDID, @false_PromptID_AgentID, @false_PromptID_Name, @false_PromptID_Description, @false_PromptID_StepType, @false_PromptID_StartingStep, @false_PromptID_TimeoutSeconds, @false_PromptID_RetryCount, @false_PromptID_OnErrorBehavior, @false_PromptID_ActionID, @false_PromptID_SubAgentID, @false_PromptID_PromptID, @false_PromptID_ActionOutputMapping, @false_PromptID_PositionX, @false_PromptID_PositionY, @false_PromptID_Width, @false_PromptID_Height, @false_PromptID_Status, @false_PromptID_ActionInputMapping, @false_PromptID_LoopBodyType, @false_PromptID_Configuration

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @false_PromptID_PromptID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateMJAIAgentStep] @ID = @false_PromptIDID, @AgentID = @false_PromptID_AgentID, @Name = @false_PromptID_Name, @Description = @false_PromptID_Description, @StepType = @false_PromptID_StepType, @StartingStep = @false_PromptID_StartingStep, @TimeoutSeconds = @false_PromptID_TimeoutSeconds, @RetryCount = @false_PromptID_RetryCount, @OnErrorBehavior = @false_PromptID_OnErrorBehavior, @ActionID = @false_PromptID_ActionID, @SubAgentID = @false_PromptID_SubAgentID, @PromptID = @false_PromptID_PromptID, @ActionOutputMapping = @false_PromptID_ActionOutputMapping, @PositionX = @false_PromptID_PositionX, @PositionY = @false_PromptID_PositionY, @Width = @false_PromptID_Width, @Height = @false_PromptID_Height, @Status = @false_PromptID_Status, @ActionInputMapping = @false_PromptID_ActionInputMapping, @LoopBodyType = @false_PromptID_LoopBodyType, @Configuration = @false_PromptID_Configuration

        FETCH NEXT FROM cascade_update_false_PromptID_cursor INTO @false_PromptIDID, @false_PromptID_AgentID, @false_PromptID_Name, @false_PromptID_Description, @false_PromptID_StepType, @false_PromptID_StartingStep, @false_PromptID_TimeoutSeconds, @false_PromptID_RetryCount, @false_PromptID_OnErrorBehavior, @false_PromptID_ActionID, @false_PromptID_SubAgentID, @false_PromptID_PromptID, @false_PromptID_ActionOutputMapping, @false_PromptID_PositionX, @false_PromptID_PositionY, @false_PromptID_Width, @false_PromptID_Height, @false_PromptID_Status, @false_PromptID_ActionInputMapping, @false_PromptID_LoopBodyType, @false_PromptID_Configuration
    END

    CLOSE cascade_update_false_PromptID_cursor
    DEALLOCATE cascade_update_false_PromptID_cursor
    
    -- Cascade update on AIAgentType using cursor to call spUpdateMJAIAgentType
    DECLARE @false_SystemPromptIDID uniqueidentifier
    DECLARE @false_SystemPromptID_Name nvarchar(100)
    DECLARE @false_SystemPromptID_Description nvarchar(MAX)
    DECLARE @false_SystemPromptID_SystemPromptID uniqueidentifier
    DECLARE @false_SystemPromptID_IsActive bit
    DECLARE @false_SystemPromptID_AgentPromptPlaceholder nvarchar(255)
    DECLARE @false_SystemPromptID_DriverClass nvarchar(255)
    DECLARE @false_SystemPromptID_UIFormSectionKey nvarchar(500)
    DECLARE @false_SystemPromptID_UIFormKey nvarchar(500)
    DECLARE @false_SystemPromptID_UIFormSectionExpandedByDefault bit
    DECLARE @false_SystemPromptID_PromptParamsSchema nvarchar(MAX)
    DECLARE cascade_update_false_SystemPromptID_cursor CURSOR FOR
        SELECT [ID], [Name], [Description], [SystemPromptID], [IsActive], [AgentPromptPlaceholder], [DriverClass], [UIFormSectionKey], [UIFormKey], [UIFormSectionExpandedByDefault], [PromptParamsSchema]
        FROM [${flyway:defaultSchema}].[AIAgentType]
        WHERE [SystemPromptID] = @ID

    OPEN cascade_update_false_SystemPromptID_cursor
    FETCH NEXT FROM cascade_update_false_SystemPromptID_cursor INTO @false_SystemPromptIDID, @false_SystemPromptID_Name, @false_SystemPromptID_Description, @false_SystemPromptID_SystemPromptID, @false_SystemPromptID_IsActive, @false_SystemPromptID_AgentPromptPlaceholder, @false_SystemPromptID_DriverClass, @false_SystemPromptID_UIFormSectionKey, @false_SystemPromptID_UIFormKey, @false_SystemPromptID_UIFormSectionExpandedByDefault, @false_SystemPromptID_PromptParamsSchema

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @false_SystemPromptID_SystemPromptID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateMJAIAgentType] @ID = @false_SystemPromptIDID, @Name = @false_SystemPromptID_Name, @Description = @false_SystemPromptID_Description, @SystemPromptID = @false_SystemPromptID_SystemPromptID, @IsActive = @false_SystemPromptID_IsActive, @AgentPromptPlaceholder = @false_SystemPromptID_AgentPromptPlaceholder, @DriverClass = @false_SystemPromptID_DriverClass, @UIFormSectionKey = @false_SystemPromptID_UIFormSectionKey, @UIFormKey = @false_SystemPromptID_UIFormKey, @UIFormSectionExpandedByDefault = @false_SystemPromptID_UIFormSectionExpandedByDefault, @PromptParamsSchema = @false_SystemPromptID_PromptParamsSchema

        FETCH NEXT FROM cascade_update_false_SystemPromptID_cursor INTO @false_SystemPromptIDID, @false_SystemPromptID_Name, @false_SystemPromptID_Description, @false_SystemPromptID_SystemPromptID, @false_SystemPromptID_IsActive, @false_SystemPromptID_AgentPromptPlaceholder, @false_SystemPromptID_DriverClass, @false_SystemPromptID_UIFormSectionKey, @false_SystemPromptID_UIFormKey, @false_SystemPromptID_UIFormSectionExpandedByDefault, @false_SystemPromptID_PromptParamsSchema
    END

    CLOSE cascade_update_false_SystemPromptID_cursor
    DEALLOCATE cascade_update_false_SystemPromptID_cursor
    
    -- Cascade update on AIAgent using cursor to call spUpdateMJAIAgent
    DECLARE @false_ContextCompressionPromptIDID uniqueidentifier
    DECLARE @false_ContextCompressionPromptID_Name nvarchar(255)
    DECLARE @false_ContextCompressionPromptID_Description nvarchar(MAX)
    DECLARE @false_ContextCompressionPromptID_LogoURL nvarchar(255)
    DECLARE @false_ContextCompressionPromptID_ParentID uniqueidentifier
    DECLARE @false_ContextCompressionPromptID_ExposeAsAction bit
    DECLARE @false_ContextCompressionPromptID_ExecutionOrder int
    DECLARE @false_ContextCompressionPromptID_ExecutionMode nvarchar(20)
    DECLARE @false_ContextCompressionPromptID_EnableContextCompression bit
    DECLARE @false_ContextCompressionPromptID_ContextCompressionMessageThreshold int
    DECLARE @false_ContextCompressionPromptID_ContextCompressionPromptID uniqueidentifier
    DECLARE @false_ContextCompressionPromptID_ContextCompressionMessageRetentionCount int
    DECLARE @false_ContextCompressionPromptID_TypeID uniqueidentifier
    DECLARE @false_ContextCompressionPromptID_Status nvarchar(20)
    DECLARE @false_ContextCompressionPromptID_DriverClass nvarchar(255)
    DECLARE @false_ContextCompressionPromptID_IconClass nvarchar(100)
    DECLARE @false_ContextCompressionPromptID_ModelSelectionMode nvarchar(50)
    DECLARE @false_ContextCompressionPromptID_PayloadDownstreamPaths nvarchar(MAX)
    DECLARE @false_ContextCompressionPromptID_PayloadUpstreamPaths nvarchar(MAX)
    DECLARE @false_ContextCompressionPromptID_PayloadSelfReadPaths nvarchar(MAX)
    DECLARE @false_ContextCompressionPromptID_PayloadSelfWritePaths nvarchar(MAX)
    DECLARE @false_ContextCompressionPromptID_PayloadScope nvarchar(MAX)
    DECLARE @false_ContextCompressionPromptID_FinalPayloadValidation nvarchar(MAX)
    DECLARE @false_ContextCompressionPromptID_FinalPayloadValidationMode nvarchar(25)
    DECLARE @false_ContextCompressionPromptID_FinalPayloadValidationMaxRetries int
    DECLARE @false_ContextCompressionPromptID_MaxCostPerRun decimal(10, 4)
    DECLARE @false_ContextCompressionPromptID_MaxTokensPerRun int
    DECLARE @false_ContextCompressionPromptID_MaxIterationsPerRun int
    DECLARE @false_ContextCompressionPromptID_MaxTimePerRun int
    DECLARE @false_ContextCompressionPromptID_MinExecutionsPerRun int
    DECLARE @false_ContextCompressionPromptID_MaxExecutionsPerRun int
    DECLARE @false_ContextCompressionPromptID_StartingPayloadValidation nvarchar(MAX)
    DECLARE @false_ContextCompressionPromptID_StartingPayloadValidationMode nvarchar(25)
    DECLARE @false_ContextCompressionPromptID_DefaultPromptEffortLevel int
    DECLARE @false_ContextCompressionPromptID_ChatHandlingOption nvarchar(30)
    DECLARE @false_ContextCompressionPromptID_DefaultArtifactTypeID uniqueidentifier
    DECLARE @false_ContextCompressionPromptID_OwnerUserID uniqueidentifier
    DECLARE @false_ContextCompressionPromptID_InvocationMode nvarchar(20)
    DECLARE @false_ContextCompressionPromptID_ArtifactCreationMode nvarchar(20)
    DECLARE @false_ContextCompressionPromptID_FunctionalRequirements nvarchar(MAX)
    DECLARE @false_ContextCompressionPromptID_TechnicalDesign nvarchar(MAX)
    DECLARE @false_ContextCompressionPromptID_InjectNotes bit
    DECLARE @false_ContextCompressionPromptID_MaxNotesToInject int
    DECLARE @false_ContextCompressionPromptID_NoteInjectionStrategy nvarchar(20)
    DECLARE @false_ContextCompressionPromptID_InjectExamples bit
    DECLARE @false_ContextCompressionPromptID_MaxExamplesToInject int
    DECLARE @false_ContextCompressionPromptID_ExampleInjectionStrategy nvarchar(20)
    DECLARE @false_ContextCompressionPromptID_IsRestricted bit
    DECLARE @false_ContextCompressionPromptID_MessageMode nvarchar(50)
    DECLARE @false_ContextCompressionPromptID_MaxMessages int
    DECLARE @false_ContextCompressionPromptID_AttachmentStorageProviderID uniqueidentifier
    DECLARE @false_ContextCompressionPromptID_AttachmentRootPath nvarchar(500)
    DECLARE @false_ContextCompressionPromptID_InlineStorageThresholdBytes int
    DECLARE @false_ContextCompressionPromptID_AgentTypePromptParams nvarchar(MAX)
    DECLARE @false_ContextCompressionPromptID_ScopeConfig nvarchar(MAX)
    DECLARE @false_ContextCompressionPromptID_NoteRetentionDays int
    DECLARE @false_ContextCompressionPromptID_ExampleRetentionDays int
    DECLARE @false_ContextCompressionPromptID_AutoArchiveEnabled bit
    DECLARE @false_ContextCompressionPromptID_RerankerConfiguration nvarchar(MAX)
    DECLARE cascade_update_false_ContextCompressionPromptID_cursor CURSOR FOR
        SELECT [ID], [Name], [Description], [LogoURL], [ParentID], [ExposeAsAction], [ExecutionOrder], [ExecutionMode], [EnableContextCompression], [ContextCompressionMessageThreshold], [ContextCompressionPromptID], [ContextCompressionMessageRetentionCount], [TypeID], [Status], [DriverClass], [IconClass], [ModelSelectionMode], [PayloadDownstreamPaths], [PayloadUpstreamPaths], [PayloadSelfReadPaths], [PayloadSelfWritePaths], [PayloadScope], [FinalPayloadValidation], [FinalPayloadValidationMode], [FinalPayloadValidationMaxRetries], [MaxCostPerRun], [MaxTokensPerRun], [MaxIterationsPerRun], [MaxTimePerRun], [MinExecutionsPerRun], [MaxExecutionsPerRun], [StartingPayloadValidation], [StartingPayloadValidationMode], [DefaultPromptEffortLevel], [ChatHandlingOption], [DefaultArtifactTypeID], [OwnerUserID], [InvocationMode], [ArtifactCreationMode], [FunctionalRequirements], [TechnicalDesign], [InjectNotes], [MaxNotesToInject], [NoteInjectionStrategy], [InjectExamples], [MaxExamplesToInject], [ExampleInjectionStrategy], [IsRestricted], [MessageMode], [MaxMessages], [AttachmentStorageProviderID], [AttachmentRootPath], [InlineStorageThresholdBytes], [AgentTypePromptParams], [ScopeConfig], [NoteRetentionDays], [ExampleRetentionDays], [AutoArchiveEnabled], [RerankerConfiguration]
        FROM [${flyway:defaultSchema}].[AIAgent]
        WHERE [ContextCompressionPromptID] = @ID

    OPEN cascade_update_false_ContextCompressionPromptID_cursor
    FETCH NEXT FROM cascade_update_false_ContextCompressionPromptID_cursor INTO @false_ContextCompressionPromptIDID, @false_ContextCompressionPromptID_Name, @false_ContextCompressionPromptID_Description, @false_ContextCompressionPromptID_LogoURL, @false_ContextCompressionPromptID_ParentID, @false_ContextCompressionPromptID_ExposeAsAction, @false_ContextCompressionPromptID_ExecutionOrder, @false_ContextCompressionPromptID_ExecutionMode, @false_ContextCompressionPromptID_EnableContextCompression, @false_ContextCompressionPromptID_ContextCompressionMessageThreshold, @false_ContextCompressionPromptID_ContextCompressionPromptID, @false_ContextCompressionPromptID_ContextCompressionMessageRetentionCount, @false_ContextCompressionPromptID_TypeID, @false_ContextCompressionPromptID_Status, @false_ContextCompressionPromptID_DriverClass, @false_ContextCompressionPromptID_IconClass, @false_ContextCompressionPromptID_ModelSelectionMode, @false_ContextCompressionPromptID_PayloadDownstreamPaths, @false_ContextCompressionPromptID_PayloadUpstreamPaths, @false_ContextCompressionPromptID_PayloadSelfReadPaths, @false_ContextCompressionPromptID_PayloadSelfWritePaths, @false_ContextCompressionPromptID_PayloadScope, @false_ContextCompressionPromptID_FinalPayloadValidation, @false_ContextCompressionPromptID_FinalPayloadValidationMode, @false_ContextCompressionPromptID_FinalPayloadValidationMaxRetries, @false_ContextCompressionPromptID_MaxCostPerRun, @false_ContextCompressionPromptID_MaxTokensPerRun, @false_ContextCompressionPromptID_MaxIterationsPerRun, @false_ContextCompressionPromptID_MaxTimePerRun, @false_ContextCompressionPromptID_MinExecutionsPerRun, @false_ContextCompressionPromptID_MaxExecutionsPerRun, @false_ContextCompressionPromptID_StartingPayloadValidation, @false_ContextCompressionPromptID_StartingPayloadValidationMode, @false_ContextCompressionPromptID_DefaultPromptEffortLevel, @false_ContextCompressionPromptID_ChatHandlingOption, @false_ContextCompressionPromptID_DefaultArtifactTypeID, @false_ContextCompressionPromptID_OwnerUserID, @false_ContextCompressionPromptID_InvocationMode, @false_ContextCompressionPromptID_ArtifactCreationMode, @false_ContextCompressionPromptID_FunctionalRequirements, @false_ContextCompressionPromptID_TechnicalDesign, @false_ContextCompressionPromptID_InjectNotes, @false_ContextCompressionPromptID_MaxNotesToInject, @false_ContextCompressionPromptID_NoteInjectionStrategy, @false_ContextCompressionPromptID_InjectExamples, @false_ContextCompressionPromptID_MaxExamplesToInject, @false_ContextCompressionPromptID_ExampleInjectionStrategy, @false_ContextCompressionPromptID_IsRestricted, @false_ContextCompressionPromptID_MessageMode, @false_ContextCompressionPromptID_MaxMessages, @false_ContextCompressionPromptID_AttachmentStorageProviderID, @false_ContextCompressionPromptID_AttachmentRootPath, @false_ContextCompressionPromptID_InlineStorageThresholdBytes, @false_ContextCompressionPromptID_AgentTypePromptParams, @false_ContextCompressionPromptID_ScopeConfig, @false_ContextCompressionPromptID_NoteRetentionDays, @false_ContextCompressionPromptID_ExampleRetentionDays, @false_ContextCompressionPromptID_AutoArchiveEnabled, @false_ContextCompressionPromptID_RerankerConfiguration

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @false_ContextCompressionPromptID_ContextCompressionPromptID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateMJAIAgent] @ID = @false_ContextCompressionPromptIDID, @Name = @false_ContextCompressionPromptID_Name, @Description = @false_ContextCompressionPromptID_Description, @LogoURL = @false_ContextCompressionPromptID_LogoURL, @ParentID = @false_ContextCompressionPromptID_ParentID, @ExposeAsAction = @false_ContextCompressionPromptID_ExposeAsAction, @ExecutionOrder = @false_ContextCompressionPromptID_ExecutionOrder, @ExecutionMode = @false_ContextCompressionPromptID_ExecutionMode, @EnableContextCompression = @false_ContextCompressionPromptID_EnableContextCompression, @ContextCompressionMessageThreshold = @false_ContextCompressionPromptID_ContextCompressionMessageThreshold, @ContextCompressionPromptID = @false_ContextCompressionPromptID_ContextCompressionPromptID, @ContextCompressionMessageRetentionCount = @false_ContextCompressionPromptID_ContextCompressionMessageRetentionCount, @TypeID = @false_ContextCompressionPromptID_TypeID, @Status = @false_ContextCompressionPromptID_Status, @DriverClass = @false_ContextCompressionPromptID_DriverClass, @IconClass = @false_ContextCompressionPromptID_IconClass, @ModelSelectionMode = @false_ContextCompressionPromptID_ModelSelectionMode, @PayloadDownstreamPaths = @false_ContextCompressionPromptID_PayloadDownstreamPaths, @PayloadUpstreamPaths = @false_ContextCompressionPromptID_PayloadUpstreamPaths, @PayloadSelfReadPaths = @false_ContextCompressionPromptID_PayloadSelfReadPaths, @PayloadSelfWritePaths = @false_ContextCompressionPromptID_PayloadSelfWritePaths, @PayloadScope = @false_ContextCompressionPromptID_PayloadScope, @FinalPayloadValidation = @false_ContextCompressionPromptID_FinalPayloadValidation, @FinalPayloadValidationMode = @false_ContextCompressionPromptID_FinalPayloadValidationMode, @FinalPayloadValidationMaxRetries = @false_ContextCompressionPromptID_FinalPayloadValidationMaxRetries, @MaxCostPerRun = @false_ContextCompressionPromptID_MaxCostPerRun, @MaxTokensPerRun = @false_ContextCompressionPromptID_MaxTokensPerRun, @MaxIterationsPerRun = @false_ContextCompressionPromptID_MaxIterationsPerRun, @MaxTimePerRun = @false_ContextCompressionPromptID_MaxTimePerRun, @MinExecutionsPerRun = @false_ContextCompressionPromptID_MinExecutionsPerRun, @MaxExecutionsPerRun = @false_ContextCompressionPromptID_MaxExecutionsPerRun, @StartingPayloadValidation = @false_ContextCompressionPromptID_StartingPayloadValidation, @StartingPayloadValidationMode = @false_ContextCompressionPromptID_StartingPayloadValidationMode, @DefaultPromptEffortLevel = @false_ContextCompressionPromptID_DefaultPromptEffortLevel, @ChatHandlingOption = @false_ContextCompressionPromptID_ChatHandlingOption, @DefaultArtifactTypeID = @false_ContextCompressionPromptID_DefaultArtifactTypeID, @OwnerUserID = @false_ContextCompressionPromptID_OwnerUserID, @InvocationMode = @false_ContextCompressionPromptID_InvocationMode, @ArtifactCreationMode = @false_ContextCompressionPromptID_ArtifactCreationMode, @FunctionalRequirements = @false_ContextCompressionPromptID_FunctionalRequirements, @TechnicalDesign = @false_ContextCompressionPromptID_TechnicalDesign, @InjectNotes = @false_ContextCompressionPromptID_InjectNotes, @MaxNotesToInject = @false_ContextCompressionPromptID_MaxNotesToInject, @NoteInjectionStrategy = @false_ContextCompressionPromptID_NoteInjectionStrategy, @InjectExamples = @false_ContextCompressionPromptID_InjectExamples, @MaxExamplesToInject = @false_ContextCompressionPromptID_MaxExamplesToInject, @ExampleInjectionStrategy = @false_ContextCompressionPromptID_ExampleInjectionStrategy, @IsRestricted = @false_ContextCompressionPromptID_IsRestricted, @MessageMode = @false_ContextCompressionPromptID_MessageMode, @MaxMessages = @false_ContextCompressionPromptID_MaxMessages, @AttachmentStorageProviderID = @false_ContextCompressionPromptID_AttachmentStorageProviderID, @AttachmentRootPath = @false_ContextCompressionPromptID_AttachmentRootPath, @InlineStorageThresholdBytes = @false_ContextCompressionPromptID_InlineStorageThresholdBytes, @AgentTypePromptParams = @false_ContextCompressionPromptID_AgentTypePromptParams, @ScopeConfig = @false_ContextCompressionPromptID_ScopeConfig, @NoteRetentionDays = @false_ContextCompressionPromptID_NoteRetentionDays, @ExampleRetentionDays = @false_ContextCompressionPromptID_ExampleRetentionDays, @AutoArchiveEnabled = @false_ContextCompressionPromptID_AutoArchiveEnabled, @RerankerConfiguration = @false_ContextCompressionPromptID_RerankerConfiguration

        FETCH NEXT FROM cascade_update_false_ContextCompressionPromptID_cursor INTO @false_ContextCompressionPromptIDID, @false_ContextCompressionPromptID_Name, @false_ContextCompressionPromptID_Description, @false_ContextCompressionPromptID_LogoURL, @false_ContextCompressionPromptID_ParentID, @false_ContextCompressionPromptID_ExposeAsAction, @false_ContextCompressionPromptID_ExecutionOrder, @false_ContextCompressionPromptID_ExecutionMode, @false_ContextCompressionPromptID_EnableContextCompression, @false_ContextCompressionPromptID_ContextCompressionMessageThreshold, @false_ContextCompressionPromptID_ContextCompressionPromptID, @false_ContextCompressionPromptID_ContextCompressionMessageRetentionCount, @false_ContextCompressionPromptID_TypeID, @false_ContextCompressionPromptID_Status, @false_ContextCompressionPromptID_DriverClass, @false_ContextCompressionPromptID_IconClass, @false_ContextCompressionPromptID_ModelSelectionMode, @false_ContextCompressionPromptID_PayloadDownstreamPaths, @false_ContextCompressionPromptID_PayloadUpstreamPaths, @false_ContextCompressionPromptID_PayloadSelfReadPaths, @false_ContextCompressionPromptID_PayloadSelfWritePaths, @false_ContextCompressionPromptID_PayloadScope, @false_ContextCompressionPromptID_FinalPayloadValidation, @false_ContextCompressionPromptID_FinalPayloadValidationMode, @false_ContextCompressionPromptID_FinalPayloadValidationMaxRetries, @false_ContextCompressionPromptID_MaxCostPerRun, @false_ContextCompressionPromptID_MaxTokensPerRun, @false_ContextCompressionPromptID_MaxIterationsPerRun, @false_ContextCompressionPromptID_MaxTimePerRun, @false_ContextCompressionPromptID_MinExecutionsPerRun, @false_ContextCompressionPromptID_MaxExecutionsPerRun, @false_ContextCompressionPromptID_StartingPayloadValidation, @false_ContextCompressionPromptID_StartingPayloadValidationMode, @false_ContextCompressionPromptID_DefaultPromptEffortLevel, @false_ContextCompressionPromptID_ChatHandlingOption, @false_ContextCompressionPromptID_DefaultArtifactTypeID, @false_ContextCompressionPromptID_OwnerUserID, @false_ContextCompressionPromptID_InvocationMode, @false_ContextCompressionPromptID_ArtifactCreationMode, @false_ContextCompressionPromptID_FunctionalRequirements, @false_ContextCompressionPromptID_TechnicalDesign, @false_ContextCompressionPromptID_InjectNotes, @false_ContextCompressionPromptID_MaxNotesToInject, @false_ContextCompressionPromptID_NoteInjectionStrategy, @false_ContextCompressionPromptID_InjectExamples, @false_ContextCompressionPromptID_MaxExamplesToInject, @false_ContextCompressionPromptID_ExampleInjectionStrategy, @false_ContextCompressionPromptID_IsRestricted, @false_ContextCompressionPromptID_MessageMode, @false_ContextCompressionPromptID_MaxMessages, @false_ContextCompressionPromptID_AttachmentStorageProviderID, @false_ContextCompressionPromptID_AttachmentRootPath, @false_ContextCompressionPromptID_InlineStorageThresholdBytes, @false_ContextCompressionPromptID_AgentTypePromptParams, @false_ContextCompressionPromptID_ScopeConfig, @false_ContextCompressionPromptID_NoteRetentionDays, @false_ContextCompressionPromptID_ExampleRetentionDays, @false_ContextCompressionPromptID_AutoArchiveEnabled, @false_ContextCompressionPromptID_RerankerConfiguration
    END

    CLOSE cascade_update_false_ContextCompressionPromptID_cursor
    DEALLOCATE cascade_update_false_ContextCompressionPromptID_cursor
    
    -- Cascade update on AIConfiguration using cursor to call spUpdateMJAIConfiguration
    DECLARE @false_DefaultPromptForContextCompressionIDID uniqueidentifier
    DECLARE @false_DefaultPromptForContextCompressionID_Name nvarchar(100)
    DECLARE @false_DefaultPromptForContextCompressionID_Description nvarchar(MAX)
    DECLARE @false_DefaultPromptForContextCompressionID_IsDefault bit
    DECLARE @false_DefaultPromptForContextCompressionID_Status nvarchar(20)
    DECLARE @false_DefaultPromptForContextCompressionID_DefaultPromptForContextCompressionID uniqueidentifier
    DECLARE @false_DefaultPromptForContextCompressionID_DefaultPromptForContextSummarizationID uniqueidentifier
    DECLARE @false_DefaultPromptForContextCompressionID_DefaultStorageProviderID uniqueidentifier
    DECLARE @false_DefaultPromptForContextCompressionID_DefaultStorageRootPath nvarchar(500)
    DECLARE @false_DefaultPromptForContextCompressionID_ParentID uniqueidentifier
    DECLARE cascade_update_false_DefaultPromptForContextCompressionID_cursor CURSOR FOR
        SELECT [ID], [Name], [Description], [IsDefault], [Status], [DefaultPromptForContextCompressionID], [DefaultPromptForContextSummarizationID], [DefaultStorageProviderID], [DefaultStorageRootPath], [ParentID]
        FROM [${flyway:defaultSchema}].[AIConfiguration]
        WHERE [DefaultPromptForContextCompressionID] = @ID

    OPEN cascade_update_false_DefaultPromptForContextCompressionID_cursor
    FETCH NEXT FROM cascade_update_false_DefaultPromptForContextCompressionID_cursor INTO @false_DefaultPromptForContextCompressionIDID, @false_DefaultPromptForContextCompressionID_Name, @false_DefaultPromptForContextCompressionID_Description, @false_DefaultPromptForContextCompressionID_IsDefault, @false_DefaultPromptForContextCompressionID_Status, @false_DefaultPromptForContextCompressionID_DefaultPromptForContextCompressionID, @false_DefaultPromptForContextCompressionID_DefaultPromptForContextSummarizationID, @false_DefaultPromptForContextCompressionID_DefaultStorageProviderID, @false_DefaultPromptForContextCompressionID_DefaultStorageRootPath, @false_DefaultPromptForContextCompressionID_ParentID

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @false_DefaultPromptForContextCompressionID_DefaultPromptForContextCompressionID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateMJAIConfiguration] @ID = @false_DefaultPromptForContextCompressionIDID, @Name = @false_DefaultPromptForContextCompressionID_Name, @Description = @false_DefaultPromptForContextCompressionID_Description, @IsDefault = @false_DefaultPromptForContextCompressionID_IsDefault, @Status = @false_DefaultPromptForContextCompressionID_Status, @DefaultPromptForContextCompressionID = @false_DefaultPromptForContextCompressionID_DefaultPromptForContextCompressionID, @DefaultPromptForContextSummarizationID = @false_DefaultPromptForContextCompressionID_DefaultPromptForContextSummarizationID, @DefaultStorageProviderID = @false_DefaultPromptForContextCompressionID_DefaultStorageProviderID, @DefaultStorageRootPath = @false_DefaultPromptForContextCompressionID_DefaultStorageRootPath, @ParentID = @false_DefaultPromptForContextCompressionID_ParentID

        FETCH NEXT FROM cascade_update_false_DefaultPromptForContextCompressionID_cursor INTO @false_DefaultPromptForContextCompressionIDID, @false_DefaultPromptForContextCompressionID_Name, @false_DefaultPromptForContextCompressionID_Description, @false_DefaultPromptForContextCompressionID_IsDefault, @false_DefaultPromptForContextCompressionID_Status, @false_DefaultPromptForContextCompressionID_DefaultPromptForContextCompressionID, @false_DefaultPromptForContextCompressionID_DefaultPromptForContextSummarizationID, @false_DefaultPromptForContextCompressionID_DefaultStorageProviderID, @false_DefaultPromptForContextCompressionID_DefaultStorageRootPath, @false_DefaultPromptForContextCompressionID_ParentID
    END

    CLOSE cascade_update_false_DefaultPromptForContextCompressionID_cursor
    DEALLOCATE cascade_update_false_DefaultPromptForContextCompressionID_cursor
    
    -- Cascade update on AIConfiguration using cursor to call spUpdateMJAIConfiguration
    DECLARE @false_DefaultPromptForContextSummarizationIDID uniqueidentifier
    DECLARE @false_DefaultPromptForContextSummarizationID_Name nvarchar(100)
    DECLARE @false_DefaultPromptForContextSummarizationID_Description nvarchar(MAX)
    DECLARE @false_DefaultPromptForContextSummarizationID_IsDefault bit
    DECLARE @false_DefaultPromptForContextSummarizationID_Status nvarchar(20)
    DECLARE @false_DefaultPromptForContextSummarizationID_DefaultPromptForContextCompressionID uniqueidentifier
    DECLARE @false_DefaultPromptForContextSummarizationID_DefaultPromptForContextSummarizationID uniqueidentifier
    DECLARE @false_DefaultPromptForContextSummarizationID_DefaultStorageProviderID uniqueidentifier
    DECLARE @false_DefaultPromptForContextSummarizationID_DefaultStorageRootPath nvarchar(500)
    DECLARE @false_DefaultPromptForContextSummarizationID_ParentID uniqueidentifier
    DECLARE cascade_update_false_DefaultPromptForContextSummarizationID_cursor CURSOR FOR
        SELECT [ID], [Name], [Description], [IsDefault], [Status], [DefaultPromptForContextCompressionID], [DefaultPromptForContextSummarizationID], [DefaultStorageProviderID], [DefaultStorageRootPath], [ParentID]
        FROM [${flyway:defaultSchema}].[AIConfiguration]
        WHERE [DefaultPromptForContextSummarizationID] = @ID

    OPEN cascade_update_false_DefaultPromptForContextSummarizationID_cursor
    FETCH NEXT FROM cascade_update_false_DefaultPromptForContextSummarizationID_cursor INTO @false_DefaultPromptForContextSummarizationIDID, @false_DefaultPromptForContextSummarizationID_Name, @false_DefaultPromptForContextSummarizationID_Description, @false_DefaultPromptForContextSummarizationID_IsDefault, @false_DefaultPromptForContextSummarizationID_Status, @false_DefaultPromptForContextSummarizationID_DefaultPromptForContextCompressionID, @false_DefaultPromptForContextSummarizationID_DefaultPromptForContextSummarizationID, @false_DefaultPromptForContextSummarizationID_DefaultStorageProviderID, @false_DefaultPromptForContextSummarizationID_DefaultStorageRootPath, @false_DefaultPromptForContextSummarizationID_ParentID

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @false_DefaultPromptForContextSummarizationID_DefaultPromptForContextSummarizationID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateMJAIConfiguration] @ID = @false_DefaultPromptForContextSummarizationIDID, @Name = @false_DefaultPromptForContextSummarizationID_Name, @Description = @false_DefaultPromptForContextSummarizationID_Description, @IsDefault = @false_DefaultPromptForContextSummarizationID_IsDefault, @Status = @false_DefaultPromptForContextSummarizationID_Status, @DefaultPromptForContextCompressionID = @false_DefaultPromptForContextSummarizationID_DefaultPromptForContextCompressionID, @DefaultPromptForContextSummarizationID = @false_DefaultPromptForContextSummarizationID_DefaultPromptForContextSummarizationID, @DefaultStorageProviderID = @false_DefaultPromptForContextSummarizationID_DefaultStorageProviderID, @DefaultStorageRootPath = @false_DefaultPromptForContextSummarizationID_DefaultStorageRootPath, @ParentID = @false_DefaultPromptForContextSummarizationID_ParentID

        FETCH NEXT FROM cascade_update_false_DefaultPromptForContextSummarizationID_cursor INTO @false_DefaultPromptForContextSummarizationIDID, @false_DefaultPromptForContextSummarizationID_Name, @false_DefaultPromptForContextSummarizationID_Description, @false_DefaultPromptForContextSummarizationID_IsDefault, @false_DefaultPromptForContextSummarizationID_Status, @false_DefaultPromptForContextSummarizationID_DefaultPromptForContextCompressionID, @false_DefaultPromptForContextSummarizationID_DefaultPromptForContextSummarizationID, @false_DefaultPromptForContextSummarizationID_DefaultStorageProviderID, @false_DefaultPromptForContextSummarizationID_DefaultStorageRootPath, @false_DefaultPromptForContextSummarizationID_ParentID
    END

    CLOSE cascade_update_false_DefaultPromptForContextSummarizationID_cursor
    DEALLOCATE cascade_update_false_DefaultPromptForContextSummarizationID_cursor
    
    -- Cascade delete from AIPromptModel using cursor to call spDeleteMJAIPromptModel
    DECLARE @false_PromptIDID uniqueidentifier
    DECLARE cascade_delete_false_PromptID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[AIPromptModel]
        WHERE [PromptID] = @ID
    
    OPEN cascade_delete_false_PromptID_cursor
    FETCH NEXT FROM cascade_delete_false_PromptID_cursor INTO @false_PromptIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteMJAIPromptModel] @ID = @false_PromptIDID
        
        FETCH NEXT FROM cascade_delete_false_PromptID_cursor INTO @false_PromptIDID
    END
    
    CLOSE cascade_delete_false_PromptID_cursor
    DEALLOCATE cascade_delete_false_PromptID_cursor
    
    -- Cascade delete from AIPromptRun using cursor to call spDeleteMJAIPromptRun
    DECLARE @false_PromptIDID uniqueidentifier
    DECLARE cascade_delete_false_PromptID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[AIPromptRun]
        WHERE [PromptID] = @ID
    
    OPEN cascade_delete_false_PromptID_cursor
    FETCH NEXT FROM cascade_delete_false_PromptID_cursor INTO @false_PromptIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteMJAIPromptRun] @ID = @false_PromptIDID
        
        FETCH NEXT FROM cascade_delete_false_PromptID_cursor INTO @false_PromptIDID
    END
    
    CLOSE cascade_delete_false_PromptID_cursor
    DEALLOCATE cascade_delete_false_PromptID_cursor
    
    -- Cascade update on AIPromptRun using cursor to call spUpdateMJAIPromptRun
    DECLARE @false_JudgeIDID uniqueidentifier
    DECLARE @false_JudgeID_PromptID uniqueidentifier
    DECLARE @false_JudgeID_ModelID uniqueidentifier
    DECLARE @false_JudgeID_VendorID uniqueidentifier
    DECLARE @false_JudgeID_AgentID uniqueidentifier
    DECLARE @false_JudgeID_ConfigurationID uniqueidentifier
    DECLARE @false_JudgeID_RunAt datetimeoffset
    DECLARE @false_JudgeID_CompletedAt datetimeoffset
    DECLARE @false_JudgeID_ExecutionTimeMS int
    DECLARE @false_JudgeID_Messages nvarchar(MAX)
    DECLARE @false_JudgeID_Result nvarchar(MAX)
    DECLARE @false_JudgeID_TokensUsed int
    DECLARE @false_JudgeID_TokensPrompt int
    DECLARE @false_JudgeID_TokensCompletion int
    DECLARE @false_JudgeID_TotalCost decimal(18, 6)
    DECLARE @false_JudgeID_Success bit
    DECLARE @false_JudgeID_ErrorMessage nvarchar(MAX)
    DECLARE @false_JudgeID_ParentID uniqueidentifier
    DECLARE @false_JudgeID_RunType nvarchar(20)
    DECLARE @false_JudgeID_ExecutionOrder int
    DECLARE @false_JudgeID_AgentRunID uniqueidentifier
    DECLARE @false_JudgeID_Cost decimal(19, 8)
    DECLARE @false_JudgeID_CostCurrency nvarchar(10)
    DECLARE @false_JudgeID_TokensUsedRollup int
    DECLARE @false_JudgeID_TokensPromptRollup int
    DECLARE @false_JudgeID_TokensCompletionRollup int
    DECLARE @false_JudgeID_Temperature decimal(3, 2)
    DECLARE @false_JudgeID_TopP decimal(3, 2)
    DECLARE @false_JudgeID_TopK int
    DECLARE @false_JudgeID_MinP decimal(3, 2)
    DECLARE @false_JudgeID_FrequencyPenalty decimal(3, 2)
    DECLARE @false_JudgeID_PresencePenalty decimal(3, 2)
    DECLARE @false_JudgeID_Seed int
    DECLARE @false_JudgeID_StopSequences nvarchar(MAX)
    DECLARE @false_JudgeID_ResponseFormat nvarchar(50)
    DECLARE @false_JudgeID_LogProbs bit
    DECLARE @false_JudgeID_TopLogProbs int
    DECLARE @false_JudgeID_DescendantCost decimal(18, 6)
    DECLARE @false_JudgeID_ValidationAttemptCount int
    DECLARE @false_JudgeID_SuccessfulValidationCount int
    DECLARE @false_JudgeID_FinalValidationPassed bit
    DECLARE @false_JudgeID_ValidationBehavior nvarchar(50)
    DECLARE @false_JudgeID_RetryStrategy nvarchar(50)
    DECLARE @false_JudgeID_MaxRetriesConfigured int
    DECLARE @false_JudgeID_FinalValidationError nvarchar(500)
    DECLARE @false_JudgeID_ValidationErrorCount int
    DECLARE @false_JudgeID_CommonValidationError nvarchar(255)
    DECLARE @false_JudgeID_FirstAttemptAt datetimeoffset
    DECLARE @false_JudgeID_LastAttemptAt datetimeoffset
    DECLARE @false_JudgeID_TotalRetryDurationMS int
    DECLARE @false_JudgeID_ValidationAttempts nvarchar(MAX)
    DECLARE @false_JudgeID_ValidationSummary nvarchar(MAX)
    DECLARE @false_JudgeID_FailoverAttempts int
    DECLARE @false_JudgeID_FailoverErrors nvarchar(MAX)
    DECLARE @false_JudgeID_FailoverDurations nvarchar(MAX)
    DECLARE @false_JudgeID_OriginalModelID uniqueidentifier
    DECLARE @false_JudgeID_OriginalRequestStartTime datetimeoffset
    DECLARE @false_JudgeID_TotalFailoverDuration int
    DECLARE @false_JudgeID_RerunFromPromptRunID uniqueidentifier
    DECLARE @false_JudgeID_ModelSelection nvarchar(MAX)
    DECLARE @false_JudgeID_Status nvarchar(50)
    DECLARE @false_JudgeID_Cancelled bit
    DECLARE @false_JudgeID_CancellationReason nvarchar(MAX)
    DECLARE @false_JudgeID_ModelPowerRank int
    DECLARE @false_JudgeID_SelectionStrategy nvarchar(50)
    DECLARE @false_JudgeID_CacheHit bit
    DECLARE @false_JudgeID_CacheKey nvarchar(500)
    DECLARE @false_JudgeID_JudgeID uniqueidentifier
    DECLARE @false_JudgeID_JudgeScore float(53)
    DECLARE @false_JudgeID_WasSelectedResult bit
    DECLARE @false_JudgeID_StreamingEnabled bit
    DECLARE @false_JudgeID_FirstTokenTime int
    DECLARE @false_JudgeID_ErrorDetails nvarchar(MAX)
    DECLARE @false_JudgeID_ChildPromptID uniqueidentifier
    DECLARE @false_JudgeID_QueueTime int
    DECLARE @false_JudgeID_PromptTime int
    DECLARE @false_JudgeID_CompletionTime int
    DECLARE @false_JudgeID_ModelSpecificResponseDetails nvarchar(MAX)
    DECLARE @false_JudgeID_EffortLevel int
    DECLARE @false_JudgeID_RunName nvarchar(255)
    DECLARE @false_JudgeID_Comments nvarchar(MAX)
    DECLARE @false_JudgeID_TestRunID uniqueidentifier
    DECLARE cascade_update_false_JudgeID_cursor CURSOR FOR
        SELECT [ID], [PromptID], [ModelID], [VendorID], [AgentID], [ConfigurationID], [RunAt], [CompletedAt], [ExecutionTimeMS], [Messages], [Result], [TokensUsed], [TokensPrompt], [TokensCompletion], [TotalCost], [Success], [ErrorMessage], [ParentID], [RunType], [ExecutionOrder], [AgentRunID], [Cost], [CostCurrency], [TokensUsedRollup], [TokensPromptRollup], [TokensCompletionRollup], [Temperature], [TopP], [TopK], [MinP], [FrequencyPenalty], [PresencePenalty], [Seed], [StopSequences], [ResponseFormat], [LogProbs], [TopLogProbs], [DescendantCost], [ValidationAttemptCount], [SuccessfulValidationCount], [FinalValidationPassed], [ValidationBehavior], [RetryStrategy], [MaxRetriesConfigured], [FinalValidationError], [ValidationErrorCount], [CommonValidationError], [FirstAttemptAt], [LastAttemptAt], [TotalRetryDurationMS], [ValidationAttempts], [ValidationSummary], [FailoverAttempts], [FailoverErrors], [FailoverDurations], [OriginalModelID], [OriginalRequestStartTime], [TotalFailoverDuration], [RerunFromPromptRunID], [ModelSelection], [Status], [Cancelled], [CancellationReason], [ModelPowerRank], [SelectionStrategy], [CacheHit], [CacheKey], [JudgeID], [JudgeScore], [WasSelectedResult], [StreamingEnabled], [FirstTokenTime], [ErrorDetails], [ChildPromptID], [QueueTime], [PromptTime], [CompletionTime], [ModelSpecificResponseDetails], [EffortLevel], [RunName], [Comments], [TestRunID]
        FROM [${flyway:defaultSchema}].[AIPromptRun]
        WHERE [JudgeID] = @ID

    OPEN cascade_update_false_JudgeID_cursor
    FETCH NEXT FROM cascade_update_false_JudgeID_cursor INTO @false_JudgeIDID, @false_JudgeID_PromptID, @false_JudgeID_ModelID, @false_JudgeID_VendorID, @false_JudgeID_AgentID, @false_JudgeID_ConfigurationID, @false_JudgeID_RunAt, @false_JudgeID_CompletedAt, @false_JudgeID_ExecutionTimeMS, @false_JudgeID_Messages, @false_JudgeID_Result, @false_JudgeID_TokensUsed, @false_JudgeID_TokensPrompt, @false_JudgeID_TokensCompletion, @false_JudgeID_TotalCost, @false_JudgeID_Success, @false_JudgeID_ErrorMessage, @false_JudgeID_ParentID, @false_JudgeID_RunType, @false_JudgeID_ExecutionOrder, @false_JudgeID_AgentRunID, @false_JudgeID_Cost, @false_JudgeID_CostCurrency, @false_JudgeID_TokensUsedRollup, @false_JudgeID_TokensPromptRollup, @false_JudgeID_TokensCompletionRollup, @false_JudgeID_Temperature, @false_JudgeID_TopP, @false_JudgeID_TopK, @false_JudgeID_MinP, @false_JudgeID_FrequencyPenalty, @false_JudgeID_PresencePenalty, @false_JudgeID_Seed, @false_JudgeID_StopSequences, @false_JudgeID_ResponseFormat, @false_JudgeID_LogProbs, @false_JudgeID_TopLogProbs, @false_JudgeID_DescendantCost, @false_JudgeID_ValidationAttemptCount, @false_JudgeID_SuccessfulValidationCount, @false_JudgeID_FinalValidationPassed, @false_JudgeID_ValidationBehavior, @false_JudgeID_RetryStrategy, @false_JudgeID_MaxRetriesConfigured, @false_JudgeID_FinalValidationError, @false_JudgeID_ValidationErrorCount, @false_JudgeID_CommonValidationError, @false_JudgeID_FirstAttemptAt, @false_JudgeID_LastAttemptAt, @false_JudgeID_TotalRetryDurationMS, @false_JudgeID_ValidationAttempts, @false_JudgeID_ValidationSummary, @false_JudgeID_FailoverAttempts, @false_JudgeID_FailoverErrors, @false_JudgeID_FailoverDurations, @false_JudgeID_OriginalModelID, @false_JudgeID_OriginalRequestStartTime, @false_JudgeID_TotalFailoverDuration, @false_JudgeID_RerunFromPromptRunID, @false_JudgeID_ModelSelection, @false_JudgeID_Status, @false_JudgeID_Cancelled, @false_JudgeID_CancellationReason, @false_JudgeID_ModelPowerRank, @false_JudgeID_SelectionStrategy, @false_JudgeID_CacheHit, @false_JudgeID_CacheKey, @false_JudgeID_JudgeID, @false_JudgeID_JudgeScore, @false_JudgeID_WasSelectedResult, @false_JudgeID_StreamingEnabled, @false_JudgeID_FirstTokenTime, @false_JudgeID_ErrorDetails, @false_JudgeID_ChildPromptID, @false_JudgeID_QueueTime, @false_JudgeID_PromptTime, @false_JudgeID_CompletionTime, @false_JudgeID_ModelSpecificResponseDetails, @false_JudgeID_EffortLevel, @false_JudgeID_RunName, @false_JudgeID_Comments, @false_JudgeID_TestRunID

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @false_JudgeID_JudgeID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateMJAIPromptRun] @ID = @false_JudgeIDID, @PromptID = @false_JudgeID_PromptID, @ModelID = @false_JudgeID_ModelID, @VendorID = @false_JudgeID_VendorID, @AgentID = @false_JudgeID_AgentID, @ConfigurationID = @false_JudgeID_ConfigurationID, @RunAt = @false_JudgeID_RunAt, @CompletedAt = @false_JudgeID_CompletedAt, @ExecutionTimeMS = @false_JudgeID_ExecutionTimeMS, @Messages = @false_JudgeID_Messages, @Result = @false_JudgeID_Result, @TokensUsed = @false_JudgeID_TokensUsed, @TokensPrompt = @false_JudgeID_TokensPrompt, @TokensCompletion = @false_JudgeID_TokensCompletion, @TotalCost = @false_JudgeID_TotalCost, @Success = @false_JudgeID_Success, @ErrorMessage = @false_JudgeID_ErrorMessage, @ParentID = @false_JudgeID_ParentID, @RunType = @false_JudgeID_RunType, @ExecutionOrder = @false_JudgeID_ExecutionOrder, @AgentRunID = @false_JudgeID_AgentRunID, @Cost = @false_JudgeID_Cost, @CostCurrency = @false_JudgeID_CostCurrency, @TokensUsedRollup = @false_JudgeID_TokensUsedRollup, @TokensPromptRollup = @false_JudgeID_TokensPromptRollup, @TokensCompletionRollup = @false_JudgeID_TokensCompletionRollup, @Temperature = @false_JudgeID_Temperature, @TopP = @false_JudgeID_TopP, @TopK = @false_JudgeID_TopK, @MinP = @false_JudgeID_MinP, @FrequencyPenalty = @false_JudgeID_FrequencyPenalty, @PresencePenalty = @false_JudgeID_PresencePenalty, @Seed = @false_JudgeID_Seed, @StopSequences = @false_JudgeID_StopSequences, @ResponseFormat = @false_JudgeID_ResponseFormat, @LogProbs = @false_JudgeID_LogProbs, @TopLogProbs = @false_JudgeID_TopLogProbs, @DescendantCost = @false_JudgeID_DescendantCost, @ValidationAttemptCount = @false_JudgeID_ValidationAttemptCount, @SuccessfulValidationCount = @false_JudgeID_SuccessfulValidationCount, @FinalValidationPassed = @false_JudgeID_FinalValidationPassed, @ValidationBehavior = @false_JudgeID_ValidationBehavior, @RetryStrategy = @false_JudgeID_RetryStrategy, @MaxRetriesConfigured = @false_JudgeID_MaxRetriesConfigured, @FinalValidationError = @false_JudgeID_FinalValidationError, @ValidationErrorCount = @false_JudgeID_ValidationErrorCount, @CommonValidationError = @false_JudgeID_CommonValidationError, @FirstAttemptAt = @false_JudgeID_FirstAttemptAt, @LastAttemptAt = @false_JudgeID_LastAttemptAt, @TotalRetryDurationMS = @false_JudgeID_TotalRetryDurationMS, @ValidationAttempts = @false_JudgeID_ValidationAttempts, @ValidationSummary = @false_JudgeID_ValidationSummary, @FailoverAttempts = @false_JudgeID_FailoverAttempts, @FailoverErrors = @false_JudgeID_FailoverErrors, @FailoverDurations = @false_JudgeID_FailoverDurations, @OriginalModelID = @false_JudgeID_OriginalModelID, @OriginalRequestStartTime = @false_JudgeID_OriginalRequestStartTime, @TotalFailoverDuration = @false_JudgeID_TotalFailoverDuration, @RerunFromPromptRunID = @false_JudgeID_RerunFromPromptRunID, @ModelSelection = @false_JudgeID_ModelSelection, @Status = @false_JudgeID_Status, @Cancelled = @false_JudgeID_Cancelled, @CancellationReason = @false_JudgeID_CancellationReason, @ModelPowerRank = @false_JudgeID_ModelPowerRank, @SelectionStrategy = @false_JudgeID_SelectionStrategy, @CacheHit = @false_JudgeID_CacheHit, @CacheKey = @false_JudgeID_CacheKey, @JudgeID = @false_JudgeID_JudgeID, @JudgeScore = @false_JudgeID_JudgeScore, @WasSelectedResult = @false_JudgeID_WasSelectedResult, @StreamingEnabled = @false_JudgeID_StreamingEnabled, @FirstTokenTime = @false_JudgeID_FirstTokenTime, @ErrorDetails = @false_JudgeID_ErrorDetails, @ChildPromptID = @false_JudgeID_ChildPromptID, @QueueTime = @false_JudgeID_QueueTime, @PromptTime = @false_JudgeID_PromptTime, @CompletionTime = @false_JudgeID_CompletionTime, @ModelSpecificResponseDetails = @false_JudgeID_ModelSpecificResponseDetails, @EffortLevel = @false_JudgeID_EffortLevel, @RunName = @false_JudgeID_RunName, @Comments = @false_JudgeID_Comments, @TestRunID = @false_JudgeID_TestRunID

        FETCH NEXT FROM cascade_update_false_JudgeID_cursor INTO @false_JudgeIDID, @false_JudgeID_PromptID, @false_JudgeID_ModelID, @false_JudgeID_VendorID, @false_JudgeID_AgentID, @false_JudgeID_ConfigurationID, @false_JudgeID_RunAt, @false_JudgeID_CompletedAt, @false_JudgeID_ExecutionTimeMS, @false_JudgeID_Messages, @false_JudgeID_Result, @false_JudgeID_TokensUsed, @false_JudgeID_TokensPrompt, @false_JudgeID_TokensCompletion, @false_JudgeID_TotalCost, @false_JudgeID_Success, @false_JudgeID_ErrorMessage, @false_JudgeID_ParentID, @false_JudgeID_RunType, @false_JudgeID_ExecutionOrder, @false_JudgeID_AgentRunID, @false_JudgeID_Cost, @false_JudgeID_CostCurrency, @false_JudgeID_TokensUsedRollup, @false_JudgeID_TokensPromptRollup, @false_JudgeID_TokensCompletionRollup, @false_JudgeID_Temperature, @false_JudgeID_TopP, @false_JudgeID_TopK, @false_JudgeID_MinP, @false_JudgeID_FrequencyPenalty, @false_JudgeID_PresencePenalty, @false_JudgeID_Seed, @false_JudgeID_StopSequences, @false_JudgeID_ResponseFormat, @false_JudgeID_LogProbs, @false_JudgeID_TopLogProbs, @false_JudgeID_DescendantCost, @false_JudgeID_ValidationAttemptCount, @false_JudgeID_SuccessfulValidationCount, @false_JudgeID_FinalValidationPassed, @false_JudgeID_ValidationBehavior, @false_JudgeID_RetryStrategy, @false_JudgeID_MaxRetriesConfigured, @false_JudgeID_FinalValidationError, @false_JudgeID_ValidationErrorCount, @false_JudgeID_CommonValidationError, @false_JudgeID_FirstAttemptAt, @false_JudgeID_LastAttemptAt, @false_JudgeID_TotalRetryDurationMS, @false_JudgeID_ValidationAttempts, @false_JudgeID_ValidationSummary, @false_JudgeID_FailoverAttempts, @false_JudgeID_FailoverErrors, @false_JudgeID_FailoverDurations, @false_JudgeID_OriginalModelID, @false_JudgeID_OriginalRequestStartTime, @false_JudgeID_TotalFailoverDuration, @false_JudgeID_RerunFromPromptRunID, @false_JudgeID_ModelSelection, @false_JudgeID_Status, @false_JudgeID_Cancelled, @false_JudgeID_CancellationReason, @false_JudgeID_ModelPowerRank, @false_JudgeID_SelectionStrategy, @false_JudgeID_CacheHit, @false_JudgeID_CacheKey, @false_JudgeID_JudgeID, @false_JudgeID_JudgeScore, @false_JudgeID_WasSelectedResult, @false_JudgeID_StreamingEnabled, @false_JudgeID_FirstTokenTime, @false_JudgeID_ErrorDetails, @false_JudgeID_ChildPromptID, @false_JudgeID_QueueTime, @false_JudgeID_PromptTime, @false_JudgeID_CompletionTime, @false_JudgeID_ModelSpecificResponseDetails, @false_JudgeID_EffortLevel, @false_JudgeID_RunName, @false_JudgeID_Comments, @false_JudgeID_TestRunID
    END

    CLOSE cascade_update_false_JudgeID_cursor
    DEALLOCATE cascade_update_false_JudgeID_cursor
    
    -- Cascade update on AIPromptRun using cursor to call spUpdateMJAIPromptRun
    DECLARE @false_ChildPromptIDID uniqueidentifier
    DECLARE @false_ChildPromptID_PromptID uniqueidentifier
    DECLARE @false_ChildPromptID_ModelID uniqueidentifier
    DECLARE @false_ChildPromptID_VendorID uniqueidentifier
    DECLARE @false_ChildPromptID_AgentID uniqueidentifier
    DECLARE @false_ChildPromptID_ConfigurationID uniqueidentifier
    DECLARE @false_ChildPromptID_RunAt datetimeoffset
    DECLARE @false_ChildPromptID_CompletedAt datetimeoffset
    DECLARE @false_ChildPromptID_ExecutionTimeMS int
    DECLARE @false_ChildPromptID_Messages nvarchar(MAX)
    DECLARE @false_ChildPromptID_Result nvarchar(MAX)
    DECLARE @false_ChildPromptID_TokensUsed int
    DECLARE @false_ChildPromptID_TokensPrompt int
    DECLARE @false_ChildPromptID_TokensCompletion int
    DECLARE @false_ChildPromptID_TotalCost decimal(18, 6)
    DECLARE @false_ChildPromptID_Success bit
    DECLARE @false_ChildPromptID_ErrorMessage nvarchar(MAX)
    DECLARE @false_ChildPromptID_ParentID uniqueidentifier
    DECLARE @false_ChildPromptID_RunType nvarchar(20)
    DECLARE @false_ChildPromptID_ExecutionOrder int
    DECLARE @false_ChildPromptID_AgentRunID uniqueidentifier
    DECLARE @false_ChildPromptID_Cost decimal(19, 8)
    DECLARE @false_ChildPromptID_CostCurrency nvarchar(10)
    DECLARE @false_ChildPromptID_TokensUsedRollup int
    DECLARE @false_ChildPromptID_TokensPromptRollup int
    DECLARE @false_ChildPromptID_TokensCompletionRollup int
    DECLARE @false_ChildPromptID_Temperature decimal(3, 2)
    DECLARE @false_ChildPromptID_TopP decimal(3, 2)
    DECLARE @false_ChildPromptID_TopK int
    DECLARE @false_ChildPromptID_MinP decimal(3, 2)
    DECLARE @false_ChildPromptID_FrequencyPenalty decimal(3, 2)
    DECLARE @false_ChildPromptID_PresencePenalty decimal(3, 2)
    DECLARE @false_ChildPromptID_Seed int
    DECLARE @false_ChildPromptID_StopSequences nvarchar(MAX)
    DECLARE @false_ChildPromptID_ResponseFormat nvarchar(50)
    DECLARE @false_ChildPromptID_LogProbs bit
    DECLARE @false_ChildPromptID_TopLogProbs int
    DECLARE @false_ChildPromptID_DescendantCost decimal(18, 6)
    DECLARE @false_ChildPromptID_ValidationAttemptCount int
    DECLARE @false_ChildPromptID_SuccessfulValidationCount int
    DECLARE @false_ChildPromptID_FinalValidationPassed bit
    DECLARE @false_ChildPromptID_ValidationBehavior nvarchar(50)
    DECLARE @false_ChildPromptID_RetryStrategy nvarchar(50)
    DECLARE @false_ChildPromptID_MaxRetriesConfigured int
    DECLARE @false_ChildPromptID_FinalValidationError nvarchar(500)
    DECLARE @false_ChildPromptID_ValidationErrorCount int
    DECLARE @false_ChildPromptID_CommonValidationError nvarchar(255)
    DECLARE @false_ChildPromptID_FirstAttemptAt datetimeoffset
    DECLARE @false_ChildPromptID_LastAttemptAt datetimeoffset
    DECLARE @false_ChildPromptID_TotalRetryDurationMS int
    DECLARE @false_ChildPromptID_ValidationAttempts nvarchar(MAX)
    DECLARE @false_ChildPromptID_ValidationSummary nvarchar(MAX)
    DECLARE @false_ChildPromptID_FailoverAttempts int
    DECLARE @false_ChildPromptID_FailoverErrors nvarchar(MAX)
    DECLARE @false_ChildPromptID_FailoverDurations nvarchar(MAX)
    DECLARE @false_ChildPromptID_OriginalModelID uniqueidentifier
    DECLARE @false_ChildPromptID_OriginalRequestStartTime datetimeoffset
    DECLARE @false_ChildPromptID_TotalFailoverDuration int
    DECLARE @false_ChildPromptID_RerunFromPromptRunID uniqueidentifier
    DECLARE @false_ChildPromptID_ModelSelection nvarchar(MAX)
    DECLARE @false_ChildPromptID_Status nvarchar(50)
    DECLARE @false_ChildPromptID_Cancelled bit
    DECLARE @false_ChildPromptID_CancellationReason nvarchar(MAX)
    DECLARE @false_ChildPromptID_ModelPowerRank int
    DECLARE @false_ChildPromptID_SelectionStrategy nvarchar(50)
    DECLARE @false_ChildPromptID_CacheHit bit
    DECLARE @false_ChildPromptID_CacheKey nvarchar(500)
    DECLARE @false_ChildPromptID_JudgeID uniqueidentifier
    DECLARE @false_ChildPromptID_JudgeScore float(53)
    DECLARE @false_ChildPromptID_WasSelectedResult bit
    DECLARE @false_ChildPromptID_StreamingEnabled bit
    DECLARE @false_ChildPromptID_FirstTokenTime int
    DECLARE @false_ChildPromptID_ErrorDetails nvarchar(MAX)
    DECLARE @false_ChildPromptID_ChildPromptID uniqueidentifier
    DECLARE @false_ChildPromptID_QueueTime int
    DECLARE @false_ChildPromptID_PromptTime int
    DECLARE @false_ChildPromptID_CompletionTime int
    DECLARE @false_ChildPromptID_ModelSpecificResponseDetails nvarchar(MAX)
    DECLARE @false_ChildPromptID_EffortLevel int
    DECLARE @false_ChildPromptID_RunName nvarchar(255)
    DECLARE @false_ChildPromptID_Comments nvarchar(MAX)
    DECLARE @false_ChildPromptID_TestRunID uniqueidentifier
    DECLARE cascade_update_false_ChildPromptID_cursor CURSOR FOR
        SELECT [ID], [PromptID], [ModelID], [VendorID], [AgentID], [ConfigurationID], [RunAt], [CompletedAt], [ExecutionTimeMS], [Messages], [Result], [TokensUsed], [TokensPrompt], [TokensCompletion], [TotalCost], [Success], [ErrorMessage], [ParentID], [RunType], [ExecutionOrder], [AgentRunID], [Cost], [CostCurrency], [TokensUsedRollup], [TokensPromptRollup], [TokensCompletionRollup], [Temperature], [TopP], [TopK], [MinP], [FrequencyPenalty], [PresencePenalty], [Seed], [StopSequences], [ResponseFormat], [LogProbs], [TopLogProbs], [DescendantCost], [ValidationAttemptCount], [SuccessfulValidationCount], [FinalValidationPassed], [ValidationBehavior], [RetryStrategy], [MaxRetriesConfigured], [FinalValidationError], [ValidationErrorCount], [CommonValidationError], [FirstAttemptAt], [LastAttemptAt], [TotalRetryDurationMS], [ValidationAttempts], [ValidationSummary], [FailoverAttempts], [FailoverErrors], [FailoverDurations], [OriginalModelID], [OriginalRequestStartTime], [TotalFailoverDuration], [RerunFromPromptRunID], [ModelSelection], [Status], [Cancelled], [CancellationReason], [ModelPowerRank], [SelectionStrategy], [CacheHit], [CacheKey], [JudgeID], [JudgeScore], [WasSelectedResult], [StreamingEnabled], [FirstTokenTime], [ErrorDetails], [ChildPromptID], [QueueTime], [PromptTime], [CompletionTime], [ModelSpecificResponseDetails], [EffortLevel], [RunName], [Comments], [TestRunID]
        FROM [${flyway:defaultSchema}].[AIPromptRun]
        WHERE [ChildPromptID] = @ID

    OPEN cascade_update_false_ChildPromptID_cursor
    FETCH NEXT FROM cascade_update_false_ChildPromptID_cursor INTO @false_ChildPromptIDID, @false_ChildPromptID_PromptID, @false_ChildPromptID_ModelID, @false_ChildPromptID_VendorID, @false_ChildPromptID_AgentID, @false_ChildPromptID_ConfigurationID, @false_ChildPromptID_RunAt, @false_ChildPromptID_CompletedAt, @false_ChildPromptID_ExecutionTimeMS, @false_ChildPromptID_Messages, @false_ChildPromptID_Result, @false_ChildPromptID_TokensUsed, @false_ChildPromptID_TokensPrompt, @false_ChildPromptID_TokensCompletion, @false_ChildPromptID_TotalCost, @false_ChildPromptID_Success, @false_ChildPromptID_ErrorMessage, @false_ChildPromptID_ParentID, @false_ChildPromptID_RunType, @false_ChildPromptID_ExecutionOrder, @false_ChildPromptID_AgentRunID, @false_ChildPromptID_Cost, @false_ChildPromptID_CostCurrency, @false_ChildPromptID_TokensUsedRollup, @false_ChildPromptID_TokensPromptRollup, @false_ChildPromptID_TokensCompletionRollup, @false_ChildPromptID_Temperature, @false_ChildPromptID_TopP, @false_ChildPromptID_TopK, @false_ChildPromptID_MinP, @false_ChildPromptID_FrequencyPenalty, @false_ChildPromptID_PresencePenalty, @false_ChildPromptID_Seed, @false_ChildPromptID_StopSequences, @false_ChildPromptID_ResponseFormat, @false_ChildPromptID_LogProbs, @false_ChildPromptID_TopLogProbs, @false_ChildPromptID_DescendantCost, @false_ChildPromptID_ValidationAttemptCount, @false_ChildPromptID_SuccessfulValidationCount, @false_ChildPromptID_FinalValidationPassed, @false_ChildPromptID_ValidationBehavior, @false_ChildPromptID_RetryStrategy, @false_ChildPromptID_MaxRetriesConfigured, @false_ChildPromptID_FinalValidationError, @false_ChildPromptID_ValidationErrorCount, @false_ChildPromptID_CommonValidationError, @false_ChildPromptID_FirstAttemptAt, @false_ChildPromptID_LastAttemptAt, @false_ChildPromptID_TotalRetryDurationMS, @false_ChildPromptID_ValidationAttempts, @false_ChildPromptID_ValidationSummary, @false_ChildPromptID_FailoverAttempts, @false_ChildPromptID_FailoverErrors, @false_ChildPromptID_FailoverDurations, @false_ChildPromptID_OriginalModelID, @false_ChildPromptID_OriginalRequestStartTime, @false_ChildPromptID_TotalFailoverDuration, @false_ChildPromptID_RerunFromPromptRunID, @false_ChildPromptID_ModelSelection, @false_ChildPromptID_Status, @false_ChildPromptID_Cancelled, @false_ChildPromptID_CancellationReason, @false_ChildPromptID_ModelPowerRank, @false_ChildPromptID_SelectionStrategy, @false_ChildPromptID_CacheHit, @false_ChildPromptID_CacheKey, @false_ChildPromptID_JudgeID, @false_ChildPromptID_JudgeScore, @false_ChildPromptID_WasSelectedResult, @false_ChildPromptID_StreamingEnabled, @false_ChildPromptID_FirstTokenTime, @false_ChildPromptID_ErrorDetails, @false_ChildPromptID_ChildPromptID, @false_ChildPromptID_QueueTime, @false_ChildPromptID_PromptTime, @false_ChildPromptID_CompletionTime, @false_ChildPromptID_ModelSpecificResponseDetails, @false_ChildPromptID_EffortLevel, @false_ChildPromptID_RunName, @false_ChildPromptID_Comments, @false_ChildPromptID_TestRunID

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @false_ChildPromptID_ChildPromptID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateMJAIPromptRun] @ID = @false_ChildPromptIDID, @PromptID = @false_ChildPromptID_PromptID, @ModelID = @false_ChildPromptID_ModelID, @VendorID = @false_ChildPromptID_VendorID, @AgentID = @false_ChildPromptID_AgentID, @ConfigurationID = @false_ChildPromptID_ConfigurationID, @RunAt = @false_ChildPromptID_RunAt, @CompletedAt = @false_ChildPromptID_CompletedAt, @ExecutionTimeMS = @false_ChildPromptID_ExecutionTimeMS, @Messages = @false_ChildPromptID_Messages, @Result = @false_ChildPromptID_Result, @TokensUsed = @false_ChildPromptID_TokensUsed, @TokensPrompt = @false_ChildPromptID_TokensPrompt, @TokensCompletion = @false_ChildPromptID_TokensCompletion, @TotalCost = @false_ChildPromptID_TotalCost, @Success = @false_ChildPromptID_Success, @ErrorMessage = @false_ChildPromptID_ErrorMessage, @ParentID = @false_ChildPromptID_ParentID, @RunType = @false_ChildPromptID_RunType, @ExecutionOrder = @false_ChildPromptID_ExecutionOrder, @AgentRunID = @false_ChildPromptID_AgentRunID, @Cost = @false_ChildPromptID_Cost, @CostCurrency = @false_ChildPromptID_CostCurrency, @TokensUsedRollup = @false_ChildPromptID_TokensUsedRollup, @TokensPromptRollup = @false_ChildPromptID_TokensPromptRollup, @TokensCompletionRollup = @false_ChildPromptID_TokensCompletionRollup, @Temperature = @false_ChildPromptID_Temperature, @TopP = @false_ChildPromptID_TopP, @TopK = @false_ChildPromptID_TopK, @MinP = @false_ChildPromptID_MinP, @FrequencyPenalty = @false_ChildPromptID_FrequencyPenalty, @PresencePenalty = @false_ChildPromptID_PresencePenalty, @Seed = @false_ChildPromptID_Seed, @StopSequences = @false_ChildPromptID_StopSequences, @ResponseFormat = @false_ChildPromptID_ResponseFormat, @LogProbs = @false_ChildPromptID_LogProbs, @TopLogProbs = @false_ChildPromptID_TopLogProbs, @DescendantCost = @false_ChildPromptID_DescendantCost, @ValidationAttemptCount = @false_ChildPromptID_ValidationAttemptCount, @SuccessfulValidationCount = @false_ChildPromptID_SuccessfulValidationCount, @FinalValidationPassed = @false_ChildPromptID_FinalValidationPassed, @ValidationBehavior = @false_ChildPromptID_ValidationBehavior, @RetryStrategy = @false_ChildPromptID_RetryStrategy, @MaxRetriesConfigured = @false_ChildPromptID_MaxRetriesConfigured, @FinalValidationError = @false_ChildPromptID_FinalValidationError, @ValidationErrorCount = @false_ChildPromptID_ValidationErrorCount, @CommonValidationError = @false_ChildPromptID_CommonValidationError, @FirstAttemptAt = @false_ChildPromptID_FirstAttemptAt, @LastAttemptAt = @false_ChildPromptID_LastAttemptAt, @TotalRetryDurationMS = @false_ChildPromptID_TotalRetryDurationMS, @ValidationAttempts = @false_ChildPromptID_ValidationAttempts, @ValidationSummary = @false_ChildPromptID_ValidationSummary, @FailoverAttempts = @false_ChildPromptID_FailoverAttempts, @FailoverErrors = @false_ChildPromptID_FailoverErrors, @FailoverDurations = @false_ChildPromptID_FailoverDurations, @OriginalModelID = @false_ChildPromptID_OriginalModelID, @OriginalRequestStartTime = @false_ChildPromptID_OriginalRequestStartTime, @TotalFailoverDuration = @false_ChildPromptID_TotalFailoverDuration, @RerunFromPromptRunID = @false_ChildPromptID_RerunFromPromptRunID, @ModelSelection = @false_ChildPromptID_ModelSelection, @Status = @false_ChildPromptID_Status, @Cancelled = @false_ChildPromptID_Cancelled, @CancellationReason = @false_ChildPromptID_CancellationReason, @ModelPowerRank = @false_ChildPromptID_ModelPowerRank, @SelectionStrategy = @false_ChildPromptID_SelectionStrategy, @CacheHit = @false_ChildPromptID_CacheHit, @CacheKey = @false_ChildPromptID_CacheKey, @JudgeID = @false_ChildPromptID_JudgeID, @JudgeScore = @false_ChildPromptID_JudgeScore, @WasSelectedResult = @false_ChildPromptID_WasSelectedResult, @StreamingEnabled = @false_ChildPromptID_StreamingEnabled, @FirstTokenTime = @false_ChildPromptID_FirstTokenTime, @ErrorDetails = @false_ChildPromptID_ErrorDetails, @ChildPromptID = @false_ChildPromptID_ChildPromptID, @QueueTime = @false_ChildPromptID_QueueTime, @PromptTime = @false_ChildPromptID_PromptTime, @CompletionTime = @false_ChildPromptID_CompletionTime, @ModelSpecificResponseDetails = @false_ChildPromptID_ModelSpecificResponseDetails, @EffortLevel = @false_ChildPromptID_EffortLevel, @RunName = @false_ChildPromptID_RunName, @Comments = @false_ChildPromptID_Comments, @TestRunID = @false_ChildPromptID_TestRunID

        FETCH NEXT FROM cascade_update_false_ChildPromptID_cursor INTO @false_ChildPromptIDID, @false_ChildPromptID_PromptID, @false_ChildPromptID_ModelID, @false_ChildPromptID_VendorID, @false_ChildPromptID_AgentID, @false_ChildPromptID_ConfigurationID, @false_ChildPromptID_RunAt, @false_ChildPromptID_CompletedAt, @false_ChildPromptID_ExecutionTimeMS, @false_ChildPromptID_Messages, @false_ChildPromptID_Result, @false_ChildPromptID_TokensUsed, @false_ChildPromptID_TokensPrompt, @false_ChildPromptID_TokensCompletion, @false_ChildPromptID_TotalCost, @false_ChildPromptID_Success, @false_ChildPromptID_ErrorMessage, @false_ChildPromptID_ParentID, @false_ChildPromptID_RunType, @false_ChildPromptID_ExecutionOrder, @false_ChildPromptID_AgentRunID, @false_ChildPromptID_Cost, @false_ChildPromptID_CostCurrency, @false_ChildPromptID_TokensUsedRollup, @false_ChildPromptID_TokensPromptRollup, @false_ChildPromptID_TokensCompletionRollup, @false_ChildPromptID_Temperature, @false_ChildPromptID_TopP, @false_ChildPromptID_TopK, @false_ChildPromptID_MinP, @false_ChildPromptID_FrequencyPenalty, @false_ChildPromptID_PresencePenalty, @false_ChildPromptID_Seed, @false_ChildPromptID_StopSequences, @false_ChildPromptID_ResponseFormat, @false_ChildPromptID_LogProbs, @false_ChildPromptID_TopLogProbs, @false_ChildPromptID_DescendantCost, @false_ChildPromptID_ValidationAttemptCount, @false_ChildPromptID_SuccessfulValidationCount, @false_ChildPromptID_FinalValidationPassed, @false_ChildPromptID_ValidationBehavior, @false_ChildPromptID_RetryStrategy, @false_ChildPromptID_MaxRetriesConfigured, @false_ChildPromptID_FinalValidationError, @false_ChildPromptID_ValidationErrorCount, @false_ChildPromptID_CommonValidationError, @false_ChildPromptID_FirstAttemptAt, @false_ChildPromptID_LastAttemptAt, @false_ChildPromptID_TotalRetryDurationMS, @false_ChildPromptID_ValidationAttempts, @false_ChildPromptID_ValidationSummary, @false_ChildPromptID_FailoverAttempts, @false_ChildPromptID_FailoverErrors, @false_ChildPromptID_FailoverDurations, @false_ChildPromptID_OriginalModelID, @false_ChildPromptID_OriginalRequestStartTime, @false_ChildPromptID_TotalFailoverDuration, @false_ChildPromptID_RerunFromPromptRunID, @false_ChildPromptID_ModelSelection, @false_ChildPromptID_Status, @false_ChildPromptID_Cancelled, @false_ChildPromptID_CancellationReason, @false_ChildPromptID_ModelPowerRank, @false_ChildPromptID_SelectionStrategy, @false_ChildPromptID_CacheHit, @false_ChildPromptID_CacheKey, @false_ChildPromptID_JudgeID, @false_ChildPromptID_JudgeScore, @false_ChildPromptID_WasSelectedResult, @false_ChildPromptID_StreamingEnabled, @false_ChildPromptID_FirstTokenTime, @false_ChildPromptID_ErrorDetails, @false_ChildPromptID_ChildPromptID, @false_ChildPromptID_QueueTime, @false_ChildPromptID_PromptTime, @false_ChildPromptID_CompletionTime, @false_ChildPromptID_ModelSpecificResponseDetails, @false_ChildPromptID_EffortLevel, @false_ChildPromptID_RunName, @false_ChildPromptID_Comments, @false_ChildPromptID_TestRunID
    END

    CLOSE cascade_update_false_ChildPromptID_cursor
    DEALLOCATE cascade_update_false_ChildPromptID_cursor
    
    -- Cascade update on AIPrompt using cursor to call spUpdateMJAIPrompt
    DECLARE @false_ResultSelectorPromptIDID uniqueidentifier
    DECLARE @false_ResultSelectorPromptID_Name nvarchar(255)
    DECLARE @false_ResultSelectorPromptID_Description nvarchar(MAX)
    DECLARE @false_ResultSelectorPromptID_TemplateID uniqueidentifier
    DECLARE @false_ResultSelectorPromptID_CategoryID uniqueidentifier
    DECLARE @false_ResultSelectorPromptID_TypeID uniqueidentifier
    DECLARE @false_ResultSelectorPromptID_Status nvarchar(50)
    DECLARE @false_ResultSelectorPromptID_ResponseFormat nvarchar(20)
    DECLARE @false_ResultSelectorPromptID_ModelSpecificResponseFormat nvarchar(MAX)
    DECLARE @false_ResultSelectorPromptID_AIModelTypeID uniqueidentifier
    DECLARE @false_ResultSelectorPromptID_MinPowerRank int
    DECLARE @false_ResultSelectorPromptID_SelectionStrategy nvarchar(20)
    DECLARE @false_ResultSelectorPromptID_PowerPreference nvarchar(20)
    DECLARE @false_ResultSelectorPromptID_ParallelizationMode nvarchar(20)
    DECLARE @false_ResultSelectorPromptID_ParallelCount int
    DECLARE @false_ResultSelectorPromptID_ParallelConfigParam nvarchar(100)
    DECLARE @false_ResultSelectorPromptID_OutputType nvarchar(50)
    DECLARE @false_ResultSelectorPromptID_OutputExample nvarchar(MAX)
    DECLARE @false_ResultSelectorPromptID_ValidationBehavior nvarchar(50)
    DECLARE @false_ResultSelectorPromptID_MaxRetries int
    DECLARE @false_ResultSelectorPromptID_RetryDelayMS int
    DECLARE @false_ResultSelectorPromptID_RetryStrategy nvarchar(20)
    DECLARE @false_ResultSelectorPromptID_ResultSelectorPromptID uniqueidentifier
    DECLARE @false_ResultSelectorPromptID_EnableCaching bit
    DECLARE @false_ResultSelectorPromptID_CacheTTLSeconds int
    DECLARE @false_ResultSelectorPromptID_CacheMatchType nvarchar(20)
    DECLARE @false_ResultSelectorPromptID_CacheSimilarityThreshold float(53)
    DECLARE @false_ResultSelectorPromptID_CacheMustMatchModel bit
    DECLARE @false_ResultSelectorPromptID_CacheMustMatchVendor bit
    DECLARE @false_ResultSelectorPromptID_CacheMustMatchAgent bit
    DECLARE @false_ResultSelectorPromptID_CacheMustMatchConfig bit
    DECLARE @false_ResultSelectorPromptID_PromptRole nvarchar(20)
    DECLARE @false_ResultSelectorPromptID_PromptPosition nvarchar(20)
    DECLARE @false_ResultSelectorPromptID_Temperature decimal(3, 2)
    DECLARE @false_ResultSelectorPromptID_TopP decimal(3, 2)
    DECLARE @false_ResultSelectorPromptID_TopK int
    DECLARE @false_ResultSelectorPromptID_MinP decimal(3, 2)
    DECLARE @false_ResultSelectorPromptID_FrequencyPenalty decimal(3, 2)
    DECLARE @false_ResultSelectorPromptID_PresencePenalty decimal(3, 2)
    DECLARE @false_ResultSelectorPromptID_Seed int
    DECLARE @false_ResultSelectorPromptID_StopSequences nvarchar(1000)
    DECLARE @false_ResultSelectorPromptID_IncludeLogProbs bit
    DECLARE @false_ResultSelectorPromptID_TopLogProbs int
    DECLARE @false_ResultSelectorPromptID_FailoverStrategy nvarchar(50)
    DECLARE @false_ResultSelectorPromptID_FailoverMaxAttempts int
    DECLARE @false_ResultSelectorPromptID_FailoverDelaySeconds int
    DECLARE @false_ResultSelectorPromptID_FailoverModelStrategy nvarchar(50)
    DECLARE @false_ResultSelectorPromptID_FailoverErrorScope nvarchar(50)
    DECLARE @false_ResultSelectorPromptID_EffortLevel int
    DECLARE cascade_update_false_ResultSelectorPromptID_cursor CURSOR FOR
        SELECT [ID], [Name], [Description], [TemplateID], [CategoryID], [TypeID], [Status], [ResponseFormat], [ModelSpecificResponseFormat], [AIModelTypeID], [MinPowerRank], [SelectionStrategy], [PowerPreference], [ParallelizationMode], [ParallelCount], [ParallelConfigParam], [OutputType], [OutputExample], [ValidationBehavior], [MaxRetries], [RetryDelayMS], [RetryStrategy], [ResultSelectorPromptID], [EnableCaching], [CacheTTLSeconds], [CacheMatchType], [CacheSimilarityThreshold], [CacheMustMatchModel], [CacheMustMatchVendor], [CacheMustMatchAgent], [CacheMustMatchConfig], [PromptRole], [PromptPosition], [Temperature], [TopP], [TopK], [MinP], [FrequencyPenalty], [PresencePenalty], [Seed], [StopSequences], [IncludeLogProbs], [TopLogProbs], [FailoverStrategy], [FailoverMaxAttempts], [FailoverDelaySeconds], [FailoverModelStrategy], [FailoverErrorScope], [EffortLevel]
        FROM [${flyway:defaultSchema}].[AIPrompt]
        WHERE [ResultSelectorPromptID] = @ID

    OPEN cascade_update_false_ResultSelectorPromptID_cursor
    FETCH NEXT FROM cascade_update_false_ResultSelectorPromptID_cursor INTO @false_ResultSelectorPromptIDID, @false_ResultSelectorPromptID_Name, @false_ResultSelectorPromptID_Description, @false_ResultSelectorPromptID_TemplateID, @false_ResultSelectorPromptID_CategoryID, @false_ResultSelectorPromptID_TypeID, @false_ResultSelectorPromptID_Status, @false_ResultSelectorPromptID_ResponseFormat, @false_ResultSelectorPromptID_ModelSpecificResponseFormat, @false_ResultSelectorPromptID_AIModelTypeID, @false_ResultSelectorPromptID_MinPowerRank, @false_ResultSelectorPromptID_SelectionStrategy, @false_ResultSelectorPromptID_PowerPreference, @false_ResultSelectorPromptID_ParallelizationMode, @false_ResultSelectorPromptID_ParallelCount, @false_ResultSelectorPromptID_ParallelConfigParam, @false_ResultSelectorPromptID_OutputType, @false_ResultSelectorPromptID_OutputExample, @false_ResultSelectorPromptID_ValidationBehavior, @false_ResultSelectorPromptID_MaxRetries, @false_ResultSelectorPromptID_RetryDelayMS, @false_ResultSelectorPromptID_RetryStrategy, @false_ResultSelectorPromptID_ResultSelectorPromptID, @false_ResultSelectorPromptID_EnableCaching, @false_ResultSelectorPromptID_CacheTTLSeconds, @false_ResultSelectorPromptID_CacheMatchType, @false_ResultSelectorPromptID_CacheSimilarityThreshold, @false_ResultSelectorPromptID_CacheMustMatchModel, @false_ResultSelectorPromptID_CacheMustMatchVendor, @false_ResultSelectorPromptID_CacheMustMatchAgent, @false_ResultSelectorPromptID_CacheMustMatchConfig, @false_ResultSelectorPromptID_PromptRole, @false_ResultSelectorPromptID_PromptPosition, @false_ResultSelectorPromptID_Temperature, @false_ResultSelectorPromptID_TopP, @false_ResultSelectorPromptID_TopK, @false_ResultSelectorPromptID_MinP, @false_ResultSelectorPromptID_FrequencyPenalty, @false_ResultSelectorPromptID_PresencePenalty, @false_ResultSelectorPromptID_Seed, @false_ResultSelectorPromptID_StopSequences, @false_ResultSelectorPromptID_IncludeLogProbs, @false_ResultSelectorPromptID_TopLogProbs, @false_ResultSelectorPromptID_FailoverStrategy, @false_ResultSelectorPromptID_FailoverMaxAttempts, @false_ResultSelectorPromptID_FailoverDelaySeconds, @false_ResultSelectorPromptID_FailoverModelStrategy, @false_ResultSelectorPromptID_FailoverErrorScope, @false_ResultSelectorPromptID_EffortLevel

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @false_ResultSelectorPromptID_ResultSelectorPromptID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateMJAIPrompt] @ID = @false_ResultSelectorPromptIDID, @Name = @false_ResultSelectorPromptID_Name, @Description = @false_ResultSelectorPromptID_Description, @TemplateID = @false_ResultSelectorPromptID_TemplateID, @CategoryID = @false_ResultSelectorPromptID_CategoryID, @TypeID = @false_ResultSelectorPromptID_TypeID, @Status = @false_ResultSelectorPromptID_Status, @ResponseFormat = @false_ResultSelectorPromptID_ResponseFormat, @ModelSpecificResponseFormat = @false_ResultSelectorPromptID_ModelSpecificResponseFormat, @AIModelTypeID = @false_ResultSelectorPromptID_AIModelTypeID, @MinPowerRank = @false_ResultSelectorPromptID_MinPowerRank, @SelectionStrategy = @false_ResultSelectorPromptID_SelectionStrategy, @PowerPreference = @false_ResultSelectorPromptID_PowerPreference, @ParallelizationMode = @false_ResultSelectorPromptID_ParallelizationMode, @ParallelCount = @false_ResultSelectorPromptID_ParallelCount, @ParallelConfigParam = @false_ResultSelectorPromptID_ParallelConfigParam, @OutputType = @false_ResultSelectorPromptID_OutputType, @OutputExample = @false_ResultSelectorPromptID_OutputExample, @ValidationBehavior = @false_ResultSelectorPromptID_ValidationBehavior, @MaxRetries = @false_ResultSelectorPromptID_MaxRetries, @RetryDelayMS = @false_ResultSelectorPromptID_RetryDelayMS, @RetryStrategy = @false_ResultSelectorPromptID_RetryStrategy, @ResultSelectorPromptID = @false_ResultSelectorPromptID_ResultSelectorPromptID, @EnableCaching = @false_ResultSelectorPromptID_EnableCaching, @CacheTTLSeconds = @false_ResultSelectorPromptID_CacheTTLSeconds, @CacheMatchType = @false_ResultSelectorPromptID_CacheMatchType, @CacheSimilarityThreshold = @false_ResultSelectorPromptID_CacheSimilarityThreshold, @CacheMustMatchModel = @false_ResultSelectorPromptID_CacheMustMatchModel, @CacheMustMatchVendor = @false_ResultSelectorPromptID_CacheMustMatchVendor, @CacheMustMatchAgent = @false_ResultSelectorPromptID_CacheMustMatchAgent, @CacheMustMatchConfig = @false_ResultSelectorPromptID_CacheMustMatchConfig, @PromptRole = @false_ResultSelectorPromptID_PromptRole, @PromptPosition = @false_ResultSelectorPromptID_PromptPosition, @Temperature = @false_ResultSelectorPromptID_Temperature, @TopP = @false_ResultSelectorPromptID_TopP, @TopK = @false_ResultSelectorPromptID_TopK, @MinP = @false_ResultSelectorPromptID_MinP, @FrequencyPenalty = @false_ResultSelectorPromptID_FrequencyPenalty, @PresencePenalty = @false_ResultSelectorPromptID_PresencePenalty, @Seed = @false_ResultSelectorPromptID_Seed, @StopSequences = @false_ResultSelectorPromptID_StopSequences, @IncludeLogProbs = @false_ResultSelectorPromptID_IncludeLogProbs, @TopLogProbs = @false_ResultSelectorPromptID_TopLogProbs, @FailoverStrategy = @false_ResultSelectorPromptID_FailoverStrategy, @FailoverMaxAttempts = @false_ResultSelectorPromptID_FailoverMaxAttempts, @FailoverDelaySeconds = @false_ResultSelectorPromptID_FailoverDelaySeconds, @FailoverModelStrategy = @false_ResultSelectorPromptID_FailoverModelStrategy, @FailoverErrorScope = @false_ResultSelectorPromptID_FailoverErrorScope, @EffortLevel = @false_ResultSelectorPromptID_EffortLevel

        FETCH NEXT FROM cascade_update_false_ResultSelectorPromptID_cursor INTO @false_ResultSelectorPromptIDID, @false_ResultSelectorPromptID_Name, @false_ResultSelectorPromptID_Description, @false_ResultSelectorPromptID_TemplateID, @false_ResultSelectorPromptID_CategoryID, @false_ResultSelectorPromptID_TypeID, @false_ResultSelectorPromptID_Status, @false_ResultSelectorPromptID_ResponseFormat, @false_ResultSelectorPromptID_ModelSpecificResponseFormat, @false_ResultSelectorPromptID_AIModelTypeID, @false_ResultSelectorPromptID_MinPowerRank, @false_ResultSelectorPromptID_SelectionStrategy, @false_ResultSelectorPromptID_PowerPreference, @false_ResultSelectorPromptID_ParallelizationMode, @false_ResultSelectorPromptID_ParallelCount, @false_ResultSelectorPromptID_ParallelConfigParam, @false_ResultSelectorPromptID_OutputType, @false_ResultSelectorPromptID_OutputExample, @false_ResultSelectorPromptID_ValidationBehavior, @false_ResultSelectorPromptID_MaxRetries, @false_ResultSelectorPromptID_RetryDelayMS, @false_ResultSelectorPromptID_RetryStrategy, @false_ResultSelectorPromptID_ResultSelectorPromptID, @false_ResultSelectorPromptID_EnableCaching, @false_ResultSelectorPromptID_CacheTTLSeconds, @false_ResultSelectorPromptID_CacheMatchType, @false_ResultSelectorPromptID_CacheSimilarityThreshold, @false_ResultSelectorPromptID_CacheMustMatchModel, @false_ResultSelectorPromptID_CacheMustMatchVendor, @false_ResultSelectorPromptID_CacheMustMatchAgent, @false_ResultSelectorPromptID_CacheMustMatchConfig, @false_ResultSelectorPromptID_PromptRole, @false_ResultSelectorPromptID_PromptPosition, @false_ResultSelectorPromptID_Temperature, @false_ResultSelectorPromptID_TopP, @false_ResultSelectorPromptID_TopK, @false_ResultSelectorPromptID_MinP, @false_ResultSelectorPromptID_FrequencyPenalty, @false_ResultSelectorPromptID_PresencePenalty, @false_ResultSelectorPromptID_Seed, @false_ResultSelectorPromptID_StopSequences, @false_ResultSelectorPromptID_IncludeLogProbs, @false_ResultSelectorPromptID_TopLogProbs, @false_ResultSelectorPromptID_FailoverStrategy, @false_ResultSelectorPromptID_FailoverMaxAttempts, @false_ResultSelectorPromptID_FailoverDelaySeconds, @false_ResultSelectorPromptID_FailoverModelStrategy, @false_ResultSelectorPromptID_FailoverErrorScope, @false_ResultSelectorPromptID_EffortLevel
    END

    CLOSE cascade_update_false_ResultSelectorPromptID_cursor
    DEALLOCATE cascade_update_false_ResultSelectorPromptID_cursor
    
    -- Cascade delete from AIResultCache using cursor to call spDeleteMJAIResultCache
    DECLARE @false_AIPromptIDID uniqueidentifier
    DECLARE cascade_delete_false_AIPromptID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[AIResultCache]
        WHERE [AIPromptID] = @ID
    
    OPEN cascade_delete_false_AIPromptID_cursor
    FETCH NEXT FROM cascade_delete_false_AIPromptID_cursor INTO @false_AIPromptIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteMJAIResultCache] @ID = @false_AIPromptIDID
        
        FETCH NEXT FROM cascade_delete_false_AIPromptID_cursor INTO @false_AIPromptIDID
    END
    
    CLOSE cascade_delete_false_AIPromptID_cursor
    DEALLOCATE cascade_delete_false_AIPromptID_cursor
    

    DELETE FROM
        [${flyway:defaultSchema}].[AIPrompt]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIPrompt] TO [cdp_Developer]
    

/* spDelete Permissions for MJ: AI Prompts */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAIPrompt] TO [cdp_Developer]



/* Base View SQL for MJ: API Application Scopes */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: API Application Scopes
-- Item: vwAPIApplicationScopes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: API Application Scopes
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  APIApplicationScope
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwAPIApplicationScopes]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwAPIApplicationScopes];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwAPIApplicationScopes]
AS
SELECT
    m.*,
    MJAPIApplications_ApplicationID.[Name] AS [Application],
    MJAPIScopes_ScopeID.[Name] AS [Scope]
FROM
    [${flyway:defaultSchema}].[APIApplicationScope] AS m
INNER JOIN
    [${flyway:defaultSchema}].[APIApplication] AS MJAPIApplications_ApplicationID
  ON
    [m].[ApplicationID] = MJAPIApplications_ApplicationID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[APIScope] AS MJAPIScopes_ScopeID
  ON
    [m].[ScopeID] = MJAPIScopes_ScopeID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwAPIApplicationScopes] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: API Application Scopes */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: API Application Scopes
-- Item: Permissions for vwAPIApplicationScopes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwAPIApplicationScopes] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: API Application Scopes */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: API Application Scopes
-- Item: spCreateMJAPIApplicationScope
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR APIApplicationScope
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJAPIApplicationScope]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJAPIApplicationScope];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJAPIApplicationScope]
    @ID uniqueidentifier = NULL,
    @ApplicationID uniqueidentifier,
    @ScopeID uniqueidentifier,
    @ResourcePattern nvarchar(750),
    @PatternType nvarchar(20) = NULL,
    @IsDeny bit = NULL,
    @Priority int = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[APIApplicationScope]
            (
                [ID],
                [ApplicationID],
                [ScopeID],
                [ResourcePattern],
                [PatternType],
                [IsDeny],
                [Priority]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @ApplicationID,
                @ScopeID,
                @ResourcePattern,
                ISNULL(@PatternType, 'Include'),
                ISNULL(@IsDeny, 0),
                ISNULL(@Priority, 0)
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[APIApplicationScope]
            (
                [ApplicationID],
                [ScopeID],
                [ResourcePattern],
                [PatternType],
                [IsDeny],
                [Priority]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ApplicationID,
                @ScopeID,
                @ResourcePattern,
                ISNULL(@PatternType, 'Include'),
                ISNULL(@IsDeny, 0),
                ISNULL(@Priority, 0)
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwAPIApplicationScopes] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAPIApplicationScope] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: API Application Scopes */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAPIApplicationScope] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: API Application Scopes */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: API Application Scopes
-- Item: spUpdateMJAPIApplicationScope
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR APIApplicationScope
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJAPIApplicationScope]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAPIApplicationScope];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAPIApplicationScope]
    @ID uniqueidentifier,
    @ApplicationID uniqueidentifier,
    @ScopeID uniqueidentifier,
    @ResourcePattern nvarchar(750),
    @PatternType nvarchar(20),
    @IsDeny bit,
    @Priority int
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[APIApplicationScope]
    SET
        [ApplicationID] = @ApplicationID,
        [ScopeID] = @ScopeID,
        [ResourcePattern] = @ResourcePattern,
        [PatternType] = @PatternType,
        [IsDeny] = @IsDeny,
        [Priority] = @Priority
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwAPIApplicationScopes] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwAPIApplicationScopes]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAPIApplicationScope] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the APIApplicationScope table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJAPIApplicationScope]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJAPIApplicationScope];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJAPIApplicationScope
ON [${flyway:defaultSchema}].[APIApplicationScope]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[APIApplicationScope]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[APIApplicationScope] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: API Application Scopes */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAPIApplicationScope] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: API Application Scopes */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: API Application Scopes
-- Item: spDeleteMJAPIApplicationScope
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR APIApplicationScope
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJAPIApplicationScope]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAPIApplicationScope];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAPIApplicationScope]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[APIApplicationScope]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAPIApplicationScope] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: API Application Scopes */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAPIApplicationScope] TO [cdp_Integration]



/* Base View SQL for MJ: API Applications */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: API Applications
-- Item: vwAPIApplications
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: API Applications
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  APIApplication
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwAPIApplications]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwAPIApplications];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwAPIApplications]
AS
SELECT
    m.*
FROM
    [${flyway:defaultSchema}].[APIApplication] AS m
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwAPIApplications] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: API Applications */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: API Applications
-- Item: Permissions for vwAPIApplications
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwAPIApplications] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: API Applications */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: API Applications
-- Item: spCreateMJAPIApplication
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR APIApplication
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJAPIApplication]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJAPIApplication];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJAPIApplication]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(100),
    @Description nvarchar(500),
    @IsActive bit = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[APIApplication]
            (
                [ID],
                [Name],
                [Description],
                [IsActive]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description,
                ISNULL(@IsActive, 1)
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[APIApplication]
            (
                [Name],
                [Description],
                [IsActive]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description,
                ISNULL(@IsActive, 1)
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwAPIApplications] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAPIApplication] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: API Applications */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAPIApplication] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: API Applications */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: API Applications
-- Item: spUpdateMJAPIApplication
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR APIApplication
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJAPIApplication]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAPIApplication];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAPIApplication]
    @ID uniqueidentifier,
    @Name nvarchar(100),
    @Description nvarchar(500),
    @IsActive bit
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[APIApplication]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [IsActive] = @IsActive
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwAPIApplications] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwAPIApplications]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAPIApplication] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the APIApplication table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJAPIApplication]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJAPIApplication];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJAPIApplication
ON [${flyway:defaultSchema}].[APIApplication]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[APIApplication]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[APIApplication] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: API Applications */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAPIApplication] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: API Applications */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: API Applications
-- Item: spDeleteMJAPIApplication
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR APIApplication
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJAPIApplication]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAPIApplication];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAPIApplication]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[APIApplication]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAPIApplication] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: API Applications */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAPIApplication] TO [cdp_Integration]



/* Base View SQL for MJ: API Key Usage Logs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: API Key Usage Logs
-- Item: vwAPIKeyUsageLogs
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: API Key Usage Logs
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  APIKeyUsageLog
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwAPIKeyUsageLogs]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwAPIKeyUsageLogs];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwAPIKeyUsageLogs]
AS
SELECT
    m.*,
    MJAPIKeys_APIKeyID.[Label] AS [APIKey],
    MJAPIApplications_ApplicationID.[Name] AS [Application]
FROM
    [${flyway:defaultSchema}].[APIKeyUsageLog] AS m
INNER JOIN
    [${flyway:defaultSchema}].[APIKey] AS MJAPIKeys_APIKeyID
  ON
    [m].[APIKeyID] = MJAPIKeys_APIKeyID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[APIApplication] AS MJAPIApplications_ApplicationID
  ON
    [m].[ApplicationID] = MJAPIApplications_ApplicationID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwAPIKeyUsageLogs] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: API Key Usage Logs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: API Key Usage Logs
-- Item: Permissions for vwAPIKeyUsageLogs
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwAPIKeyUsageLogs] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: API Key Usage Logs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: API Key Usage Logs
-- Item: spCreateMJAPIKeyUsageLog
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR APIKeyUsageLog
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJAPIKeyUsageLog]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJAPIKeyUsageLog];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJAPIKeyUsageLog]
    @ID uniqueidentifier = NULL,
    @APIKeyID uniqueidentifier,
    @Endpoint nvarchar(500),
    @Operation nvarchar(255),
    @Method nvarchar(10),
    @StatusCode int,
    @ResponseTimeMs int,
    @IPAddress nvarchar(45),
    @UserAgent nvarchar(500),
    @ApplicationID uniqueidentifier,
    @RequestedResource nvarchar(500),
    @ScopesEvaluated nvarchar(MAX),
    @AuthorizationResult nvarchar(20) = NULL,
    @DeniedReason nvarchar(500)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[APIKeyUsageLog]
            (
                [ID],
                [APIKeyID],
                [Endpoint],
                [Operation],
                [Method],
                [StatusCode],
                [ResponseTimeMs],
                [IPAddress],
                [UserAgent],
                [ApplicationID],
                [RequestedResource],
                [ScopesEvaluated],
                [AuthorizationResult],
                [DeniedReason]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @APIKeyID,
                @Endpoint,
                @Operation,
                @Method,
                @StatusCode,
                @ResponseTimeMs,
                @IPAddress,
                @UserAgent,
                @ApplicationID,
                @RequestedResource,
                @ScopesEvaluated,
                ISNULL(@AuthorizationResult, 'Allowed'),
                @DeniedReason
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[APIKeyUsageLog]
            (
                [APIKeyID],
                [Endpoint],
                [Operation],
                [Method],
                [StatusCode],
                [ResponseTimeMs],
                [IPAddress],
                [UserAgent],
                [ApplicationID],
                [RequestedResource],
                [ScopesEvaluated],
                [AuthorizationResult],
                [DeniedReason]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @APIKeyID,
                @Endpoint,
                @Operation,
                @Method,
                @StatusCode,
                @ResponseTimeMs,
                @IPAddress,
                @UserAgent,
                @ApplicationID,
                @RequestedResource,
                @ScopesEvaluated,
                ISNULL(@AuthorizationResult, 'Allowed'),
                @DeniedReason
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwAPIKeyUsageLogs] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAPIKeyUsageLog] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: API Key Usage Logs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAPIKeyUsageLog] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: API Key Usage Logs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: API Key Usage Logs
-- Item: spUpdateMJAPIKeyUsageLog
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR APIKeyUsageLog
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJAPIKeyUsageLog]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAPIKeyUsageLog];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAPIKeyUsageLog]
    @ID uniqueidentifier,
    @APIKeyID uniqueidentifier,
    @Endpoint nvarchar(500),
    @Operation nvarchar(255),
    @Method nvarchar(10),
    @StatusCode int,
    @ResponseTimeMs int,
    @IPAddress nvarchar(45),
    @UserAgent nvarchar(500),
    @ApplicationID uniqueidentifier,
    @RequestedResource nvarchar(500),
    @ScopesEvaluated nvarchar(MAX),
    @AuthorizationResult nvarchar(20),
    @DeniedReason nvarchar(500)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[APIKeyUsageLog]
    SET
        [APIKeyID] = @APIKeyID,
        [Endpoint] = @Endpoint,
        [Operation] = @Operation,
        [Method] = @Method,
        [StatusCode] = @StatusCode,
        [ResponseTimeMs] = @ResponseTimeMs,
        [IPAddress] = @IPAddress,
        [UserAgent] = @UserAgent,
        [ApplicationID] = @ApplicationID,
        [RequestedResource] = @RequestedResource,
        [ScopesEvaluated] = @ScopesEvaluated,
        [AuthorizationResult] = @AuthorizationResult,
        [DeniedReason] = @DeniedReason
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwAPIKeyUsageLogs] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwAPIKeyUsageLogs]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAPIKeyUsageLog] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the APIKeyUsageLog table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJAPIKeyUsageLog]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJAPIKeyUsageLog];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJAPIKeyUsageLog
ON [${flyway:defaultSchema}].[APIKeyUsageLog]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[APIKeyUsageLog]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[APIKeyUsageLog] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: API Key Usage Logs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAPIKeyUsageLog] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: API Key Usage Logs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: API Key Usage Logs
-- Item: spDeleteMJAPIKeyUsageLog
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR APIKeyUsageLog
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJAPIKeyUsageLog]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAPIKeyUsageLog];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAPIKeyUsageLog]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[APIKeyUsageLog]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAPIKeyUsageLog] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: API Key Usage Logs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAPIKeyUsageLog] TO [cdp_Integration]



/* Base View SQL for MJ: API Key Scopes */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: API Key Scopes
-- Item: vwAPIKeyScopes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: API Key Scopes
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  APIKeyScope
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwAPIKeyScopes]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwAPIKeyScopes];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwAPIKeyScopes]
AS
SELECT
    m.*,
    MJAPIKeys_APIKeyID.[Label] AS [APIKey],
    MJAPIScopes_ScopeID.[Name] AS [Scope]
FROM
    [${flyway:defaultSchema}].[APIKeyScope] AS m
INNER JOIN
    [${flyway:defaultSchema}].[APIKey] AS MJAPIKeys_APIKeyID
  ON
    [m].[APIKeyID] = MJAPIKeys_APIKeyID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[APIScope] AS MJAPIScopes_ScopeID
  ON
    [m].[ScopeID] = MJAPIScopes_ScopeID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwAPIKeyScopes] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: API Key Scopes */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: API Key Scopes
-- Item: Permissions for vwAPIKeyScopes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwAPIKeyScopes] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: API Key Scopes */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: API Key Scopes
-- Item: spCreateMJAPIKeyScope
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR APIKeyScope
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJAPIKeyScope]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJAPIKeyScope];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJAPIKeyScope]
    @ID uniqueidentifier = NULL,
    @APIKeyID uniqueidentifier,
    @ScopeID uniqueidentifier,
    @ResourcePattern nvarchar(750),
    @PatternType nvarchar(20) = NULL,
    @IsDeny bit = NULL,
    @Priority int = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[APIKeyScope]
            (
                [ID],
                [APIKeyID],
                [ScopeID],
                [ResourcePattern],
                [PatternType],
                [IsDeny],
                [Priority]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @APIKeyID,
                @ScopeID,
                @ResourcePattern,
                ISNULL(@PatternType, 'Include'),
                ISNULL(@IsDeny, 0),
                ISNULL(@Priority, 0)
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[APIKeyScope]
            (
                [APIKeyID],
                [ScopeID],
                [ResourcePattern],
                [PatternType],
                [IsDeny],
                [Priority]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @APIKeyID,
                @ScopeID,
                @ResourcePattern,
                ISNULL(@PatternType, 'Include'),
                ISNULL(@IsDeny, 0),
                ISNULL(@Priority, 0)
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwAPIKeyScopes] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAPIKeyScope] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: API Key Scopes */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAPIKeyScope] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: API Key Scopes */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: API Key Scopes
-- Item: spUpdateMJAPIKeyScope
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR APIKeyScope
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJAPIKeyScope]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAPIKeyScope];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAPIKeyScope]
    @ID uniqueidentifier,
    @APIKeyID uniqueidentifier,
    @ScopeID uniqueidentifier,
    @ResourcePattern nvarchar(750),
    @PatternType nvarchar(20),
    @IsDeny bit,
    @Priority int
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[APIKeyScope]
    SET
        [APIKeyID] = @APIKeyID,
        [ScopeID] = @ScopeID,
        [ResourcePattern] = @ResourcePattern,
        [PatternType] = @PatternType,
        [IsDeny] = @IsDeny,
        [Priority] = @Priority
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwAPIKeyScopes] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwAPIKeyScopes]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAPIKeyScope] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the APIKeyScope table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJAPIKeyScope]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJAPIKeyScope];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJAPIKeyScope
ON [${flyway:defaultSchema}].[APIKeyScope]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[APIKeyScope]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[APIKeyScope] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: API Key Scopes */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAPIKeyScope] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: API Key Scopes */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: API Key Scopes
-- Item: spDeleteMJAPIKeyScope
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR APIKeyScope
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJAPIKeyScope]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAPIKeyScope];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAPIKeyScope]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[APIKeyScope]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAPIKeyScope] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: API Key Scopes */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAPIKeyScope] TO [cdp_Integration]



/* Base View SQL for MJ: API Key Applications */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: API Key Applications
-- Item: vwAPIKeyApplications
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: API Key Applications
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  APIKeyApplication
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwAPIKeyApplications]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwAPIKeyApplications];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwAPIKeyApplications]
AS
SELECT
    m.*,
    MJAPIKeys_APIKeyID.[Label] AS [APIKey],
    MJAPIApplications_ApplicationID.[Name] AS [Application]
FROM
    [${flyway:defaultSchema}].[APIKeyApplication] AS m
INNER JOIN
    [${flyway:defaultSchema}].[APIKey] AS MJAPIKeys_APIKeyID
  ON
    [m].[APIKeyID] = MJAPIKeys_APIKeyID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[APIApplication] AS MJAPIApplications_ApplicationID
  ON
    [m].[ApplicationID] = MJAPIApplications_ApplicationID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwAPIKeyApplications] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: API Key Applications */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: API Key Applications
-- Item: Permissions for vwAPIKeyApplications
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwAPIKeyApplications] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: API Key Applications */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: API Key Applications
-- Item: spCreateMJAPIKeyApplication
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR APIKeyApplication
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJAPIKeyApplication]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJAPIKeyApplication];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJAPIKeyApplication]
    @ID uniqueidentifier = NULL,
    @APIKeyID uniqueidentifier,
    @ApplicationID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[APIKeyApplication]
            (
                [ID],
                [APIKeyID],
                [ApplicationID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @APIKeyID,
                @ApplicationID
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[APIKeyApplication]
            (
                [APIKeyID],
                [ApplicationID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @APIKeyID,
                @ApplicationID
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwAPIKeyApplications] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAPIKeyApplication] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: API Key Applications */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAPIKeyApplication] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: API Key Applications */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: API Key Applications
-- Item: spUpdateMJAPIKeyApplication
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR APIKeyApplication
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJAPIKeyApplication]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAPIKeyApplication];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAPIKeyApplication]
    @ID uniqueidentifier,
    @APIKeyID uniqueidentifier,
    @ApplicationID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[APIKeyApplication]
    SET
        [APIKeyID] = @APIKeyID,
        [ApplicationID] = @ApplicationID
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwAPIKeyApplications] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwAPIKeyApplications]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAPIKeyApplication] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the APIKeyApplication table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJAPIKeyApplication]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJAPIKeyApplication];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJAPIKeyApplication
ON [${flyway:defaultSchema}].[APIKeyApplication]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[APIKeyApplication]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[APIKeyApplication] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: API Key Applications */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAPIKeyApplication] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: API Key Applications */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: API Key Applications
-- Item: spDeleteMJAPIKeyApplication
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR APIKeyApplication
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJAPIKeyApplication]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAPIKeyApplication];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAPIKeyApplication]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[APIKeyApplication]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAPIKeyApplication] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: API Key Applications */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAPIKeyApplication] TO [cdp_Integration]



/* Base View SQL for MJ: API Keys */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: API Keys
-- Item: vwAPIKeys
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: API Keys
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  APIKey
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwAPIKeys]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwAPIKeys];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwAPIKeys]
AS
SELECT
    m.*,
    MJUsers_UserID.[Name] AS [User],
    MJUsers_CreatedByUserID.[Name] AS [CreatedByUser]
FROM
    [${flyway:defaultSchema}].[APIKey] AS m
INNER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_UserID
  ON
    [m].[UserID] = MJUsers_UserID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_CreatedByUserID
  ON
    [m].[CreatedByUserID] = MJUsers_CreatedByUserID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwAPIKeys] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: API Keys */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: API Keys
-- Item: Permissions for vwAPIKeys
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwAPIKeys] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: API Keys */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: API Keys
-- Item: spCreateMJAPIKey
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR APIKey
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJAPIKey]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJAPIKey];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJAPIKey]
    @ID uniqueidentifier = NULL,
    @Hash nvarchar(64),
    @UserID uniqueidentifier,
    @Label nvarchar(255),
    @Description nvarchar(1000),
    @Status nvarchar(20) = NULL,
    @ExpiresAt datetimeoffset,
    @LastUsedAt datetimeoffset,
    @CreatedByUserID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[APIKey]
            (
                [ID],
                [Hash],
                [UserID],
                [Label],
                [Description],
                [Status],
                [ExpiresAt],
                [LastUsedAt],
                [CreatedByUserID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Hash,
                @UserID,
                @Label,
                @Description,
                ISNULL(@Status, 'Active'),
                @ExpiresAt,
                @LastUsedAt,
                @CreatedByUserID
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[APIKey]
            (
                [Hash],
                [UserID],
                [Label],
                [Description],
                [Status],
                [ExpiresAt],
                [LastUsedAt],
                [CreatedByUserID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Hash,
                @UserID,
                @Label,
                @Description,
                ISNULL(@Status, 'Active'),
                @ExpiresAt,
                @LastUsedAt,
                @CreatedByUserID
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwAPIKeys] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAPIKey] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: API Keys */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAPIKey] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: API Keys */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: API Keys
-- Item: spUpdateMJAPIKey
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR APIKey
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJAPIKey]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAPIKey];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAPIKey]
    @ID uniqueidentifier,
    @Hash nvarchar(64),
    @UserID uniqueidentifier,
    @Label nvarchar(255),
    @Description nvarchar(1000),
    @Status nvarchar(20),
    @ExpiresAt datetimeoffset,
    @LastUsedAt datetimeoffset,
    @CreatedByUserID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[APIKey]
    SET
        [Hash] = @Hash,
        [UserID] = @UserID,
        [Label] = @Label,
        [Description] = @Description,
        [Status] = @Status,
        [ExpiresAt] = @ExpiresAt,
        [LastUsedAt] = @LastUsedAt,
        [CreatedByUserID] = @CreatedByUserID
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwAPIKeys] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwAPIKeys]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAPIKey] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the APIKey table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJAPIKey]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJAPIKey];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJAPIKey
ON [${flyway:defaultSchema}].[APIKey]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[APIKey]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[APIKey] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: API Keys */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAPIKey] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: API Keys */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: API Keys
-- Item: spDeleteMJAPIKey
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR APIKey
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJAPIKey]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAPIKey];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAPIKey]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[APIKey]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAPIKey] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: API Keys */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAPIKey] TO [cdp_Integration]



/* Base View SQL for MJ: API Scopes */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: API Scopes
-- Item: vwAPIScopes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: API Scopes
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  APIScope
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwAPIScopes]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwAPIScopes];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwAPIScopes]
AS
SELECT
    m.*,
    MJAPIScopes_ParentID.[Name] AS [Parent],
    root_ParentID.RootID AS [RootParentID]
FROM
    [${flyway:defaultSchema}].[APIScope] AS m
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[APIScope] AS MJAPIScopes_ParentID
  ON
    [m].[ParentID] = MJAPIScopes_ParentID.[ID]
OUTER APPLY
    [${flyway:defaultSchema}].[fnAPIScopeParentID_GetRootID]([m].[ID], [m].[ParentID]) AS root_ParentID
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwAPIScopes] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: API Scopes */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: API Scopes
-- Item: Permissions for vwAPIScopes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwAPIScopes] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: API Scopes */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: API Scopes
-- Item: spCreateMJAPIScope
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR APIScope
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJAPIScope]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJAPIScope];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJAPIScope]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(100),
    @Category nvarchar(100),
    @Description nvarchar(500),
    @ParentID uniqueidentifier,
    @FullPath nvarchar(500),
    @ResourceType nvarchar(50),
    @IsActive bit = NULL,
    @UIConfig nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[APIScope]
            (
                [ID],
                [Name],
                [Category],
                [Description],
                [ParentID],
                [FullPath],
                [ResourceType],
                [IsActive],
                [UIConfig]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Category,
                @Description,
                @ParentID,
                @FullPath,
                @ResourceType,
                ISNULL(@IsActive, 1),
                @UIConfig
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[APIScope]
            (
                [Name],
                [Category],
                [Description],
                [ParentID],
                [FullPath],
                [ResourceType],
                [IsActive],
                [UIConfig]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Category,
                @Description,
                @ParentID,
                @FullPath,
                @ResourceType,
                ISNULL(@IsActive, 1),
                @UIConfig
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwAPIScopes] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAPIScope] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: API Scopes */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAPIScope] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: API Scopes */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: API Scopes
-- Item: spUpdateMJAPIScope
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR APIScope
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJAPIScope]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAPIScope];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAPIScope]
    @ID uniqueidentifier,
    @Name nvarchar(100),
    @Category nvarchar(100),
    @Description nvarchar(500),
    @ParentID uniqueidentifier,
    @FullPath nvarchar(500),
    @ResourceType nvarchar(50),
    @IsActive bit,
    @UIConfig nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[APIScope]
    SET
        [Name] = @Name,
        [Category] = @Category,
        [Description] = @Description,
        [ParentID] = @ParentID,
        [FullPath] = @FullPath,
        [ResourceType] = @ResourceType,
        [IsActive] = @IsActive,
        [UIConfig] = @UIConfig
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwAPIScopes] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwAPIScopes]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAPIScope] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the APIScope table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJAPIScope]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJAPIScope];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJAPIScope
ON [${flyway:defaultSchema}].[APIScope]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[APIScope]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[APIScope] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: API Scopes */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAPIScope] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: API Scopes */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: API Scopes
-- Item: spDeleteMJAPIScope
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR APIScope
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJAPIScope]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAPIScope];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAPIScope]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[APIScope]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAPIScope] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: API Scopes */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAPIScope] TO [cdp_Integration]



/* Base View SQL for MJ: Application Settings */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Application Settings
-- Item: vwApplicationSettings
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Application Settings
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  ApplicationSetting
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwApplicationSettings]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwApplicationSettings];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwApplicationSettings]
AS
SELECT
    m.*,
    MJApplications_ApplicationID.[Name] AS [Application]
FROM
    [${flyway:defaultSchema}].[ApplicationSetting] AS m
INNER JOIN
    [${flyway:defaultSchema}].[Application] AS MJApplications_ApplicationID
  ON
    [m].[ApplicationID] = MJApplications_ApplicationID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwApplicationSettings] TO [cdp_UI], [cdp_Integration], [cdp_Developer]
    

/* Base View Permissions SQL for MJ: Application Settings */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Application Settings
-- Item: Permissions for vwApplicationSettings
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwApplicationSettings] TO [cdp_UI], [cdp_Integration], [cdp_Developer]

/* spCreate SQL for MJ: Application Settings */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Application Settings
-- Item: spCreateMJApplicationSetting
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR ApplicationSetting
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJApplicationSetting]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJApplicationSetting];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJApplicationSetting]
    @ID uniqueidentifier = NULL,
    @ApplicationID uniqueidentifier,
    @Name nvarchar(100),
    @Value nvarchar(MAX),
    @Comments nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[ApplicationSetting]
            (
                [ID],
                [ApplicationID],
                [Name],
                [Value],
                [Comments]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @ApplicationID,
                @Name,
                @Value,
                @Comments
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[ApplicationSetting]
            (
                [ApplicationID],
                [Name],
                [Value],
                [Comments]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ApplicationID,
                @Name,
                @Value,
                @Comments
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwApplicationSettings] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJApplicationSetting] TO [cdp_Integration], [cdp_Developer]
    

/* spCreate Permissions for MJ: Application Settings */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJApplicationSetting] TO [cdp_Integration], [cdp_Developer]



/* spUpdate SQL for MJ: Application Settings */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Application Settings
-- Item: spUpdateMJApplicationSetting
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR ApplicationSetting
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJApplicationSetting]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJApplicationSetting];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJApplicationSetting]
    @ID uniqueidentifier,
    @ApplicationID uniqueidentifier,
    @Name nvarchar(100),
    @Value nvarchar(MAX),
    @Comments nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ApplicationSetting]
    SET
        [ApplicationID] = @ApplicationID,
        [Name] = @Name,
        [Value] = @Value,
        [Comments] = @Comments
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwApplicationSettings] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwApplicationSettings]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJApplicationSetting] TO [cdp_Integration], [cdp_Developer]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the ApplicationSetting table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJApplicationSetting]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJApplicationSetting];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJApplicationSetting
ON [${flyway:defaultSchema}].[ApplicationSetting]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ApplicationSetting]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[ApplicationSetting] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Application Settings */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJApplicationSetting] TO [cdp_Integration], [cdp_Developer]



/* spDelete SQL for MJ: Application Settings */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Application Settings
-- Item: spDeleteMJApplicationSetting
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR ApplicationSetting
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJApplicationSetting]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJApplicationSetting];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJApplicationSetting]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[ApplicationSetting]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJApplicationSetting] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Application Settings */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJApplicationSetting] TO [cdp_Integration]



/* Base View SQL for MJ: Applications */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Applications
-- Item: vwApplications
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Applications
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  Application
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwApplications]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwApplications];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwApplications]
AS
SELECT
    m.*
FROM
    [${flyway:defaultSchema}].[Application] AS m
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwApplications] TO [cdp_Developer], [cdp_Integration], [cdp_UI]
    

/* Base View Permissions SQL for MJ: Applications */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Applications
-- Item: Permissions for vwApplications
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwApplications] TO [cdp_Developer], [cdp_Integration], [cdp_UI]

/* spCreate SQL for MJ: Applications */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Applications
-- Item: spCreateMJApplication
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR Application
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJApplication]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJApplication];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJApplication]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(100),
    @Description nvarchar(MAX),
    @Icon nvarchar(500),
    @DefaultForNewUser bit = NULL,
    @SchemaAutoAddNewEntities nvarchar(MAX),
    @Color nvarchar(20),
    @DefaultNavItems nvarchar(MAX),
    @ClassName nvarchar(255),
    @DefaultSequence int = NULL,
    @Status nvarchar(20) = NULL,
    @NavigationStyle nvarchar(20) = NULL,
    @TopNavLocation nvarchar(30),
    @HideNavBarIconWhenActive bit = NULL,
    @Path nvarchar(100),
    @AutoUpdatePath bit = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[Application]
            (
                [ID],
                [Name],
                [Description],
                [Icon],
                [DefaultForNewUser],
                [SchemaAutoAddNewEntities],
                [Color],
                [DefaultNavItems],
                [ClassName],
                [DefaultSequence],
                [Status],
                [NavigationStyle],
                [TopNavLocation],
                [HideNavBarIconWhenActive],
                [Path],
                [AutoUpdatePath]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description,
                @Icon,
                ISNULL(@DefaultForNewUser, 1),
                @SchemaAutoAddNewEntities,
                @Color,
                @DefaultNavItems,
                @ClassName,
                ISNULL(@DefaultSequence, 100),
                ISNULL(@Status, 'Active'),
                ISNULL(@NavigationStyle, 'App Switcher'),
                @TopNavLocation,
                ISNULL(@HideNavBarIconWhenActive, 0),
                @Path,
                ISNULL(@AutoUpdatePath, 1)
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[Application]
            (
                [Name],
                [Description],
                [Icon],
                [DefaultForNewUser],
                [SchemaAutoAddNewEntities],
                [Color],
                [DefaultNavItems],
                [ClassName],
                [DefaultSequence],
                [Status],
                [NavigationStyle],
                [TopNavLocation],
                [HideNavBarIconWhenActive],
                [Path],
                [AutoUpdatePath]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description,
                @Icon,
                ISNULL(@DefaultForNewUser, 1),
                @SchemaAutoAddNewEntities,
                @Color,
                @DefaultNavItems,
                @ClassName,
                ISNULL(@DefaultSequence, 100),
                ISNULL(@Status, 'Active'),
                ISNULL(@NavigationStyle, 'App Switcher'),
                @TopNavLocation,
                ISNULL(@HideNavBarIconWhenActive, 0),
                @Path,
                ISNULL(@AutoUpdatePath, 1)
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwApplications] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJApplication] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Applications */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJApplication] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Applications */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Applications
-- Item: spUpdateMJApplication
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR Application
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJApplication]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJApplication];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJApplication]
    @ID uniqueidentifier,
    @Name nvarchar(100),
    @Description nvarchar(MAX),
    @Icon nvarchar(500),
    @DefaultForNewUser bit,
    @SchemaAutoAddNewEntities nvarchar(MAX),
    @Color nvarchar(20),
    @DefaultNavItems nvarchar(MAX),
    @ClassName nvarchar(255),
    @DefaultSequence int,
    @Status nvarchar(20),
    @NavigationStyle nvarchar(20),
    @TopNavLocation nvarchar(30),
    @HideNavBarIconWhenActive bit,
    @Path nvarchar(100),
    @AutoUpdatePath bit
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[Application]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [Icon] = @Icon,
        [DefaultForNewUser] = @DefaultForNewUser,
        [SchemaAutoAddNewEntities] = @SchemaAutoAddNewEntities,
        [Color] = @Color,
        [DefaultNavItems] = @DefaultNavItems,
        [ClassName] = @ClassName,
        [DefaultSequence] = @DefaultSequence,
        [Status] = @Status,
        [NavigationStyle] = @NavigationStyle,
        [TopNavLocation] = @TopNavLocation,
        [HideNavBarIconWhenActive] = @HideNavBarIconWhenActive,
        [Path] = @Path,
        [AutoUpdatePath] = @AutoUpdatePath
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwApplications] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwApplications]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJApplication] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the Application table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJApplication]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJApplication];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJApplication
ON [${flyway:defaultSchema}].[Application]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[Application]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[Application] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Applications */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJApplication] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Applications */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Applications
-- Item: spDeleteMJApplication
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR Application
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJApplication]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJApplication];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJApplication]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[Application]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJApplication] TO [cdp_Developer], [cdp_Integration]
    

/* spDelete Permissions for MJ: Applications */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJApplication] TO [cdp_Developer], [cdp_Integration]



/* Base View SQL for MJ: Artifact Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Artifact Types
-- Item: vwArtifactTypes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Artifact Types
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  ArtifactType
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwArtifactTypes]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwArtifactTypes];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwArtifactTypes]
AS
SELECT
    m.*,
    MJArtifactTypes_ParentID.[Name] AS [Parent],
    root_ParentID.RootID AS [RootParentID]
FROM
    [${flyway:defaultSchema}].[ArtifactType] AS m
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[ArtifactType] AS MJArtifactTypes_ParentID
  ON
    [m].[ParentID] = MJArtifactTypes_ParentID.[ID]
OUTER APPLY
    [${flyway:defaultSchema}].[fnArtifactTypeParentID_GetRootID]([m].[ID], [m].[ParentID]) AS root_ParentID
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwArtifactTypes] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Artifact Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Artifact Types
-- Item: Permissions for vwArtifactTypes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwArtifactTypes] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Artifact Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Artifact Types
-- Item: spCreateMJArtifactType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR ArtifactType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJArtifactType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJArtifactType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJArtifactType]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(100),
    @Description nvarchar(MAX),
    @ContentType nvarchar(100),
    @IsEnabled bit = NULL,
    @ParentID uniqueidentifier,
    @ExtractRules nvarchar(MAX),
    @DriverClass nvarchar(255),
    @Icon nvarchar(255)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @ActualID UNIQUEIDENTIFIER = ISNULL(@ID, NEWID())
    INSERT INTO
    [${flyway:defaultSchema}].[ArtifactType]
        (
            [Name],
                [Description],
                [ContentType],
                [IsEnabled],
                [ParentID],
                [ExtractRules],
                [DriverClass],
                [Icon],
                [ID]
        )
    VALUES
        (
            @Name,
                @Description,
                @ContentType,
                ISNULL(@IsEnabled, 1),
                @ParentID,
                @ExtractRules,
                @DriverClass,
                @Icon,
                @ActualID
        )
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwArtifactTypes] WHERE [ID] = @ActualID
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJArtifactType] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Artifact Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJArtifactType] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Artifact Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Artifact Types
-- Item: spUpdateMJArtifactType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR ArtifactType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJArtifactType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJArtifactType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJArtifactType]
    @ID uniqueidentifier,
    @Name nvarchar(100),
    @Description nvarchar(MAX),
    @ContentType nvarchar(100),
    @IsEnabled bit,
    @ParentID uniqueidentifier,
    @ExtractRules nvarchar(MAX),
    @DriverClass nvarchar(255),
    @Icon nvarchar(255)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ArtifactType]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [ContentType] = @ContentType,
        [IsEnabled] = @IsEnabled,
        [ParentID] = @ParentID,
        [ExtractRules] = @ExtractRules,
        [DriverClass] = @DriverClass,
        [Icon] = @Icon
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwArtifactTypes] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwArtifactTypes]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJArtifactType] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the ArtifactType table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJArtifactType]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJArtifactType];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJArtifactType
ON [${flyway:defaultSchema}].[ArtifactType]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ArtifactType]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[ArtifactType] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Artifact Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJArtifactType] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Artifact Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Artifact Types
-- Item: spDeleteMJArtifactType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR ArtifactType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJArtifactType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJArtifactType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJArtifactType]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[ArtifactType]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJArtifactType] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Artifact Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJArtifactType] TO [cdp_Integration]



/* Base View SQL for MJ: Artifact Version Attributes */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Artifact Version Attributes
-- Item: vwArtifactVersionAttributes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Artifact Version Attributes
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  ArtifactVersionAttribute
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwArtifactVersionAttributes]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwArtifactVersionAttributes];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwArtifactVersionAttributes]
AS
SELECT
    m.*,
    MJArtifactVersions_ArtifactVersionID.[Name] AS [ArtifactVersion]
FROM
    [${flyway:defaultSchema}].[ArtifactVersionAttribute] AS m
INNER JOIN
    [${flyway:defaultSchema}].[ArtifactVersion] AS MJArtifactVersions_ArtifactVersionID
  ON
    [m].[ArtifactVersionID] = MJArtifactVersions_ArtifactVersionID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwArtifactVersionAttributes] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Artifact Version Attributes */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Artifact Version Attributes
-- Item: Permissions for vwArtifactVersionAttributes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwArtifactVersionAttributes] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Artifact Version Attributes */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Artifact Version Attributes
-- Item: spCreateMJArtifactVersionAttribute
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR ArtifactVersionAttribute
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJArtifactVersionAttribute]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJArtifactVersionAttribute];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJArtifactVersionAttribute]
    @ID uniqueidentifier = NULL,
    @ArtifactVersionID uniqueidentifier,
    @Name nvarchar(255),
    @Type nvarchar(500),
    @Value nvarchar(MAX),
    @StandardProperty nvarchar(50)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[ArtifactVersionAttribute]
            (
                [ID],
                [ArtifactVersionID],
                [Name],
                [Type],
                [Value],
                [StandardProperty]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @ArtifactVersionID,
                @Name,
                @Type,
                @Value,
                @StandardProperty
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[ArtifactVersionAttribute]
            (
                [ArtifactVersionID],
                [Name],
                [Type],
                [Value],
                [StandardProperty]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ArtifactVersionID,
                @Name,
                @Type,
                @Value,
                @StandardProperty
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwArtifactVersionAttributes] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJArtifactVersionAttribute] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Artifact Version Attributes */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJArtifactVersionAttribute] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Artifact Version Attributes */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Artifact Version Attributes
-- Item: spUpdateMJArtifactVersionAttribute
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR ArtifactVersionAttribute
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJArtifactVersionAttribute]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJArtifactVersionAttribute];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJArtifactVersionAttribute]
    @ID uniqueidentifier,
    @ArtifactVersionID uniqueidentifier,
    @Name nvarchar(255),
    @Type nvarchar(500),
    @Value nvarchar(MAX),
    @StandardProperty nvarchar(50)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ArtifactVersionAttribute]
    SET
        [ArtifactVersionID] = @ArtifactVersionID,
        [Name] = @Name,
        [Type] = @Type,
        [Value] = @Value,
        [StandardProperty] = @StandardProperty
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwArtifactVersionAttributes] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwArtifactVersionAttributes]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJArtifactVersionAttribute] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the ArtifactVersionAttribute table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJArtifactVersionAttribute]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJArtifactVersionAttribute];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJArtifactVersionAttribute
ON [${flyway:defaultSchema}].[ArtifactVersionAttribute]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ArtifactVersionAttribute]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[ArtifactVersionAttribute] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Artifact Version Attributes */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJArtifactVersionAttribute] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Artifact Version Attributes */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Artifact Version Attributes
-- Item: spDeleteMJArtifactVersionAttribute
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR ArtifactVersionAttribute
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJArtifactVersionAttribute]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJArtifactVersionAttribute];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJArtifactVersionAttribute]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[ArtifactVersionAttribute]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJArtifactVersionAttribute] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Artifact Version Attributes */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJArtifactVersionAttribute] TO [cdp_Integration]



/* Base View SQL for MJ: Artifact Uses */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Artifact Uses
-- Item: vwArtifactUses
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Artifact Uses
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  ArtifactUse
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwArtifactUses]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwArtifactUses];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwArtifactUses]
AS
SELECT
    m.*,
    MJArtifactVersions_ArtifactVersionID.[Name] AS [ArtifactVersion],
    MJUsers_UserID.[Name] AS [User]
FROM
    [${flyway:defaultSchema}].[ArtifactUse] AS m
INNER JOIN
    [${flyway:defaultSchema}].[ArtifactVersion] AS MJArtifactVersions_ArtifactVersionID
  ON
    [m].[ArtifactVersionID] = MJArtifactVersions_ArtifactVersionID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_UserID
  ON
    [m].[UserID] = MJUsers_UserID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwArtifactUses] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Artifact Uses */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Artifact Uses
-- Item: Permissions for vwArtifactUses
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwArtifactUses] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Artifact Uses */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Artifact Uses
-- Item: spCreateMJArtifactUse
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR ArtifactUse
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJArtifactUse]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJArtifactUse];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJArtifactUse]
    @ID uniqueidentifier = NULL,
    @ArtifactVersionID uniqueidentifier,
    @UserID uniqueidentifier,
    @UsageType nvarchar(20),
    @UsageContext nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[ArtifactUse]
            (
                [ID],
                [ArtifactVersionID],
                [UserID],
                [UsageType],
                [UsageContext]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @ArtifactVersionID,
                @UserID,
                @UsageType,
                @UsageContext
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[ArtifactUse]
            (
                [ArtifactVersionID],
                [UserID],
                [UsageType],
                [UsageContext]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ArtifactVersionID,
                @UserID,
                @UsageType,
                @UsageContext
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwArtifactUses] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJArtifactUse] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Artifact Uses */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJArtifactUse] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Artifact Uses */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Artifact Uses
-- Item: spUpdateMJArtifactUse
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR ArtifactUse
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJArtifactUse]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJArtifactUse];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJArtifactUse]
    @ID uniqueidentifier,
    @ArtifactVersionID uniqueidentifier,
    @UserID uniqueidentifier,
    @UsageType nvarchar(20),
    @UsageContext nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ArtifactUse]
    SET
        [ArtifactVersionID] = @ArtifactVersionID,
        [UserID] = @UserID,
        [UsageType] = @UsageType,
        [UsageContext] = @UsageContext
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwArtifactUses] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwArtifactUses]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJArtifactUse] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the ArtifactUse table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJArtifactUse]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJArtifactUse];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJArtifactUse
ON [${flyway:defaultSchema}].[ArtifactUse]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ArtifactUse]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[ArtifactUse] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Artifact Uses */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJArtifactUse] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Artifact Uses */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Artifact Uses
-- Item: spDeleteMJArtifactUse
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR ArtifactUse
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJArtifactUse]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJArtifactUse];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJArtifactUse]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[ArtifactUse]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJArtifactUse] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Artifact Uses */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJArtifactUse] TO [cdp_Integration]



/* Base View SQL for MJ: Artifact Permissions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Artifact Permissions
-- Item: vwArtifactPermissions
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Artifact Permissions
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  ArtifactPermission
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwArtifactPermissions]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwArtifactPermissions];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwArtifactPermissions]
AS
SELECT
    m.*,
    MJArtifacts_ArtifactID.[Name] AS [Artifact],
    MJUsers_UserID.[Name] AS [User],
    MJUsers_SharedByUserID.[Name] AS [SharedByUser]
FROM
    [${flyway:defaultSchema}].[ArtifactPermission] AS m
INNER JOIN
    [${flyway:defaultSchema}].[Artifact] AS MJArtifacts_ArtifactID
  ON
    [m].[ArtifactID] = MJArtifacts_ArtifactID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_UserID
  ON
    [m].[UserID] = MJUsers_UserID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_SharedByUserID
  ON
    [m].[SharedByUserID] = MJUsers_SharedByUserID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwArtifactPermissions] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Artifact Permissions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Artifact Permissions
-- Item: Permissions for vwArtifactPermissions
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwArtifactPermissions] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Artifact Permissions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Artifact Permissions
-- Item: spCreateMJArtifactPermission
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR ArtifactPermission
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJArtifactPermission]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJArtifactPermission];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJArtifactPermission]
    @ID uniqueidentifier = NULL,
    @ArtifactID uniqueidentifier,
    @UserID uniqueidentifier,
    @CanRead bit = NULL,
    @CanEdit bit = NULL,
    @CanDelete bit = NULL,
    @CanShare bit = NULL,
    @SharedByUserID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[ArtifactPermission]
            (
                [ID],
                [ArtifactID],
                [UserID],
                [CanRead],
                [CanEdit],
                [CanDelete],
                [CanShare],
                [SharedByUserID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @ArtifactID,
                @UserID,
                ISNULL(@CanRead, 1),
                ISNULL(@CanEdit, 0),
                ISNULL(@CanDelete, 0),
                ISNULL(@CanShare, 0),
                @SharedByUserID
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[ArtifactPermission]
            (
                [ArtifactID],
                [UserID],
                [CanRead],
                [CanEdit],
                [CanDelete],
                [CanShare],
                [SharedByUserID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ArtifactID,
                @UserID,
                ISNULL(@CanRead, 1),
                ISNULL(@CanEdit, 0),
                ISNULL(@CanDelete, 0),
                ISNULL(@CanShare, 0),
                @SharedByUserID
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwArtifactPermissions] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJArtifactPermission] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Artifact Permissions */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJArtifactPermission] TO [cdp_UI], [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Artifact Permissions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Artifact Permissions
-- Item: spUpdateMJArtifactPermission
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR ArtifactPermission
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJArtifactPermission]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJArtifactPermission];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJArtifactPermission]
    @ID uniqueidentifier,
    @ArtifactID uniqueidentifier,
    @UserID uniqueidentifier,
    @CanRead bit,
    @CanEdit bit,
    @CanDelete bit,
    @CanShare bit,
    @SharedByUserID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ArtifactPermission]
    SET
        [ArtifactID] = @ArtifactID,
        [UserID] = @UserID,
        [CanRead] = @CanRead,
        [CanEdit] = @CanEdit,
        [CanDelete] = @CanDelete,
        [CanShare] = @CanShare,
        [SharedByUserID] = @SharedByUserID
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwArtifactPermissions] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwArtifactPermissions]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJArtifactPermission] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the ArtifactPermission table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJArtifactPermission]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJArtifactPermission];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJArtifactPermission
ON [${flyway:defaultSchema}].[ArtifactPermission]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ArtifactPermission]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[ArtifactPermission] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Artifact Permissions */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJArtifactPermission] TO [cdp_UI], [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Artifact Permissions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Artifact Permissions
-- Item: spDeleteMJArtifactPermission
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR ArtifactPermission
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJArtifactPermission]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJArtifactPermission];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJArtifactPermission]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[ArtifactPermission]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJArtifactPermission] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Artifact Permissions */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJArtifactPermission] TO [cdp_Integration]



/* Base View SQL for MJ: Artifact Versions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Artifact Versions
-- Item: vwArtifactVersions
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Artifact Versions
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  ArtifactVersion
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwArtifactVersions]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwArtifactVersions];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwArtifactVersions]
AS
SELECT
    m.*,
    MJArtifacts_ArtifactID.[Name] AS [Artifact],
    MJUsers_UserID.[Name] AS [User]
FROM
    [${flyway:defaultSchema}].[ArtifactVersion] AS m
INNER JOIN
    [${flyway:defaultSchema}].[Artifact] AS MJArtifacts_ArtifactID
  ON
    [m].[ArtifactID] = MJArtifacts_ArtifactID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_UserID
  ON
    [m].[UserID] = MJUsers_UserID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwArtifactVersions] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Artifact Versions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Artifact Versions
-- Item: Permissions for vwArtifactVersions
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwArtifactVersions] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Artifact Versions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Artifact Versions
-- Item: spCreateMJArtifactVersion
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR ArtifactVersion
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJArtifactVersion]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJArtifactVersion];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJArtifactVersion]
    @ID uniqueidentifier = NULL,
    @ArtifactID uniqueidentifier,
    @VersionNumber int,
    @Content nvarchar(MAX),
    @Configuration nvarchar(MAX),
    @Comments nvarchar(MAX),
    @UserID uniqueidentifier,
    @ContentHash nvarchar(500),
    @Name nvarchar(255),
    @Description nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[ArtifactVersion]
            (
                [ID],
                [ArtifactID],
                [VersionNumber],
                [Content],
                [Configuration],
                [Comments],
                [UserID],
                [ContentHash],
                [Name],
                [Description]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @ArtifactID,
                @VersionNumber,
                @Content,
                @Configuration,
                @Comments,
                @UserID,
                @ContentHash,
                @Name,
                @Description
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[ArtifactVersion]
            (
                [ArtifactID],
                [VersionNumber],
                [Content],
                [Configuration],
                [Comments],
                [UserID],
                [ContentHash],
                [Name],
                [Description]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ArtifactID,
                @VersionNumber,
                @Content,
                @Configuration,
                @Comments,
                @UserID,
                @ContentHash,
                @Name,
                @Description
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwArtifactVersions] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJArtifactVersion] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Artifact Versions */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJArtifactVersion] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Artifact Versions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Artifact Versions
-- Item: spUpdateMJArtifactVersion
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR ArtifactVersion
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJArtifactVersion]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJArtifactVersion];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJArtifactVersion]
    @ID uniqueidentifier,
    @ArtifactID uniqueidentifier,
    @VersionNumber int,
    @Content nvarchar(MAX),
    @Configuration nvarchar(MAX),
    @Comments nvarchar(MAX),
    @UserID uniqueidentifier,
    @ContentHash nvarchar(500),
    @Name nvarchar(255),
    @Description nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ArtifactVersion]
    SET
        [ArtifactID] = @ArtifactID,
        [VersionNumber] = @VersionNumber,
        [Content] = @Content,
        [Configuration] = @Configuration,
        [Comments] = @Comments,
        [UserID] = @UserID,
        [ContentHash] = @ContentHash,
        [Name] = @Name,
        [Description] = @Description
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwArtifactVersions] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwArtifactVersions]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJArtifactVersion] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the ArtifactVersion table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJArtifactVersion]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJArtifactVersion];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJArtifactVersion
ON [${flyway:defaultSchema}].[ArtifactVersion]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ArtifactVersion]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[ArtifactVersion] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Artifact Versions */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJArtifactVersion] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Artifact Versions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Artifact Versions
-- Item: spDeleteMJArtifactVersion
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR ArtifactVersion
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJArtifactVersion]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJArtifactVersion];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJArtifactVersion]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[ArtifactVersion]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJArtifactVersion] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Artifact Versions */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJArtifactVersion] TO [cdp_Integration]



/* Base View SQL for MJ: Audit Log Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Audit Log Types
-- Item: vwAuditLogTypes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Audit Log Types
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  AuditLogType
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwAuditLogTypes]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwAuditLogTypes];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwAuditLogTypes]
AS
SELECT
    m.*,
    MJAuditLogTypes_ParentID.[Name] AS [Parent],
    MJAuthorizations_AuthorizationID.[Name] AS [Authorization],
    root_ParentID.RootID AS [RootParentID]
FROM
    [${flyway:defaultSchema}].[AuditLogType] AS m
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[AuditLogType] AS MJAuditLogTypes_ParentID
  ON
    [m].[ParentID] = MJAuditLogTypes_ParentID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[Authorization] AS MJAuthorizations_AuthorizationID
  ON
    [m].[AuthorizationID] = MJAuthorizations_AuthorizationID.[ID]
OUTER APPLY
    [${flyway:defaultSchema}].[fnAuditLogTypeParentID_GetRootID]([m].[ID], [m].[ParentID]) AS root_ParentID
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwAuditLogTypes] TO [cdp_Developer], [cdp_UI], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Audit Log Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Audit Log Types
-- Item: Permissions for vwAuditLogTypes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwAuditLogTypes] TO [cdp_Developer], [cdp_UI], [cdp_Integration]

/* spCreate SQL for MJ: Audit Log Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Audit Log Types
-- Item: spCreateMJAuditLogType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR AuditLogType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJAuditLogType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJAuditLogType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJAuditLogType]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(50),
    @Description nvarchar(MAX),
    @ParentID uniqueidentifier,
    @AuthorizationID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[AuditLogType]
            (
                [ID],
                [Name],
                [Description],
                [ParentID],
                [AuthorizationID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description,
                @ParentID,
                @AuthorizationID
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[AuditLogType]
            (
                [Name],
                [Description],
                [ParentID],
                [AuthorizationID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description,
                @ParentID,
                @AuthorizationID
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwAuditLogTypes] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAuditLogType] TO [cdp_Developer]
    

/* spCreate Permissions for MJ: Audit Log Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAuditLogType] TO [cdp_Developer]



/* spUpdate SQL for MJ: Audit Log Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Audit Log Types
-- Item: spUpdateMJAuditLogType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR AuditLogType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJAuditLogType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAuditLogType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAuditLogType]
    @ID uniqueidentifier,
    @Name nvarchar(50),
    @Description nvarchar(MAX),
    @ParentID uniqueidentifier,
    @AuthorizationID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AuditLogType]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [ParentID] = @ParentID,
        [AuthorizationID] = @AuthorizationID
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwAuditLogTypes] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwAuditLogTypes]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAuditLogType] TO [cdp_Developer]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the AuditLogType table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJAuditLogType]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJAuditLogType];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJAuditLogType
ON [${flyway:defaultSchema}].[AuditLogType]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AuditLogType]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[AuditLogType] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Audit Log Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAuditLogType] TO [cdp_Developer]



/* spDelete SQL for MJ: Audit Log Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Audit Log Types
-- Item: spDeleteMJAuditLogType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR AuditLogType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJAuditLogType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAuditLogType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAuditLogType]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[AuditLogType]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAuditLogType] TO [cdp_Developer]
    

/* spDelete Permissions for MJ: Audit Log Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAuditLogType] TO [cdp_Developer]



/* Base View SQL for MJ: Artifacts */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Artifacts
-- Item: vwArtifacts
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Artifacts
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  Artifact
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwArtifacts]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwArtifacts];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwArtifacts]
AS
SELECT
    m.*,
    MJEnvironments_EnvironmentID.[Name] AS [Environment],
    MJArtifactTypes_TypeID.[Name] AS [Type],
    MJUsers_UserID.[Name] AS [User]
FROM
    [${flyway:defaultSchema}].[Artifact] AS m
INNER JOIN
    [${flyway:defaultSchema}].[Environment] AS MJEnvironments_EnvironmentID
  ON
    [m].[EnvironmentID] = MJEnvironments_EnvironmentID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[ArtifactType] AS MJArtifactTypes_TypeID
  ON
    [m].[TypeID] = MJArtifactTypes_TypeID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_UserID
  ON
    [m].[UserID] = MJUsers_UserID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwArtifacts] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Artifacts */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Artifacts
-- Item: Permissions for vwArtifacts
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwArtifacts] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Artifacts */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Artifacts
-- Item: spCreateMJArtifact
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR Artifact
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJArtifact]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJArtifact];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJArtifact]
    @ID uniqueidentifier = NULL,
    @EnvironmentID uniqueidentifier = NULL,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @TypeID uniqueidentifier,
    @Comments nvarchar(MAX),
    @UserID uniqueidentifier,
    @Visibility nvarchar(20) = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[Artifact]
            (
                [ID],
                [EnvironmentID],
                [Name],
                [Description],
                [TypeID],
                [Comments],
                [UserID],
                [Visibility]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                CASE @EnvironmentID WHEN '00000000-0000-0000-0000-000000000000' THEN 'F51358F3-9447-4176-B313-BF8025FD8D09' ELSE ISNULL(@EnvironmentID, 'F51358F3-9447-4176-B313-BF8025FD8D09') END,
                @Name,
                @Description,
                @TypeID,
                @Comments,
                @UserID,
                ISNULL(@Visibility, 'Always')
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[Artifact]
            (
                [EnvironmentID],
                [Name],
                [Description],
                [TypeID],
                [Comments],
                [UserID],
                [Visibility]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                CASE @EnvironmentID WHEN '00000000-0000-0000-0000-000000000000' THEN 'F51358F3-9447-4176-B313-BF8025FD8D09' ELSE ISNULL(@EnvironmentID, 'F51358F3-9447-4176-B313-BF8025FD8D09') END,
                @Name,
                @Description,
                @TypeID,
                @Comments,
                @UserID,
                ISNULL(@Visibility, 'Always')
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwArtifacts] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJArtifact] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Artifacts */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJArtifact] TO [cdp_UI], [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Artifacts */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Artifacts
-- Item: spUpdateMJArtifact
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR Artifact
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJArtifact]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJArtifact];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJArtifact]
    @ID uniqueidentifier,
    @EnvironmentID uniqueidentifier,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @TypeID uniqueidentifier,
    @Comments nvarchar(MAX),
    @UserID uniqueidentifier,
    @Visibility nvarchar(20)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[Artifact]
    SET
        [EnvironmentID] = @EnvironmentID,
        [Name] = @Name,
        [Description] = @Description,
        [TypeID] = @TypeID,
        [Comments] = @Comments,
        [UserID] = @UserID,
        [Visibility] = @Visibility
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwArtifacts] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwArtifacts]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJArtifact] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the Artifact table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJArtifact]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJArtifact];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJArtifact
ON [${flyway:defaultSchema}].[Artifact]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[Artifact]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[Artifact] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Artifacts */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJArtifact] TO [cdp_UI], [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Artifacts */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Artifacts
-- Item: spDeleteMJArtifact
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR Artifact
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJArtifact]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJArtifact];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJArtifact]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[Artifact]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJArtifact] TO [cdp_UI], [cdp_Integration]
    

/* spDelete Permissions for MJ: Artifacts */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJArtifact] TO [cdp_UI], [cdp_Integration]



/* Base View SQL for MJ: Authorization Roles */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Authorization Roles
-- Item: vwAuthorizationRoles
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Authorization Roles
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  AuthorizationRole
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwAuthorizationRoles]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwAuthorizationRoles];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwAuthorizationRoles]
AS
SELECT
    m.*,
    MJAuthorizations_AuthorizationID.[Name] AS [Authorization],
    MJRoles_RoleID.[Name] AS [Role]
FROM
    [${flyway:defaultSchema}].[AuthorizationRole] AS m
INNER JOIN
    [${flyway:defaultSchema}].[Authorization] AS MJAuthorizations_AuthorizationID
  ON
    [m].[AuthorizationID] = MJAuthorizations_AuthorizationID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[Role] AS MJRoles_RoleID
  ON
    [m].[RoleID] = MJRoles_RoleID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwAuthorizationRoles] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Authorization Roles */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Authorization Roles
-- Item: Permissions for vwAuthorizationRoles
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwAuthorizationRoles] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Authorization Roles */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Authorization Roles
-- Item: spCreateMJAuthorizationRole
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR AuthorizationRole
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJAuthorizationRole]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJAuthorizationRole];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJAuthorizationRole]
    @ID uniqueidentifier = NULL,
    @AuthorizationID uniqueidentifier,
    @RoleID uniqueidentifier,
    @Type nchar(10) = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[AuthorizationRole]
            (
                [ID],
                [AuthorizationID],
                [RoleID],
                [Type]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @AuthorizationID,
                @RoleID,
                ISNULL(@Type, 'grant')
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[AuthorizationRole]
            (
                [AuthorizationID],
                [RoleID],
                [Type]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @AuthorizationID,
                @RoleID,
                ISNULL(@Type, 'grant')
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwAuthorizationRoles] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAuthorizationRole] TO [cdp_Developer]
    

/* spCreate Permissions for MJ: Authorization Roles */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAuthorizationRole] TO [cdp_Developer]



/* spUpdate SQL for MJ: Authorization Roles */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Authorization Roles
-- Item: spUpdateMJAuthorizationRole
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR AuthorizationRole
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJAuthorizationRole]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAuthorizationRole];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAuthorizationRole]
    @ID uniqueidentifier,
    @AuthorizationID uniqueidentifier,
    @RoleID uniqueidentifier,
    @Type nchar(10)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AuthorizationRole]
    SET
        [AuthorizationID] = @AuthorizationID,
        [RoleID] = @RoleID,
        [Type] = @Type
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwAuthorizationRoles] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwAuthorizationRoles]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAuthorizationRole] TO [cdp_Developer]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the AuthorizationRole table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJAuthorizationRole]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJAuthorizationRole];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJAuthorizationRole
ON [${flyway:defaultSchema}].[AuthorizationRole]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AuthorizationRole]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[AuthorizationRole] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Authorization Roles */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAuthorizationRole] TO [cdp_Developer]



/* spDelete SQL for MJ: Authorization Roles */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Authorization Roles
-- Item: spDeleteMJAuthorizationRole
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR AuthorizationRole
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJAuthorizationRole]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAuthorizationRole];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAuthorizationRole]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[AuthorizationRole]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAuthorizationRole] TO [cdp_Developer]
    

/* spDelete Permissions for MJ: Authorization Roles */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAuthorizationRole] TO [cdp_Developer]



/* Base View SQL for MJ: Audit Logs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Audit Logs
-- Item: vwAuditLogs
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Audit Logs
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  AuditLog
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwAuditLogs]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwAuditLogs];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwAuditLogs]
AS
SELECT
    m.*,
    MJUsers_UserID.[Name] AS [User],
    MJAuditLogTypes_AuditLogTypeID.[Name] AS [AuditLogType],
    MJAuthorizations_AuthorizationID.[Name] AS [Authorization],
    MJEntities_EntityID.[Name] AS [Entity]
FROM
    [${flyway:defaultSchema}].[AuditLog] AS m
INNER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_UserID
  ON
    [m].[UserID] = MJUsers_UserID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[AuditLogType] AS MJAuditLogTypes_AuditLogTypeID
  ON
    [m].[AuditLogTypeID] = MJAuditLogTypes_AuditLogTypeID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[Authorization] AS MJAuthorizations_AuthorizationID
  ON
    [m].[AuthorizationID] = MJAuthorizations_AuthorizationID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[Entity] AS MJEntities_EntityID
  ON
    [m].[EntityID] = MJEntities_EntityID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwAuditLogs] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Audit Logs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Audit Logs
-- Item: Permissions for vwAuditLogs
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwAuditLogs] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Audit Logs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Audit Logs
-- Item: spCreateMJAuditLog
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR AuditLog
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJAuditLog]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJAuditLog];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJAuditLog]
    @ID uniqueidentifier = NULL,
    @UserID uniqueidentifier,
    @AuditLogTypeID uniqueidentifier,
    @AuthorizationID uniqueidentifier,
    @Status nvarchar(50) = NULL,
    @Description nvarchar(MAX),
    @Details nvarchar(MAX),
    @EntityID uniqueidentifier,
    @RecordID nvarchar(450)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[AuditLog]
            (
                [ID],
                [UserID],
                [AuditLogTypeID],
                [AuthorizationID],
                [Status],
                [Description],
                [Details],
                [EntityID],
                [RecordID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @UserID,
                @AuditLogTypeID,
                @AuthorizationID,
                ISNULL(@Status, 'Allow'),
                @Description,
                @Details,
                @EntityID,
                @RecordID
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[AuditLog]
            (
                [UserID],
                [AuditLogTypeID],
                [AuthorizationID],
                [Status],
                [Description],
                [Details],
                [EntityID],
                [RecordID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @UserID,
                @AuditLogTypeID,
                @AuthorizationID,
                ISNULL(@Status, 'Allow'),
                @Description,
                @Details,
                @EntityID,
                @RecordID
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwAuditLogs] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAuditLog] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Audit Logs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAuditLog] TO [cdp_UI], [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Audit Logs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Audit Logs
-- Item: spUpdateMJAuditLog
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR AuditLog
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJAuditLog]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAuditLog];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAuditLog]
    @ID uniqueidentifier,
    @UserID uniqueidentifier,
    @AuditLogTypeID uniqueidentifier,
    @AuthorizationID uniqueidentifier,
    @Status nvarchar(50),
    @Description nvarchar(MAX),
    @Details nvarchar(MAX),
    @EntityID uniqueidentifier,
    @RecordID nvarchar(450)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AuditLog]
    SET
        [UserID] = @UserID,
        [AuditLogTypeID] = @AuditLogTypeID,
        [AuthorizationID] = @AuthorizationID,
        [Status] = @Status,
        [Description] = @Description,
        [Details] = @Details,
        [EntityID] = @EntityID,
        [RecordID] = @RecordID
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwAuditLogs] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwAuditLogs]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAuditLog] TO [cdp_Developer]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the AuditLog table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJAuditLog]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJAuditLog];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJAuditLog
ON [${flyway:defaultSchema}].[AuditLog]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[AuditLog]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[AuditLog] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Audit Logs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAuditLog] TO [cdp_Developer]



/* spDelete SQL for MJ: Audit Logs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Audit Logs
-- Item: spDeleteMJAuditLog
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR AuditLog
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJAuditLog]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAuditLog];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAuditLog]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[AuditLog]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAuditLog] TO [cdp_Developer]
    

/* spDelete Permissions for MJ: Audit Logs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJAuditLog] TO [cdp_Developer]



/* Base View SQL for MJ: Authorizations */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Authorizations
-- Item: vwAuthorizations
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Authorizations
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  Authorization
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwAuthorizations]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwAuthorizations];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwAuthorizations]
AS
SELECT
    m.*,
    MJAuthorizations_ParentID.[Name] AS [Parent],
    root_ParentID.RootID AS [RootParentID]
FROM
    [${flyway:defaultSchema}].[Authorization] AS m
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[Authorization] AS MJAuthorizations_ParentID
  ON
    [m].[ParentID] = MJAuthorizations_ParentID.[ID]
OUTER APPLY
    [${flyway:defaultSchema}].[fnAuthorizationParentID_GetRootID]([m].[ID], [m].[ParentID]) AS root_ParentID
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwAuthorizations] TO [cdp_Developer], [cdp_Integration], [cdp_UI]
    

/* Base View Permissions SQL for MJ: Authorizations */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Authorizations
-- Item: Permissions for vwAuthorizations
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwAuthorizations] TO [cdp_Developer], [cdp_Integration], [cdp_UI]

/* spCreate SQL for MJ: Authorizations */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Authorizations
-- Item: spCreateMJAuthorization
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR Authorization
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJAuthorization]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJAuthorization];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJAuthorization]
    @ID uniqueidentifier = NULL,
    @ParentID uniqueidentifier,
    @Name nvarchar(100),
    @IsActive bit = NULL,
    @UseAuditLog bit = NULL,
    @Description nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[Authorization]
            (
                [ID],
                [ParentID],
                [Name],
                [IsActive],
                [UseAuditLog],
                [Description]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @ParentID,
                @Name,
                ISNULL(@IsActive, 1),
                ISNULL(@UseAuditLog, 1),
                @Description
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[Authorization]
            (
                [ParentID],
                [Name],
                [IsActive],
                [UseAuditLog],
                [Description]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ParentID,
                @Name,
                ISNULL(@IsActive, 1),
                ISNULL(@UseAuditLog, 1),
                @Description
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwAuthorizations] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAuthorization] TO [cdp_Developer]
    

/* spCreate Permissions for MJ: Authorizations */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJAuthorization] TO [cdp_Developer]



/* spUpdate SQL for MJ: Authorizations */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Authorizations
-- Item: spUpdateMJAuthorization
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR Authorization
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJAuthorization]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAuthorization];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJAuthorization]
    @ID uniqueidentifier,
    @ParentID uniqueidentifier,
    @Name nvarchar(100),
    @IsActive bit,
    @UseAuditLog bit,
    @Description nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[Authorization]
    SET
        [ParentID] = @ParentID,
        [Name] = @Name,
        [IsActive] = @IsActive,
        [UseAuditLog] = @UseAuditLog,
        [Description] = @Description
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwAuthorizations] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwAuthorizations]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAuthorization] TO [cdp_Developer]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the Authorization table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJAuthorization]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJAuthorization];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJAuthorization
ON [${flyway:defaultSchema}].[Authorization]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[Authorization]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[Authorization] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Authorizations */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJAuthorization] TO [cdp_Developer]



/* spDelete SQL for MJ: Authorizations */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Authorizations
-- Item: spDeleteMJAuthorization
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR Authorization
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJAuthorization]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAuthorization];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJAuthorization]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[Authorization]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
    

/* spDelete Permissions for MJ: Authorizations */




/* Base View SQL for MJ: Collections */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Collections
-- Item: vwCollections
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Collections
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  Collection
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwCollections]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwCollections];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwCollections]
AS
SELECT
    m.*,
    MJEnvironments_EnvironmentID.[Name] AS [Environment],
    MJCollections_ParentID.[Name] AS [Parent],
    MJUsers_OwnerID.[Name] AS [Owner],
    root_ParentID.RootID AS [RootParentID]
FROM
    [${flyway:defaultSchema}].[Collection] AS m
INNER JOIN
    [${flyway:defaultSchema}].[Environment] AS MJEnvironments_EnvironmentID
  ON
    [m].[EnvironmentID] = MJEnvironments_EnvironmentID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[Collection] AS MJCollections_ParentID
  ON
    [m].[ParentID] = MJCollections_ParentID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_OwnerID
  ON
    [m].[OwnerID] = MJUsers_OwnerID.[ID]
OUTER APPLY
    [${flyway:defaultSchema}].[fnCollectionParentID_GetRootID]([m].[ID], [m].[ParentID]) AS root_ParentID
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwCollections] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Collections */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Collections
-- Item: Permissions for vwCollections
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwCollections] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Collections */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Collections
-- Item: spCreateMJCollection
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR Collection
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJCollection]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJCollection];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJCollection]
    @ID uniqueidentifier = NULL,
    @EnvironmentID uniqueidentifier = NULL,
    @ParentID uniqueidentifier,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @Icon nvarchar(50),
    @Color nvarchar(7),
    @Sequence int,
    @OwnerID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[Collection]
            (
                [ID],
                [EnvironmentID],
                [ParentID],
                [Name],
                [Description],
                [Icon],
                [Color],
                [Sequence],
                [OwnerID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                CASE @EnvironmentID WHEN '00000000-0000-0000-0000-000000000000' THEN 'F51358F3-9447-4176-B313-BF8025FD8D09' ELSE ISNULL(@EnvironmentID, 'F51358F3-9447-4176-B313-BF8025FD8D09') END,
                @ParentID,
                @Name,
                @Description,
                @Icon,
                @Color,
                @Sequence,
                @OwnerID
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[Collection]
            (
                [EnvironmentID],
                [ParentID],
                [Name],
                [Description],
                [Icon],
                [Color],
                [Sequence],
                [OwnerID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                CASE @EnvironmentID WHEN '00000000-0000-0000-0000-000000000000' THEN 'F51358F3-9447-4176-B313-BF8025FD8D09' ELSE ISNULL(@EnvironmentID, 'F51358F3-9447-4176-B313-BF8025FD8D09') END,
                @ParentID,
                @Name,
                @Description,
                @Icon,
                @Color,
                @Sequence,
                @OwnerID
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwCollections] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJCollection] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Collections */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJCollection] TO [cdp_UI], [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Collections */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Collections
-- Item: spUpdateMJCollection
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR Collection
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJCollection]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJCollection];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJCollection]
    @ID uniqueidentifier,
    @EnvironmentID uniqueidentifier,
    @ParentID uniqueidentifier,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @Icon nvarchar(50),
    @Color nvarchar(7),
    @Sequence int,
    @OwnerID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[Collection]
    SET
        [EnvironmentID] = @EnvironmentID,
        [ParentID] = @ParentID,
        [Name] = @Name,
        [Description] = @Description,
        [Icon] = @Icon,
        [Color] = @Color,
        [Sequence] = @Sequence,
        [OwnerID] = @OwnerID
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwCollections] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwCollections]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJCollection] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the Collection table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJCollection]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJCollection];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJCollection
ON [${flyway:defaultSchema}].[Collection]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[Collection]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[Collection] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Collections */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJCollection] TO [cdp_UI], [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Collections */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Collections
-- Item: spDeleteMJCollection
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR Collection
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJCollection]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJCollection];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJCollection]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[Collection]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJCollection] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* spDelete Permissions for MJ: Collections */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJCollection] TO [cdp_UI], [cdp_Developer], [cdp_Integration]



/* Base View SQL for MJ: Collection Artifacts */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Collection Artifacts
-- Item: vwCollectionArtifacts
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Collection Artifacts
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  CollectionArtifact
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwCollectionArtifacts]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwCollectionArtifacts];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwCollectionArtifacts]
AS
SELECT
    m.*,
    MJCollections_CollectionID.[Name] AS [Collection],
    MJArtifactVersions_ArtifactVersionID.[Name] AS [ArtifactVersion]
FROM
    [${flyway:defaultSchema}].[CollectionArtifact] AS m
INNER JOIN
    [${flyway:defaultSchema}].[Collection] AS MJCollections_CollectionID
  ON
    [m].[CollectionID] = MJCollections_CollectionID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[ArtifactVersion] AS MJArtifactVersions_ArtifactVersionID
  ON
    [m].[ArtifactVersionID] = MJArtifactVersions_ArtifactVersionID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwCollectionArtifacts] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Collection Artifacts */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Collection Artifacts
-- Item: Permissions for vwCollectionArtifacts
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwCollectionArtifacts] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Collection Artifacts */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Collection Artifacts
-- Item: spCreateMJCollectionArtifact
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR CollectionArtifact
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJCollectionArtifact]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJCollectionArtifact];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJCollectionArtifact]
    @ID uniqueidentifier = NULL,
    @CollectionID uniqueidentifier,
    @Sequence int = NULL,
    @ArtifactVersionID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[CollectionArtifact]
            (
                [ID],
                [CollectionID],
                [Sequence],
                [ArtifactVersionID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @CollectionID,
                ISNULL(@Sequence, 0),
                @ArtifactVersionID
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[CollectionArtifact]
            (
                [CollectionID],
                [Sequence],
                [ArtifactVersionID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @CollectionID,
                ISNULL(@Sequence, 0),
                @ArtifactVersionID
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwCollectionArtifacts] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJCollectionArtifact] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Collection Artifacts */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJCollectionArtifact] TO [cdp_UI], [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Collection Artifacts */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Collection Artifacts
-- Item: spUpdateMJCollectionArtifact
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR CollectionArtifact
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJCollectionArtifact]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJCollectionArtifact];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJCollectionArtifact]
    @ID uniqueidentifier,
    @CollectionID uniqueidentifier,
    @Sequence int,
    @ArtifactVersionID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[CollectionArtifact]
    SET
        [CollectionID] = @CollectionID,
        [Sequence] = @Sequence,
        [ArtifactVersionID] = @ArtifactVersionID
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwCollectionArtifacts] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwCollectionArtifacts]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJCollectionArtifact] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the CollectionArtifact table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJCollectionArtifact]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJCollectionArtifact];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJCollectionArtifact
ON [${flyway:defaultSchema}].[CollectionArtifact]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[CollectionArtifact]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[CollectionArtifact] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Collection Artifacts */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJCollectionArtifact] TO [cdp_UI], [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Collection Artifacts */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Collection Artifacts
-- Item: spDeleteMJCollectionArtifact
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR CollectionArtifact
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJCollectionArtifact]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJCollectionArtifact];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJCollectionArtifact]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[CollectionArtifact]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJCollectionArtifact] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* spDelete Permissions for MJ: Collection Artifacts */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJCollectionArtifact] TO [cdp_UI], [cdp_Developer], [cdp_Integration]



/* Base View SQL for MJ: Communication Logs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Communication Logs
-- Item: vwCommunicationLogs
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Communication Logs
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  CommunicationLog
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwCommunicationLogs]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwCommunicationLogs];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwCommunicationLogs]
AS
SELECT
    m.*,
    MJCommunicationProviders_CommunicationProviderID.[Name] AS [CommunicationProvider],
    MJCommunicationProviderMessageTypes_CommunicationProviderMessageTypeID.[Name] AS [CommunicationProviderMessageType],
    MJCommunicationRuns_CommunicationRunID.[User] AS [CommunicationRun]
FROM
    [${flyway:defaultSchema}].[CommunicationLog] AS m
INNER JOIN
    [${flyway:defaultSchema}].[CommunicationProvider] AS MJCommunicationProviders_CommunicationProviderID
  ON
    [m].[CommunicationProviderID] = MJCommunicationProviders_CommunicationProviderID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[CommunicationProviderMessageType] AS MJCommunicationProviderMessageTypes_CommunicationProviderMessageTypeID
  ON
    [m].[CommunicationProviderMessageTypeID] = MJCommunicationProviderMessageTypes_CommunicationProviderMessageTypeID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[vwCommunicationRuns] AS MJCommunicationRuns_CommunicationRunID
  ON
    [m].[CommunicationRunID] = MJCommunicationRuns_CommunicationRunID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwCommunicationLogs] TO [cdp_Developer], [cdp_Integration], [cdp_UI]
    

/* Base View Permissions SQL for MJ: Communication Logs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Communication Logs
-- Item: Permissions for vwCommunicationLogs
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwCommunicationLogs] TO [cdp_Developer], [cdp_Integration], [cdp_UI]

/* spCreate SQL for MJ: Communication Logs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Communication Logs
-- Item: spCreateMJCommunicationLog
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR CommunicationLog
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJCommunicationLog]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJCommunicationLog];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJCommunicationLog]
    @ID uniqueidentifier = NULL,
    @CommunicationProviderID uniqueidentifier,
    @CommunicationProviderMessageTypeID uniqueidentifier,
    @CommunicationRunID uniqueidentifier,
    @Direction nvarchar(20),
    @MessageDate datetimeoffset,
    @Status nvarchar(20) = NULL,
    @MessageContent nvarchar(MAX),
    @ErrorMessage nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[CommunicationLog]
            (
                [ID],
                [CommunicationProviderID],
                [CommunicationProviderMessageTypeID],
                [CommunicationRunID],
                [Direction],
                [MessageDate],
                [Status],
                [MessageContent],
                [ErrorMessage]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @CommunicationProviderID,
                @CommunicationProviderMessageTypeID,
                @CommunicationRunID,
                @Direction,
                @MessageDate,
                ISNULL(@Status, 'Pending'),
                @MessageContent,
                @ErrorMessage
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[CommunicationLog]
            (
                [CommunicationProviderID],
                [CommunicationProviderMessageTypeID],
                [CommunicationRunID],
                [Direction],
                [MessageDate],
                [Status],
                [MessageContent],
                [ErrorMessage]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @CommunicationProviderID,
                @CommunicationProviderMessageTypeID,
                @CommunicationRunID,
                @Direction,
                @MessageDate,
                ISNULL(@Status, 'Pending'),
                @MessageContent,
                @ErrorMessage
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwCommunicationLogs] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJCommunicationLog] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Communication Logs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJCommunicationLog] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Communication Logs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Communication Logs
-- Item: spUpdateMJCommunicationLog
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR CommunicationLog
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJCommunicationLog]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJCommunicationLog];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJCommunicationLog]
    @ID uniqueidentifier,
    @CommunicationProviderID uniqueidentifier,
    @CommunicationProviderMessageTypeID uniqueidentifier,
    @CommunicationRunID uniqueidentifier,
    @Direction nvarchar(20),
    @MessageDate datetimeoffset,
    @Status nvarchar(20),
    @MessageContent nvarchar(MAX),
    @ErrorMessage nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[CommunicationLog]
    SET
        [CommunicationProviderID] = @CommunicationProviderID,
        [CommunicationProviderMessageTypeID] = @CommunicationProviderMessageTypeID,
        [CommunicationRunID] = @CommunicationRunID,
        [Direction] = @Direction,
        [MessageDate] = @MessageDate,
        [Status] = @Status,
        [MessageContent] = @MessageContent,
        [ErrorMessage] = @ErrorMessage
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwCommunicationLogs] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwCommunicationLogs]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJCommunicationLog] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the CommunicationLog table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJCommunicationLog]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJCommunicationLog];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJCommunicationLog
ON [${flyway:defaultSchema}].[CommunicationLog]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[CommunicationLog]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[CommunicationLog] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Communication Logs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJCommunicationLog] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Communication Logs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Communication Logs
-- Item: spDeleteMJCommunicationLog
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR CommunicationLog
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJCommunicationLog]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJCommunicationLog];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJCommunicationLog]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[CommunicationLog]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJCommunicationLog] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Communication Logs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJCommunicationLog] TO [cdp_Integration]



/* Base View SQL for MJ: Collection Permissions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Collection Permissions
-- Item: vwCollectionPermissions
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Collection Permissions
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  CollectionPermission
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwCollectionPermissions]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwCollectionPermissions];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwCollectionPermissions]
AS
SELECT
    m.*,
    MJCollections_CollectionID.[Name] AS [Collection],
    MJUsers_UserID.[Name] AS [User],
    MJUsers_SharedByUserID.[Name] AS [SharedByUser]
FROM
    [${flyway:defaultSchema}].[CollectionPermission] AS m
INNER JOIN
    [${flyway:defaultSchema}].[Collection] AS MJCollections_CollectionID
  ON
    [m].[CollectionID] = MJCollections_CollectionID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_UserID
  ON
    [m].[UserID] = MJUsers_UserID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_SharedByUserID
  ON
    [m].[SharedByUserID] = MJUsers_SharedByUserID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwCollectionPermissions] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Collection Permissions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Collection Permissions
-- Item: Permissions for vwCollectionPermissions
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwCollectionPermissions] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Collection Permissions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Collection Permissions
-- Item: spCreateMJCollectionPermission
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR CollectionPermission
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJCollectionPermission]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJCollectionPermission];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJCollectionPermission]
    @ID uniqueidentifier = NULL,
    @CollectionID uniqueidentifier,
    @UserID uniqueidentifier,
    @CanRead bit = NULL,
    @CanShare bit = NULL,
    @CanEdit bit = NULL,
    @CanDelete bit = NULL,
    @SharedByUserID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[CollectionPermission]
            (
                [ID],
                [CollectionID],
                [UserID],
                [CanRead],
                [CanShare],
                [CanEdit],
                [CanDelete],
                [SharedByUserID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @CollectionID,
                @UserID,
                ISNULL(@CanRead, 1),
                ISNULL(@CanShare, 0),
                ISNULL(@CanEdit, 0),
                ISNULL(@CanDelete, 0),
                @SharedByUserID
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[CollectionPermission]
            (
                [CollectionID],
                [UserID],
                [CanRead],
                [CanShare],
                [CanEdit],
                [CanDelete],
                [SharedByUserID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @CollectionID,
                @UserID,
                ISNULL(@CanRead, 1),
                ISNULL(@CanShare, 0),
                ISNULL(@CanEdit, 0),
                ISNULL(@CanDelete, 0),
                @SharedByUserID
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwCollectionPermissions] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJCollectionPermission] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Collection Permissions */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJCollectionPermission] TO [cdp_UI], [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Collection Permissions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Collection Permissions
-- Item: spUpdateMJCollectionPermission
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR CollectionPermission
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJCollectionPermission]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJCollectionPermission];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJCollectionPermission]
    @ID uniqueidentifier,
    @CollectionID uniqueidentifier,
    @UserID uniqueidentifier,
    @CanRead bit,
    @CanShare bit,
    @CanEdit bit,
    @CanDelete bit,
    @SharedByUserID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[CollectionPermission]
    SET
        [CollectionID] = @CollectionID,
        [UserID] = @UserID,
        [CanRead] = @CanRead,
        [CanShare] = @CanShare,
        [CanEdit] = @CanEdit,
        [CanDelete] = @CanDelete,
        [SharedByUserID] = @SharedByUserID
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwCollectionPermissions] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwCollectionPermissions]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJCollectionPermission] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the CollectionPermission table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJCollectionPermission]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJCollectionPermission];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJCollectionPermission
ON [${flyway:defaultSchema}].[CollectionPermission]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[CollectionPermission]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[CollectionPermission] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Collection Permissions */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJCollectionPermission] TO [cdp_UI], [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Collection Permissions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Collection Permissions
-- Item: spDeleteMJCollectionPermission
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR CollectionPermission
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJCollectionPermission]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJCollectionPermission];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJCollectionPermission]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[CollectionPermission]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJCollectionPermission] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Collection Permissions */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJCollectionPermission] TO [cdp_Integration]



/* Base View SQL for MJ: Communication Base Message Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Communication Base Message Types
-- Item: vwCommunicationBaseMessageTypes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Communication Base Message Types
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  CommunicationBaseMessageType
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwCommunicationBaseMessageTypes]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwCommunicationBaseMessageTypes];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwCommunicationBaseMessageTypes]
AS
SELECT
    m.*
FROM
    [${flyway:defaultSchema}].[CommunicationBaseMessageType] AS m
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwCommunicationBaseMessageTypes] TO [cdp_UI], [cdp_Integration], [cdp_Developer]
    

/* Base View Permissions SQL for MJ: Communication Base Message Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Communication Base Message Types
-- Item: Permissions for vwCommunicationBaseMessageTypes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwCommunicationBaseMessageTypes] TO [cdp_UI], [cdp_Integration], [cdp_Developer]

/* spCreate SQL for MJ: Communication Base Message Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Communication Base Message Types
-- Item: spCreateMJCommunicationBaseMessageType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR CommunicationBaseMessageType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJCommunicationBaseMessageType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJCommunicationBaseMessageType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJCommunicationBaseMessageType]
    @ID uniqueidentifier = NULL,
    @Type nvarchar(100),
    @SupportsAttachments bit = NULL,
    @SupportsSubjectLine bit = NULL,
    @SupportsHtml bit = NULL,
    @MaxBytes int
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[CommunicationBaseMessageType]
            (
                [ID],
                [Type],
                [SupportsAttachments],
                [SupportsSubjectLine],
                [SupportsHtml],
                [MaxBytes]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Type,
                ISNULL(@SupportsAttachments, 0),
                ISNULL(@SupportsSubjectLine, 0),
                ISNULL(@SupportsHtml, 0),
                @MaxBytes
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[CommunicationBaseMessageType]
            (
                [Type],
                [SupportsAttachments],
                [SupportsSubjectLine],
                [SupportsHtml],
                [MaxBytes]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Type,
                ISNULL(@SupportsAttachments, 0),
                ISNULL(@SupportsSubjectLine, 0),
                ISNULL(@SupportsHtml, 0),
                @MaxBytes
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwCommunicationBaseMessageTypes] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJCommunicationBaseMessageType] TO [cdp_Integration], [cdp_Developer]
    

/* spCreate Permissions for MJ: Communication Base Message Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJCommunicationBaseMessageType] TO [cdp_Integration], [cdp_Developer]



/* spUpdate SQL for MJ: Communication Base Message Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Communication Base Message Types
-- Item: spUpdateMJCommunicationBaseMessageType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR CommunicationBaseMessageType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJCommunicationBaseMessageType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJCommunicationBaseMessageType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJCommunicationBaseMessageType]
    @ID uniqueidentifier,
    @Type nvarchar(100),
    @SupportsAttachments bit,
    @SupportsSubjectLine bit,
    @SupportsHtml bit,
    @MaxBytes int
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[CommunicationBaseMessageType]
    SET
        [Type] = @Type,
        [SupportsAttachments] = @SupportsAttachments,
        [SupportsSubjectLine] = @SupportsSubjectLine,
        [SupportsHtml] = @SupportsHtml,
        [MaxBytes] = @MaxBytes
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwCommunicationBaseMessageTypes] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwCommunicationBaseMessageTypes]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJCommunicationBaseMessageType] TO [cdp_Integration], [cdp_Developer]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the CommunicationBaseMessageType table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJCommunicationBaseMessageType]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJCommunicationBaseMessageType];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJCommunicationBaseMessageType
ON [${flyway:defaultSchema}].[CommunicationBaseMessageType]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[CommunicationBaseMessageType]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[CommunicationBaseMessageType] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Communication Base Message Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJCommunicationBaseMessageType] TO [cdp_Integration], [cdp_Developer]



/* spDelete SQL for MJ: Communication Base Message Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Communication Base Message Types
-- Item: spDeleteMJCommunicationBaseMessageType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR CommunicationBaseMessageType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJCommunicationBaseMessageType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJCommunicationBaseMessageType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJCommunicationBaseMessageType]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[CommunicationBaseMessageType]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJCommunicationBaseMessageType] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Communication Base Message Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJCommunicationBaseMessageType] TO [cdp_Integration]



/* Base View SQL for MJ: Communication Runs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Communication Runs
-- Item: vwCommunicationRuns
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Communication Runs
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  CommunicationRun
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwCommunicationRuns]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwCommunicationRuns];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwCommunicationRuns]
AS
SELECT
    m.*,
    MJUsers_UserID.[Name] AS [User]
FROM
    [${flyway:defaultSchema}].[CommunicationRun] AS m
INNER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_UserID
  ON
    [m].[UserID] = MJUsers_UserID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwCommunicationRuns] TO [cdp_Developer], [cdp_UI], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Communication Runs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Communication Runs
-- Item: Permissions for vwCommunicationRuns
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwCommunicationRuns] TO [cdp_Developer], [cdp_UI], [cdp_Integration]

/* spCreate SQL for MJ: Communication Runs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Communication Runs
-- Item: spCreateMJCommunicationRun
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR CommunicationRun
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJCommunicationRun]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJCommunicationRun];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJCommunicationRun]
    @ID uniqueidentifier = NULL,
    @UserID uniqueidentifier,
    @Direction nvarchar(20),
    @Status nvarchar(20),
    @StartedAt datetimeoffset,
    @EndedAt datetimeoffset,
    @Comments nvarchar(MAX),
    @ErrorMessage nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[CommunicationRun]
            (
                [ID],
                [UserID],
                [Direction],
                [Status],
                [StartedAt],
                [EndedAt],
                [Comments],
                [ErrorMessage]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @UserID,
                @Direction,
                @Status,
                @StartedAt,
                @EndedAt,
                @Comments,
                @ErrorMessage
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[CommunicationRun]
            (
                [UserID],
                [Direction],
                [Status],
                [StartedAt],
                [EndedAt],
                [Comments],
                [ErrorMessage]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @UserID,
                @Direction,
                @Status,
                @StartedAt,
                @EndedAt,
                @Comments,
                @ErrorMessage
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwCommunicationRuns] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJCommunicationRun] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Communication Runs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJCommunicationRun] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Communication Runs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Communication Runs
-- Item: spUpdateMJCommunicationRun
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR CommunicationRun
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJCommunicationRun]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJCommunicationRun];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJCommunicationRun]
    @ID uniqueidentifier,
    @UserID uniqueidentifier,
    @Direction nvarchar(20),
    @Status nvarchar(20),
    @StartedAt datetimeoffset,
    @EndedAt datetimeoffset,
    @Comments nvarchar(MAX),
    @ErrorMessage nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[CommunicationRun]
    SET
        [UserID] = @UserID,
        [Direction] = @Direction,
        [Status] = @Status,
        [StartedAt] = @StartedAt,
        [EndedAt] = @EndedAt,
        [Comments] = @Comments,
        [ErrorMessage] = @ErrorMessage
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwCommunicationRuns] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwCommunicationRuns]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJCommunicationRun] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the CommunicationRun table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJCommunicationRun]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJCommunicationRun];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJCommunicationRun
ON [${flyway:defaultSchema}].[CommunicationRun]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[CommunicationRun]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[CommunicationRun] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Communication Runs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJCommunicationRun] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Communication Runs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Communication Runs
-- Item: spDeleteMJCommunicationRun
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR CommunicationRun
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJCommunicationRun]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJCommunicationRun];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJCommunicationRun]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[CommunicationRun]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJCommunicationRun] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Communication Runs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJCommunicationRun] TO [cdp_Integration]



/* Base View SQL for MJ: Company Integration Record Maps */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Company Integration Record Maps
-- Item: vwCompanyIntegrationRecordMaps
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Company Integration Record Maps
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  CompanyIntegrationRecordMap
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwCompanyIntegrationRecordMaps]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwCompanyIntegrationRecordMaps];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwCompanyIntegrationRecordMaps]
AS
SELECT
    m.*,
    MJCompanyIntegrations_CompanyIntegrationID.[Name] AS [CompanyIntegration],
    MJEntities_EntityID.[Name] AS [Entity]
FROM
    [${flyway:defaultSchema}].[CompanyIntegrationRecordMap] AS m
INNER JOIN
    [${flyway:defaultSchema}].[CompanyIntegration] AS MJCompanyIntegrations_CompanyIntegrationID
  ON
    [m].[CompanyIntegrationID] = MJCompanyIntegrations_CompanyIntegrationID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[Entity] AS MJEntities_EntityID
  ON
    [m].[EntityID] = MJEntities_EntityID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwCompanyIntegrationRecordMaps] TO [cdp_UI], [cdp_Integration], [cdp_Developer]
    

/* Base View Permissions SQL for MJ: Company Integration Record Maps */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Company Integration Record Maps
-- Item: Permissions for vwCompanyIntegrationRecordMaps
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwCompanyIntegrationRecordMaps] TO [cdp_UI], [cdp_Integration], [cdp_Developer]

/* spCreate SQL for MJ: Company Integration Record Maps */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Company Integration Record Maps
-- Item: spCreateMJCompanyIntegrationRecordMap
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR CompanyIntegrationRecordMap
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJCompanyIntegrationRecordMap]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJCompanyIntegrationRecordMap];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJCompanyIntegrationRecordMap]
    @ID uniqueidentifier = NULL,
    @CompanyIntegrationID uniqueidentifier,
    @ExternalSystemRecordID nvarchar(750),
    @EntityID uniqueidentifier,
    @EntityRecordID nvarchar(750)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[CompanyIntegrationRecordMap]
            (
                [ID],
                [CompanyIntegrationID],
                [ExternalSystemRecordID],
                [EntityID],
                [EntityRecordID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @CompanyIntegrationID,
                @ExternalSystemRecordID,
                @EntityID,
                @EntityRecordID
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[CompanyIntegrationRecordMap]
            (
                [CompanyIntegrationID],
                [ExternalSystemRecordID],
                [EntityID],
                [EntityRecordID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @CompanyIntegrationID,
                @ExternalSystemRecordID,
                @EntityID,
                @EntityRecordID
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwCompanyIntegrationRecordMaps] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJCompanyIntegrationRecordMap] TO [cdp_Integration], [cdp_Developer]
    

/* spCreate Permissions for MJ: Company Integration Record Maps */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJCompanyIntegrationRecordMap] TO [cdp_Integration], [cdp_Developer]



/* spUpdate SQL for MJ: Company Integration Record Maps */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Company Integration Record Maps
-- Item: spUpdateMJCompanyIntegrationRecordMap
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR CompanyIntegrationRecordMap
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJCompanyIntegrationRecordMap]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJCompanyIntegrationRecordMap];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJCompanyIntegrationRecordMap]
    @ID uniqueidentifier,
    @CompanyIntegrationID uniqueidentifier,
    @ExternalSystemRecordID nvarchar(750),
    @EntityID uniqueidentifier,
    @EntityRecordID nvarchar(750)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[CompanyIntegrationRecordMap]
    SET
        [CompanyIntegrationID] = @CompanyIntegrationID,
        [ExternalSystemRecordID] = @ExternalSystemRecordID,
        [EntityID] = @EntityID,
        [EntityRecordID] = @EntityRecordID
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwCompanyIntegrationRecordMaps] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwCompanyIntegrationRecordMaps]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJCompanyIntegrationRecordMap] TO [cdp_Integration], [cdp_Developer]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the CompanyIntegrationRecordMap table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJCompanyIntegrationRecordMap]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJCompanyIntegrationRecordMap];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJCompanyIntegrationRecordMap
ON [${flyway:defaultSchema}].[CompanyIntegrationRecordMap]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[CompanyIntegrationRecordMap]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[CompanyIntegrationRecordMap] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Company Integration Record Maps */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJCompanyIntegrationRecordMap] TO [cdp_Integration], [cdp_Developer]



/* spDelete SQL for MJ: Company Integration Record Maps */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Company Integration Record Maps
-- Item: spDeleteMJCompanyIntegrationRecordMap
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR CompanyIntegrationRecordMap
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJCompanyIntegrationRecordMap]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJCompanyIntegrationRecordMap];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJCompanyIntegrationRecordMap]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[CompanyIntegrationRecordMap]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJCompanyIntegrationRecordMap] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Company Integration Record Maps */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJCompanyIntegrationRecordMap] TO [cdp_Integration]



/* Base View SQL for MJ: Communication Provider Message Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Communication Provider Message Types
-- Item: vwCommunicationProviderMessageTypes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Communication Provider Message Types
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  CommunicationProviderMessageType
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwCommunicationProviderMessageTypes]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwCommunicationProviderMessageTypes];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwCommunicationProviderMessageTypes]
AS
SELECT
    m.*,
    MJCommunicationProviders_CommunicationProviderID.[Name] AS [CommunicationProvider],
    MJCommunicationBaseMessageTypes_CommunicationBaseMessageTypeID.[Type] AS [CommunicationBaseMessageType]
FROM
    [${flyway:defaultSchema}].[CommunicationProviderMessageType] AS m
INNER JOIN
    [${flyway:defaultSchema}].[CommunicationProvider] AS MJCommunicationProviders_CommunicationProviderID
  ON
    [m].[CommunicationProviderID] = MJCommunicationProviders_CommunicationProviderID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[CommunicationBaseMessageType] AS MJCommunicationBaseMessageTypes_CommunicationBaseMessageTypeID
  ON
    [m].[CommunicationBaseMessageTypeID] = MJCommunicationBaseMessageTypes_CommunicationBaseMessageTypeID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwCommunicationProviderMessageTypes] TO [cdp_Integration], [cdp_UI], [cdp_Developer]
    

/* Base View Permissions SQL for MJ: Communication Provider Message Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Communication Provider Message Types
-- Item: Permissions for vwCommunicationProviderMessageTypes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwCommunicationProviderMessageTypes] TO [cdp_Integration], [cdp_UI], [cdp_Developer]

/* spCreate SQL for MJ: Communication Provider Message Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Communication Provider Message Types
-- Item: spCreateMJCommunicationProviderMessageType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR CommunicationProviderMessageType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJCommunicationProviderMessageType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJCommunicationProviderMessageType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJCommunicationProviderMessageType]
    @ID uniqueidentifier = NULL,
    @CommunicationProviderID uniqueidentifier,
    @CommunicationBaseMessageTypeID uniqueidentifier,
    @Name nvarchar(255),
    @Status nvarchar(20) = NULL,
    @AdditionalAttributes nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[CommunicationProviderMessageType]
            (
                [ID],
                [CommunicationProviderID],
                [CommunicationBaseMessageTypeID],
                [Name],
                [Status],
                [AdditionalAttributes]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @CommunicationProviderID,
                @CommunicationBaseMessageTypeID,
                @Name,
                ISNULL(@Status, 'Disabled'),
                @AdditionalAttributes
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[CommunicationProviderMessageType]
            (
                [CommunicationProviderID],
                [CommunicationBaseMessageTypeID],
                [Name],
                [Status],
                [AdditionalAttributes]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @CommunicationProviderID,
                @CommunicationBaseMessageTypeID,
                @Name,
                ISNULL(@Status, 'Disabled'),
                @AdditionalAttributes
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwCommunicationProviderMessageTypes] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJCommunicationProviderMessageType] TO [cdp_Integration], [cdp_Developer]
    

/* spCreate Permissions for MJ: Communication Provider Message Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJCommunicationProviderMessageType] TO [cdp_Integration], [cdp_Developer]



/* spUpdate SQL for MJ: Communication Provider Message Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Communication Provider Message Types
-- Item: spUpdateMJCommunicationProviderMessageType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR CommunicationProviderMessageType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJCommunicationProviderMessageType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJCommunicationProviderMessageType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJCommunicationProviderMessageType]
    @ID uniqueidentifier,
    @CommunicationProviderID uniqueidentifier,
    @CommunicationBaseMessageTypeID uniqueidentifier,
    @Name nvarchar(255),
    @Status nvarchar(20),
    @AdditionalAttributes nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[CommunicationProviderMessageType]
    SET
        [CommunicationProviderID] = @CommunicationProviderID,
        [CommunicationBaseMessageTypeID] = @CommunicationBaseMessageTypeID,
        [Name] = @Name,
        [Status] = @Status,
        [AdditionalAttributes] = @AdditionalAttributes
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwCommunicationProviderMessageTypes] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwCommunicationProviderMessageTypes]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJCommunicationProviderMessageType] TO [cdp_Integration], [cdp_Developer]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the CommunicationProviderMessageType table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJCommunicationProviderMessageType]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJCommunicationProviderMessageType];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJCommunicationProviderMessageType
ON [${flyway:defaultSchema}].[CommunicationProviderMessageType]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[CommunicationProviderMessageType]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[CommunicationProviderMessageType] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Communication Provider Message Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJCommunicationProviderMessageType] TO [cdp_Integration], [cdp_Developer]



/* spDelete SQL for MJ: Communication Provider Message Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Communication Provider Message Types
-- Item: spDeleteMJCommunicationProviderMessageType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR CommunicationProviderMessageType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJCommunicationProviderMessageType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJCommunicationProviderMessageType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJCommunicationProviderMessageType]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[CommunicationProviderMessageType]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJCommunicationProviderMessageType] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Communication Provider Message Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJCommunicationProviderMessageType] TO [cdp_Integration]



/* Base View SQL for MJ: Companies */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Companies
-- Item: vwCompanies
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Companies
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  Company
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwCompanies]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwCompanies];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwCompanies]
AS
SELECT
    m.*
FROM
    [${flyway:defaultSchema}].[Company] AS m
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwCompanies] TO [cdp_UI], [cdp_Integration], [cdp_Developer]
    

/* Base View Permissions SQL for MJ: Companies */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Companies
-- Item: Permissions for vwCompanies
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwCompanies] TO [cdp_UI], [cdp_Integration], [cdp_Developer]

/* spCreate SQL for MJ: Companies */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Companies
-- Item: spCreateMJCompany
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR Company
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJCompany]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJCompany];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJCompany]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(50),
    @Description nvarchar(200),
    @Website nvarchar(100),
    @LogoURL nvarchar(500),
    @Domain nvarchar(255)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[Company]
            (
                [ID],
                [Name],
                [Description],
                [Website],
                [LogoURL],
                [Domain]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description,
                @Website,
                @LogoURL,
                @Domain
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[Company]
            (
                [Name],
                [Description],
                [Website],
                [LogoURL],
                [Domain]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description,
                @Website,
                @LogoURL,
                @Domain
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwCompanies] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJCompany] TO [cdp_UI], [cdp_Integration], [cdp_Developer]
    

/* spCreate Permissions for MJ: Companies */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJCompany] TO [cdp_UI], [cdp_Integration], [cdp_Developer]



/* spUpdate SQL for MJ: Companies */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Companies
-- Item: spUpdateMJCompany
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR Company
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJCompany]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJCompany];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJCompany]
    @ID uniqueidentifier,
    @Name nvarchar(50),
    @Description nvarchar(200),
    @Website nvarchar(100),
    @LogoURL nvarchar(500),
    @Domain nvarchar(255)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[Company]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [Website] = @Website,
        [LogoURL] = @LogoURL,
        [Domain] = @Domain
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwCompanies] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwCompanies]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJCompany] TO [cdp_UI], [cdp_Integration], [cdp_Developer]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the Company table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJCompany]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJCompany];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJCompany
ON [${flyway:defaultSchema}].[Company]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[Company]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[Company] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Companies */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJCompany] TO [cdp_UI], [cdp_Integration], [cdp_Developer]



/* spDelete SQL for MJ: Companies */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Companies
-- Item: spDeleteMJCompany
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR Company
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJCompany]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJCompany];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJCompany]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[Company]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJCompany] TO [cdp_Integration], [cdp_Developer]
    

/* spDelete Permissions for MJ: Companies */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJCompany] TO [cdp_Integration], [cdp_Developer]



/* Base View SQL for MJ: Communication Providers */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Communication Providers
-- Item: vwCommunicationProviders
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Communication Providers
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  CommunicationProvider
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwCommunicationProviders]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwCommunicationProviders];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwCommunicationProviders]
AS
SELECT
    m.*
FROM
    [${flyway:defaultSchema}].[CommunicationProvider] AS m
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwCommunicationProviders] TO [cdp_UI], [cdp_Integration], [cdp_Developer]
    

/* Base View Permissions SQL for MJ: Communication Providers */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Communication Providers
-- Item: Permissions for vwCommunicationProviders
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwCommunicationProviders] TO [cdp_UI], [cdp_Integration], [cdp_Developer]

/* spCreate SQL for MJ: Communication Providers */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Communication Providers
-- Item: spCreateMJCommunicationProvider
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR CommunicationProvider
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJCommunicationProvider]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJCommunicationProvider];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJCommunicationProvider]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @Status nvarchar(20) = NULL,
    @SupportsSending bit = NULL,
    @SupportsReceiving bit = NULL,
    @SupportsScheduledSending bit = NULL,
    @SupportsForwarding bit = NULL,
    @SupportsReplying bit = NULL,
    @SupportsDrafts bit = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[CommunicationProvider]
            (
                [ID],
                [Name],
                [Description],
                [Status],
                [SupportsSending],
                [SupportsReceiving],
                [SupportsScheduledSending],
                [SupportsForwarding],
                [SupportsReplying],
                [SupportsDrafts]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description,
                ISNULL(@Status, 'Disabled'),
                ISNULL(@SupportsSending, 1),
                ISNULL(@SupportsReceiving, 0),
                ISNULL(@SupportsScheduledSending, 0),
                ISNULL(@SupportsForwarding, 0),
                ISNULL(@SupportsReplying, 0),
                ISNULL(@SupportsDrafts, 0)
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[CommunicationProvider]
            (
                [Name],
                [Description],
                [Status],
                [SupportsSending],
                [SupportsReceiving],
                [SupportsScheduledSending],
                [SupportsForwarding],
                [SupportsReplying],
                [SupportsDrafts]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description,
                ISNULL(@Status, 'Disabled'),
                ISNULL(@SupportsSending, 1),
                ISNULL(@SupportsReceiving, 0),
                ISNULL(@SupportsScheduledSending, 0),
                ISNULL(@SupportsForwarding, 0),
                ISNULL(@SupportsReplying, 0),
                ISNULL(@SupportsDrafts, 0)
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwCommunicationProviders] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJCommunicationProvider] TO [cdp_Integration], [cdp_Developer]
    

/* spCreate Permissions for MJ: Communication Providers */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJCommunicationProvider] TO [cdp_Integration], [cdp_Developer]



/* spUpdate SQL for MJ: Communication Providers */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Communication Providers
-- Item: spUpdateMJCommunicationProvider
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR CommunicationProvider
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJCommunicationProvider]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJCommunicationProvider];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJCommunicationProvider]
    @ID uniqueidentifier,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @Status nvarchar(20),
    @SupportsSending bit,
    @SupportsReceiving bit,
    @SupportsScheduledSending bit,
    @SupportsForwarding bit,
    @SupportsReplying bit,
    @SupportsDrafts bit
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[CommunicationProvider]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [Status] = @Status,
        [SupportsSending] = @SupportsSending,
        [SupportsReceiving] = @SupportsReceiving,
        [SupportsScheduledSending] = @SupportsScheduledSending,
        [SupportsForwarding] = @SupportsForwarding,
        [SupportsReplying] = @SupportsReplying,
        [SupportsDrafts] = @SupportsDrafts
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwCommunicationProviders] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwCommunicationProviders]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJCommunicationProvider] TO [cdp_Integration], [cdp_Developer]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the CommunicationProvider table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJCommunicationProvider]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJCommunicationProvider];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJCommunicationProvider
ON [${flyway:defaultSchema}].[CommunicationProvider]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[CommunicationProvider]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[CommunicationProvider] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Communication Providers */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJCommunicationProvider] TO [cdp_Integration], [cdp_Developer]



/* spDelete SQL for MJ: Communication Providers */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Communication Providers
-- Item: spDeleteMJCommunicationProvider
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR CommunicationProvider
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJCommunicationProvider]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJCommunicationProvider];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJCommunicationProvider]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[CommunicationProvider]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJCommunicationProvider] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Communication Providers */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJCommunicationProvider] TO [cdp_Integration]



/* Base View SQL for MJ: Company Integration Run API Logs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Company Integration Run API Logs
-- Item: vwCompanyIntegrationRunAPILogs
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Company Integration Run API Logs
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  CompanyIntegrationRunAPILog
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwCompanyIntegrationRunAPILogs]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwCompanyIntegrationRunAPILogs];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwCompanyIntegrationRunAPILogs]
AS
SELECT
    m.*,
    MJCompanyIntegrationRuns_CompanyIntegrationRunID.[Integration] AS [CompanyIntegrationRun]
FROM
    [${flyway:defaultSchema}].[CompanyIntegrationRunAPILog] AS m
INNER JOIN
    [${flyway:defaultSchema}].[vwCompanyIntegrationRuns] AS MJCompanyIntegrationRuns_CompanyIntegrationRunID
  ON
    [m].[CompanyIntegrationRunID] = MJCompanyIntegrationRuns_CompanyIntegrationRunID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwCompanyIntegrationRunAPILogs] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Company Integration Run API Logs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Company Integration Run API Logs
-- Item: Permissions for vwCompanyIntegrationRunAPILogs
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwCompanyIntegrationRunAPILogs] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Company Integration Run API Logs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Company Integration Run API Logs
-- Item: spCreateMJCompanyIntegrationRunAPILog
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR CompanyIntegrationRunAPILog
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJCompanyIntegrationRunAPILog]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJCompanyIntegrationRunAPILog];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJCompanyIntegrationRunAPILog]
    @ID uniqueidentifier = NULL,
    @CompanyIntegrationRunID uniqueidentifier,
    @ExecutedAt datetimeoffset = NULL,
    @IsSuccess bit = NULL,
    @RequestMethod nvarchar(12),
    @URL nvarchar(MAX),
    @Parameters nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[CompanyIntegrationRunAPILog]
            (
                [ID],
                [CompanyIntegrationRunID],
                [ExecutedAt],
                [IsSuccess],
                [RequestMethod],
                [URL],
                [Parameters]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @CompanyIntegrationRunID,
                ISNULL(@ExecutedAt, sysdatetimeoffset()),
                ISNULL(@IsSuccess, 0),
                @RequestMethod,
                @URL,
                @Parameters
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[CompanyIntegrationRunAPILog]
            (
                [CompanyIntegrationRunID],
                [ExecutedAt],
                [IsSuccess],
                [RequestMethod],
                [URL],
                [Parameters]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @CompanyIntegrationRunID,
                ISNULL(@ExecutedAt, sysdatetimeoffset()),
                ISNULL(@IsSuccess, 0),
                @RequestMethod,
                @URL,
                @Parameters
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwCompanyIntegrationRunAPILogs] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJCompanyIntegrationRunAPILog] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Company Integration Run API Logs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJCompanyIntegrationRunAPILog] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Company Integration Run API Logs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Company Integration Run API Logs
-- Item: spUpdateMJCompanyIntegrationRunAPILog
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR CompanyIntegrationRunAPILog
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJCompanyIntegrationRunAPILog]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJCompanyIntegrationRunAPILog];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJCompanyIntegrationRunAPILog]
    @ID uniqueidentifier,
    @CompanyIntegrationRunID uniqueidentifier,
    @ExecutedAt datetimeoffset,
    @IsSuccess bit,
    @RequestMethod nvarchar(12),
    @URL nvarchar(MAX),
    @Parameters nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[CompanyIntegrationRunAPILog]
    SET
        [CompanyIntegrationRunID] = @CompanyIntegrationRunID,
        [ExecutedAt] = @ExecutedAt,
        [IsSuccess] = @IsSuccess,
        [RequestMethod] = @RequestMethod,
        [URL] = @URL,
        [Parameters] = @Parameters
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwCompanyIntegrationRunAPILogs] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwCompanyIntegrationRunAPILogs]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJCompanyIntegrationRunAPILog] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the CompanyIntegrationRunAPILog table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJCompanyIntegrationRunAPILog]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJCompanyIntegrationRunAPILog];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJCompanyIntegrationRunAPILog
ON [${flyway:defaultSchema}].[CompanyIntegrationRunAPILog]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[CompanyIntegrationRunAPILog]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[CompanyIntegrationRunAPILog] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Company Integration Run API Logs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJCompanyIntegrationRunAPILog] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Company Integration Run API Logs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Company Integration Run API Logs
-- Item: spDeleteMJCompanyIntegrationRunAPILog
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR CompanyIntegrationRunAPILog
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJCompanyIntegrationRunAPILog]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJCompanyIntegrationRunAPILog];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJCompanyIntegrationRunAPILog]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[CompanyIntegrationRunAPILog]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJCompanyIntegrationRunAPILog] TO [cdp_Developer], [cdp_Integration]
    

/* spDelete Permissions for MJ: Company Integration Run API Logs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJCompanyIntegrationRunAPILog] TO [cdp_Developer], [cdp_Integration]



/* Base View SQL for MJ: Component Dependencies */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Component Dependencies
-- Item: vwComponentDependencies
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Component Dependencies
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  ComponentDependency
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwComponentDependencies]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwComponentDependencies];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwComponentDependencies]
AS
SELECT
    m.*,
    MJComponents_ComponentID.[Name] AS [Component],
    MJComponents_DependencyComponentID.[Name] AS [DependencyComponent]
FROM
    [${flyway:defaultSchema}].[ComponentDependency] AS m
INNER JOIN
    [${flyway:defaultSchema}].[Component] AS MJComponents_ComponentID
  ON
    [m].[ComponentID] = MJComponents_ComponentID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[Component] AS MJComponents_DependencyComponentID
  ON
    [m].[DependencyComponentID] = MJComponents_DependencyComponentID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwComponentDependencies] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Component Dependencies */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Component Dependencies
-- Item: Permissions for vwComponentDependencies
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwComponentDependencies] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Component Dependencies */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Component Dependencies
-- Item: spCreateMJComponentDependency
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR ComponentDependency
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJComponentDependency]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJComponentDependency];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJComponentDependency]
    @ID uniqueidentifier = NULL,
    @ComponentID uniqueidentifier,
    @DependencyComponentID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[ComponentDependency]
            (
                [ID],
                [ComponentID],
                [DependencyComponentID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @ComponentID,
                @DependencyComponentID
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[ComponentDependency]
            (
                [ComponentID],
                [DependencyComponentID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ComponentID,
                @DependencyComponentID
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwComponentDependencies] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJComponentDependency] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Component Dependencies */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJComponentDependency] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Component Dependencies */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Component Dependencies
-- Item: spUpdateMJComponentDependency
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR ComponentDependency
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJComponentDependency]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJComponentDependency];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJComponentDependency]
    @ID uniqueidentifier,
    @ComponentID uniqueidentifier,
    @DependencyComponentID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ComponentDependency]
    SET
        [ComponentID] = @ComponentID,
        [DependencyComponentID] = @DependencyComponentID
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwComponentDependencies] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwComponentDependencies]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJComponentDependency] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the ComponentDependency table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJComponentDependency]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJComponentDependency];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJComponentDependency
ON [${flyway:defaultSchema}].[ComponentDependency]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ComponentDependency]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[ComponentDependency] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Component Dependencies */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJComponentDependency] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Component Dependencies */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Component Dependencies
-- Item: spDeleteMJComponentDependency
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR ComponentDependency
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJComponentDependency]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJComponentDependency];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJComponentDependency]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[ComponentDependency]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJComponentDependency] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Component Dependencies */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJComponentDependency] TO [cdp_Integration]



/* Base View SQL for MJ: Component Libraries */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Component Libraries
-- Item: vwComponentLibraries
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Component Libraries
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  ComponentLibrary
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwComponentLibraries]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwComponentLibraries];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwComponentLibraries]
AS
SELECT
    m.*
FROM
    [${flyway:defaultSchema}].[ComponentLibrary] AS m
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwComponentLibraries] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Component Libraries */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Component Libraries
-- Item: Permissions for vwComponentLibraries
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwComponentLibraries] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Component Libraries */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Component Libraries
-- Item: spCreateMJComponentLibrary
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR ComponentLibrary
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJComponentLibrary]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJComponentLibrary];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJComponentLibrary]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(500),
    @DisplayName nvarchar(500),
    @Version nvarchar(100),
    @GlobalVariable nvarchar(255),
    @Category nvarchar(100),
    @CDNUrl nvarchar(1000),
    @CDNCssUrl nvarchar(1000),
    @Description nvarchar(MAX),
    @Status nvarchar(20) = NULL,
    @LintRules nvarchar(MAX),
    @Dependencies nvarchar(MAX),
    @UsageType nvarchar(50) = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[ComponentLibrary]
            (
                [ID],
                [Name],
                [DisplayName],
                [Version],
                [GlobalVariable],
                [Category],
                [CDNUrl],
                [CDNCssUrl],
                [Description],
                [Status],
                [LintRules],
                [Dependencies],
                [UsageType]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @DisplayName,
                @Version,
                @GlobalVariable,
                @Category,
                @CDNUrl,
                @CDNCssUrl,
                @Description,
                ISNULL(@Status, 'Active'),
                @LintRules,
                @Dependencies,
                ISNULL(@UsageType, 'Both')
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[ComponentLibrary]
            (
                [Name],
                [DisplayName],
                [Version],
                [GlobalVariable],
                [Category],
                [CDNUrl],
                [CDNCssUrl],
                [Description],
                [Status],
                [LintRules],
                [Dependencies],
                [UsageType]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @DisplayName,
                @Version,
                @GlobalVariable,
                @Category,
                @CDNUrl,
                @CDNCssUrl,
                @Description,
                ISNULL(@Status, 'Active'),
                @LintRules,
                @Dependencies,
                ISNULL(@UsageType, 'Both')
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwComponentLibraries] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJComponentLibrary] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Component Libraries */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJComponentLibrary] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Component Libraries */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Component Libraries
-- Item: spUpdateMJComponentLibrary
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR ComponentLibrary
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJComponentLibrary]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJComponentLibrary];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJComponentLibrary]
    @ID uniqueidentifier,
    @Name nvarchar(500),
    @DisplayName nvarchar(500),
    @Version nvarchar(100),
    @GlobalVariable nvarchar(255),
    @Category nvarchar(100),
    @CDNUrl nvarchar(1000),
    @CDNCssUrl nvarchar(1000),
    @Description nvarchar(MAX),
    @Status nvarchar(20),
    @LintRules nvarchar(MAX),
    @Dependencies nvarchar(MAX),
    @UsageType nvarchar(50)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ComponentLibrary]
    SET
        [Name] = @Name,
        [DisplayName] = @DisplayName,
        [Version] = @Version,
        [GlobalVariable] = @GlobalVariable,
        [Category] = @Category,
        [CDNUrl] = @CDNUrl,
        [CDNCssUrl] = @CDNCssUrl,
        [Description] = @Description,
        [Status] = @Status,
        [LintRules] = @LintRules,
        [Dependencies] = @Dependencies,
        [UsageType] = @UsageType
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwComponentLibraries] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwComponentLibraries]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJComponentLibrary] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the ComponentLibrary table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJComponentLibrary]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJComponentLibrary];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJComponentLibrary
ON [${flyway:defaultSchema}].[ComponentLibrary]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ComponentLibrary]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[ComponentLibrary] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Component Libraries */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJComponentLibrary] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Component Libraries */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Component Libraries
-- Item: spDeleteMJComponentLibrary
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR ComponentLibrary
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJComponentLibrary]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJComponentLibrary];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJComponentLibrary]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[ComponentLibrary]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJComponentLibrary] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Component Libraries */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJComponentLibrary] TO [cdp_Integration]



/* Base View SQL for MJ: Component Registries */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Component Registries
-- Item: vwComponentRegistries
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Component Registries
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  ComponentRegistry
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwComponentRegistries]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwComponentRegistries];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwComponentRegistries]
AS
SELECT
    m.*
FROM
    [${flyway:defaultSchema}].[ComponentRegistry] AS m
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwComponentRegistries] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Component Registries */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Component Registries
-- Item: Permissions for vwComponentRegistries
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwComponentRegistries] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Component Registries */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Component Registries
-- Item: spCreateMJComponentRegistry
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR ComponentRegistry
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJComponentRegistry]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJComponentRegistry];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJComponentRegistry]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @URI nvarchar(500),
    @Type nvarchar(50),
    @APIVersion nvarchar(50),
    @Status nvarchar(50)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[ComponentRegistry]
            (
                [ID],
                [Name],
                [Description],
                [URI],
                [Type],
                [APIVersion],
                [Status]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description,
                @URI,
                @Type,
                @APIVersion,
                @Status
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[ComponentRegistry]
            (
                [Name],
                [Description],
                [URI],
                [Type],
                [APIVersion],
                [Status]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description,
                @URI,
                @Type,
                @APIVersion,
                @Status
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwComponentRegistries] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJComponentRegistry] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Component Registries */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJComponentRegistry] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Component Registries */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Component Registries
-- Item: spUpdateMJComponentRegistry
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR ComponentRegistry
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJComponentRegistry]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJComponentRegistry];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJComponentRegistry]
    @ID uniqueidentifier,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @URI nvarchar(500),
    @Type nvarchar(50),
    @APIVersion nvarchar(50),
    @Status nvarchar(50)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ComponentRegistry]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [URI] = @URI,
        [Type] = @Type,
        [APIVersion] = @APIVersion,
        [Status] = @Status
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwComponentRegistries] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwComponentRegistries]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJComponentRegistry] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the ComponentRegistry table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJComponentRegistry]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJComponentRegistry];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJComponentRegistry
ON [${flyway:defaultSchema}].[ComponentRegistry]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ComponentRegistry]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[ComponentRegistry] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Component Registries */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJComponentRegistry] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Component Registries */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Component Registries
-- Item: spDeleteMJComponentRegistry
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR ComponentRegistry
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJComponentRegistry]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJComponentRegistry];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJComponentRegistry]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[ComponentRegistry]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJComponentRegistry] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Component Registries */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJComponentRegistry] TO [cdp_Integration]



/* Base View SQL for MJ: Component Library Links */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Component Library Links
-- Item: vwComponentLibraryLinks
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Component Library Links
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  ComponentLibraryLink
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwComponentLibraryLinks]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwComponentLibraryLinks];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwComponentLibraryLinks]
AS
SELECT
    m.*,
    MJComponents_ComponentID.[Name] AS [Component],
    MJComponentLibraries_LibraryID.[Name] AS [Library]
FROM
    [${flyway:defaultSchema}].[ComponentLibraryLink] AS m
INNER JOIN
    [${flyway:defaultSchema}].[Component] AS MJComponents_ComponentID
  ON
    [m].[ComponentID] = MJComponents_ComponentID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[ComponentLibrary] AS MJComponentLibraries_LibraryID
  ON
    [m].[LibraryID] = MJComponentLibraries_LibraryID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwComponentLibraryLinks] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Component Library Links */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Component Library Links
-- Item: Permissions for vwComponentLibraryLinks
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwComponentLibraryLinks] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Component Library Links */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Component Library Links
-- Item: spCreateMJComponentLibraryLink
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR ComponentLibraryLink
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJComponentLibraryLink]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJComponentLibraryLink];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJComponentLibraryLink]
    @ID uniqueidentifier = NULL,
    @ComponentID uniqueidentifier,
    @LibraryID uniqueidentifier,
    @MinVersion nvarchar(100)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[ComponentLibraryLink]
            (
                [ID],
                [ComponentID],
                [LibraryID],
                [MinVersion]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @ComponentID,
                @LibraryID,
                @MinVersion
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[ComponentLibraryLink]
            (
                [ComponentID],
                [LibraryID],
                [MinVersion]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ComponentID,
                @LibraryID,
                @MinVersion
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwComponentLibraryLinks] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJComponentLibraryLink] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Component Library Links */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJComponentLibraryLink] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Component Library Links */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Component Library Links
-- Item: spUpdateMJComponentLibraryLink
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR ComponentLibraryLink
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJComponentLibraryLink]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJComponentLibraryLink];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJComponentLibraryLink]
    @ID uniqueidentifier,
    @ComponentID uniqueidentifier,
    @LibraryID uniqueidentifier,
    @MinVersion nvarchar(100)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ComponentLibraryLink]
    SET
        [ComponentID] = @ComponentID,
        [LibraryID] = @LibraryID,
        [MinVersion] = @MinVersion
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwComponentLibraryLinks] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwComponentLibraryLinks]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJComponentLibraryLink] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the ComponentLibraryLink table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJComponentLibraryLink]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJComponentLibraryLink];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJComponentLibraryLink
ON [${flyway:defaultSchema}].[ComponentLibraryLink]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ComponentLibraryLink]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[ComponentLibraryLink] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Component Library Links */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJComponentLibraryLink] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Component Library Links */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Component Library Links
-- Item: spDeleteMJComponentLibraryLink
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR ComponentLibraryLink
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJComponentLibraryLink]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJComponentLibraryLink];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJComponentLibraryLink]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[ComponentLibraryLink]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJComponentLibraryLink] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Component Library Links */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJComponentLibraryLink] TO [cdp_Integration]



/* Base View SQL for MJ: Components */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Components
-- Item: vwComponents
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Components
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  Component
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwComponents]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwComponents];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwComponents]
AS
SELECT
    m.*,
    MJComponentRegistries_SourceRegistryID.[Name] AS [SourceRegistry]
FROM
    [${flyway:defaultSchema}].[Component] AS m
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[ComponentRegistry] AS MJComponentRegistries_SourceRegistryID
  ON
    [m].[SourceRegistryID] = MJComponentRegistries_SourceRegistryID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwComponents] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Components */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Components
-- Item: Permissions for vwComponents
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwComponents] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Components */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Components
-- Item: spCreateMJComponent
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR Component
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJComponent]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJComponent];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJComponent]
    @ID uniqueidentifier = NULL,
    @Namespace nvarchar(MAX),
    @Name nvarchar(500),
    @Version nvarchar(50),
    @VersionSequence int = NULL,
    @Title nvarchar(1000),
    @Description nvarchar(MAX),
    @Type nvarchar(255),
    @Status nvarchar(50),
    @DeveloperName nvarchar(255),
    @DeveloperEmail nvarchar(255),
    @DeveloperOrganization nvarchar(255),
    @SourceRegistryID uniqueidentifier,
    @ReplicatedAt datetimeoffset,
    @LastSyncedAt datetimeoffset,
    @Specification nvarchar(MAX),
    @FunctionalRequirements nvarchar(MAX),
    @TechnicalDesign nvarchar(MAX),
    @FunctionalRequirementsVector nvarchar(MAX),
    @TechnicalDesignVector nvarchar(MAX),
    @HasCustomProps bit = NULL,
    @HasCustomEvents bit = NULL,
    @RequiresData bit = NULL,
    @DependencyCount int = NULL,
    @TechnicalDesignVectorEmbeddingModelID nvarchar(MAX),
    @FunctionalRequirementsVectorEmbeddingModelID nvarchar(MAX),
    @HasRequiredCustomProps bit = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[Component]
            (
                [ID],
                [Namespace],
                [Name],
                [Version],
                [VersionSequence],
                [Title],
                [Description],
                [Type],
                [Status],
                [DeveloperName],
                [DeveloperEmail],
                [DeveloperOrganization],
                [SourceRegistryID],
                [ReplicatedAt],
                [LastSyncedAt],
                [Specification],
                [FunctionalRequirements],
                [TechnicalDesign],
                [FunctionalRequirementsVector],
                [TechnicalDesignVector],
                [HasCustomProps],
                [HasCustomEvents],
                [RequiresData],
                [DependencyCount],
                [TechnicalDesignVectorEmbeddingModelID],
                [FunctionalRequirementsVectorEmbeddingModelID],
                [HasRequiredCustomProps]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Namespace,
                @Name,
                @Version,
                ISNULL(@VersionSequence, 0),
                @Title,
                @Description,
                @Type,
                @Status,
                @DeveloperName,
                @DeveloperEmail,
                @DeveloperOrganization,
                @SourceRegistryID,
                @ReplicatedAt,
                @LastSyncedAt,
                @Specification,
                @FunctionalRequirements,
                @TechnicalDesign,
                @FunctionalRequirementsVector,
                @TechnicalDesignVector,
                ISNULL(@HasCustomProps, 0),
                ISNULL(@HasCustomEvents, 0),
                ISNULL(@RequiresData, 0),
                ISNULL(@DependencyCount, 0),
                @TechnicalDesignVectorEmbeddingModelID,
                @FunctionalRequirementsVectorEmbeddingModelID,
                ISNULL(@HasRequiredCustomProps, 0)
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[Component]
            (
                [Namespace],
                [Name],
                [Version],
                [VersionSequence],
                [Title],
                [Description],
                [Type],
                [Status],
                [DeveloperName],
                [DeveloperEmail],
                [DeveloperOrganization],
                [SourceRegistryID],
                [ReplicatedAt],
                [LastSyncedAt],
                [Specification],
                [FunctionalRequirements],
                [TechnicalDesign],
                [FunctionalRequirementsVector],
                [TechnicalDesignVector],
                [HasCustomProps],
                [HasCustomEvents],
                [RequiresData],
                [DependencyCount],
                [TechnicalDesignVectorEmbeddingModelID],
                [FunctionalRequirementsVectorEmbeddingModelID],
                [HasRequiredCustomProps]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Namespace,
                @Name,
                @Version,
                ISNULL(@VersionSequence, 0),
                @Title,
                @Description,
                @Type,
                @Status,
                @DeveloperName,
                @DeveloperEmail,
                @DeveloperOrganization,
                @SourceRegistryID,
                @ReplicatedAt,
                @LastSyncedAt,
                @Specification,
                @FunctionalRequirements,
                @TechnicalDesign,
                @FunctionalRequirementsVector,
                @TechnicalDesignVector,
                ISNULL(@HasCustomProps, 0),
                ISNULL(@HasCustomEvents, 0),
                ISNULL(@RequiresData, 0),
                ISNULL(@DependencyCount, 0),
                @TechnicalDesignVectorEmbeddingModelID,
                @FunctionalRequirementsVectorEmbeddingModelID,
                ISNULL(@HasRequiredCustomProps, 0)
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwComponents] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJComponent] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Components */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJComponent] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Components */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Components
-- Item: spUpdateMJComponent
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR Component
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJComponent]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJComponent];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJComponent]
    @ID uniqueidentifier,
    @Namespace nvarchar(MAX),
    @Name nvarchar(500),
    @Version nvarchar(50),
    @VersionSequence int,
    @Title nvarchar(1000),
    @Description nvarchar(MAX),
    @Type nvarchar(255),
    @Status nvarchar(50),
    @DeveloperName nvarchar(255),
    @DeveloperEmail nvarchar(255),
    @DeveloperOrganization nvarchar(255),
    @SourceRegistryID uniqueidentifier,
    @ReplicatedAt datetimeoffset,
    @LastSyncedAt datetimeoffset,
    @Specification nvarchar(MAX),
    @FunctionalRequirements nvarchar(MAX),
    @TechnicalDesign nvarchar(MAX),
    @FunctionalRequirementsVector nvarchar(MAX),
    @TechnicalDesignVector nvarchar(MAX),
    @HasCustomProps bit,
    @HasCustomEvents bit,
    @RequiresData bit,
    @DependencyCount int,
    @TechnicalDesignVectorEmbeddingModelID nvarchar(MAX),
    @FunctionalRequirementsVectorEmbeddingModelID nvarchar(MAX),
    @HasRequiredCustomProps bit
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[Component]
    SET
        [Namespace] = @Namespace,
        [Name] = @Name,
        [Version] = @Version,
        [VersionSequence] = @VersionSequence,
        [Title] = @Title,
        [Description] = @Description,
        [Type] = @Type,
        [Status] = @Status,
        [DeveloperName] = @DeveloperName,
        [DeveloperEmail] = @DeveloperEmail,
        [DeveloperOrganization] = @DeveloperOrganization,
        [SourceRegistryID] = @SourceRegistryID,
        [ReplicatedAt] = @ReplicatedAt,
        [LastSyncedAt] = @LastSyncedAt,
        [Specification] = @Specification,
        [FunctionalRequirements] = @FunctionalRequirements,
        [TechnicalDesign] = @TechnicalDesign,
        [FunctionalRequirementsVector] = @FunctionalRequirementsVector,
        [TechnicalDesignVector] = @TechnicalDesignVector,
        [HasCustomProps] = @HasCustomProps,
        [HasCustomEvents] = @HasCustomEvents,
        [RequiresData] = @RequiresData,
        [DependencyCount] = @DependencyCount,
        [TechnicalDesignVectorEmbeddingModelID] = @TechnicalDesignVectorEmbeddingModelID,
        [FunctionalRequirementsVectorEmbeddingModelID] = @FunctionalRequirementsVectorEmbeddingModelID,
        [HasRequiredCustomProps] = @HasRequiredCustomProps
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwComponents] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwComponents]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJComponent] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the Component table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJComponent]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJComponent];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJComponent
ON [${flyway:defaultSchema}].[Component]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[Component]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[Component] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Components */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJComponent] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Components */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Components
-- Item: spDeleteMJComponent
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR Component
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJComponent]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJComponent];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJComponent]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[Component]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJComponent] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Components */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJComponent] TO [cdp_Integration]



/* Base View SQL for MJ: Content File Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Content File Types
-- Item: vwContentFileTypes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Content File Types
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  ContentFileType
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwContentFileTypes]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwContentFileTypes];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwContentFileTypes]
AS
SELECT
    m.*
FROM
    [${flyway:defaultSchema}].[ContentFileType] AS m
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwContentFileTypes] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Content File Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Content File Types
-- Item: Permissions for vwContentFileTypes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwContentFileTypes] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Content File Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Content File Types
-- Item: spCreateMJContentFileType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR ContentFileType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJContentFileType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJContentFileType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJContentFileType]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(255),
    @FileExtension nvarchar(255)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[ContentFileType]
            (
                [ID],
                [Name],
                [FileExtension]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @FileExtension
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[ContentFileType]
            (
                [Name],
                [FileExtension]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @FileExtension
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwContentFileTypes] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJContentFileType] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Content File Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJContentFileType] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Content File Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Content File Types
-- Item: spUpdateMJContentFileType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR ContentFileType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJContentFileType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJContentFileType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJContentFileType]
    @ID uniqueidentifier,
    @Name nvarchar(255),
    @FileExtension nvarchar(255)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ContentFileType]
    SET
        [Name] = @Name,
        [FileExtension] = @FileExtension
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwContentFileTypes] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwContentFileTypes]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJContentFileType] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the ContentFileType table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJContentFileType]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJContentFileType];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJContentFileType
ON [${flyway:defaultSchema}].[ContentFileType]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ContentFileType]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[ContentFileType] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Content File Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJContentFileType] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Content File Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Content File Types
-- Item: spDeleteMJContentFileType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR ContentFileType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJContentFileType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJContentFileType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJContentFileType]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[ContentFileType]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJContentFileType] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Content File Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJContentFileType] TO [cdp_Integration]



/* Base View SQL for MJ: Content Item Tags */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Content Item Tags
-- Item: vwContentItemTags
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Content Item Tags
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  ContentItemTag
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwContentItemTags]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwContentItemTags];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwContentItemTags]
AS
SELECT
    m.*,
    MJContentItems_ItemID.[Name] AS [Item]
FROM
    [${flyway:defaultSchema}].[ContentItemTag] AS m
INNER JOIN
    [${flyway:defaultSchema}].[ContentItem] AS MJContentItems_ItemID
  ON
    [m].[ItemID] = MJContentItems_ItemID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwContentItemTags] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Content Item Tags */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Content Item Tags
-- Item: Permissions for vwContentItemTags
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwContentItemTags] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Content Item Tags */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Content Item Tags
-- Item: spCreateMJContentItemTag
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR ContentItemTag
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJContentItemTag]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJContentItemTag];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJContentItemTag]
    @ID uniqueidentifier = NULL,
    @ItemID uniqueidentifier,
    @Tag nvarchar(200)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[ContentItemTag]
            (
                [ID],
                [ItemID],
                [Tag]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @ItemID,
                @Tag
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[ContentItemTag]
            (
                [ItemID],
                [Tag]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ItemID,
                @Tag
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwContentItemTags] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJContentItemTag] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Content Item Tags */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJContentItemTag] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Content Item Tags */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Content Item Tags
-- Item: spUpdateMJContentItemTag
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR ContentItemTag
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJContentItemTag]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJContentItemTag];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJContentItemTag]
    @ID uniqueidentifier,
    @ItemID uniqueidentifier,
    @Tag nvarchar(200)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ContentItemTag]
    SET
        [ItemID] = @ItemID,
        [Tag] = @Tag
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwContentItemTags] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwContentItemTags]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJContentItemTag] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the ContentItemTag table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJContentItemTag]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJContentItemTag];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJContentItemTag
ON [${flyway:defaultSchema}].[ContentItemTag]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ContentItemTag]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[ContentItemTag] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Content Item Tags */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJContentItemTag] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Content Item Tags */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Content Item Tags
-- Item: spDeleteMJContentItemTag
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR ContentItemTag
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJContentItemTag]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJContentItemTag];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJContentItemTag]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[ContentItemTag]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJContentItemTag] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Content Item Tags */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJContentItemTag] TO [cdp_Integration]



/* Base View SQL for MJ: Content Process Runs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Content Process Runs
-- Item: vwContentProcessRuns
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Content Process Runs
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  ContentProcessRun
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwContentProcessRuns]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwContentProcessRuns];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwContentProcessRuns]
AS
SELECT
    m.*,
    MJContentSources_SourceID.[Name] AS [Source]
FROM
    [${flyway:defaultSchema}].[ContentProcessRun] AS m
INNER JOIN
    [${flyway:defaultSchema}].[ContentSource] AS MJContentSources_SourceID
  ON
    [m].[SourceID] = MJContentSources_SourceID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwContentProcessRuns] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Content Process Runs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Content Process Runs
-- Item: Permissions for vwContentProcessRuns
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwContentProcessRuns] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Content Process Runs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Content Process Runs
-- Item: spCreateMJContentProcessRun
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR ContentProcessRun
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJContentProcessRun]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJContentProcessRun];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJContentProcessRun]
    @ID uniqueidentifier = NULL,
    @SourceID uniqueidentifier,
    @StartTime datetimeoffset,
    @EndTime datetimeoffset,
    @Status nvarchar(100),
    @ProcessedItems int
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[ContentProcessRun]
            (
                [ID],
                [SourceID],
                [StartTime],
                [EndTime],
                [Status],
                [ProcessedItems]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @SourceID,
                @StartTime,
                @EndTime,
                @Status,
                @ProcessedItems
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[ContentProcessRun]
            (
                [SourceID],
                [StartTime],
                [EndTime],
                [Status],
                [ProcessedItems]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @SourceID,
                @StartTime,
                @EndTime,
                @Status,
                @ProcessedItems
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwContentProcessRuns] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJContentProcessRun] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Content Process Runs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJContentProcessRun] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Content Process Runs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Content Process Runs
-- Item: spUpdateMJContentProcessRun
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR ContentProcessRun
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJContentProcessRun]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJContentProcessRun];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJContentProcessRun]
    @ID uniqueidentifier,
    @SourceID uniqueidentifier,
    @StartTime datetimeoffset,
    @EndTime datetimeoffset,
    @Status nvarchar(100),
    @ProcessedItems int
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ContentProcessRun]
    SET
        [SourceID] = @SourceID,
        [StartTime] = @StartTime,
        [EndTime] = @EndTime,
        [Status] = @Status,
        [ProcessedItems] = @ProcessedItems
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwContentProcessRuns] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwContentProcessRuns]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJContentProcessRun] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the ContentProcessRun table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJContentProcessRun]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJContentProcessRun];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJContentProcessRun
ON [${flyway:defaultSchema}].[ContentProcessRun]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ContentProcessRun]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[ContentProcessRun] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Content Process Runs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJContentProcessRun] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Content Process Runs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Content Process Runs
-- Item: spDeleteMJContentProcessRun
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR ContentProcessRun
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJContentProcessRun]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJContentProcessRun];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJContentProcessRun]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[ContentProcessRun]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJContentProcessRun] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Content Process Runs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJContentProcessRun] TO [cdp_Integration]



/* Base View SQL for MJ: Content Items */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Content Items
-- Item: vwContentItems
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Content Items
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  ContentItem
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwContentItems]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwContentItems];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwContentItems]
AS
SELECT
    m.*,
    MJContentSources_ContentSourceID.[Name] AS [ContentSource],
    MJContentTypes_ContentTypeID.[Name] AS [ContentType],
    MJContentSourceTypes_ContentSourceTypeID.[Name] AS [ContentSourceType],
    MJContentFileTypes_ContentFileTypeID.[Name] AS [ContentFileType]
FROM
    [${flyway:defaultSchema}].[ContentItem] AS m
INNER JOIN
    [${flyway:defaultSchema}].[ContentSource] AS MJContentSources_ContentSourceID
  ON
    [m].[ContentSourceID] = MJContentSources_ContentSourceID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[ContentType] AS MJContentTypes_ContentTypeID
  ON
    [m].[ContentTypeID] = MJContentTypes_ContentTypeID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[ContentSourceType] AS MJContentSourceTypes_ContentSourceTypeID
  ON
    [m].[ContentSourceTypeID] = MJContentSourceTypes_ContentSourceTypeID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[ContentFileType] AS MJContentFileTypes_ContentFileTypeID
  ON
    [m].[ContentFileTypeID] = MJContentFileTypes_ContentFileTypeID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwContentItems] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Content Items */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Content Items
-- Item: Permissions for vwContentItems
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwContentItems] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Content Items */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Content Items
-- Item: spCreateMJContentItem
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR ContentItem
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJContentItem]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJContentItem];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJContentItem]
    @ID uniqueidentifier = NULL,
    @ContentSourceID uniqueidentifier,
    @Name nvarchar(250),
    @Description nvarchar(MAX),
    @ContentTypeID uniqueidentifier,
    @ContentSourceTypeID uniqueidentifier,
    @ContentFileTypeID uniqueidentifier,
    @Checksum nvarchar(100),
    @URL nvarchar(2000),
    @Text nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[ContentItem]
            (
                [ID],
                [ContentSourceID],
                [Name],
                [Description],
                [ContentTypeID],
                [ContentSourceTypeID],
                [ContentFileTypeID],
                [Checksum],
                [URL],
                [Text]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @ContentSourceID,
                @Name,
                @Description,
                @ContentTypeID,
                @ContentSourceTypeID,
                @ContentFileTypeID,
                @Checksum,
                @URL,
                @Text
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[ContentItem]
            (
                [ContentSourceID],
                [Name],
                [Description],
                [ContentTypeID],
                [ContentSourceTypeID],
                [ContentFileTypeID],
                [Checksum],
                [URL],
                [Text]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ContentSourceID,
                @Name,
                @Description,
                @ContentTypeID,
                @ContentSourceTypeID,
                @ContentFileTypeID,
                @Checksum,
                @URL,
                @Text
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwContentItems] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJContentItem] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Content Items */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJContentItem] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Content Items */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Content Items
-- Item: spUpdateMJContentItem
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR ContentItem
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJContentItem]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJContentItem];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJContentItem]
    @ID uniqueidentifier,
    @ContentSourceID uniqueidentifier,
    @Name nvarchar(250),
    @Description nvarchar(MAX),
    @ContentTypeID uniqueidentifier,
    @ContentSourceTypeID uniqueidentifier,
    @ContentFileTypeID uniqueidentifier,
    @Checksum nvarchar(100),
    @URL nvarchar(2000),
    @Text nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ContentItem]
    SET
        [ContentSourceID] = @ContentSourceID,
        [Name] = @Name,
        [Description] = @Description,
        [ContentTypeID] = @ContentTypeID,
        [ContentSourceTypeID] = @ContentSourceTypeID,
        [ContentFileTypeID] = @ContentFileTypeID,
        [Checksum] = @Checksum,
        [URL] = @URL,
        [Text] = @Text
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwContentItems] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwContentItems]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJContentItem] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the ContentItem table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJContentItem]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJContentItem];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJContentItem
ON [${flyway:defaultSchema}].[ContentItem]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ContentItem]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[ContentItem] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Content Items */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJContentItem] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Content Items */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Content Items
-- Item: spDeleteMJContentItem
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR ContentItem
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJContentItem]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJContentItem];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJContentItem]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[ContentItem]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJContentItem] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Content Items */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJContentItem] TO [cdp_Integration]



/* Base View SQL for MJ: Content Source Params */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Content Source Params
-- Item: vwContentSourceParams
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Content Source Params
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  ContentSourceParam
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwContentSourceParams]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwContentSourceParams];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwContentSourceParams]
AS
SELECT
    m.*,
    MJContentSources_ContentSourceID.[Name] AS [ContentSource]
FROM
    [${flyway:defaultSchema}].[ContentSourceParam] AS m
INNER JOIN
    [${flyway:defaultSchema}].[ContentSource] AS MJContentSources_ContentSourceID
  ON
    [m].[ContentSourceID] = MJContentSources_ContentSourceID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwContentSourceParams] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Content Source Params */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Content Source Params
-- Item: Permissions for vwContentSourceParams
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwContentSourceParams] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Content Source Params */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Content Source Params
-- Item: spCreateMJContentSourceParam
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR ContentSourceParam
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJContentSourceParam]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJContentSourceParam];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJContentSourceParam]
    @ID uniqueidentifier = NULL,
    @ContentSourceID uniqueidentifier,
    @ContentSourceTypeParamID uniqueidentifier,
    @Value nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[ContentSourceParam]
            (
                [ID],
                [ContentSourceID],
                [ContentSourceTypeParamID],
                [Value]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @ContentSourceID,
                @ContentSourceTypeParamID,
                @Value
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[ContentSourceParam]
            (
                [ContentSourceID],
                [ContentSourceTypeParamID],
                [Value]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ContentSourceID,
                @ContentSourceTypeParamID,
                @Value
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwContentSourceParams] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJContentSourceParam] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Content Source Params */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJContentSourceParam] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Content Source Params */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Content Source Params
-- Item: spUpdateMJContentSourceParam
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR ContentSourceParam
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJContentSourceParam]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJContentSourceParam];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJContentSourceParam]
    @ID uniqueidentifier,
    @ContentSourceID uniqueidentifier,
    @ContentSourceTypeParamID uniqueidentifier,
    @Value nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ContentSourceParam]
    SET
        [ContentSourceID] = @ContentSourceID,
        [ContentSourceTypeParamID] = @ContentSourceTypeParamID,
        [Value] = @Value
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwContentSourceParams] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwContentSourceParams]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJContentSourceParam] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the ContentSourceParam table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJContentSourceParam]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJContentSourceParam];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJContentSourceParam
ON [${flyway:defaultSchema}].[ContentSourceParam]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ContentSourceParam]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[ContentSourceParam] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Content Source Params */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJContentSourceParam] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Content Source Params */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Content Source Params
-- Item: spDeleteMJContentSourceParam
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR ContentSourceParam
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJContentSourceParam]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJContentSourceParam];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJContentSourceParam]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[ContentSourceParam]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJContentSourceParam] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Content Source Params */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJContentSourceParam] TO [cdp_Integration]



/* Base View SQL for MJ: Content Item Attributes */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Content Item Attributes
-- Item: vwContentItemAttributes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Content Item Attributes
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  ContentItemAttribute
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwContentItemAttributes]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwContentItemAttributes];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwContentItemAttributes]
AS
SELECT
    m.*,
    MJContentItems_ContentItemID.[Name] AS [ContentItem]
FROM
    [${flyway:defaultSchema}].[ContentItemAttribute] AS m
INNER JOIN
    [${flyway:defaultSchema}].[ContentItem] AS MJContentItems_ContentItemID
  ON
    [m].[ContentItemID] = MJContentItems_ContentItemID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwContentItemAttributes] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Content Item Attributes */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Content Item Attributes
-- Item: Permissions for vwContentItemAttributes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwContentItemAttributes] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Content Item Attributes */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Content Item Attributes
-- Item: spCreateMJContentItemAttribute
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR ContentItemAttribute
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJContentItemAttribute]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJContentItemAttribute];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJContentItemAttribute]
    @ID uniqueidentifier = NULL,
    @ContentItemID uniqueidentifier,
    @Name nvarchar(100),
    @Value nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[ContentItemAttribute]
            (
                [ID],
                [ContentItemID],
                [Name],
                [Value]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @ContentItemID,
                @Name,
                @Value
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[ContentItemAttribute]
            (
                [ContentItemID],
                [Name],
                [Value]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ContentItemID,
                @Name,
                @Value
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwContentItemAttributes] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJContentItemAttribute] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Content Item Attributes */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJContentItemAttribute] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Content Item Attributes */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Content Item Attributes
-- Item: spUpdateMJContentItemAttribute
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR ContentItemAttribute
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJContentItemAttribute]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJContentItemAttribute];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJContentItemAttribute]
    @ID uniqueidentifier,
    @ContentItemID uniqueidentifier,
    @Name nvarchar(100),
    @Value nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ContentItemAttribute]
    SET
        [ContentItemID] = @ContentItemID,
        [Name] = @Name,
        [Value] = @Value
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwContentItemAttributes] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwContentItemAttributes]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJContentItemAttribute] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the ContentItemAttribute table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJContentItemAttribute]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJContentItemAttribute];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJContentItemAttribute
ON [${flyway:defaultSchema}].[ContentItemAttribute]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ContentItemAttribute]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[ContentItemAttribute] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Content Item Attributes */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJContentItemAttribute] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Content Item Attributes */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Content Item Attributes
-- Item: spDeleteMJContentItemAttribute
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR ContentItemAttribute
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJContentItemAttribute]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJContentItemAttribute];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJContentItemAttribute]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[ContentItemAttribute]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJContentItemAttribute] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Content Item Attributes */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJContentItemAttribute] TO [cdp_Integration]



/* Base View SQL for MJ: Content Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Content Types
-- Item: vwContentTypes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Content Types
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  ContentType
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwContentTypes]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwContentTypes];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwContentTypes]
AS
SELECT
    m.*,
    MJAIModels_AIModelID.[Name] AS [AIModel]
FROM
    [${flyway:defaultSchema}].[ContentType] AS m
INNER JOIN
    [${flyway:defaultSchema}].[AIModel] AS MJAIModels_AIModelID
  ON
    [m].[AIModelID] = MJAIModels_AIModelID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwContentTypes] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Content Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Content Types
-- Item: Permissions for vwContentTypes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwContentTypes] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Content Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Content Types
-- Item: spCreateMJContentType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR ContentType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJContentType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJContentType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJContentType]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @AIModelID uniqueidentifier,
    @MinTags int,
    @MaxTags int
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[ContentType]
            (
                [ID],
                [Name],
                [Description],
                [AIModelID],
                [MinTags],
                [MaxTags]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description,
                @AIModelID,
                @MinTags,
                @MaxTags
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[ContentType]
            (
                [Name],
                [Description],
                [AIModelID],
                [MinTags],
                [MaxTags]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description,
                @AIModelID,
                @MinTags,
                @MaxTags
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwContentTypes] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJContentType] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Content Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJContentType] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Content Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Content Types
-- Item: spUpdateMJContentType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR ContentType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJContentType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJContentType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJContentType]
    @ID uniqueidentifier,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @AIModelID uniqueidentifier,
    @MinTags int,
    @MaxTags int
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ContentType]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [AIModelID] = @AIModelID,
        [MinTags] = @MinTags,
        [MaxTags] = @MaxTags
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwContentTypes] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwContentTypes]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJContentType] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the ContentType table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJContentType]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJContentType];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJContentType
ON [${flyway:defaultSchema}].[ContentType]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ContentType]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[ContentType] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Content Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJContentType] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Content Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Content Types
-- Item: spDeleteMJContentType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR ContentType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJContentType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJContentType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJContentType]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[ContentType]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJContentType] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Content Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJContentType] TO [cdp_Integration]



/* Base View SQL for MJ: Content Source Type Params */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Content Source Type Params
-- Item: vwContentSourceTypeParams
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Content Source Type Params
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  ContentSourceTypeParam
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwContentSourceTypeParams]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwContentSourceTypeParams];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwContentSourceTypeParams]
AS
SELECT
    m.*
FROM
    [${flyway:defaultSchema}].[ContentSourceTypeParam] AS m
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwContentSourceTypeParams] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Content Source Type Params */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Content Source Type Params
-- Item: Permissions for vwContentSourceTypeParams
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwContentSourceTypeParams] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Content Source Type Params */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Content Source Type Params
-- Item: spCreateMJContentSourceTypeParam
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR ContentSourceTypeParam
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJContentSourceTypeParam]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJContentSourceTypeParam];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJContentSourceTypeParam]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(100),
    @Description nvarchar(MAX),
    @Type nvarchar(50),
    @DefaultValue nvarchar(MAX),
    @IsRequired bit
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[ContentSourceTypeParam]
            (
                [ID],
                [Name],
                [Description],
                [Type],
                [DefaultValue],
                [IsRequired]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description,
                @Type,
                @DefaultValue,
                @IsRequired
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[ContentSourceTypeParam]
            (
                [Name],
                [Description],
                [Type],
                [DefaultValue],
                [IsRequired]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description,
                @Type,
                @DefaultValue,
                @IsRequired
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwContentSourceTypeParams] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJContentSourceTypeParam] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Content Source Type Params */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJContentSourceTypeParam] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Content Source Type Params */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Content Source Type Params
-- Item: spUpdateMJContentSourceTypeParam
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR ContentSourceTypeParam
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJContentSourceTypeParam]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJContentSourceTypeParam];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJContentSourceTypeParam]
    @ID uniqueidentifier,
    @Name nvarchar(100),
    @Description nvarchar(MAX),
    @Type nvarchar(50),
    @DefaultValue nvarchar(MAX),
    @IsRequired bit
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ContentSourceTypeParam]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [Type] = @Type,
        [DefaultValue] = @DefaultValue,
        [IsRequired] = @IsRequired
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwContentSourceTypeParams] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwContentSourceTypeParams]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJContentSourceTypeParam] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the ContentSourceTypeParam table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJContentSourceTypeParam]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJContentSourceTypeParam];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJContentSourceTypeParam
ON [${flyway:defaultSchema}].[ContentSourceTypeParam]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ContentSourceTypeParam]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[ContentSourceTypeParam] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Content Source Type Params */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJContentSourceTypeParam] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Content Source Type Params */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Content Source Type Params
-- Item: spDeleteMJContentSourceTypeParam
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR ContentSourceTypeParam
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJContentSourceTypeParam]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJContentSourceTypeParam];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJContentSourceTypeParam]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[ContentSourceTypeParam]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJContentSourceTypeParam] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Content Source Type Params */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJContentSourceTypeParam] TO [cdp_Integration]



/* Base View SQL for MJ: Content Source Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Content Source Types
-- Item: vwContentSourceTypes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Content Source Types
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  ContentSourceType
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwContentSourceTypes]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwContentSourceTypes];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwContentSourceTypes]
AS
SELECT
    m.*
FROM
    [${flyway:defaultSchema}].[ContentSourceType] AS m
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwContentSourceTypes] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Content Source Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Content Source Types
-- Item: Permissions for vwContentSourceTypes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwContentSourceTypes] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Content Source Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Content Source Types
-- Item: spCreateMJContentSourceType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR ContentSourceType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJContentSourceType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJContentSourceType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJContentSourceType]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(255),
    @Description nvarchar(1000)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[ContentSourceType]
            (
                [ID],
                [Name],
                [Description]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[ContentSourceType]
            (
                [Name],
                [Description]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwContentSourceTypes] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJContentSourceType] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Content Source Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJContentSourceType] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Content Source Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Content Source Types
-- Item: spUpdateMJContentSourceType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR ContentSourceType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJContentSourceType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJContentSourceType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJContentSourceType]
    @ID uniqueidentifier,
    @Name nvarchar(255),
    @Description nvarchar(1000)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ContentSourceType]
    SET
        [Name] = @Name,
        [Description] = @Description
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwContentSourceTypes] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwContentSourceTypes]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJContentSourceType] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the ContentSourceType table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJContentSourceType]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJContentSourceType];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJContentSourceType
ON [${flyway:defaultSchema}].[ContentSourceType]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ContentSourceType]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[ContentSourceType] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Content Source Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJContentSourceType] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Content Source Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Content Source Types
-- Item: spDeleteMJContentSourceType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR ContentSourceType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJContentSourceType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJContentSourceType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJContentSourceType]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[ContentSourceType]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJContentSourceType] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Content Source Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJContentSourceType] TO [cdp_Integration]



/* Base View SQL for MJ: Content Sources */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Content Sources
-- Item: vwContentSources
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Content Sources
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  ContentSource
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwContentSources]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwContentSources];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwContentSources]
AS
SELECT
    m.*,
    MJContentTypes_ContentTypeID.[Name] AS [ContentType],
    MJContentSourceTypes_ContentSourceTypeID.[Name] AS [ContentSourceType],
    MJContentFileTypes_ContentFileTypeID.[Name] AS [ContentFileType]
FROM
    [${flyway:defaultSchema}].[ContentSource] AS m
INNER JOIN
    [${flyway:defaultSchema}].[ContentType] AS MJContentTypes_ContentTypeID
  ON
    [m].[ContentTypeID] = MJContentTypes_ContentTypeID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[ContentSourceType] AS MJContentSourceTypes_ContentSourceTypeID
  ON
    [m].[ContentSourceTypeID] = MJContentSourceTypes_ContentSourceTypeID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[ContentFileType] AS MJContentFileTypes_ContentFileTypeID
  ON
    [m].[ContentFileTypeID] = MJContentFileTypes_ContentFileTypeID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwContentSources] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Content Sources */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Content Sources
-- Item: Permissions for vwContentSources
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwContentSources] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Content Sources */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Content Sources
-- Item: spCreateMJContentSource
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR ContentSource
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJContentSource]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJContentSource];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJContentSource]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(255),
    @ContentTypeID uniqueidentifier,
    @ContentSourceTypeID uniqueidentifier,
    @ContentFileTypeID uniqueidentifier,
    @URL nvarchar(2000)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[ContentSource]
            (
                [ID],
                [Name],
                [ContentTypeID],
                [ContentSourceTypeID],
                [ContentFileTypeID],
                [URL]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @ContentTypeID,
                @ContentSourceTypeID,
                @ContentFileTypeID,
                @URL
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[ContentSource]
            (
                [Name],
                [ContentTypeID],
                [ContentSourceTypeID],
                [ContentFileTypeID],
                [URL]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @ContentTypeID,
                @ContentSourceTypeID,
                @ContentFileTypeID,
                @URL
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwContentSources] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJContentSource] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Content Sources */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJContentSource] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Content Sources */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Content Sources
-- Item: spUpdateMJContentSource
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR ContentSource
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJContentSource]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJContentSource];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJContentSource]
    @ID uniqueidentifier,
    @Name nvarchar(255),
    @ContentTypeID uniqueidentifier,
    @ContentSourceTypeID uniqueidentifier,
    @ContentFileTypeID uniqueidentifier,
    @URL nvarchar(2000)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ContentSource]
    SET
        [Name] = @Name,
        [ContentTypeID] = @ContentTypeID,
        [ContentSourceTypeID] = @ContentSourceTypeID,
        [ContentFileTypeID] = @ContentFileTypeID,
        [URL] = @URL
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwContentSources] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwContentSources]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJContentSource] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the ContentSource table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJContentSource]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJContentSource];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJContentSource
ON [${flyway:defaultSchema}].[ContentSource]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ContentSource]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[ContentSource] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Content Sources */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJContentSource] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Content Sources */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Content Sources
-- Item: spDeleteMJContentSource
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR ContentSource
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJContentSource]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJContentSource];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJContentSource]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[ContentSource]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJContentSource] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Content Sources */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJContentSource] TO [cdp_Integration]



/* Base View SQL for MJ: Content Type Attributes */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Content Type Attributes
-- Item: vwContentTypeAttributes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Content Type Attributes
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  ContentTypeAttribute
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwContentTypeAttributes]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwContentTypeAttributes];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwContentTypeAttributes]
AS
SELECT
    m.*
FROM
    [${flyway:defaultSchema}].[ContentTypeAttribute] AS m
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwContentTypeAttributes] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Content Type Attributes */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Content Type Attributes
-- Item: Permissions for vwContentTypeAttributes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwContentTypeAttributes] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Content Type Attributes */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Content Type Attributes
-- Item: spCreateMJContentTypeAttribute
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR ContentTypeAttribute
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJContentTypeAttribute]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJContentTypeAttribute];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJContentTypeAttribute]
    @ID uniqueidentifier = NULL,
    @ContentTypeID uniqueidentifier,
    @Name nvarchar(100),
    @Prompt nvarchar(MAX),
    @Description nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[ContentTypeAttribute]
            (
                [ID],
                [ContentTypeID],
                [Name],
                [Prompt],
                [Description]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @ContentTypeID,
                @Name,
                @Prompt,
                @Description
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[ContentTypeAttribute]
            (
                [ContentTypeID],
                [Name],
                [Prompt],
                [Description]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ContentTypeID,
                @Name,
                @Prompt,
                @Description
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwContentTypeAttributes] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJContentTypeAttribute] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Content Type Attributes */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJContentTypeAttribute] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Content Type Attributes */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Content Type Attributes
-- Item: spUpdateMJContentTypeAttribute
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR ContentTypeAttribute
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJContentTypeAttribute]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJContentTypeAttribute];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJContentTypeAttribute]
    @ID uniqueidentifier,
    @ContentTypeID uniqueidentifier,
    @Name nvarchar(100),
    @Prompt nvarchar(MAX),
    @Description nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ContentTypeAttribute]
    SET
        [ContentTypeID] = @ContentTypeID,
        [Name] = @Name,
        [Prompt] = @Prompt,
        [Description] = @Description
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwContentTypeAttributes] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwContentTypeAttributes]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJContentTypeAttribute] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the ContentTypeAttribute table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJContentTypeAttribute]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJContentTypeAttribute];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJContentTypeAttribute
ON [${flyway:defaultSchema}].[ContentTypeAttribute]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ContentTypeAttribute]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[ContentTypeAttribute] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Content Type Attributes */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJContentTypeAttribute] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Content Type Attributes */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Content Type Attributes
-- Item: spDeleteMJContentTypeAttribute
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR ContentTypeAttribute
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJContentTypeAttribute]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJContentTypeAttribute];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJContentTypeAttribute]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[ContentTypeAttribute]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJContentTypeAttribute] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Content Type Attributes */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJContentTypeAttribute] TO [cdp_Integration]



/* Base View SQL for MJ: Conversation Detail Attachments */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Conversation Detail Attachments
-- Item: vwConversationDetailAttachments
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Conversation Detail Attachments
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  ConversationDetailAttachment
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwConversationDetailAttachments]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwConversationDetailAttachments];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwConversationDetailAttachments]
AS
SELECT
    m.*,
    MJConversationDetails_ConversationDetailID.[Message] AS [ConversationDetail],
    MJAIModalities_ModalityID.[Name] AS [Modality],
    MJFiles_FileID.[Name] AS [File]
FROM
    [${flyway:defaultSchema}].[ConversationDetailAttachment] AS m
INNER JOIN
    [${flyway:defaultSchema}].[ConversationDetail] AS MJConversationDetails_ConversationDetailID
  ON
    [m].[ConversationDetailID] = MJConversationDetails_ConversationDetailID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[AIModality] AS MJAIModalities_ModalityID
  ON
    [m].[ModalityID] = MJAIModalities_ModalityID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[File] AS MJFiles_FileID
  ON
    [m].[FileID] = MJFiles_FileID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwConversationDetailAttachments] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Conversation Detail Attachments */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Conversation Detail Attachments
-- Item: Permissions for vwConversationDetailAttachments
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwConversationDetailAttachments] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Conversation Detail Attachments */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Conversation Detail Attachments
-- Item: spCreateMJConversationDetailAttachment
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR ConversationDetailAttachment
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJConversationDetailAttachment]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJConversationDetailAttachment];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJConversationDetailAttachment]
    @ID uniqueidentifier = NULL,
    @ConversationDetailID uniqueidentifier,
    @ModalityID uniqueidentifier,
    @MimeType nvarchar(100),
    @FileName nvarchar(4000),
    @FileSizeBytes int,
    @Width int,
    @Height int,
    @DurationSeconds int,
    @InlineData nvarchar(MAX),
    @FileID uniqueidentifier,
    @DisplayOrder int = NULL,
    @ThumbnailBase64 nvarchar(MAX),
    @Description nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[ConversationDetailAttachment]
            (
                [ID],
                [ConversationDetailID],
                [ModalityID],
                [MimeType],
                [FileName],
                [FileSizeBytes],
                [Width],
                [Height],
                [DurationSeconds],
                [InlineData],
                [FileID],
                [DisplayOrder],
                [ThumbnailBase64],
                [Description]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @ConversationDetailID,
                @ModalityID,
                @MimeType,
                @FileName,
                @FileSizeBytes,
                @Width,
                @Height,
                @DurationSeconds,
                @InlineData,
                @FileID,
                ISNULL(@DisplayOrder, 0),
                @ThumbnailBase64,
                @Description
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[ConversationDetailAttachment]
            (
                [ConversationDetailID],
                [ModalityID],
                [MimeType],
                [FileName],
                [FileSizeBytes],
                [Width],
                [Height],
                [DurationSeconds],
                [InlineData],
                [FileID],
                [DisplayOrder],
                [ThumbnailBase64],
                [Description]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ConversationDetailID,
                @ModalityID,
                @MimeType,
                @FileName,
                @FileSizeBytes,
                @Width,
                @Height,
                @DurationSeconds,
                @InlineData,
                @FileID,
                ISNULL(@DisplayOrder, 0),
                @ThumbnailBase64,
                @Description
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwConversationDetailAttachments] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJConversationDetailAttachment] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Conversation Detail Attachments */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJConversationDetailAttachment] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Conversation Detail Attachments */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Conversation Detail Attachments
-- Item: spUpdateMJConversationDetailAttachment
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR ConversationDetailAttachment
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJConversationDetailAttachment]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJConversationDetailAttachment];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJConversationDetailAttachment]
    @ID uniqueidentifier,
    @ConversationDetailID uniqueidentifier,
    @ModalityID uniqueidentifier,
    @MimeType nvarchar(100),
    @FileName nvarchar(4000),
    @FileSizeBytes int,
    @Width int,
    @Height int,
    @DurationSeconds int,
    @InlineData nvarchar(MAX),
    @FileID uniqueidentifier,
    @DisplayOrder int,
    @ThumbnailBase64 nvarchar(MAX),
    @Description nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ConversationDetailAttachment]
    SET
        [ConversationDetailID] = @ConversationDetailID,
        [ModalityID] = @ModalityID,
        [MimeType] = @MimeType,
        [FileName] = @FileName,
        [FileSizeBytes] = @FileSizeBytes,
        [Width] = @Width,
        [Height] = @Height,
        [DurationSeconds] = @DurationSeconds,
        [InlineData] = @InlineData,
        [FileID] = @FileID,
        [DisplayOrder] = @DisplayOrder,
        [ThumbnailBase64] = @ThumbnailBase64,
        [Description] = @Description
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwConversationDetailAttachments] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwConversationDetailAttachments]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJConversationDetailAttachment] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the ConversationDetailAttachment table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJConversationDetailAttachment]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJConversationDetailAttachment];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJConversationDetailAttachment
ON [${flyway:defaultSchema}].[ConversationDetailAttachment]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ConversationDetailAttachment]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[ConversationDetailAttachment] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Conversation Detail Attachments */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJConversationDetailAttachment] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Conversation Detail Attachments */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Conversation Detail Attachments
-- Item: spDeleteMJConversationDetailAttachment
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR ConversationDetailAttachment
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJConversationDetailAttachment]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJConversationDetailAttachment];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJConversationDetailAttachment]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[ConversationDetailAttachment]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJConversationDetailAttachment] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Conversation Detail Attachments */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJConversationDetailAttachment] TO [cdp_Integration]



/* Base View SQL for MJ: Conversation Artifacts */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Conversation Artifacts
-- Item: vwConversationArtifacts
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Conversation Artifacts
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  ConversationArtifact
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwConversationArtifacts]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwConversationArtifacts];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwConversationArtifacts]
AS
SELECT
    m.*,
    MJConversations_ConversationID.[Name] AS [Conversation],
    MJArtifactTypes_ArtifactTypeID.[Name] AS [ArtifactType]
FROM
    [${flyway:defaultSchema}].[ConversationArtifact] AS m
INNER JOIN
    [${flyway:defaultSchema}].[Conversation] AS MJConversations_ConversationID
  ON
    [m].[ConversationID] = MJConversations_ConversationID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[ArtifactType] AS MJArtifactTypes_ArtifactTypeID
  ON
    [m].[ArtifactTypeID] = MJArtifactTypes_ArtifactTypeID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwConversationArtifacts] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Conversation Artifacts */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Conversation Artifacts
-- Item: Permissions for vwConversationArtifacts
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwConversationArtifacts] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Conversation Artifacts */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Conversation Artifacts
-- Item: spCreateMJConversationArtifact
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR ConversationArtifact
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJConversationArtifact]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJConversationArtifact];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJConversationArtifact]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @ConversationID uniqueidentifier,
    @ArtifactTypeID uniqueidentifier,
    @SharingScope nvarchar(50),
    @Comments nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[ConversationArtifact]
            (
                [ID],
                [Name],
                [Description],
                [ConversationID],
                [ArtifactTypeID],
                [SharingScope],
                [Comments]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description,
                @ConversationID,
                @ArtifactTypeID,
                @SharingScope,
                @Comments
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[ConversationArtifact]
            (
                [Name],
                [Description],
                [ConversationID],
                [ArtifactTypeID],
                [SharingScope],
                [Comments]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description,
                @ConversationID,
                @ArtifactTypeID,
                @SharingScope,
                @Comments
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwConversationArtifacts] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJConversationArtifact] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Conversation Artifacts */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJConversationArtifact] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Conversation Artifacts */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Conversation Artifacts
-- Item: spUpdateMJConversationArtifact
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR ConversationArtifact
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJConversationArtifact]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJConversationArtifact];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJConversationArtifact]
    @ID uniqueidentifier,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @ConversationID uniqueidentifier,
    @ArtifactTypeID uniqueidentifier,
    @SharingScope nvarchar(50),
    @Comments nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ConversationArtifact]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [ConversationID] = @ConversationID,
        [ArtifactTypeID] = @ArtifactTypeID,
        [SharingScope] = @SharingScope,
        [Comments] = @Comments
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwConversationArtifacts] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwConversationArtifacts]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJConversationArtifact] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the ConversationArtifact table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJConversationArtifact]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJConversationArtifact];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJConversationArtifact
ON [${flyway:defaultSchema}].[ConversationArtifact]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ConversationArtifact]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[ConversationArtifact] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Conversation Artifacts */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJConversationArtifact] TO [cdp_Developer], [cdp_Integration]



/* Base View SQL for MJ: Conversation Artifact Versions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Conversation Artifact Versions
-- Item: vwConversationArtifactVersions
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Conversation Artifact Versions
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  ConversationArtifactVersion
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwConversationArtifactVersions]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwConversationArtifactVersions];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwConversationArtifactVersions]
AS
SELECT
    m.*,
    MJConversationArtifacts_ConversationArtifactID.[Name] AS [ConversationArtifact]
FROM
    [${flyway:defaultSchema}].[ConversationArtifactVersion] AS m
INNER JOIN
    [${flyway:defaultSchema}].[ConversationArtifact] AS MJConversationArtifacts_ConversationArtifactID
  ON
    [m].[ConversationArtifactID] = MJConversationArtifacts_ConversationArtifactID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwConversationArtifactVersions] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Conversation Artifact Versions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Conversation Artifact Versions
-- Item: Permissions for vwConversationArtifactVersions
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwConversationArtifactVersions] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Conversation Artifact Versions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Conversation Artifact Versions
-- Item: spCreateMJConversationArtifactVersion
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR ConversationArtifactVersion
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJConversationArtifactVersion]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJConversationArtifactVersion];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJConversationArtifactVersion]
    @ID uniqueidentifier = NULL,
    @ConversationArtifactID uniqueidentifier,
    @Version int,
    @Configuration nvarchar(MAX),
    @Content nvarchar(MAX),
    @Comments nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[ConversationArtifactVersion]
            (
                [ID],
                [ConversationArtifactID],
                [Version],
                [Configuration],
                [Content],
                [Comments]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @ConversationArtifactID,
                @Version,
                @Configuration,
                @Content,
                @Comments
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[ConversationArtifactVersion]
            (
                [ConversationArtifactID],
                [Version],
                [Configuration],
                [Content],
                [Comments]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ConversationArtifactID,
                @Version,
                @Configuration,
                @Content,
                @Comments
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwConversationArtifactVersions] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJConversationArtifactVersion] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Conversation Artifact Versions */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJConversationArtifactVersion] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Conversation Artifact Versions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Conversation Artifact Versions
-- Item: spUpdateMJConversationArtifactVersion
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR ConversationArtifactVersion
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJConversationArtifactVersion]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJConversationArtifactVersion];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJConversationArtifactVersion]
    @ID uniqueidentifier,
    @ConversationArtifactID uniqueidentifier,
    @Version int,
    @Configuration nvarchar(MAX),
    @Content nvarchar(MAX),
    @Comments nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ConversationArtifactVersion]
    SET
        [ConversationArtifactID] = @ConversationArtifactID,
        [Version] = @Version,
        [Configuration] = @Configuration,
        [Content] = @Content,
        [Comments] = @Comments
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwConversationArtifactVersions] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwConversationArtifactVersions]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJConversationArtifactVersion] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the ConversationArtifactVersion table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJConversationArtifactVersion]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJConversationArtifactVersion];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJConversationArtifactVersion
ON [${flyway:defaultSchema}].[ConversationArtifactVersion]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ConversationArtifactVersion]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[ConversationArtifactVersion] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Conversation Artifact Versions */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJConversationArtifactVersion] TO [cdp_Developer], [cdp_Integration]



/* Base View SQL for MJ: Conversation Detail Artifacts */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Conversation Detail Artifacts
-- Item: vwConversationDetailArtifacts
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Conversation Detail Artifacts
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  ConversationDetailArtifact
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwConversationDetailArtifacts]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwConversationDetailArtifacts];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwConversationDetailArtifacts]
AS
SELECT
    m.*,
    MJConversationDetails_ConversationDetailID.[Message] AS [ConversationDetail],
    MJArtifactVersions_ArtifactVersionID.[Name] AS [ArtifactVersion]
FROM
    [${flyway:defaultSchema}].[ConversationDetailArtifact] AS m
INNER JOIN
    [${flyway:defaultSchema}].[ConversationDetail] AS MJConversationDetails_ConversationDetailID
  ON
    [m].[ConversationDetailID] = MJConversationDetails_ConversationDetailID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[ArtifactVersion] AS MJArtifactVersions_ArtifactVersionID
  ON
    [m].[ArtifactVersionID] = MJArtifactVersions_ArtifactVersionID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwConversationDetailArtifacts] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Conversation Detail Artifacts */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Conversation Detail Artifacts
-- Item: Permissions for vwConversationDetailArtifacts
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwConversationDetailArtifacts] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Conversation Detail Artifacts */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Conversation Detail Artifacts
-- Item: spCreateMJConversationDetailArtifact
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR ConversationDetailArtifact
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJConversationDetailArtifact]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJConversationDetailArtifact];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJConversationDetailArtifact]
    @ID uniqueidentifier = NULL,
    @ConversationDetailID uniqueidentifier,
    @ArtifactVersionID uniqueidentifier,
    @Direction nvarchar(20) = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[ConversationDetailArtifact]
            (
                [ID],
                [ConversationDetailID],
                [ArtifactVersionID],
                [Direction]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @ConversationDetailID,
                @ArtifactVersionID,
                ISNULL(@Direction, 'Output')
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[ConversationDetailArtifact]
            (
                [ConversationDetailID],
                [ArtifactVersionID],
                [Direction]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ConversationDetailID,
                @ArtifactVersionID,
                ISNULL(@Direction, 'Output')
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwConversationDetailArtifacts] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJConversationDetailArtifact] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Conversation Detail Artifacts */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJConversationDetailArtifact] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Conversation Detail Artifacts */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Conversation Detail Artifacts
-- Item: spUpdateMJConversationDetailArtifact
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR ConversationDetailArtifact
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJConversationDetailArtifact]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJConversationDetailArtifact];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJConversationDetailArtifact]
    @ID uniqueidentifier,
    @ConversationDetailID uniqueidentifier,
    @ArtifactVersionID uniqueidentifier,
    @Direction nvarchar(20)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ConversationDetailArtifact]
    SET
        [ConversationDetailID] = @ConversationDetailID,
        [ArtifactVersionID] = @ArtifactVersionID,
        [Direction] = @Direction
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwConversationDetailArtifacts] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwConversationDetailArtifacts]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJConversationDetailArtifact] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the ConversationDetailArtifact table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJConversationDetailArtifact]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJConversationDetailArtifact];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJConversationDetailArtifact
ON [${flyway:defaultSchema}].[ConversationDetailArtifact]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ConversationDetailArtifact]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[ConversationDetailArtifact] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Conversation Detail Artifacts */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJConversationDetailArtifact] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Conversation Detail Artifacts */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Conversation Detail Artifacts
-- Item: spDeleteMJConversationDetailArtifact
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR ConversationDetailArtifact
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJConversationDetailArtifact]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJConversationDetailArtifact];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJConversationDetailArtifact]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[ConversationDetailArtifact]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJConversationDetailArtifact] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Conversation Detail Artifacts */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJConversationDetailArtifact] TO [cdp_Integration]



/* Base View SQL for MJ: Conversation Artifact Permissions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Conversation Artifact Permissions
-- Item: vwConversationArtifactPermissions
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Conversation Artifact Permissions
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  ConversationArtifactPermission
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwConversationArtifactPermissions]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwConversationArtifactPermissions];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwConversationArtifactPermissions]
AS
SELECT
    m.*,
    MJConversationArtifacts_ConversationArtifactID.[Name] AS [ConversationArtifact]
FROM
    [${flyway:defaultSchema}].[ConversationArtifactPermission] AS m
INNER JOIN
    [${flyway:defaultSchema}].[ConversationArtifact] AS MJConversationArtifacts_ConversationArtifactID
  ON
    [m].[ConversationArtifactID] = MJConversationArtifacts_ConversationArtifactID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwConversationArtifactPermissions] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Conversation Artifact Permissions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Conversation Artifact Permissions
-- Item: Permissions for vwConversationArtifactPermissions
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwConversationArtifactPermissions] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Conversation Artifact Permissions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Conversation Artifact Permissions
-- Item: spCreateMJConversationArtifactPermission
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR ConversationArtifactPermission
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJConversationArtifactPermission]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJConversationArtifactPermission];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJConversationArtifactPermission]
    @ID uniqueidentifier = NULL,
    @ConversationArtifactID uniqueidentifier,
    @UserID uniqueidentifier,
    @AccessLevel nvarchar(20)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[ConversationArtifactPermission]
            (
                [ID],
                [ConversationArtifactID],
                [UserID],
                [AccessLevel]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @ConversationArtifactID,
                @UserID,
                @AccessLevel
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[ConversationArtifactPermission]
            (
                [ConversationArtifactID],
                [UserID],
                [AccessLevel]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ConversationArtifactID,
                @UserID,
                @AccessLevel
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwConversationArtifactPermissions] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJConversationArtifactPermission] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Conversation Artifact Permissions */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJConversationArtifactPermission] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Conversation Artifact Permissions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Conversation Artifact Permissions
-- Item: spUpdateMJConversationArtifactPermission
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR ConversationArtifactPermission
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJConversationArtifactPermission]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJConversationArtifactPermission];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJConversationArtifactPermission]
    @ID uniqueidentifier,
    @ConversationArtifactID uniqueidentifier,
    @UserID uniqueidentifier,
    @AccessLevel nvarchar(20)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ConversationArtifactPermission]
    SET
        [ConversationArtifactID] = @ConversationArtifactID,
        [UserID] = @UserID,
        [AccessLevel] = @AccessLevel
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwConversationArtifactPermissions] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwConversationArtifactPermissions]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJConversationArtifactPermission] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the ConversationArtifactPermission table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJConversationArtifactPermission]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJConversationArtifactPermission];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJConversationArtifactPermission
ON [${flyway:defaultSchema}].[ConversationArtifactPermission]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ConversationArtifactPermission]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[ConversationArtifactPermission] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Conversation Artifact Permissions */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJConversationArtifactPermission] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Conversation Artifact Permissions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Conversation Artifact Permissions
-- Item: spDeleteMJConversationArtifactPermission
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR ConversationArtifactPermission
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJConversationArtifactPermission]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJConversationArtifactPermission];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJConversationArtifactPermission]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[ConversationArtifactPermission]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJConversationArtifactPermission] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Conversation Artifact Permissions */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJConversationArtifactPermission] TO [cdp_Integration]



/* spDelete SQL for MJ: Conversation Artifact Versions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Conversation Artifact Versions
-- Item: spDeleteMJConversationArtifactVersion
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR ConversationArtifactVersion
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJConversationArtifactVersion]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJConversationArtifactVersion];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJConversationArtifactVersion]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    -- Cascade update on ConversationDetail using cursor to call spUpdateMJConversationDetail
    DECLARE @false_ArtifactVersionIDID uniqueidentifier
    DECLARE @false_ArtifactVersionID_ConversationID uniqueidentifier
    DECLARE @false_ArtifactVersionID_ExternalID nvarchar(100)
    DECLARE @false_ArtifactVersionID_Role nvarchar(20)
    DECLARE @false_ArtifactVersionID_Message nvarchar(MAX)
    DECLARE @false_ArtifactVersionID_Error nvarchar(MAX)
    DECLARE @false_ArtifactVersionID_HiddenToUser bit
    DECLARE @false_ArtifactVersionID_UserRating int
    DECLARE @false_ArtifactVersionID_UserFeedback nvarchar(MAX)
    DECLARE @false_ArtifactVersionID_ReflectionInsights nvarchar(MAX)
    DECLARE @false_ArtifactVersionID_SummaryOfEarlierConversation nvarchar(MAX)
    DECLARE @false_ArtifactVersionID_UserID uniqueidentifier
    DECLARE @false_ArtifactVersionID_ArtifactID uniqueidentifier
    DECLARE @false_ArtifactVersionID_ArtifactVersionID uniqueidentifier
    DECLARE @false_ArtifactVersionID_CompletionTime bigint
    DECLARE @false_ArtifactVersionID_IsPinned bit
    DECLARE @false_ArtifactVersionID_ParentID uniqueidentifier
    DECLARE @false_ArtifactVersionID_AgentID uniqueidentifier
    DECLARE @false_ArtifactVersionID_Status nvarchar(20)
    DECLARE @false_ArtifactVersionID_SuggestedResponses nvarchar(MAX)
    DECLARE @false_ArtifactVersionID_TestRunID uniqueidentifier
    DECLARE @false_ArtifactVersionID_ResponseForm nvarchar(MAX)
    DECLARE @false_ArtifactVersionID_ActionableCommands nvarchar(MAX)
    DECLARE @false_ArtifactVersionID_AutomaticCommands nvarchar(MAX)
    DECLARE @false_ArtifactVersionID_OriginalMessageChanged bit
    DECLARE cascade_update_false_ArtifactVersionID_cursor CURSOR FOR
        SELECT [ID], [ConversationID], [ExternalID], [Role], [Message], [Error], [HiddenToUser], [UserRating], [UserFeedback], [ReflectionInsights], [SummaryOfEarlierConversation], [UserID], [ArtifactID], [ArtifactVersionID], [CompletionTime], [IsPinned], [ParentID], [AgentID], [Status], [SuggestedResponses], [TestRunID], [ResponseForm], [ActionableCommands], [AutomaticCommands], [OriginalMessageChanged]
        FROM [${flyway:defaultSchema}].[ConversationDetail]
        WHERE [ArtifactVersionID] = @ID

    OPEN cascade_update_false_ArtifactVersionID_cursor
    FETCH NEXT FROM cascade_update_false_ArtifactVersionID_cursor INTO @false_ArtifactVersionIDID, @false_ArtifactVersionID_ConversationID, @false_ArtifactVersionID_ExternalID, @false_ArtifactVersionID_Role, @false_ArtifactVersionID_Message, @false_ArtifactVersionID_Error, @false_ArtifactVersionID_HiddenToUser, @false_ArtifactVersionID_UserRating, @false_ArtifactVersionID_UserFeedback, @false_ArtifactVersionID_ReflectionInsights, @false_ArtifactVersionID_SummaryOfEarlierConversation, @false_ArtifactVersionID_UserID, @false_ArtifactVersionID_ArtifactID, @false_ArtifactVersionID_ArtifactVersionID, @false_ArtifactVersionID_CompletionTime, @false_ArtifactVersionID_IsPinned, @false_ArtifactVersionID_ParentID, @false_ArtifactVersionID_AgentID, @false_ArtifactVersionID_Status, @false_ArtifactVersionID_SuggestedResponses, @false_ArtifactVersionID_TestRunID, @false_ArtifactVersionID_ResponseForm, @false_ArtifactVersionID_ActionableCommands, @false_ArtifactVersionID_AutomaticCommands, @false_ArtifactVersionID_OriginalMessageChanged

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @false_ArtifactVersionID_ArtifactVersionID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateMJConversationDetail] @ID = @false_ArtifactVersionIDID, @ConversationID = @false_ArtifactVersionID_ConversationID, @ExternalID = @false_ArtifactVersionID_ExternalID, @Role = @false_ArtifactVersionID_Role, @Message = @false_ArtifactVersionID_Message, @Error = @false_ArtifactVersionID_Error, @HiddenToUser = @false_ArtifactVersionID_HiddenToUser, @UserRating = @false_ArtifactVersionID_UserRating, @UserFeedback = @false_ArtifactVersionID_UserFeedback, @ReflectionInsights = @false_ArtifactVersionID_ReflectionInsights, @SummaryOfEarlierConversation = @false_ArtifactVersionID_SummaryOfEarlierConversation, @UserID = @false_ArtifactVersionID_UserID, @ArtifactID = @false_ArtifactVersionID_ArtifactID, @ArtifactVersionID = @false_ArtifactVersionID_ArtifactVersionID, @CompletionTime = @false_ArtifactVersionID_CompletionTime, @IsPinned = @false_ArtifactVersionID_IsPinned, @ParentID = @false_ArtifactVersionID_ParentID, @AgentID = @false_ArtifactVersionID_AgentID, @Status = @false_ArtifactVersionID_Status, @SuggestedResponses = @false_ArtifactVersionID_SuggestedResponses, @TestRunID = @false_ArtifactVersionID_TestRunID, @ResponseForm = @false_ArtifactVersionID_ResponseForm, @ActionableCommands = @false_ArtifactVersionID_ActionableCommands, @AutomaticCommands = @false_ArtifactVersionID_AutomaticCommands, @OriginalMessageChanged = @false_ArtifactVersionID_OriginalMessageChanged

        FETCH NEXT FROM cascade_update_false_ArtifactVersionID_cursor INTO @false_ArtifactVersionIDID, @false_ArtifactVersionID_ConversationID, @false_ArtifactVersionID_ExternalID, @false_ArtifactVersionID_Role, @false_ArtifactVersionID_Message, @false_ArtifactVersionID_Error, @false_ArtifactVersionID_HiddenToUser, @false_ArtifactVersionID_UserRating, @false_ArtifactVersionID_UserFeedback, @false_ArtifactVersionID_ReflectionInsights, @false_ArtifactVersionID_SummaryOfEarlierConversation, @false_ArtifactVersionID_UserID, @false_ArtifactVersionID_ArtifactID, @false_ArtifactVersionID_ArtifactVersionID, @false_ArtifactVersionID_CompletionTime, @false_ArtifactVersionID_IsPinned, @false_ArtifactVersionID_ParentID, @false_ArtifactVersionID_AgentID, @false_ArtifactVersionID_Status, @false_ArtifactVersionID_SuggestedResponses, @false_ArtifactVersionID_TestRunID, @false_ArtifactVersionID_ResponseForm, @false_ArtifactVersionID_ActionableCommands, @false_ArtifactVersionID_AutomaticCommands, @false_ArtifactVersionID_OriginalMessageChanged
    END

    CLOSE cascade_update_false_ArtifactVersionID_cursor
    DEALLOCATE cascade_update_false_ArtifactVersionID_cursor
    

    DELETE FROM
        [${flyway:defaultSchema}].[ConversationArtifactVersion]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJConversationArtifactVersion] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Conversation Artifact Versions */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJConversationArtifactVersion] TO [cdp_Integration]



/* spDelete SQL for MJ: Conversation Artifacts */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Conversation Artifacts
-- Item: spDeleteMJConversationArtifact
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR ConversationArtifact
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJConversationArtifact]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJConversationArtifact];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJConversationArtifact]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    -- Cascade delete from ConversationArtifactPermission using cursor to call spDeleteMJConversationArtifactPermission
    DECLARE @false_ConversationArtifactIDID uniqueidentifier
    DECLARE cascade_delete_false_ConversationArtifactID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[ConversationArtifactPermission]
        WHERE [ConversationArtifactID] = @ID
    
    OPEN cascade_delete_false_ConversationArtifactID_cursor
    FETCH NEXT FROM cascade_delete_false_ConversationArtifactID_cursor INTO @false_ConversationArtifactIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteMJConversationArtifactPermission] @ID = @false_ConversationArtifactIDID
        
        FETCH NEXT FROM cascade_delete_false_ConversationArtifactID_cursor INTO @false_ConversationArtifactIDID
    END
    
    CLOSE cascade_delete_false_ConversationArtifactID_cursor
    DEALLOCATE cascade_delete_false_ConversationArtifactID_cursor
    
    -- Cascade delete from ConversationArtifactVersion using cursor to call spDeleteMJConversationArtifactVersion
    DECLARE @false_ConversationArtifactIDID uniqueidentifier
    DECLARE cascade_delete_false_ConversationArtifactID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[ConversationArtifactVersion]
        WHERE [ConversationArtifactID] = @ID
    
    OPEN cascade_delete_false_ConversationArtifactID_cursor
    FETCH NEXT FROM cascade_delete_false_ConversationArtifactID_cursor INTO @false_ConversationArtifactIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteMJConversationArtifactVersion] @ID = @false_ConversationArtifactIDID
        
        FETCH NEXT FROM cascade_delete_false_ConversationArtifactID_cursor INTO @false_ConversationArtifactIDID
    END
    
    CLOSE cascade_delete_false_ConversationArtifactID_cursor
    DEALLOCATE cascade_delete_false_ConversationArtifactID_cursor
    
    -- Cascade update on ConversationDetail using cursor to call spUpdateMJConversationDetail
    DECLARE @false_ArtifactIDID uniqueidentifier
    DECLARE @false_ArtifactID_ConversationID uniqueidentifier
    DECLARE @false_ArtifactID_ExternalID nvarchar(100)
    DECLARE @false_ArtifactID_Role nvarchar(20)
    DECLARE @false_ArtifactID_Message nvarchar(MAX)
    DECLARE @false_ArtifactID_Error nvarchar(MAX)
    DECLARE @false_ArtifactID_HiddenToUser bit
    DECLARE @false_ArtifactID_UserRating int
    DECLARE @false_ArtifactID_UserFeedback nvarchar(MAX)
    DECLARE @false_ArtifactID_ReflectionInsights nvarchar(MAX)
    DECLARE @false_ArtifactID_SummaryOfEarlierConversation nvarchar(MAX)
    DECLARE @false_ArtifactID_UserID uniqueidentifier
    DECLARE @false_ArtifactID_ArtifactID uniqueidentifier
    DECLARE @false_ArtifactID_ArtifactVersionID uniqueidentifier
    DECLARE @false_ArtifactID_CompletionTime bigint
    DECLARE @false_ArtifactID_IsPinned bit
    DECLARE @false_ArtifactID_ParentID uniqueidentifier
    DECLARE @false_ArtifactID_AgentID uniqueidentifier
    DECLARE @false_ArtifactID_Status nvarchar(20)
    DECLARE @false_ArtifactID_SuggestedResponses nvarchar(MAX)
    DECLARE @false_ArtifactID_TestRunID uniqueidentifier
    DECLARE @false_ArtifactID_ResponseForm nvarchar(MAX)
    DECLARE @false_ArtifactID_ActionableCommands nvarchar(MAX)
    DECLARE @false_ArtifactID_AutomaticCommands nvarchar(MAX)
    DECLARE @false_ArtifactID_OriginalMessageChanged bit
    DECLARE cascade_update_false_ArtifactID_cursor CURSOR FOR
        SELECT [ID], [ConversationID], [ExternalID], [Role], [Message], [Error], [HiddenToUser], [UserRating], [UserFeedback], [ReflectionInsights], [SummaryOfEarlierConversation], [UserID], [ArtifactID], [ArtifactVersionID], [CompletionTime], [IsPinned], [ParentID], [AgentID], [Status], [SuggestedResponses], [TestRunID], [ResponseForm], [ActionableCommands], [AutomaticCommands], [OriginalMessageChanged]
        FROM [${flyway:defaultSchema}].[ConversationDetail]
        WHERE [ArtifactID] = @ID

    OPEN cascade_update_false_ArtifactID_cursor
    FETCH NEXT FROM cascade_update_false_ArtifactID_cursor INTO @false_ArtifactIDID, @false_ArtifactID_ConversationID, @false_ArtifactID_ExternalID, @false_ArtifactID_Role, @false_ArtifactID_Message, @false_ArtifactID_Error, @false_ArtifactID_HiddenToUser, @false_ArtifactID_UserRating, @false_ArtifactID_UserFeedback, @false_ArtifactID_ReflectionInsights, @false_ArtifactID_SummaryOfEarlierConversation, @false_ArtifactID_UserID, @false_ArtifactID_ArtifactID, @false_ArtifactID_ArtifactVersionID, @false_ArtifactID_CompletionTime, @false_ArtifactID_IsPinned, @false_ArtifactID_ParentID, @false_ArtifactID_AgentID, @false_ArtifactID_Status, @false_ArtifactID_SuggestedResponses, @false_ArtifactID_TestRunID, @false_ArtifactID_ResponseForm, @false_ArtifactID_ActionableCommands, @false_ArtifactID_AutomaticCommands, @false_ArtifactID_OriginalMessageChanged

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @false_ArtifactID_ArtifactID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateMJConversationDetail] @ID = @false_ArtifactIDID, @ConversationID = @false_ArtifactID_ConversationID, @ExternalID = @false_ArtifactID_ExternalID, @Role = @false_ArtifactID_Role, @Message = @false_ArtifactID_Message, @Error = @false_ArtifactID_Error, @HiddenToUser = @false_ArtifactID_HiddenToUser, @UserRating = @false_ArtifactID_UserRating, @UserFeedback = @false_ArtifactID_UserFeedback, @ReflectionInsights = @false_ArtifactID_ReflectionInsights, @SummaryOfEarlierConversation = @false_ArtifactID_SummaryOfEarlierConversation, @UserID = @false_ArtifactID_UserID, @ArtifactID = @false_ArtifactID_ArtifactID, @ArtifactVersionID = @false_ArtifactID_ArtifactVersionID, @CompletionTime = @false_ArtifactID_CompletionTime, @IsPinned = @false_ArtifactID_IsPinned, @ParentID = @false_ArtifactID_ParentID, @AgentID = @false_ArtifactID_AgentID, @Status = @false_ArtifactID_Status, @SuggestedResponses = @false_ArtifactID_SuggestedResponses, @TestRunID = @false_ArtifactID_TestRunID, @ResponseForm = @false_ArtifactID_ResponseForm, @ActionableCommands = @false_ArtifactID_ActionableCommands, @AutomaticCommands = @false_ArtifactID_AutomaticCommands, @OriginalMessageChanged = @false_ArtifactID_OriginalMessageChanged

        FETCH NEXT FROM cascade_update_false_ArtifactID_cursor INTO @false_ArtifactIDID, @false_ArtifactID_ConversationID, @false_ArtifactID_ExternalID, @false_ArtifactID_Role, @false_ArtifactID_Message, @false_ArtifactID_Error, @false_ArtifactID_HiddenToUser, @false_ArtifactID_UserRating, @false_ArtifactID_UserFeedback, @false_ArtifactID_ReflectionInsights, @false_ArtifactID_SummaryOfEarlierConversation, @false_ArtifactID_UserID, @false_ArtifactID_ArtifactID, @false_ArtifactID_ArtifactVersionID, @false_ArtifactID_CompletionTime, @false_ArtifactID_IsPinned, @false_ArtifactID_ParentID, @false_ArtifactID_AgentID, @false_ArtifactID_Status, @false_ArtifactID_SuggestedResponses, @false_ArtifactID_TestRunID, @false_ArtifactID_ResponseForm, @false_ArtifactID_ActionableCommands, @false_ArtifactID_AutomaticCommands, @false_ArtifactID_OriginalMessageChanged
    END

    CLOSE cascade_update_false_ArtifactID_cursor
    DEALLOCATE cascade_update_false_ArtifactID_cursor
    

    DELETE FROM
        [${flyway:defaultSchema}].[ConversationArtifact]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJConversationArtifact] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Conversation Artifacts */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJConversationArtifact] TO [cdp_Integration]



/* Base View SQL for MJ: Conversation Detail Ratings */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Conversation Detail Ratings
-- Item: vwConversationDetailRatings
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Conversation Detail Ratings
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  ConversationDetailRating
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwConversationDetailRatings]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwConversationDetailRatings];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwConversationDetailRatings]
AS
SELECT
    m.*,
    MJConversationDetails_ConversationDetailID.[Message] AS [ConversationDetail],
    MJUsers_UserID.[Name] AS [User]
FROM
    [${flyway:defaultSchema}].[ConversationDetailRating] AS m
INNER JOIN
    [${flyway:defaultSchema}].[ConversationDetail] AS MJConversationDetails_ConversationDetailID
  ON
    [m].[ConversationDetailID] = MJConversationDetails_ConversationDetailID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_UserID
  ON
    [m].[UserID] = MJUsers_UserID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwConversationDetailRatings] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Conversation Detail Ratings */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Conversation Detail Ratings
-- Item: Permissions for vwConversationDetailRatings
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwConversationDetailRatings] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Conversation Detail Ratings */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Conversation Detail Ratings
-- Item: spCreateMJConversationDetailRating
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR ConversationDetailRating
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJConversationDetailRating]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJConversationDetailRating];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJConversationDetailRating]
    @ID uniqueidentifier = NULL,
    @ConversationDetailID uniqueidentifier,
    @UserID uniqueidentifier,
    @Rating int,
    @Comments nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[ConversationDetailRating]
            (
                [ID],
                [ConversationDetailID],
                [UserID],
                [Rating],
                [Comments]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @ConversationDetailID,
                @UserID,
                @Rating,
                @Comments
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[ConversationDetailRating]
            (
                [ConversationDetailID],
                [UserID],
                [Rating],
                [Comments]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ConversationDetailID,
                @UserID,
                @Rating,
                @Comments
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwConversationDetailRatings] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJConversationDetailRating] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Conversation Detail Ratings */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJConversationDetailRating] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Conversation Detail Ratings */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Conversation Detail Ratings
-- Item: spUpdateMJConversationDetailRating
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR ConversationDetailRating
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJConversationDetailRating]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJConversationDetailRating];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJConversationDetailRating]
    @ID uniqueidentifier,
    @ConversationDetailID uniqueidentifier,
    @UserID uniqueidentifier,
    @Rating int,
    @Comments nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ConversationDetailRating]
    SET
        [ConversationDetailID] = @ConversationDetailID,
        [UserID] = @UserID,
        [Rating] = @Rating,
        [Comments] = @Comments
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwConversationDetailRatings] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwConversationDetailRatings]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJConversationDetailRating] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the ConversationDetailRating table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJConversationDetailRating]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJConversationDetailRating];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJConversationDetailRating
ON [${flyway:defaultSchema}].[ConversationDetailRating]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ConversationDetailRating]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[ConversationDetailRating] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Conversation Detail Ratings */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJConversationDetailRating] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Conversation Detail Ratings */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Conversation Detail Ratings
-- Item: spDeleteMJConversationDetailRating
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR ConversationDetailRating
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJConversationDetailRating]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJConversationDetailRating];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJConversationDetailRating]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[ConversationDetailRating]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJConversationDetailRating] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Conversation Detail Ratings */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJConversationDetailRating] TO [cdp_Integration]



/* Base View SQL for MJ: Conversations */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Conversations
-- Item: vwConversations
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Conversations
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  Conversation
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwConversations]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwConversations];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwConversations]
AS
SELECT
    m.*,
    MJUsers_UserID.[Name] AS [User],
    MJEntities_LinkedEntityID.[Name] AS [LinkedEntity],
    MJDataContexts_DataContextID.[Name] AS [DataContext],
    MJEnvironments_EnvironmentID.[Name] AS [Environment],
    MJProjects_ProjectID.[Name] AS [Project],
    MJTestRuns_TestRunID.[Test] AS [TestRun]
FROM
    [${flyway:defaultSchema}].[Conversation] AS m
INNER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_UserID
  ON
    [m].[UserID] = MJUsers_UserID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[Entity] AS MJEntities_LinkedEntityID
  ON
    [m].[LinkedEntityID] = MJEntities_LinkedEntityID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[DataContext] AS MJDataContexts_DataContextID
  ON
    [m].[DataContextID] = MJDataContexts_DataContextID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[Environment] AS MJEnvironments_EnvironmentID
  ON
    [m].[EnvironmentID] = MJEnvironments_EnvironmentID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[Project] AS MJProjects_ProjectID
  ON
    [m].[ProjectID] = MJProjects_ProjectID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[vwTestRuns] AS MJTestRuns_TestRunID
  ON
    [m].[TestRunID] = MJTestRuns_TestRunID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwConversations] TO [cdp_Developer], [cdp_UI], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Conversations */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Conversations
-- Item: Permissions for vwConversations
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwConversations] TO [cdp_Developer], [cdp_UI], [cdp_Integration]

/* spCreate SQL for MJ: Conversations */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Conversations
-- Item: spCreateMJConversation
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR Conversation
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJConversation]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJConversation];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJConversation]
    @ID uniqueidentifier = NULL,
    @UserID uniqueidentifier,
    @ExternalID nvarchar(500),
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @Type nvarchar(50) = NULL,
    @IsArchived bit = NULL,
    @LinkedEntityID uniqueidentifier,
    @LinkedRecordID nvarchar(500),
    @DataContextID uniqueidentifier,
    @Status nvarchar(20) = NULL,
    @EnvironmentID uniqueidentifier = NULL,
    @ProjectID uniqueidentifier,
    @IsPinned bit = NULL,
    @TestRunID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[Conversation]
            (
                [ID],
                [UserID],
                [ExternalID],
                [Name],
                [Description],
                [Type],
                [IsArchived],
                [LinkedEntityID],
                [LinkedRecordID],
                [DataContextID],
                [Status],
                [EnvironmentID],
                [ProjectID],
                [IsPinned],
                [TestRunID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @UserID,
                @ExternalID,
                @Name,
                @Description,
                ISNULL(@Type, 'Skip'),
                ISNULL(@IsArchived, 0),
                @LinkedEntityID,
                @LinkedRecordID,
                @DataContextID,
                ISNULL(@Status, 'Available'),
                CASE @EnvironmentID WHEN '00000000-0000-0000-0000-000000000000' THEN 'F51358F3-9447-4176-B313-BF8025FD8D09' ELSE ISNULL(@EnvironmentID, 'F51358F3-9447-4176-B313-BF8025FD8D09') END,
                @ProjectID,
                ISNULL(@IsPinned, 0),
                @TestRunID
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[Conversation]
            (
                [UserID],
                [ExternalID],
                [Name],
                [Description],
                [Type],
                [IsArchived],
                [LinkedEntityID],
                [LinkedRecordID],
                [DataContextID],
                [Status],
                [EnvironmentID],
                [ProjectID],
                [IsPinned],
                [TestRunID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @UserID,
                @ExternalID,
                @Name,
                @Description,
                ISNULL(@Type, 'Skip'),
                ISNULL(@IsArchived, 0),
                @LinkedEntityID,
                @LinkedRecordID,
                @DataContextID,
                ISNULL(@Status, 'Available'),
                CASE @EnvironmentID WHEN '00000000-0000-0000-0000-000000000000' THEN 'F51358F3-9447-4176-B313-BF8025FD8D09' ELSE ISNULL(@EnvironmentID, 'F51358F3-9447-4176-B313-BF8025FD8D09') END,
                @ProjectID,
                ISNULL(@IsPinned, 0),
                @TestRunID
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwConversations] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJConversation] TO [cdp_Developer], [cdp_UI], [cdp_Integration]
    

/* spCreate Permissions for MJ: Conversations */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJConversation] TO [cdp_Developer], [cdp_UI], [cdp_Integration]



/* spUpdate SQL for MJ: Conversations */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Conversations
-- Item: spUpdateMJConversation
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR Conversation
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJConversation]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJConversation];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJConversation]
    @ID uniqueidentifier,
    @UserID uniqueidentifier,
    @ExternalID nvarchar(500),
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @Type nvarchar(50),
    @IsArchived bit,
    @LinkedEntityID uniqueidentifier,
    @LinkedRecordID nvarchar(500),
    @DataContextID uniqueidentifier,
    @Status nvarchar(20),
    @EnvironmentID uniqueidentifier,
    @ProjectID uniqueidentifier,
    @IsPinned bit,
    @TestRunID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[Conversation]
    SET
        [UserID] = @UserID,
        [ExternalID] = @ExternalID,
        [Name] = @Name,
        [Description] = @Description,
        [Type] = @Type,
        [IsArchived] = @IsArchived,
        [LinkedEntityID] = @LinkedEntityID,
        [LinkedRecordID] = @LinkedRecordID,
        [DataContextID] = @DataContextID,
        [Status] = @Status,
        [EnvironmentID] = @EnvironmentID,
        [ProjectID] = @ProjectID,
        [IsPinned] = @IsPinned,
        [TestRunID] = @TestRunID
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwConversations] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwConversations]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJConversation] TO [cdp_Developer], [cdp_UI], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the Conversation table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJConversation]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJConversation];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJConversation
ON [${flyway:defaultSchema}].[Conversation]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[Conversation]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[Conversation] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Conversations */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJConversation] TO [cdp_Developer], [cdp_UI], [cdp_Integration]



/* Base View SQL for MJ: Credential Categories */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Credential Categories
-- Item: vwCredentialCategories
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Credential Categories
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  CredentialCategory
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwCredentialCategories]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwCredentialCategories];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwCredentialCategories]
AS
SELECT
    m.*,
    MJCredentialCategories_ParentID.[Name] AS [Parent],
    root_ParentID.RootID AS [RootParentID]
FROM
    [${flyway:defaultSchema}].[CredentialCategory] AS m
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[CredentialCategory] AS MJCredentialCategories_ParentID
  ON
    [m].[ParentID] = MJCredentialCategories_ParentID.[ID]
OUTER APPLY
    [${flyway:defaultSchema}].[fnCredentialCategoryParentID_GetRootID]([m].[ID], [m].[ParentID]) AS root_ParentID
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwCredentialCategories] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Credential Categories */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Credential Categories
-- Item: Permissions for vwCredentialCategories
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwCredentialCategories] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Credential Categories */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Credential Categories
-- Item: spCreateMJCredentialCategory
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR CredentialCategory
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJCredentialCategory]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJCredentialCategory];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJCredentialCategory]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(100),
    @Description nvarchar(MAX),
    @ParentID uniqueidentifier,
    @IconClass nvarchar(100)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[CredentialCategory]
            (
                [ID],
                [Name],
                [Description],
                [ParentID],
                [IconClass]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description,
                @ParentID,
                @IconClass
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[CredentialCategory]
            (
                [Name],
                [Description],
                [ParentID],
                [IconClass]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description,
                @ParentID,
                @IconClass
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwCredentialCategories] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJCredentialCategory] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Credential Categories */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJCredentialCategory] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Credential Categories */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Credential Categories
-- Item: spUpdateMJCredentialCategory
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR CredentialCategory
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJCredentialCategory]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJCredentialCategory];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJCredentialCategory]
    @ID uniqueidentifier,
    @Name nvarchar(100),
    @Description nvarchar(MAX),
    @ParentID uniqueidentifier,
    @IconClass nvarchar(100)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[CredentialCategory]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [ParentID] = @ParentID,
        [IconClass] = @IconClass
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwCredentialCategories] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwCredentialCategories]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJCredentialCategory] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the CredentialCategory table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJCredentialCategory]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJCredentialCategory];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJCredentialCategory
ON [${flyway:defaultSchema}].[CredentialCategory]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[CredentialCategory]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[CredentialCategory] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Credential Categories */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJCredentialCategory] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Credential Categories */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Credential Categories
-- Item: spDeleteMJCredentialCategory
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR CredentialCategory
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJCredentialCategory]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJCredentialCategory];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJCredentialCategory]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[CredentialCategory]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJCredentialCategory] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Credential Categories */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJCredentialCategory] TO [cdp_Integration]



/* Base View SQL for MJ: Credential Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Credential Types
-- Item: vwCredentialTypes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Credential Types
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  CredentialType
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwCredentialTypes]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwCredentialTypes];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwCredentialTypes]
AS
SELECT
    m.*
FROM
    [${flyway:defaultSchema}].[CredentialType] AS m
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwCredentialTypes] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Credential Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Credential Types
-- Item: Permissions for vwCredentialTypes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwCredentialTypes] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Credential Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Credential Types
-- Item: spCreateMJCredentialType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR CredentialType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJCredentialType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJCredentialType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJCredentialType]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(100),
    @Description nvarchar(MAX),
    @Category nvarchar(50),
    @FieldSchema nvarchar(MAX),
    @IconClass nvarchar(100),
    @ValidationEndpoint nvarchar(500)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[CredentialType]
            (
                [ID],
                [Name],
                [Description],
                [Category],
                [FieldSchema],
                [IconClass],
                [ValidationEndpoint]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description,
                @Category,
                @FieldSchema,
                @IconClass,
                @ValidationEndpoint
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[CredentialType]
            (
                [Name],
                [Description],
                [Category],
                [FieldSchema],
                [IconClass],
                [ValidationEndpoint]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description,
                @Category,
                @FieldSchema,
                @IconClass,
                @ValidationEndpoint
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwCredentialTypes] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJCredentialType] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Credential Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJCredentialType] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Credential Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Credential Types
-- Item: spUpdateMJCredentialType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR CredentialType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJCredentialType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJCredentialType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJCredentialType]
    @ID uniqueidentifier,
    @Name nvarchar(100),
    @Description nvarchar(MAX),
    @Category nvarchar(50),
    @FieldSchema nvarchar(MAX),
    @IconClass nvarchar(100),
    @ValidationEndpoint nvarchar(500)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[CredentialType]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [Category] = @Category,
        [FieldSchema] = @FieldSchema,
        [IconClass] = @IconClass,
        [ValidationEndpoint] = @ValidationEndpoint
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwCredentialTypes] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwCredentialTypes]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJCredentialType] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the CredentialType table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJCredentialType]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJCredentialType];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJCredentialType
ON [${flyway:defaultSchema}].[CredentialType]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[CredentialType]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[CredentialType] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Credential Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJCredentialType] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Credential Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Credential Types
-- Item: spDeleteMJCredentialType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR CredentialType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJCredentialType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJCredentialType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJCredentialType]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[CredentialType]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJCredentialType] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Credential Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJCredentialType] TO [cdp_Integration]



/* Base View SQL for MJ: Conversation Details */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Conversation Details
-- Item: vwConversationDetails
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Conversation Details
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  ConversationDetail
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwConversationDetails]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwConversationDetails];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwConversationDetails]
AS
SELECT
    m.*,
    MJConversations_ConversationID.[Name] AS [Conversation],
    MJUsers_UserID.[Name] AS [User],
    MJConversationArtifacts_ArtifactID.[Name] AS [Artifact],
    MJConversationArtifactVersions_ArtifactVersionID.[ConversationArtifact] AS [ArtifactVersion],
    MJConversationDetails_ParentID.[Message] AS [Parent],
    MJAIAgents_AgentID.[Name] AS [Agent],
    MJTestRuns_TestRunID.[Test] AS [TestRun],
    root_ParentID.RootID AS [RootParentID]
FROM
    [${flyway:defaultSchema}].[ConversationDetail] AS m
INNER JOIN
    [${flyway:defaultSchema}].[Conversation] AS MJConversations_ConversationID
  ON
    [m].[ConversationID] = MJConversations_ConversationID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_UserID
  ON
    [m].[UserID] = MJUsers_UserID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[ConversationArtifact] AS MJConversationArtifacts_ArtifactID
  ON
    [m].[ArtifactID] = MJConversationArtifacts_ArtifactID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[vwConversationArtifactVersions] AS MJConversationArtifactVersions_ArtifactVersionID
  ON
    [m].[ArtifactVersionID] = MJConversationArtifactVersions_ArtifactVersionID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[ConversationDetail] AS MJConversationDetails_ParentID
  ON
    [m].[ParentID] = MJConversationDetails_ParentID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[AIAgent] AS MJAIAgents_AgentID
  ON
    [m].[AgentID] = MJAIAgents_AgentID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[vwTestRuns] AS MJTestRuns_TestRunID
  ON
    [m].[TestRunID] = MJTestRuns_TestRunID.[ID]
OUTER APPLY
    [${flyway:defaultSchema}].[fnConversationDetailParentID_GetRootID]([m].[ID], [m].[ParentID]) AS root_ParentID
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwConversationDetails] TO [cdp_Developer], [cdp_UI], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Conversation Details */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Conversation Details
-- Item: Permissions for vwConversationDetails
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwConversationDetails] TO [cdp_Developer], [cdp_UI], [cdp_Integration]

/* spCreate SQL for MJ: Conversation Details */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Conversation Details
-- Item: spCreateMJConversationDetail
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR ConversationDetail
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJConversationDetail]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJConversationDetail];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJConversationDetail]
    @ID uniqueidentifier = NULL,
    @ConversationID uniqueidentifier,
    @ExternalID nvarchar(100),
    @Role nvarchar(20) = NULL,
    @Message nvarchar(MAX),
    @Error nvarchar(MAX),
    @HiddenToUser bit = NULL,
    @UserRating int,
    @UserFeedback nvarchar(MAX),
    @ReflectionInsights nvarchar(MAX),
    @SummaryOfEarlierConversation nvarchar(MAX),
    @UserID uniqueidentifier,
    @ArtifactID uniqueidentifier,
    @ArtifactVersionID uniqueidentifier,
    @CompletionTime bigint,
    @IsPinned bit = NULL,
    @ParentID uniqueidentifier,
    @AgentID uniqueidentifier,
    @Status nvarchar(20) = NULL,
    @SuggestedResponses nvarchar(MAX),
    @TestRunID uniqueidentifier,
    @ResponseForm nvarchar(MAX),
    @ActionableCommands nvarchar(MAX),
    @AutomaticCommands nvarchar(MAX),
    @OriginalMessageChanged bit = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[ConversationDetail]
            (
                [ID],
                [ConversationID],
                [ExternalID],
                [Role],
                [Message],
                [Error],
                [HiddenToUser],
                [UserRating],
                [UserFeedback],
                [ReflectionInsights],
                [SummaryOfEarlierConversation],
                [UserID],
                [ArtifactID],
                [ArtifactVersionID],
                [CompletionTime],
                [IsPinned],
                [ParentID],
                [AgentID],
                [Status],
                [SuggestedResponses],
                [TestRunID],
                [ResponseForm],
                [ActionableCommands],
                [AutomaticCommands],
                [OriginalMessageChanged]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @ConversationID,
                @ExternalID,
                ISNULL(@Role, user_name()),
                @Message,
                @Error,
                ISNULL(@HiddenToUser, 0),
                @UserRating,
                @UserFeedback,
                @ReflectionInsights,
                @SummaryOfEarlierConversation,
                @UserID,
                @ArtifactID,
                @ArtifactVersionID,
                @CompletionTime,
                ISNULL(@IsPinned, 0),
                @ParentID,
                @AgentID,
                ISNULL(@Status, 'Complete'),
                @SuggestedResponses,
                @TestRunID,
                @ResponseForm,
                @ActionableCommands,
                @AutomaticCommands,
                ISNULL(@OriginalMessageChanged, 0)
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[ConversationDetail]
            (
                [ConversationID],
                [ExternalID],
                [Role],
                [Message],
                [Error],
                [HiddenToUser],
                [UserRating],
                [UserFeedback],
                [ReflectionInsights],
                [SummaryOfEarlierConversation],
                [UserID],
                [ArtifactID],
                [ArtifactVersionID],
                [CompletionTime],
                [IsPinned],
                [ParentID],
                [AgentID],
                [Status],
                [SuggestedResponses],
                [TestRunID],
                [ResponseForm],
                [ActionableCommands],
                [AutomaticCommands],
                [OriginalMessageChanged]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ConversationID,
                @ExternalID,
                ISNULL(@Role, user_name()),
                @Message,
                @Error,
                ISNULL(@HiddenToUser, 0),
                @UserRating,
                @UserFeedback,
                @ReflectionInsights,
                @SummaryOfEarlierConversation,
                @UserID,
                @ArtifactID,
                @ArtifactVersionID,
                @CompletionTime,
                ISNULL(@IsPinned, 0),
                @ParentID,
                @AgentID,
                ISNULL(@Status, 'Complete'),
                @SuggestedResponses,
                @TestRunID,
                @ResponseForm,
                @ActionableCommands,
                @AutomaticCommands,
                ISNULL(@OriginalMessageChanged, 0)
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwConversationDetails] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJConversationDetail] TO [cdp_Developer], [cdp_UI], [cdp_Integration]
    

/* spCreate Permissions for MJ: Conversation Details */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJConversationDetail] TO [cdp_Developer], [cdp_UI], [cdp_Integration]



/* spUpdate SQL for MJ: Conversation Details */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Conversation Details
-- Item: spUpdateMJConversationDetail
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR ConversationDetail
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJConversationDetail]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJConversationDetail];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJConversationDetail]
    @ID uniqueidentifier,
    @ConversationID uniqueidentifier,
    @ExternalID nvarchar(100),
    @Role nvarchar(20),
    @Message nvarchar(MAX),
    @Error nvarchar(MAX),
    @HiddenToUser bit,
    @UserRating int,
    @UserFeedback nvarchar(MAX),
    @ReflectionInsights nvarchar(MAX),
    @SummaryOfEarlierConversation nvarchar(MAX),
    @UserID uniqueidentifier,
    @ArtifactID uniqueidentifier,
    @ArtifactVersionID uniqueidentifier,
    @CompletionTime bigint,
    @IsPinned bit,
    @ParentID uniqueidentifier,
    @AgentID uniqueidentifier,
    @Status nvarchar(20),
    @SuggestedResponses nvarchar(MAX),
    @TestRunID uniqueidentifier,
    @ResponseForm nvarchar(MAX),
    @ActionableCommands nvarchar(MAX),
    @AutomaticCommands nvarchar(MAX),
    @OriginalMessageChanged bit
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ConversationDetail]
    SET
        [ConversationID] = @ConversationID,
        [ExternalID] = @ExternalID,
        [Role] = @Role,
        [Message] = @Message,
        [Error] = @Error,
        [HiddenToUser] = @HiddenToUser,
        [UserRating] = @UserRating,
        [UserFeedback] = @UserFeedback,
        [ReflectionInsights] = @ReflectionInsights,
        [SummaryOfEarlierConversation] = @SummaryOfEarlierConversation,
        [UserID] = @UserID,
        [ArtifactID] = @ArtifactID,
        [ArtifactVersionID] = @ArtifactVersionID,
        [CompletionTime] = @CompletionTime,
        [IsPinned] = @IsPinned,
        [ParentID] = @ParentID,
        [AgentID] = @AgentID,
        [Status] = @Status,
        [SuggestedResponses] = @SuggestedResponses,
        [TestRunID] = @TestRunID,
        [ResponseForm] = @ResponseForm,
        [ActionableCommands] = @ActionableCommands,
        [AutomaticCommands] = @AutomaticCommands,
        [OriginalMessageChanged] = @OriginalMessageChanged
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwConversationDetails] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwConversationDetails]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJConversationDetail] TO [cdp_Developer], [cdp_UI], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the ConversationDetail table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJConversationDetail]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJConversationDetail];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJConversationDetail
ON [${flyway:defaultSchema}].[ConversationDetail]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ConversationDetail]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[ConversationDetail] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Conversation Details */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJConversationDetail] TO [cdp_Developer], [cdp_UI], [cdp_Integration]



/* spDelete SQL for MJ: Conversations */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Conversations
-- Item: spDeleteMJConversation
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR Conversation
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJConversation]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJConversation];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJConversation]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    -- Cascade update on AIAgentExample using cursor to call spUpdateMJAIAgentExample
    DECLARE @false_SourceConversationIDID uniqueidentifier
    DECLARE @false_SourceConversationID_AgentID uniqueidentifier
    DECLARE @false_SourceConversationID_UserID uniqueidentifier
    DECLARE @false_SourceConversationID_CompanyID uniqueidentifier
    DECLARE @false_SourceConversationID_Type nvarchar(20)
    DECLARE @false_SourceConversationID_ExampleInput nvarchar(MAX)
    DECLARE @false_SourceConversationID_ExampleOutput nvarchar(MAX)
    DECLARE @false_SourceConversationID_IsAutoGenerated bit
    DECLARE @false_SourceConversationID_SourceConversationID uniqueidentifier
    DECLARE @false_SourceConversationID_SourceConversationDetailID uniqueidentifier
    DECLARE @false_SourceConversationID_SourceAIAgentRunID uniqueidentifier
    DECLARE @false_SourceConversationID_SuccessScore decimal(5, 2)
    DECLARE @false_SourceConversationID_Comments nvarchar(MAX)
    DECLARE @false_SourceConversationID_Status nvarchar(20)
    DECLARE @false_SourceConversationID_EmbeddingVector nvarchar(MAX)
    DECLARE @false_SourceConversationID_EmbeddingModelID uniqueidentifier
    DECLARE @false_SourceConversationID_PrimaryScopeEntityID uniqueidentifier
    DECLARE @false_SourceConversationID_PrimaryScopeRecordID nvarchar(100)
    DECLARE @false_SourceConversationID_SecondaryScopes nvarchar(MAX)
    DECLARE @false_SourceConversationID_LastAccessedAt datetimeoffset
    DECLARE @false_SourceConversationID_AccessCount int
    DECLARE @false_SourceConversationID_ExpiresAt datetimeoffset
    DECLARE cascade_update_false_SourceConversationID_cursor CURSOR FOR
        SELECT [ID], [AgentID], [UserID], [CompanyID], [Type], [ExampleInput], [ExampleOutput], [IsAutoGenerated], [SourceConversationID], [SourceConversationDetailID], [SourceAIAgentRunID], [SuccessScore], [Comments], [Status], [EmbeddingVector], [EmbeddingModelID], [PrimaryScopeEntityID], [PrimaryScopeRecordID], [SecondaryScopes], [LastAccessedAt], [AccessCount], [ExpiresAt]
        FROM [${flyway:defaultSchema}].[AIAgentExample]
        WHERE [SourceConversationID] = @ID

    OPEN cascade_update_false_SourceConversationID_cursor
    FETCH NEXT FROM cascade_update_false_SourceConversationID_cursor INTO @false_SourceConversationIDID, @false_SourceConversationID_AgentID, @false_SourceConversationID_UserID, @false_SourceConversationID_CompanyID, @false_SourceConversationID_Type, @false_SourceConversationID_ExampleInput, @false_SourceConversationID_ExampleOutput, @false_SourceConversationID_IsAutoGenerated, @false_SourceConversationID_SourceConversationID, @false_SourceConversationID_SourceConversationDetailID, @false_SourceConversationID_SourceAIAgentRunID, @false_SourceConversationID_SuccessScore, @false_SourceConversationID_Comments, @false_SourceConversationID_Status, @false_SourceConversationID_EmbeddingVector, @false_SourceConversationID_EmbeddingModelID, @false_SourceConversationID_PrimaryScopeEntityID, @false_SourceConversationID_PrimaryScopeRecordID, @false_SourceConversationID_SecondaryScopes, @false_SourceConversationID_LastAccessedAt, @false_SourceConversationID_AccessCount, @false_SourceConversationID_ExpiresAt

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @false_SourceConversationID_SourceConversationID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateMJAIAgentExample] @ID = @false_SourceConversationIDID, @AgentID = @false_SourceConversationID_AgentID, @UserID = @false_SourceConversationID_UserID, @CompanyID = @false_SourceConversationID_CompanyID, @Type = @false_SourceConversationID_Type, @ExampleInput = @false_SourceConversationID_ExampleInput, @ExampleOutput = @false_SourceConversationID_ExampleOutput, @IsAutoGenerated = @false_SourceConversationID_IsAutoGenerated, @SourceConversationID = @false_SourceConversationID_SourceConversationID, @SourceConversationDetailID = @false_SourceConversationID_SourceConversationDetailID, @SourceAIAgentRunID = @false_SourceConversationID_SourceAIAgentRunID, @SuccessScore = @false_SourceConversationID_SuccessScore, @Comments = @false_SourceConversationID_Comments, @Status = @false_SourceConversationID_Status, @EmbeddingVector = @false_SourceConversationID_EmbeddingVector, @EmbeddingModelID = @false_SourceConversationID_EmbeddingModelID, @PrimaryScopeEntityID = @false_SourceConversationID_PrimaryScopeEntityID, @PrimaryScopeRecordID = @false_SourceConversationID_PrimaryScopeRecordID, @SecondaryScopes = @false_SourceConversationID_SecondaryScopes, @LastAccessedAt = @false_SourceConversationID_LastAccessedAt, @AccessCount = @false_SourceConversationID_AccessCount, @ExpiresAt = @false_SourceConversationID_ExpiresAt

        FETCH NEXT FROM cascade_update_false_SourceConversationID_cursor INTO @false_SourceConversationIDID, @false_SourceConversationID_AgentID, @false_SourceConversationID_UserID, @false_SourceConversationID_CompanyID, @false_SourceConversationID_Type, @false_SourceConversationID_ExampleInput, @false_SourceConversationID_ExampleOutput, @false_SourceConversationID_IsAutoGenerated, @false_SourceConversationID_SourceConversationID, @false_SourceConversationID_SourceConversationDetailID, @false_SourceConversationID_SourceAIAgentRunID, @false_SourceConversationID_SuccessScore, @false_SourceConversationID_Comments, @false_SourceConversationID_Status, @false_SourceConversationID_EmbeddingVector, @false_SourceConversationID_EmbeddingModelID, @false_SourceConversationID_PrimaryScopeEntityID, @false_SourceConversationID_PrimaryScopeRecordID, @false_SourceConversationID_SecondaryScopes, @false_SourceConversationID_LastAccessedAt, @false_SourceConversationID_AccessCount, @false_SourceConversationID_ExpiresAt
    END

    CLOSE cascade_update_false_SourceConversationID_cursor
    DEALLOCATE cascade_update_false_SourceConversationID_cursor
    
    -- Cascade update on AIAgentNote using cursor to call spUpdateMJAIAgentNote
    DECLARE @false_SourceConversationIDID uniqueidentifier
    DECLARE @false_SourceConversationID_AgentID uniqueidentifier
    DECLARE @false_SourceConversationID_AgentNoteTypeID uniqueidentifier
    DECLARE @false_SourceConversationID_Note nvarchar(MAX)
    DECLARE @false_SourceConversationID_UserID uniqueidentifier
    DECLARE @false_SourceConversationID_Type nvarchar(20)
    DECLARE @false_SourceConversationID_IsAutoGenerated bit
    DECLARE @false_SourceConversationID_Comments nvarchar(MAX)
    DECLARE @false_SourceConversationID_Status nvarchar(20)
    DECLARE @false_SourceConversationID_SourceConversationID uniqueidentifier
    DECLARE @false_SourceConversationID_SourceConversationDetailID uniqueidentifier
    DECLARE @false_SourceConversationID_SourceAIAgentRunID uniqueidentifier
    DECLARE @false_SourceConversationID_CompanyID uniqueidentifier
    DECLARE @false_SourceConversationID_EmbeddingVector nvarchar(MAX)
    DECLARE @false_SourceConversationID_EmbeddingModelID uniqueidentifier
    DECLARE @false_SourceConversationID_PrimaryScopeEntityID uniqueidentifier
    DECLARE @false_SourceConversationID_PrimaryScopeRecordID nvarchar(100)
    DECLARE @false_SourceConversationID_SecondaryScopes nvarchar(MAX)
    DECLARE @false_SourceConversationID_LastAccessedAt datetimeoffset
    DECLARE @false_SourceConversationID_AccessCount int
    DECLARE @false_SourceConversationID_ExpiresAt datetimeoffset
    DECLARE cascade_update_false_SourceConversationID_cursor CURSOR FOR
        SELECT [ID], [AgentID], [AgentNoteTypeID], [Note], [UserID], [Type], [IsAutoGenerated], [Comments], [Status], [SourceConversationID], [SourceConversationDetailID], [SourceAIAgentRunID], [CompanyID], [EmbeddingVector], [EmbeddingModelID], [PrimaryScopeEntityID], [PrimaryScopeRecordID], [SecondaryScopes], [LastAccessedAt], [AccessCount], [ExpiresAt]
        FROM [${flyway:defaultSchema}].[AIAgentNote]
        WHERE [SourceConversationID] = @ID

    OPEN cascade_update_false_SourceConversationID_cursor
    FETCH NEXT FROM cascade_update_false_SourceConversationID_cursor INTO @false_SourceConversationIDID, @false_SourceConversationID_AgentID, @false_SourceConversationID_AgentNoteTypeID, @false_SourceConversationID_Note, @false_SourceConversationID_UserID, @false_SourceConversationID_Type, @false_SourceConversationID_IsAutoGenerated, @false_SourceConversationID_Comments, @false_SourceConversationID_Status, @false_SourceConversationID_SourceConversationID, @false_SourceConversationID_SourceConversationDetailID, @false_SourceConversationID_SourceAIAgentRunID, @false_SourceConversationID_CompanyID, @false_SourceConversationID_EmbeddingVector, @false_SourceConversationID_EmbeddingModelID, @false_SourceConversationID_PrimaryScopeEntityID, @false_SourceConversationID_PrimaryScopeRecordID, @false_SourceConversationID_SecondaryScopes, @false_SourceConversationID_LastAccessedAt, @false_SourceConversationID_AccessCount, @false_SourceConversationID_ExpiresAt

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @false_SourceConversationID_SourceConversationID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateMJAIAgentNote] @ID = @false_SourceConversationIDID, @AgentID = @false_SourceConversationID_AgentID, @AgentNoteTypeID = @false_SourceConversationID_AgentNoteTypeID, @Note = @false_SourceConversationID_Note, @UserID = @false_SourceConversationID_UserID, @Type = @false_SourceConversationID_Type, @IsAutoGenerated = @false_SourceConversationID_IsAutoGenerated, @Comments = @false_SourceConversationID_Comments, @Status = @false_SourceConversationID_Status, @SourceConversationID = @false_SourceConversationID_SourceConversationID, @SourceConversationDetailID = @false_SourceConversationID_SourceConversationDetailID, @SourceAIAgentRunID = @false_SourceConversationID_SourceAIAgentRunID, @CompanyID = @false_SourceConversationID_CompanyID, @EmbeddingVector = @false_SourceConversationID_EmbeddingVector, @EmbeddingModelID = @false_SourceConversationID_EmbeddingModelID, @PrimaryScopeEntityID = @false_SourceConversationID_PrimaryScopeEntityID, @PrimaryScopeRecordID = @false_SourceConversationID_PrimaryScopeRecordID, @SecondaryScopes = @false_SourceConversationID_SecondaryScopes, @LastAccessedAt = @false_SourceConversationID_LastAccessedAt, @AccessCount = @false_SourceConversationID_AccessCount, @ExpiresAt = @false_SourceConversationID_ExpiresAt

        FETCH NEXT FROM cascade_update_false_SourceConversationID_cursor INTO @false_SourceConversationIDID, @false_SourceConversationID_AgentID, @false_SourceConversationID_AgentNoteTypeID, @false_SourceConversationID_Note, @false_SourceConversationID_UserID, @false_SourceConversationID_Type, @false_SourceConversationID_IsAutoGenerated, @false_SourceConversationID_Comments, @false_SourceConversationID_Status, @false_SourceConversationID_SourceConversationID, @false_SourceConversationID_SourceConversationDetailID, @false_SourceConversationID_SourceAIAgentRunID, @false_SourceConversationID_CompanyID, @false_SourceConversationID_EmbeddingVector, @false_SourceConversationID_EmbeddingModelID, @false_SourceConversationID_PrimaryScopeEntityID, @false_SourceConversationID_PrimaryScopeRecordID, @false_SourceConversationID_SecondaryScopes, @false_SourceConversationID_LastAccessedAt, @false_SourceConversationID_AccessCount, @false_SourceConversationID_ExpiresAt
    END

    CLOSE cascade_update_false_SourceConversationID_cursor
    DEALLOCATE cascade_update_false_SourceConversationID_cursor
    
    -- Cascade update on AIAgentRun using cursor to call spUpdateMJAIAgentRun
    DECLARE @false_ConversationIDID uniqueidentifier
    DECLARE @false_ConversationID_AgentID uniqueidentifier
    DECLARE @false_ConversationID_ParentRunID uniqueidentifier
    DECLARE @false_ConversationID_Status nvarchar(50)
    DECLARE @false_ConversationID_StartedAt datetimeoffset
    DECLARE @false_ConversationID_CompletedAt datetimeoffset
    DECLARE @false_ConversationID_Success bit
    DECLARE @false_ConversationID_ErrorMessage nvarchar(MAX)
    DECLARE @false_ConversationID_ConversationID uniqueidentifier
    DECLARE @false_ConversationID_UserID uniqueidentifier
    DECLARE @false_ConversationID_Result nvarchar(MAX)
    DECLARE @false_ConversationID_AgentState nvarchar(MAX)
    DECLARE @false_ConversationID_TotalTokensUsed int
    DECLARE @false_ConversationID_TotalCost decimal(18, 6)
    DECLARE @false_ConversationID_TotalPromptTokensUsed int
    DECLARE @false_ConversationID_TotalCompletionTokensUsed int
    DECLARE @false_ConversationID_TotalTokensUsedRollup int
    DECLARE @false_ConversationID_TotalPromptTokensUsedRollup int
    DECLARE @false_ConversationID_TotalCompletionTokensUsedRollup int
    DECLARE @false_ConversationID_TotalCostRollup decimal(19, 8)
    DECLARE @false_ConversationID_ConversationDetailID uniqueidentifier
    DECLARE @false_ConversationID_ConversationDetailSequence int
    DECLARE @false_ConversationID_CancellationReason nvarchar(30)
    DECLARE @false_ConversationID_FinalStep nvarchar(30)
    DECLARE @false_ConversationID_FinalPayload nvarchar(MAX)
    DECLARE @false_ConversationID_Message nvarchar(MAX)
    DECLARE @false_ConversationID_LastRunID uniqueidentifier
    DECLARE @false_ConversationID_StartingPayload nvarchar(MAX)
    DECLARE @false_ConversationID_TotalPromptIterations int
    DECLARE @false_ConversationID_ConfigurationID uniqueidentifier
    DECLARE @false_ConversationID_OverrideModelID uniqueidentifier
    DECLARE @false_ConversationID_OverrideVendorID uniqueidentifier
    DECLARE @false_ConversationID_Data nvarchar(MAX)
    DECLARE @false_ConversationID_Verbose bit
    DECLARE @false_ConversationID_EffortLevel int
    DECLARE @false_ConversationID_RunName nvarchar(255)
    DECLARE @false_ConversationID_Comments nvarchar(MAX)
    DECLARE @false_ConversationID_ScheduledJobRunID uniqueidentifier
    DECLARE @false_ConversationID_TestRunID uniqueidentifier
    DECLARE @false_ConversationID_PrimaryScopeEntityID uniqueidentifier
    DECLARE @false_ConversationID_PrimaryScopeRecordID nvarchar(100)
    DECLARE @false_ConversationID_SecondaryScopes nvarchar(MAX)
    DECLARE cascade_update_false_ConversationID_cursor CURSOR FOR
        SELECT [ID], [AgentID], [ParentRunID], [Status], [StartedAt], [CompletedAt], [Success], [ErrorMessage], [ConversationID], [UserID], [Result], [AgentState], [TotalTokensUsed], [TotalCost], [TotalPromptTokensUsed], [TotalCompletionTokensUsed], [TotalTokensUsedRollup], [TotalPromptTokensUsedRollup], [TotalCompletionTokensUsedRollup], [TotalCostRollup], [ConversationDetailID], [ConversationDetailSequence], [CancellationReason], [FinalStep], [FinalPayload], [Message], [LastRunID], [StartingPayload], [TotalPromptIterations], [ConfigurationID], [OverrideModelID], [OverrideVendorID], [Data], [Verbose], [EffortLevel], [RunName], [Comments], [ScheduledJobRunID], [TestRunID], [PrimaryScopeEntityID], [PrimaryScopeRecordID], [SecondaryScopes]
        FROM [${flyway:defaultSchema}].[AIAgentRun]
        WHERE [ConversationID] = @ID

    OPEN cascade_update_false_ConversationID_cursor
    FETCH NEXT FROM cascade_update_false_ConversationID_cursor INTO @false_ConversationIDID, @false_ConversationID_AgentID, @false_ConversationID_ParentRunID, @false_ConversationID_Status, @false_ConversationID_StartedAt, @false_ConversationID_CompletedAt, @false_ConversationID_Success, @false_ConversationID_ErrorMessage, @false_ConversationID_ConversationID, @false_ConversationID_UserID, @false_ConversationID_Result, @false_ConversationID_AgentState, @false_ConversationID_TotalTokensUsed, @false_ConversationID_TotalCost, @false_ConversationID_TotalPromptTokensUsed, @false_ConversationID_TotalCompletionTokensUsed, @false_ConversationID_TotalTokensUsedRollup, @false_ConversationID_TotalPromptTokensUsedRollup, @false_ConversationID_TotalCompletionTokensUsedRollup, @false_ConversationID_TotalCostRollup, @false_ConversationID_ConversationDetailID, @false_ConversationID_ConversationDetailSequence, @false_ConversationID_CancellationReason, @false_ConversationID_FinalStep, @false_ConversationID_FinalPayload, @false_ConversationID_Message, @false_ConversationID_LastRunID, @false_ConversationID_StartingPayload, @false_ConversationID_TotalPromptIterations, @false_ConversationID_ConfigurationID, @false_ConversationID_OverrideModelID, @false_ConversationID_OverrideVendorID, @false_ConversationID_Data, @false_ConversationID_Verbose, @false_ConversationID_EffortLevel, @false_ConversationID_RunName, @false_ConversationID_Comments, @false_ConversationID_ScheduledJobRunID, @false_ConversationID_TestRunID, @false_ConversationID_PrimaryScopeEntityID, @false_ConversationID_PrimaryScopeRecordID, @false_ConversationID_SecondaryScopes

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @false_ConversationID_ConversationID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateMJAIAgentRun] @ID = @false_ConversationIDID, @AgentID = @false_ConversationID_AgentID, @ParentRunID = @false_ConversationID_ParentRunID, @Status = @false_ConversationID_Status, @StartedAt = @false_ConversationID_StartedAt, @CompletedAt = @false_ConversationID_CompletedAt, @Success = @false_ConversationID_Success, @ErrorMessage = @false_ConversationID_ErrorMessage, @ConversationID = @false_ConversationID_ConversationID, @UserID = @false_ConversationID_UserID, @Result = @false_ConversationID_Result, @AgentState = @false_ConversationID_AgentState, @TotalTokensUsed = @false_ConversationID_TotalTokensUsed, @TotalCost = @false_ConversationID_TotalCost, @TotalPromptTokensUsed = @false_ConversationID_TotalPromptTokensUsed, @TotalCompletionTokensUsed = @false_ConversationID_TotalCompletionTokensUsed, @TotalTokensUsedRollup = @false_ConversationID_TotalTokensUsedRollup, @TotalPromptTokensUsedRollup = @false_ConversationID_TotalPromptTokensUsedRollup, @TotalCompletionTokensUsedRollup = @false_ConversationID_TotalCompletionTokensUsedRollup, @TotalCostRollup = @false_ConversationID_TotalCostRollup, @ConversationDetailID = @false_ConversationID_ConversationDetailID, @ConversationDetailSequence = @false_ConversationID_ConversationDetailSequence, @CancellationReason = @false_ConversationID_CancellationReason, @FinalStep = @false_ConversationID_FinalStep, @FinalPayload = @false_ConversationID_FinalPayload, @Message = @false_ConversationID_Message, @LastRunID = @false_ConversationID_LastRunID, @StartingPayload = @false_ConversationID_StartingPayload, @TotalPromptIterations = @false_ConversationID_TotalPromptIterations, @ConfigurationID = @false_ConversationID_ConfigurationID, @OverrideModelID = @false_ConversationID_OverrideModelID, @OverrideVendorID = @false_ConversationID_OverrideVendorID, @Data = @false_ConversationID_Data, @Verbose = @false_ConversationID_Verbose, @EffortLevel = @false_ConversationID_EffortLevel, @RunName = @false_ConversationID_RunName, @Comments = @false_ConversationID_Comments, @ScheduledJobRunID = @false_ConversationID_ScheduledJobRunID, @TestRunID = @false_ConversationID_TestRunID, @PrimaryScopeEntityID = @false_ConversationID_PrimaryScopeEntityID, @PrimaryScopeRecordID = @false_ConversationID_PrimaryScopeRecordID, @SecondaryScopes = @false_ConversationID_SecondaryScopes

        FETCH NEXT FROM cascade_update_false_ConversationID_cursor INTO @false_ConversationIDID, @false_ConversationID_AgentID, @false_ConversationID_ParentRunID, @false_ConversationID_Status, @false_ConversationID_StartedAt, @false_ConversationID_CompletedAt, @false_ConversationID_Success, @false_ConversationID_ErrorMessage, @false_ConversationID_ConversationID, @false_ConversationID_UserID, @false_ConversationID_Result, @false_ConversationID_AgentState, @false_ConversationID_TotalTokensUsed, @false_ConversationID_TotalCost, @false_ConversationID_TotalPromptTokensUsed, @false_ConversationID_TotalCompletionTokensUsed, @false_ConversationID_TotalTokensUsedRollup, @false_ConversationID_TotalPromptTokensUsedRollup, @false_ConversationID_TotalCompletionTokensUsedRollup, @false_ConversationID_TotalCostRollup, @false_ConversationID_ConversationDetailID, @false_ConversationID_ConversationDetailSequence, @false_ConversationID_CancellationReason, @false_ConversationID_FinalStep, @false_ConversationID_FinalPayload, @false_ConversationID_Message, @false_ConversationID_LastRunID, @false_ConversationID_StartingPayload, @false_ConversationID_TotalPromptIterations, @false_ConversationID_ConfigurationID, @false_ConversationID_OverrideModelID, @false_ConversationID_OverrideVendorID, @false_ConversationID_Data, @false_ConversationID_Verbose, @false_ConversationID_EffortLevel, @false_ConversationID_RunName, @false_ConversationID_Comments, @false_ConversationID_ScheduledJobRunID, @false_ConversationID_TestRunID, @false_ConversationID_PrimaryScopeEntityID, @false_ConversationID_PrimaryScopeRecordID, @false_ConversationID_SecondaryScopes
    END

    CLOSE cascade_update_false_ConversationID_cursor
    DEALLOCATE cascade_update_false_ConversationID_cursor
    
    -- Cascade delete from ConversationArtifact using cursor to call spDeleteMJConversationArtifact
    DECLARE @false_ConversationIDID uniqueidentifier
    DECLARE cascade_delete_false_ConversationID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[ConversationArtifact]
        WHERE [ConversationID] = @ID
    
    OPEN cascade_delete_false_ConversationID_cursor
    FETCH NEXT FROM cascade_delete_false_ConversationID_cursor INTO @false_ConversationIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteMJConversationArtifact] @ID = @false_ConversationIDID
        
        FETCH NEXT FROM cascade_delete_false_ConversationID_cursor INTO @false_ConversationIDID
    END
    
    CLOSE cascade_delete_false_ConversationID_cursor
    DEALLOCATE cascade_delete_false_ConversationID_cursor
    
    -- Cascade delete from ConversationDetail using cursor to call spDeleteMJConversationDetail
    DECLARE @false_ConversationIDID uniqueidentifier
    DECLARE cascade_delete_false_ConversationID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[ConversationDetail]
        WHERE [ConversationID] = @ID
    
    OPEN cascade_delete_false_ConversationID_cursor
    FETCH NEXT FROM cascade_delete_false_ConversationID_cursor INTO @false_ConversationIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteMJConversationDetail] @ID = @false_ConversationIDID
        
        FETCH NEXT FROM cascade_delete_false_ConversationID_cursor INTO @false_ConversationIDID
    END
    
    CLOSE cascade_delete_false_ConversationID_cursor
    DEALLOCATE cascade_delete_false_ConversationID_cursor
    
    -- Cascade update on Report using cursor to call spUpdateMJReport
    DECLARE @false_ConversationIDID uniqueidentifier
    DECLARE @false_ConversationID_Name nvarchar(255)
    DECLARE @false_ConversationID_Description nvarchar(MAX)
    DECLARE @false_ConversationID_CategoryID uniqueidentifier
    DECLARE @false_ConversationID_UserID uniqueidentifier
    DECLARE @false_ConversationID_SharingScope nvarchar(20)
    DECLARE @false_ConversationID_ConversationID uniqueidentifier
    DECLARE @false_ConversationID_ConversationDetailID uniqueidentifier
    DECLARE @false_ConversationID_DataContextID uniqueidentifier
    DECLARE @false_ConversationID_Configuration nvarchar(MAX)
    DECLARE @false_ConversationID_OutputTriggerTypeID uniqueidentifier
    DECLARE @false_ConversationID_OutputFormatTypeID uniqueidentifier
    DECLARE @false_ConversationID_OutputDeliveryTypeID uniqueidentifier
    DECLARE @false_ConversationID_OutputFrequency nvarchar(50)
    DECLARE @false_ConversationID_OutputTargetEmail nvarchar(255)
    DECLARE @false_ConversationID_OutputWorkflowID uniqueidentifier
    DECLARE @false_ConversationID_Thumbnail nvarchar(MAX)
    DECLARE @false_ConversationID_EnvironmentID uniqueidentifier
    DECLARE cascade_update_false_ConversationID_cursor CURSOR FOR
        SELECT [ID], [Name], [Description], [CategoryID], [UserID], [SharingScope], [ConversationID], [ConversationDetailID], [DataContextID], [Configuration], [OutputTriggerTypeID], [OutputFormatTypeID], [OutputDeliveryTypeID], [OutputFrequency], [OutputTargetEmail], [OutputWorkflowID], [Thumbnail], [EnvironmentID]
        FROM [${flyway:defaultSchema}].[Report]
        WHERE [ConversationID] = @ID

    OPEN cascade_update_false_ConversationID_cursor
    FETCH NEXT FROM cascade_update_false_ConversationID_cursor INTO @false_ConversationIDID, @false_ConversationID_Name, @false_ConversationID_Description, @false_ConversationID_CategoryID, @false_ConversationID_UserID, @false_ConversationID_SharingScope, @false_ConversationID_ConversationID, @false_ConversationID_ConversationDetailID, @false_ConversationID_DataContextID, @false_ConversationID_Configuration, @false_ConversationID_OutputTriggerTypeID, @false_ConversationID_OutputFormatTypeID, @false_ConversationID_OutputDeliveryTypeID, @false_ConversationID_OutputFrequency, @false_ConversationID_OutputTargetEmail, @false_ConversationID_OutputWorkflowID, @false_ConversationID_Thumbnail, @false_ConversationID_EnvironmentID

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @false_ConversationID_ConversationID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateMJReport] @ID = @false_ConversationIDID, @Name = @false_ConversationID_Name, @Description = @false_ConversationID_Description, @CategoryID = @false_ConversationID_CategoryID, @UserID = @false_ConversationID_UserID, @SharingScope = @false_ConversationID_SharingScope, @ConversationID = @false_ConversationID_ConversationID, @ConversationDetailID = @false_ConversationID_ConversationDetailID, @DataContextID = @false_ConversationID_DataContextID, @Configuration = @false_ConversationID_Configuration, @OutputTriggerTypeID = @false_ConversationID_OutputTriggerTypeID, @OutputFormatTypeID = @false_ConversationID_OutputFormatTypeID, @OutputDeliveryTypeID = @false_ConversationID_OutputDeliveryTypeID, @OutputFrequency = @false_ConversationID_OutputFrequency, @OutputTargetEmail = @false_ConversationID_OutputTargetEmail, @OutputWorkflowID = @false_ConversationID_OutputWorkflowID, @Thumbnail = @false_ConversationID_Thumbnail, @EnvironmentID = @false_ConversationID_EnvironmentID

        FETCH NEXT FROM cascade_update_false_ConversationID_cursor INTO @false_ConversationIDID, @false_ConversationID_Name, @false_ConversationID_Description, @false_ConversationID_CategoryID, @false_ConversationID_UserID, @false_ConversationID_SharingScope, @false_ConversationID_ConversationID, @false_ConversationID_ConversationDetailID, @false_ConversationID_DataContextID, @false_ConversationID_Configuration, @false_ConversationID_OutputTriggerTypeID, @false_ConversationID_OutputFormatTypeID, @false_ConversationID_OutputDeliveryTypeID, @false_ConversationID_OutputFrequency, @false_ConversationID_OutputTargetEmail, @false_ConversationID_OutputWorkflowID, @false_ConversationID_Thumbnail, @false_ConversationID_EnvironmentID
    END

    CLOSE cascade_update_false_ConversationID_cursor
    DEALLOCATE cascade_update_false_ConversationID_cursor
    

    DELETE FROM
        [${flyway:defaultSchema}].[Conversation]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJConversation] TO [cdp_Developer], [cdp_UI], [cdp_Integration]
    

/* spDelete Permissions for MJ: Conversations */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJConversation] TO [cdp_Developer], [cdp_UI], [cdp_Integration]



/* spDelete SQL for MJ: Conversation Details */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Conversation Details
-- Item: spDeleteMJConversationDetail
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR ConversationDetail
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJConversationDetail]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJConversationDetail];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJConversationDetail]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    -- Cascade update on AIAgentExample using cursor to call spUpdateMJAIAgentExample
    DECLARE @false_SourceConversationDetailIDID uniqueidentifier
    DECLARE @false_SourceConversationDetailID_AgentID uniqueidentifier
    DECLARE @false_SourceConversationDetailID_UserID uniqueidentifier
    DECLARE @false_SourceConversationDetailID_CompanyID uniqueidentifier
    DECLARE @false_SourceConversationDetailID_Type nvarchar(20)
    DECLARE @false_SourceConversationDetailID_ExampleInput nvarchar(MAX)
    DECLARE @false_SourceConversationDetailID_ExampleOutput nvarchar(MAX)
    DECLARE @false_SourceConversationDetailID_IsAutoGenerated bit
    DECLARE @false_SourceConversationDetailID_SourceConversationID uniqueidentifier
    DECLARE @false_SourceConversationDetailID_SourceConversationDetailID uniqueidentifier
    DECLARE @false_SourceConversationDetailID_SourceAIAgentRunID uniqueidentifier
    DECLARE @false_SourceConversationDetailID_SuccessScore decimal(5, 2)
    DECLARE @false_SourceConversationDetailID_Comments nvarchar(MAX)
    DECLARE @false_SourceConversationDetailID_Status nvarchar(20)
    DECLARE @false_SourceConversationDetailID_EmbeddingVector nvarchar(MAX)
    DECLARE @false_SourceConversationDetailID_EmbeddingModelID uniqueidentifier
    DECLARE @false_SourceConversationDetailID_PrimaryScopeEntityID uniqueidentifier
    DECLARE @false_SourceConversationDetailID_PrimaryScopeRecordID nvarchar(100)
    DECLARE @false_SourceConversationDetailID_SecondaryScopes nvarchar(MAX)
    DECLARE @false_SourceConversationDetailID_LastAccessedAt datetimeoffset
    DECLARE @false_SourceConversationDetailID_AccessCount int
    DECLARE @false_SourceConversationDetailID_ExpiresAt datetimeoffset
    DECLARE cascade_update_false_SourceConversationDetailID_cursor CURSOR FOR
        SELECT [ID], [AgentID], [UserID], [CompanyID], [Type], [ExampleInput], [ExampleOutput], [IsAutoGenerated], [SourceConversationID], [SourceConversationDetailID], [SourceAIAgentRunID], [SuccessScore], [Comments], [Status], [EmbeddingVector], [EmbeddingModelID], [PrimaryScopeEntityID], [PrimaryScopeRecordID], [SecondaryScopes], [LastAccessedAt], [AccessCount], [ExpiresAt]
        FROM [${flyway:defaultSchema}].[AIAgentExample]
        WHERE [SourceConversationDetailID] = @ID

    OPEN cascade_update_false_SourceConversationDetailID_cursor
    FETCH NEXT FROM cascade_update_false_SourceConversationDetailID_cursor INTO @false_SourceConversationDetailIDID, @false_SourceConversationDetailID_AgentID, @false_SourceConversationDetailID_UserID, @false_SourceConversationDetailID_CompanyID, @false_SourceConversationDetailID_Type, @false_SourceConversationDetailID_ExampleInput, @false_SourceConversationDetailID_ExampleOutput, @false_SourceConversationDetailID_IsAutoGenerated, @false_SourceConversationDetailID_SourceConversationID, @false_SourceConversationDetailID_SourceConversationDetailID, @false_SourceConversationDetailID_SourceAIAgentRunID, @false_SourceConversationDetailID_SuccessScore, @false_SourceConversationDetailID_Comments, @false_SourceConversationDetailID_Status, @false_SourceConversationDetailID_EmbeddingVector, @false_SourceConversationDetailID_EmbeddingModelID, @false_SourceConversationDetailID_PrimaryScopeEntityID, @false_SourceConversationDetailID_PrimaryScopeRecordID, @false_SourceConversationDetailID_SecondaryScopes, @false_SourceConversationDetailID_LastAccessedAt, @false_SourceConversationDetailID_AccessCount, @false_SourceConversationDetailID_ExpiresAt

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @false_SourceConversationDetailID_SourceConversationDetailID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateMJAIAgentExample] @ID = @false_SourceConversationDetailIDID, @AgentID = @false_SourceConversationDetailID_AgentID, @UserID = @false_SourceConversationDetailID_UserID, @CompanyID = @false_SourceConversationDetailID_CompanyID, @Type = @false_SourceConversationDetailID_Type, @ExampleInput = @false_SourceConversationDetailID_ExampleInput, @ExampleOutput = @false_SourceConversationDetailID_ExampleOutput, @IsAutoGenerated = @false_SourceConversationDetailID_IsAutoGenerated, @SourceConversationID = @false_SourceConversationDetailID_SourceConversationID, @SourceConversationDetailID = @false_SourceConversationDetailID_SourceConversationDetailID, @SourceAIAgentRunID = @false_SourceConversationDetailID_SourceAIAgentRunID, @SuccessScore = @false_SourceConversationDetailID_SuccessScore, @Comments = @false_SourceConversationDetailID_Comments, @Status = @false_SourceConversationDetailID_Status, @EmbeddingVector = @false_SourceConversationDetailID_EmbeddingVector, @EmbeddingModelID = @false_SourceConversationDetailID_EmbeddingModelID, @PrimaryScopeEntityID = @false_SourceConversationDetailID_PrimaryScopeEntityID, @PrimaryScopeRecordID = @false_SourceConversationDetailID_PrimaryScopeRecordID, @SecondaryScopes = @false_SourceConversationDetailID_SecondaryScopes, @LastAccessedAt = @false_SourceConversationDetailID_LastAccessedAt, @AccessCount = @false_SourceConversationDetailID_AccessCount, @ExpiresAt = @false_SourceConversationDetailID_ExpiresAt

        FETCH NEXT FROM cascade_update_false_SourceConversationDetailID_cursor INTO @false_SourceConversationDetailIDID, @false_SourceConversationDetailID_AgentID, @false_SourceConversationDetailID_UserID, @false_SourceConversationDetailID_CompanyID, @false_SourceConversationDetailID_Type, @false_SourceConversationDetailID_ExampleInput, @false_SourceConversationDetailID_ExampleOutput, @false_SourceConversationDetailID_IsAutoGenerated, @false_SourceConversationDetailID_SourceConversationID, @false_SourceConversationDetailID_SourceConversationDetailID, @false_SourceConversationDetailID_SourceAIAgentRunID, @false_SourceConversationDetailID_SuccessScore, @false_SourceConversationDetailID_Comments, @false_SourceConversationDetailID_Status, @false_SourceConversationDetailID_EmbeddingVector, @false_SourceConversationDetailID_EmbeddingModelID, @false_SourceConversationDetailID_PrimaryScopeEntityID, @false_SourceConversationDetailID_PrimaryScopeRecordID, @false_SourceConversationDetailID_SecondaryScopes, @false_SourceConversationDetailID_LastAccessedAt, @false_SourceConversationDetailID_AccessCount, @false_SourceConversationDetailID_ExpiresAt
    END

    CLOSE cascade_update_false_SourceConversationDetailID_cursor
    DEALLOCATE cascade_update_false_SourceConversationDetailID_cursor
    
    -- Cascade update on AIAgentNote using cursor to call spUpdateMJAIAgentNote
    DECLARE @false_SourceConversationDetailIDID uniqueidentifier
    DECLARE @false_SourceConversationDetailID_AgentID uniqueidentifier
    DECLARE @false_SourceConversationDetailID_AgentNoteTypeID uniqueidentifier
    DECLARE @false_SourceConversationDetailID_Note nvarchar(MAX)
    DECLARE @false_SourceConversationDetailID_UserID uniqueidentifier
    DECLARE @false_SourceConversationDetailID_Type nvarchar(20)
    DECLARE @false_SourceConversationDetailID_IsAutoGenerated bit
    DECLARE @false_SourceConversationDetailID_Comments nvarchar(MAX)
    DECLARE @false_SourceConversationDetailID_Status nvarchar(20)
    DECLARE @false_SourceConversationDetailID_SourceConversationID uniqueidentifier
    DECLARE @false_SourceConversationDetailID_SourceConversationDetailID uniqueidentifier
    DECLARE @false_SourceConversationDetailID_SourceAIAgentRunID uniqueidentifier
    DECLARE @false_SourceConversationDetailID_CompanyID uniqueidentifier
    DECLARE @false_SourceConversationDetailID_EmbeddingVector nvarchar(MAX)
    DECLARE @false_SourceConversationDetailID_EmbeddingModelID uniqueidentifier
    DECLARE @false_SourceConversationDetailID_PrimaryScopeEntityID uniqueidentifier
    DECLARE @false_SourceConversationDetailID_PrimaryScopeRecordID nvarchar(100)
    DECLARE @false_SourceConversationDetailID_SecondaryScopes nvarchar(MAX)
    DECLARE @false_SourceConversationDetailID_LastAccessedAt datetimeoffset
    DECLARE @false_SourceConversationDetailID_AccessCount int
    DECLARE @false_SourceConversationDetailID_ExpiresAt datetimeoffset
    DECLARE cascade_update_false_SourceConversationDetailID_cursor CURSOR FOR
        SELECT [ID], [AgentID], [AgentNoteTypeID], [Note], [UserID], [Type], [IsAutoGenerated], [Comments], [Status], [SourceConversationID], [SourceConversationDetailID], [SourceAIAgentRunID], [CompanyID], [EmbeddingVector], [EmbeddingModelID], [PrimaryScopeEntityID], [PrimaryScopeRecordID], [SecondaryScopes], [LastAccessedAt], [AccessCount], [ExpiresAt]
        FROM [${flyway:defaultSchema}].[AIAgentNote]
        WHERE [SourceConversationDetailID] = @ID

    OPEN cascade_update_false_SourceConversationDetailID_cursor
    FETCH NEXT FROM cascade_update_false_SourceConversationDetailID_cursor INTO @false_SourceConversationDetailIDID, @false_SourceConversationDetailID_AgentID, @false_SourceConversationDetailID_AgentNoteTypeID, @false_SourceConversationDetailID_Note, @false_SourceConversationDetailID_UserID, @false_SourceConversationDetailID_Type, @false_SourceConversationDetailID_IsAutoGenerated, @false_SourceConversationDetailID_Comments, @false_SourceConversationDetailID_Status, @false_SourceConversationDetailID_SourceConversationID, @false_SourceConversationDetailID_SourceConversationDetailID, @false_SourceConversationDetailID_SourceAIAgentRunID, @false_SourceConversationDetailID_CompanyID, @false_SourceConversationDetailID_EmbeddingVector, @false_SourceConversationDetailID_EmbeddingModelID, @false_SourceConversationDetailID_PrimaryScopeEntityID, @false_SourceConversationDetailID_PrimaryScopeRecordID, @false_SourceConversationDetailID_SecondaryScopes, @false_SourceConversationDetailID_LastAccessedAt, @false_SourceConversationDetailID_AccessCount, @false_SourceConversationDetailID_ExpiresAt

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @false_SourceConversationDetailID_SourceConversationDetailID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateMJAIAgentNote] @ID = @false_SourceConversationDetailIDID, @AgentID = @false_SourceConversationDetailID_AgentID, @AgentNoteTypeID = @false_SourceConversationDetailID_AgentNoteTypeID, @Note = @false_SourceConversationDetailID_Note, @UserID = @false_SourceConversationDetailID_UserID, @Type = @false_SourceConversationDetailID_Type, @IsAutoGenerated = @false_SourceConversationDetailID_IsAutoGenerated, @Comments = @false_SourceConversationDetailID_Comments, @Status = @false_SourceConversationDetailID_Status, @SourceConversationID = @false_SourceConversationDetailID_SourceConversationID, @SourceConversationDetailID = @false_SourceConversationDetailID_SourceConversationDetailID, @SourceAIAgentRunID = @false_SourceConversationDetailID_SourceAIAgentRunID, @CompanyID = @false_SourceConversationDetailID_CompanyID, @EmbeddingVector = @false_SourceConversationDetailID_EmbeddingVector, @EmbeddingModelID = @false_SourceConversationDetailID_EmbeddingModelID, @PrimaryScopeEntityID = @false_SourceConversationDetailID_PrimaryScopeEntityID, @PrimaryScopeRecordID = @false_SourceConversationDetailID_PrimaryScopeRecordID, @SecondaryScopes = @false_SourceConversationDetailID_SecondaryScopes, @LastAccessedAt = @false_SourceConversationDetailID_LastAccessedAt, @AccessCount = @false_SourceConversationDetailID_AccessCount, @ExpiresAt = @false_SourceConversationDetailID_ExpiresAt

        FETCH NEXT FROM cascade_update_false_SourceConversationDetailID_cursor INTO @false_SourceConversationDetailIDID, @false_SourceConversationDetailID_AgentID, @false_SourceConversationDetailID_AgentNoteTypeID, @false_SourceConversationDetailID_Note, @false_SourceConversationDetailID_UserID, @false_SourceConversationDetailID_Type, @false_SourceConversationDetailID_IsAutoGenerated, @false_SourceConversationDetailID_Comments, @false_SourceConversationDetailID_Status, @false_SourceConversationDetailID_SourceConversationID, @false_SourceConversationDetailID_SourceConversationDetailID, @false_SourceConversationDetailID_SourceAIAgentRunID, @false_SourceConversationDetailID_CompanyID, @false_SourceConversationDetailID_EmbeddingVector, @false_SourceConversationDetailID_EmbeddingModelID, @false_SourceConversationDetailID_PrimaryScopeEntityID, @false_SourceConversationDetailID_PrimaryScopeRecordID, @false_SourceConversationDetailID_SecondaryScopes, @false_SourceConversationDetailID_LastAccessedAt, @false_SourceConversationDetailID_AccessCount, @false_SourceConversationDetailID_ExpiresAt
    END

    CLOSE cascade_update_false_SourceConversationDetailID_cursor
    DEALLOCATE cascade_update_false_SourceConversationDetailID_cursor
    
    -- Cascade update on AIAgentRun using cursor to call spUpdateMJAIAgentRun
    DECLARE @false_ConversationDetailIDID uniqueidentifier
    DECLARE @false_ConversationDetailID_AgentID uniqueidentifier
    DECLARE @false_ConversationDetailID_ParentRunID uniqueidentifier
    DECLARE @false_ConversationDetailID_Status nvarchar(50)
    DECLARE @false_ConversationDetailID_StartedAt datetimeoffset
    DECLARE @false_ConversationDetailID_CompletedAt datetimeoffset
    DECLARE @false_ConversationDetailID_Success bit
    DECLARE @false_ConversationDetailID_ErrorMessage nvarchar(MAX)
    DECLARE @false_ConversationDetailID_ConversationID uniqueidentifier
    DECLARE @false_ConversationDetailID_UserID uniqueidentifier
    DECLARE @false_ConversationDetailID_Result nvarchar(MAX)
    DECLARE @false_ConversationDetailID_AgentState nvarchar(MAX)
    DECLARE @false_ConversationDetailID_TotalTokensUsed int
    DECLARE @false_ConversationDetailID_TotalCost decimal(18, 6)
    DECLARE @false_ConversationDetailID_TotalPromptTokensUsed int
    DECLARE @false_ConversationDetailID_TotalCompletionTokensUsed int
    DECLARE @false_ConversationDetailID_TotalTokensUsedRollup int
    DECLARE @false_ConversationDetailID_TotalPromptTokensUsedRollup int
    DECLARE @false_ConversationDetailID_TotalCompletionTokensUsedRollup int
    DECLARE @false_ConversationDetailID_TotalCostRollup decimal(19, 8)
    DECLARE @false_ConversationDetailID_ConversationDetailID uniqueidentifier
    DECLARE @false_ConversationDetailID_ConversationDetailSequence int
    DECLARE @false_ConversationDetailID_CancellationReason nvarchar(30)
    DECLARE @false_ConversationDetailID_FinalStep nvarchar(30)
    DECLARE @false_ConversationDetailID_FinalPayload nvarchar(MAX)
    DECLARE @false_ConversationDetailID_Message nvarchar(MAX)
    DECLARE @false_ConversationDetailID_LastRunID uniqueidentifier
    DECLARE @false_ConversationDetailID_StartingPayload nvarchar(MAX)
    DECLARE @false_ConversationDetailID_TotalPromptIterations int
    DECLARE @false_ConversationDetailID_ConfigurationID uniqueidentifier
    DECLARE @false_ConversationDetailID_OverrideModelID uniqueidentifier
    DECLARE @false_ConversationDetailID_OverrideVendorID uniqueidentifier
    DECLARE @false_ConversationDetailID_Data nvarchar(MAX)
    DECLARE @false_ConversationDetailID_Verbose bit
    DECLARE @false_ConversationDetailID_EffortLevel int
    DECLARE @false_ConversationDetailID_RunName nvarchar(255)
    DECLARE @false_ConversationDetailID_Comments nvarchar(MAX)
    DECLARE @false_ConversationDetailID_ScheduledJobRunID uniqueidentifier
    DECLARE @false_ConversationDetailID_TestRunID uniqueidentifier
    DECLARE @false_ConversationDetailID_PrimaryScopeEntityID uniqueidentifier
    DECLARE @false_ConversationDetailID_PrimaryScopeRecordID nvarchar(100)
    DECLARE @false_ConversationDetailID_SecondaryScopes nvarchar(MAX)
    DECLARE cascade_update_false_ConversationDetailID_cursor CURSOR FOR
        SELECT [ID], [AgentID], [ParentRunID], [Status], [StartedAt], [CompletedAt], [Success], [ErrorMessage], [ConversationID], [UserID], [Result], [AgentState], [TotalTokensUsed], [TotalCost], [TotalPromptTokensUsed], [TotalCompletionTokensUsed], [TotalTokensUsedRollup], [TotalPromptTokensUsedRollup], [TotalCompletionTokensUsedRollup], [TotalCostRollup], [ConversationDetailID], [ConversationDetailSequence], [CancellationReason], [FinalStep], [FinalPayload], [Message], [LastRunID], [StartingPayload], [TotalPromptIterations], [ConfigurationID], [OverrideModelID], [OverrideVendorID], [Data], [Verbose], [EffortLevel], [RunName], [Comments], [ScheduledJobRunID], [TestRunID], [PrimaryScopeEntityID], [PrimaryScopeRecordID], [SecondaryScopes]
        FROM [${flyway:defaultSchema}].[AIAgentRun]
        WHERE [ConversationDetailID] = @ID

    OPEN cascade_update_false_ConversationDetailID_cursor
    FETCH NEXT FROM cascade_update_false_ConversationDetailID_cursor INTO @false_ConversationDetailIDID, @false_ConversationDetailID_AgentID, @false_ConversationDetailID_ParentRunID, @false_ConversationDetailID_Status, @false_ConversationDetailID_StartedAt, @false_ConversationDetailID_CompletedAt, @false_ConversationDetailID_Success, @false_ConversationDetailID_ErrorMessage, @false_ConversationDetailID_ConversationID, @false_ConversationDetailID_UserID, @false_ConversationDetailID_Result, @false_ConversationDetailID_AgentState, @false_ConversationDetailID_TotalTokensUsed, @false_ConversationDetailID_TotalCost, @false_ConversationDetailID_TotalPromptTokensUsed, @false_ConversationDetailID_TotalCompletionTokensUsed, @false_ConversationDetailID_TotalTokensUsedRollup, @false_ConversationDetailID_TotalPromptTokensUsedRollup, @false_ConversationDetailID_TotalCompletionTokensUsedRollup, @false_ConversationDetailID_TotalCostRollup, @false_ConversationDetailID_ConversationDetailID, @false_ConversationDetailID_ConversationDetailSequence, @false_ConversationDetailID_CancellationReason, @false_ConversationDetailID_FinalStep, @false_ConversationDetailID_FinalPayload, @false_ConversationDetailID_Message, @false_ConversationDetailID_LastRunID, @false_ConversationDetailID_StartingPayload, @false_ConversationDetailID_TotalPromptIterations, @false_ConversationDetailID_ConfigurationID, @false_ConversationDetailID_OverrideModelID, @false_ConversationDetailID_OverrideVendorID, @false_ConversationDetailID_Data, @false_ConversationDetailID_Verbose, @false_ConversationDetailID_EffortLevel, @false_ConversationDetailID_RunName, @false_ConversationDetailID_Comments, @false_ConversationDetailID_ScheduledJobRunID, @false_ConversationDetailID_TestRunID, @false_ConversationDetailID_PrimaryScopeEntityID, @false_ConversationDetailID_PrimaryScopeRecordID, @false_ConversationDetailID_SecondaryScopes

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @false_ConversationDetailID_ConversationDetailID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateMJAIAgentRun] @ID = @false_ConversationDetailIDID, @AgentID = @false_ConversationDetailID_AgentID, @ParentRunID = @false_ConversationDetailID_ParentRunID, @Status = @false_ConversationDetailID_Status, @StartedAt = @false_ConversationDetailID_StartedAt, @CompletedAt = @false_ConversationDetailID_CompletedAt, @Success = @false_ConversationDetailID_Success, @ErrorMessage = @false_ConversationDetailID_ErrorMessage, @ConversationID = @false_ConversationDetailID_ConversationID, @UserID = @false_ConversationDetailID_UserID, @Result = @false_ConversationDetailID_Result, @AgentState = @false_ConversationDetailID_AgentState, @TotalTokensUsed = @false_ConversationDetailID_TotalTokensUsed, @TotalCost = @false_ConversationDetailID_TotalCost, @TotalPromptTokensUsed = @false_ConversationDetailID_TotalPromptTokensUsed, @TotalCompletionTokensUsed = @false_ConversationDetailID_TotalCompletionTokensUsed, @TotalTokensUsedRollup = @false_ConversationDetailID_TotalTokensUsedRollup, @TotalPromptTokensUsedRollup = @false_ConversationDetailID_TotalPromptTokensUsedRollup, @TotalCompletionTokensUsedRollup = @false_ConversationDetailID_TotalCompletionTokensUsedRollup, @TotalCostRollup = @false_ConversationDetailID_TotalCostRollup, @ConversationDetailID = @false_ConversationDetailID_ConversationDetailID, @ConversationDetailSequence = @false_ConversationDetailID_ConversationDetailSequence, @CancellationReason = @false_ConversationDetailID_CancellationReason, @FinalStep = @false_ConversationDetailID_FinalStep, @FinalPayload = @false_ConversationDetailID_FinalPayload, @Message = @false_ConversationDetailID_Message, @LastRunID = @false_ConversationDetailID_LastRunID, @StartingPayload = @false_ConversationDetailID_StartingPayload, @TotalPromptIterations = @false_ConversationDetailID_TotalPromptIterations, @ConfigurationID = @false_ConversationDetailID_ConfigurationID, @OverrideModelID = @false_ConversationDetailID_OverrideModelID, @OverrideVendorID = @false_ConversationDetailID_OverrideVendorID, @Data = @false_ConversationDetailID_Data, @Verbose = @false_ConversationDetailID_Verbose, @EffortLevel = @false_ConversationDetailID_EffortLevel, @RunName = @false_ConversationDetailID_RunName, @Comments = @false_ConversationDetailID_Comments, @ScheduledJobRunID = @false_ConversationDetailID_ScheduledJobRunID, @TestRunID = @false_ConversationDetailID_TestRunID, @PrimaryScopeEntityID = @false_ConversationDetailID_PrimaryScopeEntityID, @PrimaryScopeRecordID = @false_ConversationDetailID_PrimaryScopeRecordID, @SecondaryScopes = @false_ConversationDetailID_SecondaryScopes

        FETCH NEXT FROM cascade_update_false_ConversationDetailID_cursor INTO @false_ConversationDetailIDID, @false_ConversationDetailID_AgentID, @false_ConversationDetailID_ParentRunID, @false_ConversationDetailID_Status, @false_ConversationDetailID_StartedAt, @false_ConversationDetailID_CompletedAt, @false_ConversationDetailID_Success, @false_ConversationDetailID_ErrorMessage, @false_ConversationDetailID_ConversationID, @false_ConversationDetailID_UserID, @false_ConversationDetailID_Result, @false_ConversationDetailID_AgentState, @false_ConversationDetailID_TotalTokensUsed, @false_ConversationDetailID_TotalCost, @false_ConversationDetailID_TotalPromptTokensUsed, @false_ConversationDetailID_TotalCompletionTokensUsed, @false_ConversationDetailID_TotalTokensUsedRollup, @false_ConversationDetailID_TotalPromptTokensUsedRollup, @false_ConversationDetailID_TotalCompletionTokensUsedRollup, @false_ConversationDetailID_TotalCostRollup, @false_ConversationDetailID_ConversationDetailID, @false_ConversationDetailID_ConversationDetailSequence, @false_ConversationDetailID_CancellationReason, @false_ConversationDetailID_FinalStep, @false_ConversationDetailID_FinalPayload, @false_ConversationDetailID_Message, @false_ConversationDetailID_LastRunID, @false_ConversationDetailID_StartingPayload, @false_ConversationDetailID_TotalPromptIterations, @false_ConversationDetailID_ConfigurationID, @false_ConversationDetailID_OverrideModelID, @false_ConversationDetailID_OverrideVendorID, @false_ConversationDetailID_Data, @false_ConversationDetailID_Verbose, @false_ConversationDetailID_EffortLevel, @false_ConversationDetailID_RunName, @false_ConversationDetailID_Comments, @false_ConversationDetailID_ScheduledJobRunID, @false_ConversationDetailID_TestRunID, @false_ConversationDetailID_PrimaryScopeEntityID, @false_ConversationDetailID_PrimaryScopeRecordID, @false_ConversationDetailID_SecondaryScopes
    END

    CLOSE cascade_update_false_ConversationDetailID_cursor
    DEALLOCATE cascade_update_false_ConversationDetailID_cursor
    
    -- Cascade delete from ConversationDetailArtifact using cursor to call spDeleteMJConversationDetailArtifact
    DECLARE @false_ConversationDetailIDID uniqueidentifier
    DECLARE cascade_delete_false_ConversationDetailID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[ConversationDetailArtifact]
        WHERE [ConversationDetailID] = @ID
    
    OPEN cascade_delete_false_ConversationDetailID_cursor
    FETCH NEXT FROM cascade_delete_false_ConversationDetailID_cursor INTO @false_ConversationDetailIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteMJConversationDetailArtifact] @ID = @false_ConversationDetailIDID
        
        FETCH NEXT FROM cascade_delete_false_ConversationDetailID_cursor INTO @false_ConversationDetailIDID
    END
    
    CLOSE cascade_delete_false_ConversationDetailID_cursor
    DEALLOCATE cascade_delete_false_ConversationDetailID_cursor
    
    -- Cascade delete from ConversationDetailAttachment using cursor to call spDeleteMJConversationDetailAttachment
    DECLARE @false_ConversationDetailIDID uniqueidentifier
    DECLARE cascade_delete_false_ConversationDetailID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[ConversationDetailAttachment]
        WHERE [ConversationDetailID] = @ID
    
    OPEN cascade_delete_false_ConversationDetailID_cursor
    FETCH NEXT FROM cascade_delete_false_ConversationDetailID_cursor INTO @false_ConversationDetailIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteMJConversationDetailAttachment] @ID = @false_ConversationDetailIDID
        
        FETCH NEXT FROM cascade_delete_false_ConversationDetailID_cursor INTO @false_ConversationDetailIDID
    END
    
    CLOSE cascade_delete_false_ConversationDetailID_cursor
    DEALLOCATE cascade_delete_false_ConversationDetailID_cursor
    
    -- Cascade delete from ConversationDetailRating using cursor to call spDeleteMJConversationDetailRating
    DECLARE @false_ConversationDetailIDID uniqueidentifier
    DECLARE cascade_delete_false_ConversationDetailID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[ConversationDetailRating]
        WHERE [ConversationDetailID] = @ID
    
    OPEN cascade_delete_false_ConversationDetailID_cursor
    FETCH NEXT FROM cascade_delete_false_ConversationDetailID_cursor INTO @false_ConversationDetailIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteMJConversationDetailRating] @ID = @false_ConversationDetailIDID
        
        FETCH NEXT FROM cascade_delete_false_ConversationDetailID_cursor INTO @false_ConversationDetailIDID
    END
    
    CLOSE cascade_delete_false_ConversationDetailID_cursor
    DEALLOCATE cascade_delete_false_ConversationDetailID_cursor
    
    -- Cascade update on ConversationDetail using cursor to call spUpdateMJConversationDetail
    DECLARE @false_ParentIDID uniqueidentifier
    DECLARE @false_ParentID_ConversationID uniqueidentifier
    DECLARE @false_ParentID_ExternalID nvarchar(100)
    DECLARE @false_ParentID_Role nvarchar(20)
    DECLARE @false_ParentID_Message nvarchar(MAX)
    DECLARE @false_ParentID_Error nvarchar(MAX)
    DECLARE @false_ParentID_HiddenToUser bit
    DECLARE @false_ParentID_UserRating int
    DECLARE @false_ParentID_UserFeedback nvarchar(MAX)
    DECLARE @false_ParentID_ReflectionInsights nvarchar(MAX)
    DECLARE @false_ParentID_SummaryOfEarlierConversation nvarchar(MAX)
    DECLARE @false_ParentID_UserID uniqueidentifier
    DECLARE @false_ParentID_ArtifactID uniqueidentifier
    DECLARE @false_ParentID_ArtifactVersionID uniqueidentifier
    DECLARE @false_ParentID_CompletionTime bigint
    DECLARE @false_ParentID_IsPinned bit
    DECLARE @false_ParentID_ParentID uniqueidentifier
    DECLARE @false_ParentID_AgentID uniqueidentifier
    DECLARE @false_ParentID_Status nvarchar(20)
    DECLARE @false_ParentID_SuggestedResponses nvarchar(MAX)
    DECLARE @false_ParentID_TestRunID uniqueidentifier
    DECLARE @false_ParentID_ResponseForm nvarchar(MAX)
    DECLARE @false_ParentID_ActionableCommands nvarchar(MAX)
    DECLARE @false_ParentID_AutomaticCommands nvarchar(MAX)
    DECLARE @false_ParentID_OriginalMessageChanged bit
    DECLARE cascade_update_false_ParentID_cursor CURSOR FOR
        SELECT [ID], [ConversationID], [ExternalID], [Role], [Message], [Error], [HiddenToUser], [UserRating], [UserFeedback], [ReflectionInsights], [SummaryOfEarlierConversation], [UserID], [ArtifactID], [ArtifactVersionID], [CompletionTime], [IsPinned], [ParentID], [AgentID], [Status], [SuggestedResponses], [TestRunID], [ResponseForm], [ActionableCommands], [AutomaticCommands], [OriginalMessageChanged]
        FROM [${flyway:defaultSchema}].[ConversationDetail]
        WHERE [ParentID] = @ID

    OPEN cascade_update_false_ParentID_cursor
    FETCH NEXT FROM cascade_update_false_ParentID_cursor INTO @false_ParentIDID, @false_ParentID_ConversationID, @false_ParentID_ExternalID, @false_ParentID_Role, @false_ParentID_Message, @false_ParentID_Error, @false_ParentID_HiddenToUser, @false_ParentID_UserRating, @false_ParentID_UserFeedback, @false_ParentID_ReflectionInsights, @false_ParentID_SummaryOfEarlierConversation, @false_ParentID_UserID, @false_ParentID_ArtifactID, @false_ParentID_ArtifactVersionID, @false_ParentID_CompletionTime, @false_ParentID_IsPinned, @false_ParentID_ParentID, @false_ParentID_AgentID, @false_ParentID_Status, @false_ParentID_SuggestedResponses, @false_ParentID_TestRunID, @false_ParentID_ResponseForm, @false_ParentID_ActionableCommands, @false_ParentID_AutomaticCommands, @false_ParentID_OriginalMessageChanged

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @false_ParentID_ParentID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateMJConversationDetail] @ID = @false_ParentIDID, @ConversationID = @false_ParentID_ConversationID, @ExternalID = @false_ParentID_ExternalID, @Role = @false_ParentID_Role, @Message = @false_ParentID_Message, @Error = @false_ParentID_Error, @HiddenToUser = @false_ParentID_HiddenToUser, @UserRating = @false_ParentID_UserRating, @UserFeedback = @false_ParentID_UserFeedback, @ReflectionInsights = @false_ParentID_ReflectionInsights, @SummaryOfEarlierConversation = @false_ParentID_SummaryOfEarlierConversation, @UserID = @false_ParentID_UserID, @ArtifactID = @false_ParentID_ArtifactID, @ArtifactVersionID = @false_ParentID_ArtifactVersionID, @CompletionTime = @false_ParentID_CompletionTime, @IsPinned = @false_ParentID_IsPinned, @ParentID = @false_ParentID_ParentID, @AgentID = @false_ParentID_AgentID, @Status = @false_ParentID_Status, @SuggestedResponses = @false_ParentID_SuggestedResponses, @TestRunID = @false_ParentID_TestRunID, @ResponseForm = @false_ParentID_ResponseForm, @ActionableCommands = @false_ParentID_ActionableCommands, @AutomaticCommands = @false_ParentID_AutomaticCommands, @OriginalMessageChanged = @false_ParentID_OriginalMessageChanged

        FETCH NEXT FROM cascade_update_false_ParentID_cursor INTO @false_ParentIDID, @false_ParentID_ConversationID, @false_ParentID_ExternalID, @false_ParentID_Role, @false_ParentID_Message, @false_ParentID_Error, @false_ParentID_HiddenToUser, @false_ParentID_UserRating, @false_ParentID_UserFeedback, @false_ParentID_ReflectionInsights, @false_ParentID_SummaryOfEarlierConversation, @false_ParentID_UserID, @false_ParentID_ArtifactID, @false_ParentID_ArtifactVersionID, @false_ParentID_CompletionTime, @false_ParentID_IsPinned, @false_ParentID_ParentID, @false_ParentID_AgentID, @false_ParentID_Status, @false_ParentID_SuggestedResponses, @false_ParentID_TestRunID, @false_ParentID_ResponseForm, @false_ParentID_ActionableCommands, @false_ParentID_AutomaticCommands, @false_ParentID_OriginalMessageChanged
    END

    CLOSE cascade_update_false_ParentID_cursor
    DEALLOCATE cascade_update_false_ParentID_cursor
    
    -- Cascade update on Report using cursor to call spUpdateMJReport
    DECLARE @false_ConversationDetailIDID uniqueidentifier
    DECLARE @false_ConversationDetailID_Name nvarchar(255)
    DECLARE @false_ConversationDetailID_Description nvarchar(MAX)
    DECLARE @false_ConversationDetailID_CategoryID uniqueidentifier
    DECLARE @false_ConversationDetailID_UserID uniqueidentifier
    DECLARE @false_ConversationDetailID_SharingScope nvarchar(20)
    DECLARE @false_ConversationDetailID_ConversationID uniqueidentifier
    DECLARE @false_ConversationDetailID_ConversationDetailID uniqueidentifier
    DECLARE @false_ConversationDetailID_DataContextID uniqueidentifier
    DECLARE @false_ConversationDetailID_Configuration nvarchar(MAX)
    DECLARE @false_ConversationDetailID_OutputTriggerTypeID uniqueidentifier
    DECLARE @false_ConversationDetailID_OutputFormatTypeID uniqueidentifier
    DECLARE @false_ConversationDetailID_OutputDeliveryTypeID uniqueidentifier
    DECLARE @false_ConversationDetailID_OutputFrequency nvarchar(50)
    DECLARE @false_ConversationDetailID_OutputTargetEmail nvarchar(255)
    DECLARE @false_ConversationDetailID_OutputWorkflowID uniqueidentifier
    DECLARE @false_ConversationDetailID_Thumbnail nvarchar(MAX)
    DECLARE @false_ConversationDetailID_EnvironmentID uniqueidentifier
    DECLARE cascade_update_false_ConversationDetailID_cursor CURSOR FOR
        SELECT [ID], [Name], [Description], [CategoryID], [UserID], [SharingScope], [ConversationID], [ConversationDetailID], [DataContextID], [Configuration], [OutputTriggerTypeID], [OutputFormatTypeID], [OutputDeliveryTypeID], [OutputFrequency], [OutputTargetEmail], [OutputWorkflowID], [Thumbnail], [EnvironmentID]
        FROM [${flyway:defaultSchema}].[Report]
        WHERE [ConversationDetailID] = @ID

    OPEN cascade_update_false_ConversationDetailID_cursor
    FETCH NEXT FROM cascade_update_false_ConversationDetailID_cursor INTO @false_ConversationDetailIDID, @false_ConversationDetailID_Name, @false_ConversationDetailID_Description, @false_ConversationDetailID_CategoryID, @false_ConversationDetailID_UserID, @false_ConversationDetailID_SharingScope, @false_ConversationDetailID_ConversationID, @false_ConversationDetailID_ConversationDetailID, @false_ConversationDetailID_DataContextID, @false_ConversationDetailID_Configuration, @false_ConversationDetailID_OutputTriggerTypeID, @false_ConversationDetailID_OutputFormatTypeID, @false_ConversationDetailID_OutputDeliveryTypeID, @false_ConversationDetailID_OutputFrequency, @false_ConversationDetailID_OutputTargetEmail, @false_ConversationDetailID_OutputWorkflowID, @false_ConversationDetailID_Thumbnail, @false_ConversationDetailID_EnvironmentID

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @false_ConversationDetailID_ConversationDetailID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateMJReport] @ID = @false_ConversationDetailIDID, @Name = @false_ConversationDetailID_Name, @Description = @false_ConversationDetailID_Description, @CategoryID = @false_ConversationDetailID_CategoryID, @UserID = @false_ConversationDetailID_UserID, @SharingScope = @false_ConversationDetailID_SharingScope, @ConversationID = @false_ConversationDetailID_ConversationID, @ConversationDetailID = @false_ConversationDetailID_ConversationDetailID, @DataContextID = @false_ConversationDetailID_DataContextID, @Configuration = @false_ConversationDetailID_Configuration, @OutputTriggerTypeID = @false_ConversationDetailID_OutputTriggerTypeID, @OutputFormatTypeID = @false_ConversationDetailID_OutputFormatTypeID, @OutputDeliveryTypeID = @false_ConversationDetailID_OutputDeliveryTypeID, @OutputFrequency = @false_ConversationDetailID_OutputFrequency, @OutputTargetEmail = @false_ConversationDetailID_OutputTargetEmail, @OutputWorkflowID = @false_ConversationDetailID_OutputWorkflowID, @Thumbnail = @false_ConversationDetailID_Thumbnail, @EnvironmentID = @false_ConversationDetailID_EnvironmentID

        FETCH NEXT FROM cascade_update_false_ConversationDetailID_cursor INTO @false_ConversationDetailIDID, @false_ConversationDetailID_Name, @false_ConversationDetailID_Description, @false_ConversationDetailID_CategoryID, @false_ConversationDetailID_UserID, @false_ConversationDetailID_SharingScope, @false_ConversationDetailID_ConversationID, @false_ConversationDetailID_ConversationDetailID, @false_ConversationDetailID_DataContextID, @false_ConversationDetailID_Configuration, @false_ConversationDetailID_OutputTriggerTypeID, @false_ConversationDetailID_OutputFormatTypeID, @false_ConversationDetailID_OutputDeliveryTypeID, @false_ConversationDetailID_OutputFrequency, @false_ConversationDetailID_OutputTargetEmail, @false_ConversationDetailID_OutputWorkflowID, @false_ConversationDetailID_Thumbnail, @false_ConversationDetailID_EnvironmentID
    END

    CLOSE cascade_update_false_ConversationDetailID_cursor
    DEALLOCATE cascade_update_false_ConversationDetailID_cursor
    
    -- Cascade update on Task using cursor to call spUpdateMJTask
    DECLARE @false_ConversationDetailIDID uniqueidentifier
    DECLARE @false_ConversationDetailID_ParentID uniqueidentifier
    DECLARE @false_ConversationDetailID_Name nvarchar(255)
    DECLARE @false_ConversationDetailID_Description nvarchar(MAX)
    DECLARE @false_ConversationDetailID_TypeID uniqueidentifier
    DECLARE @false_ConversationDetailID_EnvironmentID uniqueidentifier
    DECLARE @false_ConversationDetailID_ProjectID uniqueidentifier
    DECLARE @false_ConversationDetailID_ConversationDetailID uniqueidentifier
    DECLARE @false_ConversationDetailID_UserID uniqueidentifier
    DECLARE @false_ConversationDetailID_AgentID uniqueidentifier
    DECLARE @false_ConversationDetailID_Status nvarchar(50)
    DECLARE @false_ConversationDetailID_PercentComplete int
    DECLARE @false_ConversationDetailID_DueAt datetimeoffset
    DECLARE @false_ConversationDetailID_StartedAt datetimeoffset
    DECLARE @false_ConversationDetailID_CompletedAt datetimeoffset
    DECLARE cascade_update_false_ConversationDetailID_cursor CURSOR FOR
        SELECT [ID], [ParentID], [Name], [Description], [TypeID], [EnvironmentID], [ProjectID], [ConversationDetailID], [UserID], [AgentID], [Status], [PercentComplete], [DueAt], [StartedAt], [CompletedAt]
        FROM [${flyway:defaultSchema}].[Task]
        WHERE [ConversationDetailID] = @ID

    OPEN cascade_update_false_ConversationDetailID_cursor
    FETCH NEXT FROM cascade_update_false_ConversationDetailID_cursor INTO @false_ConversationDetailIDID, @false_ConversationDetailID_ParentID, @false_ConversationDetailID_Name, @false_ConversationDetailID_Description, @false_ConversationDetailID_TypeID, @false_ConversationDetailID_EnvironmentID, @false_ConversationDetailID_ProjectID, @false_ConversationDetailID_ConversationDetailID, @false_ConversationDetailID_UserID, @false_ConversationDetailID_AgentID, @false_ConversationDetailID_Status, @false_ConversationDetailID_PercentComplete, @false_ConversationDetailID_DueAt, @false_ConversationDetailID_StartedAt, @false_ConversationDetailID_CompletedAt

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @false_ConversationDetailID_ConversationDetailID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateMJTask] @ID = @false_ConversationDetailIDID, @ParentID = @false_ConversationDetailID_ParentID, @Name = @false_ConversationDetailID_Name, @Description = @false_ConversationDetailID_Description, @TypeID = @false_ConversationDetailID_TypeID, @EnvironmentID = @false_ConversationDetailID_EnvironmentID, @ProjectID = @false_ConversationDetailID_ProjectID, @ConversationDetailID = @false_ConversationDetailID_ConversationDetailID, @UserID = @false_ConversationDetailID_UserID, @AgentID = @false_ConversationDetailID_AgentID, @Status = @false_ConversationDetailID_Status, @PercentComplete = @false_ConversationDetailID_PercentComplete, @DueAt = @false_ConversationDetailID_DueAt, @StartedAt = @false_ConversationDetailID_StartedAt, @CompletedAt = @false_ConversationDetailID_CompletedAt

        FETCH NEXT FROM cascade_update_false_ConversationDetailID_cursor INTO @false_ConversationDetailIDID, @false_ConversationDetailID_ParentID, @false_ConversationDetailID_Name, @false_ConversationDetailID_Description, @false_ConversationDetailID_TypeID, @false_ConversationDetailID_EnvironmentID, @false_ConversationDetailID_ProjectID, @false_ConversationDetailID_ConversationDetailID, @false_ConversationDetailID_UserID, @false_ConversationDetailID_AgentID, @false_ConversationDetailID_Status, @false_ConversationDetailID_PercentComplete, @false_ConversationDetailID_DueAt, @false_ConversationDetailID_StartedAt, @false_ConversationDetailID_CompletedAt
    END

    CLOSE cascade_update_false_ConversationDetailID_cursor
    DEALLOCATE cascade_update_false_ConversationDetailID_cursor
    

    DELETE FROM
        [${flyway:defaultSchema}].[ConversationDetail]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJConversationDetail] TO [cdp_Developer], [cdp_UI], [cdp_Integration]
    

/* spDelete Permissions for MJ: Conversation Details */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJConversationDetail] TO [cdp_Developer], [cdp_UI], [cdp_Integration]



/* Base View SQL for MJ: Dashboard Categories */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Dashboard Categories
-- Item: vwDashboardCategories
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Dashboard Categories
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  DashboardCategory
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwDashboardCategories]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwDashboardCategories];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwDashboardCategories]
AS
SELECT
    m.*,
    MJDashboardCategories_ParentID.[Name] AS [Parent],
    MJUsers_UserID.[Name] AS [User],
    root_ParentID.RootID AS [RootParentID]
FROM
    [${flyway:defaultSchema}].[DashboardCategory] AS m
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[DashboardCategory] AS MJDashboardCategories_ParentID
  ON
    [m].[ParentID] = MJDashboardCategories_ParentID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_UserID
  ON
    [m].[UserID] = MJUsers_UserID.[ID]
OUTER APPLY
    [${flyway:defaultSchema}].[fnDashboardCategoryParentID_GetRootID]([m].[ID], [m].[ParentID]) AS root_ParentID
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwDashboardCategories] TO [cdp_Developer], [cdp_Integration], [cdp_UI]
    

/* Base View Permissions SQL for MJ: Dashboard Categories */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Dashboard Categories
-- Item: Permissions for vwDashboardCategories
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwDashboardCategories] TO [cdp_Developer], [cdp_Integration], [cdp_UI]

/* spCreate SQL for MJ: Dashboard Categories */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Dashboard Categories
-- Item: spCreateMJDashboardCategory
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR DashboardCategory
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJDashboardCategory]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJDashboardCategory];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJDashboardCategory]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(100),
    @Description nvarchar(MAX),
    @ParentID uniqueidentifier,
    @UserID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[DashboardCategory]
            (
                [ID],
                [Name],
                [Description],
                [ParentID],
                [UserID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description,
                @ParentID,
                @UserID
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[DashboardCategory]
            (
                [Name],
                [Description],
                [ParentID],
                [UserID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description,
                @ParentID,
                @UserID
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwDashboardCategories] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJDashboardCategory] TO [cdp_Developer], [cdp_Integration], [cdp_UI]
    

/* spCreate Permissions for MJ: Dashboard Categories */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJDashboardCategory] TO [cdp_Developer], [cdp_Integration], [cdp_UI]



/* spUpdate SQL for MJ: Dashboard Categories */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Dashboard Categories
-- Item: spUpdateMJDashboardCategory
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR DashboardCategory
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJDashboardCategory]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJDashboardCategory];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJDashboardCategory]
    @ID uniqueidentifier,
    @Name nvarchar(100),
    @Description nvarchar(MAX),
    @ParentID uniqueidentifier,
    @UserID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[DashboardCategory]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [ParentID] = @ParentID,
        [UserID] = @UserID
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwDashboardCategories] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwDashboardCategories]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJDashboardCategory] TO [cdp_Developer], [cdp_Integration], [cdp_UI]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the DashboardCategory table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJDashboardCategory]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJDashboardCategory];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJDashboardCategory
ON [${flyway:defaultSchema}].[DashboardCategory]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[DashboardCategory]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[DashboardCategory] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Dashboard Categories */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJDashboardCategory] TO [cdp_Developer], [cdp_Integration], [cdp_UI]



/* spDelete SQL for MJ: Dashboard Categories */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Dashboard Categories
-- Item: spDeleteMJDashboardCategory
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR DashboardCategory
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJDashboardCategory]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJDashboardCategory];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJDashboardCategory]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[DashboardCategory]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJDashboardCategory] TO [cdp_Developer], [cdp_Integration], [cdp_UI]
    

/* spDelete Permissions for MJ: Dashboard Categories */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJDashboardCategory] TO [cdp_Developer], [cdp_Integration], [cdp_UI]



/* Base View SQL for MJ: Dashboard Category Permissions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Dashboard Category Permissions
-- Item: vwDashboardCategoryPermissions
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Dashboard Category Permissions
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  DashboardCategoryPermission
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwDashboardCategoryPermissions]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwDashboardCategoryPermissions];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwDashboardCategoryPermissions]
AS
SELECT
    m.*,
    MJDashboardCategories_DashboardCategoryID.[Name] AS [DashboardCategory],
    MJUsers_UserID.[Name] AS [User],
    MJUsers_SharedByUserID.[Name] AS [SharedByUser]
FROM
    [${flyway:defaultSchema}].[DashboardCategoryPermission] AS m
INNER JOIN
    [${flyway:defaultSchema}].[DashboardCategory] AS MJDashboardCategories_DashboardCategoryID
  ON
    [m].[DashboardCategoryID] = MJDashboardCategories_DashboardCategoryID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_UserID
  ON
    [m].[UserID] = MJUsers_UserID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_SharedByUserID
  ON
    [m].[SharedByUserID] = MJUsers_SharedByUserID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwDashboardCategoryPermissions] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Dashboard Category Permissions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Dashboard Category Permissions
-- Item: Permissions for vwDashboardCategoryPermissions
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwDashboardCategoryPermissions] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Dashboard Category Permissions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Dashboard Category Permissions
-- Item: spCreateMJDashboardCategoryPermission
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR DashboardCategoryPermission
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJDashboardCategoryPermission]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJDashboardCategoryPermission];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJDashboardCategoryPermission]
    @ID uniqueidentifier = NULL,
    @DashboardCategoryID uniqueidentifier,
    @UserID uniqueidentifier,
    @CanRead bit = NULL,
    @CanEdit bit = NULL,
    @CanAddRemove bit = NULL,
    @CanShare bit = NULL,
    @SharedByUserID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[DashboardCategoryPermission]
            (
                [ID],
                [DashboardCategoryID],
                [UserID],
                [CanRead],
                [CanEdit],
                [CanAddRemove],
                [CanShare],
                [SharedByUserID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @DashboardCategoryID,
                @UserID,
                ISNULL(@CanRead, 1),
                ISNULL(@CanEdit, 0),
                ISNULL(@CanAddRemove, 0),
                ISNULL(@CanShare, 0),
                @SharedByUserID
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[DashboardCategoryPermission]
            (
                [DashboardCategoryID],
                [UserID],
                [CanRead],
                [CanEdit],
                [CanAddRemove],
                [CanShare],
                [SharedByUserID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @DashboardCategoryID,
                @UserID,
                ISNULL(@CanRead, 1),
                ISNULL(@CanEdit, 0),
                ISNULL(@CanAddRemove, 0),
                ISNULL(@CanShare, 0),
                @SharedByUserID
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwDashboardCategoryPermissions] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJDashboardCategoryPermission] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Dashboard Category Permissions */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJDashboardCategoryPermission] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Dashboard Category Permissions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Dashboard Category Permissions
-- Item: spUpdateMJDashboardCategoryPermission
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR DashboardCategoryPermission
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJDashboardCategoryPermission]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJDashboardCategoryPermission];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJDashboardCategoryPermission]
    @ID uniqueidentifier,
    @DashboardCategoryID uniqueidentifier,
    @UserID uniqueidentifier,
    @CanRead bit,
    @CanEdit bit,
    @CanAddRemove bit,
    @CanShare bit,
    @SharedByUserID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[DashboardCategoryPermission]
    SET
        [DashboardCategoryID] = @DashboardCategoryID,
        [UserID] = @UserID,
        [CanRead] = @CanRead,
        [CanEdit] = @CanEdit,
        [CanAddRemove] = @CanAddRemove,
        [CanShare] = @CanShare,
        [SharedByUserID] = @SharedByUserID
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwDashboardCategoryPermissions] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwDashboardCategoryPermissions]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJDashboardCategoryPermission] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the DashboardCategoryPermission table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJDashboardCategoryPermission]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJDashboardCategoryPermission];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJDashboardCategoryPermission
ON [${flyway:defaultSchema}].[DashboardCategoryPermission]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[DashboardCategoryPermission]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[DashboardCategoryPermission] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Dashboard Category Permissions */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJDashboardCategoryPermission] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Dashboard Category Permissions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Dashboard Category Permissions
-- Item: spDeleteMJDashboardCategoryPermission
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR DashboardCategoryPermission
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJDashboardCategoryPermission]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJDashboardCategoryPermission];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJDashboardCategoryPermission]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[DashboardCategoryPermission]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJDashboardCategoryPermission] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Dashboard Category Permissions */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJDashboardCategoryPermission] TO [cdp_Integration]



/* Base View SQL for MJ: Credentials */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Credentials
-- Item: vwCredentials
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Credentials
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  Credential
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwCredentials]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwCredentials];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwCredentials]
AS
SELECT
    m.*,
    MJCredentialTypes_CredentialTypeID.[Name] AS [CredentialType],
    MJCredentialCategories_CategoryID.[Name] AS [Category]
FROM
    [${flyway:defaultSchema}].[Credential] AS m
INNER JOIN
    [${flyway:defaultSchema}].[CredentialType] AS MJCredentialTypes_CredentialTypeID
  ON
    [m].[CredentialTypeID] = MJCredentialTypes_CredentialTypeID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[CredentialCategory] AS MJCredentialCategories_CategoryID
  ON
    [m].[CategoryID] = MJCredentialCategories_CategoryID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwCredentials] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Credentials */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Credentials
-- Item: Permissions for vwCredentials
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwCredentials] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Credentials */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Credentials
-- Item: spCreateMJCredential
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR Credential
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJCredential]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJCredential];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJCredential]
    @ID uniqueidentifier = NULL,
    @CredentialTypeID uniqueidentifier,
    @CategoryID uniqueidentifier,
    @Name nvarchar(200),
    @Description nvarchar(MAX),
    @Values nvarchar(MAX),
    @IsDefault bit = NULL,
    @IsActive bit = NULL,
    @ExpiresAt datetimeoffset,
    @LastValidatedAt datetimeoffset,
    @LastUsedAt datetimeoffset,
    @IconClass nvarchar(100)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[Credential]
            (
                [ID],
                [CredentialTypeID],
                [CategoryID],
                [Name],
                [Description],
                [Values],
                [IsDefault],
                [IsActive],
                [ExpiresAt],
                [LastValidatedAt],
                [LastUsedAt],
                [IconClass]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @CredentialTypeID,
                @CategoryID,
                @Name,
                @Description,
                @Values,
                ISNULL(@IsDefault, 0),
                ISNULL(@IsActive, 1),
                @ExpiresAt,
                @LastValidatedAt,
                @LastUsedAt,
                @IconClass
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[Credential]
            (
                [CredentialTypeID],
                [CategoryID],
                [Name],
                [Description],
                [Values],
                [IsDefault],
                [IsActive],
                [ExpiresAt],
                [LastValidatedAt],
                [LastUsedAt],
                [IconClass]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @CredentialTypeID,
                @CategoryID,
                @Name,
                @Description,
                @Values,
                ISNULL(@IsDefault, 0),
                ISNULL(@IsActive, 1),
                @ExpiresAt,
                @LastValidatedAt,
                @LastUsedAt,
                @IconClass
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwCredentials] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJCredential] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Credentials */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJCredential] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Credentials */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Credentials
-- Item: spUpdateMJCredential
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR Credential
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJCredential]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJCredential];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJCredential]
    @ID uniqueidentifier,
    @CredentialTypeID uniqueidentifier,
    @CategoryID uniqueidentifier,
    @Name nvarchar(200),
    @Description nvarchar(MAX),
    @Values nvarchar(MAX),
    @IsDefault bit,
    @IsActive bit,
    @ExpiresAt datetimeoffset,
    @LastValidatedAt datetimeoffset,
    @LastUsedAt datetimeoffset,
    @IconClass nvarchar(100)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[Credential]
    SET
        [CredentialTypeID] = @CredentialTypeID,
        [CategoryID] = @CategoryID,
        [Name] = @Name,
        [Description] = @Description,
        [Values] = @Values,
        [IsDefault] = @IsDefault,
        [IsActive] = @IsActive,
        [ExpiresAt] = @ExpiresAt,
        [LastValidatedAt] = @LastValidatedAt,
        [LastUsedAt] = @LastUsedAt,
        [IconClass] = @IconClass
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwCredentials] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwCredentials]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJCredential] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the Credential table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJCredential]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJCredential];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJCredential
ON [${flyway:defaultSchema}].[Credential]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[Credential]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[Credential] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Credentials */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJCredential] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Credentials */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Credentials
-- Item: spDeleteMJCredential
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR Credential
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJCredential]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJCredential];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJCredential]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[Credential]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJCredential] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Credentials */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJCredential] TO [cdp_Integration]



/* Base View SQL for MJ: Dashboard Category Links */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Dashboard Category Links
-- Item: vwDashboardCategoryLinks
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Dashboard Category Links
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  DashboardCategoryLink
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwDashboardCategoryLinks]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwDashboardCategoryLinks];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwDashboardCategoryLinks]
AS
SELECT
    m.*,
    MJDashboards_DashboardID.[Name] AS [Dashboard],
    MJUsers_UserID.[Name] AS [User],
    MJDashboardCategories_DashboardCategoryID.[Name] AS [DashboardCategory]
FROM
    [${flyway:defaultSchema}].[DashboardCategoryLink] AS m
INNER JOIN
    [${flyway:defaultSchema}].[Dashboard] AS MJDashboards_DashboardID
  ON
    [m].[DashboardID] = MJDashboards_DashboardID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_UserID
  ON
    [m].[UserID] = MJUsers_UserID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[DashboardCategory] AS MJDashboardCategories_DashboardCategoryID
  ON
    [m].[DashboardCategoryID] = MJDashboardCategories_DashboardCategoryID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwDashboardCategoryLinks] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Dashboard Category Links */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Dashboard Category Links
-- Item: Permissions for vwDashboardCategoryLinks
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwDashboardCategoryLinks] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Dashboard Category Links */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Dashboard Category Links
-- Item: spCreateMJDashboardCategoryLink
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR DashboardCategoryLink
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJDashboardCategoryLink]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJDashboardCategoryLink];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJDashboardCategoryLink]
    @ID uniqueidentifier = NULL,
    @DashboardID uniqueidentifier,
    @UserID uniqueidentifier,
    @DashboardCategoryID uniqueidentifier,
    @DisplayName nvarchar(255),
    @Sequence int = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[DashboardCategoryLink]
            (
                [ID],
                [DashboardID],
                [UserID],
                [DashboardCategoryID],
                [DisplayName],
                [Sequence]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @DashboardID,
                @UserID,
                @DashboardCategoryID,
                @DisplayName,
                ISNULL(@Sequence, 0)
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[DashboardCategoryLink]
            (
                [DashboardID],
                [UserID],
                [DashboardCategoryID],
                [DisplayName],
                [Sequence]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @DashboardID,
                @UserID,
                @DashboardCategoryID,
                @DisplayName,
                ISNULL(@Sequence, 0)
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwDashboardCategoryLinks] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJDashboardCategoryLink] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Dashboard Category Links */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJDashboardCategoryLink] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Dashboard Category Links */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Dashboard Category Links
-- Item: spUpdateMJDashboardCategoryLink
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR DashboardCategoryLink
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJDashboardCategoryLink]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJDashboardCategoryLink];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJDashboardCategoryLink]
    @ID uniqueidentifier,
    @DashboardID uniqueidentifier,
    @UserID uniqueidentifier,
    @DashboardCategoryID uniqueidentifier,
    @DisplayName nvarchar(255),
    @Sequence int
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[DashboardCategoryLink]
    SET
        [DashboardID] = @DashboardID,
        [UserID] = @UserID,
        [DashboardCategoryID] = @DashboardCategoryID,
        [DisplayName] = @DisplayName,
        [Sequence] = @Sequence
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwDashboardCategoryLinks] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwDashboardCategoryLinks]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJDashboardCategoryLink] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the DashboardCategoryLink table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJDashboardCategoryLink]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJDashboardCategoryLink];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJDashboardCategoryLink
ON [${flyway:defaultSchema}].[DashboardCategoryLink]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[DashboardCategoryLink]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[DashboardCategoryLink] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Dashboard Category Links */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJDashboardCategoryLink] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Dashboard Category Links */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Dashboard Category Links
-- Item: spDeleteMJDashboardCategoryLink
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR DashboardCategoryLink
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJDashboardCategoryLink]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJDashboardCategoryLink];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJDashboardCategoryLink]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[DashboardCategoryLink]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJDashboardCategoryLink] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Dashboard Category Links */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJDashboardCategoryLink] TO [cdp_Integration]



/* Base View SQL for MJ: Dashboard Part Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Dashboard Part Types
-- Item: vwDashboardPartTypes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Dashboard Part Types
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  DashboardPartType
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwDashboardPartTypes]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwDashboardPartTypes];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwDashboardPartTypes]
AS
SELECT
    m.*
FROM
    [${flyway:defaultSchema}].[DashboardPartType] AS m
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwDashboardPartTypes] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Dashboard Part Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Dashboard Part Types
-- Item: Permissions for vwDashboardPartTypes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwDashboardPartTypes] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Dashboard Part Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Dashboard Part Types
-- Item: spCreateMJDashboardPartType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR DashboardPartType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJDashboardPartType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJDashboardPartType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJDashboardPartType]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(100),
    @Description nvarchar(MAX),
    @Icon nvarchar(100),
    @DriverClass nvarchar(255),
    @ConfigDialogClass nvarchar(255),
    @DefaultConfig nvarchar(MAX),
    @SortOrder int = NULL,
    @IsActive bit = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[DashboardPartType]
            (
                [ID],
                [Name],
                [Description],
                [Icon],
                [DriverClass],
                [ConfigDialogClass],
                [DefaultConfig],
                [SortOrder],
                [IsActive]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description,
                @Icon,
                @DriverClass,
                @ConfigDialogClass,
                @DefaultConfig,
                ISNULL(@SortOrder, 0),
                ISNULL(@IsActive, 1)
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[DashboardPartType]
            (
                [Name],
                [Description],
                [Icon],
                [DriverClass],
                [ConfigDialogClass],
                [DefaultConfig],
                [SortOrder],
                [IsActive]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description,
                @Icon,
                @DriverClass,
                @ConfigDialogClass,
                @DefaultConfig,
                ISNULL(@SortOrder, 0),
                ISNULL(@IsActive, 1)
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwDashboardPartTypes] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJDashboardPartType] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Dashboard Part Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJDashboardPartType] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Dashboard Part Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Dashboard Part Types
-- Item: spUpdateMJDashboardPartType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR DashboardPartType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJDashboardPartType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJDashboardPartType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJDashboardPartType]
    @ID uniqueidentifier,
    @Name nvarchar(100),
    @Description nvarchar(MAX),
    @Icon nvarchar(100),
    @DriverClass nvarchar(255),
    @ConfigDialogClass nvarchar(255),
    @DefaultConfig nvarchar(MAX),
    @SortOrder int,
    @IsActive bit
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[DashboardPartType]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [Icon] = @Icon,
        [DriverClass] = @DriverClass,
        [ConfigDialogClass] = @ConfigDialogClass,
        [DefaultConfig] = @DefaultConfig,
        [SortOrder] = @SortOrder,
        [IsActive] = @IsActive
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwDashboardPartTypes] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwDashboardPartTypes]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJDashboardPartType] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the DashboardPartType table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJDashboardPartType]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJDashboardPartType];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJDashboardPartType
ON [${flyway:defaultSchema}].[DashboardPartType]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[DashboardPartType]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[DashboardPartType] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Dashboard Part Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJDashboardPartType] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Dashboard Part Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Dashboard Part Types
-- Item: spDeleteMJDashboardPartType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR DashboardPartType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJDashboardPartType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJDashboardPartType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJDashboardPartType]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[DashboardPartType]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJDashboardPartType] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Dashboard Part Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJDashboardPartType] TO [cdp_Integration]



/* Base View SQL for MJ: Data Context Items */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Data Context Items
-- Item: vwDataContextItems
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Data Context Items
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  DataContextItem
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwDataContextItems]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwDataContextItems];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwDataContextItems]
AS
SELECT
    m.*,
    MJDataContexts_DataContextID.[Name] AS [DataContext],
    MJUserViews_ViewID.[Name] AS [View],
    MJQueries_QueryID.[Name] AS [Query],
    MJEntities_EntityID.[Name] AS [Entity]
FROM
    [${flyway:defaultSchema}].[DataContextItem] AS m
INNER JOIN
    [${flyway:defaultSchema}].[DataContext] AS MJDataContexts_DataContextID
  ON
    [m].[DataContextID] = MJDataContexts_DataContextID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[UserView] AS MJUserViews_ViewID
  ON
    [m].[ViewID] = MJUserViews_ViewID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[Query] AS MJQueries_QueryID
  ON
    [m].[QueryID] = MJQueries_QueryID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[Entity] AS MJEntities_EntityID
  ON
    [m].[EntityID] = MJEntities_EntityID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwDataContextItems] TO [cdp_UI], [cdp_Integration], [cdp_Developer]
    

/* Base View Permissions SQL for MJ: Data Context Items */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Data Context Items
-- Item: Permissions for vwDataContextItems
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwDataContextItems] TO [cdp_UI], [cdp_Integration], [cdp_Developer]

/* spCreate SQL for MJ: Data Context Items */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Data Context Items
-- Item: spCreateMJDataContextItem
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR DataContextItem
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJDataContextItem]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJDataContextItem];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJDataContextItem]
    @ID uniqueidentifier = NULL,
    @DataContextID uniqueidentifier,
    @Type nvarchar(50),
    @ViewID uniqueidentifier,
    @QueryID uniqueidentifier,
    @EntityID uniqueidentifier,
    @RecordID nvarchar(450),
    @SQL nvarchar(MAX),
    @DataJSON nvarchar(MAX),
    @LastRefreshedAt datetimeoffset,
    @Description nvarchar(MAX),
    @CodeName nvarchar(255)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[DataContextItem]
            (
                [ID],
                [DataContextID],
                [Type],
                [ViewID],
                [QueryID],
                [EntityID],
                [RecordID],
                [SQL],
                [DataJSON],
                [LastRefreshedAt],
                [Description],
                [CodeName]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @DataContextID,
                @Type,
                @ViewID,
                @QueryID,
                @EntityID,
                @RecordID,
                @SQL,
                @DataJSON,
                @LastRefreshedAt,
                @Description,
                @CodeName
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[DataContextItem]
            (
                [DataContextID],
                [Type],
                [ViewID],
                [QueryID],
                [EntityID],
                [RecordID],
                [SQL],
                [DataJSON],
                [LastRefreshedAt],
                [Description],
                [CodeName]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @DataContextID,
                @Type,
                @ViewID,
                @QueryID,
                @EntityID,
                @RecordID,
                @SQL,
                @DataJSON,
                @LastRefreshedAt,
                @Description,
                @CodeName
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwDataContextItems] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJDataContextItem] TO [cdp_UI], [cdp_Integration], [cdp_Developer]
    

/* spCreate Permissions for MJ: Data Context Items */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJDataContextItem] TO [cdp_UI], [cdp_Integration], [cdp_Developer]



/* spUpdate SQL for MJ: Data Context Items */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Data Context Items
-- Item: spUpdateMJDataContextItem
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR DataContextItem
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJDataContextItem]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJDataContextItem];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJDataContextItem]
    @ID uniqueidentifier,
    @DataContextID uniqueidentifier,
    @Type nvarchar(50),
    @ViewID uniqueidentifier,
    @QueryID uniqueidentifier,
    @EntityID uniqueidentifier,
    @RecordID nvarchar(450),
    @SQL nvarchar(MAX),
    @DataJSON nvarchar(MAX),
    @LastRefreshedAt datetimeoffset,
    @Description nvarchar(MAX),
    @CodeName nvarchar(255)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[DataContextItem]
    SET
        [DataContextID] = @DataContextID,
        [Type] = @Type,
        [ViewID] = @ViewID,
        [QueryID] = @QueryID,
        [EntityID] = @EntityID,
        [RecordID] = @RecordID,
        [SQL] = @SQL,
        [DataJSON] = @DataJSON,
        [LastRefreshedAt] = @LastRefreshedAt,
        [Description] = @Description,
        [CodeName] = @CodeName
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwDataContextItems] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwDataContextItems]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJDataContextItem] TO [cdp_UI], [cdp_Integration], [cdp_Developer]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the DataContextItem table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJDataContextItem]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJDataContextItem];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJDataContextItem
ON [${flyway:defaultSchema}].[DataContextItem]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[DataContextItem]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[DataContextItem] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Data Context Items */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJDataContextItem] TO [cdp_UI], [cdp_Integration], [cdp_Developer]



/* spDelete SQL for MJ: Data Context Items */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Data Context Items
-- Item: spDeleteMJDataContextItem
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR DataContextItem
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJDataContextItem]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJDataContextItem];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJDataContextItem]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[DataContextItem]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJDataContextItem] TO [cdp_UI], [cdp_Integration], [cdp_Developer]
    

/* spDelete Permissions for MJ: Data Context Items */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJDataContextItem] TO [cdp_UI], [cdp_Integration], [cdp_Developer]



/* Base View SQL for MJ: Dashboards */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Dashboards
-- Item: vwDashboards
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Dashboards
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  Dashboard
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwDashboards]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwDashboards];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwDashboards]
AS
SELECT
    m.*,
    MJUsers_UserID.[Name] AS [User],
    MJDashboardCategories_CategoryID.[Name] AS [Category],
    MJApplications_ApplicationID.[Name] AS [Application],
    MJEnvironments_EnvironmentID.[Name] AS [Environment]
FROM
    [${flyway:defaultSchema}].[Dashboard] AS m
INNER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_UserID
  ON
    [m].[UserID] = MJUsers_UserID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[DashboardCategory] AS MJDashboardCategories_CategoryID
  ON
    [m].[CategoryID] = MJDashboardCategories_CategoryID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[Application] AS MJApplications_ApplicationID
  ON
    [m].[ApplicationID] = MJApplications_ApplicationID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[Environment] AS MJEnvironments_EnvironmentID
  ON
    [m].[EnvironmentID] = MJEnvironments_EnvironmentID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwDashboards] TO [cdp_Integration], [cdp_Developer], [cdp_UI]
    

/* Base View Permissions SQL for MJ: Dashboards */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Dashboards
-- Item: Permissions for vwDashboards
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwDashboards] TO [cdp_Integration], [cdp_Developer], [cdp_UI]

/* spCreate SQL for MJ: Dashboards */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Dashboards
-- Item: spCreateMJDashboard
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR Dashboard
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJDashboard]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJDashboard];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJDashboard]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @UserID uniqueidentifier,
    @CategoryID uniqueidentifier,
    @UIConfigDetails nvarchar(MAX),
    @Type nvarchar(20) = NULL,
    @Thumbnail nvarchar(MAX),
    @Scope nvarchar(20) = NULL,
    @ApplicationID uniqueidentifier,
    @DriverClass nvarchar(255),
    @Code nvarchar(255),
    @EnvironmentID uniqueidentifier = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[Dashboard]
            (
                [ID],
                [Name],
                [Description],
                [UserID],
                [CategoryID],
                [UIConfigDetails],
                [Type],
                [Thumbnail],
                [Scope],
                [ApplicationID],
                [DriverClass],
                [Code],
                [EnvironmentID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description,
                @UserID,
                @CategoryID,
                @UIConfigDetails,
                ISNULL(@Type, 'Config'),
                @Thumbnail,
                ISNULL(@Scope, 'Global'),
                @ApplicationID,
                @DriverClass,
                @Code,
                CASE @EnvironmentID WHEN '00000000-0000-0000-0000-000000000000' THEN 'F51358F3-9447-4176-B313-BF8025FD8D09' ELSE ISNULL(@EnvironmentID, 'F51358F3-9447-4176-B313-BF8025FD8D09') END
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[Dashboard]
            (
                [Name],
                [Description],
                [UserID],
                [CategoryID],
                [UIConfigDetails],
                [Type],
                [Thumbnail],
                [Scope],
                [ApplicationID],
                [DriverClass],
                [Code],
                [EnvironmentID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description,
                @UserID,
                @CategoryID,
                @UIConfigDetails,
                ISNULL(@Type, 'Config'),
                @Thumbnail,
                ISNULL(@Scope, 'Global'),
                @ApplicationID,
                @DriverClass,
                @Code,
                CASE @EnvironmentID WHEN '00000000-0000-0000-0000-000000000000' THEN 'F51358F3-9447-4176-B313-BF8025FD8D09' ELSE ISNULL(@EnvironmentID, 'F51358F3-9447-4176-B313-BF8025FD8D09') END
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwDashboards] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJDashboard] TO [cdp_Integration], [cdp_Developer], [cdp_UI]
    

/* spCreate Permissions for MJ: Dashboards */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJDashboard] TO [cdp_Integration], [cdp_Developer], [cdp_UI]



/* spUpdate SQL for MJ: Dashboards */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Dashboards
-- Item: spUpdateMJDashboard
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR Dashboard
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJDashboard]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJDashboard];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJDashboard]
    @ID uniqueidentifier,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @UserID uniqueidentifier,
    @CategoryID uniqueidentifier,
    @UIConfigDetails nvarchar(MAX),
    @Type nvarchar(20),
    @Thumbnail nvarchar(MAX),
    @Scope nvarchar(20),
    @ApplicationID uniqueidentifier,
    @DriverClass nvarchar(255),
    @Code nvarchar(255),
    @EnvironmentID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[Dashboard]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [UserID] = @UserID,
        [CategoryID] = @CategoryID,
        [UIConfigDetails] = @UIConfigDetails,
        [Type] = @Type,
        [Thumbnail] = @Thumbnail,
        [Scope] = @Scope,
        [ApplicationID] = @ApplicationID,
        [DriverClass] = @DriverClass,
        [Code] = @Code,
        [EnvironmentID] = @EnvironmentID
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwDashboards] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwDashboards]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJDashboard] TO [cdp_Integration], [cdp_Developer], [cdp_UI]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the Dashboard table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJDashboard]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJDashboard];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJDashboard
ON [${flyway:defaultSchema}].[Dashboard]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[Dashboard]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[Dashboard] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Dashboards */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJDashboard] TO [cdp_Integration], [cdp_Developer], [cdp_UI]



/* spDelete SQL for MJ: Dashboards */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Dashboards
-- Item: spDeleteMJDashboard
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR Dashboard
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJDashboard]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJDashboard];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJDashboard]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[Dashboard]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJDashboard] TO [cdp_Integration], [cdp_Developer], [cdp_UI]
    

/* spDelete Permissions for MJ: Dashboards */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJDashboard] TO [cdp_Integration], [cdp_Developer], [cdp_UI]



/* Base View SQL for MJ: Dashboard User Preferences */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Dashboard User Preferences
-- Item: vwDashboardUserPreferences
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Dashboard User Preferences
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  DashboardUserPreference
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwDashboardUserPreferences]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwDashboardUserPreferences];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwDashboardUserPreferences]
AS
SELECT
    m.*,
    MJUsers_UserID.[Name] AS [User],
    MJDashboards_DashboardID.[Name] AS [Dashboard],
    MJApplications_ApplicationID.[Name] AS [Application]
FROM
    [${flyway:defaultSchema}].[DashboardUserPreference] AS m
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_UserID
  ON
    [m].[UserID] = MJUsers_UserID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[Dashboard] AS MJDashboards_DashboardID
  ON
    [m].[DashboardID] = MJDashboards_DashboardID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[Application] AS MJApplications_ApplicationID
  ON
    [m].[ApplicationID] = MJApplications_ApplicationID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwDashboardUserPreferences] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Dashboard User Preferences */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Dashboard User Preferences
-- Item: Permissions for vwDashboardUserPreferences
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwDashboardUserPreferences] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Dashboard User Preferences */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Dashboard User Preferences
-- Item: spCreateMJDashboardUserPreference
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR DashboardUserPreference
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJDashboardUserPreference]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJDashboardUserPreference];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJDashboardUserPreference]
    @ID uniqueidentifier = NULL,
    @UserID uniqueidentifier,
    @DashboardID uniqueidentifier,
    @Scope nvarchar(20),
    @ApplicationID uniqueidentifier,
    @DisplayOrder int
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[DashboardUserPreference]
            (
                [ID],
                [UserID],
                [DashboardID],
                [Scope],
                [ApplicationID],
                [DisplayOrder]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @UserID,
                @DashboardID,
                @Scope,
                @ApplicationID,
                @DisplayOrder
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[DashboardUserPreference]
            (
                [UserID],
                [DashboardID],
                [Scope],
                [ApplicationID],
                [DisplayOrder]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @UserID,
                @DashboardID,
                @Scope,
                @ApplicationID,
                @DisplayOrder
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwDashboardUserPreferences] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJDashboardUserPreference] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Dashboard User Preferences */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJDashboardUserPreference] TO [cdp_UI], [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Dashboard User Preferences */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Dashboard User Preferences
-- Item: spUpdateMJDashboardUserPreference
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR DashboardUserPreference
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJDashboardUserPreference]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJDashboardUserPreference];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJDashboardUserPreference]
    @ID uniqueidentifier,
    @UserID uniqueidentifier,
    @DashboardID uniqueidentifier,
    @Scope nvarchar(20),
    @ApplicationID uniqueidentifier,
    @DisplayOrder int
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[DashboardUserPreference]
    SET
        [UserID] = @UserID,
        [DashboardID] = @DashboardID,
        [Scope] = @Scope,
        [ApplicationID] = @ApplicationID,
        [DisplayOrder] = @DisplayOrder
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwDashboardUserPreferences] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwDashboardUserPreferences]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJDashboardUserPreference] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the DashboardUserPreference table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJDashboardUserPreference]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJDashboardUserPreference];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJDashboardUserPreference
ON [${flyway:defaultSchema}].[DashboardUserPreference]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[DashboardUserPreference]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[DashboardUserPreference] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Dashboard User Preferences */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJDashboardUserPreference] TO [cdp_UI], [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Dashboard User Preferences */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Dashboard User Preferences
-- Item: spDeleteMJDashboardUserPreference
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR DashboardUserPreference
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJDashboardUserPreference]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJDashboardUserPreference];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJDashboardUserPreference]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[DashboardUserPreference]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJDashboardUserPreference] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* spDelete Permissions for MJ: Dashboard User Preferences */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJDashboardUserPreference] TO [cdp_UI], [cdp_Developer], [cdp_Integration]



/* Base View SQL for MJ: Dashboard Permissions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Dashboard Permissions
-- Item: vwDashboardPermissions
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Dashboard Permissions
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  DashboardPermission
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwDashboardPermissions]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwDashboardPermissions];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwDashboardPermissions]
AS
SELECT
    m.*,
    MJDashboards_DashboardID.[Name] AS [Dashboard],
    MJUsers_UserID.[Name] AS [User],
    MJUsers_SharedByUserID.[Name] AS [SharedByUser]
FROM
    [${flyway:defaultSchema}].[DashboardPermission] AS m
INNER JOIN
    [${flyway:defaultSchema}].[Dashboard] AS MJDashboards_DashboardID
  ON
    [m].[DashboardID] = MJDashboards_DashboardID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_UserID
  ON
    [m].[UserID] = MJUsers_UserID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_SharedByUserID
  ON
    [m].[SharedByUserID] = MJUsers_SharedByUserID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwDashboardPermissions] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Dashboard Permissions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Dashboard Permissions
-- Item: Permissions for vwDashboardPermissions
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwDashboardPermissions] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Dashboard Permissions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Dashboard Permissions
-- Item: spCreateMJDashboardPermission
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR DashboardPermission
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJDashboardPermission]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJDashboardPermission];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJDashboardPermission]
    @ID uniqueidentifier = NULL,
    @DashboardID uniqueidentifier,
    @UserID uniqueidentifier,
    @CanRead bit = NULL,
    @CanEdit bit = NULL,
    @CanDelete bit = NULL,
    @CanShare bit = NULL,
    @SharedByUserID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[DashboardPermission]
            (
                [ID],
                [DashboardID],
                [UserID],
                [CanRead],
                [CanEdit],
                [CanDelete],
                [CanShare],
                [SharedByUserID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @DashboardID,
                @UserID,
                ISNULL(@CanRead, 1),
                ISNULL(@CanEdit, 0),
                ISNULL(@CanDelete, 0),
                ISNULL(@CanShare, 0),
                @SharedByUserID
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[DashboardPermission]
            (
                [DashboardID],
                [UserID],
                [CanRead],
                [CanEdit],
                [CanDelete],
                [CanShare],
                [SharedByUserID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @DashboardID,
                @UserID,
                ISNULL(@CanRead, 1),
                ISNULL(@CanEdit, 0),
                ISNULL(@CanDelete, 0),
                ISNULL(@CanShare, 0),
                @SharedByUserID
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwDashboardPermissions] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJDashboardPermission] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Dashboard Permissions */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJDashboardPermission] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Dashboard Permissions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Dashboard Permissions
-- Item: spUpdateMJDashboardPermission
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR DashboardPermission
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJDashboardPermission]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJDashboardPermission];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJDashboardPermission]
    @ID uniqueidentifier,
    @DashboardID uniqueidentifier,
    @UserID uniqueidentifier,
    @CanRead bit,
    @CanEdit bit,
    @CanDelete bit,
    @CanShare bit,
    @SharedByUserID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[DashboardPermission]
    SET
        [DashboardID] = @DashboardID,
        [UserID] = @UserID,
        [CanRead] = @CanRead,
        [CanEdit] = @CanEdit,
        [CanDelete] = @CanDelete,
        [CanShare] = @CanShare,
        [SharedByUserID] = @SharedByUserID
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwDashboardPermissions] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwDashboardPermissions]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJDashboardPermission] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the DashboardPermission table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJDashboardPermission]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJDashboardPermission];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJDashboardPermission
ON [${flyway:defaultSchema}].[DashboardPermission]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[DashboardPermission]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[DashboardPermission] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Dashboard Permissions */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJDashboardPermission] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Dashboard Permissions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Dashboard Permissions
-- Item: spDeleteMJDashboardPermission
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR DashboardPermission
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJDashboardPermission]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJDashboardPermission];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJDashboardPermission]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[DashboardPermission]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJDashboardPermission] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Dashboard Permissions */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJDashboardPermission] TO [cdp_Integration]



/* Base View SQL for MJ: Dashboard User States */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Dashboard User States
-- Item: vwDashboardUserStates
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Dashboard User States
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  DashboardUserState
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwDashboardUserStates]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwDashboardUserStates];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwDashboardUserStates]
AS
SELECT
    m.*,
    MJDashboards_DashboardID.[Name] AS [Dashboard],
    MJUsers_UserID.[Name] AS [User]
FROM
    [${flyway:defaultSchema}].[DashboardUserState] AS m
INNER JOIN
    [${flyway:defaultSchema}].[Dashboard] AS MJDashboards_DashboardID
  ON
    [m].[DashboardID] = MJDashboards_DashboardID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_UserID
  ON
    [m].[UserID] = MJUsers_UserID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwDashboardUserStates] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Dashboard User States */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Dashboard User States
-- Item: Permissions for vwDashboardUserStates
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwDashboardUserStates] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Dashboard User States */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Dashboard User States
-- Item: spCreateMJDashboardUserState
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR DashboardUserState
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJDashboardUserState]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJDashboardUserState];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJDashboardUserState]
    @ID uniqueidentifier = NULL,
    @DashboardID uniqueidentifier,
    @UserID uniqueidentifier,
    @UserState nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[DashboardUserState]
            (
                [ID],
                [DashboardID],
                [UserID],
                [UserState]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @DashboardID,
                @UserID,
                @UserState
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[DashboardUserState]
            (
                [DashboardID],
                [UserID],
                [UserState]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @DashboardID,
                @UserID,
                @UserState
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwDashboardUserStates] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJDashboardUserState] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Dashboard User States */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJDashboardUserState] TO [cdp_UI], [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Dashboard User States */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Dashboard User States
-- Item: spUpdateMJDashboardUserState
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR DashboardUserState
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJDashboardUserState]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJDashboardUserState];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJDashboardUserState]
    @ID uniqueidentifier,
    @DashboardID uniqueidentifier,
    @UserID uniqueidentifier,
    @UserState nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[DashboardUserState]
    SET
        [DashboardID] = @DashboardID,
        [UserID] = @UserID,
        [UserState] = @UserState
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwDashboardUserStates] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwDashboardUserStates]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJDashboardUserState] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the DashboardUserState table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJDashboardUserState]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJDashboardUserState];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJDashboardUserState
ON [${flyway:defaultSchema}].[DashboardUserState]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[DashboardUserState]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[DashboardUserState] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Dashboard User States */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJDashboardUserState] TO [cdp_UI], [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Dashboard User States */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Dashboard User States
-- Item: spDeleteMJDashboardUserState
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR DashboardUserState
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJDashboardUserState]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJDashboardUserState];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJDashboardUserState]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[DashboardUserState]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJDashboardUserState] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* spDelete Permissions for MJ: Dashboard User States */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJDashboardUserState] TO [cdp_UI], [cdp_Developer], [cdp_Integration]



/* Base View SQL for MJ: Dataset Items */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Dataset Items
-- Item: vwDatasetItems
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Dataset Items
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  DatasetItem
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwDatasetItems]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwDatasetItems];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwDatasetItems]
AS
SELECT
    m.*,
    MJDatasets_DatasetID.[Name] AS [Dataset],
    MJEntities_EntityID.[Name] AS [Entity]
FROM
    [${flyway:defaultSchema}].[DatasetItem] AS m
INNER JOIN
    [${flyway:defaultSchema}].[Dataset] AS MJDatasets_DatasetID
  ON
    [m].[DatasetID] = MJDatasets_DatasetID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[Entity] AS MJEntities_EntityID
  ON
    [m].[EntityID] = MJEntities_EntityID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwDatasetItems] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Dataset Items */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Dataset Items
-- Item: Permissions for vwDatasetItems
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwDatasetItems] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Dataset Items */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Dataset Items
-- Item: spCreateMJDatasetItem
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR DatasetItem
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJDatasetItem]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJDatasetItem];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJDatasetItem]
    @ID uniqueidentifier = NULL,
    @Code nvarchar(50),
    @DatasetID uniqueidentifier,
    @Sequence int = NULL,
    @EntityID uniqueidentifier,
    @WhereClause nvarchar(MAX),
    @DateFieldToCheck nvarchar(100),
    @Description nvarchar(MAX),
    @Columns nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[DatasetItem]
            (
                [ID],
                [Code],
                [DatasetID],
                [Sequence],
                [EntityID],
                [WhereClause],
                [DateFieldToCheck],
                [Description],
                [Columns]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Code,
                @DatasetID,
                ISNULL(@Sequence, 0),
                @EntityID,
                @WhereClause,
                @DateFieldToCheck,
                @Description,
                @Columns
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[DatasetItem]
            (
                [Code],
                [DatasetID],
                [Sequence],
                [EntityID],
                [WhereClause],
                [DateFieldToCheck],
                [Description],
                [Columns]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Code,
                @DatasetID,
                ISNULL(@Sequence, 0),
                @EntityID,
                @WhereClause,
                @DateFieldToCheck,
                @Description,
                @Columns
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwDatasetItems] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
    

/* spCreate Permissions for MJ: Dataset Items */




/* spUpdate SQL for MJ: Dataset Items */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Dataset Items
-- Item: spUpdateMJDatasetItem
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR DatasetItem
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJDatasetItem]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJDatasetItem];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJDatasetItem]
    @ID uniqueidentifier,
    @Code nvarchar(50),
    @DatasetID uniqueidentifier,
    @Sequence int,
    @EntityID uniqueidentifier,
    @WhereClause nvarchar(MAX),
    @DateFieldToCheck nvarchar(100),
    @Description nvarchar(MAX),
    @Columns nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[DatasetItem]
    SET
        [Code] = @Code,
        [DatasetID] = @DatasetID,
        [Sequence] = @Sequence,
        [EntityID] = @EntityID,
        [WhereClause] = @WhereClause,
        [DateFieldToCheck] = @DateFieldToCheck,
        [Description] = @Description,
        [Columns] = @Columns
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwDatasetItems] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwDatasetItems]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the DatasetItem table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJDatasetItem]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJDatasetItem];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJDatasetItem
ON [${flyway:defaultSchema}].[DatasetItem]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[DatasetItem]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[DatasetItem] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Dataset Items */




/* spDelete SQL for MJ: Dataset Items */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Dataset Items
-- Item: spDeleteMJDatasetItem
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR DatasetItem
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJDatasetItem]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJDatasetItem];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJDatasetItem]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[DatasetItem]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
    

/* spDelete Permissions for MJ: Dataset Items */




/* Base View SQL for MJ: Datasets */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Datasets
-- Item: vwDatasets
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Datasets
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  Dataset
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwDatasets]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwDatasets];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwDatasets]
AS
SELECT
    m.*
FROM
    [${flyway:defaultSchema}].[Dataset] AS m
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwDatasets] TO [cdp_Developer], [cdp_UI], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Datasets */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Datasets
-- Item: Permissions for vwDatasets
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwDatasets] TO [cdp_Developer], [cdp_UI], [cdp_Integration]

/* spCreate SQL for MJ: Datasets */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Datasets
-- Item: spCreateMJDataset
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR Dataset
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJDataset]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJDataset];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJDataset]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(100),
    @Description nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[Dataset]
            (
                [ID],
                [Name],
                [Description]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[Dataset]
            (
                [Name],
                [Description]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwDatasets] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
    

/* spCreate Permissions for MJ: Datasets */




/* spUpdate SQL for MJ: Datasets */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Datasets
-- Item: spUpdateMJDataset
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR Dataset
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJDataset]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJDataset];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJDataset]
    @ID uniqueidentifier,
    @Name nvarchar(100),
    @Description nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[Dataset]
    SET
        [Name] = @Name,
        [Description] = @Description
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwDatasets] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwDatasets]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the Dataset table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJDataset]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJDataset];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJDataset
ON [${flyway:defaultSchema}].[Dataset]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[Dataset]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[Dataset] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Datasets */




/* spDelete SQL for MJ: Datasets */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Datasets
-- Item: spDeleteMJDataset
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR Dataset
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJDataset]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJDataset];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJDataset]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[Dataset]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
    

/* spDelete Permissions for MJ: Datasets */




/* Base View SQL for MJ: Duplicate Run Details */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Duplicate Run Details
-- Item: vwDuplicateRunDetails
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Duplicate Run Details
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  DuplicateRunDetail
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwDuplicateRunDetails]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwDuplicateRunDetails];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwDuplicateRunDetails]
AS
SELECT
    m.*,
    MJDuplicateRuns_DuplicateRunID.[Entity] AS [DuplicateRun]
FROM
    [${flyway:defaultSchema}].[DuplicateRunDetail] AS m
INNER JOIN
    [${flyway:defaultSchema}].[vwDuplicateRuns] AS MJDuplicateRuns_DuplicateRunID
  ON
    [m].[DuplicateRunID] = MJDuplicateRuns_DuplicateRunID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwDuplicateRunDetails] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Duplicate Run Details */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Duplicate Run Details
-- Item: Permissions for vwDuplicateRunDetails
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwDuplicateRunDetails] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Duplicate Run Details */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Duplicate Run Details
-- Item: spCreateMJDuplicateRunDetail
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR DuplicateRunDetail
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJDuplicateRunDetail]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJDuplicateRunDetail];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJDuplicateRunDetail]
    @ID uniqueidentifier = NULL,
    @DuplicateRunID uniqueidentifier,
    @RecordID nvarchar(500),
    @MatchStatus nvarchar(20) = NULL,
    @SkippedReason nvarchar(MAX),
    @MatchErrorMessage nvarchar(MAX),
    @MergeStatus nvarchar(20) = NULL,
    @MergeErrorMessage nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[DuplicateRunDetail]
            (
                [ID],
                [DuplicateRunID],
                [RecordID],
                [MatchStatus],
                [SkippedReason],
                [MatchErrorMessage],
                [MergeStatus],
                [MergeErrorMessage]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @DuplicateRunID,
                @RecordID,
                ISNULL(@MatchStatus, 'Pending'),
                @SkippedReason,
                @MatchErrorMessage,
                ISNULL(@MergeStatus, 'Not Applicable'),
                @MergeErrorMessage
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[DuplicateRunDetail]
            (
                [DuplicateRunID],
                [RecordID],
                [MatchStatus],
                [SkippedReason],
                [MatchErrorMessage],
                [MergeStatus],
                [MergeErrorMessage]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @DuplicateRunID,
                @RecordID,
                ISNULL(@MatchStatus, 'Pending'),
                @SkippedReason,
                @MatchErrorMessage,
                ISNULL(@MergeStatus, 'Not Applicable'),
                @MergeErrorMessage
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwDuplicateRunDetails] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJDuplicateRunDetail] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Duplicate Run Details */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJDuplicateRunDetail] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Duplicate Run Details */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Duplicate Run Details
-- Item: spUpdateMJDuplicateRunDetail
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR DuplicateRunDetail
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJDuplicateRunDetail]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJDuplicateRunDetail];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJDuplicateRunDetail]
    @ID uniqueidentifier,
    @DuplicateRunID uniqueidentifier,
    @RecordID nvarchar(500),
    @MatchStatus nvarchar(20),
    @SkippedReason nvarchar(MAX),
    @MatchErrorMessage nvarchar(MAX),
    @MergeStatus nvarchar(20),
    @MergeErrorMessage nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[DuplicateRunDetail]
    SET
        [DuplicateRunID] = @DuplicateRunID,
        [RecordID] = @RecordID,
        [MatchStatus] = @MatchStatus,
        [SkippedReason] = @SkippedReason,
        [MatchErrorMessage] = @MatchErrorMessage,
        [MergeStatus] = @MergeStatus,
        [MergeErrorMessage] = @MergeErrorMessage
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwDuplicateRunDetails] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwDuplicateRunDetails]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJDuplicateRunDetail] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the DuplicateRunDetail table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJDuplicateRunDetail]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJDuplicateRunDetail];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJDuplicateRunDetail
ON [${flyway:defaultSchema}].[DuplicateRunDetail]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[DuplicateRunDetail]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[DuplicateRunDetail] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Duplicate Run Details */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJDuplicateRunDetail] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Duplicate Run Details */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Duplicate Run Details
-- Item: spDeleteMJDuplicateRunDetail
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR DuplicateRunDetail
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJDuplicateRunDetail]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJDuplicateRunDetail];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJDuplicateRunDetail]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[DuplicateRunDetail]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJDuplicateRunDetail] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Duplicate Run Details */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJDuplicateRunDetail] TO [cdp_Integration]



/* Base View SQL for MJ: Data Contexts */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Data Contexts
-- Item: vwDataContexts
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Data Contexts
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  DataContext
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwDataContexts]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwDataContexts];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwDataContexts]
AS
SELECT
    m.*,
    MJUsers_UserID.[Name] AS [User]
FROM
    [${flyway:defaultSchema}].[DataContext] AS m
INNER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_UserID
  ON
    [m].[UserID] = MJUsers_UserID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwDataContexts] TO [cdp_Integration], [cdp_Developer], [cdp_UI]
    

/* Base View Permissions SQL for MJ: Data Contexts */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Data Contexts
-- Item: Permissions for vwDataContexts
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwDataContexts] TO [cdp_Integration], [cdp_Developer], [cdp_UI]

/* spCreate SQL for MJ: Data Contexts */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Data Contexts
-- Item: spCreateMJDataContext
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR DataContext
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJDataContext]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJDataContext];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJDataContext]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @UserID uniqueidentifier,
    @LastRefreshedAt datetimeoffset
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[DataContext]
            (
                [ID],
                [Name],
                [Description],
                [UserID],
                [LastRefreshedAt]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description,
                @UserID,
                @LastRefreshedAt
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[DataContext]
            (
                [Name],
                [Description],
                [UserID],
                [LastRefreshedAt]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description,
                @UserID,
                @LastRefreshedAt
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwDataContexts] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJDataContext] TO [cdp_Integration], [cdp_Developer], [cdp_UI]
    

/* spCreate Permissions for MJ: Data Contexts */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJDataContext] TO [cdp_Integration], [cdp_Developer], [cdp_UI]



/* spUpdate SQL for MJ: Data Contexts */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Data Contexts
-- Item: spUpdateMJDataContext
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR DataContext
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJDataContext]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJDataContext];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJDataContext]
    @ID uniqueidentifier,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @UserID uniqueidentifier,
    @LastRefreshedAt datetimeoffset
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[DataContext]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [UserID] = @UserID,
        [LastRefreshedAt] = @LastRefreshedAt
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwDataContexts] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwDataContexts]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJDataContext] TO [cdp_Integration], [cdp_Developer], [cdp_UI]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the DataContext table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJDataContext]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJDataContext];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJDataContext
ON [${flyway:defaultSchema}].[DataContext]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[DataContext]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[DataContext] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Data Contexts */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJDataContext] TO [cdp_Integration], [cdp_Developer], [cdp_UI]



/* spDelete SQL for MJ: Data Contexts */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Data Contexts
-- Item: spDeleteMJDataContext
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR DataContext
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJDataContext]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJDataContext];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJDataContext]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[DataContext]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJDataContext] TO [cdp_Integration], [cdp_Developer], [cdp_UI]
    

/* spDelete Permissions for MJ: Data Contexts */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJDataContext] TO [cdp_Integration], [cdp_Developer], [cdp_UI]



/* Base View SQL for MJ: Duplicate Run Detail Matches */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Duplicate Run Detail Matches
-- Item: vwDuplicateRunDetailMatches
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Duplicate Run Detail Matches
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  DuplicateRunDetailMatch
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwDuplicateRunDetailMatches]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwDuplicateRunDetailMatches];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwDuplicateRunDetailMatches]
AS
SELECT
    m.*,
    MJDuplicateRunDetails_DuplicateRunDetailID.[RecordID] AS [DuplicateRunDetail],
    MJRecordMergeLogs_RecordMergeLogID.[SurvivingRecordID] AS [RecordMergeLog]
FROM
    [${flyway:defaultSchema}].[DuplicateRunDetailMatch] AS m
INNER JOIN
    [${flyway:defaultSchema}].[DuplicateRunDetail] AS MJDuplicateRunDetails_DuplicateRunDetailID
  ON
    [m].[DuplicateRunDetailID] = MJDuplicateRunDetails_DuplicateRunDetailID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[RecordMergeLog] AS MJRecordMergeLogs_RecordMergeLogID
  ON
    [m].[RecordMergeLogID] = MJRecordMergeLogs_RecordMergeLogID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwDuplicateRunDetailMatches] TO [cdp_UI], [cdp_Integration], [cdp_Developer]
    

/* Base View Permissions SQL for MJ: Duplicate Run Detail Matches */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Duplicate Run Detail Matches
-- Item: Permissions for vwDuplicateRunDetailMatches
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwDuplicateRunDetailMatches] TO [cdp_UI], [cdp_Integration], [cdp_Developer]

/* spCreate SQL for MJ: Duplicate Run Detail Matches */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Duplicate Run Detail Matches
-- Item: spCreateMJDuplicateRunDetailMatch
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR DuplicateRunDetailMatch
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJDuplicateRunDetailMatch]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJDuplicateRunDetailMatch];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJDuplicateRunDetailMatch]
    @ID uniqueidentifier = NULL,
    @DuplicateRunDetailID uniqueidentifier,
    @MatchSource nvarchar(20) = NULL,
    @MatchRecordID nvarchar(500),
    @MatchProbability numeric(12, 11) = NULL,
    @MatchedAt datetimeoffset = NULL,
    @Action nvarchar(20) = NULL,
    @ApprovalStatus nvarchar(20) = NULL,
    @RecordMergeLogID uniqueidentifier,
    @MergeStatus nvarchar(20) = NULL,
    @MergedAt datetimeoffset = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[DuplicateRunDetailMatch]
            (
                [ID],
                [DuplicateRunDetailID],
                [MatchSource],
                [MatchRecordID],
                [MatchProbability],
                [MatchedAt],
                [Action],
                [ApprovalStatus],
                [RecordMergeLogID],
                [MergeStatus],
                [MergedAt]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @DuplicateRunDetailID,
                ISNULL(@MatchSource, 'Vector'),
                @MatchRecordID,
                ISNULL(@MatchProbability, 0),
                ISNULL(@MatchedAt, sysdatetimeoffset()),
                ISNULL(@Action, 'Ignore'),
                ISNULL(@ApprovalStatus, 'Pending'),
                @RecordMergeLogID,
                ISNULL(@MergeStatus, 'Pending'),
                ISNULL(@MergedAt, sysdatetimeoffset())
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[DuplicateRunDetailMatch]
            (
                [DuplicateRunDetailID],
                [MatchSource],
                [MatchRecordID],
                [MatchProbability],
                [MatchedAt],
                [Action],
                [ApprovalStatus],
                [RecordMergeLogID],
                [MergeStatus],
                [MergedAt]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @DuplicateRunDetailID,
                ISNULL(@MatchSource, 'Vector'),
                @MatchRecordID,
                ISNULL(@MatchProbability, 0),
                ISNULL(@MatchedAt, sysdatetimeoffset()),
                ISNULL(@Action, 'Ignore'),
                ISNULL(@ApprovalStatus, 'Pending'),
                @RecordMergeLogID,
                ISNULL(@MergeStatus, 'Pending'),
                ISNULL(@MergedAt, sysdatetimeoffset())
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwDuplicateRunDetailMatches] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJDuplicateRunDetailMatch] TO [cdp_Integration], [cdp_Developer]
    

/* spCreate Permissions for MJ: Duplicate Run Detail Matches */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJDuplicateRunDetailMatch] TO [cdp_Integration], [cdp_Developer]



/* spUpdate SQL for MJ: Duplicate Run Detail Matches */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Duplicate Run Detail Matches
-- Item: spUpdateMJDuplicateRunDetailMatch
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR DuplicateRunDetailMatch
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJDuplicateRunDetailMatch]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJDuplicateRunDetailMatch];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJDuplicateRunDetailMatch]
    @ID uniqueidentifier,
    @DuplicateRunDetailID uniqueidentifier,
    @MatchSource nvarchar(20),
    @MatchRecordID nvarchar(500),
    @MatchProbability numeric(12, 11),
    @MatchedAt datetimeoffset,
    @Action nvarchar(20),
    @ApprovalStatus nvarchar(20),
    @RecordMergeLogID uniqueidentifier,
    @MergeStatus nvarchar(20),
    @MergedAt datetimeoffset
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[DuplicateRunDetailMatch]
    SET
        [DuplicateRunDetailID] = @DuplicateRunDetailID,
        [MatchSource] = @MatchSource,
        [MatchRecordID] = @MatchRecordID,
        [MatchProbability] = @MatchProbability,
        [MatchedAt] = @MatchedAt,
        [Action] = @Action,
        [ApprovalStatus] = @ApprovalStatus,
        [RecordMergeLogID] = @RecordMergeLogID,
        [MergeStatus] = @MergeStatus,
        [MergedAt] = @MergedAt
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwDuplicateRunDetailMatches] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwDuplicateRunDetailMatches]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJDuplicateRunDetailMatch] TO [cdp_Integration], [cdp_Developer]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the DuplicateRunDetailMatch table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJDuplicateRunDetailMatch]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJDuplicateRunDetailMatch];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJDuplicateRunDetailMatch
ON [${flyway:defaultSchema}].[DuplicateRunDetailMatch]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[DuplicateRunDetailMatch]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[DuplicateRunDetailMatch] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Duplicate Run Detail Matches */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJDuplicateRunDetailMatch] TO [cdp_Integration], [cdp_Developer]



/* spDelete SQL for MJ: Duplicate Run Detail Matches */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Duplicate Run Detail Matches
-- Item: spDeleteMJDuplicateRunDetailMatch
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR DuplicateRunDetailMatch
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJDuplicateRunDetailMatch]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJDuplicateRunDetailMatch];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJDuplicateRunDetailMatch]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[DuplicateRunDetailMatch]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJDuplicateRunDetailMatch] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Duplicate Run Detail Matches */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJDuplicateRunDetailMatch] TO [cdp_Integration]



/* Base View SQL for MJ: Employee Roles */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Employee Roles
-- Item: vwEmployeeRoles
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Employee Roles
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  EmployeeRole
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwEmployeeRoles]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwEmployeeRoles];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwEmployeeRoles]
AS
SELECT
    m.*,
    MJEmployees_EmployeeID.[FirstLast] AS [Employee],
    MJRoles_RoleID.[Name] AS [Role]
FROM
    [${flyway:defaultSchema}].[EmployeeRole] AS m
INNER JOIN
    [${flyway:defaultSchema}].[vwEmployees] AS MJEmployees_EmployeeID
  ON
    [m].[EmployeeID] = MJEmployees_EmployeeID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[Role] AS MJRoles_RoleID
  ON
    [m].[RoleID] = MJRoles_RoleID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwEmployeeRoles] TO [cdp_UI], [cdp_Integration], [cdp_Developer]
    

/* Base View Permissions SQL for MJ: Employee Roles */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Employee Roles
-- Item: Permissions for vwEmployeeRoles
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwEmployeeRoles] TO [cdp_UI], [cdp_Integration], [cdp_Developer]

/* spCreate SQL for MJ: Employee Roles */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Employee Roles
-- Item: spCreateMJEmployeeRole
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR EmployeeRole
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJEmployeeRole]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJEmployeeRole];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJEmployeeRole]
    @ID uniqueidentifier = NULL,
    @EmployeeID uniqueidentifier,
    @RoleID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[EmployeeRole]
            (
                [ID],
                [EmployeeID],
                [RoleID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @EmployeeID,
                @RoleID
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[EmployeeRole]
            (
                [EmployeeID],
                [RoleID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @EmployeeID,
                @RoleID
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwEmployeeRoles] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJEmployeeRole] TO [cdp_Integration], [cdp_Developer]
    

/* spCreate Permissions for MJ: Employee Roles */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJEmployeeRole] TO [cdp_Integration], [cdp_Developer]



/* spUpdate SQL for MJ: Employee Roles */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Employee Roles
-- Item: spUpdateMJEmployeeRole
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR EmployeeRole
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJEmployeeRole]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJEmployeeRole];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJEmployeeRole]
    @ID uniqueidentifier,
    @EmployeeID uniqueidentifier,
    @RoleID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[EmployeeRole]
    SET
        [EmployeeID] = @EmployeeID,
        [RoleID] = @RoleID
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwEmployeeRoles] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwEmployeeRoles]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJEmployeeRole] TO [cdp_Integration], [cdp_Developer]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the EmployeeRole table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJEmployeeRole]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJEmployeeRole];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJEmployeeRole
ON [${flyway:defaultSchema}].[EmployeeRole]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[EmployeeRole]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[EmployeeRole] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Employee Roles */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJEmployeeRole] TO [cdp_Integration], [cdp_Developer]



/* spDelete SQL for MJ: Employee Roles */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Employee Roles
-- Item: spDeleteMJEmployeeRole
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR EmployeeRole
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJEmployeeRole]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJEmployeeRole];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJEmployeeRole]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[EmployeeRole]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJEmployeeRole] TO [cdp_Integration], [cdp_Developer]
    

/* spDelete Permissions for MJ: Employee Roles */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJEmployeeRole] TO [cdp_Integration], [cdp_Developer]



/* Base View SQL for MJ: Employee Skills */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Employee Skills
-- Item: vwEmployeeSkills
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Employee Skills
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  EmployeeSkill
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwEmployeeSkills]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwEmployeeSkills];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwEmployeeSkills]
AS
SELECT
    m.*,
    MJEmployees_EmployeeID.[FirstLast] AS [Employee],
    MJSkills_SkillID.[Name] AS [Skill]
FROM
    [${flyway:defaultSchema}].[EmployeeSkill] AS m
INNER JOIN
    [${flyway:defaultSchema}].[vwEmployees] AS MJEmployees_EmployeeID
  ON
    [m].[EmployeeID] = MJEmployees_EmployeeID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[Skill] AS MJSkills_SkillID
  ON
    [m].[SkillID] = MJSkills_SkillID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwEmployeeSkills] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Employee Skills */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Employee Skills
-- Item: Permissions for vwEmployeeSkills
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwEmployeeSkills] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Employee Skills */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Employee Skills
-- Item: spCreateMJEmployeeSkill
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR EmployeeSkill
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJEmployeeSkill]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJEmployeeSkill];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJEmployeeSkill]
    @ID uniqueidentifier = NULL,
    @EmployeeID uniqueidentifier,
    @SkillID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[EmployeeSkill]
            (
                [ID],
                [EmployeeID],
                [SkillID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @EmployeeID,
                @SkillID
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[EmployeeSkill]
            (
                [EmployeeID],
                [SkillID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @EmployeeID,
                @SkillID
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwEmployeeSkills] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJEmployeeSkill] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Employee Skills */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJEmployeeSkill] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Employee Skills */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Employee Skills
-- Item: spUpdateMJEmployeeSkill
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR EmployeeSkill
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJEmployeeSkill]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJEmployeeSkill];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJEmployeeSkill]
    @ID uniqueidentifier,
    @EmployeeID uniqueidentifier,
    @SkillID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[EmployeeSkill]
    SET
        [EmployeeID] = @EmployeeID,
        [SkillID] = @SkillID
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwEmployeeSkills] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwEmployeeSkills]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJEmployeeSkill] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the EmployeeSkill table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJEmployeeSkill]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJEmployeeSkill];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJEmployeeSkill
ON [${flyway:defaultSchema}].[EmployeeSkill]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[EmployeeSkill]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[EmployeeSkill] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Employee Skills */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJEmployeeSkill] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Employee Skills */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Employee Skills
-- Item: spDeleteMJEmployeeSkill
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR EmployeeSkill
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJEmployeeSkill]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJEmployeeSkill];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJEmployeeSkill]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[EmployeeSkill]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJEmployeeSkill] TO [cdp_Developer], [cdp_Integration]
    

/* spDelete Permissions for MJ: Employee Skills */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJEmployeeSkill] TO [cdp_Developer], [cdp_Integration]



/* Base View SQL for MJ: Employee Company Integrations */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Employee Company Integrations
-- Item: vwEmployeeCompanyIntegrations
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Employee Company Integrations
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  EmployeeCompanyIntegration
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwEmployeeCompanyIntegrations]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwEmployeeCompanyIntegrations];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwEmployeeCompanyIntegrations]
AS
SELECT
    m.*,
    MJEmployees_EmployeeID.[FirstLast] AS [Employee],
    MJCompanyIntegrations_CompanyIntegrationID.[Name] AS [CompanyIntegration]
FROM
    [${flyway:defaultSchema}].[EmployeeCompanyIntegration] AS m
INNER JOIN
    [${flyway:defaultSchema}].[vwEmployees] AS MJEmployees_EmployeeID
  ON
    [m].[EmployeeID] = MJEmployees_EmployeeID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[CompanyIntegration] AS MJCompanyIntegrations_CompanyIntegrationID
  ON
    [m].[CompanyIntegrationID] = MJCompanyIntegrations_CompanyIntegrationID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwEmployeeCompanyIntegrations] TO [cdp_Developer], [cdp_UI], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Employee Company Integrations */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Employee Company Integrations
-- Item: Permissions for vwEmployeeCompanyIntegrations
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwEmployeeCompanyIntegrations] TO [cdp_Developer], [cdp_UI], [cdp_Integration]

/* spCreate SQL for MJ: Employee Company Integrations */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Employee Company Integrations
-- Item: spCreateMJEmployeeCompanyIntegration
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR EmployeeCompanyIntegration
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJEmployeeCompanyIntegration]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJEmployeeCompanyIntegration];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJEmployeeCompanyIntegration]
    @ID uniqueidentifier = NULL,
    @EmployeeID uniqueidentifier,
    @CompanyIntegrationID uniqueidentifier,
    @ExternalSystemRecordID nvarchar(750),
    @IsActive bit = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[EmployeeCompanyIntegration]
            (
                [ID],
                [EmployeeID],
                [CompanyIntegrationID],
                [ExternalSystemRecordID],
                [IsActive]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @EmployeeID,
                @CompanyIntegrationID,
                @ExternalSystemRecordID,
                ISNULL(@IsActive, 1)
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[EmployeeCompanyIntegration]
            (
                [EmployeeID],
                [CompanyIntegrationID],
                [ExternalSystemRecordID],
                [IsActive]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @EmployeeID,
                @CompanyIntegrationID,
                @ExternalSystemRecordID,
                ISNULL(@IsActive, 1)
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwEmployeeCompanyIntegrations] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJEmployeeCompanyIntegration] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Employee Company Integrations */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJEmployeeCompanyIntegration] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Employee Company Integrations */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Employee Company Integrations
-- Item: spUpdateMJEmployeeCompanyIntegration
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR EmployeeCompanyIntegration
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJEmployeeCompanyIntegration]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJEmployeeCompanyIntegration];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJEmployeeCompanyIntegration]
    @ID uniqueidentifier,
    @EmployeeID uniqueidentifier,
    @CompanyIntegrationID uniqueidentifier,
    @ExternalSystemRecordID nvarchar(750),
    @IsActive bit
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[EmployeeCompanyIntegration]
    SET
        [EmployeeID] = @EmployeeID,
        [CompanyIntegrationID] = @CompanyIntegrationID,
        [ExternalSystemRecordID] = @ExternalSystemRecordID,
        [IsActive] = @IsActive
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwEmployeeCompanyIntegrations] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwEmployeeCompanyIntegrations]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJEmployeeCompanyIntegration] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the EmployeeCompanyIntegration table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJEmployeeCompanyIntegration]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJEmployeeCompanyIntegration];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJEmployeeCompanyIntegration
ON [${flyway:defaultSchema}].[EmployeeCompanyIntegration]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[EmployeeCompanyIntegration]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[EmployeeCompanyIntegration] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Employee Company Integrations */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJEmployeeCompanyIntegration] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Employee Company Integrations */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Employee Company Integrations
-- Item: spDeleteMJEmployeeCompanyIntegration
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR EmployeeCompanyIntegration
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJEmployeeCompanyIntegration]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJEmployeeCompanyIntegration];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJEmployeeCompanyIntegration]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[EmployeeCompanyIntegration]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJEmployeeCompanyIntegration] TO [cdp_Developer], [cdp_Integration]
    

/* spDelete Permissions for MJ: Employee Company Integrations */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJEmployeeCompanyIntegration] TO [cdp_Developer], [cdp_Integration]



/* Base View SQL for MJ: Duplicate Runs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Duplicate Runs
-- Item: vwDuplicateRuns
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Duplicate Runs
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  DuplicateRun
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwDuplicateRuns]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwDuplicateRuns];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwDuplicateRuns]
AS
SELECT
    m.*,
    MJEntities_EntityID.[Name] AS [Entity],
    MJUsers_StartedByUserID.[Name] AS [StartedByUser],
    MJLists_SourceListID.[Name] AS [SourceList],
    MJUsers_ApprovedByUserID.[Name] AS [ApprovedByUser]
FROM
    [${flyway:defaultSchema}].[DuplicateRun] AS m
INNER JOIN
    [${flyway:defaultSchema}].[Entity] AS MJEntities_EntityID
  ON
    [m].[EntityID] = MJEntities_EntityID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_StartedByUserID
  ON
    [m].[StartedByUserID] = MJUsers_StartedByUserID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[List] AS MJLists_SourceListID
  ON
    [m].[SourceListID] = MJLists_SourceListID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_ApprovedByUserID
  ON
    [m].[ApprovedByUserID] = MJUsers_ApprovedByUserID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwDuplicateRuns] TO [cdp_Developer], [cdp_UI], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Duplicate Runs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Duplicate Runs
-- Item: Permissions for vwDuplicateRuns
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwDuplicateRuns] TO [cdp_Developer], [cdp_UI], [cdp_Integration]

/* spCreate SQL for MJ: Duplicate Runs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Duplicate Runs
-- Item: spCreateMJDuplicateRun
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR DuplicateRun
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJDuplicateRun]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJDuplicateRun];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJDuplicateRun]
    @ID uniqueidentifier = NULL,
    @EntityID uniqueidentifier,
    @StartedByUserID uniqueidentifier,
    @SourceListID uniqueidentifier,
    @StartedAt datetimeoffset = NULL,
    @EndedAt datetimeoffset,
    @ApprovalStatus nvarchar(20) = NULL,
    @ApprovalComments nvarchar(MAX),
    @ApprovedByUserID uniqueidentifier,
    @ProcessingStatus nvarchar(20) = NULL,
    @ProcessingErrorMessage nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[DuplicateRun]
            (
                [ID],
                [EntityID],
                [StartedByUserID],
                [SourceListID],
                [StartedAt],
                [EndedAt],
                [ApprovalStatus],
                [ApprovalComments],
                [ApprovedByUserID],
                [ProcessingStatus],
                [ProcessingErrorMessage]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @EntityID,
                @StartedByUserID,
                @SourceListID,
                ISNULL(@StartedAt, sysdatetimeoffset()),
                @EndedAt,
                ISNULL(@ApprovalStatus, 'Pending'),
                @ApprovalComments,
                @ApprovedByUserID,
                ISNULL(@ProcessingStatus, 'Pending'),
                @ProcessingErrorMessage
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[DuplicateRun]
            (
                [EntityID],
                [StartedByUserID],
                [SourceListID],
                [StartedAt],
                [EndedAt],
                [ApprovalStatus],
                [ApprovalComments],
                [ApprovedByUserID],
                [ProcessingStatus],
                [ProcessingErrorMessage]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @EntityID,
                @StartedByUserID,
                @SourceListID,
                ISNULL(@StartedAt, sysdatetimeoffset()),
                @EndedAt,
                ISNULL(@ApprovalStatus, 'Pending'),
                @ApprovalComments,
                @ApprovedByUserID,
                ISNULL(@ProcessingStatus, 'Pending'),
                @ProcessingErrorMessage
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwDuplicateRuns] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJDuplicateRun] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Duplicate Runs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJDuplicateRun] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Duplicate Runs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Duplicate Runs
-- Item: spUpdateMJDuplicateRun
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR DuplicateRun
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJDuplicateRun]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJDuplicateRun];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJDuplicateRun]
    @ID uniqueidentifier,
    @EntityID uniqueidentifier,
    @StartedByUserID uniqueidentifier,
    @SourceListID uniqueidentifier,
    @StartedAt datetimeoffset,
    @EndedAt datetimeoffset,
    @ApprovalStatus nvarchar(20),
    @ApprovalComments nvarchar(MAX),
    @ApprovedByUserID uniqueidentifier,
    @ProcessingStatus nvarchar(20),
    @ProcessingErrorMessage nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[DuplicateRun]
    SET
        [EntityID] = @EntityID,
        [StartedByUserID] = @StartedByUserID,
        [SourceListID] = @SourceListID,
        [StartedAt] = @StartedAt,
        [EndedAt] = @EndedAt,
        [ApprovalStatus] = @ApprovalStatus,
        [ApprovalComments] = @ApprovalComments,
        [ApprovedByUserID] = @ApprovedByUserID,
        [ProcessingStatus] = @ProcessingStatus,
        [ProcessingErrorMessage] = @ProcessingErrorMessage
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwDuplicateRuns] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwDuplicateRuns]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJDuplicateRun] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the DuplicateRun table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJDuplicateRun]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJDuplicateRun];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJDuplicateRun
ON [${flyway:defaultSchema}].[DuplicateRun]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[DuplicateRun]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[DuplicateRun] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Duplicate Runs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJDuplicateRun] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Duplicate Runs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Duplicate Runs
-- Item: spDeleteMJDuplicateRun
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR DuplicateRun
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJDuplicateRun]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJDuplicateRun];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJDuplicateRun]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[DuplicateRun]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJDuplicateRun] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Duplicate Runs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJDuplicateRun] TO [cdp_Integration]



/* Base View SQL for MJ: Encryption Algorithms */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Encryption Algorithms
-- Item: vwEncryptionAlgorithms
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Encryption Algorithms
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  EncryptionAlgorithm
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwEncryptionAlgorithms]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwEncryptionAlgorithms];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwEncryptionAlgorithms]
AS
SELECT
    m.*
FROM
    [${flyway:defaultSchema}].[EncryptionAlgorithm] AS m
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwEncryptionAlgorithms] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Encryption Algorithms */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Encryption Algorithms
-- Item: Permissions for vwEncryptionAlgorithms
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwEncryptionAlgorithms] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Encryption Algorithms */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Encryption Algorithms
-- Item: spCreateMJEncryptionAlgorithm
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR EncryptionAlgorithm
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJEncryptionAlgorithm]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJEncryptionAlgorithm];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJEncryptionAlgorithm]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(50),
    @Description nvarchar(MAX),
    @NodeCryptoName nvarchar(50),
    @KeyLengthBits int,
    @IVLengthBytes int,
    @IsAEAD bit = NULL,
    @IsActive bit = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[EncryptionAlgorithm]
            (
                [ID],
                [Name],
                [Description],
                [NodeCryptoName],
                [KeyLengthBits],
                [IVLengthBytes],
                [IsAEAD],
                [IsActive]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description,
                @NodeCryptoName,
                @KeyLengthBits,
                @IVLengthBytes,
                ISNULL(@IsAEAD, 0),
                ISNULL(@IsActive, 1)
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[EncryptionAlgorithm]
            (
                [Name],
                [Description],
                [NodeCryptoName],
                [KeyLengthBits],
                [IVLengthBytes],
                [IsAEAD],
                [IsActive]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description,
                @NodeCryptoName,
                @KeyLengthBits,
                @IVLengthBytes,
                ISNULL(@IsAEAD, 0),
                ISNULL(@IsActive, 1)
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwEncryptionAlgorithms] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJEncryptionAlgorithm] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Encryption Algorithms */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJEncryptionAlgorithm] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Encryption Algorithms */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Encryption Algorithms
-- Item: spUpdateMJEncryptionAlgorithm
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR EncryptionAlgorithm
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJEncryptionAlgorithm]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJEncryptionAlgorithm];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJEncryptionAlgorithm]
    @ID uniqueidentifier,
    @Name nvarchar(50),
    @Description nvarchar(MAX),
    @NodeCryptoName nvarchar(50),
    @KeyLengthBits int,
    @IVLengthBytes int,
    @IsAEAD bit,
    @IsActive bit
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[EncryptionAlgorithm]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [NodeCryptoName] = @NodeCryptoName,
        [KeyLengthBits] = @KeyLengthBits,
        [IVLengthBytes] = @IVLengthBytes,
        [IsAEAD] = @IsAEAD,
        [IsActive] = @IsActive
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwEncryptionAlgorithms] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwEncryptionAlgorithms]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJEncryptionAlgorithm] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the EncryptionAlgorithm table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJEncryptionAlgorithm]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJEncryptionAlgorithm];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJEncryptionAlgorithm
ON [${flyway:defaultSchema}].[EncryptionAlgorithm]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[EncryptionAlgorithm]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[EncryptionAlgorithm] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Encryption Algorithms */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJEncryptionAlgorithm] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Encryption Algorithms */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Encryption Algorithms
-- Item: spDeleteMJEncryptionAlgorithm
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR EncryptionAlgorithm
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJEncryptionAlgorithm]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJEncryptionAlgorithm];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJEncryptionAlgorithm]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[EncryptionAlgorithm]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJEncryptionAlgorithm] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Encryption Algorithms */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJEncryptionAlgorithm] TO [cdp_Integration]



/* Base View SQL for MJ: Encryption Key Sources */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Encryption Key Sources
-- Item: vwEncryptionKeySources
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Encryption Key Sources
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  EncryptionKeySource
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwEncryptionKeySources]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwEncryptionKeySources];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwEncryptionKeySources]
AS
SELECT
    m.*
FROM
    [${flyway:defaultSchema}].[EncryptionKeySource] AS m
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwEncryptionKeySources] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Encryption Key Sources */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Encryption Key Sources
-- Item: Permissions for vwEncryptionKeySources
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwEncryptionKeySources] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Encryption Key Sources */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Encryption Key Sources
-- Item: spCreateMJEncryptionKeySource
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR EncryptionKeySource
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJEncryptionKeySource]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJEncryptionKeySource];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJEncryptionKeySource]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(100),
    @Description nvarchar(MAX),
    @DriverClass nvarchar(255),
    @DriverImportPath nvarchar(500),
    @ConfigTemplate nvarchar(MAX),
    @IsActive bit = NULL,
    @Status nvarchar(20) = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[EncryptionKeySource]
            (
                [ID],
                [Name],
                [Description],
                [DriverClass],
                [DriverImportPath],
                [ConfigTemplate],
                [IsActive],
                [Status]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description,
                @DriverClass,
                @DriverImportPath,
                @ConfigTemplate,
                ISNULL(@IsActive, 1),
                ISNULL(@Status, 'Active')
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[EncryptionKeySource]
            (
                [Name],
                [Description],
                [DriverClass],
                [DriverImportPath],
                [ConfigTemplate],
                [IsActive],
                [Status]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description,
                @DriverClass,
                @DriverImportPath,
                @ConfigTemplate,
                ISNULL(@IsActive, 1),
                ISNULL(@Status, 'Active')
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwEncryptionKeySources] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJEncryptionKeySource] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Encryption Key Sources */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJEncryptionKeySource] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Encryption Key Sources */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Encryption Key Sources
-- Item: spUpdateMJEncryptionKeySource
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR EncryptionKeySource
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJEncryptionKeySource]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJEncryptionKeySource];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJEncryptionKeySource]
    @ID uniqueidentifier,
    @Name nvarchar(100),
    @Description nvarchar(MAX),
    @DriverClass nvarchar(255),
    @DriverImportPath nvarchar(500),
    @ConfigTemplate nvarchar(MAX),
    @IsActive bit,
    @Status nvarchar(20)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[EncryptionKeySource]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [DriverClass] = @DriverClass,
        [DriverImportPath] = @DriverImportPath,
        [ConfigTemplate] = @ConfigTemplate,
        [IsActive] = @IsActive,
        [Status] = @Status
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwEncryptionKeySources] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwEncryptionKeySources]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJEncryptionKeySource] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the EncryptionKeySource table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJEncryptionKeySource]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJEncryptionKeySource];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJEncryptionKeySource
ON [${flyway:defaultSchema}].[EncryptionKeySource]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[EncryptionKeySource]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[EncryptionKeySource] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Encryption Key Sources */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJEncryptionKeySource] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Encryption Key Sources */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Encryption Key Sources
-- Item: spDeleteMJEncryptionKeySource
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR EncryptionKeySource
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJEncryptionKeySource]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJEncryptionKeySource];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJEncryptionKeySource]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[EncryptionKeySource]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJEncryptionKeySource] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Encryption Key Sources */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJEncryptionKeySource] TO [cdp_Integration]



/* Base View SQL for MJ: Entity Action Filters */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Action Filters
-- Item: vwEntityActionFilters
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Entity Action Filters
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  EntityActionFilter
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwEntityActionFilters]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwEntityActionFilters];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwEntityActionFilters]
AS
SELECT
    m.*,
    MJEntityActions_EntityActionID.[Action] AS [EntityAction],
    MJActionFilters_ActionFilterID.[UserDescription] AS [ActionFilter]
FROM
    [${flyway:defaultSchema}].[EntityActionFilter] AS m
INNER JOIN
    [${flyway:defaultSchema}].[vwEntityActions] AS MJEntityActions_EntityActionID
  ON
    [m].[EntityActionID] = MJEntityActions_EntityActionID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[ActionFilter] AS MJActionFilters_ActionFilterID
  ON
    [m].[ActionFilterID] = MJActionFilters_ActionFilterID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwEntityActionFilters] TO [cdp_Integration], [cdp_UI], [cdp_Developer]
    

/* Base View Permissions SQL for MJ: Entity Action Filters */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Action Filters
-- Item: Permissions for vwEntityActionFilters
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwEntityActionFilters] TO [cdp_Integration], [cdp_UI], [cdp_Developer]

/* spCreate SQL for MJ: Entity Action Filters */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Action Filters
-- Item: spCreateMJEntityActionFilter
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR EntityActionFilter
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJEntityActionFilter]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJEntityActionFilter];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJEntityActionFilter]
    @ID uniqueidentifier = NULL,
    @EntityActionID uniqueidentifier,
    @ActionFilterID uniqueidentifier,
    @Sequence int,
    @Status nvarchar(20) = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[EntityActionFilter]
            (
                [ID],
                [EntityActionID],
                [ActionFilterID],
                [Sequence],
                [Status]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @EntityActionID,
                @ActionFilterID,
                @Sequence,
                ISNULL(@Status, 'Pending')
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[EntityActionFilter]
            (
                [EntityActionID],
                [ActionFilterID],
                [Sequence],
                [Status]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @EntityActionID,
                @ActionFilterID,
                @Sequence,
                ISNULL(@Status, 'Pending')
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwEntityActionFilters] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJEntityActionFilter] TO [cdp_Integration], [cdp_Developer]
    

/* spCreate Permissions for MJ: Entity Action Filters */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJEntityActionFilter] TO [cdp_Integration], [cdp_Developer]



/* spUpdate SQL for MJ: Entity Action Filters */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Action Filters
-- Item: spUpdateMJEntityActionFilter
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR EntityActionFilter
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJEntityActionFilter]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJEntityActionFilter];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJEntityActionFilter]
    @ID uniqueidentifier,
    @EntityActionID uniqueidentifier,
    @ActionFilterID uniqueidentifier,
    @Sequence int,
    @Status nvarchar(20)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[EntityActionFilter]
    SET
        [EntityActionID] = @EntityActionID,
        [ActionFilterID] = @ActionFilterID,
        [Sequence] = @Sequence,
        [Status] = @Status
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwEntityActionFilters] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwEntityActionFilters]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJEntityActionFilter] TO [cdp_Integration], [cdp_Developer]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the EntityActionFilter table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJEntityActionFilter]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJEntityActionFilter];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJEntityActionFilter
ON [${flyway:defaultSchema}].[EntityActionFilter]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[EntityActionFilter]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[EntityActionFilter] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Entity Action Filters */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJEntityActionFilter] TO [cdp_Integration], [cdp_Developer]



/* spDelete SQL for MJ: Entity Action Filters */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Action Filters
-- Item: spDeleteMJEntityActionFilter
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR EntityActionFilter
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJEntityActionFilter]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJEntityActionFilter];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJEntityActionFilter]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[EntityActionFilter]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJEntityActionFilter] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Entity Action Filters */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJEntityActionFilter] TO [cdp_Integration]



/* Base View SQL for MJ: Encryption Keys */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Encryption Keys
-- Item: vwEncryptionKeys
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Encryption Keys
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  EncryptionKey
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwEncryptionKeys]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwEncryptionKeys];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwEncryptionKeys]
AS
SELECT
    m.*,
    MJEncryptionKeySources_EncryptionKeySourceID.[Name] AS [EncryptionKeySource],
    MJEncryptionAlgorithms_EncryptionAlgorithmID.[Name] AS [EncryptionAlgorithm]
FROM
    [${flyway:defaultSchema}].[EncryptionKey] AS m
INNER JOIN
    [${flyway:defaultSchema}].[EncryptionKeySource] AS MJEncryptionKeySources_EncryptionKeySourceID
  ON
    [m].[EncryptionKeySourceID] = MJEncryptionKeySources_EncryptionKeySourceID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[EncryptionAlgorithm] AS MJEncryptionAlgorithms_EncryptionAlgorithmID
  ON
    [m].[EncryptionAlgorithmID] = MJEncryptionAlgorithms_EncryptionAlgorithmID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwEncryptionKeys] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Encryption Keys */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Encryption Keys
-- Item: Permissions for vwEncryptionKeys
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwEncryptionKeys] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Encryption Keys */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Encryption Keys
-- Item: spCreateMJEncryptionKey
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR EncryptionKey
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJEncryptionKey]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJEncryptionKey];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJEncryptionKey]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(100),
    @Description nvarchar(MAX),
    @EncryptionKeySourceID uniqueidentifier,
    @EncryptionAlgorithmID uniqueidentifier,
    @KeyLookupValue nvarchar(500),
    @KeyVersion nvarchar(20) = NULL,
    @Marker nvarchar(20) = NULL,
    @IsActive bit = NULL,
    @Status nvarchar(20) = NULL,
    @ActivatedAt datetimeoffset,
    @ExpiresAt datetimeoffset
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[EncryptionKey]
            (
                [ID],
                [Name],
                [Description],
                [EncryptionKeySourceID],
                [EncryptionAlgorithmID],
                [KeyLookupValue],
                [KeyVersion],
                [Marker],
                [IsActive],
                [Status],
                [ActivatedAt],
                [ExpiresAt]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description,
                @EncryptionKeySourceID,
                @EncryptionAlgorithmID,
                @KeyLookupValue,
                ISNULL(@KeyVersion, '1'),
                ISNULL(@Marker, '$ENC$'),
                ISNULL(@IsActive, 1),
                ISNULL(@Status, 'Active'),
                @ActivatedAt,
                @ExpiresAt
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[EncryptionKey]
            (
                [Name],
                [Description],
                [EncryptionKeySourceID],
                [EncryptionAlgorithmID],
                [KeyLookupValue],
                [KeyVersion],
                [Marker],
                [IsActive],
                [Status],
                [ActivatedAt],
                [ExpiresAt]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description,
                @EncryptionKeySourceID,
                @EncryptionAlgorithmID,
                @KeyLookupValue,
                ISNULL(@KeyVersion, '1'),
                ISNULL(@Marker, '$ENC$'),
                ISNULL(@IsActive, 1),
                ISNULL(@Status, 'Active'),
                @ActivatedAt,
                @ExpiresAt
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwEncryptionKeys] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJEncryptionKey] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Encryption Keys */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJEncryptionKey] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Encryption Keys */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Encryption Keys
-- Item: spUpdateMJEncryptionKey
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR EncryptionKey
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJEncryptionKey]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJEncryptionKey];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJEncryptionKey]
    @ID uniqueidentifier,
    @Name nvarchar(100),
    @Description nvarchar(MAX),
    @EncryptionKeySourceID uniqueidentifier,
    @EncryptionAlgorithmID uniqueidentifier,
    @KeyLookupValue nvarchar(500),
    @KeyVersion nvarchar(20),
    @Marker nvarchar(20),
    @IsActive bit,
    @Status nvarchar(20),
    @ActivatedAt datetimeoffset,
    @ExpiresAt datetimeoffset
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[EncryptionKey]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [EncryptionKeySourceID] = @EncryptionKeySourceID,
        [EncryptionAlgorithmID] = @EncryptionAlgorithmID,
        [KeyLookupValue] = @KeyLookupValue,
        [KeyVersion] = @KeyVersion,
        [Marker] = @Marker,
        [IsActive] = @IsActive,
        [Status] = @Status,
        [ActivatedAt] = @ActivatedAt,
        [ExpiresAt] = @ExpiresAt
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwEncryptionKeys] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwEncryptionKeys]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJEncryptionKey] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the EncryptionKey table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJEncryptionKey]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJEncryptionKey];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJEncryptionKey
ON [${flyway:defaultSchema}].[EncryptionKey]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[EncryptionKey]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[EncryptionKey] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Encryption Keys */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJEncryptionKey] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Encryption Keys */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Encryption Keys
-- Item: spDeleteMJEncryptionKey
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR EncryptionKey
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJEncryptionKey]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJEncryptionKey];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJEncryptionKey]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[EncryptionKey]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJEncryptionKey] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Encryption Keys */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJEncryptionKey] TO [cdp_Integration]



/* Base View SQL for MJ: Entity Action Invocations */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Action Invocations
-- Item: vwEntityActionInvocations
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Entity Action Invocations
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  EntityActionInvocation
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwEntityActionInvocations]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwEntityActionInvocations];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwEntityActionInvocations]
AS
SELECT
    m.*,
    MJEntityActions_EntityActionID.[Action] AS [EntityAction],
    MJEntityActionInvocationTypes_InvocationTypeID.[Name] AS [InvocationType]
FROM
    [${flyway:defaultSchema}].[EntityActionInvocation] AS m
INNER JOIN
    [${flyway:defaultSchema}].[vwEntityActions] AS MJEntityActions_EntityActionID
  ON
    [m].[EntityActionID] = MJEntityActions_EntityActionID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[EntityActionInvocationType] AS MJEntityActionInvocationTypes_InvocationTypeID
  ON
    [m].[InvocationTypeID] = MJEntityActionInvocationTypes_InvocationTypeID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwEntityActionInvocations] TO [cdp_Integration], [cdp_UI], [cdp_Developer]
    

/* Base View Permissions SQL for MJ: Entity Action Invocations */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Action Invocations
-- Item: Permissions for vwEntityActionInvocations
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwEntityActionInvocations] TO [cdp_Integration], [cdp_UI], [cdp_Developer]

/* spCreate SQL for MJ: Entity Action Invocations */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Action Invocations
-- Item: spCreateMJEntityActionInvocation
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR EntityActionInvocation
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJEntityActionInvocation]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJEntityActionInvocation];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJEntityActionInvocation]
    @ID uniqueidentifier = NULL,
    @EntityActionID uniqueidentifier,
    @InvocationTypeID uniqueidentifier,
    @Status nvarchar(20) = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[EntityActionInvocation]
            (
                [ID],
                [EntityActionID],
                [InvocationTypeID],
                [Status]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @EntityActionID,
                @InvocationTypeID,
                ISNULL(@Status, 'Pending')
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[EntityActionInvocation]
            (
                [EntityActionID],
                [InvocationTypeID],
                [Status]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @EntityActionID,
                @InvocationTypeID,
                ISNULL(@Status, 'Pending')
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwEntityActionInvocations] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJEntityActionInvocation] TO [cdp_Integration], [cdp_Developer]
    

/* spCreate Permissions for MJ: Entity Action Invocations */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJEntityActionInvocation] TO [cdp_Integration], [cdp_Developer]



/* spUpdate SQL for MJ: Entity Action Invocations */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Action Invocations
-- Item: spUpdateMJEntityActionInvocation
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR EntityActionInvocation
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJEntityActionInvocation]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJEntityActionInvocation];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJEntityActionInvocation]
    @ID uniqueidentifier,
    @EntityActionID uniqueidentifier,
    @InvocationTypeID uniqueidentifier,
    @Status nvarchar(20)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[EntityActionInvocation]
    SET
        [EntityActionID] = @EntityActionID,
        [InvocationTypeID] = @InvocationTypeID,
        [Status] = @Status
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwEntityActionInvocations] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwEntityActionInvocations]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJEntityActionInvocation] TO [cdp_Integration], [cdp_Developer]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the EntityActionInvocation table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJEntityActionInvocation]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJEntityActionInvocation];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJEntityActionInvocation
ON [${flyway:defaultSchema}].[EntityActionInvocation]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[EntityActionInvocation]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[EntityActionInvocation] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Entity Action Invocations */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJEntityActionInvocation] TO [cdp_Integration], [cdp_Developer]



/* spDelete SQL for MJ: Entity Action Invocations */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Action Invocations
-- Item: spDeleteMJEntityActionInvocation
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR EntityActionInvocation
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJEntityActionInvocation]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJEntityActionInvocation];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJEntityActionInvocation]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[EntityActionInvocation]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJEntityActionInvocation] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Entity Action Invocations */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJEntityActionInvocation] TO [cdp_Integration]



/* Base View SQL for MJ: Entity AI Actions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity AI Actions
-- Item: vwEntityAIActions
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Entity AI Actions
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  EntityAIAction
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwEntityAIActions]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwEntityAIActions];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwEntityAIActions]
AS
SELECT
    m.*,
    MJEntities_EntityID.[Name] AS [Entity],
    MJAIModels_AIModelID.[Name] AS [AIModel],
    MJAIActions_AIActionID.[Name] AS [AIAction],
    MJEntities_OutputEntityID.[Name] AS [OutputEntity]
FROM
    [${flyway:defaultSchema}].[EntityAIAction] AS m
INNER JOIN
    [${flyway:defaultSchema}].[Entity] AS MJEntities_EntityID
  ON
    [m].[EntityID] = MJEntities_EntityID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[AIModel] AS MJAIModels_AIModelID
  ON
    [m].[AIModelID] = MJAIModels_AIModelID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[AIAction] AS MJAIActions_AIActionID
  ON
    [m].[AIActionID] = MJAIActions_AIActionID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[Entity] AS MJEntities_OutputEntityID
  ON
    [m].[OutputEntityID] = MJEntities_OutputEntityID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwEntityAIActions] TO [cdp_Integration], [cdp_UI], [cdp_Developer]
    

/* Base View Permissions SQL for MJ: Entity AI Actions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity AI Actions
-- Item: Permissions for vwEntityAIActions
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwEntityAIActions] TO [cdp_Integration], [cdp_UI], [cdp_Developer]

/* spCreate SQL for MJ: Entity AI Actions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity AI Actions
-- Item: spCreateMJEntityAIAction
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR EntityAIAction
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJEntityAIAction]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJEntityAIAction];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJEntityAIAction]
    @ID uniqueidentifier = NULL,
    @EntityID uniqueidentifier,
    @AIModelID uniqueidentifier,
    @AIActionID uniqueidentifier,
    @Name nvarchar(255),
    @Prompt nvarchar(MAX),
    @TriggerEvent nchar(15) = NULL,
    @UserMessage nvarchar(MAX),
    @OutputType nchar(10) = NULL,
    @OutputField nvarchar(50),
    @SkipIfOutputFieldNotEmpty bit = NULL,
    @OutputEntityID uniqueidentifier,
    @Comments nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[EntityAIAction]
            (
                [ID],
                [EntityID],
                [AIModelID],
                [AIActionID],
                [Name],
                [Prompt],
                [TriggerEvent],
                [UserMessage],
                [OutputType],
                [OutputField],
                [SkipIfOutputFieldNotEmpty],
                [OutputEntityID],
                [Comments]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @EntityID,
                @AIModelID,
                @AIActionID,
                @Name,
                @Prompt,
                ISNULL(@TriggerEvent, 'After Save'),
                @UserMessage,
                ISNULL(@OutputType, 'FIeld'),
                @OutputField,
                ISNULL(@SkipIfOutputFieldNotEmpty, 1),
                @OutputEntityID,
                @Comments
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[EntityAIAction]
            (
                [EntityID],
                [AIModelID],
                [AIActionID],
                [Name],
                [Prompt],
                [TriggerEvent],
                [UserMessage],
                [OutputType],
                [OutputField],
                [SkipIfOutputFieldNotEmpty],
                [OutputEntityID],
                [Comments]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @EntityID,
                @AIModelID,
                @AIActionID,
                @Name,
                @Prompt,
                ISNULL(@TriggerEvent, 'After Save'),
                @UserMessage,
                ISNULL(@OutputType, 'FIeld'),
                @OutputField,
                ISNULL(@SkipIfOutputFieldNotEmpty, 1),
                @OutputEntityID,
                @Comments
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwEntityAIActions] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJEntityAIAction] TO [cdp_Integration], [cdp_Developer]
    

/* spCreate Permissions for MJ: Entity AI Actions */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJEntityAIAction] TO [cdp_Integration], [cdp_Developer]



/* spUpdate SQL for MJ: Entity AI Actions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity AI Actions
-- Item: spUpdateMJEntityAIAction
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR EntityAIAction
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJEntityAIAction]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJEntityAIAction];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJEntityAIAction]
    @ID uniqueidentifier,
    @EntityID uniqueidentifier,
    @AIModelID uniqueidentifier,
    @AIActionID uniqueidentifier,
    @Name nvarchar(255),
    @Prompt nvarchar(MAX),
    @TriggerEvent nchar(15),
    @UserMessage nvarchar(MAX),
    @OutputType nchar(10),
    @OutputField nvarchar(50),
    @SkipIfOutputFieldNotEmpty bit,
    @OutputEntityID uniqueidentifier,
    @Comments nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[EntityAIAction]
    SET
        [EntityID] = @EntityID,
        [AIModelID] = @AIModelID,
        [AIActionID] = @AIActionID,
        [Name] = @Name,
        [Prompt] = @Prompt,
        [TriggerEvent] = @TriggerEvent,
        [UserMessage] = @UserMessage,
        [OutputType] = @OutputType,
        [OutputField] = @OutputField,
        [SkipIfOutputFieldNotEmpty] = @SkipIfOutputFieldNotEmpty,
        [OutputEntityID] = @OutputEntityID,
        [Comments] = @Comments
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwEntityAIActions] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwEntityAIActions]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJEntityAIAction] TO [cdp_Integration], [cdp_Developer]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the EntityAIAction table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJEntityAIAction]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJEntityAIAction];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJEntityAIAction
ON [${flyway:defaultSchema}].[EntityAIAction]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[EntityAIAction]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[EntityAIAction] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Entity AI Actions */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJEntityAIAction] TO [cdp_Integration], [cdp_Developer]



/* spDelete SQL for MJ: Entity AI Actions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity AI Actions
-- Item: spDeleteMJEntityAIAction
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR EntityAIAction
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJEntityAIAction]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJEntityAIAction];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJEntityAIAction]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[EntityAIAction]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJEntityAIAction] TO [cdp_Developer]
    

/* spDelete Permissions for MJ: Entity AI Actions */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJEntityAIAction] TO [cdp_Developer]



/* Base View SQL for MJ: Entity Actions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Actions
-- Item: vwEntityActions
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Entity Actions
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  EntityAction
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwEntityActions]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwEntityActions];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwEntityActions]
AS
SELECT
    m.*,
    MJEntities_EntityID.[Name] AS [Entity],
    MJActions_ActionID.[Name] AS [Action]
FROM
    [${flyway:defaultSchema}].[EntityAction] AS m
INNER JOIN
    [${flyway:defaultSchema}].[Entity] AS MJEntities_EntityID
  ON
    [m].[EntityID] = MJEntities_EntityID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[Action] AS MJActions_ActionID
  ON
    [m].[ActionID] = MJActions_ActionID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwEntityActions] TO [cdp_UI], [cdp_Integration], [cdp_Developer]
    

/* Base View Permissions SQL for MJ: Entity Actions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Actions
-- Item: Permissions for vwEntityActions
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwEntityActions] TO [cdp_UI], [cdp_Integration], [cdp_Developer]

/* spCreate SQL for MJ: Entity Actions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Actions
-- Item: spCreateMJEntityAction
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR EntityAction
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJEntityAction]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJEntityAction];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJEntityAction]
    @EntityID uniqueidentifier,
    @ActionID uniqueidentifier,
    @Status nvarchar(20) = NULL,
    @ID uniqueidentifier = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[EntityAction]
            (
                [ID],
                [EntityID],
                [ActionID],
                [Status]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @EntityID,
                @ActionID,
                ISNULL(@Status, 'Pending')
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[EntityAction]
            (
                [EntityID],
                [ActionID],
                [Status]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @EntityID,
                @ActionID,
                ISNULL(@Status, 'Pending')
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwEntityActions] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJEntityAction] TO [cdp_Integration], [cdp_Developer]
    

/* spCreate Permissions for MJ: Entity Actions */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJEntityAction] TO [cdp_Integration], [cdp_Developer]



/* spUpdate SQL for MJ: Entity Actions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Actions
-- Item: spUpdateMJEntityAction
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR EntityAction
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJEntityAction]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJEntityAction];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJEntityAction]
    @EntityID uniqueidentifier,
    @ActionID uniqueidentifier,
    @Status nvarchar(20),
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[EntityAction]
    SET
        [EntityID] = @EntityID,
        [ActionID] = @ActionID,
        [Status] = @Status
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwEntityActions] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwEntityActions]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJEntityAction] TO [cdp_Integration], [cdp_Developer]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the EntityAction table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJEntityAction]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJEntityAction];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJEntityAction
ON [${flyway:defaultSchema}].[EntityAction]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[EntityAction]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[EntityAction] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Entity Actions */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJEntityAction] TO [cdp_Integration], [cdp_Developer]



/* spDelete SQL for MJ: Entity Actions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Actions
-- Item: spDeleteMJEntityAction
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR EntityAction
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJEntityAction]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJEntityAction];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJEntityAction]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[EntityAction]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJEntityAction] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Entity Actions */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJEntityAction] TO [cdp_Integration]



/* Base View SQL for MJ: Entity Action Invocation Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Action Invocation Types
-- Item: vwEntityActionInvocationTypes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Entity Action Invocation Types
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  EntityActionInvocationType
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwEntityActionInvocationTypes]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwEntityActionInvocationTypes];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwEntityActionInvocationTypes]
AS
SELECT
    m.*
FROM
    [${flyway:defaultSchema}].[EntityActionInvocationType] AS m
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwEntityActionInvocationTypes] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Entity Action Invocation Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Action Invocation Types
-- Item: Permissions for vwEntityActionInvocationTypes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwEntityActionInvocationTypes] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Entity Action Invocation Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Action Invocation Types
-- Item: spCreateMJEntityActionInvocationType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR EntityActionInvocationType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJEntityActionInvocationType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJEntityActionInvocationType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJEntityActionInvocationType]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @DisplaySequence int = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[EntityActionInvocationType]
            (
                [ID],
                [Name],
                [Description],
                [DisplaySequence]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description,
                ISNULL(@DisplaySequence, 0)
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[EntityActionInvocationType]
            (
                [Name],
                [Description],
                [DisplaySequence]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description,
                ISNULL(@DisplaySequence, 0)
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwEntityActionInvocationTypes] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJEntityActionInvocationType] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Entity Action Invocation Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJEntityActionInvocationType] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Entity Action Invocation Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Action Invocation Types
-- Item: spUpdateMJEntityActionInvocationType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR EntityActionInvocationType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJEntityActionInvocationType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJEntityActionInvocationType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJEntityActionInvocationType]
    @ID uniqueidentifier,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @DisplaySequence int
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[EntityActionInvocationType]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [DisplaySequence] = @DisplaySequence
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwEntityActionInvocationTypes] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwEntityActionInvocationTypes]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJEntityActionInvocationType] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the EntityActionInvocationType table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJEntityActionInvocationType]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJEntityActionInvocationType];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJEntityActionInvocationType
ON [${flyway:defaultSchema}].[EntityActionInvocationType]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[EntityActionInvocationType]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[EntityActionInvocationType] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Entity Action Invocation Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJEntityActionInvocationType] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Entity Action Invocation Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Action Invocation Types
-- Item: spDeleteMJEntityActionInvocationType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR EntityActionInvocationType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJEntityActionInvocationType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJEntityActionInvocationType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJEntityActionInvocationType]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[EntityActionInvocationType]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJEntityActionInvocationType] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Entity Action Invocation Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJEntityActionInvocationType] TO [cdp_Integration]



/* Base View SQL for MJ: Entity Action Params */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Action Params
-- Item: vwEntityActionParams
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Entity Action Params
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  EntityActionParam
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwEntityActionParams]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwEntityActionParams];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwEntityActionParams]
AS
SELECT
    m.*,
    MJEntityActions_EntityActionID.[Action] AS [EntityAction],
    MJActionParams_ActionParamID.[Name] AS [ActionParam]
FROM
    [${flyway:defaultSchema}].[EntityActionParam] AS m
INNER JOIN
    [${flyway:defaultSchema}].[vwEntityActions] AS MJEntityActions_EntityActionID
  ON
    [m].[EntityActionID] = MJEntityActions_EntityActionID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[ActionParam] AS MJActionParams_ActionParamID
  ON
    [m].[ActionParamID] = MJActionParams_ActionParamID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwEntityActionParams] TO [cdp_Developer], [cdp_Integration], [cdp_UI]
    

/* Base View Permissions SQL for MJ: Entity Action Params */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Action Params
-- Item: Permissions for vwEntityActionParams
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwEntityActionParams] TO [cdp_Developer], [cdp_Integration], [cdp_UI]

/* spCreate SQL for MJ: Entity Action Params */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Action Params
-- Item: spCreateMJEntityActionParam
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR EntityActionParam
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJEntityActionParam]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJEntityActionParam];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJEntityActionParam]
    @ID uniqueidentifier = NULL,
    @EntityActionID uniqueidentifier,
    @ActionParamID uniqueidentifier,
    @ValueType nvarchar(20),
    @Value nvarchar(MAX),
    @Comments nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[EntityActionParam]
            (
                [ID],
                [EntityActionID],
                [ActionParamID],
                [ValueType],
                [Value],
                [Comments]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @EntityActionID,
                @ActionParamID,
                @ValueType,
                @Value,
                @Comments
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[EntityActionParam]
            (
                [EntityActionID],
                [ActionParamID],
                [ValueType],
                [Value],
                [Comments]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @EntityActionID,
                @ActionParamID,
                @ValueType,
                @Value,
                @Comments
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwEntityActionParams] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJEntityActionParam] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Entity Action Params */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJEntityActionParam] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Entity Action Params */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Action Params
-- Item: spUpdateMJEntityActionParam
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR EntityActionParam
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJEntityActionParam]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJEntityActionParam];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJEntityActionParam]
    @ID uniqueidentifier,
    @EntityActionID uniqueidentifier,
    @ActionParamID uniqueidentifier,
    @ValueType nvarchar(20),
    @Value nvarchar(MAX),
    @Comments nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[EntityActionParam]
    SET
        [EntityActionID] = @EntityActionID,
        [ActionParamID] = @ActionParamID,
        [ValueType] = @ValueType,
        [Value] = @Value,
        [Comments] = @Comments
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwEntityActionParams] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwEntityActionParams]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJEntityActionParam] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the EntityActionParam table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJEntityActionParam]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJEntityActionParam];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJEntityActionParam
ON [${flyway:defaultSchema}].[EntityActionParam]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[EntityActionParam]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[EntityActionParam] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Entity Action Params */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJEntityActionParam] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Entity Action Params */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Action Params
-- Item: spDeleteMJEntityActionParam
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR EntityActionParam
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJEntityActionParam]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJEntityActionParam];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJEntityActionParam]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[EntityActionParam]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJEntityActionParam] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Entity Action Params */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJEntityActionParam] TO [cdp_Integration]



/* Base View SQL for MJ: Entity Communication Message Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Communication Message Types
-- Item: vwEntityCommunicationMessageTypes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Entity Communication Message Types
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  EntityCommunicationMessageType
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwEntityCommunicationMessageTypes]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwEntityCommunicationMessageTypes];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwEntityCommunicationMessageTypes]
AS
SELECT
    m.*,
    MJEntities_EntityID.[Name] AS [Entity],
    MJCommunicationBaseMessageTypes_BaseMessageTypeID.[Type] AS [BaseMessageType]
FROM
    [${flyway:defaultSchema}].[EntityCommunicationMessageType] AS m
INNER JOIN
    [${flyway:defaultSchema}].[Entity] AS MJEntities_EntityID
  ON
    [m].[EntityID] = MJEntities_EntityID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[CommunicationBaseMessageType] AS MJCommunicationBaseMessageTypes_BaseMessageTypeID
  ON
    [m].[BaseMessageTypeID] = MJCommunicationBaseMessageTypes_BaseMessageTypeID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwEntityCommunicationMessageTypes] TO [cdp_Integration], [cdp_UI], [cdp_Developer]
    

/* Base View Permissions SQL for MJ: Entity Communication Message Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Communication Message Types
-- Item: Permissions for vwEntityCommunicationMessageTypes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwEntityCommunicationMessageTypes] TO [cdp_Integration], [cdp_UI], [cdp_Developer]

/* spCreate SQL for MJ: Entity Communication Message Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Communication Message Types
-- Item: spCreateMJEntityCommunicationMessageType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR EntityCommunicationMessageType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJEntityCommunicationMessageType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJEntityCommunicationMessageType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJEntityCommunicationMessageType]
    @ID uniqueidentifier = NULL,
    @EntityID uniqueidentifier,
    @BaseMessageTypeID uniqueidentifier,
    @IsActive bit = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[EntityCommunicationMessageType]
            (
                [ID],
                [EntityID],
                [BaseMessageTypeID],
                [IsActive]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @EntityID,
                @BaseMessageTypeID,
                ISNULL(@IsActive, 1)
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[EntityCommunicationMessageType]
            (
                [EntityID],
                [BaseMessageTypeID],
                [IsActive]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @EntityID,
                @BaseMessageTypeID,
                ISNULL(@IsActive, 1)
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwEntityCommunicationMessageTypes] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJEntityCommunicationMessageType] TO [cdp_Integration], [cdp_Developer]
    

/* spCreate Permissions for MJ: Entity Communication Message Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJEntityCommunicationMessageType] TO [cdp_Integration], [cdp_Developer]



/* spUpdate SQL for MJ: Entity Communication Message Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Communication Message Types
-- Item: spUpdateMJEntityCommunicationMessageType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR EntityCommunicationMessageType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJEntityCommunicationMessageType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJEntityCommunicationMessageType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJEntityCommunicationMessageType]
    @ID uniqueidentifier,
    @EntityID uniqueidentifier,
    @BaseMessageTypeID uniqueidentifier,
    @IsActive bit
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[EntityCommunicationMessageType]
    SET
        [EntityID] = @EntityID,
        [BaseMessageTypeID] = @BaseMessageTypeID,
        [IsActive] = @IsActive
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwEntityCommunicationMessageTypes] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwEntityCommunicationMessageTypes]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJEntityCommunicationMessageType] TO [cdp_Integration], [cdp_Developer]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the EntityCommunicationMessageType table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJEntityCommunicationMessageType]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJEntityCommunicationMessageType];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJEntityCommunicationMessageType
ON [${flyway:defaultSchema}].[EntityCommunicationMessageType]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[EntityCommunicationMessageType]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[EntityCommunicationMessageType] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Entity Communication Message Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJEntityCommunicationMessageType] TO [cdp_Integration], [cdp_Developer]



/* spDelete SQL for MJ: Entity Communication Message Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Communication Message Types
-- Item: spDeleteMJEntityCommunicationMessageType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR EntityCommunicationMessageType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJEntityCommunicationMessageType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJEntityCommunicationMessageType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJEntityCommunicationMessageType]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[EntityCommunicationMessageType]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJEntityCommunicationMessageType] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Entity Communication Message Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJEntityCommunicationMessageType] TO [cdp_Integration]



/* Base View SQL for MJ: Entity Document Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Document Types
-- Item: vwEntityDocumentTypes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Entity Document Types
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  EntityDocumentType
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwEntityDocumentTypes]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwEntityDocumentTypes];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwEntityDocumentTypes]
AS
SELECT
    m.*
FROM
    [${flyway:defaultSchema}].[EntityDocumentType] AS m
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwEntityDocumentTypes] TO [cdp_UI], [cdp_Integration], [cdp_Developer]
    

/* Base View Permissions SQL for MJ: Entity Document Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Document Types
-- Item: Permissions for vwEntityDocumentTypes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwEntityDocumentTypes] TO [cdp_UI], [cdp_Integration], [cdp_Developer]

/* spCreate SQL for MJ: Entity Document Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Document Types
-- Item: spCreateMJEntityDocumentType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR EntityDocumentType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJEntityDocumentType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJEntityDocumentType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJEntityDocumentType]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(100),
    @Description nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[EntityDocumentType]
            (
                [ID],
                [Name],
                [Description]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[EntityDocumentType]
            (
                [Name],
                [Description]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwEntityDocumentTypes] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJEntityDocumentType] TO [cdp_Integration], [cdp_Developer]
    

/* spCreate Permissions for MJ: Entity Document Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJEntityDocumentType] TO [cdp_Integration], [cdp_Developer]



/* spUpdate SQL for MJ: Entity Document Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Document Types
-- Item: spUpdateMJEntityDocumentType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR EntityDocumentType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJEntityDocumentType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJEntityDocumentType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJEntityDocumentType]
    @ID uniqueidentifier,
    @Name nvarchar(100),
    @Description nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[EntityDocumentType]
    SET
        [Name] = @Name,
        [Description] = @Description
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwEntityDocumentTypes] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwEntityDocumentTypes]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJEntityDocumentType] TO [cdp_Integration], [cdp_Developer]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the EntityDocumentType table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJEntityDocumentType]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJEntityDocumentType];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJEntityDocumentType
ON [${flyway:defaultSchema}].[EntityDocumentType]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[EntityDocumentType]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[EntityDocumentType] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Entity Document Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJEntityDocumentType] TO [cdp_Integration], [cdp_Developer]



/* spDelete SQL for MJ: Entity Document Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Document Types
-- Item: spDeleteMJEntityDocumentType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR EntityDocumentType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJEntityDocumentType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJEntityDocumentType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJEntityDocumentType]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[EntityDocumentType]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJEntityDocumentType] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Entity Document Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJEntityDocumentType] TO [cdp_Integration]



/* Base View SQL for MJ: Entity Communication Fields */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Communication Fields
-- Item: vwEntityCommunicationFields
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Entity Communication Fields
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  EntityCommunicationField
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwEntityCommunicationFields]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwEntityCommunicationFields];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwEntityCommunicationFields]
AS
SELECT
    m.*,
    MJEntityCommunicationMessageTypes_EntityCommunicationMessageTypeID.[BaseMessageType] AS [EntityCommunicationMessageType]
FROM
    [${flyway:defaultSchema}].[EntityCommunicationField] AS m
INNER JOIN
    [${flyway:defaultSchema}].[vwEntityCommunicationMessageTypes] AS MJEntityCommunicationMessageTypes_EntityCommunicationMessageTypeID
  ON
    [m].[EntityCommunicationMessageTypeID] = MJEntityCommunicationMessageTypes_EntityCommunicationMessageTypeID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwEntityCommunicationFields] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Entity Communication Fields */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Communication Fields
-- Item: Permissions for vwEntityCommunicationFields
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwEntityCommunicationFields] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Entity Communication Fields */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Communication Fields
-- Item: spCreateMJEntityCommunicationField
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR EntityCommunicationField
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJEntityCommunicationField]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJEntityCommunicationField];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJEntityCommunicationField]
    @ID uniqueidentifier = NULL,
    @EntityCommunicationMessageTypeID uniqueidentifier,
    @FieldName nvarchar(500),
    @Priority int
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[EntityCommunicationField]
            (
                [ID],
                [EntityCommunicationMessageTypeID],
                [FieldName],
                [Priority]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @EntityCommunicationMessageTypeID,
                @FieldName,
                @Priority
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[EntityCommunicationField]
            (
                [EntityCommunicationMessageTypeID],
                [FieldName],
                [Priority]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @EntityCommunicationMessageTypeID,
                @FieldName,
                @Priority
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwEntityCommunicationFields] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJEntityCommunicationField] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Entity Communication Fields */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJEntityCommunicationField] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Entity Communication Fields */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Communication Fields
-- Item: spUpdateMJEntityCommunicationField
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR EntityCommunicationField
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJEntityCommunicationField]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJEntityCommunicationField];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJEntityCommunicationField]
    @ID uniqueidentifier,
    @EntityCommunicationMessageTypeID uniqueidentifier,
    @FieldName nvarchar(500),
    @Priority int
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[EntityCommunicationField]
    SET
        [EntityCommunicationMessageTypeID] = @EntityCommunicationMessageTypeID,
        [FieldName] = @FieldName,
        [Priority] = @Priority
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwEntityCommunicationFields] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwEntityCommunicationFields]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJEntityCommunicationField] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the EntityCommunicationField table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJEntityCommunicationField]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJEntityCommunicationField];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJEntityCommunicationField
ON [${flyway:defaultSchema}].[EntityCommunicationField]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[EntityCommunicationField]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[EntityCommunicationField] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Entity Communication Fields */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJEntityCommunicationField] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Entity Communication Fields */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Communication Fields
-- Item: spDeleteMJEntityCommunicationField
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR EntityCommunicationField
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJEntityCommunicationField]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJEntityCommunicationField];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJEntityCommunicationField]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[EntityCommunicationField]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJEntityCommunicationField] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Entity Communication Fields */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJEntityCommunicationField] TO [cdp_Integration]



/* Base View SQL for MJ: Entity Document Settings */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Document Settings
-- Item: vwEntityDocumentSettings
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Entity Document Settings
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  EntityDocumentSetting
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwEntityDocumentSettings]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwEntityDocumentSettings];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwEntityDocumentSettings]
AS
SELECT
    m.*,
    MJEntityDocuments_EntityDocumentID.[Name] AS [EntityDocument]
FROM
    [${flyway:defaultSchema}].[EntityDocumentSetting] AS m
INNER JOIN
    [${flyway:defaultSchema}].[EntityDocument] AS MJEntityDocuments_EntityDocumentID
  ON
    [m].[EntityDocumentID] = MJEntityDocuments_EntityDocumentID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwEntityDocumentSettings] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Entity Document Settings */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Document Settings
-- Item: Permissions for vwEntityDocumentSettings
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwEntityDocumentSettings] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Entity Document Settings */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Document Settings
-- Item: spCreateMJEntityDocumentSetting
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR EntityDocumentSetting
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJEntityDocumentSetting]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJEntityDocumentSetting];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJEntityDocumentSetting]
    @ID uniqueidentifier = NULL,
    @EntityDocumentID uniqueidentifier,
    @Name nvarchar(100),
    @Value nvarchar(MAX),
    @Comments nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[EntityDocumentSetting]
            (
                [ID],
                [EntityDocumentID],
                [Name],
                [Value],
                [Comments]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @EntityDocumentID,
                @Name,
                @Value,
                @Comments
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[EntityDocumentSetting]
            (
                [EntityDocumentID],
                [Name],
                [Value],
                [Comments]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @EntityDocumentID,
                @Name,
                @Value,
                @Comments
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwEntityDocumentSettings] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJEntityDocumentSetting] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Entity Document Settings */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJEntityDocumentSetting] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Entity Document Settings */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Document Settings
-- Item: spUpdateMJEntityDocumentSetting
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR EntityDocumentSetting
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJEntityDocumentSetting]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJEntityDocumentSetting];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJEntityDocumentSetting]
    @ID uniqueidentifier,
    @EntityDocumentID uniqueidentifier,
    @Name nvarchar(100),
    @Value nvarchar(MAX),
    @Comments nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[EntityDocumentSetting]
    SET
        [EntityDocumentID] = @EntityDocumentID,
        [Name] = @Name,
        [Value] = @Value,
        [Comments] = @Comments
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwEntityDocumentSettings] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwEntityDocumentSettings]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJEntityDocumentSetting] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the EntityDocumentSetting table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJEntityDocumentSetting]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJEntityDocumentSetting];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJEntityDocumentSetting
ON [${flyway:defaultSchema}].[EntityDocumentSetting]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[EntityDocumentSetting]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[EntityDocumentSetting] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Entity Document Settings */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJEntityDocumentSetting] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Entity Document Settings */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Document Settings
-- Item: spDeleteMJEntityDocumentSetting
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR EntityDocumentSetting
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJEntityDocumentSetting]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJEntityDocumentSetting];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJEntityDocumentSetting]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[EntityDocumentSetting]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJEntityDocumentSetting] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Entity Document Settings */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJEntityDocumentSetting] TO [cdp_Integration]



/* Base View SQL for MJ: Entity Document Runs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Document Runs
-- Item: vwEntityDocumentRuns
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Entity Document Runs
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  EntityDocumentRun
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwEntityDocumentRuns]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwEntityDocumentRuns];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwEntityDocumentRuns]
AS
SELECT
    m.*,
    MJEntityDocuments_EntityDocumentID.[Name] AS [EntityDocument]
FROM
    [${flyway:defaultSchema}].[EntityDocumentRun] AS m
INNER JOIN
    [${flyway:defaultSchema}].[EntityDocument] AS MJEntityDocuments_EntityDocumentID
  ON
    [m].[EntityDocumentID] = MJEntityDocuments_EntityDocumentID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwEntityDocumentRuns] TO [cdp_UI], [cdp_Integration], [cdp_Developer]
    

/* Base View Permissions SQL for MJ: Entity Document Runs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Document Runs
-- Item: Permissions for vwEntityDocumentRuns
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwEntityDocumentRuns] TO [cdp_UI], [cdp_Integration], [cdp_Developer]

/* spCreate SQL for MJ: Entity Document Runs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Document Runs
-- Item: spCreateMJEntityDocumentRun
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR EntityDocumentRun
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJEntityDocumentRun]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJEntityDocumentRun];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJEntityDocumentRun]
    @ID uniqueidentifier = NULL,
    @EntityDocumentID uniqueidentifier,
    @StartedAt datetimeoffset,
    @EndedAt datetimeoffset,
    @Status nvarchar(15) = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[EntityDocumentRun]
            (
                [ID],
                [EntityDocumentID],
                [StartedAt],
                [EndedAt],
                [Status]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @EntityDocumentID,
                @StartedAt,
                @EndedAt,
                ISNULL(@Status, 'Pending')
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[EntityDocumentRun]
            (
                [EntityDocumentID],
                [StartedAt],
                [EndedAt],
                [Status]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @EntityDocumentID,
                @StartedAt,
                @EndedAt,
                ISNULL(@Status, 'Pending')
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwEntityDocumentRuns] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJEntityDocumentRun] TO [cdp_Integration], [cdp_Developer]
    

/* spCreate Permissions for MJ: Entity Document Runs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJEntityDocumentRun] TO [cdp_Integration], [cdp_Developer]



/* spUpdate SQL for MJ: Entity Document Runs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Document Runs
-- Item: spUpdateMJEntityDocumentRun
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR EntityDocumentRun
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJEntityDocumentRun]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJEntityDocumentRun];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJEntityDocumentRun]
    @ID uniqueidentifier,
    @EntityDocumentID uniqueidentifier,
    @StartedAt datetimeoffset,
    @EndedAt datetimeoffset,
    @Status nvarchar(15)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[EntityDocumentRun]
    SET
        [EntityDocumentID] = @EntityDocumentID,
        [StartedAt] = @StartedAt,
        [EndedAt] = @EndedAt,
        [Status] = @Status
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwEntityDocumentRuns] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwEntityDocumentRuns]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJEntityDocumentRun] TO [cdp_Integration], [cdp_Developer]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the EntityDocumentRun table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJEntityDocumentRun]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJEntityDocumentRun];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJEntityDocumentRun
ON [${flyway:defaultSchema}].[EntityDocumentRun]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[EntityDocumentRun]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[EntityDocumentRun] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Entity Document Runs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJEntityDocumentRun] TO [cdp_Integration], [cdp_Developer]



/* spDelete SQL for MJ: Entity Document Runs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Document Runs
-- Item: spDeleteMJEntityDocumentRun
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR EntityDocumentRun
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJEntityDocumentRun]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJEntityDocumentRun];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJEntityDocumentRun]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[EntityDocumentRun]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJEntityDocumentRun] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Entity Document Runs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJEntityDocumentRun] TO [cdp_Integration]



/* Base View SQL for MJ: Entity Documents */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Documents
-- Item: vwEntityDocuments
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Entity Documents
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  EntityDocument
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwEntityDocuments]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwEntityDocuments];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwEntityDocuments]
AS
SELECT
    m.*,
    MJEntityDocumentTypes_TypeID.[Name] AS [Type],
    MJEntities_EntityID.[Name] AS [Entity],
    MJVectorDatabases_VectorDatabaseID.[Name] AS [VectorDatabase],
    MJTemplates_TemplateID.[Name] AS [Template],
    MJAIModels_AIModelID.[Name] AS [AIModel]
FROM
    [${flyway:defaultSchema}].[EntityDocument] AS m
INNER JOIN
    [${flyway:defaultSchema}].[EntityDocumentType] AS MJEntityDocumentTypes_TypeID
  ON
    [m].[TypeID] = MJEntityDocumentTypes_TypeID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[Entity] AS MJEntities_EntityID
  ON
    [m].[EntityID] = MJEntities_EntityID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[VectorDatabase] AS MJVectorDatabases_VectorDatabaseID
  ON
    [m].[VectorDatabaseID] = MJVectorDatabases_VectorDatabaseID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[Template] AS MJTemplates_TemplateID
  ON
    [m].[TemplateID] = MJTemplates_TemplateID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[AIModel] AS MJAIModels_AIModelID
  ON
    [m].[AIModelID] = MJAIModels_AIModelID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwEntityDocuments] TO [cdp_Integration], [cdp_UI], [cdp_Developer]
    

/* Base View Permissions SQL for MJ: Entity Documents */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Documents
-- Item: Permissions for vwEntityDocuments
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwEntityDocuments] TO [cdp_Integration], [cdp_UI], [cdp_Developer]

/* spCreate SQL for MJ: Entity Documents */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Documents
-- Item: spCreateMJEntityDocument
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR EntityDocument
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJEntityDocument]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJEntityDocument];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJEntityDocument]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(250),
    @TypeID uniqueidentifier,
    @EntityID uniqueidentifier,
    @VectorDatabaseID uniqueidentifier,
    @Status nvarchar(15) = NULL,
    @TemplateID uniqueidentifier,
    @AIModelID uniqueidentifier,
    @PotentialMatchThreshold numeric(12, 11) = NULL,
    @AbsoluteMatchThreshold numeric(12, 11) = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[EntityDocument]
            (
                [ID],
                [Name],
                [TypeID],
                [EntityID],
                [VectorDatabaseID],
                [Status],
                [TemplateID],
                [AIModelID],
                [PotentialMatchThreshold],
                [AbsoluteMatchThreshold]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @TypeID,
                @EntityID,
                @VectorDatabaseID,
                ISNULL(@Status, 'Active'),
                @TemplateID,
                @AIModelID,
                ISNULL(@PotentialMatchThreshold, 1),
                ISNULL(@AbsoluteMatchThreshold, 1)
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[EntityDocument]
            (
                [Name],
                [TypeID],
                [EntityID],
                [VectorDatabaseID],
                [Status],
                [TemplateID],
                [AIModelID],
                [PotentialMatchThreshold],
                [AbsoluteMatchThreshold]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @TypeID,
                @EntityID,
                @VectorDatabaseID,
                ISNULL(@Status, 'Active'),
                @TemplateID,
                @AIModelID,
                ISNULL(@PotentialMatchThreshold, 1),
                ISNULL(@AbsoluteMatchThreshold, 1)
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwEntityDocuments] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJEntityDocument] TO [cdp_Integration], [cdp_Developer]
    

/* spCreate Permissions for MJ: Entity Documents */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJEntityDocument] TO [cdp_Integration], [cdp_Developer]



/* spUpdate SQL for MJ: Entity Documents */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Documents
-- Item: spUpdateMJEntityDocument
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR EntityDocument
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJEntityDocument]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJEntityDocument];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJEntityDocument]
    @ID uniqueidentifier,
    @Name nvarchar(250),
    @TypeID uniqueidentifier,
    @EntityID uniqueidentifier,
    @VectorDatabaseID uniqueidentifier,
    @Status nvarchar(15),
    @TemplateID uniqueidentifier,
    @AIModelID uniqueidentifier,
    @PotentialMatchThreshold numeric(12, 11),
    @AbsoluteMatchThreshold numeric(12, 11)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[EntityDocument]
    SET
        [Name] = @Name,
        [TypeID] = @TypeID,
        [EntityID] = @EntityID,
        [VectorDatabaseID] = @VectorDatabaseID,
        [Status] = @Status,
        [TemplateID] = @TemplateID,
        [AIModelID] = @AIModelID,
        [PotentialMatchThreshold] = @PotentialMatchThreshold,
        [AbsoluteMatchThreshold] = @AbsoluteMatchThreshold
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwEntityDocuments] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwEntityDocuments]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJEntityDocument] TO [cdp_Integration], [cdp_Developer]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the EntityDocument table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJEntityDocument]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJEntityDocument];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJEntityDocument
ON [${flyway:defaultSchema}].[EntityDocument]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[EntityDocument]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[EntityDocument] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Entity Documents */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJEntityDocument] TO [cdp_Integration], [cdp_Developer]



/* spDelete SQL for MJ: Entity Documents */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Documents
-- Item: spDeleteMJEntityDocument
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR EntityDocument
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJEntityDocument]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJEntityDocument];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJEntityDocument]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[EntityDocument]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJEntityDocument] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Entity Documents */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJEntityDocument] TO [cdp_Integration]



/* Base View SQL for MJ: Entity Record Documents */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Record Documents
-- Item: vwEntityRecordDocuments
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Entity Record Documents
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  EntityRecordDocument
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwEntityRecordDocuments]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwEntityRecordDocuments];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwEntityRecordDocuments]
AS
SELECT
    m.*,
    MJEntities_EntityID.[Name] AS [Entity],
    MJEntityDocuments_EntityDocumentID.[Name] AS [EntityDocument],
    MJVectorIndexes_VectorIndexID.[Name] AS [VectorIndex]
FROM
    [${flyway:defaultSchema}].[EntityRecordDocument] AS m
INNER JOIN
    [${flyway:defaultSchema}].[Entity] AS MJEntities_EntityID
  ON
    [m].[EntityID] = MJEntities_EntityID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[EntityDocument] AS MJEntityDocuments_EntityDocumentID
  ON
    [m].[EntityDocumentID] = MJEntityDocuments_EntityDocumentID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[VectorIndex] AS MJVectorIndexes_VectorIndexID
  ON
    [m].[VectorIndexID] = MJVectorIndexes_VectorIndexID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwEntityRecordDocuments] TO [cdp_Developer], [cdp_Integration], [cdp_UI]
    

/* Base View Permissions SQL for MJ: Entity Record Documents */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Record Documents
-- Item: Permissions for vwEntityRecordDocuments
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwEntityRecordDocuments] TO [cdp_Developer], [cdp_Integration], [cdp_UI]

/* spCreate SQL for MJ: Entity Record Documents */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Record Documents
-- Item: spCreateMJEntityRecordDocument
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR EntityRecordDocument
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJEntityRecordDocument]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJEntityRecordDocument];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJEntityRecordDocument]
    @ID uniqueidentifier = NULL,
    @EntityID uniqueidentifier,
    @RecordID nvarchar(450),
    @EntityDocumentID uniqueidentifier,
    @DocumentText nvarchar(MAX),
    @VectorIndexID uniqueidentifier,
    @VectorID nvarchar(50),
    @VectorJSON nvarchar(MAX),
    @EntityRecordUpdatedAt datetimeoffset
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[EntityRecordDocument]
            (
                [ID],
                [EntityID],
                [RecordID],
                [EntityDocumentID],
                [DocumentText],
                [VectorIndexID],
                [VectorID],
                [VectorJSON],
                [EntityRecordUpdatedAt]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @EntityID,
                @RecordID,
                @EntityDocumentID,
                @DocumentText,
                @VectorIndexID,
                @VectorID,
                @VectorJSON,
                @EntityRecordUpdatedAt
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[EntityRecordDocument]
            (
                [EntityID],
                [RecordID],
                [EntityDocumentID],
                [DocumentText],
                [VectorIndexID],
                [VectorID],
                [VectorJSON],
                [EntityRecordUpdatedAt]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @EntityID,
                @RecordID,
                @EntityDocumentID,
                @DocumentText,
                @VectorIndexID,
                @VectorID,
                @VectorJSON,
                @EntityRecordUpdatedAt
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwEntityRecordDocuments] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJEntityRecordDocument] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Entity Record Documents */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJEntityRecordDocument] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Entity Record Documents */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Record Documents
-- Item: spUpdateMJEntityRecordDocument
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR EntityRecordDocument
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJEntityRecordDocument]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJEntityRecordDocument];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJEntityRecordDocument]
    @ID uniqueidentifier,
    @EntityID uniqueidentifier,
    @RecordID nvarchar(450),
    @EntityDocumentID uniqueidentifier,
    @DocumentText nvarchar(MAX),
    @VectorIndexID uniqueidentifier,
    @VectorID nvarchar(50),
    @VectorJSON nvarchar(MAX),
    @EntityRecordUpdatedAt datetimeoffset
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[EntityRecordDocument]
    SET
        [EntityID] = @EntityID,
        [RecordID] = @RecordID,
        [EntityDocumentID] = @EntityDocumentID,
        [DocumentText] = @DocumentText,
        [VectorIndexID] = @VectorIndexID,
        [VectorID] = @VectorID,
        [VectorJSON] = @VectorJSON,
        [EntityRecordUpdatedAt] = @EntityRecordUpdatedAt
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwEntityRecordDocuments] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwEntityRecordDocuments]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJEntityRecordDocument] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the EntityRecordDocument table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJEntityRecordDocument]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJEntityRecordDocument];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJEntityRecordDocument
ON [${flyway:defaultSchema}].[EntityRecordDocument]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[EntityRecordDocument]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[EntityRecordDocument] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Entity Record Documents */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJEntityRecordDocument] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Entity Record Documents */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Record Documents
-- Item: spDeleteMJEntityRecordDocument
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR EntityRecordDocument
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJEntityRecordDocument]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJEntityRecordDocument];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJEntityRecordDocument]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[EntityRecordDocument]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJEntityRecordDocument] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Entity Record Documents */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJEntityRecordDocument] TO [cdp_Integration]



/* Base View SQL for MJ: Entity Relationship Display Components */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Relationship Display Components
-- Item: vwEntityRelationshipDisplayComponents
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Entity Relationship Display Components
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  EntityRelationshipDisplayComponent
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwEntityRelationshipDisplayComponents]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwEntityRelationshipDisplayComponents];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwEntityRelationshipDisplayComponents]
AS
SELECT
    m.*
FROM
    [${flyway:defaultSchema}].[EntityRelationshipDisplayComponent] AS m
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwEntityRelationshipDisplayComponents] TO [cdp_UI], [cdp_Integration], [cdp_Developer]
    

/* Base View Permissions SQL for MJ: Entity Relationship Display Components */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Relationship Display Components
-- Item: Permissions for vwEntityRelationshipDisplayComponents
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwEntityRelationshipDisplayComponents] TO [cdp_UI], [cdp_Integration], [cdp_Developer]

/* spCreate SQL for MJ: Entity Relationship Display Components */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Relationship Display Components
-- Item: spCreateMJEntityRelationshipDisplayComponent
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR EntityRelationshipDisplayComponent
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJEntityRelationshipDisplayComponent]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJEntityRelationshipDisplayComponent];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJEntityRelationshipDisplayComponent]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @RelationshipType nvarchar(20)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[EntityRelationshipDisplayComponent]
            (
                [ID],
                [Name],
                [Description],
                [RelationshipType]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description,
                @RelationshipType
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[EntityRelationshipDisplayComponent]
            (
                [Name],
                [Description],
                [RelationshipType]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description,
                @RelationshipType
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwEntityRelationshipDisplayComponents] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJEntityRelationshipDisplayComponent] TO [cdp_Integration], [cdp_Developer]
    

/* spCreate Permissions for MJ: Entity Relationship Display Components */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJEntityRelationshipDisplayComponent] TO [cdp_Integration], [cdp_Developer]



/* spUpdate SQL for MJ: Entity Relationship Display Components */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Relationship Display Components
-- Item: spUpdateMJEntityRelationshipDisplayComponent
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR EntityRelationshipDisplayComponent
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJEntityRelationshipDisplayComponent]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJEntityRelationshipDisplayComponent];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJEntityRelationshipDisplayComponent]
    @ID uniqueidentifier,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @RelationshipType nvarchar(20)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[EntityRelationshipDisplayComponent]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [RelationshipType] = @RelationshipType
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwEntityRelationshipDisplayComponents] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwEntityRelationshipDisplayComponents]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJEntityRelationshipDisplayComponent] TO [cdp_Integration], [cdp_Developer]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the EntityRelationshipDisplayComponent table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJEntityRelationshipDisplayComponent]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJEntityRelationshipDisplayComponent];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJEntityRelationshipDisplayComponent
ON [${flyway:defaultSchema}].[EntityRelationshipDisplayComponent]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[EntityRelationshipDisplayComponent]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[EntityRelationshipDisplayComponent] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Entity Relationship Display Components */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJEntityRelationshipDisplayComponent] TO [cdp_Integration], [cdp_Developer]



/* spDelete SQL for MJ: Entity Relationship Display Components */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Relationship Display Components
-- Item: spDeleteMJEntityRelationshipDisplayComponent
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR EntityRelationshipDisplayComponent
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJEntityRelationshipDisplayComponent]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJEntityRelationshipDisplayComponent];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJEntityRelationshipDisplayComponent]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[EntityRelationshipDisplayComponent]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJEntityRelationshipDisplayComponent] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Entity Relationship Display Components */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJEntityRelationshipDisplayComponent] TO [cdp_Integration]



/* Base View SQL for MJ: Entity Settings */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Settings
-- Item: vwEntitySettings
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Entity Settings
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  EntitySetting
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwEntitySettings]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwEntitySettings];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwEntitySettings]
AS
SELECT
    m.*,
    MJEntities_EntityID.[Name] AS [Entity]
FROM
    [${flyway:defaultSchema}].[EntitySetting] AS m
INNER JOIN
    [${flyway:defaultSchema}].[Entity] AS MJEntities_EntityID
  ON
    [m].[EntityID] = MJEntities_EntityID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwEntitySettings] TO [cdp_Integration], [cdp_Developer], [cdp_UI]
    

/* Base View Permissions SQL for MJ: Entity Settings */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Settings
-- Item: Permissions for vwEntitySettings
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwEntitySettings] TO [cdp_Integration], [cdp_Developer], [cdp_UI]

/* spCreate SQL for MJ: Entity Settings */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Settings
-- Item: spCreateMJEntitySetting
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR EntitySetting
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJEntitySetting]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJEntitySetting];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJEntitySetting]
    @ID uniqueidentifier = NULL,
    @EntityID uniqueidentifier,
    @Name nvarchar(100),
    @Value nvarchar(MAX),
    @Comments nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[EntitySetting]
            (
                [ID],
                [EntityID],
                [Name],
                [Value],
                [Comments]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @EntityID,
                @Name,
                @Value,
                @Comments
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[EntitySetting]
            (
                [EntityID],
                [Name],
                [Value],
                [Comments]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @EntityID,
                @Name,
                @Value,
                @Comments
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwEntitySettings] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJEntitySetting] TO [cdp_Integration], [cdp_Developer]
    

/* spCreate Permissions for MJ: Entity Settings */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJEntitySetting] TO [cdp_Integration], [cdp_Developer]



/* spUpdate SQL for MJ: Entity Settings */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Settings
-- Item: spUpdateMJEntitySetting
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR EntitySetting
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJEntitySetting]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJEntitySetting];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJEntitySetting]
    @ID uniqueidentifier,
    @EntityID uniqueidentifier,
    @Name nvarchar(100),
    @Value nvarchar(MAX),
    @Comments nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[EntitySetting]
    SET
        [EntityID] = @EntityID,
        [Name] = @Name,
        [Value] = @Value,
        [Comments] = @Comments
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwEntitySettings] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwEntitySettings]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJEntitySetting] TO [cdp_Integration], [cdp_Developer]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the EntitySetting table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJEntitySetting]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJEntitySetting];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJEntitySetting
ON [${flyway:defaultSchema}].[EntitySetting]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[EntitySetting]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[EntitySetting] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Entity Settings */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJEntitySetting] TO [cdp_Integration], [cdp_Developer]



/* spDelete SQL for MJ: Entity Settings */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Entity Settings
-- Item: spDeleteMJEntitySetting
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR EntitySetting
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJEntitySetting]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJEntitySetting];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJEntitySetting]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[EntitySetting]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJEntitySetting] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Entity Settings */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJEntitySetting] TO [cdp_Integration]



/* Base View SQL for MJ: Environments */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Environments
-- Item: vwEnvironments
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Environments
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  Environment
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwEnvironments]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwEnvironments];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwEnvironments]
AS
SELECT
    m.*
FROM
    [${flyway:defaultSchema}].[Environment] AS m
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwEnvironments] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Environments */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Environments
-- Item: Permissions for vwEnvironments
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwEnvironments] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Environments */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Environments
-- Item: spCreateMJEnvironment
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR Environment
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJEnvironment]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJEnvironment];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJEnvironment]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @IsDefault bit = NULL,
    @Settings nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[Environment]
            (
                [ID],
                [Name],
                [Description],
                [IsDefault],
                [Settings]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description,
                ISNULL(@IsDefault, 0),
                @Settings
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[Environment]
            (
                [Name],
                [Description],
                [IsDefault],
                [Settings]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description,
                ISNULL(@IsDefault, 0),
                @Settings
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwEnvironments] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJEnvironment] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Environments */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJEnvironment] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Environments */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Environments
-- Item: spUpdateMJEnvironment
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR Environment
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJEnvironment]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJEnvironment];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJEnvironment]
    @ID uniqueidentifier,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @IsDefault bit,
    @Settings nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[Environment]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [IsDefault] = @IsDefault,
        [Settings] = @Settings
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwEnvironments] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwEnvironments]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJEnvironment] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the Environment table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJEnvironment]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJEnvironment];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJEnvironment
ON [${flyway:defaultSchema}].[Environment]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[Environment]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[Environment] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Environments */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJEnvironment] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Environments */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Environments
-- Item: spDeleteMJEnvironment
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR Environment
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJEnvironment]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJEnvironment];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJEnvironment]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[Environment]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJEnvironment] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Environments */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJEnvironment] TO [cdp_Integration]



/* Base View SQL for MJ: Error Logs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Error Logs
-- Item: vwErrorLogs
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Error Logs
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  ErrorLog
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwErrorLogs]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwErrorLogs];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwErrorLogs]
AS
SELECT
    m.*,
    MJCompanyIntegrationRuns_CompanyIntegrationRunID.[Integration] AS [CompanyIntegrationRun],
    MJCompanyIntegrationRunDetails_CompanyIntegrationRunDetailID.[RecordID] AS [CompanyIntegrationRunDetail]
FROM
    [${flyway:defaultSchema}].[ErrorLog] AS m
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[vwCompanyIntegrationRuns] AS MJCompanyIntegrationRuns_CompanyIntegrationRunID
  ON
    [m].[CompanyIntegrationRunID] = MJCompanyIntegrationRuns_CompanyIntegrationRunID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[CompanyIntegrationRunDetail] AS MJCompanyIntegrationRunDetails_CompanyIntegrationRunDetailID
  ON
    [m].[CompanyIntegrationRunDetailID] = MJCompanyIntegrationRunDetails_CompanyIntegrationRunDetailID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwErrorLogs] TO [cdp_UI], [cdp_Integration], [cdp_Developer]
    

/* Base View Permissions SQL for MJ: Error Logs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Error Logs
-- Item: Permissions for vwErrorLogs
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwErrorLogs] TO [cdp_UI], [cdp_Integration], [cdp_Developer]

/* spCreate SQL for MJ: Error Logs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Error Logs
-- Item: spCreateMJErrorLog
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR ErrorLog
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJErrorLog]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJErrorLog];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJErrorLog]
    @ID uniqueidentifier = NULL,
    @CompanyIntegrationRunID uniqueidentifier,
    @CompanyIntegrationRunDetailID uniqueidentifier,
    @Code nchar(20),
    @Message nvarchar(MAX),
    @CreatedBy nvarchar(50),
    @Status nvarchar(10),
    @Category nvarchar(20),
    @Details nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[ErrorLog]
            (
                [ID],
                [CompanyIntegrationRunID],
                [CompanyIntegrationRunDetailID],
                [Code],
                [Message],
                [CreatedBy],
                [Status],
                [Category],
                [Details]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @CompanyIntegrationRunID,
                @CompanyIntegrationRunDetailID,
                @Code,
                @Message,
                @CreatedBy,
                @Status,
                @Category,
                @Details
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[ErrorLog]
            (
                [CompanyIntegrationRunID],
                [CompanyIntegrationRunDetailID],
                [Code],
                [Message],
                [CreatedBy],
                [Status],
                [Category],
                [Details]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @CompanyIntegrationRunID,
                @CompanyIntegrationRunDetailID,
                @Code,
                @Message,
                @CreatedBy,
                @Status,
                @Category,
                @Details
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwErrorLogs] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJErrorLog] TO [cdp_Integration], [cdp_Developer]
    

/* spCreate Permissions for MJ: Error Logs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJErrorLog] TO [cdp_Integration], [cdp_Developer]



/* spUpdate SQL for MJ: Error Logs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Error Logs
-- Item: spUpdateMJErrorLog
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR ErrorLog
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJErrorLog]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJErrorLog];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJErrorLog]
    @ID uniqueidentifier,
    @CompanyIntegrationRunID uniqueidentifier,
    @CompanyIntegrationRunDetailID uniqueidentifier,
    @Code nchar(20),
    @Message nvarchar(MAX),
    @CreatedBy nvarchar(50),
    @Status nvarchar(10),
    @Category nvarchar(20),
    @Details nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ErrorLog]
    SET
        [CompanyIntegrationRunID] = @CompanyIntegrationRunID,
        [CompanyIntegrationRunDetailID] = @CompanyIntegrationRunDetailID,
        [Code] = @Code,
        [Message] = @Message,
        [CreatedBy] = @CreatedBy,
        [Status] = @Status,
        [Category] = @Category,
        [Details] = @Details
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwErrorLogs] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwErrorLogs]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJErrorLog] TO [cdp_Integration], [cdp_Developer]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the ErrorLog table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJErrorLog]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJErrorLog];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJErrorLog
ON [${flyway:defaultSchema}].[ErrorLog]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ErrorLog]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[ErrorLog] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Error Logs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJErrorLog] TO [cdp_Integration], [cdp_Developer]



/* spDelete SQL for MJ: Error Logs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Error Logs
-- Item: spDeleteMJErrorLog
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR ErrorLog
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJErrorLog]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJErrorLog];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJErrorLog]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[ErrorLog]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJErrorLog] TO [cdp_Integration], [cdp_Developer]
    

/* spDelete Permissions for MJ: Error Logs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJErrorLog] TO [cdp_Integration], [cdp_Developer]



/* Base View SQL for MJ: Explorer Navigation Items */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Explorer Navigation Items
-- Item: vwExplorerNavigationItems
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Explorer Navigation Items
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  ExplorerNavigationItem
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwExplorerNavigationItems]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwExplorerNavigationItems];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwExplorerNavigationItems]
AS
SELECT
    m.*
FROM
    [${flyway:defaultSchema}].[ExplorerNavigationItem] AS m
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwExplorerNavigationItems] TO [cdp_UI], [cdp_Integration], [cdp_Developer]
    

/* Base View Permissions SQL for MJ: Explorer Navigation Items */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Explorer Navigation Items
-- Item: Permissions for vwExplorerNavigationItems
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwExplorerNavigationItems] TO [cdp_UI], [cdp_Integration], [cdp_Developer]

/* spCreate SQL for MJ: Explorer Navigation Items */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Explorer Navigation Items
-- Item: spCreateMJExplorerNavigationItem
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR ExplorerNavigationItem
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJExplorerNavigationItem]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJExplorerNavigationItem];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJExplorerNavigationItem]
    @ID uniqueidentifier = NULL,
    @Sequence int,
    @Name nvarchar(100),
    @Route nvarchar(255),
    @IsActive bit = NULL,
    @ShowInHomeScreen bit = NULL,
    @ShowInNavigationDrawer bit = NULL,
    @IconCSSClass nvarchar(100),
    @Description nvarchar(MAX),
    @Comments nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[ExplorerNavigationItem]
            (
                [ID],
                [Sequence],
                [Name],
                [Route],
                [IsActive],
                [ShowInHomeScreen],
                [ShowInNavigationDrawer],
                [IconCSSClass],
                [Description],
                [Comments]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Sequence,
                @Name,
                @Route,
                ISNULL(@IsActive, 1),
                ISNULL(@ShowInHomeScreen, 0),
                ISNULL(@ShowInNavigationDrawer, 0),
                @IconCSSClass,
                @Description,
                @Comments
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[ExplorerNavigationItem]
            (
                [Sequence],
                [Name],
                [Route],
                [IsActive],
                [ShowInHomeScreen],
                [ShowInNavigationDrawer],
                [IconCSSClass],
                [Description],
                [Comments]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Sequence,
                @Name,
                @Route,
                ISNULL(@IsActive, 1),
                ISNULL(@ShowInHomeScreen, 0),
                ISNULL(@ShowInNavigationDrawer, 0),
                @IconCSSClass,
                @Description,
                @Comments
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwExplorerNavigationItems] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJExplorerNavigationItem] TO [cdp_Integration], [cdp_Developer]
    

/* spCreate Permissions for MJ: Explorer Navigation Items */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJExplorerNavigationItem] TO [cdp_Integration], [cdp_Developer]



/* spUpdate SQL for MJ: Explorer Navigation Items */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Explorer Navigation Items
-- Item: spUpdateMJExplorerNavigationItem
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR ExplorerNavigationItem
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJExplorerNavigationItem]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJExplorerNavigationItem];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJExplorerNavigationItem]
    @ID uniqueidentifier,
    @Sequence int,
    @Name nvarchar(100),
    @Route nvarchar(255),
    @IsActive bit,
    @ShowInHomeScreen bit,
    @ShowInNavigationDrawer bit,
    @IconCSSClass nvarchar(100),
    @Description nvarchar(MAX),
    @Comments nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ExplorerNavigationItem]
    SET
        [Sequence] = @Sequence,
        [Name] = @Name,
        [Route] = @Route,
        [IsActive] = @IsActive,
        [ShowInHomeScreen] = @ShowInHomeScreen,
        [ShowInNavigationDrawer] = @ShowInNavigationDrawer,
        [IconCSSClass] = @IconCSSClass,
        [Description] = @Description,
        [Comments] = @Comments
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwExplorerNavigationItems] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwExplorerNavigationItems]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJExplorerNavigationItem] TO [cdp_Integration], [cdp_Developer]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the ExplorerNavigationItem table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJExplorerNavigationItem]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJExplorerNavigationItem];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJExplorerNavigationItem
ON [${flyway:defaultSchema}].[ExplorerNavigationItem]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ExplorerNavigationItem]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[ExplorerNavigationItem] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Explorer Navigation Items */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJExplorerNavigationItem] TO [cdp_Integration], [cdp_Developer]



/* spDelete SQL for MJ: Explorer Navigation Items */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Explorer Navigation Items
-- Item: spDeleteMJExplorerNavigationItem
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR ExplorerNavigationItem
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJExplorerNavigationItem]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJExplorerNavigationItem];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJExplorerNavigationItem]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[ExplorerNavigationItem]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJExplorerNavigationItem] TO [cdp_Integration], [cdp_Developer]
    

/* spDelete Permissions for MJ: Explorer Navigation Items */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJExplorerNavigationItem] TO [cdp_Integration], [cdp_Developer]



/* Base View SQL for MJ: File Entity Record Links */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: File Entity Record Links
-- Item: vwFileEntityRecordLinks
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: File Entity Record Links
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  FileEntityRecordLink
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwFileEntityRecordLinks]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwFileEntityRecordLinks];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwFileEntityRecordLinks]
AS
SELECT
    m.*,
    MJFiles_FileID.[Name] AS [File],
    MJEntities_EntityID.[Name] AS [Entity]
FROM
    [${flyway:defaultSchema}].[FileEntityRecordLink] AS m
INNER JOIN
    [${flyway:defaultSchema}].[File] AS MJFiles_FileID
  ON
    [m].[FileID] = MJFiles_FileID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[Entity] AS MJEntities_EntityID
  ON
    [m].[EntityID] = MJEntities_EntityID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwFileEntityRecordLinks] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: File Entity Record Links */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: File Entity Record Links
-- Item: Permissions for vwFileEntityRecordLinks
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwFileEntityRecordLinks] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: File Entity Record Links */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: File Entity Record Links
-- Item: spCreateMJFileEntityRecordLink
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR FileEntityRecordLink
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJFileEntityRecordLink]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJFileEntityRecordLink];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJFileEntityRecordLink]
    @ID uniqueidentifier = NULL,
    @FileID uniqueidentifier,
    @EntityID uniqueidentifier,
    @RecordID nvarchar(750)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[FileEntityRecordLink]
            (
                [ID],
                [FileID],
                [EntityID],
                [RecordID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @FileID,
                @EntityID,
                @RecordID
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[FileEntityRecordLink]
            (
                [FileID],
                [EntityID],
                [RecordID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @FileID,
                @EntityID,
                @RecordID
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwFileEntityRecordLinks] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJFileEntityRecordLink] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: File Entity Record Links */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJFileEntityRecordLink] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: File Entity Record Links */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: File Entity Record Links
-- Item: spUpdateMJFileEntityRecordLink
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR FileEntityRecordLink
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJFileEntityRecordLink]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJFileEntityRecordLink];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJFileEntityRecordLink]
    @ID uniqueidentifier,
    @FileID uniqueidentifier,
    @EntityID uniqueidentifier,
    @RecordID nvarchar(750)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[FileEntityRecordLink]
    SET
        [FileID] = @FileID,
        [EntityID] = @EntityID,
        [RecordID] = @RecordID
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwFileEntityRecordLinks] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwFileEntityRecordLinks]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJFileEntityRecordLink] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the FileEntityRecordLink table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJFileEntityRecordLink]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJFileEntityRecordLink];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJFileEntityRecordLink
ON [${flyway:defaultSchema}].[FileEntityRecordLink]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[FileEntityRecordLink]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[FileEntityRecordLink] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: File Entity Record Links */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJFileEntityRecordLink] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: File Entity Record Links */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: File Entity Record Links
-- Item: spDeleteMJFileEntityRecordLink
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR FileEntityRecordLink
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJFileEntityRecordLink]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJFileEntityRecordLink];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJFileEntityRecordLink]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[FileEntityRecordLink]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJFileEntityRecordLink] TO [cdp_Developer], [cdp_Integration]
    

/* spDelete Permissions for MJ: File Entity Record Links */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJFileEntityRecordLink] TO [cdp_Developer], [cdp_Integration]



/* Base View SQL for MJ: File Storage Providers */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: File Storage Providers
-- Item: vwFileStorageProviders
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: File Storage Providers
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  FileStorageProvider
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwFileStorageProviders]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwFileStorageProviders];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwFileStorageProviders]
AS
SELECT
    m.*
FROM
    [${flyway:defaultSchema}].[FileStorageProvider] AS m
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwFileStorageProviders] TO [cdp_UI], [cdp_Integration], [cdp_Developer]
    

/* Base View Permissions SQL for MJ: File Storage Providers */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: File Storage Providers
-- Item: Permissions for vwFileStorageProviders
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwFileStorageProviders] TO [cdp_UI], [cdp_Integration], [cdp_Developer]

/* spCreate SQL for MJ: File Storage Providers */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: File Storage Providers
-- Item: spCreateMJFileStorageProvider
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR FileStorageProvider
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJFileStorageProvider]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJFileStorageProvider];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJFileStorageProvider]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(50),
    @Description nvarchar(MAX),
    @ServerDriverKey nvarchar(100),
    @ClientDriverKey nvarchar(100),
    @Priority int = NULL,
    @IsActive bit = NULL,
    @SupportsSearch bit = NULL,
    @Configuration nvarchar(MAX),
    @RequiresOAuth bit = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[FileStorageProvider]
            (
                [ID],
                [Name],
                [Description],
                [ServerDriverKey],
                [ClientDriverKey],
                [Priority],
                [IsActive],
                [SupportsSearch],
                [Configuration],
                [RequiresOAuth]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description,
                @ServerDriverKey,
                @ClientDriverKey,
                ISNULL(@Priority, 0),
                ISNULL(@IsActive, 1),
                ISNULL(@SupportsSearch, 0),
                @Configuration,
                ISNULL(@RequiresOAuth, 0)
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[FileStorageProvider]
            (
                [Name],
                [Description],
                [ServerDriverKey],
                [ClientDriverKey],
                [Priority],
                [IsActive],
                [SupportsSearch],
                [Configuration],
                [RequiresOAuth]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description,
                @ServerDriverKey,
                @ClientDriverKey,
                ISNULL(@Priority, 0),
                ISNULL(@IsActive, 1),
                ISNULL(@SupportsSearch, 0),
                @Configuration,
                ISNULL(@RequiresOAuth, 0)
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwFileStorageProviders] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJFileStorageProvider] TO [cdp_Integration], [cdp_Developer]
    

/* spCreate Permissions for MJ: File Storage Providers */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJFileStorageProvider] TO [cdp_Integration], [cdp_Developer]



/* spUpdate SQL for MJ: File Storage Providers */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: File Storage Providers
-- Item: spUpdateMJFileStorageProvider
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR FileStorageProvider
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJFileStorageProvider]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJFileStorageProvider];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJFileStorageProvider]
    @ID uniqueidentifier,
    @Name nvarchar(50),
    @Description nvarchar(MAX),
    @ServerDriverKey nvarchar(100),
    @ClientDriverKey nvarchar(100),
    @Priority int,
    @IsActive bit,
    @SupportsSearch bit,
    @Configuration nvarchar(MAX),
    @RequiresOAuth bit
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[FileStorageProvider]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [ServerDriverKey] = @ServerDriverKey,
        [ClientDriverKey] = @ClientDriverKey,
        [Priority] = @Priority,
        [IsActive] = @IsActive,
        [SupportsSearch] = @SupportsSearch,
        [Configuration] = @Configuration,
        [RequiresOAuth] = @RequiresOAuth
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwFileStorageProviders] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwFileStorageProviders]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJFileStorageProvider] TO [cdp_Integration], [cdp_Developer]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the FileStorageProvider table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJFileStorageProvider]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJFileStorageProvider];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJFileStorageProvider
ON [${flyway:defaultSchema}].[FileStorageProvider]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[FileStorageProvider]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[FileStorageProvider] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: File Storage Providers */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJFileStorageProvider] TO [cdp_Integration], [cdp_Developer]



/* spDelete SQL for MJ: File Storage Providers */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: File Storage Providers
-- Item: spDeleteMJFileStorageProvider
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR FileStorageProvider
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJFileStorageProvider]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJFileStorageProvider];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJFileStorageProvider]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[FileStorageProvider]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJFileStorageProvider] TO [cdp_Integration], [cdp_Developer]
    

/* spDelete Permissions for MJ: File Storage Providers */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJFileStorageProvider] TO [cdp_Integration], [cdp_Developer]



/* Base View SQL for MJ: File Categories */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: File Categories
-- Item: vwFileCategories
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: File Categories
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  FileCategory
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwFileCategories]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwFileCategories];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwFileCategories]
AS
SELECT
    m.*,
    MJFileCategories_ParentID.[Name] AS [Parent],
    root_ParentID.RootID AS [RootParentID]
FROM
    [${flyway:defaultSchema}].[FileCategory] AS m
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[FileCategory] AS MJFileCategories_ParentID
  ON
    [m].[ParentID] = MJFileCategories_ParentID.[ID]
OUTER APPLY
    [${flyway:defaultSchema}].[fnFileCategoryParentID_GetRootID]([m].[ID], [m].[ParentID]) AS root_ParentID
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwFileCategories] TO [cdp_UI], [cdp_Integration], [cdp_Developer]
    

/* Base View Permissions SQL for MJ: File Categories */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: File Categories
-- Item: Permissions for vwFileCategories
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwFileCategories] TO [cdp_UI], [cdp_Integration], [cdp_Developer]

/* spCreate SQL for MJ: File Categories */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: File Categories
-- Item: spCreateMJFileCategory
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR FileCategory
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJFileCategory]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJFileCategory];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJFileCategory]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(255),
    @ParentID uniqueidentifier,
    @Description nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[FileCategory]
            (
                [ID],
                [Name],
                [ParentID],
                [Description]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @ParentID,
                @Description
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[FileCategory]
            (
                [Name],
                [ParentID],
                [Description]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @ParentID,
                @Description
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwFileCategories] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJFileCategory] TO [cdp_Integration], [cdp_Developer]
    

/* spCreate Permissions for MJ: File Categories */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJFileCategory] TO [cdp_Integration], [cdp_Developer]



/* spUpdate SQL for MJ: File Categories */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: File Categories
-- Item: spUpdateMJFileCategory
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR FileCategory
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJFileCategory]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJFileCategory];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJFileCategory]
    @ID uniqueidentifier,
    @Name nvarchar(255),
    @ParentID uniqueidentifier,
    @Description nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[FileCategory]
    SET
        [Name] = @Name,
        [ParentID] = @ParentID,
        [Description] = @Description
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwFileCategories] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwFileCategories]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJFileCategory] TO [cdp_UI], [cdp_Integration], [cdp_Developer]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the FileCategory table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJFileCategory]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJFileCategory];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJFileCategory
ON [${flyway:defaultSchema}].[FileCategory]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[FileCategory]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[FileCategory] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: File Categories */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJFileCategory] TO [cdp_UI], [cdp_Integration], [cdp_Developer]



/* spDelete SQL for MJ: File Categories */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: File Categories
-- Item: spDeleteMJFileCategory
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR FileCategory
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJFileCategory]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJFileCategory];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJFileCategory]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[FileCategory]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJFileCategory] TO [cdp_UI], [cdp_Integration], [cdp_Developer]
    

/* spDelete Permissions for MJ: File Categories */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJFileCategory] TO [cdp_UI], [cdp_Integration], [cdp_Developer]



/* Base View SQL for MJ: File Storage Accounts */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: File Storage Accounts
-- Item: vwFileStorageAccounts
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: File Storage Accounts
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  FileStorageAccount
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwFileStorageAccounts]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwFileStorageAccounts];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwFileStorageAccounts]
AS
SELECT
    m.*,
    MJFileStorageProviders_ProviderID.[Name] AS [Provider],
    MJCredentials_CredentialID.[Name] AS [Credential]
FROM
    [${flyway:defaultSchema}].[FileStorageAccount] AS m
INNER JOIN
    [${flyway:defaultSchema}].[FileStorageProvider] AS MJFileStorageProviders_ProviderID
  ON
    [m].[ProviderID] = MJFileStorageProviders_ProviderID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[Credential] AS MJCredentials_CredentialID
  ON
    [m].[CredentialID] = MJCredentials_CredentialID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwFileStorageAccounts] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: File Storage Accounts */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: File Storage Accounts
-- Item: Permissions for vwFileStorageAccounts
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwFileStorageAccounts] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: File Storage Accounts */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: File Storage Accounts
-- Item: spCreateMJFileStorageAccount
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR FileStorageAccount
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJFileStorageAccount]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJFileStorageAccount];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJFileStorageAccount]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(200),
    @Description nvarchar(MAX),
    @ProviderID uniqueidentifier,
    @CredentialID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[FileStorageAccount]
            (
                [ID],
                [Name],
                [Description],
                [ProviderID],
                [CredentialID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description,
                @ProviderID,
                @CredentialID
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[FileStorageAccount]
            (
                [Name],
                [Description],
                [ProviderID],
                [CredentialID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description,
                @ProviderID,
                @CredentialID
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwFileStorageAccounts] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJFileStorageAccount] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: File Storage Accounts */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJFileStorageAccount] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: File Storage Accounts */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: File Storage Accounts
-- Item: spUpdateMJFileStorageAccount
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR FileStorageAccount
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJFileStorageAccount]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJFileStorageAccount];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJFileStorageAccount]
    @ID uniqueidentifier,
    @Name nvarchar(200),
    @Description nvarchar(MAX),
    @ProviderID uniqueidentifier,
    @CredentialID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[FileStorageAccount]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [ProviderID] = @ProviderID,
        [CredentialID] = @CredentialID
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwFileStorageAccounts] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwFileStorageAccounts]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJFileStorageAccount] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the FileStorageAccount table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJFileStorageAccount]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJFileStorageAccount];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJFileStorageAccount
ON [${flyway:defaultSchema}].[FileStorageAccount]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[FileStorageAccount]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[FileStorageAccount] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: File Storage Accounts */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJFileStorageAccount] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: File Storage Accounts */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: File Storage Accounts
-- Item: spDeleteMJFileStorageAccount
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR FileStorageAccount
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJFileStorageAccount]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJFileStorageAccount];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJFileStorageAccount]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[FileStorageAccount]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJFileStorageAccount] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: File Storage Accounts */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJFileStorageAccount] TO [cdp_Integration]



/* Base View SQL for MJ: Generated Code Categories */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Generated Code Categories
-- Item: vwGeneratedCodeCategories
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Generated Code Categories
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  GeneratedCodeCategory
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwGeneratedCodeCategories]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwGeneratedCodeCategories];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwGeneratedCodeCategories]
AS
SELECT
    m.*,
    MJGeneratedCodeCategories_ParentID.[Name] AS [Parent],
    root_ParentID.RootID AS [RootParentID]
FROM
    [${flyway:defaultSchema}].[GeneratedCodeCategory] AS m
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[GeneratedCodeCategory] AS MJGeneratedCodeCategories_ParentID
  ON
    [m].[ParentID] = MJGeneratedCodeCategories_ParentID.[ID]
OUTER APPLY
    [${flyway:defaultSchema}].[fnGeneratedCodeCategoryParentID_GetRootID]([m].[ID], [m].[ParentID]) AS root_ParentID
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwGeneratedCodeCategories] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Generated Code Categories */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Generated Code Categories
-- Item: Permissions for vwGeneratedCodeCategories
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwGeneratedCodeCategories] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Generated Code Categories */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Generated Code Categories
-- Item: spCreateMJGeneratedCodeCategory
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR GeneratedCodeCategory
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJGeneratedCodeCategory]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJGeneratedCodeCategory];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJGeneratedCodeCategory]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @ParentID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[GeneratedCodeCategory]
            (
                [ID],
                [Name],
                [Description],
                [ParentID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description,
                @ParentID
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[GeneratedCodeCategory]
            (
                [Name],
                [Description],
                [ParentID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description,
                @ParentID
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwGeneratedCodeCategories] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJGeneratedCodeCategory] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Generated Code Categories */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJGeneratedCodeCategory] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Generated Code Categories */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Generated Code Categories
-- Item: spUpdateMJGeneratedCodeCategory
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR GeneratedCodeCategory
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJGeneratedCodeCategory]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJGeneratedCodeCategory];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJGeneratedCodeCategory]
    @ID uniqueidentifier,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @ParentID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[GeneratedCodeCategory]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [ParentID] = @ParentID
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwGeneratedCodeCategories] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwGeneratedCodeCategories]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJGeneratedCodeCategory] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the GeneratedCodeCategory table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJGeneratedCodeCategory]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJGeneratedCodeCategory];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJGeneratedCodeCategory
ON [${flyway:defaultSchema}].[GeneratedCodeCategory]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[GeneratedCodeCategory]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[GeneratedCodeCategory] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Generated Code Categories */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJGeneratedCodeCategory] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Generated Code Categories */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Generated Code Categories
-- Item: spDeleteMJGeneratedCodeCategory
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR GeneratedCodeCategory
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJGeneratedCodeCategory]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJGeneratedCodeCategory];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJGeneratedCodeCategory]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[GeneratedCodeCategory]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJGeneratedCodeCategory] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Generated Code Categories */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJGeneratedCodeCategory] TO [cdp_Integration]



/* Base View SQL for MJ: Files */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Files
-- Item: vwFiles
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Files
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  File
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwFiles]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwFiles];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwFiles]
AS
SELECT
    m.*,
    MJFileCategories_CategoryID.[Name] AS [Category],
    MJFileStorageProviders_ProviderID.[Name] AS [Provider]
FROM
    [${flyway:defaultSchema}].[File] AS m
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[FileCategory] AS MJFileCategories_CategoryID
  ON
    [m].[CategoryID] = MJFileCategories_CategoryID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[FileStorageProvider] AS MJFileStorageProviders_ProviderID
  ON
    [m].[ProviderID] = MJFileStorageProviders_ProviderID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwFiles] TO [cdp_Integration], [cdp_UI], [cdp_Developer]
    

/* Base View Permissions SQL for MJ: Files */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Files
-- Item: Permissions for vwFiles
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwFiles] TO [cdp_Integration], [cdp_UI], [cdp_Developer]

/* spCreate SQL for MJ: Files */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Files
-- Item: spCreateMJFile
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR File
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJFile]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJFile];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJFile]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(500),
    @Description nvarchar(MAX),
    @CategoryID uniqueidentifier,
    @ProviderID uniqueidentifier,
    @ContentType nvarchar(255),
    @ProviderKey nvarchar(500),
    @Status nvarchar(20) = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[File]
            (
                [ID],
                [Name],
                [Description],
                [CategoryID],
                [ProviderID],
                [ContentType],
                [ProviderKey],
                [Status]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description,
                @CategoryID,
                @ProviderID,
                @ContentType,
                @ProviderKey,
                ISNULL(@Status, 'Pending')
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[File]
            (
                [Name],
                [Description],
                [CategoryID],
                [ProviderID],
                [ContentType],
                [ProviderKey],
                [Status]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description,
                @CategoryID,
                @ProviderID,
                @ContentType,
                @ProviderKey,
                ISNULL(@Status, 'Pending')
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwFiles] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJFile] TO [cdp_Integration], [cdp_Developer]
    

/* spCreate Permissions for MJ: Files */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJFile] TO [cdp_Integration], [cdp_Developer]



/* spUpdate SQL for MJ: Files */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Files
-- Item: spUpdateMJFile
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR File
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJFile]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJFile];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJFile]
    @ID uniqueidentifier,
    @Name nvarchar(500),
    @Description nvarchar(MAX),
    @CategoryID uniqueidentifier,
    @ProviderID uniqueidentifier,
    @ContentType nvarchar(255),
    @ProviderKey nvarchar(500),
    @Status nvarchar(20)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[File]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [CategoryID] = @CategoryID,
        [ProviderID] = @ProviderID,
        [ContentType] = @ContentType,
        [ProviderKey] = @ProviderKey,
        [Status] = @Status
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwFiles] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwFiles]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJFile] TO [cdp_Integration], [cdp_Developer]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the File table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJFile]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJFile];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJFile
ON [${flyway:defaultSchema}].[File]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[File]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[File] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Files */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJFile] TO [cdp_Integration], [cdp_Developer]



/* spDelete SQL for MJ: Files */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Files
-- Item: spDeleteMJFile
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR File
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJFile]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJFile];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJFile]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[File]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJFile] TO [cdp_Integration], [cdp_Developer]
    

/* spDelete Permissions for MJ: Files */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJFile] TO [cdp_Integration], [cdp_Developer]



/* Base View SQL for MJ: Generated Codes */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Generated Codes
-- Item: vwGeneratedCodes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Generated Codes
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  GeneratedCode
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwGeneratedCodes]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwGeneratedCodes];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwGeneratedCodes]
AS
SELECT
    m.*,
    MJGeneratedCodeCategories_CategoryID.[Name] AS [Category],
    MJAIModels_GeneratedByModelID.[Name] AS [GeneratedByModel],
    MJEntities_LinkedEntityID.[Name] AS [LinkedEntity]
FROM
    [${flyway:defaultSchema}].[GeneratedCode] AS m
INNER JOIN
    [${flyway:defaultSchema}].[GeneratedCodeCategory] AS MJGeneratedCodeCategories_CategoryID
  ON
    [m].[CategoryID] = MJGeneratedCodeCategories_CategoryID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[AIModel] AS MJAIModels_GeneratedByModelID
  ON
    [m].[GeneratedByModelID] = MJAIModels_GeneratedByModelID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[Entity] AS MJEntities_LinkedEntityID
  ON
    [m].[LinkedEntityID] = MJEntities_LinkedEntityID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwGeneratedCodes] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Generated Codes */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Generated Codes
-- Item: Permissions for vwGeneratedCodes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwGeneratedCodes] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Generated Codes */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Generated Codes
-- Item: spCreateMJGeneratedCode
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR GeneratedCode
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJGeneratedCode]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJGeneratedCode];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJGeneratedCode]
    @ID uniqueidentifier = NULL,
    @GeneratedAt datetimeoffset = NULL,
    @CategoryID uniqueidentifier,
    @GeneratedByModelID uniqueidentifier,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @Code nvarchar(MAX),
    @Source nvarchar(MAX),
    @LinkedEntityID uniqueidentifier,
    @LinkedRecordPrimaryKey nvarchar(MAX),
    @Status nvarchar(20) = NULL,
    @Language nvarchar(50) = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[GeneratedCode]
            (
                [ID],
                [GeneratedAt],
                [CategoryID],
                [GeneratedByModelID],
                [Name],
                [Description],
                [Code],
                [Source],
                [LinkedEntityID],
                [LinkedRecordPrimaryKey],
                [Status],
                [Language]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                ISNULL(@GeneratedAt, getutcdate()),
                @CategoryID,
                @GeneratedByModelID,
                @Name,
                @Description,
                @Code,
                @Source,
                @LinkedEntityID,
                @LinkedRecordPrimaryKey,
                ISNULL(@Status, 'Pending'),
                ISNULL(@Language, 'TypeScript')
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[GeneratedCode]
            (
                [GeneratedAt],
                [CategoryID],
                [GeneratedByModelID],
                [Name],
                [Description],
                [Code],
                [Source],
                [LinkedEntityID],
                [LinkedRecordPrimaryKey],
                [Status],
                [Language]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                ISNULL(@GeneratedAt, getutcdate()),
                @CategoryID,
                @GeneratedByModelID,
                @Name,
                @Description,
                @Code,
                @Source,
                @LinkedEntityID,
                @LinkedRecordPrimaryKey,
                ISNULL(@Status, 'Pending'),
                ISNULL(@Language, 'TypeScript')
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwGeneratedCodes] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJGeneratedCode] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Generated Codes */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJGeneratedCode] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Generated Codes */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Generated Codes
-- Item: spUpdateMJGeneratedCode
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR GeneratedCode
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJGeneratedCode]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJGeneratedCode];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJGeneratedCode]
    @ID uniqueidentifier,
    @GeneratedAt datetimeoffset,
    @CategoryID uniqueidentifier,
    @GeneratedByModelID uniqueidentifier,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @Code nvarchar(MAX),
    @Source nvarchar(MAX),
    @LinkedEntityID uniqueidentifier,
    @LinkedRecordPrimaryKey nvarchar(MAX),
    @Status nvarchar(20),
    @Language nvarchar(50)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[GeneratedCode]
    SET
        [GeneratedAt] = @GeneratedAt,
        [CategoryID] = @CategoryID,
        [GeneratedByModelID] = @GeneratedByModelID,
        [Name] = @Name,
        [Description] = @Description,
        [Code] = @Code,
        [Source] = @Source,
        [LinkedEntityID] = @LinkedEntityID,
        [LinkedRecordPrimaryKey] = @LinkedRecordPrimaryKey,
        [Status] = @Status,
        [Language] = @Language
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwGeneratedCodes] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwGeneratedCodes]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJGeneratedCode] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the GeneratedCode table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJGeneratedCode]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJGeneratedCode];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJGeneratedCode
ON [${flyway:defaultSchema}].[GeneratedCode]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[GeneratedCode]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[GeneratedCode] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Generated Codes */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJGeneratedCode] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Generated Codes */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Generated Codes
-- Item: spDeleteMJGeneratedCode
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR GeneratedCode
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJGeneratedCode]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJGeneratedCode];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJGeneratedCode]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[GeneratedCode]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJGeneratedCode] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Generated Codes */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJGeneratedCode] TO [cdp_Integration]



/* Base View SQL for MJ: Integrations */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Integrations
-- Item: vwIntegrations
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Integrations
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  Integration
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwIntegrations]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwIntegrations];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwIntegrations]
AS
SELECT
    m.*
FROM
    [${flyway:defaultSchema}].[Integration] AS m
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwIntegrations] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Integrations */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Integrations
-- Item: Permissions for vwIntegrations
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwIntegrations] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Integrations */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Integrations
-- Item: spCreateMJIntegration
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR Integration
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJIntegration]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJIntegration];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJIntegration]
    @Name nvarchar(100),
    @Description nvarchar(255),
    @NavigationBaseURL nvarchar(500),
    @ClassName nvarchar(100),
    @ImportPath nvarchar(100),
    @BatchMaxRequestCount int = NULL,
    @BatchRequestWaitTime int = NULL,
    @ID uniqueidentifier = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[Integration]
            (
                [ID],
                [Name],
                [Description],
                [NavigationBaseURL],
                [ClassName],
                [ImportPath],
                [BatchMaxRequestCount],
                [BatchRequestWaitTime]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description,
                @NavigationBaseURL,
                @ClassName,
                @ImportPath,
                ISNULL(@BatchMaxRequestCount, -1),
                ISNULL(@BatchRequestWaitTime, -1)
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[Integration]
            (
                [Name],
                [Description],
                [NavigationBaseURL],
                [ClassName],
                [ImportPath],
                [BatchMaxRequestCount],
                [BatchRequestWaitTime]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description,
                @NavigationBaseURL,
                @ClassName,
                @ImportPath,
                ISNULL(@BatchMaxRequestCount, -1),
                ISNULL(@BatchRequestWaitTime, -1)
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwIntegrations] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJIntegration] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Integrations */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJIntegration] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Integrations */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Integrations
-- Item: spUpdateMJIntegration
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR Integration
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJIntegration]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJIntegration];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJIntegration]
    @Name nvarchar(100),
    @Description nvarchar(255),
    @NavigationBaseURL nvarchar(500),
    @ClassName nvarchar(100),
    @ImportPath nvarchar(100),
    @BatchMaxRequestCount int,
    @BatchRequestWaitTime int,
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[Integration]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [NavigationBaseURL] = @NavigationBaseURL,
        [ClassName] = @ClassName,
        [ImportPath] = @ImportPath,
        [BatchMaxRequestCount] = @BatchMaxRequestCount,
        [BatchRequestWaitTime] = @BatchRequestWaitTime
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwIntegrations] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwIntegrations]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJIntegration] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the Integration table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJIntegration]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJIntegration];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJIntegration
ON [${flyway:defaultSchema}].[Integration]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[Integration]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[Integration] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Integrations */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJIntegration] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Integrations */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Integrations
-- Item: spDeleteMJIntegration
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR Integration
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJIntegration]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJIntegration];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJIntegration]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[Integration]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJIntegration] TO [cdp_Developer], [cdp_Integration]
    

/* spDelete Permissions for MJ: Integrations */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJIntegration] TO [cdp_Developer], [cdp_Integration]



/* Base View SQL for MJ: List Details */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: List Details
-- Item: vwListDetails
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: List Details
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  ListDetail
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwListDetails]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwListDetails];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwListDetails]
AS
SELECT
    m.*,
    MJLists_ListID.[Name] AS [List]
FROM
    [${flyway:defaultSchema}].[ListDetail] AS m
INNER JOIN
    [${flyway:defaultSchema}].[List] AS MJLists_ListID
  ON
    [m].[ListID] = MJLists_ListID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwListDetails] TO [cdp_Integration], [cdp_UI], [cdp_Developer]
    

/* Base View Permissions SQL for MJ: List Details */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: List Details
-- Item: Permissions for vwListDetails
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwListDetails] TO [cdp_Integration], [cdp_UI], [cdp_Developer]

/* spCreate SQL for MJ: List Details */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: List Details
-- Item: spCreateMJListDetail
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR ListDetail
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJListDetail]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJListDetail];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJListDetail]
    @ID uniqueidentifier = NULL,
    @ListID uniqueidentifier,
    @RecordID nvarchar(445),
    @Sequence int = NULL,
    @Status nvarchar(30) = NULL,
    @AdditionalData nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[ListDetail]
            (
                [ID],
                [ListID],
                [RecordID],
                [Sequence],
                [Status],
                [AdditionalData]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @ListID,
                @RecordID,
                ISNULL(@Sequence, 0),
                ISNULL(@Status, 'Pending'),
                @AdditionalData
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[ListDetail]
            (
                [ListID],
                [RecordID],
                [Sequence],
                [Status],
                [AdditionalData]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ListID,
                @RecordID,
                ISNULL(@Sequence, 0),
                ISNULL(@Status, 'Pending'),
                @AdditionalData
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwListDetails] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJListDetail] TO [cdp_Integration], [cdp_Developer]
    

/* spCreate Permissions for MJ: List Details */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJListDetail] TO [cdp_Integration], [cdp_Developer]



/* spUpdate SQL for MJ: List Details */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: List Details
-- Item: spUpdateMJListDetail
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR ListDetail
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJListDetail]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJListDetail];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJListDetail]
    @ID uniqueidentifier,
    @ListID uniqueidentifier,
    @RecordID nvarchar(445),
    @Sequence int,
    @Status nvarchar(30),
    @AdditionalData nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ListDetail]
    SET
        [ListID] = @ListID,
        [RecordID] = @RecordID,
        [Sequence] = @Sequence,
        [Status] = @Status,
        [AdditionalData] = @AdditionalData
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwListDetails] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwListDetails]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJListDetail] TO [cdp_Integration], [cdp_Developer]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the ListDetail table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJListDetail]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJListDetail];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJListDetail
ON [${flyway:defaultSchema}].[ListDetail]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ListDetail]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[ListDetail] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: List Details */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJListDetail] TO [cdp_Integration], [cdp_Developer]



/* spDelete SQL for MJ: List Details */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: List Details
-- Item: spDeleteMJListDetail
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR ListDetail
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJListDetail]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJListDetail];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJListDetail]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[ListDetail]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJListDetail] TO [cdp_Integration], [cdp_Developer]
    

/* spDelete Permissions for MJ: List Details */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJListDetail] TO [cdp_Integration], [cdp_Developer]



/* Base View SQL for MJ: List Invitations */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: List Invitations
-- Item: vwListInvitations
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: List Invitations
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  ListInvitation
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwListInvitations]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwListInvitations];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwListInvitations]
AS
SELECT
    m.*,
    MJLists_ListID.[Name] AS [List],
    MJUsers_CreatedByUserID.[Name] AS [CreatedByUser]
FROM
    [${flyway:defaultSchema}].[ListInvitation] AS m
INNER JOIN
    [${flyway:defaultSchema}].[List] AS MJLists_ListID
  ON
    [m].[ListID] = MJLists_ListID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_CreatedByUserID
  ON
    [m].[CreatedByUserID] = MJUsers_CreatedByUserID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwListInvitations] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: List Invitations */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: List Invitations
-- Item: Permissions for vwListInvitations
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwListInvitations] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: List Invitations */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: List Invitations
-- Item: spCreateMJListInvitation
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR ListInvitation
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJListInvitation]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJListInvitation];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJListInvitation]
    @ID uniqueidentifier = NULL,
    @ListID uniqueidentifier,
    @Email nvarchar(255),
    @Role nvarchar(50),
    @Token nvarchar(100),
    @ExpiresAt datetime,
    @CreatedByUserID uniqueidentifier,
    @Status nvarchar(20) = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[ListInvitation]
            (
                [ID],
                [ListID],
                [Email],
                [Role],
                [Token],
                [ExpiresAt],
                [CreatedByUserID],
                [Status]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @ListID,
                @Email,
                @Role,
                @Token,
                @ExpiresAt,
                @CreatedByUserID,
                ISNULL(@Status, 'Pending')
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[ListInvitation]
            (
                [ListID],
                [Email],
                [Role],
                [Token],
                [ExpiresAt],
                [CreatedByUserID],
                [Status]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ListID,
                @Email,
                @Role,
                @Token,
                @ExpiresAt,
                @CreatedByUserID,
                ISNULL(@Status, 'Pending')
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwListInvitations] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJListInvitation] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: List Invitations */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJListInvitation] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: List Invitations */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: List Invitations
-- Item: spUpdateMJListInvitation
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR ListInvitation
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJListInvitation]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJListInvitation];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJListInvitation]
    @ID uniqueidentifier,
    @ListID uniqueidentifier,
    @Email nvarchar(255),
    @Role nvarchar(50),
    @Token nvarchar(100),
    @ExpiresAt datetime,
    @CreatedByUserID uniqueidentifier,
    @Status nvarchar(20)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ListInvitation]
    SET
        [ListID] = @ListID,
        [Email] = @Email,
        [Role] = @Role,
        [Token] = @Token,
        [ExpiresAt] = @ExpiresAt,
        [CreatedByUserID] = @CreatedByUserID,
        [Status] = @Status
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwListInvitations] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwListInvitations]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJListInvitation] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the ListInvitation table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJListInvitation]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJListInvitation];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJListInvitation
ON [${flyway:defaultSchema}].[ListInvitation]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ListInvitation]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[ListInvitation] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: List Invitations */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJListInvitation] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: List Invitations */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: List Invitations
-- Item: spDeleteMJListInvitation
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR ListInvitation
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJListInvitation]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJListInvitation];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJListInvitation]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[ListInvitation]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJListInvitation] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: List Invitations */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJListInvitation] TO [cdp_Integration]



/* Base View SQL for MJ: Library Items */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Library Items
-- Item: vwLibraryItems
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Library Items
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  LibraryItem
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwLibraryItems]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwLibraryItems];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwLibraryItems]
AS
SELECT
    m.*,
    MJLibraries_LibraryID.[Name] AS [Library]
FROM
    [${flyway:defaultSchema}].[LibraryItem] AS m
INNER JOIN
    [${flyway:defaultSchema}].[Library] AS MJLibraries_LibraryID
  ON
    [m].[LibraryID] = MJLibraries_LibraryID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwLibraryItems] TO [cdp_Developer], [cdp_UI], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Library Items */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Library Items
-- Item: Permissions for vwLibraryItems
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwLibraryItems] TO [cdp_Developer], [cdp_UI], [cdp_Integration]

/* spCreate SQL for MJ: Library Items */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Library Items
-- Item: spCreateMJLibraryItem
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR LibraryItem
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJLibraryItem]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJLibraryItem];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJLibraryItem]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(255),
    @LibraryID uniqueidentifier,
    @Type nvarchar(50)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[LibraryItem]
            (
                [ID],
                [Name],
                [LibraryID],
                [Type]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @LibraryID,
                @Type
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[LibraryItem]
            (
                [Name],
                [LibraryID],
                [Type]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @LibraryID,
                @Type
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwLibraryItems] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJLibraryItem] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Library Items */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJLibraryItem] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Library Items */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Library Items
-- Item: spUpdateMJLibraryItem
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR LibraryItem
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJLibraryItem]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJLibraryItem];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJLibraryItem]
    @ID uniqueidentifier,
    @Name nvarchar(255),
    @LibraryID uniqueidentifier,
    @Type nvarchar(50)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[LibraryItem]
    SET
        [Name] = @Name,
        [LibraryID] = @LibraryID,
        [Type] = @Type
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwLibraryItems] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwLibraryItems]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJLibraryItem] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the LibraryItem table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJLibraryItem]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJLibraryItem];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJLibraryItem
ON [${flyway:defaultSchema}].[LibraryItem]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[LibraryItem]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[LibraryItem] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Library Items */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJLibraryItem] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Library Items */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Library Items
-- Item: spDeleteMJLibraryItem
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR LibraryItem
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJLibraryItem]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJLibraryItem];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJLibraryItem]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[LibraryItem]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJLibraryItem] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Library Items */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJLibraryItem] TO [cdp_Integration]



/* Base View SQL for MJ: Libraries */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Libraries
-- Item: vwLibraries
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Libraries
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  Library
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwLibraries]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwLibraries];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwLibraries]
AS
SELECT
    m.*
FROM
    [${flyway:defaultSchema}].[Library] AS m
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwLibraries] TO [cdp_Integration], [cdp_Developer], [cdp_UI]
    

/* Base View Permissions SQL for MJ: Libraries */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Libraries
-- Item: Permissions for vwLibraries
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwLibraries] TO [cdp_Integration], [cdp_Developer], [cdp_UI]

/* spCreate SQL for MJ: Libraries */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Libraries
-- Item: spCreateMJLibrary
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR Library
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJLibrary]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJLibrary];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJLibrary]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @Status nvarchar(20) = NULL,
    @TypeDefinitions nvarchar(MAX),
    @SampleCode nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[Library]
            (
                [ID],
                [Name],
                [Description],
                [Status],
                [TypeDefinitions],
                [SampleCode]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description,
                ISNULL(@Status, 'Pending'),
                @TypeDefinitions,
                @SampleCode
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[Library]
            (
                [Name],
                [Description],
                [Status],
                [TypeDefinitions],
                [SampleCode]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description,
                ISNULL(@Status, 'Pending'),
                @TypeDefinitions,
                @SampleCode
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwLibraries] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJLibrary] TO [cdp_Integration], [cdp_Developer]
    

/* spCreate Permissions for MJ: Libraries */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJLibrary] TO [cdp_Integration], [cdp_Developer]



/* spUpdate SQL for MJ: Libraries */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Libraries
-- Item: spUpdateMJLibrary
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR Library
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJLibrary]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJLibrary];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJLibrary]
    @ID uniqueidentifier,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @Status nvarchar(20),
    @TypeDefinitions nvarchar(MAX),
    @SampleCode nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[Library]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [Status] = @Status,
        [TypeDefinitions] = @TypeDefinitions,
        [SampleCode] = @SampleCode
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwLibraries] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwLibraries]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJLibrary] TO [cdp_Integration], [cdp_Developer]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the Library table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJLibrary]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJLibrary];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJLibrary
ON [${flyway:defaultSchema}].[Library]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[Library]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[Library] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Libraries */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJLibrary] TO [cdp_Integration], [cdp_Developer]



/* spDelete SQL for MJ: Libraries */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Libraries
-- Item: spDeleteMJLibrary
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR Library
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJLibrary]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJLibrary];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJLibrary]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[Library]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJLibrary] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Libraries */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJLibrary] TO [cdp_Integration]



/* Base View SQL for MJ: List Categories */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: List Categories
-- Item: vwListCategories
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: List Categories
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  ListCategory
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwListCategories]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwListCategories];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwListCategories]
AS
SELECT
    m.*,
    MJListCategories_ParentID.[Name] AS [Parent],
    MJUsers_UserID.[Name] AS [User],
    root_ParentID.RootID AS [RootParentID]
FROM
    [${flyway:defaultSchema}].[ListCategory] AS m
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[ListCategory] AS MJListCategories_ParentID
  ON
    [m].[ParentID] = MJListCategories_ParentID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_UserID
  ON
    [m].[UserID] = MJUsers_UserID.[ID]
OUTER APPLY
    [${flyway:defaultSchema}].[fnListCategoryParentID_GetRootID]([m].[ID], [m].[ParentID]) AS root_ParentID
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwListCategories] TO [cdp_Developer], [cdp_Integration], [cdp_UI]
    

/* Base View Permissions SQL for MJ: List Categories */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: List Categories
-- Item: Permissions for vwListCategories
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwListCategories] TO [cdp_Developer], [cdp_Integration], [cdp_UI]

/* spCreate SQL for MJ: List Categories */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: List Categories
-- Item: spCreateMJListCategory
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR ListCategory
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJListCategory]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJListCategory];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJListCategory]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(100),
    @Description nvarchar(MAX),
    @ParentID uniqueidentifier,
    @UserID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[ListCategory]
            (
                [ID],
                [Name],
                [Description],
                [ParentID],
                [UserID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description,
                @ParentID,
                @UserID
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[ListCategory]
            (
                [Name],
                [Description],
                [ParentID],
                [UserID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description,
                @ParentID,
                @UserID
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwListCategories] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJListCategory] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: List Categories */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJListCategory] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: List Categories */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: List Categories
-- Item: spUpdateMJListCategory
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR ListCategory
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJListCategory]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJListCategory];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJListCategory]
    @ID uniqueidentifier,
    @Name nvarchar(100),
    @Description nvarchar(MAX),
    @ParentID uniqueidentifier,
    @UserID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ListCategory]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [ParentID] = @ParentID,
        [UserID] = @UserID
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwListCategories] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwListCategories]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJListCategory] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the ListCategory table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJListCategory]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJListCategory];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJListCategory
ON [${flyway:defaultSchema}].[ListCategory]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ListCategory]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[ListCategory] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: List Categories */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJListCategory] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: List Categories */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: List Categories
-- Item: spDeleteMJListCategory
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR ListCategory
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJListCategory]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJListCategory];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJListCategory]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[ListCategory]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJListCategory] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: List Categories */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJListCategory] TO [cdp_Integration]



/* Base View SQL for MJ: MCP Server Connection Permissions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: MCP Server Connection Permissions
-- Item: vwMCPServerConnectionPermissions
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: MCP Server Connection Permissions
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  MCPServerConnectionPermission
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwMCPServerConnectionPermissions]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwMCPServerConnectionPermissions];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwMCPServerConnectionPermissions]
AS
SELECT
    m.*,
    MJMCPServerConnections_MCPServerConnectionID.[Name] AS [MCPServerConnection],
    MJUsers_UserID.[Name] AS [User],
    MJRoles_RoleID.[Name] AS [Role]
FROM
    [${flyway:defaultSchema}].[MCPServerConnectionPermission] AS m
INNER JOIN
    [${flyway:defaultSchema}].[MCPServerConnection] AS MJMCPServerConnections_MCPServerConnectionID
  ON
    [m].[MCPServerConnectionID] = MJMCPServerConnections_MCPServerConnectionID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_UserID
  ON
    [m].[UserID] = MJUsers_UserID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[Role] AS MJRoles_RoleID
  ON
    [m].[RoleID] = MJRoles_RoleID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwMCPServerConnectionPermissions] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: MCP Server Connection Permissions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: MCP Server Connection Permissions
-- Item: Permissions for vwMCPServerConnectionPermissions
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwMCPServerConnectionPermissions] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: MCP Server Connection Permissions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: MCP Server Connection Permissions
-- Item: spCreateMJMCPServerConnectionPermission
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR MCPServerConnectionPermission
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJMCPServerConnectionPermission]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJMCPServerConnectionPermission];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJMCPServerConnectionPermission]
    @ID uniqueidentifier = NULL,
    @MCPServerConnectionID uniqueidentifier,
    @UserID uniqueidentifier,
    @RoleID uniqueidentifier,
    @CanExecute bit = NULL,
    @CanModify bit = NULL,
    @CanViewCredentials bit = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[MCPServerConnectionPermission]
            (
                [ID],
                [MCPServerConnectionID],
                [UserID],
                [RoleID],
                [CanExecute],
                [CanModify],
                [CanViewCredentials]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @MCPServerConnectionID,
                @UserID,
                @RoleID,
                ISNULL(@CanExecute, 1),
                ISNULL(@CanModify, 0),
                ISNULL(@CanViewCredentials, 0)
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[MCPServerConnectionPermission]
            (
                [MCPServerConnectionID],
                [UserID],
                [RoleID],
                [CanExecute],
                [CanModify],
                [CanViewCredentials]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @MCPServerConnectionID,
                @UserID,
                @RoleID,
                ISNULL(@CanExecute, 1),
                ISNULL(@CanModify, 0),
                ISNULL(@CanViewCredentials, 0)
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwMCPServerConnectionPermissions] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJMCPServerConnectionPermission] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: MCP Server Connection Permissions */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJMCPServerConnectionPermission] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: MCP Server Connection Permissions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: MCP Server Connection Permissions
-- Item: spUpdateMJMCPServerConnectionPermission
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR MCPServerConnectionPermission
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJMCPServerConnectionPermission]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJMCPServerConnectionPermission];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJMCPServerConnectionPermission]
    @ID uniqueidentifier,
    @MCPServerConnectionID uniqueidentifier,
    @UserID uniqueidentifier,
    @RoleID uniqueidentifier,
    @CanExecute bit,
    @CanModify bit,
    @CanViewCredentials bit
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[MCPServerConnectionPermission]
    SET
        [MCPServerConnectionID] = @MCPServerConnectionID,
        [UserID] = @UserID,
        [RoleID] = @RoleID,
        [CanExecute] = @CanExecute,
        [CanModify] = @CanModify,
        [CanViewCredentials] = @CanViewCredentials
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwMCPServerConnectionPermissions] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwMCPServerConnectionPermissions]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJMCPServerConnectionPermission] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the MCPServerConnectionPermission table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJMCPServerConnectionPermission]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJMCPServerConnectionPermission];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJMCPServerConnectionPermission
ON [${flyway:defaultSchema}].[MCPServerConnectionPermission]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[MCPServerConnectionPermission]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[MCPServerConnectionPermission] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: MCP Server Connection Permissions */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJMCPServerConnectionPermission] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: MCP Server Connection Permissions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: MCP Server Connection Permissions
-- Item: spDeleteMJMCPServerConnectionPermission
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR MCPServerConnectionPermission
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJMCPServerConnectionPermission]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJMCPServerConnectionPermission];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJMCPServerConnectionPermission]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[MCPServerConnectionPermission]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJMCPServerConnectionPermission] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: MCP Server Connection Permissions */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJMCPServerConnectionPermission] TO [cdp_Integration]



/* Base View SQL for MJ: List Shares */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: List Shares
-- Item: vwListShares
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: List Shares
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  ListShare
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwListShares]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwListShares];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwListShares]
AS
SELECT
    m.*,
    MJLists_ListID.[Name] AS [List],
    MJUsers_UserID.[Name] AS [User]
FROM
    [${flyway:defaultSchema}].[ListShare] AS m
INNER JOIN
    [${flyway:defaultSchema}].[List] AS MJLists_ListID
  ON
    [m].[ListID] = MJLists_ListID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_UserID
  ON
    [m].[UserID] = MJUsers_UserID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwListShares] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: List Shares */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: List Shares
-- Item: Permissions for vwListShares
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwListShares] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: List Shares */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: List Shares
-- Item: spCreateMJListShare
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR ListShare
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJListShare]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJListShare];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJListShare]
    @ID uniqueidentifier = NULL,
    @ListID uniqueidentifier,
    @UserID uniqueidentifier,
    @Role nvarchar(50),
    @Status nvarchar(20) = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[ListShare]
            (
                [ID],
                [ListID],
                [UserID],
                [Role],
                [Status]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @ListID,
                @UserID,
                @Role,
                ISNULL(@Status, 'Active')
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[ListShare]
            (
                [ListID],
                [UserID],
                [Role],
                [Status]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ListID,
                @UserID,
                @Role,
                ISNULL(@Status, 'Active')
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwListShares] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJListShare] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: List Shares */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJListShare] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: List Shares */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: List Shares
-- Item: spUpdateMJListShare
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR ListShare
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJListShare]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJListShare];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJListShare]
    @ID uniqueidentifier,
    @ListID uniqueidentifier,
    @UserID uniqueidentifier,
    @Role nvarchar(50),
    @Status nvarchar(20)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ListShare]
    SET
        [ListID] = @ListID,
        [UserID] = @UserID,
        [Role] = @Role,
        [Status] = @Status
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwListShares] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwListShares]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJListShare] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the ListShare table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJListShare]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJListShare];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJListShare
ON [${flyway:defaultSchema}].[ListShare]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ListShare]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[ListShare] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: List Shares */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJListShare] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: List Shares */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: List Shares
-- Item: spDeleteMJListShare
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR ListShare
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJListShare]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJListShare];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJListShare]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[ListShare]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJListShare] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: List Shares */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJListShare] TO [cdp_Integration]



/* Base View SQL for MJ: MCP Server Connections */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: MCP Server Connections
-- Item: vwMCPServerConnections
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: MCP Server Connections
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  MCPServerConnection
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwMCPServerConnections]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwMCPServerConnections];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwMCPServerConnections]
AS
SELECT
    m.*,
    MJMCPServers_MCPServerID.[Name] AS [MCPServer],
    MJCredentials_CredentialID.[Name] AS [Credential],
    MJCompanies_CompanyID.[Name] AS [Company]
FROM
    [${flyway:defaultSchema}].[MCPServerConnection] AS m
INNER JOIN
    [${flyway:defaultSchema}].[MCPServer] AS MJMCPServers_MCPServerID
  ON
    [m].[MCPServerID] = MJMCPServers_MCPServerID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[Credential] AS MJCredentials_CredentialID
  ON
    [m].[CredentialID] = MJCredentials_CredentialID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[Company] AS MJCompanies_CompanyID
  ON
    [m].[CompanyID] = MJCompanies_CompanyID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwMCPServerConnections] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: MCP Server Connections */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: MCP Server Connections
-- Item: Permissions for vwMCPServerConnections
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwMCPServerConnections] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: MCP Server Connections */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: MCP Server Connections
-- Item: spCreateMJMCPServerConnection
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR MCPServerConnection
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJMCPServerConnection]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJMCPServerConnection];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJMCPServerConnection]
    @ID uniqueidentifier = NULL,
    @MCPServerID uniqueidentifier,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @CredentialID uniqueidentifier,
    @CustomHeaderName nvarchar(100),
    @CompanyID uniqueidentifier,
    @Status nvarchar(50) = NULL,
    @AutoSyncTools bit = NULL,
    @AutoGenerateActions bit = NULL,
    @LogToolCalls bit = NULL,
    @LogInputParameters bit = NULL,
    @LogOutputContent bit = NULL,
    @MaxOutputLogSize int,
    @LastConnectedAt datetimeoffset,
    @LastErrorMessage nvarchar(MAX),
    @EnvironmentVars nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[MCPServerConnection]
            (
                [ID],
                [MCPServerID],
                [Name],
                [Description],
                [CredentialID],
                [CustomHeaderName],
                [CompanyID],
                [Status],
                [AutoSyncTools],
                [AutoGenerateActions],
                [LogToolCalls],
                [LogInputParameters],
                [LogOutputContent],
                [MaxOutputLogSize],
                [LastConnectedAt],
                [LastErrorMessage],
                [EnvironmentVars]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @MCPServerID,
                @Name,
                @Description,
                @CredentialID,
                @CustomHeaderName,
                @CompanyID,
                ISNULL(@Status, 'Active'),
                ISNULL(@AutoSyncTools, 1),
                ISNULL(@AutoGenerateActions, 0),
                ISNULL(@LogToolCalls, 1),
                ISNULL(@LogInputParameters, 1),
                ISNULL(@LogOutputContent, 1),
                @MaxOutputLogSize,
                @LastConnectedAt,
                @LastErrorMessage,
                @EnvironmentVars
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[MCPServerConnection]
            (
                [MCPServerID],
                [Name],
                [Description],
                [CredentialID],
                [CustomHeaderName],
                [CompanyID],
                [Status],
                [AutoSyncTools],
                [AutoGenerateActions],
                [LogToolCalls],
                [LogInputParameters],
                [LogOutputContent],
                [MaxOutputLogSize],
                [LastConnectedAt],
                [LastErrorMessage],
                [EnvironmentVars]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @MCPServerID,
                @Name,
                @Description,
                @CredentialID,
                @CustomHeaderName,
                @CompanyID,
                ISNULL(@Status, 'Active'),
                ISNULL(@AutoSyncTools, 1),
                ISNULL(@AutoGenerateActions, 0),
                ISNULL(@LogToolCalls, 1),
                ISNULL(@LogInputParameters, 1),
                ISNULL(@LogOutputContent, 1),
                @MaxOutputLogSize,
                @LastConnectedAt,
                @LastErrorMessage,
                @EnvironmentVars
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwMCPServerConnections] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJMCPServerConnection] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: MCP Server Connections */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJMCPServerConnection] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: MCP Server Connections */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: MCP Server Connections
-- Item: spUpdateMJMCPServerConnection
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR MCPServerConnection
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJMCPServerConnection]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJMCPServerConnection];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJMCPServerConnection]
    @ID uniqueidentifier,
    @MCPServerID uniqueidentifier,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @CredentialID uniqueidentifier,
    @CustomHeaderName nvarchar(100),
    @CompanyID uniqueidentifier,
    @Status nvarchar(50),
    @AutoSyncTools bit,
    @AutoGenerateActions bit,
    @LogToolCalls bit,
    @LogInputParameters bit,
    @LogOutputContent bit,
    @MaxOutputLogSize int,
    @LastConnectedAt datetimeoffset,
    @LastErrorMessage nvarchar(MAX),
    @EnvironmentVars nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[MCPServerConnection]
    SET
        [MCPServerID] = @MCPServerID,
        [Name] = @Name,
        [Description] = @Description,
        [CredentialID] = @CredentialID,
        [CustomHeaderName] = @CustomHeaderName,
        [CompanyID] = @CompanyID,
        [Status] = @Status,
        [AutoSyncTools] = @AutoSyncTools,
        [AutoGenerateActions] = @AutoGenerateActions,
        [LogToolCalls] = @LogToolCalls,
        [LogInputParameters] = @LogInputParameters,
        [LogOutputContent] = @LogOutputContent,
        [MaxOutputLogSize] = @MaxOutputLogSize,
        [LastConnectedAt] = @LastConnectedAt,
        [LastErrorMessage] = @LastErrorMessage,
        [EnvironmentVars] = @EnvironmentVars
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwMCPServerConnections] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwMCPServerConnections]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJMCPServerConnection] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the MCPServerConnection table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJMCPServerConnection]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJMCPServerConnection];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJMCPServerConnection
ON [${flyway:defaultSchema}].[MCPServerConnection]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[MCPServerConnection]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[MCPServerConnection] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: MCP Server Connections */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJMCPServerConnection] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: MCP Server Connections */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: MCP Server Connections
-- Item: spDeleteMJMCPServerConnection
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR MCPServerConnection
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJMCPServerConnection]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJMCPServerConnection];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJMCPServerConnection]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[MCPServerConnection]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJMCPServerConnection] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: MCP Server Connections */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJMCPServerConnection] TO [cdp_Integration]



/* Base View SQL for MJ: Lists */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Lists
-- Item: vwLists
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Lists
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  List
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwLists]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwLists];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwLists]
AS
SELECT
    m.*,
    MJEntities_EntityID.[Name] AS [Entity],
    MJUsers_UserID.[Name] AS [User],
    MJListCategories_CategoryID.[Name] AS [Category],
    MJCompanyIntegrations_CompanyIntegrationID.[Name] AS [CompanyIntegration]
FROM
    [${flyway:defaultSchema}].[List] AS m
INNER JOIN
    [${flyway:defaultSchema}].[Entity] AS MJEntities_EntityID
  ON
    [m].[EntityID] = MJEntities_EntityID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_UserID
  ON
    [m].[UserID] = MJUsers_UserID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[ListCategory] AS MJListCategories_CategoryID
  ON
    [m].[CategoryID] = MJListCategories_CategoryID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[CompanyIntegration] AS MJCompanyIntegrations_CompanyIntegrationID
  ON
    [m].[CompanyIntegrationID] = MJCompanyIntegrations_CompanyIntegrationID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwLists] TO [cdp_Integration], [cdp_Developer], [cdp_UI]
    

/* Base View Permissions SQL for MJ: Lists */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Lists
-- Item: Permissions for vwLists
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwLists] TO [cdp_Integration], [cdp_Developer], [cdp_UI]

/* spCreate SQL for MJ: Lists */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Lists
-- Item: spCreateMJList
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR List
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJList]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJList];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJList]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(100),
    @Description nvarchar(MAX),
    @EntityID uniqueidentifier,
    @UserID uniqueidentifier,
    @CategoryID uniqueidentifier,
    @ExternalSystemRecordID nvarchar(100),
    @CompanyIntegrationID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[List]
            (
                [ID],
                [Name],
                [Description],
                [EntityID],
                [UserID],
                [CategoryID],
                [ExternalSystemRecordID],
                [CompanyIntegrationID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description,
                @EntityID,
                @UserID,
                @CategoryID,
                @ExternalSystemRecordID,
                @CompanyIntegrationID
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[List]
            (
                [Name],
                [Description],
                [EntityID],
                [UserID],
                [CategoryID],
                [ExternalSystemRecordID],
                [CompanyIntegrationID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description,
                @EntityID,
                @UserID,
                @CategoryID,
                @ExternalSystemRecordID,
                @CompanyIntegrationID
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwLists] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJList] TO [cdp_Integration], [cdp_Developer]
    

/* spCreate Permissions for MJ: Lists */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJList] TO [cdp_Integration], [cdp_Developer]



/* spUpdate SQL for MJ: Lists */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Lists
-- Item: spUpdateMJList
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR List
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJList]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJList];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJList]
    @ID uniqueidentifier,
    @Name nvarchar(100),
    @Description nvarchar(MAX),
    @EntityID uniqueidentifier,
    @UserID uniqueidentifier,
    @CategoryID uniqueidentifier,
    @ExternalSystemRecordID nvarchar(100),
    @CompanyIntegrationID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[List]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [EntityID] = @EntityID,
        [UserID] = @UserID,
        [CategoryID] = @CategoryID,
        [ExternalSystemRecordID] = @ExternalSystemRecordID,
        [CompanyIntegrationID] = @CompanyIntegrationID
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwLists] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwLists]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJList] TO [cdp_Integration], [cdp_Developer]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the List table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJList]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJList];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJList
ON [${flyway:defaultSchema}].[List]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[List]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[List] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Lists */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJList] TO [cdp_Integration], [cdp_Developer]



/* spDelete SQL for MJ: Lists */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Lists
-- Item: spDeleteMJList
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR List
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJList]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJList];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJList]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[List]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJList] TO [cdp_Integration], [cdp_Developer]
    

/* spDelete Permissions for MJ: Lists */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJList] TO [cdp_Integration], [cdp_Developer]



/* Base View SQL for MJ: MCP Server Connection Tools */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: MCP Server Connection Tools
-- Item: vwMCPServerConnectionTools
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: MCP Server Connection Tools
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  MCPServerConnectionTool
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwMCPServerConnectionTools]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwMCPServerConnectionTools];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwMCPServerConnectionTools]
AS
SELECT
    m.*,
    MJMCPServerConnections_MCPServerConnectionID.[Name] AS [MCPServerConnection],
    MJMCPServerTools_MCPServerToolID.[ToolTitle] AS [MCPServerTool]
FROM
    [${flyway:defaultSchema}].[MCPServerConnectionTool] AS m
INNER JOIN
    [${flyway:defaultSchema}].[MCPServerConnection] AS MJMCPServerConnections_MCPServerConnectionID
  ON
    [m].[MCPServerConnectionID] = MJMCPServerConnections_MCPServerConnectionID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[MCPServerTool] AS MJMCPServerTools_MCPServerToolID
  ON
    [m].[MCPServerToolID] = MJMCPServerTools_MCPServerToolID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwMCPServerConnectionTools] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: MCP Server Connection Tools */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: MCP Server Connection Tools
-- Item: Permissions for vwMCPServerConnectionTools
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwMCPServerConnectionTools] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: MCP Server Connection Tools */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: MCP Server Connection Tools
-- Item: spCreateMJMCPServerConnectionTool
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR MCPServerConnectionTool
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJMCPServerConnectionTool]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJMCPServerConnectionTool];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJMCPServerConnectionTool]
    @ID uniqueidentifier = NULL,
    @MCPServerConnectionID uniqueidentifier,
    @MCPServerToolID uniqueidentifier,
    @IsEnabled bit = NULL,
    @DefaultInputValues nvarchar(MAX),
    @MaxCallsPerMinute int
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[MCPServerConnectionTool]
            (
                [ID],
                [MCPServerConnectionID],
                [MCPServerToolID],
                [IsEnabled],
                [DefaultInputValues],
                [MaxCallsPerMinute]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @MCPServerConnectionID,
                @MCPServerToolID,
                ISNULL(@IsEnabled, 1),
                @DefaultInputValues,
                @MaxCallsPerMinute
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[MCPServerConnectionTool]
            (
                [MCPServerConnectionID],
                [MCPServerToolID],
                [IsEnabled],
                [DefaultInputValues],
                [MaxCallsPerMinute]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @MCPServerConnectionID,
                @MCPServerToolID,
                ISNULL(@IsEnabled, 1),
                @DefaultInputValues,
                @MaxCallsPerMinute
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwMCPServerConnectionTools] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJMCPServerConnectionTool] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: MCP Server Connection Tools */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJMCPServerConnectionTool] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: MCP Server Connection Tools */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: MCP Server Connection Tools
-- Item: spUpdateMJMCPServerConnectionTool
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR MCPServerConnectionTool
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJMCPServerConnectionTool]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJMCPServerConnectionTool];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJMCPServerConnectionTool]
    @ID uniqueidentifier,
    @MCPServerConnectionID uniqueidentifier,
    @MCPServerToolID uniqueidentifier,
    @IsEnabled bit,
    @DefaultInputValues nvarchar(MAX),
    @MaxCallsPerMinute int
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[MCPServerConnectionTool]
    SET
        [MCPServerConnectionID] = @MCPServerConnectionID,
        [MCPServerToolID] = @MCPServerToolID,
        [IsEnabled] = @IsEnabled,
        [DefaultInputValues] = @DefaultInputValues,
        [MaxCallsPerMinute] = @MaxCallsPerMinute
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwMCPServerConnectionTools] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwMCPServerConnectionTools]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJMCPServerConnectionTool] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the MCPServerConnectionTool table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJMCPServerConnectionTool]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJMCPServerConnectionTool];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJMCPServerConnectionTool
ON [${flyway:defaultSchema}].[MCPServerConnectionTool]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[MCPServerConnectionTool]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[MCPServerConnectionTool] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: MCP Server Connection Tools */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJMCPServerConnectionTool] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: MCP Server Connection Tools */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: MCP Server Connection Tools
-- Item: spDeleteMJMCPServerConnectionTool
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR MCPServerConnectionTool
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJMCPServerConnectionTool]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJMCPServerConnectionTool];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJMCPServerConnectionTool]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[MCPServerConnectionTool]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJMCPServerConnectionTool] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: MCP Server Connection Tools */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJMCPServerConnectionTool] TO [cdp_Integration]



/* Base View SQL for MJ: MCP Server Tools */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: MCP Server Tools
-- Item: vwMCPServerTools
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: MCP Server Tools
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  MCPServerTool
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwMCPServerTools]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwMCPServerTools];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwMCPServerTools]
AS
SELECT
    m.*,
    MJMCPServers_MCPServerID.[Name] AS [MCPServer],
    MJActions_GeneratedActionID.[Name] AS [GeneratedAction],
    MJActionCategories_GeneratedActionCategoryID.[Name] AS [GeneratedActionCategory]
FROM
    [${flyway:defaultSchema}].[MCPServerTool] AS m
INNER JOIN
    [${flyway:defaultSchema}].[MCPServer] AS MJMCPServers_MCPServerID
  ON
    [m].[MCPServerID] = MJMCPServers_MCPServerID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[Action] AS MJActions_GeneratedActionID
  ON
    [m].[GeneratedActionID] = MJActions_GeneratedActionID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[ActionCategory] AS MJActionCategories_GeneratedActionCategoryID
  ON
    [m].[GeneratedActionCategoryID] = MJActionCategories_GeneratedActionCategoryID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwMCPServerTools] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: MCP Server Tools */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: MCP Server Tools
-- Item: Permissions for vwMCPServerTools
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwMCPServerTools] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: MCP Server Tools */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: MCP Server Tools
-- Item: spCreateMJMCPServerTool
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR MCPServerTool
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJMCPServerTool]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJMCPServerTool];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJMCPServerTool]
    @ID uniqueidentifier = NULL,
    @MCPServerID uniqueidentifier,
    @ToolName nvarchar(255),
    @ToolTitle nvarchar(255),
    @ToolDescription nvarchar(MAX),
    @InputSchema nvarchar(MAX),
    @OutputSchema nvarchar(MAX),
    @Annotations nvarchar(MAX),
    @Status nvarchar(50) = NULL,
    @DiscoveredAt datetimeoffset = NULL,
    @LastSeenAt datetimeoffset = NULL,
    @GeneratedActionID uniqueidentifier,
    @GeneratedActionCategoryID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[MCPServerTool]
            (
                [ID],
                [MCPServerID],
                [ToolName],
                [ToolTitle],
                [ToolDescription],
                [InputSchema],
                [OutputSchema],
                [Annotations],
                [Status],
                [DiscoveredAt],
                [LastSeenAt],
                [GeneratedActionID],
                [GeneratedActionCategoryID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @MCPServerID,
                @ToolName,
                @ToolTitle,
                @ToolDescription,
                @InputSchema,
                @OutputSchema,
                @Annotations,
                ISNULL(@Status, 'Active'),
                ISNULL(@DiscoveredAt, getutcdate()),
                ISNULL(@LastSeenAt, getutcdate()),
                @GeneratedActionID,
                @GeneratedActionCategoryID
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[MCPServerTool]
            (
                [MCPServerID],
                [ToolName],
                [ToolTitle],
                [ToolDescription],
                [InputSchema],
                [OutputSchema],
                [Annotations],
                [Status],
                [DiscoveredAt],
                [LastSeenAt],
                [GeneratedActionID],
                [GeneratedActionCategoryID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @MCPServerID,
                @ToolName,
                @ToolTitle,
                @ToolDescription,
                @InputSchema,
                @OutputSchema,
                @Annotations,
                ISNULL(@Status, 'Active'),
                ISNULL(@DiscoveredAt, getutcdate()),
                ISNULL(@LastSeenAt, getutcdate()),
                @GeneratedActionID,
                @GeneratedActionCategoryID
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwMCPServerTools] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJMCPServerTool] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: MCP Server Tools */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJMCPServerTool] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: MCP Server Tools */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: MCP Server Tools
-- Item: spUpdateMJMCPServerTool
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR MCPServerTool
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJMCPServerTool]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJMCPServerTool];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJMCPServerTool]
    @ID uniqueidentifier,
    @MCPServerID uniqueidentifier,
    @ToolName nvarchar(255),
    @ToolTitle nvarchar(255),
    @ToolDescription nvarchar(MAX),
    @InputSchema nvarchar(MAX),
    @OutputSchema nvarchar(MAX),
    @Annotations nvarchar(MAX),
    @Status nvarchar(50),
    @DiscoveredAt datetimeoffset,
    @LastSeenAt datetimeoffset,
    @GeneratedActionID uniqueidentifier,
    @GeneratedActionCategoryID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[MCPServerTool]
    SET
        [MCPServerID] = @MCPServerID,
        [ToolName] = @ToolName,
        [ToolTitle] = @ToolTitle,
        [ToolDescription] = @ToolDescription,
        [InputSchema] = @InputSchema,
        [OutputSchema] = @OutputSchema,
        [Annotations] = @Annotations,
        [Status] = @Status,
        [DiscoveredAt] = @DiscoveredAt,
        [LastSeenAt] = @LastSeenAt,
        [GeneratedActionID] = @GeneratedActionID,
        [GeneratedActionCategoryID] = @GeneratedActionCategoryID
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwMCPServerTools] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwMCPServerTools]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJMCPServerTool] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the MCPServerTool table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJMCPServerTool]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJMCPServerTool];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJMCPServerTool
ON [${flyway:defaultSchema}].[MCPServerTool]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[MCPServerTool]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[MCPServerTool] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: MCP Server Tools */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJMCPServerTool] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: MCP Server Tools */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: MCP Server Tools
-- Item: spDeleteMJMCPServerTool
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR MCPServerTool
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJMCPServerTool]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJMCPServerTool];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJMCPServerTool]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[MCPServerTool]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJMCPServerTool] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: MCP Server Tools */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJMCPServerTool] TO [cdp_Integration]



/* Base View SQL for MJ: MCP Servers */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: MCP Servers
-- Item: vwMCPServers
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: MCP Servers
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  MCPServer
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwMCPServers]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwMCPServers];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwMCPServers]
AS
SELECT
    m.*,
    MJCredentialTypes_CredentialTypeID.[Name] AS [CredentialType]
FROM
    [${flyway:defaultSchema}].[MCPServer] AS m
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[CredentialType] AS MJCredentialTypes_CredentialTypeID
  ON
    [m].[CredentialTypeID] = MJCredentialTypes_CredentialTypeID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwMCPServers] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: MCP Servers */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: MCP Servers
-- Item: Permissions for vwMCPServers
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwMCPServers] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: MCP Servers */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: MCP Servers
-- Item: spCreateMJMCPServer
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR MCPServer
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJMCPServer]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJMCPServer];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJMCPServer]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @ServerURL nvarchar(1000),
    @Command nvarchar(500),
    @CommandArgs nvarchar(MAX),
    @TransportType nvarchar(50),
    @DefaultAuthType nvarchar(50),
    @CredentialTypeID uniqueidentifier,
    @Status nvarchar(50) = NULL,
    @LastSyncAt datetimeoffset,
    @RateLimitPerMinute int,
    @RateLimitPerHour int,
    @ConnectionTimeoutMs int,
    @RequestTimeoutMs int,
    @DocumentationURL nvarchar(1000),
    @IconClass nvarchar(100),
    @OAuthIssuerURL nvarchar(1000),
    @OAuthScopes nvarchar(500),
    @OAuthMetadataCacheTTLMinutes int,
    @OAuthClientID nvarchar(255),
    @OAuthClientSecretEncrypted nvarchar(MAX),
    @OAuthRequirePKCE bit = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[MCPServer]
            (
                [ID],
                [Name],
                [Description],
                [ServerURL],
                [Command],
                [CommandArgs],
                [TransportType],
                [DefaultAuthType],
                [CredentialTypeID],
                [Status],
                [LastSyncAt],
                [RateLimitPerMinute],
                [RateLimitPerHour],
                [ConnectionTimeoutMs],
                [RequestTimeoutMs],
                [DocumentationURL],
                [IconClass],
                [OAuthIssuerURL],
                [OAuthScopes],
                [OAuthMetadataCacheTTLMinutes],
                [OAuthClientID],
                [OAuthClientSecretEncrypted],
                [OAuthRequirePKCE]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description,
                @ServerURL,
                @Command,
                @CommandArgs,
                @TransportType,
                @DefaultAuthType,
                @CredentialTypeID,
                ISNULL(@Status, 'Active'),
                @LastSyncAt,
                @RateLimitPerMinute,
                @RateLimitPerHour,
                @ConnectionTimeoutMs,
                @RequestTimeoutMs,
                @DocumentationURL,
                @IconClass,
                @OAuthIssuerURL,
                @OAuthScopes,
                @OAuthMetadataCacheTTLMinutes,
                @OAuthClientID,
                @OAuthClientSecretEncrypted,
                ISNULL(@OAuthRequirePKCE, 1)
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[MCPServer]
            (
                [Name],
                [Description],
                [ServerURL],
                [Command],
                [CommandArgs],
                [TransportType],
                [DefaultAuthType],
                [CredentialTypeID],
                [Status],
                [LastSyncAt],
                [RateLimitPerMinute],
                [RateLimitPerHour],
                [ConnectionTimeoutMs],
                [RequestTimeoutMs],
                [DocumentationURL],
                [IconClass],
                [OAuthIssuerURL],
                [OAuthScopes],
                [OAuthMetadataCacheTTLMinutes],
                [OAuthClientID],
                [OAuthClientSecretEncrypted],
                [OAuthRequirePKCE]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description,
                @ServerURL,
                @Command,
                @CommandArgs,
                @TransportType,
                @DefaultAuthType,
                @CredentialTypeID,
                ISNULL(@Status, 'Active'),
                @LastSyncAt,
                @RateLimitPerMinute,
                @RateLimitPerHour,
                @ConnectionTimeoutMs,
                @RequestTimeoutMs,
                @DocumentationURL,
                @IconClass,
                @OAuthIssuerURL,
                @OAuthScopes,
                @OAuthMetadataCacheTTLMinutes,
                @OAuthClientID,
                @OAuthClientSecretEncrypted,
                ISNULL(@OAuthRequirePKCE, 1)
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwMCPServers] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJMCPServer] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: MCP Servers */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJMCPServer] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: MCP Servers */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: MCP Servers
-- Item: spUpdateMJMCPServer
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR MCPServer
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJMCPServer]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJMCPServer];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJMCPServer]
    @ID uniqueidentifier,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @ServerURL nvarchar(1000),
    @Command nvarchar(500),
    @CommandArgs nvarchar(MAX),
    @TransportType nvarchar(50),
    @DefaultAuthType nvarchar(50),
    @CredentialTypeID uniqueidentifier,
    @Status nvarchar(50),
    @LastSyncAt datetimeoffset,
    @RateLimitPerMinute int,
    @RateLimitPerHour int,
    @ConnectionTimeoutMs int,
    @RequestTimeoutMs int,
    @DocumentationURL nvarchar(1000),
    @IconClass nvarchar(100),
    @OAuthIssuerURL nvarchar(1000),
    @OAuthScopes nvarchar(500),
    @OAuthMetadataCacheTTLMinutes int,
    @OAuthClientID nvarchar(255),
    @OAuthClientSecretEncrypted nvarchar(MAX),
    @OAuthRequirePKCE bit
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[MCPServer]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [ServerURL] = @ServerURL,
        [Command] = @Command,
        [CommandArgs] = @CommandArgs,
        [TransportType] = @TransportType,
        [DefaultAuthType] = @DefaultAuthType,
        [CredentialTypeID] = @CredentialTypeID,
        [Status] = @Status,
        [LastSyncAt] = @LastSyncAt,
        [RateLimitPerMinute] = @RateLimitPerMinute,
        [RateLimitPerHour] = @RateLimitPerHour,
        [ConnectionTimeoutMs] = @ConnectionTimeoutMs,
        [RequestTimeoutMs] = @RequestTimeoutMs,
        [DocumentationURL] = @DocumentationURL,
        [IconClass] = @IconClass,
        [OAuthIssuerURL] = @OAuthIssuerURL,
        [OAuthScopes] = @OAuthScopes,
        [OAuthMetadataCacheTTLMinutes] = @OAuthMetadataCacheTTLMinutes,
        [OAuthClientID] = @OAuthClientID,
        [OAuthClientSecretEncrypted] = @OAuthClientSecretEncrypted,
        [OAuthRequirePKCE] = @OAuthRequirePKCE
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwMCPServers] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwMCPServers]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJMCPServer] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the MCPServer table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJMCPServer]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJMCPServer];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJMCPServer
ON [${flyway:defaultSchema}].[MCPServer]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[MCPServer]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[MCPServer] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: MCP Servers */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJMCPServer] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: MCP Servers */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: MCP Servers
-- Item: spDeleteMJMCPServer
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR MCPServer
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJMCPServer]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJMCPServer];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJMCPServer]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[MCPServer]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJMCPServer] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: MCP Servers */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJMCPServer] TO [cdp_Integration]



/* Base View SQL for MJ: O Auth Authorization States */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: O Auth Authorization States
-- Item: vwOAuthAuthorizationStates
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: O Auth Authorization States
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  OAuthAuthorizationState
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwOAuthAuthorizationStates]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwOAuthAuthorizationStates];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwOAuthAuthorizationStates]
AS
SELECT
    m.*,
    MJMCPServerConnections_MCPServerConnectionID.[Name] AS [MCPServerConnection],
    MJUsers_UserID.[Name] AS [User]
FROM
    [${flyway:defaultSchema}].[OAuthAuthorizationState] AS m
INNER JOIN
    [${flyway:defaultSchema}].[MCPServerConnection] AS MJMCPServerConnections_MCPServerConnectionID
  ON
    [m].[MCPServerConnectionID] = MJMCPServerConnections_MCPServerConnectionID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_UserID
  ON
    [m].[UserID] = MJUsers_UserID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwOAuthAuthorizationStates] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: O Auth Authorization States */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: O Auth Authorization States
-- Item: Permissions for vwOAuthAuthorizationStates
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwOAuthAuthorizationStates] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: O Auth Authorization States */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: O Auth Authorization States
-- Item: spCreateMJOAuthAuthorizationState
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR OAuthAuthorizationState
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJOAuthAuthorizationState]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJOAuthAuthorizationState];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJOAuthAuthorizationState]
    @ID uniqueidentifier = NULL,
    @MCPServerConnectionID uniqueidentifier,
    @UserID uniqueidentifier,
    @StateParameter nvarchar(128),
    @CodeVerifier nvarchar(128),
    @CodeChallenge nvarchar(128),
    @RedirectURI nvarchar(1000),
    @RequestedScopes nvarchar(500),
    @Status nvarchar(50) = NULL,
    @AuthorizationURL nvarchar(MAX),
    @ErrorCode nvarchar(100),
    @ErrorDescription nvarchar(MAX),
    @InitiatedAt datetimeoffset = NULL,
    @ExpiresAt datetimeoffset,
    @CompletedAt datetimeoffset,
    @FrontendReturnURL nvarchar(1000)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[OAuthAuthorizationState]
            (
                [ID],
                [MCPServerConnectionID],
                [UserID],
                [StateParameter],
                [CodeVerifier],
                [CodeChallenge],
                [RedirectURI],
                [RequestedScopes],
                [Status],
                [AuthorizationURL],
                [ErrorCode],
                [ErrorDescription],
                [InitiatedAt],
                [ExpiresAt],
                [CompletedAt],
                [FrontendReturnURL]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @MCPServerConnectionID,
                @UserID,
                @StateParameter,
                @CodeVerifier,
                @CodeChallenge,
                @RedirectURI,
                @RequestedScopes,
                ISNULL(@Status, 'Pending'),
                @AuthorizationURL,
                @ErrorCode,
                @ErrorDescription,
                ISNULL(@InitiatedAt, getutcdate()),
                @ExpiresAt,
                @CompletedAt,
                @FrontendReturnURL
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[OAuthAuthorizationState]
            (
                [MCPServerConnectionID],
                [UserID],
                [StateParameter],
                [CodeVerifier],
                [CodeChallenge],
                [RedirectURI],
                [RequestedScopes],
                [Status],
                [AuthorizationURL],
                [ErrorCode],
                [ErrorDescription],
                [InitiatedAt],
                [ExpiresAt],
                [CompletedAt],
                [FrontendReturnURL]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @MCPServerConnectionID,
                @UserID,
                @StateParameter,
                @CodeVerifier,
                @CodeChallenge,
                @RedirectURI,
                @RequestedScopes,
                ISNULL(@Status, 'Pending'),
                @AuthorizationURL,
                @ErrorCode,
                @ErrorDescription,
                ISNULL(@InitiatedAt, getutcdate()),
                @ExpiresAt,
                @CompletedAt,
                @FrontendReturnURL
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwOAuthAuthorizationStates] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJOAuthAuthorizationState] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: O Auth Authorization States */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJOAuthAuthorizationState] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: O Auth Authorization States */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: O Auth Authorization States
-- Item: spUpdateMJOAuthAuthorizationState
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR OAuthAuthorizationState
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJOAuthAuthorizationState]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJOAuthAuthorizationState];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJOAuthAuthorizationState]
    @ID uniqueidentifier,
    @MCPServerConnectionID uniqueidentifier,
    @UserID uniqueidentifier,
    @StateParameter nvarchar(128),
    @CodeVerifier nvarchar(128),
    @CodeChallenge nvarchar(128),
    @RedirectURI nvarchar(1000),
    @RequestedScopes nvarchar(500),
    @Status nvarchar(50),
    @AuthorizationURL nvarchar(MAX),
    @ErrorCode nvarchar(100),
    @ErrorDescription nvarchar(MAX),
    @InitiatedAt datetimeoffset,
    @ExpiresAt datetimeoffset,
    @CompletedAt datetimeoffset,
    @FrontendReturnURL nvarchar(1000)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[OAuthAuthorizationState]
    SET
        [MCPServerConnectionID] = @MCPServerConnectionID,
        [UserID] = @UserID,
        [StateParameter] = @StateParameter,
        [CodeVerifier] = @CodeVerifier,
        [CodeChallenge] = @CodeChallenge,
        [RedirectURI] = @RedirectURI,
        [RequestedScopes] = @RequestedScopes,
        [Status] = @Status,
        [AuthorizationURL] = @AuthorizationURL,
        [ErrorCode] = @ErrorCode,
        [ErrorDescription] = @ErrorDescription,
        [InitiatedAt] = @InitiatedAt,
        [ExpiresAt] = @ExpiresAt,
        [CompletedAt] = @CompletedAt,
        [FrontendReturnURL] = @FrontendReturnURL
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwOAuthAuthorizationStates] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwOAuthAuthorizationStates]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJOAuthAuthorizationState] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the OAuthAuthorizationState table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJOAuthAuthorizationState]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJOAuthAuthorizationState];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJOAuthAuthorizationState
ON [${flyway:defaultSchema}].[OAuthAuthorizationState]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[OAuthAuthorizationState]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[OAuthAuthorizationState] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: O Auth Authorization States */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJOAuthAuthorizationState] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: O Auth Authorization States */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: O Auth Authorization States
-- Item: spDeleteMJOAuthAuthorizationState
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR OAuthAuthorizationState
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJOAuthAuthorizationState]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJOAuthAuthorizationState];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJOAuthAuthorizationState]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[OAuthAuthorizationState]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJOAuthAuthorizationState] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: O Auth Authorization States */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJOAuthAuthorizationState] TO [cdp_Integration]



/* Base View SQL for MJ: MCP Tool Execution Logs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: MCP Tool Execution Logs
-- Item: vwMCPToolExecutionLogs
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: MCP Tool Execution Logs
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  MCPToolExecutionLog
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwMCPToolExecutionLogs]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwMCPToolExecutionLogs];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwMCPToolExecutionLogs]
AS
SELECT
    m.*,
    MJMCPServerConnections_MCPServerConnectionID.[Name] AS [MCPServerConnection],
    MJMCPServerTools_MCPServerToolID.[ToolTitle] AS [MCPServerTool],
    MJUsers_UserID.[Name] AS [User]
FROM
    [${flyway:defaultSchema}].[MCPToolExecutionLog] AS m
INNER JOIN
    [${flyway:defaultSchema}].[MCPServerConnection] AS MJMCPServerConnections_MCPServerConnectionID
  ON
    [m].[MCPServerConnectionID] = MJMCPServerConnections_MCPServerConnectionID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[MCPServerTool] AS MJMCPServerTools_MCPServerToolID
  ON
    [m].[MCPServerToolID] = MJMCPServerTools_MCPServerToolID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_UserID
  ON
    [m].[UserID] = MJUsers_UserID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwMCPToolExecutionLogs] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: MCP Tool Execution Logs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: MCP Tool Execution Logs
-- Item: Permissions for vwMCPToolExecutionLogs
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwMCPToolExecutionLogs] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: MCP Tool Execution Logs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: MCP Tool Execution Logs
-- Item: spCreateMJMCPToolExecutionLog
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR MCPToolExecutionLog
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJMCPToolExecutionLog]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJMCPToolExecutionLog];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJMCPToolExecutionLog]
    @ID uniqueidentifier = NULL,
    @MCPServerConnectionID uniqueidentifier,
    @MCPServerToolID uniqueidentifier,
    @ToolName nvarchar(255),
    @UserID uniqueidentifier,
    @StartedAt datetimeoffset = NULL,
    @EndedAt datetimeoffset,
    @DurationMs int,
    @Success bit = NULL,
    @ErrorMessage nvarchar(MAX),
    @InputParameters nvarchar(MAX),
    @OutputContent nvarchar(MAX),
    @OutputTruncated bit = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[MCPToolExecutionLog]
            (
                [ID],
                [MCPServerConnectionID],
                [MCPServerToolID],
                [ToolName],
                [UserID],
                [StartedAt],
                [EndedAt],
                [DurationMs],
                [Success],
                [ErrorMessage],
                [InputParameters],
                [OutputContent],
                [OutputTruncated]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @MCPServerConnectionID,
                @MCPServerToolID,
                @ToolName,
                @UserID,
                ISNULL(@StartedAt, getutcdate()),
                @EndedAt,
                @DurationMs,
                ISNULL(@Success, 0),
                @ErrorMessage,
                @InputParameters,
                @OutputContent,
                ISNULL(@OutputTruncated, 0)
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[MCPToolExecutionLog]
            (
                [MCPServerConnectionID],
                [MCPServerToolID],
                [ToolName],
                [UserID],
                [StartedAt],
                [EndedAt],
                [DurationMs],
                [Success],
                [ErrorMessage],
                [InputParameters],
                [OutputContent],
                [OutputTruncated]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @MCPServerConnectionID,
                @MCPServerToolID,
                @ToolName,
                @UserID,
                ISNULL(@StartedAt, getutcdate()),
                @EndedAt,
                @DurationMs,
                ISNULL(@Success, 0),
                @ErrorMessage,
                @InputParameters,
                @OutputContent,
                ISNULL(@OutputTruncated, 0)
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwMCPToolExecutionLogs] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJMCPToolExecutionLog] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: MCP Tool Execution Logs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJMCPToolExecutionLog] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: MCP Tool Execution Logs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: MCP Tool Execution Logs
-- Item: spUpdateMJMCPToolExecutionLog
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR MCPToolExecutionLog
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJMCPToolExecutionLog]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJMCPToolExecutionLog];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJMCPToolExecutionLog]
    @ID uniqueidentifier,
    @MCPServerConnectionID uniqueidentifier,
    @MCPServerToolID uniqueidentifier,
    @ToolName nvarchar(255),
    @UserID uniqueidentifier,
    @StartedAt datetimeoffset,
    @EndedAt datetimeoffset,
    @DurationMs int,
    @Success bit,
    @ErrorMessage nvarchar(MAX),
    @InputParameters nvarchar(MAX),
    @OutputContent nvarchar(MAX),
    @OutputTruncated bit
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[MCPToolExecutionLog]
    SET
        [MCPServerConnectionID] = @MCPServerConnectionID,
        [MCPServerToolID] = @MCPServerToolID,
        [ToolName] = @ToolName,
        [UserID] = @UserID,
        [StartedAt] = @StartedAt,
        [EndedAt] = @EndedAt,
        [DurationMs] = @DurationMs,
        [Success] = @Success,
        [ErrorMessage] = @ErrorMessage,
        [InputParameters] = @InputParameters,
        [OutputContent] = @OutputContent,
        [OutputTruncated] = @OutputTruncated
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwMCPToolExecutionLogs] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwMCPToolExecutionLogs]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJMCPToolExecutionLog] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the MCPToolExecutionLog table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJMCPToolExecutionLog]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJMCPToolExecutionLog];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJMCPToolExecutionLog
ON [${flyway:defaultSchema}].[MCPToolExecutionLog]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[MCPToolExecutionLog]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[MCPToolExecutionLog] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: MCP Tool Execution Logs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJMCPToolExecutionLog] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: MCP Tool Execution Logs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: MCP Tool Execution Logs
-- Item: spDeleteMJMCPToolExecutionLog
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR MCPToolExecutionLog
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJMCPToolExecutionLog]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJMCPToolExecutionLog];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJMCPToolExecutionLog]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[MCPToolExecutionLog]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJMCPToolExecutionLog] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: MCP Tool Execution Logs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJMCPToolExecutionLog] TO [cdp_Integration]



/* Base View SQL for MJ: O Auth Auth Server Metadata Caches */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: O Auth Auth Server Metadata Caches
-- Item: vwOAuthAuthServerMetadataCaches
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: O Auth Auth Server Metadata Caches
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  OAuthAuthServerMetadataCache
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwOAuthAuthServerMetadataCaches]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwOAuthAuthServerMetadataCaches];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwOAuthAuthServerMetadataCaches]
AS
SELECT
    m.*
FROM
    [${flyway:defaultSchema}].[OAuthAuthServerMetadataCache] AS m
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwOAuthAuthServerMetadataCaches] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: O Auth Auth Server Metadata Caches */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: O Auth Auth Server Metadata Caches
-- Item: Permissions for vwOAuthAuthServerMetadataCaches
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwOAuthAuthServerMetadataCaches] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: O Auth Auth Server Metadata Caches */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: O Auth Auth Server Metadata Caches
-- Item: spCreateMJOAuthAuthServerMetadataCache
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR OAuthAuthServerMetadataCache
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJOAuthAuthServerMetadataCache]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJOAuthAuthServerMetadataCache];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJOAuthAuthServerMetadataCache]
    @ID uniqueidentifier = NULL,
    @IssuerURL nvarchar(1000),
    @AuthorizationEndpoint nvarchar(1000),
    @TokenEndpoint nvarchar(1000),
    @RegistrationEndpoint nvarchar(1000),
    @RevocationEndpoint nvarchar(1000),
    @JwksURI nvarchar(1000),
    @ScopesSupported nvarchar(MAX),
    @ResponseTypesSupported nvarchar(MAX),
    @GrantTypesSupported nvarchar(MAX),
    @TokenEndpointAuthMethods nvarchar(MAX),
    @CodeChallengeMethodsSupported nvarchar(MAX),
    @MetadataJSON nvarchar(MAX),
    @CachedAt datetimeoffset = NULL,
    @ExpiresAt datetimeoffset
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[OAuthAuthServerMetadataCache]
            (
                [ID],
                [IssuerURL],
                [AuthorizationEndpoint],
                [TokenEndpoint],
                [RegistrationEndpoint],
                [RevocationEndpoint],
                [JwksURI],
                [ScopesSupported],
                [ResponseTypesSupported],
                [GrantTypesSupported],
                [TokenEndpointAuthMethods],
                [CodeChallengeMethodsSupported],
                [MetadataJSON],
                [CachedAt],
                [ExpiresAt]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @IssuerURL,
                @AuthorizationEndpoint,
                @TokenEndpoint,
                @RegistrationEndpoint,
                @RevocationEndpoint,
                @JwksURI,
                @ScopesSupported,
                @ResponseTypesSupported,
                @GrantTypesSupported,
                @TokenEndpointAuthMethods,
                @CodeChallengeMethodsSupported,
                @MetadataJSON,
                ISNULL(@CachedAt, getutcdate()),
                @ExpiresAt
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[OAuthAuthServerMetadataCache]
            (
                [IssuerURL],
                [AuthorizationEndpoint],
                [TokenEndpoint],
                [RegistrationEndpoint],
                [RevocationEndpoint],
                [JwksURI],
                [ScopesSupported],
                [ResponseTypesSupported],
                [GrantTypesSupported],
                [TokenEndpointAuthMethods],
                [CodeChallengeMethodsSupported],
                [MetadataJSON],
                [CachedAt],
                [ExpiresAt]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @IssuerURL,
                @AuthorizationEndpoint,
                @TokenEndpoint,
                @RegistrationEndpoint,
                @RevocationEndpoint,
                @JwksURI,
                @ScopesSupported,
                @ResponseTypesSupported,
                @GrantTypesSupported,
                @TokenEndpointAuthMethods,
                @CodeChallengeMethodsSupported,
                @MetadataJSON,
                ISNULL(@CachedAt, getutcdate()),
                @ExpiresAt
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwOAuthAuthServerMetadataCaches] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJOAuthAuthServerMetadataCache] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: O Auth Auth Server Metadata Caches */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJOAuthAuthServerMetadataCache] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: O Auth Auth Server Metadata Caches */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: O Auth Auth Server Metadata Caches
-- Item: spUpdateMJOAuthAuthServerMetadataCache
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR OAuthAuthServerMetadataCache
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJOAuthAuthServerMetadataCache]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJOAuthAuthServerMetadataCache];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJOAuthAuthServerMetadataCache]
    @ID uniqueidentifier,
    @IssuerURL nvarchar(1000),
    @AuthorizationEndpoint nvarchar(1000),
    @TokenEndpoint nvarchar(1000),
    @RegistrationEndpoint nvarchar(1000),
    @RevocationEndpoint nvarchar(1000),
    @JwksURI nvarchar(1000),
    @ScopesSupported nvarchar(MAX),
    @ResponseTypesSupported nvarchar(MAX),
    @GrantTypesSupported nvarchar(MAX),
    @TokenEndpointAuthMethods nvarchar(MAX),
    @CodeChallengeMethodsSupported nvarchar(MAX),
    @MetadataJSON nvarchar(MAX),
    @CachedAt datetimeoffset,
    @ExpiresAt datetimeoffset
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[OAuthAuthServerMetadataCache]
    SET
        [IssuerURL] = @IssuerURL,
        [AuthorizationEndpoint] = @AuthorizationEndpoint,
        [TokenEndpoint] = @TokenEndpoint,
        [RegistrationEndpoint] = @RegistrationEndpoint,
        [RevocationEndpoint] = @RevocationEndpoint,
        [JwksURI] = @JwksURI,
        [ScopesSupported] = @ScopesSupported,
        [ResponseTypesSupported] = @ResponseTypesSupported,
        [GrantTypesSupported] = @GrantTypesSupported,
        [TokenEndpointAuthMethods] = @TokenEndpointAuthMethods,
        [CodeChallengeMethodsSupported] = @CodeChallengeMethodsSupported,
        [MetadataJSON] = @MetadataJSON,
        [CachedAt] = @CachedAt,
        [ExpiresAt] = @ExpiresAt
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwOAuthAuthServerMetadataCaches] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwOAuthAuthServerMetadataCaches]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJOAuthAuthServerMetadataCache] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the OAuthAuthServerMetadataCache table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJOAuthAuthServerMetadataCache]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJOAuthAuthServerMetadataCache];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJOAuthAuthServerMetadataCache
ON [${flyway:defaultSchema}].[OAuthAuthServerMetadataCache]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[OAuthAuthServerMetadataCache]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[OAuthAuthServerMetadataCache] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: O Auth Auth Server Metadata Caches */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJOAuthAuthServerMetadataCache] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: O Auth Auth Server Metadata Caches */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: O Auth Auth Server Metadata Caches
-- Item: spDeleteMJOAuthAuthServerMetadataCache
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR OAuthAuthServerMetadataCache
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJOAuthAuthServerMetadataCache]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJOAuthAuthServerMetadataCache];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJOAuthAuthServerMetadataCache]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[OAuthAuthServerMetadataCache]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJOAuthAuthServerMetadataCache] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: O Auth Auth Server Metadata Caches */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJOAuthAuthServerMetadataCache] TO [cdp_Integration]



/* Index for Foreign Keys for OpenAppDependency */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Open App Dependencies
-- Item: Index for Foreign Keys
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------
-- Index for foreign key OpenAppID in table OpenAppDependency
IF NOT EXISTS (
    SELECT 1
    FROM sys.indexes
    WHERE name = 'IDX_AUTO_MJ_FKEY_MJOpenAppDependency_OpenAppID' 
    AND object_id = OBJECT_ID('[${flyway:defaultSchema}].[OpenAppDependency]')
)
CREATE INDEX IDX_AUTO_MJ_FKEY_MJOpenAppDependency_OpenAppID ON [${flyway:defaultSchema}].[OpenAppDependency] ([OpenAppID]);

-- Index for foreign key DependsOnAppID in table OpenAppDependency
IF NOT EXISTS (
    SELECT 1
    FROM sys.indexes
    WHERE name = 'IDX_AUTO_MJ_FKEY_MJOpenAppDependency_DependsOnAppID' 
    AND object_id = OBJECT_ID('[${flyway:defaultSchema}].[OpenAppDependency]')
)
CREATE INDEX IDX_AUTO_MJ_FKEY_MJOpenAppDependency_DependsOnAppID ON [${flyway:defaultSchema}].[OpenAppDependency] ([DependsOnAppID]);

/* Index for Foreign Keys for OpenAppInstallHistory */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Open App Install Histories
-- Item: Index for Foreign Keys
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------
-- Index for foreign key OpenAppID in table OpenAppInstallHistory
IF NOT EXISTS (
    SELECT 1
    FROM sys.indexes
    WHERE name = 'IDX_AUTO_MJ_FKEY_MJOpenAppInstallHistory_OpenAppID' 
    AND object_id = OBJECT_ID('[${flyway:defaultSchema}].[OpenAppInstallHistory]')
)
CREATE INDEX IDX_AUTO_MJ_FKEY_MJOpenAppInstallHistory_OpenAppID ON [${flyway:defaultSchema}].[OpenAppInstallHistory] ([OpenAppID]);

-- Index for foreign key ExecutedByUserID in table OpenAppInstallHistory
IF NOT EXISTS (
    SELECT 1
    FROM sys.indexes
    WHERE name = 'IDX_AUTO_MJ_FKEY_MJOpenAppInstallHistory_ExecutedByUserID' 
    AND object_id = OBJECT_ID('[${flyway:defaultSchema}].[OpenAppInstallHistory]')
)
CREATE INDEX IDX_AUTO_MJ_FKEY_MJOpenAppInstallHistory_ExecutedByUserID ON [${flyway:defaultSchema}].[OpenAppInstallHistory] ([ExecutedByUserID]);

/* Index for Foreign Keys for OpenApp */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Open Apps
-- Item: Index for Foreign Keys
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------
-- Index for foreign key InstalledByUserID in table OpenApp
IF NOT EXISTS (
    SELECT 1
    FROM sys.indexes
    WHERE name = 'IDX_AUTO_MJ_FKEY_MJOpenApp_InstalledByUserID' 
    AND object_id = OBJECT_ID('[${flyway:defaultSchema}].[OpenApp]')
)
CREATE INDEX IDX_AUTO_MJ_FKEY_MJOpenApp_InstalledByUserID ON [${flyway:defaultSchema}].[OpenApp] ([InstalledByUserID]);

/* Base View SQL for MJ: Open App Dependencies */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Open App Dependencies
-- Item: vwOpenAppDependencies
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Open App Dependencies
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  OpenAppDependency
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwOpenAppDependencies]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwOpenAppDependencies];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwOpenAppDependencies]
AS
SELECT
    m.*,
    MJOpenApps_OpenAppID.[Name] AS [OpenApp],
    MJOpenApps_DependsOnAppID.[Name] AS [DependsOnApp]
FROM
    [${flyway:defaultSchema}].[OpenAppDependency] AS m
INNER JOIN
    [${flyway:defaultSchema}].[OpenApp] AS MJOpenApps_OpenAppID
  ON
    [m].[OpenAppID] = MJOpenApps_OpenAppID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[OpenApp] AS MJOpenApps_DependsOnAppID
  ON
    [m].[DependsOnAppID] = MJOpenApps_DependsOnAppID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwOpenAppDependencies] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Open App Dependencies */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Open App Dependencies
-- Item: Permissions for vwOpenAppDependencies
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwOpenAppDependencies] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Open App Dependencies */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Open App Dependencies
-- Item: spCreateMJOpenAppDependency
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR OpenAppDependency
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJOpenAppDependency]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJOpenAppDependency];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJOpenAppDependency]
    @ID uniqueidentifier = NULL,
    @OpenAppID uniqueidentifier,
    @DependsOnAppName nvarchar(64),
    @DependsOnAppID uniqueidentifier,
    @VersionRange nvarchar(100),
    @InstalledVersion nvarchar(50),
    @Status nvarchar(20) = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[OpenAppDependency]
            (
                [ID],
                [OpenAppID],
                [DependsOnAppName],
                [DependsOnAppID],
                [VersionRange],
                [InstalledVersion],
                [Status]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @OpenAppID,
                @DependsOnAppName,
                @DependsOnAppID,
                @VersionRange,
                @InstalledVersion,
                ISNULL(@Status, 'Satisfied')
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[OpenAppDependency]
            (
                [OpenAppID],
                [DependsOnAppName],
                [DependsOnAppID],
                [VersionRange],
                [InstalledVersion],
                [Status]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @OpenAppID,
                @DependsOnAppName,
                @DependsOnAppID,
                @VersionRange,
                @InstalledVersion,
                ISNULL(@Status, 'Satisfied')
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwOpenAppDependencies] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJOpenAppDependency] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Open App Dependencies */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJOpenAppDependency] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Open App Dependencies */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Open App Dependencies
-- Item: spUpdateMJOpenAppDependency
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR OpenAppDependency
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJOpenAppDependency]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJOpenAppDependency];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJOpenAppDependency]
    @ID uniqueidentifier,
    @OpenAppID uniqueidentifier,
    @DependsOnAppName nvarchar(64),
    @DependsOnAppID uniqueidentifier,
    @VersionRange nvarchar(100),
    @InstalledVersion nvarchar(50),
    @Status nvarchar(20)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[OpenAppDependency]
    SET
        [OpenAppID] = @OpenAppID,
        [DependsOnAppName] = @DependsOnAppName,
        [DependsOnAppID] = @DependsOnAppID,
        [VersionRange] = @VersionRange,
        [InstalledVersion] = @InstalledVersion,
        [Status] = @Status
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwOpenAppDependencies] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwOpenAppDependencies]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJOpenAppDependency] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the OpenAppDependency table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJOpenAppDependency]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJOpenAppDependency];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJOpenAppDependency
ON [${flyway:defaultSchema}].[OpenAppDependency]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[OpenAppDependency]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[OpenAppDependency] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Open App Dependencies */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJOpenAppDependency] TO [cdp_Developer], [cdp_Integration]



/* Base View SQL for MJ: Open App Install Histories */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Open App Install Histories
-- Item: vwOpenAppInstallHistories
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Open App Install Histories
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  OpenAppInstallHistory
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwOpenAppInstallHistories]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwOpenAppInstallHistories];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwOpenAppInstallHistories]
AS
SELECT
    m.*,
    MJOpenApps_OpenAppID.[Name] AS [OpenApp],
    MJUsers_ExecutedByUserID.[Name] AS [ExecutedByUser]
FROM
    [${flyway:defaultSchema}].[OpenAppInstallHistory] AS m
INNER JOIN
    [${flyway:defaultSchema}].[OpenApp] AS MJOpenApps_OpenAppID
  ON
    [m].[OpenAppID] = MJOpenApps_OpenAppID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_ExecutedByUserID
  ON
    [m].[ExecutedByUserID] = MJUsers_ExecutedByUserID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwOpenAppInstallHistories] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Open App Install Histories */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Open App Install Histories
-- Item: Permissions for vwOpenAppInstallHistories
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwOpenAppInstallHistories] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Open App Install Histories */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Open App Install Histories
-- Item: spCreateMJOpenAppInstallHistory
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR OpenAppInstallHistory
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJOpenAppInstallHistory]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJOpenAppInstallHistory];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJOpenAppInstallHistory]
    @ID uniqueidentifier = NULL,
    @OpenAppID uniqueidentifier,
    @Version nvarchar(50),
    @PreviousVersion nvarchar(50),
    @Action nvarchar(20),
    @ManifestJSON nvarchar(MAX),
    @Summary nvarchar(MAX),
    @ExecutedByUserID uniqueidentifier,
    @DurationSeconds int,
    @StartedAt datetimeoffset,
    @EndedAt datetimeoffset,
    @Success bit = NULL,
    @ErrorMessage nvarchar(MAX),
    @ErrorPhase nvarchar(50)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[OpenAppInstallHistory]
            (
                [ID],
                [OpenAppID],
                [Version],
                [PreviousVersion],
                [Action],
                [ManifestJSON],
                [Summary],
                [ExecutedByUserID],
                [DurationSeconds],
                [StartedAt],
                [EndedAt],
                [Success],
                [ErrorMessage],
                [ErrorPhase]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @OpenAppID,
                @Version,
                @PreviousVersion,
                @Action,
                @ManifestJSON,
                @Summary,
                @ExecutedByUserID,
                @DurationSeconds,
                @StartedAt,
                @EndedAt,
                ISNULL(@Success, 1),
                @ErrorMessage,
                @ErrorPhase
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[OpenAppInstallHistory]
            (
                [OpenAppID],
                [Version],
                [PreviousVersion],
                [Action],
                [ManifestJSON],
                [Summary],
                [ExecutedByUserID],
                [DurationSeconds],
                [StartedAt],
                [EndedAt],
                [Success],
                [ErrorMessage],
                [ErrorPhase]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @OpenAppID,
                @Version,
                @PreviousVersion,
                @Action,
                @ManifestJSON,
                @Summary,
                @ExecutedByUserID,
                @DurationSeconds,
                @StartedAt,
                @EndedAt,
                ISNULL(@Success, 1),
                @ErrorMessage,
                @ErrorPhase
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwOpenAppInstallHistories] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJOpenAppInstallHistory] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Open App Install Histories */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJOpenAppInstallHistory] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Open App Install Histories */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Open App Install Histories
-- Item: spUpdateMJOpenAppInstallHistory
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR OpenAppInstallHistory
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJOpenAppInstallHistory]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJOpenAppInstallHistory];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJOpenAppInstallHistory]
    @ID uniqueidentifier,
    @OpenAppID uniqueidentifier,
    @Version nvarchar(50),
    @PreviousVersion nvarchar(50),
    @Action nvarchar(20),
    @ManifestJSON nvarchar(MAX),
    @Summary nvarchar(MAX),
    @ExecutedByUserID uniqueidentifier,
    @DurationSeconds int,
    @StartedAt datetimeoffset,
    @EndedAt datetimeoffset,
    @Success bit,
    @ErrorMessage nvarchar(MAX),
    @ErrorPhase nvarchar(50)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[OpenAppInstallHistory]
    SET
        [OpenAppID] = @OpenAppID,
        [Version] = @Version,
        [PreviousVersion] = @PreviousVersion,
        [Action] = @Action,
        [ManifestJSON] = @ManifestJSON,
        [Summary] = @Summary,
        [ExecutedByUserID] = @ExecutedByUserID,
        [DurationSeconds] = @DurationSeconds,
        [StartedAt] = @StartedAt,
        [EndedAt] = @EndedAt,
        [Success] = @Success,
        [ErrorMessage] = @ErrorMessage,
        [ErrorPhase] = @ErrorPhase
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwOpenAppInstallHistories] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwOpenAppInstallHistories]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJOpenAppInstallHistory] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the OpenAppInstallHistory table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJOpenAppInstallHistory]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJOpenAppInstallHistory];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJOpenAppInstallHistory
ON [${flyway:defaultSchema}].[OpenAppInstallHistory]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[OpenAppInstallHistory]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[OpenAppInstallHistory] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Open App Install Histories */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJOpenAppInstallHistory] TO [cdp_Developer], [cdp_Integration]



/* Base View SQL for MJ: Open Apps */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Open Apps
-- Item: vwOpenApps
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Open Apps
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  OpenApp
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwOpenApps]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwOpenApps];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwOpenApps]
AS
SELECT
    m.*,
    MJUsers_InstalledByUserID.[Name] AS [InstalledByUser]
FROM
    [${flyway:defaultSchema}].[OpenApp] AS m
INNER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_InstalledByUserID
  ON
    [m].[InstalledByUserID] = MJUsers_InstalledByUserID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwOpenApps] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Open Apps */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Open Apps
-- Item: Permissions for vwOpenApps
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwOpenApps] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Open Apps */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Open Apps
-- Item: spCreateMJOpenApp
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR OpenApp
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJOpenApp]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJOpenApp];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJOpenApp]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(64),
    @DisplayName nvarchar(200),
    @Description nvarchar(MAX),
    @Version nvarchar(50),
    @Publisher nvarchar(200),
    @PublisherEmail nvarchar(255),
    @PublisherURL nvarchar(500),
    @RepositoryURL nvarchar(500),
    @SchemaName nvarchar(128),
    @MJVersionRange nvarchar(100),
    @License nvarchar(50),
    @Icon nvarchar(100),
    @Color nvarchar(20),
    @ManifestJSON nvarchar(MAX),
    @ConfigurationSchemaJSON nvarchar(MAX),
    @InstalledByUserID uniqueidentifier,
    @Status nvarchar(20) = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[OpenApp]
            (
                [ID],
                [Name],
                [DisplayName],
                [Description],
                [Version],
                [Publisher],
                [PublisherEmail],
                [PublisherURL],
                [RepositoryURL],
                [SchemaName],
                [MJVersionRange],
                [License],
                [Icon],
                [Color],
                [ManifestJSON],
                [ConfigurationSchemaJSON],
                [InstalledByUserID],
                [Status]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @DisplayName,
                @Description,
                @Version,
                @Publisher,
                @PublisherEmail,
                @PublisherURL,
                @RepositoryURL,
                @SchemaName,
                @MJVersionRange,
                @License,
                @Icon,
                @Color,
                @ManifestJSON,
                @ConfigurationSchemaJSON,
                @InstalledByUserID,
                ISNULL(@Status, 'Active')
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[OpenApp]
            (
                [Name],
                [DisplayName],
                [Description],
                [Version],
                [Publisher],
                [PublisherEmail],
                [PublisherURL],
                [RepositoryURL],
                [SchemaName],
                [MJVersionRange],
                [License],
                [Icon],
                [Color],
                [ManifestJSON],
                [ConfigurationSchemaJSON],
                [InstalledByUserID],
                [Status]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @DisplayName,
                @Description,
                @Version,
                @Publisher,
                @PublisherEmail,
                @PublisherURL,
                @RepositoryURL,
                @SchemaName,
                @MJVersionRange,
                @License,
                @Icon,
                @Color,
                @ManifestJSON,
                @ConfigurationSchemaJSON,
                @InstalledByUserID,
                ISNULL(@Status, 'Active')
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwOpenApps] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJOpenApp] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Open Apps */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJOpenApp] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Open Apps */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Open Apps
-- Item: spUpdateMJOpenApp
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR OpenApp
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJOpenApp]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJOpenApp];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJOpenApp]
    @ID uniqueidentifier,
    @Name nvarchar(64),
    @DisplayName nvarchar(200),
    @Description nvarchar(MAX),
    @Version nvarchar(50),
    @Publisher nvarchar(200),
    @PublisherEmail nvarchar(255),
    @PublisherURL nvarchar(500),
    @RepositoryURL nvarchar(500),
    @SchemaName nvarchar(128),
    @MJVersionRange nvarchar(100),
    @License nvarchar(50),
    @Icon nvarchar(100),
    @Color nvarchar(20),
    @ManifestJSON nvarchar(MAX),
    @ConfigurationSchemaJSON nvarchar(MAX),
    @InstalledByUserID uniqueidentifier,
    @Status nvarchar(20)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[OpenApp]
    SET
        [Name] = @Name,
        [DisplayName] = @DisplayName,
        [Description] = @Description,
        [Version] = @Version,
        [Publisher] = @Publisher,
        [PublisherEmail] = @PublisherEmail,
        [PublisherURL] = @PublisherURL,
        [RepositoryURL] = @RepositoryURL,
        [SchemaName] = @SchemaName,
        [MJVersionRange] = @MJVersionRange,
        [License] = @License,
        [Icon] = @Icon,
        [Color] = @Color,
        [ManifestJSON] = @ManifestJSON,
        [ConfigurationSchemaJSON] = @ConfigurationSchemaJSON,
        [InstalledByUserID] = @InstalledByUserID,
        [Status] = @Status
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwOpenApps] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwOpenApps]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJOpenApp] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the OpenApp table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJOpenApp]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJOpenApp];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJOpenApp
ON [${flyway:defaultSchema}].[OpenApp]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[OpenApp]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[OpenApp] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Open Apps */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJOpenApp] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Open App Dependencies */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Open App Dependencies
-- Item: spDeleteMJOpenAppDependency
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR OpenAppDependency
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJOpenAppDependency]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJOpenAppDependency];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJOpenAppDependency]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[OpenAppDependency]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJOpenAppDependency] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Open App Dependencies */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJOpenAppDependency] TO [cdp_Integration]



/* spDelete SQL for MJ: Open App Install Histories */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Open App Install Histories
-- Item: spDeleteMJOpenAppInstallHistory
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR OpenAppInstallHistory
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJOpenAppInstallHistory]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJOpenAppInstallHistory];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJOpenAppInstallHistory]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[OpenAppInstallHistory]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJOpenAppInstallHistory] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Open App Install Histories */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJOpenAppInstallHistory] TO [cdp_Integration]



/* spDelete SQL for MJ: Open Apps */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Open Apps
-- Item: spDeleteMJOpenApp
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR OpenApp
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJOpenApp]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJOpenApp];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJOpenApp]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[OpenApp]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJOpenApp] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Open Apps */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJOpenApp] TO [cdp_Integration]



/* Base View SQL for MJ: O Auth Client Registrations */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: O Auth Client Registrations
-- Item: vwOAuthClientRegistrations
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: O Auth Client Registrations
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  OAuthClientRegistration
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwOAuthClientRegistrations]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwOAuthClientRegistrations];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwOAuthClientRegistrations]
AS
SELECT
    m.*,
    MJMCPServerConnections_MCPServerConnectionID.[Name] AS [MCPServerConnection],
    MJMCPServers_MCPServerID.[Name] AS [MCPServer]
FROM
    [${flyway:defaultSchema}].[OAuthClientRegistration] AS m
INNER JOIN
    [${flyway:defaultSchema}].[MCPServerConnection] AS MJMCPServerConnections_MCPServerConnectionID
  ON
    [m].[MCPServerConnectionID] = MJMCPServerConnections_MCPServerConnectionID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[MCPServer] AS MJMCPServers_MCPServerID
  ON
    [m].[MCPServerID] = MJMCPServers_MCPServerID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwOAuthClientRegistrations] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: O Auth Client Registrations */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: O Auth Client Registrations
-- Item: Permissions for vwOAuthClientRegistrations
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwOAuthClientRegistrations] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: O Auth Client Registrations */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: O Auth Client Registrations
-- Item: spCreateMJOAuthClientRegistration
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR OAuthClientRegistration
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJOAuthClientRegistration]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJOAuthClientRegistration];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJOAuthClientRegistration]
    @ID uniqueidentifier = NULL,
    @MCPServerConnectionID uniqueidentifier,
    @MCPServerID uniqueidentifier,
    @IssuerURL nvarchar(1000),
    @ClientID nvarchar(500),
    @ClientSecretEncrypted nvarchar(MAX),
    @ClientIDIssuedAt datetimeoffset,
    @ClientSecretExpiresAt datetimeoffset,
    @RegistrationAccessToken nvarchar(MAX),
    @RegistrationClientURI nvarchar(1000),
    @RedirectURIs nvarchar(MAX),
    @GrantTypes nvarchar(MAX),
    @ResponseTypes nvarchar(MAX),
    @Scope nvarchar(500),
    @Status nvarchar(50) = NULL,
    @RegistrationResponse nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[OAuthClientRegistration]
            (
                [ID],
                [MCPServerConnectionID],
                [MCPServerID],
                [IssuerURL],
                [ClientID],
                [ClientSecretEncrypted],
                [ClientIDIssuedAt],
                [ClientSecretExpiresAt],
                [RegistrationAccessToken],
                [RegistrationClientURI],
                [RedirectURIs],
                [GrantTypes],
                [ResponseTypes],
                [Scope],
                [Status],
                [RegistrationResponse]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @MCPServerConnectionID,
                @MCPServerID,
                @IssuerURL,
                @ClientID,
                @ClientSecretEncrypted,
                @ClientIDIssuedAt,
                @ClientSecretExpiresAt,
                @RegistrationAccessToken,
                @RegistrationClientURI,
                @RedirectURIs,
                @GrantTypes,
                @ResponseTypes,
                @Scope,
                ISNULL(@Status, 'Active'),
                @RegistrationResponse
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[OAuthClientRegistration]
            (
                [MCPServerConnectionID],
                [MCPServerID],
                [IssuerURL],
                [ClientID],
                [ClientSecretEncrypted],
                [ClientIDIssuedAt],
                [ClientSecretExpiresAt],
                [RegistrationAccessToken],
                [RegistrationClientURI],
                [RedirectURIs],
                [GrantTypes],
                [ResponseTypes],
                [Scope],
                [Status],
                [RegistrationResponse]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @MCPServerConnectionID,
                @MCPServerID,
                @IssuerURL,
                @ClientID,
                @ClientSecretEncrypted,
                @ClientIDIssuedAt,
                @ClientSecretExpiresAt,
                @RegistrationAccessToken,
                @RegistrationClientURI,
                @RedirectURIs,
                @GrantTypes,
                @ResponseTypes,
                @Scope,
                ISNULL(@Status, 'Active'),
                @RegistrationResponse
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwOAuthClientRegistrations] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJOAuthClientRegistration] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: O Auth Client Registrations */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJOAuthClientRegistration] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: O Auth Client Registrations */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: O Auth Client Registrations
-- Item: spUpdateMJOAuthClientRegistration
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR OAuthClientRegistration
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJOAuthClientRegistration]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJOAuthClientRegistration];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJOAuthClientRegistration]
    @ID uniqueidentifier,
    @MCPServerConnectionID uniqueidentifier,
    @MCPServerID uniqueidentifier,
    @IssuerURL nvarchar(1000),
    @ClientID nvarchar(500),
    @ClientSecretEncrypted nvarchar(MAX),
    @ClientIDIssuedAt datetimeoffset,
    @ClientSecretExpiresAt datetimeoffset,
    @RegistrationAccessToken nvarchar(MAX),
    @RegistrationClientURI nvarchar(1000),
    @RedirectURIs nvarchar(MAX),
    @GrantTypes nvarchar(MAX),
    @ResponseTypes nvarchar(MAX),
    @Scope nvarchar(500),
    @Status nvarchar(50),
    @RegistrationResponse nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[OAuthClientRegistration]
    SET
        [MCPServerConnectionID] = @MCPServerConnectionID,
        [MCPServerID] = @MCPServerID,
        [IssuerURL] = @IssuerURL,
        [ClientID] = @ClientID,
        [ClientSecretEncrypted] = @ClientSecretEncrypted,
        [ClientIDIssuedAt] = @ClientIDIssuedAt,
        [ClientSecretExpiresAt] = @ClientSecretExpiresAt,
        [RegistrationAccessToken] = @RegistrationAccessToken,
        [RegistrationClientURI] = @RegistrationClientURI,
        [RedirectURIs] = @RedirectURIs,
        [GrantTypes] = @GrantTypes,
        [ResponseTypes] = @ResponseTypes,
        [Scope] = @Scope,
        [Status] = @Status,
        [RegistrationResponse] = @RegistrationResponse
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwOAuthClientRegistrations] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwOAuthClientRegistrations]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJOAuthClientRegistration] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the OAuthClientRegistration table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJOAuthClientRegistration]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJOAuthClientRegistration];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJOAuthClientRegistration
ON [${flyway:defaultSchema}].[OAuthClientRegistration]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[OAuthClientRegistration]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[OAuthClientRegistration] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: O Auth Client Registrations */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJOAuthClientRegistration] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: O Auth Client Registrations */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: O Auth Client Registrations
-- Item: spDeleteMJOAuthClientRegistration
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR OAuthClientRegistration
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJOAuthClientRegistration]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJOAuthClientRegistration];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJOAuthClientRegistration]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[OAuthClientRegistration]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJOAuthClientRegistration] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: O Auth Client Registrations */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJOAuthClientRegistration] TO [cdp_Integration]



/* Base View SQL for MJ: O Auth Tokens */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: O Auth Tokens
-- Item: vwOAuthTokens
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: O Auth Tokens
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  OAuthToken
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwOAuthTokens]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwOAuthTokens];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwOAuthTokens]
AS
SELECT
    m.*,
    MJMCPServerConnections_MCPServerConnectionID.[Name] AS [MCPServerConnection],
    MJCredentials_CredentialID.[Name] AS [Credential]
FROM
    [${flyway:defaultSchema}].[OAuthToken] AS m
INNER JOIN
    [${flyway:defaultSchema}].[MCPServerConnection] AS MJMCPServerConnections_MCPServerConnectionID
  ON
    [m].[MCPServerConnectionID] = MJMCPServerConnections_MCPServerConnectionID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[Credential] AS MJCredentials_CredentialID
  ON
    [m].[CredentialID] = MJCredentials_CredentialID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwOAuthTokens] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: O Auth Tokens */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: O Auth Tokens
-- Item: Permissions for vwOAuthTokens
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwOAuthTokens] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: O Auth Tokens */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: O Auth Tokens
-- Item: spCreateMJOAuthToken
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR OAuthToken
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJOAuthToken]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJOAuthToken];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJOAuthToken]
    @ID uniqueidentifier = NULL,
    @MCPServerConnectionID uniqueidentifier,
    @CredentialID uniqueidentifier,
    @TokenType nvarchar(50) = NULL,
    @ExpiresAt datetimeoffset,
    @Scope nvarchar(500),
    @IssuerURL nvarchar(1000),
    @LastRefreshAt datetimeoffset,
    @RefreshCount int = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[OAuthToken]
            (
                [ID],
                [MCPServerConnectionID],
                [CredentialID],
                [TokenType],
                [ExpiresAt],
                [Scope],
                [IssuerURL],
                [LastRefreshAt],
                [RefreshCount]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @MCPServerConnectionID,
                @CredentialID,
                ISNULL(@TokenType, 'Bearer'),
                @ExpiresAt,
                @Scope,
                @IssuerURL,
                @LastRefreshAt,
                ISNULL(@RefreshCount, 0)
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[OAuthToken]
            (
                [MCPServerConnectionID],
                [CredentialID],
                [TokenType],
                [ExpiresAt],
                [Scope],
                [IssuerURL],
                [LastRefreshAt],
                [RefreshCount]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @MCPServerConnectionID,
                @CredentialID,
                ISNULL(@TokenType, 'Bearer'),
                @ExpiresAt,
                @Scope,
                @IssuerURL,
                @LastRefreshAt,
                ISNULL(@RefreshCount, 0)
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwOAuthTokens] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJOAuthToken] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: O Auth Tokens */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJOAuthToken] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: O Auth Tokens */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: O Auth Tokens
-- Item: spUpdateMJOAuthToken
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR OAuthToken
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJOAuthToken]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJOAuthToken];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJOAuthToken]
    @ID uniqueidentifier,
    @MCPServerConnectionID uniqueidentifier,
    @CredentialID uniqueidentifier,
    @TokenType nvarchar(50),
    @ExpiresAt datetimeoffset,
    @Scope nvarchar(500),
    @IssuerURL nvarchar(1000),
    @LastRefreshAt datetimeoffset,
    @RefreshCount int
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[OAuthToken]
    SET
        [MCPServerConnectionID] = @MCPServerConnectionID,
        [CredentialID] = @CredentialID,
        [TokenType] = @TokenType,
        [ExpiresAt] = @ExpiresAt,
        [Scope] = @Scope,
        [IssuerURL] = @IssuerURL,
        [LastRefreshAt] = @LastRefreshAt,
        [RefreshCount] = @RefreshCount
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwOAuthTokens] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwOAuthTokens]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJOAuthToken] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the OAuthToken table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJOAuthToken]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJOAuthToken];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJOAuthToken
ON [${flyway:defaultSchema}].[OAuthToken]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[OAuthToken]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[OAuthToken] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: O Auth Tokens */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJOAuthToken] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: O Auth Tokens */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: O Auth Tokens
-- Item: spDeleteMJOAuthToken
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR OAuthToken
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJOAuthToken]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJOAuthToken];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJOAuthToken]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[OAuthToken]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJOAuthToken] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: O Auth Tokens */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJOAuthToken] TO [cdp_Integration]



/* Base View SQL for MJ: Public Links */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Public Links
-- Item: vwPublicLinks
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Public Links
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  PublicLink
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwPublicLinks]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwPublicLinks];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwPublicLinks]
AS
SELECT
    m.*,
    MJUsers_UserID.[Name] AS [User]
FROM
    [${flyway:defaultSchema}].[PublicLink] AS m
INNER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_UserID
  ON
    [m].[UserID] = MJUsers_UserID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwPublicLinks] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Public Links */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Public Links
-- Item: Permissions for vwPublicLinks
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwPublicLinks] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Public Links */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Public Links
-- Item: spCreateMJPublicLink
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR PublicLink
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJPublicLink]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJPublicLink];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJPublicLink]
    @ID uniqueidentifier = NULL,
    @ResourceType nvarchar(50),
    @ResourceID uniqueidentifier,
    @Token nvarchar(255),
    @PasswordHash nvarchar(255),
    @ExpiresAt datetimeoffset,
    @MaxViews int,
    @CurrentViews int = NULL,
    @UserID uniqueidentifier,
    @IsActive bit = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[PublicLink]
            (
                [ID],
                [ResourceType],
                [ResourceID],
                [Token],
                [PasswordHash],
                [ExpiresAt],
                [MaxViews],
                [CurrentViews],
                [UserID],
                [IsActive]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @ResourceType,
                @ResourceID,
                @Token,
                @PasswordHash,
                @ExpiresAt,
                @MaxViews,
                ISNULL(@CurrentViews, 0),
                @UserID,
                ISNULL(@IsActive, 1)
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[PublicLink]
            (
                [ResourceType],
                [ResourceID],
                [Token],
                [PasswordHash],
                [ExpiresAt],
                [MaxViews],
                [CurrentViews],
                [UserID],
                [IsActive]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ResourceType,
                @ResourceID,
                @Token,
                @PasswordHash,
                @ExpiresAt,
                @MaxViews,
                ISNULL(@CurrentViews, 0),
                @UserID,
                ISNULL(@IsActive, 1)
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwPublicLinks] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJPublicLink] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Public Links */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJPublicLink] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Public Links */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Public Links
-- Item: spUpdateMJPublicLink
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR PublicLink
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJPublicLink]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJPublicLink];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJPublicLink]
    @ID uniqueidentifier,
    @ResourceType nvarchar(50),
    @ResourceID uniqueidentifier,
    @Token nvarchar(255),
    @PasswordHash nvarchar(255),
    @ExpiresAt datetimeoffset,
    @MaxViews int,
    @CurrentViews int,
    @UserID uniqueidentifier,
    @IsActive bit
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[PublicLink]
    SET
        [ResourceType] = @ResourceType,
        [ResourceID] = @ResourceID,
        [Token] = @Token,
        [PasswordHash] = @PasswordHash,
        [ExpiresAt] = @ExpiresAt,
        [MaxViews] = @MaxViews,
        [CurrentViews] = @CurrentViews,
        [UserID] = @UserID,
        [IsActive] = @IsActive
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwPublicLinks] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwPublicLinks]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJPublicLink] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the PublicLink table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJPublicLink]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJPublicLink];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJPublicLink
ON [${flyway:defaultSchema}].[PublicLink]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[PublicLink]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[PublicLink] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Public Links */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJPublicLink] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Public Links */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Public Links
-- Item: spDeleteMJPublicLink
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR PublicLink
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJPublicLink]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJPublicLink];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJPublicLink]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[PublicLink]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJPublicLink] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Public Links */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJPublicLink] TO [cdp_Integration]



/* Base View SQL for MJ: Output Delivery Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Output Delivery Types
-- Item: vwOutputDeliveryTypes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Output Delivery Types
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  OutputDeliveryType
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwOutputDeliveryTypes]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwOutputDeliveryTypes];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwOutputDeliveryTypes]
AS
SELECT
    m.*
FROM
    [${flyway:defaultSchema}].[OutputDeliveryType] AS m
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwOutputDeliveryTypes] TO [cdp_UI]
    

/* Base View Permissions SQL for MJ: Output Delivery Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Output Delivery Types
-- Item: Permissions for vwOutputDeliveryTypes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwOutputDeliveryTypes] TO [cdp_UI]

/* spCreate SQL for MJ: Output Delivery Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Output Delivery Types
-- Item: spCreateMJOutputDeliveryType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR OutputDeliveryType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJOutputDeliveryType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJOutputDeliveryType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJOutputDeliveryType]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(255),
    @Description nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[OutputDeliveryType]
            (
                [ID],
                [Name],
                [Description]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[OutputDeliveryType]
            (
                [Name],
                [Description]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwOutputDeliveryTypes] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJOutputDeliveryType] TO [cdp_UI]
    

/* spCreate Permissions for MJ: Output Delivery Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJOutputDeliveryType] TO [cdp_UI]



/* spUpdate SQL for MJ: Output Delivery Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Output Delivery Types
-- Item: spUpdateMJOutputDeliveryType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR OutputDeliveryType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJOutputDeliveryType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJOutputDeliveryType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJOutputDeliveryType]
    @ID uniqueidentifier,
    @Name nvarchar(255),
    @Description nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[OutputDeliveryType]
    SET
        [Name] = @Name,
        [Description] = @Description
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwOutputDeliveryTypes] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwOutputDeliveryTypes]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJOutputDeliveryType] TO [cdp_UI]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the OutputDeliveryType table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJOutputDeliveryType]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJOutputDeliveryType];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJOutputDeliveryType
ON [${flyway:defaultSchema}].[OutputDeliveryType]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[OutputDeliveryType]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[OutputDeliveryType] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Output Delivery Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJOutputDeliveryType] TO [cdp_UI]



/* spDelete SQL for MJ: Output Delivery Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Output Delivery Types
-- Item: spDeleteMJOutputDeliveryType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR OutputDeliveryType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJOutputDeliveryType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJOutputDeliveryType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJOutputDeliveryType]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[OutputDeliveryType]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJOutputDeliveryType] TO [cdp_UI]
    

/* spDelete Permissions for MJ: Output Delivery Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJOutputDeliveryType] TO [cdp_UI]



/* Base View SQL for MJ: Output Format Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Output Format Types
-- Item: vwOutputFormatTypes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Output Format Types
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  OutputFormatType
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwOutputFormatTypes]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwOutputFormatTypes];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwOutputFormatTypes]
AS
SELECT
    m.*
FROM
    [${flyway:defaultSchema}].[OutputFormatType] AS m
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwOutputFormatTypes] TO [cdp_UI]
    

/* Base View Permissions SQL for MJ: Output Format Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Output Format Types
-- Item: Permissions for vwOutputFormatTypes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwOutputFormatTypes] TO [cdp_UI]

/* spCreate SQL for MJ: Output Format Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Output Format Types
-- Item: spCreateMJOutputFormatType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR OutputFormatType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJOutputFormatType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJOutputFormatType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJOutputFormatType]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @DisplayFormat nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[OutputFormatType]
            (
                [ID],
                [Name],
                [Description],
                [DisplayFormat]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description,
                @DisplayFormat
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[OutputFormatType]
            (
                [Name],
                [Description],
                [DisplayFormat]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description,
                @DisplayFormat
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwOutputFormatTypes] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJOutputFormatType] TO [cdp_UI]
    

/* spCreate Permissions for MJ: Output Format Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJOutputFormatType] TO [cdp_UI]



/* spUpdate SQL for MJ: Output Format Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Output Format Types
-- Item: spUpdateMJOutputFormatType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR OutputFormatType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJOutputFormatType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJOutputFormatType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJOutputFormatType]
    @ID uniqueidentifier,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @DisplayFormat nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[OutputFormatType]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [DisplayFormat] = @DisplayFormat
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwOutputFormatTypes] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwOutputFormatTypes]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJOutputFormatType] TO [cdp_UI]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the OutputFormatType table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJOutputFormatType]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJOutputFormatType];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJOutputFormatType
ON [${flyway:defaultSchema}].[OutputFormatType]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[OutputFormatType]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[OutputFormatType] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Output Format Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJOutputFormatType] TO [cdp_UI]



/* spDelete SQL for MJ: Output Format Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Output Format Types
-- Item: spDeleteMJOutputFormatType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR OutputFormatType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJOutputFormatType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJOutputFormatType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJOutputFormatType]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[OutputFormatType]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJOutputFormatType] TO [cdp_UI]
    

/* spDelete Permissions for MJ: Output Format Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJOutputFormatType] TO [cdp_UI]



/* Base View SQL for MJ: Output Trigger Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Output Trigger Types
-- Item: vwOutputTriggerTypes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Output Trigger Types
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  OutputTriggerType
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwOutputTriggerTypes]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwOutputTriggerTypes];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwOutputTriggerTypes]
AS
SELECT
    m.*
FROM
    [${flyway:defaultSchema}].[OutputTriggerType] AS m
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwOutputTriggerTypes] TO [cdp_UI]
    

/* Base View Permissions SQL for MJ: Output Trigger Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Output Trigger Types
-- Item: Permissions for vwOutputTriggerTypes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwOutputTriggerTypes] TO [cdp_UI]

/* spCreate SQL for MJ: Output Trigger Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Output Trigger Types
-- Item: spCreateMJOutputTriggerType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR OutputTriggerType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJOutputTriggerType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJOutputTriggerType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJOutputTriggerType]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(255),
    @Description nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[OutputTriggerType]
            (
                [ID],
                [Name],
                [Description]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[OutputTriggerType]
            (
                [Name],
                [Description]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwOutputTriggerTypes] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJOutputTriggerType] TO [cdp_UI]
    

/* spCreate Permissions for MJ: Output Trigger Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJOutputTriggerType] TO [cdp_UI]



/* spUpdate SQL for MJ: Output Trigger Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Output Trigger Types
-- Item: spUpdateMJOutputTriggerType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR OutputTriggerType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJOutputTriggerType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJOutputTriggerType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJOutputTriggerType]
    @ID uniqueidentifier,
    @Name nvarchar(255),
    @Description nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[OutputTriggerType]
    SET
        [Name] = @Name,
        [Description] = @Description
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwOutputTriggerTypes] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwOutputTriggerTypes]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJOutputTriggerType] TO [cdp_UI]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the OutputTriggerType table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJOutputTriggerType]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJOutputTriggerType];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJOutputTriggerType
ON [${flyway:defaultSchema}].[OutputTriggerType]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[OutputTriggerType]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[OutputTriggerType] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Output Trigger Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJOutputTriggerType] TO [cdp_UI]



/* spDelete SQL for MJ: Output Trigger Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Output Trigger Types
-- Item: spDeleteMJOutputTriggerType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR OutputTriggerType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJOutputTriggerType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJOutputTriggerType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJOutputTriggerType]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[OutputTriggerType]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJOutputTriggerType] TO [cdp_UI]
    

/* spDelete Permissions for MJ: Output Trigger Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJOutputTriggerType] TO [cdp_UI]



/* Base View SQL for MJ: Projects */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Projects
-- Item: vwProjects
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Projects
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  Project
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwProjects]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwProjects];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwProjects]
AS
SELECT
    m.*,
    MJEnvironments_EnvironmentID.[Name] AS [Environment],
    MJProjects_ParentID.[Name] AS [Parent],
    root_ParentID.RootID AS [RootParentID]
FROM
    [${flyway:defaultSchema}].[Project] AS m
INNER JOIN
    [${flyway:defaultSchema}].[Environment] AS MJEnvironments_EnvironmentID
  ON
    [m].[EnvironmentID] = MJEnvironments_EnvironmentID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[Project] AS MJProjects_ParentID
  ON
    [m].[ParentID] = MJProjects_ParentID.[ID]
OUTER APPLY
    [${flyway:defaultSchema}].[fnProjectParentID_GetRootID]([m].[ID], [m].[ParentID]) AS root_ParentID
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwProjects] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Projects */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Projects
-- Item: Permissions for vwProjects
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwProjects] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Projects */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Projects
-- Item: spCreateMJProject
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR Project
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJProject]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJProject];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJProject]
    @ID uniqueidentifier = NULL,
    @EnvironmentID uniqueidentifier = NULL,
    @ParentID uniqueidentifier,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @Color nvarchar(7),
    @Icon nvarchar(50),
    @IsArchived bit = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[Project]
            (
                [ID],
                [EnvironmentID],
                [ParentID],
                [Name],
                [Description],
                [Color],
                [Icon],
                [IsArchived]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                CASE @EnvironmentID WHEN '00000000-0000-0000-0000-000000000000' THEN 'F51358F3-9447-4176-B313-BF8025FD8D09' ELSE ISNULL(@EnvironmentID, 'F51358F3-9447-4176-B313-BF8025FD8D09') END,
                @ParentID,
                @Name,
                @Description,
                @Color,
                @Icon,
                ISNULL(@IsArchived, 0)
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[Project]
            (
                [EnvironmentID],
                [ParentID],
                [Name],
                [Description],
                [Color],
                [Icon],
                [IsArchived]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                CASE @EnvironmentID WHEN '00000000-0000-0000-0000-000000000000' THEN 'F51358F3-9447-4176-B313-BF8025FD8D09' ELSE ISNULL(@EnvironmentID, 'F51358F3-9447-4176-B313-BF8025FD8D09') END,
                @ParentID,
                @Name,
                @Description,
                @Color,
                @Icon,
                ISNULL(@IsArchived, 0)
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwProjects] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJProject] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Projects */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJProject] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Projects */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Projects
-- Item: spUpdateMJProject
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR Project
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJProject]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJProject];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJProject]
    @ID uniqueidentifier,
    @EnvironmentID uniqueidentifier,
    @ParentID uniqueidentifier,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @Color nvarchar(7),
    @Icon nvarchar(50),
    @IsArchived bit
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[Project]
    SET
        [EnvironmentID] = @EnvironmentID,
        [ParentID] = @ParentID,
        [Name] = @Name,
        [Description] = @Description,
        [Color] = @Color,
        [Icon] = @Icon,
        [IsArchived] = @IsArchived
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwProjects] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwProjects]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJProject] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the Project table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJProject]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJProject];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJProject
ON [${flyway:defaultSchema}].[Project]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[Project]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[Project] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Projects */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJProject] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Projects */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Projects
-- Item: spDeleteMJProject
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR Project
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJProject]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJProject];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJProject]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[Project]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJProject] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Projects */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJProject] TO [cdp_Integration]



/* Base View SQL for MJ: Query Fields */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Query Fields
-- Item: vwQueryFields
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Query Fields
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  QueryField
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwQueryFields]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwQueryFields];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwQueryFields]
AS
SELECT
    m.*,
    MJQueries_QueryID.[Name] AS [Query],
    MJEntities_SourceEntityID.[Name] AS [SourceEntity]
FROM
    [${flyway:defaultSchema}].[QueryField] AS m
INNER JOIN
    [${flyway:defaultSchema}].[Query] AS MJQueries_QueryID
  ON
    [m].[QueryID] = MJQueries_QueryID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[Entity] AS MJEntities_SourceEntityID
  ON
    [m].[SourceEntityID] = MJEntities_SourceEntityID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwQueryFields] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Query Fields */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Query Fields
-- Item: Permissions for vwQueryFields
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwQueryFields] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Query Fields */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Query Fields
-- Item: spCreateMJQueryField
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR QueryField
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJQueryField]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJQueryField];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJQueryField]
    @ID uniqueidentifier = NULL,
    @QueryID uniqueidentifier,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @Sequence int,
    @SQLBaseType nvarchar(50),
    @SQLFullType nvarchar(100),
    @SourceEntityID uniqueidentifier,
    @SourceFieldName nvarchar(255),
    @IsComputed bit = NULL,
    @ComputationDescription nvarchar(MAX),
    @IsSummary bit = NULL,
    @SummaryDescription nvarchar(MAX),
    @DetectionMethod nvarchar(50) = NULL,
    @AutoDetectConfidenceScore decimal(3, 2)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[QueryField]
            (
                [ID],
                [QueryID],
                [Name],
                [Description],
                [Sequence],
                [SQLBaseType],
                [SQLFullType],
                [SourceEntityID],
                [SourceFieldName],
                [IsComputed],
                [ComputationDescription],
                [IsSummary],
                [SummaryDescription],
                [DetectionMethod],
                [AutoDetectConfidenceScore]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @QueryID,
                @Name,
                @Description,
                @Sequence,
                @SQLBaseType,
                @SQLFullType,
                @SourceEntityID,
                @SourceFieldName,
                ISNULL(@IsComputed, 0),
                @ComputationDescription,
                ISNULL(@IsSummary, 0),
                @SummaryDescription,
                ISNULL(@DetectionMethod, 'Manual'),
                @AutoDetectConfidenceScore
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[QueryField]
            (
                [QueryID],
                [Name],
                [Description],
                [Sequence],
                [SQLBaseType],
                [SQLFullType],
                [SourceEntityID],
                [SourceFieldName],
                [IsComputed],
                [ComputationDescription],
                [IsSummary],
                [SummaryDescription],
                [DetectionMethod],
                [AutoDetectConfidenceScore]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @QueryID,
                @Name,
                @Description,
                @Sequence,
                @SQLBaseType,
                @SQLFullType,
                @SourceEntityID,
                @SourceFieldName,
                ISNULL(@IsComputed, 0),
                @ComputationDescription,
                ISNULL(@IsSummary, 0),
                @SummaryDescription,
                ISNULL(@DetectionMethod, 'Manual'),
                @AutoDetectConfidenceScore
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwQueryFields] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJQueryField] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Query Fields */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJQueryField] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Query Fields */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Query Fields
-- Item: spUpdateMJQueryField
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR QueryField
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJQueryField]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJQueryField];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJQueryField]
    @ID uniqueidentifier,
    @QueryID uniqueidentifier,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @Sequence int,
    @SQLBaseType nvarchar(50),
    @SQLFullType nvarchar(100),
    @SourceEntityID uniqueidentifier,
    @SourceFieldName nvarchar(255),
    @IsComputed bit,
    @ComputationDescription nvarchar(MAX),
    @IsSummary bit,
    @SummaryDescription nvarchar(MAX),
    @DetectionMethod nvarchar(50),
    @AutoDetectConfidenceScore decimal(3, 2)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[QueryField]
    SET
        [QueryID] = @QueryID,
        [Name] = @Name,
        [Description] = @Description,
        [Sequence] = @Sequence,
        [SQLBaseType] = @SQLBaseType,
        [SQLFullType] = @SQLFullType,
        [SourceEntityID] = @SourceEntityID,
        [SourceFieldName] = @SourceFieldName,
        [IsComputed] = @IsComputed,
        [ComputationDescription] = @ComputationDescription,
        [IsSummary] = @IsSummary,
        [SummaryDescription] = @SummaryDescription,
        [DetectionMethod] = @DetectionMethod,
        [AutoDetectConfidenceScore] = @AutoDetectConfidenceScore
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwQueryFields] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwQueryFields]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJQueryField] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the QueryField table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJQueryField]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJQueryField];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJQueryField
ON [${flyway:defaultSchema}].[QueryField]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[QueryField]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[QueryField] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Query Fields */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJQueryField] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Query Fields */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Query Fields
-- Item: spDeleteMJQueryField
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR QueryField
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJQueryField]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJQueryField];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJQueryField]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[QueryField]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJQueryField] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Query Fields */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJQueryField] TO [cdp_Integration]



/* Base View SQL for MJ: Queries */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Queries
-- Item: vwQueries
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Queries
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  Query
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwQueries]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwQueries];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwQueries]
AS
SELECT
    m.*,
    MJQueryCategories_CategoryID.[Name] AS [Category],
    MJAIModels_EmbeddingModelID.[Name] AS [EmbeddingModel]
FROM
    [${flyway:defaultSchema}].[Query] AS m
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[QueryCategory] AS MJQueryCategories_CategoryID
  ON
    [m].[CategoryID] = MJQueryCategories_CategoryID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[AIModel] AS MJAIModels_EmbeddingModelID
  ON
    [m].[EmbeddingModelID] = MJAIModels_EmbeddingModelID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwQueries] TO [cdp_Developer], [cdp_UI], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Queries */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Queries
-- Item: Permissions for vwQueries
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwQueries] TO [cdp_Developer], [cdp_UI], [cdp_Integration]

/* spCreate SQL for MJ: Queries */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Queries
-- Item: spCreateMJQuery
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR Query
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJQuery]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJQuery];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJQuery]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(255),
    @CategoryID uniqueidentifier,
    @UserQuestion nvarchar(MAX),
    @Description nvarchar(MAX),
    @SQL nvarchar(MAX),
    @TechnicalDescription nvarchar(MAX),
    @OriginalSQL nvarchar(MAX),
    @Feedback nvarchar(MAX),
    @Status nvarchar(15) = NULL,
    @QualityRank int,
    @ExecutionCostRank int,
    @UsesTemplate bit,
    @AuditQueryRuns bit = NULL,
    @CacheEnabled bit = NULL,
    @CacheTTLMinutes int,
    @CacheMaxSize int,
    @EmbeddingVector nvarchar(MAX),
    @EmbeddingModelID uniqueidentifier,
    @CacheValidationSQL nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[Query]
            (
                [ID],
                [Name],
                [CategoryID],
                [UserQuestion],
                [Description],
                [SQL],
                [TechnicalDescription],
                [OriginalSQL],
                [Feedback],
                [Status],
                [QualityRank],
                [ExecutionCostRank],
                [UsesTemplate],
                [AuditQueryRuns],
                [CacheEnabled],
                [CacheTTLMinutes],
                [CacheMaxSize],
                [EmbeddingVector],
                [EmbeddingModelID],
                [CacheValidationSQL]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @CategoryID,
                @UserQuestion,
                @Description,
                @SQL,
                @TechnicalDescription,
                @OriginalSQL,
                @Feedback,
                ISNULL(@Status, 'Pending'),
                @QualityRank,
                @ExecutionCostRank,
                @UsesTemplate,
                ISNULL(@AuditQueryRuns, 0),
                ISNULL(@CacheEnabled, 0),
                @CacheTTLMinutes,
                @CacheMaxSize,
                @EmbeddingVector,
                @EmbeddingModelID,
                @CacheValidationSQL
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[Query]
            (
                [Name],
                [CategoryID],
                [UserQuestion],
                [Description],
                [SQL],
                [TechnicalDescription],
                [OriginalSQL],
                [Feedback],
                [Status],
                [QualityRank],
                [ExecutionCostRank],
                [UsesTemplate],
                [AuditQueryRuns],
                [CacheEnabled],
                [CacheTTLMinutes],
                [CacheMaxSize],
                [EmbeddingVector],
                [EmbeddingModelID],
                [CacheValidationSQL]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @CategoryID,
                @UserQuestion,
                @Description,
                @SQL,
                @TechnicalDescription,
                @OriginalSQL,
                @Feedback,
                ISNULL(@Status, 'Pending'),
                @QualityRank,
                @ExecutionCostRank,
                @UsesTemplate,
                ISNULL(@AuditQueryRuns, 0),
                ISNULL(@CacheEnabled, 0),
                @CacheTTLMinutes,
                @CacheMaxSize,
                @EmbeddingVector,
                @EmbeddingModelID,
                @CacheValidationSQL
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwQueries] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJQuery] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Queries */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJQuery] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Queries */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Queries
-- Item: spUpdateMJQuery
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR Query
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJQuery]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJQuery];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJQuery]
    @ID uniqueidentifier,
    @Name nvarchar(255),
    @CategoryID uniqueidentifier,
    @UserQuestion nvarchar(MAX),
    @Description nvarchar(MAX),
    @SQL nvarchar(MAX),
    @TechnicalDescription nvarchar(MAX),
    @OriginalSQL nvarchar(MAX),
    @Feedback nvarchar(MAX),
    @Status nvarchar(15),
    @QualityRank int,
    @ExecutionCostRank int,
    @UsesTemplate bit,
    @AuditQueryRuns bit,
    @CacheEnabled bit,
    @CacheTTLMinutes int,
    @CacheMaxSize int,
    @EmbeddingVector nvarchar(MAX),
    @EmbeddingModelID uniqueidentifier,
    @CacheValidationSQL nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[Query]
    SET
        [Name] = @Name,
        [CategoryID] = @CategoryID,
        [UserQuestion] = @UserQuestion,
        [Description] = @Description,
        [SQL] = @SQL,
        [TechnicalDescription] = @TechnicalDescription,
        [OriginalSQL] = @OriginalSQL,
        [Feedback] = @Feedback,
        [Status] = @Status,
        [QualityRank] = @QualityRank,
        [ExecutionCostRank] = @ExecutionCostRank,
        [UsesTemplate] = @UsesTemplate,
        [AuditQueryRuns] = @AuditQueryRuns,
        [CacheEnabled] = @CacheEnabled,
        [CacheTTLMinutes] = @CacheTTLMinutes,
        [CacheMaxSize] = @CacheMaxSize,
        [EmbeddingVector] = @EmbeddingVector,
        [EmbeddingModelID] = @EmbeddingModelID,
        [CacheValidationSQL] = @CacheValidationSQL
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwQueries] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwQueries]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJQuery] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the Query table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJQuery]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJQuery];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJQuery
ON [${flyway:defaultSchema}].[Query]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[Query]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[Query] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Queries */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJQuery] TO [cdp_Developer], [cdp_Integration]



/* Base View SQL for MJ: Query Categories */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Query Categories
-- Item: vwQueryCategories
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Query Categories
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  QueryCategory
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwQueryCategories]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwQueryCategories];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwQueryCategories]
AS
SELECT
    m.*,
    MJQueryCategories_ParentID.[Name] AS [Parent],
    MJUsers_UserID.[Name] AS [User],
    root_ParentID.RootID AS [RootParentID]
FROM
    [${flyway:defaultSchema}].[QueryCategory] AS m
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[QueryCategory] AS MJQueryCategories_ParentID
  ON
    [m].[ParentID] = MJQueryCategories_ParentID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_UserID
  ON
    [m].[UserID] = MJUsers_UserID.[ID]
OUTER APPLY
    [${flyway:defaultSchema}].[fnQueryCategoryParentID_GetRootID]([m].[ID], [m].[ParentID]) AS root_ParentID
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwQueryCategories] TO [cdp_Integration], [cdp_Developer], [cdp_UI]
    

/* Base View Permissions SQL for MJ: Query Categories */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Query Categories
-- Item: Permissions for vwQueryCategories
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwQueryCategories] TO [cdp_Integration], [cdp_Developer], [cdp_UI]

/* spCreate SQL for MJ: Query Categories */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Query Categories
-- Item: spCreateMJQueryCategory
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR QueryCategory
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJQueryCategory]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJQueryCategory];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJQueryCategory]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(50),
    @ParentID uniqueidentifier,
    @Description nvarchar(MAX),
    @UserID uniqueidentifier,
    @DefaultCacheEnabled bit = NULL,
    @DefaultCacheTTLMinutes int,
    @DefaultCacheMaxSize int,
    @CacheInheritanceEnabled bit = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[QueryCategory]
            (
                [ID],
                [Name],
                [ParentID],
                [Description],
                [UserID],
                [DefaultCacheEnabled],
                [DefaultCacheTTLMinutes],
                [DefaultCacheMaxSize],
                [CacheInheritanceEnabled]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @ParentID,
                @Description,
                @UserID,
                ISNULL(@DefaultCacheEnabled, 0),
                @DefaultCacheTTLMinutes,
                @DefaultCacheMaxSize,
                ISNULL(@CacheInheritanceEnabled, 1)
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[QueryCategory]
            (
                [Name],
                [ParentID],
                [Description],
                [UserID],
                [DefaultCacheEnabled],
                [DefaultCacheTTLMinutes],
                [DefaultCacheMaxSize],
                [CacheInheritanceEnabled]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @ParentID,
                @Description,
                @UserID,
                ISNULL(@DefaultCacheEnabled, 0),
                @DefaultCacheTTLMinutes,
                @DefaultCacheMaxSize,
                ISNULL(@CacheInheritanceEnabled, 1)
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwQueryCategories] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJQueryCategory] TO [cdp_Integration], [cdp_Developer]
    

/* spCreate Permissions for MJ: Query Categories */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJQueryCategory] TO [cdp_Integration], [cdp_Developer]



/* spUpdate SQL for MJ: Query Categories */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Query Categories
-- Item: spUpdateMJQueryCategory
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR QueryCategory
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJQueryCategory]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJQueryCategory];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJQueryCategory]
    @ID uniqueidentifier,
    @Name nvarchar(50),
    @ParentID uniqueidentifier,
    @Description nvarchar(MAX),
    @UserID uniqueidentifier,
    @DefaultCacheEnabled bit,
    @DefaultCacheTTLMinutes int,
    @DefaultCacheMaxSize int,
    @CacheInheritanceEnabled bit
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[QueryCategory]
    SET
        [Name] = @Name,
        [ParentID] = @ParentID,
        [Description] = @Description,
        [UserID] = @UserID,
        [DefaultCacheEnabled] = @DefaultCacheEnabled,
        [DefaultCacheTTLMinutes] = @DefaultCacheTTLMinutes,
        [DefaultCacheMaxSize] = @DefaultCacheMaxSize,
        [CacheInheritanceEnabled] = @CacheInheritanceEnabled
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwQueryCategories] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwQueryCategories]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJQueryCategory] TO [cdp_Integration], [cdp_Developer], [cdp_UI]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the QueryCategory table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJQueryCategory]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJQueryCategory];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJQueryCategory
ON [${flyway:defaultSchema}].[QueryCategory]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[QueryCategory]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[QueryCategory] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Query Categories */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJQueryCategory] TO [cdp_Integration], [cdp_Developer], [cdp_UI]



/* spDelete SQL for MJ: Query Categories */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Query Categories
-- Item: spDeleteMJQueryCategory
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR QueryCategory
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJQueryCategory]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJQueryCategory];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJQueryCategory]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[QueryCategory]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJQueryCategory] TO [cdp_Integration], [cdp_Developer], [cdp_UI]
    

/* spDelete Permissions for MJ: Query Categories */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJQueryCategory] TO [cdp_Integration], [cdp_Developer], [cdp_UI]



/* Base View SQL for MJ: Query Entities */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Query Entities
-- Item: vwQueryEntities
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Query Entities
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  QueryEntity
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwQueryEntities]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwQueryEntities];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwQueryEntities]
AS
SELECT
    m.*,
    MJQueries_QueryID.[Name] AS [Query],
    MJEntities_EntityID.[Name] AS [Entity]
FROM
    [${flyway:defaultSchema}].[QueryEntity] AS m
INNER JOIN
    [${flyway:defaultSchema}].[Query] AS MJQueries_QueryID
  ON
    [m].[QueryID] = MJQueries_QueryID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[Entity] AS MJEntities_EntityID
  ON
    [m].[EntityID] = MJEntities_EntityID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwQueryEntities] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Query Entities */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Query Entities
-- Item: Permissions for vwQueryEntities
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwQueryEntities] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Query Entities */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Query Entities
-- Item: spCreateMJQueryEntity
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR QueryEntity
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJQueryEntity]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJQueryEntity];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJQueryEntity]
    @ID uniqueidentifier = NULL,
    @QueryID uniqueidentifier,
    @EntityID uniqueidentifier,
    @DetectionMethod nvarchar(50) = NULL,
    @AutoDetectConfidenceScore decimal(3, 2)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[QueryEntity]
            (
                [ID],
                [QueryID],
                [EntityID],
                [DetectionMethod],
                [AutoDetectConfidenceScore]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @QueryID,
                @EntityID,
                ISNULL(@DetectionMethod, 'Manual'),
                @AutoDetectConfidenceScore
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[QueryEntity]
            (
                [QueryID],
                [EntityID],
                [DetectionMethod],
                [AutoDetectConfidenceScore]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @QueryID,
                @EntityID,
                ISNULL(@DetectionMethod, 'Manual'),
                @AutoDetectConfidenceScore
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwQueryEntities] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJQueryEntity] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Query Entities */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJQueryEntity] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Query Entities */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Query Entities
-- Item: spUpdateMJQueryEntity
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR QueryEntity
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJQueryEntity]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJQueryEntity];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJQueryEntity]
    @ID uniqueidentifier,
    @QueryID uniqueidentifier,
    @EntityID uniqueidentifier,
    @DetectionMethod nvarchar(50),
    @AutoDetectConfidenceScore decimal(3, 2)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[QueryEntity]
    SET
        [QueryID] = @QueryID,
        [EntityID] = @EntityID,
        [DetectionMethod] = @DetectionMethod,
        [AutoDetectConfidenceScore] = @AutoDetectConfidenceScore
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwQueryEntities] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwQueryEntities]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJQueryEntity] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the QueryEntity table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJQueryEntity]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJQueryEntity];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJQueryEntity
ON [${flyway:defaultSchema}].[QueryEntity]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[QueryEntity]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[QueryEntity] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Query Entities */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJQueryEntity] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Query Entities */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Query Entities
-- Item: spDeleteMJQueryEntity
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR QueryEntity
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJQueryEntity]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJQueryEntity];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJQueryEntity]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[QueryEntity]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJQueryEntity] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Query Entities */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJQueryEntity] TO [cdp_Integration]



/* Base View SQL for MJ: Query Parameters */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Query Parameters
-- Item: vwQueryParameters
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Query Parameters
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  QueryParameter
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwQueryParameters]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwQueryParameters];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwQueryParameters]
AS
SELECT
    m.*,
    MJQueries_QueryID.[Name] AS [Query]
FROM
    [${flyway:defaultSchema}].[QueryParameter] AS m
INNER JOIN
    [${flyway:defaultSchema}].[Query] AS MJQueries_QueryID
  ON
    [m].[QueryID] = MJQueries_QueryID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwQueryParameters] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Query Parameters */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Query Parameters
-- Item: Permissions for vwQueryParameters
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwQueryParameters] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Query Parameters */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Query Parameters
-- Item: spCreateMJQueryParameter
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR QueryParameter
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJQueryParameter]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJQueryParameter];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJQueryParameter]
    @ID uniqueidentifier = NULL,
    @QueryID uniqueidentifier,
    @Name nvarchar(255),
    @Type nvarchar(50),
    @IsRequired bit,
    @DefaultValue nvarchar(MAX),
    @Description nvarchar(MAX),
    @SampleValue nvarchar(MAX),
    @ValidationFilters nvarchar(MAX),
    @DetectionMethod nvarchar(50) = NULL,
    @AutoDetectConfidenceScore decimal(3, 2)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[QueryParameter]
            (
                [ID],
                [QueryID],
                [Name],
                [Type],
                [IsRequired],
                [DefaultValue],
                [Description],
                [SampleValue],
                [ValidationFilters],
                [DetectionMethod],
                [AutoDetectConfidenceScore]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @QueryID,
                @Name,
                @Type,
                @IsRequired,
                @DefaultValue,
                @Description,
                @SampleValue,
                @ValidationFilters,
                ISNULL(@DetectionMethod, 'Manual'),
                @AutoDetectConfidenceScore
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[QueryParameter]
            (
                [QueryID],
                [Name],
                [Type],
                [IsRequired],
                [DefaultValue],
                [Description],
                [SampleValue],
                [ValidationFilters],
                [DetectionMethod],
                [AutoDetectConfidenceScore]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @QueryID,
                @Name,
                @Type,
                @IsRequired,
                @DefaultValue,
                @Description,
                @SampleValue,
                @ValidationFilters,
                ISNULL(@DetectionMethod, 'Manual'),
                @AutoDetectConfidenceScore
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwQueryParameters] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJQueryParameter] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Query Parameters */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJQueryParameter] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Query Parameters */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Query Parameters
-- Item: spUpdateMJQueryParameter
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR QueryParameter
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJQueryParameter]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJQueryParameter];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJQueryParameter]
    @ID uniqueidentifier,
    @QueryID uniqueidentifier,
    @Name nvarchar(255),
    @Type nvarchar(50),
    @IsRequired bit,
    @DefaultValue nvarchar(MAX),
    @Description nvarchar(MAX),
    @SampleValue nvarchar(MAX),
    @ValidationFilters nvarchar(MAX),
    @DetectionMethod nvarchar(50),
    @AutoDetectConfidenceScore decimal(3, 2)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[QueryParameter]
    SET
        [QueryID] = @QueryID,
        [Name] = @Name,
        [Type] = @Type,
        [IsRequired] = @IsRequired,
        [DefaultValue] = @DefaultValue,
        [Description] = @Description,
        [SampleValue] = @SampleValue,
        [ValidationFilters] = @ValidationFilters,
        [DetectionMethod] = @DetectionMethod,
        [AutoDetectConfidenceScore] = @AutoDetectConfidenceScore
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwQueryParameters] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwQueryParameters]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJQueryParameter] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the QueryParameter table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJQueryParameter]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJQueryParameter];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJQueryParameter
ON [${flyway:defaultSchema}].[QueryParameter]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[QueryParameter]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[QueryParameter] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Query Parameters */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJQueryParameter] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Query Parameters */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Query Parameters
-- Item: spDeleteMJQueryParameter
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR QueryParameter
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJQueryParameter]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJQueryParameter];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJQueryParameter]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[QueryParameter]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJQueryParameter] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Query Parameters */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJQueryParameter] TO [cdp_Integration]



/* spDelete SQL for MJ: Queries */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Queries
-- Item: spDeleteMJQuery
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR Query
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJQuery]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJQuery];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJQuery]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    -- Cascade update on DataContextItem using cursor to call spUpdateMJDataContextItem
    DECLARE @false_QueryIDID uniqueidentifier
    DECLARE @false_QueryID_DataContextID uniqueidentifier
    DECLARE @false_QueryID_Type nvarchar(50)
    DECLARE @false_QueryID_ViewID uniqueidentifier
    DECLARE @false_QueryID_QueryID uniqueidentifier
    DECLARE @false_QueryID_EntityID uniqueidentifier
    DECLARE @false_QueryID_RecordID nvarchar(450)
    DECLARE @false_QueryID_SQL nvarchar(MAX)
    DECLARE @false_QueryID_DataJSON nvarchar(MAX)
    DECLARE @false_QueryID_LastRefreshedAt datetimeoffset
    DECLARE @false_QueryID_Description nvarchar(MAX)
    DECLARE @false_QueryID_CodeName nvarchar(255)
    DECLARE cascade_update_false_QueryID_cursor CURSOR FOR
        SELECT [ID], [DataContextID], [Type], [ViewID], [QueryID], [EntityID], [RecordID], [SQL], [DataJSON], [LastRefreshedAt], [Description], [CodeName]
        FROM [${flyway:defaultSchema}].[DataContextItem]
        WHERE [QueryID] = @ID

    OPEN cascade_update_false_QueryID_cursor
    FETCH NEXT FROM cascade_update_false_QueryID_cursor INTO @false_QueryIDID, @false_QueryID_DataContextID, @false_QueryID_Type, @false_QueryID_ViewID, @false_QueryID_QueryID, @false_QueryID_EntityID, @false_QueryID_RecordID, @false_QueryID_SQL, @false_QueryID_DataJSON, @false_QueryID_LastRefreshedAt, @false_QueryID_Description, @false_QueryID_CodeName

    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Set the FK field to NULL
        SET @false_QueryID_QueryID = NULL

        -- Call the update SP for the related entity
        EXEC [${flyway:defaultSchema}].[spUpdateMJDataContextItem] @ID = @false_QueryIDID, @DataContextID = @false_QueryID_DataContextID, @Type = @false_QueryID_Type, @ViewID = @false_QueryID_ViewID, @QueryID = @false_QueryID_QueryID, @EntityID = @false_QueryID_EntityID, @RecordID = @false_QueryID_RecordID, @SQL = @false_QueryID_SQL, @DataJSON = @false_QueryID_DataJSON, @LastRefreshedAt = @false_QueryID_LastRefreshedAt, @Description = @false_QueryID_Description, @CodeName = @false_QueryID_CodeName

        FETCH NEXT FROM cascade_update_false_QueryID_cursor INTO @false_QueryIDID, @false_QueryID_DataContextID, @false_QueryID_Type, @false_QueryID_ViewID, @false_QueryID_QueryID, @false_QueryID_EntityID, @false_QueryID_RecordID, @false_QueryID_SQL, @false_QueryID_DataJSON, @false_QueryID_LastRefreshedAt, @false_QueryID_Description, @false_QueryID_CodeName
    END

    CLOSE cascade_update_false_QueryID_cursor
    DEALLOCATE cascade_update_false_QueryID_cursor
    
    -- Cascade delete from QueryEntity using cursor to call spDeleteMJQueryEntity
    DECLARE @false_QueryIDID uniqueidentifier
    DECLARE cascade_delete_false_QueryID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[QueryEntity]
        WHERE [QueryID] = @ID
    
    OPEN cascade_delete_false_QueryID_cursor
    FETCH NEXT FROM cascade_delete_false_QueryID_cursor INTO @false_QueryIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteMJQueryEntity] @ID = @false_QueryIDID
        
        FETCH NEXT FROM cascade_delete_false_QueryID_cursor INTO @false_QueryIDID
    END
    
    CLOSE cascade_delete_false_QueryID_cursor
    DEALLOCATE cascade_delete_false_QueryID_cursor
    
    -- Cascade delete from QueryField using cursor to call spDeleteMJQueryField
    DECLARE @false_QueryIDID uniqueidentifier
    DECLARE cascade_delete_false_QueryID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[QueryField]
        WHERE [QueryID] = @ID
    
    OPEN cascade_delete_false_QueryID_cursor
    FETCH NEXT FROM cascade_delete_false_QueryID_cursor INTO @false_QueryIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteMJQueryField] @ID = @false_QueryIDID
        
        FETCH NEXT FROM cascade_delete_false_QueryID_cursor INTO @false_QueryIDID
    END
    
    CLOSE cascade_delete_false_QueryID_cursor
    DEALLOCATE cascade_delete_false_QueryID_cursor
    
    -- Cascade delete from QueryParameter using cursor to call spDeleteMJQueryParameter
    DECLARE @false_QueryIDID uniqueidentifier
    DECLARE cascade_delete_false_QueryID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[QueryParameter]
        WHERE [QueryID] = @ID
    
    OPEN cascade_delete_false_QueryID_cursor
    FETCH NEXT FROM cascade_delete_false_QueryID_cursor INTO @false_QueryIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteMJQueryParameter] @ID = @false_QueryIDID
        
        FETCH NEXT FROM cascade_delete_false_QueryID_cursor INTO @false_QueryIDID
    END
    
    CLOSE cascade_delete_false_QueryID_cursor
    DEALLOCATE cascade_delete_false_QueryID_cursor
    
    -- Cascade delete from QueryPermission using cursor to call spDeleteMJQueryPermission
    DECLARE @false_QueryIDID uniqueidentifier
    DECLARE cascade_delete_false_QueryID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[QueryPermission]
        WHERE [QueryID] = @ID
    
    OPEN cascade_delete_false_QueryID_cursor
    FETCH NEXT FROM cascade_delete_false_QueryID_cursor INTO @false_QueryIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteMJQueryPermission] @ID = @false_QueryIDID
        
        FETCH NEXT FROM cascade_delete_false_QueryID_cursor INTO @false_QueryIDID
    END
    
    CLOSE cascade_delete_false_QueryID_cursor
    DEALLOCATE cascade_delete_false_QueryID_cursor
    

    DELETE FROM
        [${flyway:defaultSchema}].[Query]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJQuery] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Queries */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJQuery] TO [cdp_Integration]



/* Base View SQL for MJ: Recommendation Items */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Recommendation Items
-- Item: vwRecommendationItems
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Recommendation Items
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  RecommendationItem
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwRecommendationItems]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwRecommendationItems];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwRecommendationItems]
AS
SELECT
    m.*,
    MJRecommendations_RecommendationID.[SourceEntityRecordID] AS [Recommendation],
    MJEntities_DestinationEntityID.[Name] AS [DestinationEntity]
FROM
    [${flyway:defaultSchema}].[RecommendationItem] AS m
INNER JOIN
    [${flyway:defaultSchema}].[Recommendation] AS MJRecommendations_RecommendationID
  ON
    [m].[RecommendationID] = MJRecommendations_RecommendationID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[Entity] AS MJEntities_DestinationEntityID
  ON
    [m].[DestinationEntityID] = MJEntities_DestinationEntityID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwRecommendationItems] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Recommendation Items */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Recommendation Items
-- Item: Permissions for vwRecommendationItems
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwRecommendationItems] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Recommendation Items */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Recommendation Items
-- Item: spCreateMJRecommendationItem
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR RecommendationItem
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJRecommendationItem]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJRecommendationItem];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJRecommendationItem]
    @ID uniqueidentifier = NULL,
    @RecommendationID uniqueidentifier,
    @DestinationEntityID uniqueidentifier,
    @DestinationEntityRecordID nvarchar(450),
    @MatchProbability decimal(18, 15)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[RecommendationItem]
            (
                [ID],
                [RecommendationID],
                [DestinationEntityID],
                [DestinationEntityRecordID],
                [MatchProbability]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @RecommendationID,
                @DestinationEntityID,
                @DestinationEntityRecordID,
                @MatchProbability
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[RecommendationItem]
            (
                [RecommendationID],
                [DestinationEntityID],
                [DestinationEntityRecordID],
                [MatchProbability]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @RecommendationID,
                @DestinationEntityID,
                @DestinationEntityRecordID,
                @MatchProbability
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwRecommendationItems] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJRecommendationItem] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Recommendation Items */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJRecommendationItem] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Recommendation Items */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Recommendation Items
-- Item: spUpdateMJRecommendationItem
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR RecommendationItem
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJRecommendationItem]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJRecommendationItem];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJRecommendationItem]
    @ID uniqueidentifier,
    @RecommendationID uniqueidentifier,
    @DestinationEntityID uniqueidentifier,
    @DestinationEntityRecordID nvarchar(450),
    @MatchProbability decimal(18, 15)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[RecommendationItem]
    SET
        [RecommendationID] = @RecommendationID,
        [DestinationEntityID] = @DestinationEntityID,
        [DestinationEntityRecordID] = @DestinationEntityRecordID,
        [MatchProbability] = @MatchProbability
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwRecommendationItems] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwRecommendationItems]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJRecommendationItem] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the RecommendationItem table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJRecommendationItem]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJRecommendationItem];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJRecommendationItem
ON [${flyway:defaultSchema}].[RecommendationItem]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[RecommendationItem]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[RecommendationItem] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Recommendation Items */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJRecommendationItem] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Recommendation Items */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Recommendation Items
-- Item: spDeleteMJRecommendationItem
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR RecommendationItem
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJRecommendationItem]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJRecommendationItem];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJRecommendationItem]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[RecommendationItem]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJRecommendationItem] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Recommendation Items */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJRecommendationItem] TO [cdp_Integration]



/* Base View SQL for MJ: Queue Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Queue Types
-- Item: vwQueueTypes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Queue Types
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  QueueType
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwQueueTypes]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwQueueTypes];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwQueueTypes]
AS
SELECT
    m.*
FROM
    [${flyway:defaultSchema}].[QueueType] AS m
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwQueueTypes] TO [cdp_UI], [cdp_Developer]
    

/* Base View Permissions SQL for MJ: Queue Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Queue Types
-- Item: Permissions for vwQueueTypes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwQueueTypes] TO [cdp_UI], [cdp_Developer]

/* spCreate SQL for MJ: Queue Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Queue Types
-- Item: spCreateMJQueueType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR QueueType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJQueueType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJQueueType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJQueueType]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(50),
    @Description nvarchar(MAX),
    @DriverClass nvarchar(100),
    @DriverImportPath nvarchar(200),
    @IsActive bit = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[QueueType]
            (
                [ID],
                [Name],
                [Description],
                [DriverClass],
                [DriverImportPath],
                [IsActive]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description,
                @DriverClass,
                @DriverImportPath,
                ISNULL(@IsActive, 1)
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[QueueType]
            (
                [Name],
                [Description],
                [DriverClass],
                [DriverImportPath],
                [IsActive]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description,
                @DriverClass,
                @DriverImportPath,
                ISNULL(@IsActive, 1)
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwQueueTypes] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJQueueType] TO [cdp_Developer]
    

/* spCreate Permissions for MJ: Queue Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJQueueType] TO [cdp_Developer]



/* spUpdate SQL for MJ: Queue Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Queue Types
-- Item: spUpdateMJQueueType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR QueueType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJQueueType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJQueueType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJQueueType]
    @ID uniqueidentifier,
    @Name nvarchar(50),
    @Description nvarchar(MAX),
    @DriverClass nvarchar(100),
    @DriverImportPath nvarchar(200),
    @IsActive bit
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[QueueType]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [DriverClass] = @DriverClass,
        [DriverImportPath] = @DriverImportPath,
        [IsActive] = @IsActive
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwQueueTypes] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwQueueTypes]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJQueueType] TO [cdp_Developer]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the QueueType table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJQueueType]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJQueueType];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJQueueType
ON [${flyway:defaultSchema}].[QueueType]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[QueueType]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[QueueType] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Queue Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJQueueType] TO [cdp_Developer]



/* spDelete SQL for MJ: Queue Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Queue Types
-- Item: spDeleteMJQueueType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR QueueType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJQueueType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJQueueType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJQueueType]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[QueueType]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJQueueType] TO [cdp_Developer]
    

/* spDelete Permissions for MJ: Queue Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJQueueType] TO [cdp_Developer]



/* Base View SQL for MJ: Query Permissions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Query Permissions
-- Item: vwQueryPermissions
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Query Permissions
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  QueryPermission
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwQueryPermissions]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwQueryPermissions];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwQueryPermissions]
AS
SELECT
    m.*,
    MJQueries_QueryID.[Name] AS [Query],
    MJRoles_RoleID.[Name] AS [Role]
FROM
    [${flyway:defaultSchema}].[QueryPermission] AS m
INNER JOIN
    [${flyway:defaultSchema}].[Query] AS MJQueries_QueryID
  ON
    [m].[QueryID] = MJQueries_QueryID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[Role] AS MJRoles_RoleID
  ON
    [m].[RoleID] = MJRoles_RoleID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwQueryPermissions] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Query Permissions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Query Permissions
-- Item: Permissions for vwQueryPermissions
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwQueryPermissions] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Query Permissions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Query Permissions
-- Item: spCreateMJQueryPermission
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR QueryPermission
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJQueryPermission]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJQueryPermission];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJQueryPermission]
    @ID uniqueidentifier = NULL,
    @QueryID uniqueidentifier,
    @RoleID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[QueryPermission]
            (
                [ID],
                [QueryID],
                [RoleID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @QueryID,
                @RoleID
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[QueryPermission]
            (
                [QueryID],
                [RoleID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @QueryID,
                @RoleID
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwQueryPermissions] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJQueryPermission] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Query Permissions */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJQueryPermission] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Query Permissions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Query Permissions
-- Item: spUpdateMJQueryPermission
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR QueryPermission
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJQueryPermission]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJQueryPermission];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJQueryPermission]
    @ID uniqueidentifier,
    @QueryID uniqueidentifier,
    @RoleID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[QueryPermission]
    SET
        [QueryID] = @QueryID,
        [RoleID] = @RoleID
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwQueryPermissions] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwQueryPermissions]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJQueryPermission] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the QueryPermission table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJQueryPermission]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJQueryPermission];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJQueryPermission
ON [${flyway:defaultSchema}].[QueryPermission]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[QueryPermission]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[QueryPermission] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Query Permissions */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJQueryPermission] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Query Permissions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Query Permissions
-- Item: spDeleteMJQueryPermission
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR QueryPermission
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJQueryPermission]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJQueryPermission];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJQueryPermission]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[QueryPermission]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJQueryPermission] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Query Permissions */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJQueryPermission] TO [cdp_Integration]



/* Base View SQL for MJ: Queues */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Queues
-- Item: vwQueues
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Queues
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  Queue
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwQueues]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwQueues];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwQueues]
AS
SELECT
    m.*,
    MJQueueTypes_QueueTypeID.[Name] AS [QueueType]
FROM
    [${flyway:defaultSchema}].[Queue] AS m
INNER JOIN
    [${flyway:defaultSchema}].[QueueType] AS MJQueueTypes_QueueTypeID
  ON
    [m].[QueueTypeID] = MJQueueTypes_QueueTypeID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwQueues] TO [cdp_UI]
    

/* Base View Permissions SQL for MJ: Queues */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Queues
-- Item: Permissions for vwQueues
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwQueues] TO [cdp_UI]

/* spCreate SQL for MJ: Queues */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Queues
-- Item: spCreateMJQueue
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR Queue
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJQueue]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJQueue];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJQueue]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(50),
    @Description nvarchar(MAX),
    @QueueTypeID uniqueidentifier,
    @IsActive bit = NULL,
    @ProcessPID int,
    @ProcessPlatform nvarchar(30),
    @ProcessVersion nvarchar(15),
    @ProcessCwd nvarchar(100),
    @ProcessIPAddress nvarchar(50),
    @ProcessMacAddress nvarchar(50),
    @ProcessOSName nvarchar(25),
    @ProcessOSVersion nvarchar(10),
    @ProcessHostName nvarchar(50),
    @ProcessUserID nvarchar(25),
    @ProcessUserName nvarchar(50),
    @LastHeartbeat datetimeoffset = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[Queue]
            (
                [ID],
                [Name],
                [Description],
                [QueueTypeID],
                [IsActive],
                [ProcessPID],
                [ProcessPlatform],
                [ProcessVersion],
                [ProcessCwd],
                [ProcessIPAddress],
                [ProcessMacAddress],
                [ProcessOSName],
                [ProcessOSVersion],
                [ProcessHostName],
                [ProcessUserID],
                [ProcessUserName],
                [LastHeartbeat]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description,
                @QueueTypeID,
                ISNULL(@IsActive, 0),
                @ProcessPID,
                @ProcessPlatform,
                @ProcessVersion,
                @ProcessCwd,
                @ProcessIPAddress,
                @ProcessMacAddress,
                @ProcessOSName,
                @ProcessOSVersion,
                @ProcessHostName,
                @ProcessUserID,
                @ProcessUserName,
                ISNULL(@LastHeartbeat, sysdatetimeoffset())
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[Queue]
            (
                [Name],
                [Description],
                [QueueTypeID],
                [IsActive],
                [ProcessPID],
                [ProcessPlatform],
                [ProcessVersion],
                [ProcessCwd],
                [ProcessIPAddress],
                [ProcessMacAddress],
                [ProcessOSName],
                [ProcessOSVersion],
                [ProcessHostName],
                [ProcessUserID],
                [ProcessUserName],
                [LastHeartbeat]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description,
                @QueueTypeID,
                ISNULL(@IsActive, 0),
                @ProcessPID,
                @ProcessPlatform,
                @ProcessVersion,
                @ProcessCwd,
                @ProcessIPAddress,
                @ProcessMacAddress,
                @ProcessOSName,
                @ProcessOSVersion,
                @ProcessHostName,
                @ProcessUserID,
                @ProcessUserName,
                ISNULL(@LastHeartbeat, sysdatetimeoffset())
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwQueues] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJQueue] TO [cdp_UI]
    

/* spCreate Permissions for MJ: Queues */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJQueue] TO [cdp_UI]



/* spUpdate SQL for MJ: Queues */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Queues
-- Item: spUpdateMJQueue
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR Queue
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJQueue]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJQueue];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJQueue]
    @ID uniqueidentifier,
    @Name nvarchar(50),
    @Description nvarchar(MAX),
    @QueueTypeID uniqueidentifier,
    @IsActive bit,
    @ProcessPID int,
    @ProcessPlatform nvarchar(30),
    @ProcessVersion nvarchar(15),
    @ProcessCwd nvarchar(100),
    @ProcessIPAddress nvarchar(50),
    @ProcessMacAddress nvarchar(50),
    @ProcessOSName nvarchar(25),
    @ProcessOSVersion nvarchar(10),
    @ProcessHostName nvarchar(50),
    @ProcessUserID nvarchar(25),
    @ProcessUserName nvarchar(50),
    @LastHeartbeat datetimeoffset
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[Queue]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [QueueTypeID] = @QueueTypeID,
        [IsActive] = @IsActive,
        [ProcessPID] = @ProcessPID,
        [ProcessPlatform] = @ProcessPlatform,
        [ProcessVersion] = @ProcessVersion,
        [ProcessCwd] = @ProcessCwd,
        [ProcessIPAddress] = @ProcessIPAddress,
        [ProcessMacAddress] = @ProcessMacAddress,
        [ProcessOSName] = @ProcessOSName,
        [ProcessOSVersion] = @ProcessOSVersion,
        [ProcessHostName] = @ProcessHostName,
        [ProcessUserID] = @ProcessUserID,
        [ProcessUserName] = @ProcessUserName,
        [LastHeartbeat] = @LastHeartbeat
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwQueues] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwQueues]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the Queue table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJQueue]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJQueue];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJQueue
ON [${flyway:defaultSchema}].[Queue]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[Queue]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[Queue] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Queues */




/* spDelete SQL for MJ: Queues */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Queues
-- Item: spDeleteMJQueue
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR Queue
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJQueue]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJQueue];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJQueue]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[Queue]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
    

/* spDelete Permissions for MJ: Queues */




/* Base View SQL for MJ: Queue Tasks */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Queue Tasks
-- Item: vwQueueTasks
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Queue Tasks
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  QueueTask
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwQueueTasks]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwQueueTasks];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwQueueTasks]
AS
SELECT
    m.*,
    MJQueues_QueueID.[Name] AS [Queue]
FROM
    [${flyway:defaultSchema}].[QueueTask] AS m
INNER JOIN
    [${flyway:defaultSchema}].[Queue] AS MJQueues_QueueID
  ON
    [m].[QueueID] = MJQueues_QueueID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwQueueTasks] TO [cdp_UI]
    

/* Base View Permissions SQL for MJ: Queue Tasks */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Queue Tasks
-- Item: Permissions for vwQueueTasks
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwQueueTasks] TO [cdp_UI]

/* spCreate SQL for MJ: Queue Tasks */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Queue Tasks
-- Item: spCreateMJQueueTask
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR QueueTask
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJQueueTask]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJQueueTask];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJQueueTask]
    @ID uniqueidentifier = NULL,
    @QueueID uniqueidentifier,
    @Status nchar(10) = NULL,
    @StartedAt datetimeoffset,
    @EndedAt datetimeoffset,
    @Data nvarchar(MAX),
    @Options nvarchar(MAX),
    @Output nvarchar(MAX),
    @ErrorMessage nvarchar(MAX),
    @Comments nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[QueueTask]
            (
                [ID],
                [QueueID],
                [Status],
                [StartedAt],
                [EndedAt],
                [Data],
                [Options],
                [Output],
                [ErrorMessage],
                [Comments]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @QueueID,
                ISNULL(@Status, 'Pending'),
                @StartedAt,
                @EndedAt,
                @Data,
                @Options,
                @Output,
                @ErrorMessage,
                @Comments
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[QueueTask]
            (
                [QueueID],
                [Status],
                [StartedAt],
                [EndedAt],
                [Data],
                [Options],
                [Output],
                [ErrorMessage],
                [Comments]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @QueueID,
                ISNULL(@Status, 'Pending'),
                @StartedAt,
                @EndedAt,
                @Data,
                @Options,
                @Output,
                @ErrorMessage,
                @Comments
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwQueueTasks] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJQueueTask] TO [cdp_UI]
    

/* spCreate Permissions for MJ: Queue Tasks */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJQueueTask] TO [cdp_UI]



/* spUpdate SQL for MJ: Queue Tasks */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Queue Tasks
-- Item: spUpdateMJQueueTask
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR QueueTask
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJQueueTask]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJQueueTask];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJQueueTask]
    @ID uniqueidentifier,
    @QueueID uniqueidentifier,
    @Status nchar(10),
    @StartedAt datetimeoffset,
    @EndedAt datetimeoffset,
    @Data nvarchar(MAX),
    @Options nvarchar(MAX),
    @Output nvarchar(MAX),
    @ErrorMessage nvarchar(MAX),
    @Comments nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[QueueTask]
    SET
        [QueueID] = @QueueID,
        [Status] = @Status,
        [StartedAt] = @StartedAt,
        [EndedAt] = @EndedAt,
        [Data] = @Data,
        [Options] = @Options,
        [Output] = @Output,
        [ErrorMessage] = @ErrorMessage,
        [Comments] = @Comments
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwQueueTasks] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwQueueTasks]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the QueueTask table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJQueueTask]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJQueueTask];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJQueueTask
ON [${flyway:defaultSchema}].[QueueTask]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[QueueTask]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[QueueTask] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Queue Tasks */




/* spDelete SQL for MJ: Queue Tasks */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Queue Tasks
-- Item: spDeleteMJQueueTask
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR QueueTask
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJQueueTask]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJQueueTask];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJQueueTask]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[QueueTask]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
    

/* spDelete Permissions for MJ: Queue Tasks */




/* Base View SQL for MJ: Recommendation Runs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Recommendation Runs
-- Item: vwRecommendationRuns
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Recommendation Runs
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  RecommendationRun
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwRecommendationRuns]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwRecommendationRuns];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwRecommendationRuns]
AS
SELECT
    m.*,
    MJRecommendationProviders_RecommendationProviderID.[Name] AS [RecommendationProvider],
    MJUsers_RunByUserID.[Name] AS [RunByUser]
FROM
    [${flyway:defaultSchema}].[RecommendationRun] AS m
INNER JOIN
    [${flyway:defaultSchema}].[RecommendationProvider] AS MJRecommendationProviders_RecommendationProviderID
  ON
    [m].[RecommendationProviderID] = MJRecommendationProviders_RecommendationProviderID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_RunByUserID
  ON
    [m].[RunByUserID] = MJUsers_RunByUserID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwRecommendationRuns] TO [cdp_Integration], [cdp_UI], [cdp_Developer]
    

/* Base View Permissions SQL for MJ: Recommendation Runs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Recommendation Runs
-- Item: Permissions for vwRecommendationRuns
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwRecommendationRuns] TO [cdp_Integration], [cdp_UI], [cdp_Developer]

/* spCreate SQL for MJ: Recommendation Runs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Recommendation Runs
-- Item: spCreateMJRecommendationRun
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR RecommendationRun
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJRecommendationRun]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJRecommendationRun];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJRecommendationRun]
    @ID uniqueidentifier = NULL,
    @RecommendationProviderID uniqueidentifier,
    @StartDate datetimeoffset,
    @EndDate datetimeoffset,
    @Status nvarchar(50),
    @Description nvarchar(MAX),
    @RunByUserID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[RecommendationRun]
            (
                [ID],
                [RecommendationProviderID],
                [StartDate],
                [EndDate],
                [Status],
                [Description],
                [RunByUserID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @RecommendationProviderID,
                @StartDate,
                @EndDate,
                @Status,
                @Description,
                @RunByUserID
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[RecommendationRun]
            (
                [RecommendationProviderID],
                [StartDate],
                [EndDate],
                [Status],
                [Description],
                [RunByUserID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @RecommendationProviderID,
                @StartDate,
                @EndDate,
                @Status,
                @Description,
                @RunByUserID
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwRecommendationRuns] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJRecommendationRun] TO [cdp_Integration], [cdp_Developer]
    

/* spCreate Permissions for MJ: Recommendation Runs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJRecommendationRun] TO [cdp_Integration], [cdp_Developer]



/* spUpdate SQL for MJ: Recommendation Runs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Recommendation Runs
-- Item: spUpdateMJRecommendationRun
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR RecommendationRun
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJRecommendationRun]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJRecommendationRun];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJRecommendationRun]
    @ID uniqueidentifier,
    @RecommendationProviderID uniqueidentifier,
    @StartDate datetimeoffset,
    @EndDate datetimeoffset,
    @Status nvarchar(50),
    @Description nvarchar(MAX),
    @RunByUserID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[RecommendationRun]
    SET
        [RecommendationProviderID] = @RecommendationProviderID,
        [StartDate] = @StartDate,
        [EndDate] = @EndDate,
        [Status] = @Status,
        [Description] = @Description,
        [RunByUserID] = @RunByUserID
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwRecommendationRuns] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwRecommendationRuns]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJRecommendationRun] TO [cdp_Integration], [cdp_Developer]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the RecommendationRun table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJRecommendationRun]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJRecommendationRun];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJRecommendationRun
ON [${flyway:defaultSchema}].[RecommendationRun]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[RecommendationRun]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[RecommendationRun] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Recommendation Runs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJRecommendationRun] TO [cdp_Integration], [cdp_Developer]



/* spDelete SQL for MJ: Recommendation Runs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Recommendation Runs
-- Item: spDeleteMJRecommendationRun
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR RecommendationRun
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJRecommendationRun]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJRecommendationRun];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJRecommendationRun]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[RecommendationRun]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJRecommendationRun] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Recommendation Runs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJRecommendationRun] TO [cdp_Integration]



/* Base View SQL for MJ: Recommendation Providers */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Recommendation Providers
-- Item: vwRecommendationProviders
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Recommendation Providers
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  RecommendationProvider
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwRecommendationProviders]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwRecommendationProviders];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwRecommendationProviders]
AS
SELECT
    m.*
FROM
    [${flyway:defaultSchema}].[RecommendationProvider] AS m
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwRecommendationProviders] TO [cdp_Integration], [cdp_UI], [cdp_Developer]
    

/* Base View Permissions SQL for MJ: Recommendation Providers */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Recommendation Providers
-- Item: Permissions for vwRecommendationProviders
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwRecommendationProviders] TO [cdp_Integration], [cdp_UI], [cdp_Developer]

/* spCreate SQL for MJ: Recommendation Providers */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Recommendation Providers
-- Item: spCreateMJRecommendationProvider
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR RecommendationProvider
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJRecommendationProvider]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJRecommendationProvider];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJRecommendationProvider]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(255),
    @Description nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[RecommendationProvider]
            (
                [ID],
                [Name],
                [Description]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[RecommendationProvider]
            (
                [Name],
                [Description]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwRecommendationProviders] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJRecommendationProvider] TO [cdp_Integration], [cdp_Developer]
    

/* spCreate Permissions for MJ: Recommendation Providers */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJRecommendationProvider] TO [cdp_Integration], [cdp_Developer]



/* spUpdate SQL for MJ: Recommendation Providers */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Recommendation Providers
-- Item: spUpdateMJRecommendationProvider
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR RecommendationProvider
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJRecommendationProvider]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJRecommendationProvider];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJRecommendationProvider]
    @ID uniqueidentifier,
    @Name nvarchar(255),
    @Description nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[RecommendationProvider]
    SET
        [Name] = @Name,
        [Description] = @Description
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwRecommendationProviders] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwRecommendationProviders]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJRecommendationProvider] TO [cdp_Integration], [cdp_Developer]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the RecommendationProvider table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJRecommendationProvider]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJRecommendationProvider];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJRecommendationProvider
ON [${flyway:defaultSchema}].[RecommendationProvider]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[RecommendationProvider]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[RecommendationProvider] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Recommendation Providers */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJRecommendationProvider] TO [cdp_Integration], [cdp_Developer]



/* spDelete SQL for MJ: Recommendation Providers */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Recommendation Providers
-- Item: spDeleteMJRecommendationProvider
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR RecommendationProvider
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJRecommendationProvider]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJRecommendationProvider];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJRecommendationProvider]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[RecommendationProvider]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJRecommendationProvider] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Recommendation Providers */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJRecommendationProvider] TO [cdp_Integration]



/* Base View SQL for MJ: Record Changes */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Record Changes
-- Item: vwRecordChanges
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Record Changes
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  RecordChange
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwRecordChanges]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwRecordChanges];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwRecordChanges]
AS
SELECT
    m.*,
    MJEntities_EntityID.[Name] AS [Entity],
    MJUsers_UserID.[Name] AS [User],
    MJRecordChangeReplayRuns_ReplayRunID.[User] AS [ReplayRun],
    MJIntegrations_IntegrationID.[Name] AS [Integration]
FROM
    [${flyway:defaultSchema}].[RecordChange] AS m
INNER JOIN
    [${flyway:defaultSchema}].[Entity] AS MJEntities_EntityID
  ON
    [m].[EntityID] = MJEntities_EntityID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_UserID
  ON
    [m].[UserID] = MJUsers_UserID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[vwRecordChangeReplayRuns] AS MJRecordChangeReplayRuns_ReplayRunID
  ON
    [m].[ReplayRunID] = MJRecordChangeReplayRuns_ReplayRunID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[Integration] AS MJIntegrations_IntegrationID
  ON
    [m].[IntegrationID] = MJIntegrations_IntegrationID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwRecordChanges] TO [cdp_Developer], [cdp_UI], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Record Changes */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Record Changes
-- Item: Permissions for vwRecordChanges
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwRecordChanges] TO [cdp_Developer], [cdp_UI], [cdp_Integration]

/* spCreate SQL for MJ: Record Changes */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Record Changes
-- Item: spCreateMJRecordChange
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR RecordChange
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJRecordChange]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJRecordChange];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJRecordChange]
    @ID uniqueidentifier = NULL,
    @EntityID uniqueidentifier,
    @RecordID nvarchar(750),
    @UserID uniqueidentifier,
    @Type nvarchar(20) = NULL,
    @Source nvarchar(20) = NULL,
    @ChangedAt datetimeoffset = NULL,
    @ChangesJSON nvarchar(MAX),
    @ChangesDescription nvarchar(MAX),
    @FullRecordJSON nvarchar(MAX),
    @Status nvarchar(50) = NULL,
    @ErrorLog nvarchar(MAX),
    @ReplayRunID uniqueidentifier,
    @IntegrationID uniqueidentifier,
    @Comments nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[RecordChange]
            (
                [ID],
                [EntityID],
                [RecordID],
                [UserID],
                [Type],
                [Source],
                [ChangedAt],
                [ChangesJSON],
                [ChangesDescription],
                [FullRecordJSON],
                [Status],
                [ErrorLog],
                [ReplayRunID],
                [IntegrationID],
                [Comments]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @EntityID,
                @RecordID,
                @UserID,
                ISNULL(@Type, 'Create'),
                ISNULL(@Source, 'Internal'),
                ISNULL(@ChangedAt, getutcdate()),
                @ChangesJSON,
                @ChangesDescription,
                @FullRecordJSON,
                ISNULL(@Status, 'Complete'),
                @ErrorLog,
                @ReplayRunID,
                @IntegrationID,
                @Comments
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[RecordChange]
            (
                [EntityID],
                [RecordID],
                [UserID],
                [Type],
                [Source],
                [ChangedAt],
                [ChangesJSON],
                [ChangesDescription],
                [FullRecordJSON],
                [Status],
                [ErrorLog],
                [ReplayRunID],
                [IntegrationID],
                [Comments]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @EntityID,
                @RecordID,
                @UserID,
                ISNULL(@Type, 'Create'),
                ISNULL(@Source, 'Internal'),
                ISNULL(@ChangedAt, getutcdate()),
                @ChangesJSON,
                @ChangesDescription,
                @FullRecordJSON,
                ISNULL(@Status, 'Complete'),
                @ErrorLog,
                @ReplayRunID,
                @IntegrationID,
                @Comments
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwRecordChanges] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJRecordChange] TO [cdp_Developer], [cdp_UI], [cdp_Integration]
    

/* spCreate Permissions for MJ: Record Changes */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJRecordChange] TO [cdp_Developer], [cdp_UI], [cdp_Integration]



/* spUpdate SQL for MJ: Record Changes */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Record Changes
-- Item: spUpdateMJRecordChange
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR RecordChange
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJRecordChange]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJRecordChange];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJRecordChange]
    @ID uniqueidentifier,
    @EntityID uniqueidentifier,
    @RecordID nvarchar(750),
    @UserID uniqueidentifier,
    @Type nvarchar(20),
    @Source nvarchar(20),
    @ChangedAt datetimeoffset,
    @ChangesJSON nvarchar(MAX),
    @ChangesDescription nvarchar(MAX),
    @FullRecordJSON nvarchar(MAX),
    @Status nvarchar(50),
    @ErrorLog nvarchar(MAX),
    @ReplayRunID uniqueidentifier,
    @IntegrationID uniqueidentifier,
    @Comments nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[RecordChange]
    SET
        [EntityID] = @EntityID,
        [RecordID] = @RecordID,
        [UserID] = @UserID,
        [Type] = @Type,
        [Source] = @Source,
        [ChangedAt] = @ChangedAt,
        [ChangesJSON] = @ChangesJSON,
        [ChangesDescription] = @ChangesDescription,
        [FullRecordJSON] = @FullRecordJSON,
        [Status] = @Status,
        [ErrorLog] = @ErrorLog,
        [ReplayRunID] = @ReplayRunID,
        [IntegrationID] = @IntegrationID,
        [Comments] = @Comments
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwRecordChanges] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwRecordChanges]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJRecordChange] TO [cdp_Developer]
GO

        

/* spUpdate Permissions for MJ: Record Changes */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJRecordChange] TO [cdp_Developer]



/* spDelete SQL for MJ: Record Changes */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Record Changes
-- Item: spDeleteMJRecordChange
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR RecordChange
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJRecordChange]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJRecordChange];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJRecordChange]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[RecordChange]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
    

/* spDelete Permissions for MJ: Record Changes */




/* Base View SQL for MJ: Recommendations */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Recommendations
-- Item: vwRecommendations
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Recommendations
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  Recommendation
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwRecommendations]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwRecommendations];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwRecommendations]
AS
SELECT
    m.*,
    MJRecommendationRuns_RecommendationRunID.[RecommendationProvider] AS [RecommendationRun],
    MJEntities_SourceEntityID.[Name] AS [SourceEntity]
FROM
    [${flyway:defaultSchema}].[Recommendation] AS m
INNER JOIN
    [${flyway:defaultSchema}].[vwRecommendationRuns] AS MJRecommendationRuns_RecommendationRunID
  ON
    [m].[RecommendationRunID] = MJRecommendationRuns_RecommendationRunID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[Entity] AS MJEntities_SourceEntityID
  ON
    [m].[SourceEntityID] = MJEntities_SourceEntityID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwRecommendations] TO [cdp_Developer], [cdp_Integration], [cdp_UI]
    

/* Base View Permissions SQL for MJ: Recommendations */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Recommendations
-- Item: Permissions for vwRecommendations
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwRecommendations] TO [cdp_Developer], [cdp_Integration], [cdp_UI]

/* spCreate SQL for MJ: Recommendations */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Recommendations
-- Item: spCreateMJRecommendation
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR Recommendation
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJRecommendation]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJRecommendation];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJRecommendation]
    @ID uniqueidentifier = NULL,
    @RecommendationRunID uniqueidentifier,
    @SourceEntityID uniqueidentifier,
    @SourceEntityRecordID nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[Recommendation]
            (
                [ID],
                [RecommendationRunID],
                [SourceEntityID],
                [SourceEntityRecordID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @RecommendationRunID,
                @SourceEntityID,
                @SourceEntityRecordID
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[Recommendation]
            (
                [RecommendationRunID],
                [SourceEntityID],
                [SourceEntityRecordID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @RecommendationRunID,
                @SourceEntityID,
                @SourceEntityRecordID
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwRecommendations] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJRecommendation] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Recommendations */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJRecommendation] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Recommendations */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Recommendations
-- Item: spUpdateMJRecommendation
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR Recommendation
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJRecommendation]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJRecommendation];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJRecommendation]
    @ID uniqueidentifier,
    @RecommendationRunID uniqueidentifier,
    @SourceEntityID uniqueidentifier,
    @SourceEntityRecordID nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[Recommendation]
    SET
        [RecommendationRunID] = @RecommendationRunID,
        [SourceEntityID] = @SourceEntityID,
        [SourceEntityRecordID] = @SourceEntityRecordID
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwRecommendations] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwRecommendations]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJRecommendation] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the Recommendation table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJRecommendation]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJRecommendation];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJRecommendation
ON [${flyway:defaultSchema}].[Recommendation]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[Recommendation]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[Recommendation] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Recommendations */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJRecommendation] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Recommendations */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Recommendations
-- Item: spDeleteMJRecommendation
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR Recommendation
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJRecommendation]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJRecommendation];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJRecommendation]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[Recommendation]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJRecommendation] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Recommendations */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJRecommendation] TO [cdp_Integration]



/* Base View SQL for MJ: Record Change Replay Runs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Record Change Replay Runs
-- Item: vwRecordChangeReplayRuns
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Record Change Replay Runs
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  RecordChangeReplayRun
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwRecordChangeReplayRuns]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwRecordChangeReplayRuns];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwRecordChangeReplayRuns]
AS
SELECT
    m.*,
    MJUsers_UserID.[Name] AS [User]
FROM
    [${flyway:defaultSchema}].[RecordChangeReplayRun] AS m
INNER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_UserID
  ON
    [m].[UserID] = MJUsers_UserID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwRecordChangeReplayRuns] TO [cdp_UI], [cdp_Integration], [cdp_Developer]
    

/* Base View Permissions SQL for MJ: Record Change Replay Runs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Record Change Replay Runs
-- Item: Permissions for vwRecordChangeReplayRuns
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwRecordChangeReplayRuns] TO [cdp_UI], [cdp_Integration], [cdp_Developer]

/* spCreate SQL for MJ: Record Change Replay Runs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Record Change Replay Runs
-- Item: spCreateMJRecordChangeReplayRun
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR RecordChangeReplayRun
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJRecordChangeReplayRun]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJRecordChangeReplayRun];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJRecordChangeReplayRun]
    @ID uniqueidentifier = NULL,
    @StartedAt datetimeoffset,
    @EndedAt datetimeoffset,
    @Status nvarchar(50),
    @UserID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[RecordChangeReplayRun]
            (
                [ID],
                [StartedAt],
                [EndedAt],
                [Status],
                [UserID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @StartedAt,
                @EndedAt,
                @Status,
                @UserID
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[RecordChangeReplayRun]
            (
                [StartedAt],
                [EndedAt],
                [Status],
                [UserID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @StartedAt,
                @EndedAt,
                @Status,
                @UserID
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwRecordChangeReplayRuns] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJRecordChangeReplayRun] TO [cdp_Integration], [cdp_Developer]
    

/* spCreate Permissions for MJ: Record Change Replay Runs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJRecordChangeReplayRun] TO [cdp_Integration], [cdp_Developer]



/* spUpdate SQL for MJ: Record Change Replay Runs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Record Change Replay Runs
-- Item: spUpdateMJRecordChangeReplayRun
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR RecordChangeReplayRun
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJRecordChangeReplayRun]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJRecordChangeReplayRun];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJRecordChangeReplayRun]
    @ID uniqueidentifier,
    @StartedAt datetimeoffset,
    @EndedAt datetimeoffset,
    @Status nvarchar(50),
    @UserID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[RecordChangeReplayRun]
    SET
        [StartedAt] = @StartedAt,
        [EndedAt] = @EndedAt,
        [Status] = @Status,
        [UserID] = @UserID
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwRecordChangeReplayRuns] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwRecordChangeReplayRuns]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJRecordChangeReplayRun] TO [cdp_Integration], [cdp_Developer]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the RecordChangeReplayRun table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJRecordChangeReplayRun]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJRecordChangeReplayRun];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJRecordChangeReplayRun
ON [${flyway:defaultSchema}].[RecordChangeReplayRun]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[RecordChangeReplayRun]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[RecordChangeReplayRun] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Record Change Replay Runs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJRecordChangeReplayRun] TO [cdp_Integration], [cdp_Developer]



/* spDelete SQL for MJ: Record Change Replay Runs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Record Change Replay Runs
-- Item: spDeleteMJRecordChangeReplayRun
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR RecordChangeReplayRun
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJRecordChangeReplayRun]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJRecordChangeReplayRun];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJRecordChangeReplayRun]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[RecordChangeReplayRun]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJRecordChangeReplayRun] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Record Change Replay Runs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJRecordChangeReplayRun] TO [cdp_Integration]



/* Base View SQL for MJ: Record Merge Logs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Record Merge Logs
-- Item: vwRecordMergeLogs
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Record Merge Logs
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  RecordMergeLog
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwRecordMergeLogs]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwRecordMergeLogs];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwRecordMergeLogs]
AS
SELECT
    m.*,
    MJEntities_EntityID.[Name] AS [Entity],
    MJUsers_InitiatedByUserID.[Name] AS [InitiatedByUser],
    MJUsers_ApprovedByUserID.[Name] AS [ApprovedByUser]
FROM
    [${flyway:defaultSchema}].[RecordMergeLog] AS m
INNER JOIN
    [${flyway:defaultSchema}].[Entity] AS MJEntities_EntityID
  ON
    [m].[EntityID] = MJEntities_EntityID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_InitiatedByUserID
  ON
    [m].[InitiatedByUserID] = MJUsers_InitiatedByUserID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_ApprovedByUserID
  ON
    [m].[ApprovedByUserID] = MJUsers_ApprovedByUserID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwRecordMergeLogs] TO [cdp_Integration], [cdp_Developer], [cdp_UI]
    

/* Base View Permissions SQL for MJ: Record Merge Logs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Record Merge Logs
-- Item: Permissions for vwRecordMergeLogs
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwRecordMergeLogs] TO [cdp_Integration], [cdp_Developer], [cdp_UI]

/* spCreate SQL for MJ: Record Merge Logs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Record Merge Logs
-- Item: spCreateMJRecordMergeLog
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR RecordMergeLog
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJRecordMergeLog]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJRecordMergeLog];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJRecordMergeLog]
    @ID uniqueidentifier = NULL,
    @EntityID uniqueidentifier,
    @SurvivingRecordID nvarchar(450),
    @InitiatedByUserID uniqueidentifier,
    @ApprovalStatus nvarchar(10) = NULL,
    @ApprovedByUserID uniqueidentifier,
    @ProcessingStatus nvarchar(10) = NULL,
    @ProcessingStartedAt datetimeoffset = NULL,
    @ProcessingEndedAt datetimeoffset,
    @ProcessingLog nvarchar(MAX),
    @Comments nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[RecordMergeLog]
            (
                [ID],
                [EntityID],
                [SurvivingRecordID],
                [InitiatedByUserID],
                [ApprovalStatus],
                [ApprovedByUserID],
                [ProcessingStatus],
                [ProcessingStartedAt],
                [ProcessingEndedAt],
                [ProcessingLog],
                [Comments]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @EntityID,
                @SurvivingRecordID,
                @InitiatedByUserID,
                ISNULL(@ApprovalStatus, 'Pending'),
                @ApprovedByUserID,
                ISNULL(@ProcessingStatus, 'Pending'),
                ISNULL(@ProcessingStartedAt, sysdatetimeoffset()),
                @ProcessingEndedAt,
                @ProcessingLog,
                @Comments
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[RecordMergeLog]
            (
                [EntityID],
                [SurvivingRecordID],
                [InitiatedByUserID],
                [ApprovalStatus],
                [ApprovedByUserID],
                [ProcessingStatus],
                [ProcessingStartedAt],
                [ProcessingEndedAt],
                [ProcessingLog],
                [Comments]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @EntityID,
                @SurvivingRecordID,
                @InitiatedByUserID,
                ISNULL(@ApprovalStatus, 'Pending'),
                @ApprovedByUserID,
                ISNULL(@ProcessingStatus, 'Pending'),
                ISNULL(@ProcessingStartedAt, sysdatetimeoffset()),
                @ProcessingEndedAt,
                @ProcessingLog,
                @Comments
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwRecordMergeLogs] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJRecordMergeLog] TO [cdp_Integration], [cdp_Developer]
    

/* spCreate Permissions for MJ: Record Merge Logs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJRecordMergeLog] TO [cdp_Integration], [cdp_Developer]



/* spUpdate SQL for MJ: Record Merge Logs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Record Merge Logs
-- Item: spUpdateMJRecordMergeLog
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR RecordMergeLog
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJRecordMergeLog]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJRecordMergeLog];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJRecordMergeLog]
    @ID uniqueidentifier,
    @EntityID uniqueidentifier,
    @SurvivingRecordID nvarchar(450),
    @InitiatedByUserID uniqueidentifier,
    @ApprovalStatus nvarchar(10),
    @ApprovedByUserID uniqueidentifier,
    @ProcessingStatus nvarchar(10),
    @ProcessingStartedAt datetimeoffset,
    @ProcessingEndedAt datetimeoffset,
    @ProcessingLog nvarchar(MAX),
    @Comments nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[RecordMergeLog]
    SET
        [EntityID] = @EntityID,
        [SurvivingRecordID] = @SurvivingRecordID,
        [InitiatedByUserID] = @InitiatedByUserID,
        [ApprovalStatus] = @ApprovalStatus,
        [ApprovedByUserID] = @ApprovedByUserID,
        [ProcessingStatus] = @ProcessingStatus,
        [ProcessingStartedAt] = @ProcessingStartedAt,
        [ProcessingEndedAt] = @ProcessingEndedAt,
        [ProcessingLog] = @ProcessingLog,
        [Comments] = @Comments
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwRecordMergeLogs] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwRecordMergeLogs]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJRecordMergeLog] TO [cdp_Integration], [cdp_Developer]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the RecordMergeLog table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJRecordMergeLog]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJRecordMergeLog];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJRecordMergeLog
ON [${flyway:defaultSchema}].[RecordMergeLog]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[RecordMergeLog]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[RecordMergeLog] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Record Merge Logs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJRecordMergeLog] TO [cdp_Integration], [cdp_Developer]



/* spDelete SQL for MJ: Record Merge Logs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Record Merge Logs
-- Item: spDeleteMJRecordMergeLog
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR RecordMergeLog
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJRecordMergeLog]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJRecordMergeLog];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJRecordMergeLog]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[RecordMergeLog]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJRecordMergeLog] TO [cdp_Integration], [cdp_Developer]
    

/* spDelete Permissions for MJ: Record Merge Logs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJRecordMergeLog] TO [cdp_Integration], [cdp_Developer]



/* Base View SQL for MJ: Record Merge Deletion Logs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Record Merge Deletion Logs
-- Item: vwRecordMergeDeletionLogs
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Record Merge Deletion Logs
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  RecordMergeDeletionLog
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwRecordMergeDeletionLogs]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwRecordMergeDeletionLogs];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwRecordMergeDeletionLogs]
AS
SELECT
    m.*,
    MJRecordMergeLogs_RecordMergeLogID.[SurvivingRecordID] AS [RecordMergeLog]
FROM
    [${flyway:defaultSchema}].[RecordMergeDeletionLog] AS m
INNER JOIN
    [${flyway:defaultSchema}].[RecordMergeLog] AS MJRecordMergeLogs_RecordMergeLogID
  ON
    [m].[RecordMergeLogID] = MJRecordMergeLogs_RecordMergeLogID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwRecordMergeDeletionLogs] TO [cdp_Integration], [cdp_UI], [cdp_Developer]
    

/* Base View Permissions SQL for MJ: Record Merge Deletion Logs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Record Merge Deletion Logs
-- Item: Permissions for vwRecordMergeDeletionLogs
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwRecordMergeDeletionLogs] TO [cdp_Integration], [cdp_UI], [cdp_Developer]

/* spCreate SQL for MJ: Record Merge Deletion Logs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Record Merge Deletion Logs
-- Item: spCreateMJRecordMergeDeletionLog
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR RecordMergeDeletionLog
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJRecordMergeDeletionLog]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJRecordMergeDeletionLog];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJRecordMergeDeletionLog]
    @ID uniqueidentifier = NULL,
    @RecordMergeLogID uniqueidentifier,
    @DeletedRecordID nvarchar(750),
    @Status nvarchar(10) = NULL,
    @ProcessingLog nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[RecordMergeDeletionLog]
            (
                [ID],
                [RecordMergeLogID],
                [DeletedRecordID],
                [Status],
                [ProcessingLog]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @RecordMergeLogID,
                @DeletedRecordID,
                ISNULL(@Status, 'Pending'),
                @ProcessingLog
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[RecordMergeDeletionLog]
            (
                [RecordMergeLogID],
                [DeletedRecordID],
                [Status],
                [ProcessingLog]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @RecordMergeLogID,
                @DeletedRecordID,
                ISNULL(@Status, 'Pending'),
                @ProcessingLog
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwRecordMergeDeletionLogs] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJRecordMergeDeletionLog] TO [cdp_Integration], [cdp_Developer]
    

/* spCreate Permissions for MJ: Record Merge Deletion Logs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJRecordMergeDeletionLog] TO [cdp_Integration], [cdp_Developer]



/* spUpdate SQL for MJ: Record Merge Deletion Logs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Record Merge Deletion Logs
-- Item: spUpdateMJRecordMergeDeletionLog
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR RecordMergeDeletionLog
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJRecordMergeDeletionLog]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJRecordMergeDeletionLog];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJRecordMergeDeletionLog]
    @ID uniqueidentifier,
    @RecordMergeLogID uniqueidentifier,
    @DeletedRecordID nvarchar(750),
    @Status nvarchar(10),
    @ProcessingLog nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[RecordMergeDeletionLog]
    SET
        [RecordMergeLogID] = @RecordMergeLogID,
        [DeletedRecordID] = @DeletedRecordID,
        [Status] = @Status,
        [ProcessingLog] = @ProcessingLog
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwRecordMergeDeletionLogs] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwRecordMergeDeletionLogs]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJRecordMergeDeletionLog] TO [cdp_Integration], [cdp_Developer]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the RecordMergeDeletionLog table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJRecordMergeDeletionLog]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJRecordMergeDeletionLog];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJRecordMergeDeletionLog
ON [${flyway:defaultSchema}].[RecordMergeDeletionLog]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[RecordMergeDeletionLog]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[RecordMergeDeletionLog] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Record Merge Deletion Logs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJRecordMergeDeletionLog] TO [cdp_Integration], [cdp_Developer]



/* spDelete SQL for MJ: Record Merge Deletion Logs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Record Merge Deletion Logs
-- Item: spDeleteMJRecordMergeDeletionLog
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR RecordMergeDeletionLog
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJRecordMergeDeletionLog]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJRecordMergeDeletionLog];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJRecordMergeDeletionLog]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[RecordMergeDeletionLog]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJRecordMergeDeletionLog] TO [cdp_Integration], [cdp_Developer]
    

/* spDelete Permissions for MJ: Record Merge Deletion Logs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJRecordMergeDeletionLog] TO [cdp_Integration], [cdp_Developer]



/* Base View SQL for MJ: Record Links */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Record Links
-- Item: vwRecordLinks
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Record Links
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  RecordLink
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwRecordLinks]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwRecordLinks];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwRecordLinks]
AS
SELECT
    m.*,
    MJEntities_SourceEntityID.[Name] AS [SourceEntity],
    MJEntities_TargetEntityID.[Name] AS [TargetEntity]
FROM
    [${flyway:defaultSchema}].[RecordLink] AS m
INNER JOIN
    [${flyway:defaultSchema}].[Entity] AS MJEntities_SourceEntityID
  ON
    [m].[SourceEntityID] = MJEntities_SourceEntityID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[Entity] AS MJEntities_TargetEntityID
  ON
    [m].[TargetEntityID] = MJEntities_TargetEntityID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwRecordLinks] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Record Links */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Record Links
-- Item: Permissions for vwRecordLinks
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwRecordLinks] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Record Links */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Record Links
-- Item: spCreateMJRecordLink
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR RecordLink
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJRecordLink]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJRecordLink];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJRecordLink]
    @ID uniqueidentifier = NULL,
    @SourceEntityID uniqueidentifier,
    @SourceRecordID nvarchar(500),
    @TargetEntityID uniqueidentifier,
    @TargetRecordID nvarchar(500),
    @LinkType nvarchar(50),
    @Sequence int,
    @Metadata nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[RecordLink]
            (
                [ID],
                [SourceEntityID],
                [SourceRecordID],
                [TargetEntityID],
                [TargetRecordID],
                [LinkType],
                [Sequence],
                [Metadata]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @SourceEntityID,
                @SourceRecordID,
                @TargetEntityID,
                @TargetRecordID,
                @LinkType,
                @Sequence,
                @Metadata
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[RecordLink]
            (
                [SourceEntityID],
                [SourceRecordID],
                [TargetEntityID],
                [TargetRecordID],
                [LinkType],
                [Sequence],
                [Metadata]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @SourceEntityID,
                @SourceRecordID,
                @TargetEntityID,
                @TargetRecordID,
                @LinkType,
                @Sequence,
                @Metadata
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwRecordLinks] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJRecordLink] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Record Links */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJRecordLink] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Record Links */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Record Links
-- Item: spUpdateMJRecordLink
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR RecordLink
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJRecordLink]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJRecordLink];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJRecordLink]
    @ID uniqueidentifier,
    @SourceEntityID uniqueidentifier,
    @SourceRecordID nvarchar(500),
    @TargetEntityID uniqueidentifier,
    @TargetRecordID nvarchar(500),
    @LinkType nvarchar(50),
    @Sequence int,
    @Metadata nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[RecordLink]
    SET
        [SourceEntityID] = @SourceEntityID,
        [SourceRecordID] = @SourceRecordID,
        [TargetEntityID] = @TargetEntityID,
        [TargetRecordID] = @TargetRecordID,
        [LinkType] = @LinkType,
        [Sequence] = @Sequence,
        [Metadata] = @Metadata
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwRecordLinks] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwRecordLinks]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJRecordLink] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the RecordLink table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJRecordLink]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJRecordLink];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJRecordLink
ON [${flyway:defaultSchema}].[RecordLink]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[RecordLink]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[RecordLink] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Record Links */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJRecordLink] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Record Links */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Record Links
-- Item: spDeleteMJRecordLink
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR RecordLink
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJRecordLink]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJRecordLink];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJRecordLink]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[RecordLink]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJRecordLink] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Record Links */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJRecordLink] TO [cdp_Integration]



/* Base View SQL for MJ: Report Categories */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Report Categories
-- Item: vwReportCategories
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Report Categories
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  ReportCategory
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwReportCategories]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwReportCategories];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwReportCategories]
AS
SELECT
    m.*,
    MJReportCategories_ParentID.[Name] AS [Parent],
    MJUsers_UserID.[Name] AS [User],
    root_ParentID.RootID AS [RootParentID]
FROM
    [${flyway:defaultSchema}].[ReportCategory] AS m
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[ReportCategory] AS MJReportCategories_ParentID
  ON
    [m].[ParentID] = MJReportCategories_ParentID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_UserID
  ON
    [m].[UserID] = MJUsers_UserID.[ID]
OUTER APPLY
    [${flyway:defaultSchema}].[fnReportCategoryParentID_GetRootID]([m].[ID], [m].[ParentID]) AS root_ParentID
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwReportCategories] TO [cdp_Integration], [cdp_Developer], [cdp_UI]
    

/* Base View Permissions SQL for MJ: Report Categories */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Report Categories
-- Item: Permissions for vwReportCategories
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwReportCategories] TO [cdp_Integration], [cdp_Developer], [cdp_UI]

/* spCreate SQL for MJ: Report Categories */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Report Categories
-- Item: spCreateMJReportCategory
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR ReportCategory
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJReportCategory]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJReportCategory];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJReportCategory]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(100),
    @Description nvarchar(MAX),
    @ParentID uniqueidentifier,
    @UserID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[ReportCategory]
            (
                [ID],
                [Name],
                [Description],
                [ParentID],
                [UserID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description,
                @ParentID,
                @UserID
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[ReportCategory]
            (
                [Name],
                [Description],
                [ParentID],
                [UserID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description,
                @ParentID,
                @UserID
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwReportCategories] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJReportCategory] TO [cdp_Integration], [cdp_Developer]
    

/* spCreate Permissions for MJ: Report Categories */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJReportCategory] TO [cdp_Integration], [cdp_Developer]



/* spUpdate SQL for MJ: Report Categories */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Report Categories
-- Item: spUpdateMJReportCategory
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR ReportCategory
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJReportCategory]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJReportCategory];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJReportCategory]
    @ID uniqueidentifier,
    @Name nvarchar(100),
    @Description nvarchar(MAX),
    @ParentID uniqueidentifier,
    @UserID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ReportCategory]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [ParentID] = @ParentID,
        [UserID] = @UserID
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwReportCategories] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwReportCategories]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJReportCategory] TO [cdp_Integration], [cdp_Developer], [cdp_UI]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the ReportCategory table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJReportCategory]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJReportCategory];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJReportCategory
ON [${flyway:defaultSchema}].[ReportCategory]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ReportCategory]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[ReportCategory] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Report Categories */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJReportCategory] TO [cdp_Integration], [cdp_Developer], [cdp_UI]



/* spDelete SQL for MJ: Report Categories */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Report Categories
-- Item: spDeleteMJReportCategory
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR ReportCategory
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJReportCategory]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJReportCategory];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJReportCategory]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[ReportCategory]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJReportCategory] TO [cdp_Integration], [cdp_Developer], [cdp_UI]
    

/* spDelete Permissions for MJ: Report Categories */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJReportCategory] TO [cdp_Integration], [cdp_Developer], [cdp_UI]



/* Base View SQL for MJ: Report Snapshots */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Report Snapshots
-- Item: vwReportSnapshots
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Report Snapshots
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  ReportSnapshot
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwReportSnapshots]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwReportSnapshots];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwReportSnapshots]
AS
SELECT
    m.*,
    MJReports_ReportID.[Name] AS [Report],
    MJUsers_UserID.[Name] AS [User]
FROM
    [${flyway:defaultSchema}].[ReportSnapshot] AS m
INNER JOIN
    [${flyway:defaultSchema}].[Report] AS MJReports_ReportID
  ON
    [m].[ReportID] = MJReports_ReportID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_UserID
  ON
    [m].[UserID] = MJUsers_UserID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwReportSnapshots] TO [cdp_UI]
    

/* Base View Permissions SQL for MJ: Report Snapshots */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Report Snapshots
-- Item: Permissions for vwReportSnapshots
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwReportSnapshots] TO [cdp_UI]

/* spCreate SQL for MJ: Report Snapshots */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Report Snapshots
-- Item: spCreateMJReportSnapshot
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR ReportSnapshot
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJReportSnapshot]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJReportSnapshot];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJReportSnapshot]
    @ID uniqueidentifier = NULL,
    @ReportID uniqueidentifier,
    @ResultSet nvarchar(MAX),
    @UserID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[ReportSnapshot]
            (
                [ID],
                [ReportID],
                [ResultSet],
                [UserID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @ReportID,
                @ResultSet,
                @UserID
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[ReportSnapshot]
            (
                [ReportID],
                [ResultSet],
                [UserID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ReportID,
                @ResultSet,
                @UserID
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwReportSnapshots] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJReportSnapshot] TO [cdp_UI]
    

/* spCreate Permissions for MJ: Report Snapshots */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJReportSnapshot] TO [cdp_UI]



/* spUpdate SQL for MJ: Report Snapshots */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Report Snapshots
-- Item: spUpdateMJReportSnapshot
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR ReportSnapshot
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJReportSnapshot]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJReportSnapshot];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJReportSnapshot]
    @ID uniqueidentifier,
    @ReportID uniqueidentifier,
    @ResultSet nvarchar(MAX),
    @UserID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ReportSnapshot]
    SET
        [ReportID] = @ReportID,
        [ResultSet] = @ResultSet,
        [UserID] = @UserID
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwReportSnapshots] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwReportSnapshots]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJReportSnapshot] TO [cdp_UI]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the ReportSnapshot table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJReportSnapshot]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJReportSnapshot];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJReportSnapshot
ON [${flyway:defaultSchema}].[ReportSnapshot]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ReportSnapshot]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[ReportSnapshot] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Report Snapshots */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJReportSnapshot] TO [cdp_UI]



/* spDelete SQL for MJ: Report Snapshots */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Report Snapshots
-- Item: spDeleteMJReportSnapshot
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR ReportSnapshot
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJReportSnapshot]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJReportSnapshot];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJReportSnapshot]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[ReportSnapshot]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJReportSnapshot] TO [cdp_UI]
    

/* spDelete Permissions for MJ: Report Snapshots */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJReportSnapshot] TO [cdp_UI]



/* Base View SQL for MJ: Report User States */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Report User States
-- Item: vwReportUserStates
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Report User States
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  ReportUserState
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwReportUserStates]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwReportUserStates];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwReportUserStates]
AS
SELECT
    m.*,
    MJReports_ReportID.[Name] AS [Report],
    MJUsers_UserID.[Name] AS [User]
FROM
    [${flyway:defaultSchema}].[ReportUserState] AS m
INNER JOIN
    [${flyway:defaultSchema}].[Report] AS MJReports_ReportID
  ON
    [m].[ReportID] = MJReports_ReportID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_UserID
  ON
    [m].[UserID] = MJUsers_UserID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwReportUserStates] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Report User States */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Report User States
-- Item: Permissions for vwReportUserStates
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwReportUserStates] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Report User States */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Report User States
-- Item: spCreateMJReportUserState
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR ReportUserState
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJReportUserState]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJReportUserState];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJReportUserState]
    @ID uniqueidentifier = NULL,
    @ReportID uniqueidentifier,
    @UserID uniqueidentifier,
    @ReportState nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[ReportUserState]
            (
                [ID],
                [ReportID],
                [UserID],
                [ReportState]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @ReportID,
                @UserID,
                @ReportState
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[ReportUserState]
            (
                [ReportID],
                [UserID],
                [ReportState]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ReportID,
                @UserID,
                @ReportState
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwReportUserStates] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJReportUserState] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Report User States */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJReportUserState] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Report User States */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Report User States
-- Item: spUpdateMJReportUserState
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR ReportUserState
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJReportUserState]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJReportUserState];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJReportUserState]
    @ID uniqueidentifier,
    @ReportID uniqueidentifier,
    @UserID uniqueidentifier,
    @ReportState nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ReportUserState]
    SET
        [ReportID] = @ReportID,
        [UserID] = @UserID,
        [ReportState] = @ReportState
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwReportUserStates] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwReportUserStates]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJReportUserState] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the ReportUserState table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJReportUserState]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJReportUserState];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJReportUserState
ON [${flyway:defaultSchema}].[ReportUserState]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ReportUserState]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[ReportUserState] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Report User States */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJReportUserState] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Report User States */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Report User States
-- Item: spDeleteMJReportUserState
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR ReportUserState
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJReportUserState]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJReportUserState];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJReportUserState]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[ReportUserState]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJReportUserState] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Report User States */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJReportUserState] TO [cdp_Integration]



/* Base View SQL for MJ: Report Versions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Report Versions
-- Item: vwReportVersions
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Report Versions
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  ReportVersion
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwReportVersions]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwReportVersions];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwReportVersions]
AS
SELECT
    m.*,
    MJReports_ReportID.[Name] AS [Report]
FROM
    [${flyway:defaultSchema}].[ReportVersion] AS m
INNER JOIN
    [${flyway:defaultSchema}].[Report] AS MJReports_ReportID
  ON
    [m].[ReportID] = MJReports_ReportID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwReportVersions] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Report Versions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Report Versions
-- Item: Permissions for vwReportVersions
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwReportVersions] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Report Versions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Report Versions
-- Item: spCreateMJReportVersion
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR ReportVersion
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJReportVersion]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJReportVersion];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJReportVersion]
    @ID uniqueidentifier = NULL,
    @ReportID uniqueidentifier,
    @VersionNumber int,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @Configuration nvarchar(MAX),
    @DataContextUpdated bit = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[ReportVersion]
            (
                [ID],
                [ReportID],
                [VersionNumber],
                [Name],
                [Description],
                [Configuration],
                [DataContextUpdated]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @ReportID,
                @VersionNumber,
                @Name,
                @Description,
                @Configuration,
                ISNULL(@DataContextUpdated, 0)
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[ReportVersion]
            (
                [ReportID],
                [VersionNumber],
                [Name],
                [Description],
                [Configuration],
                [DataContextUpdated]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ReportID,
                @VersionNumber,
                @Name,
                @Description,
                @Configuration,
                ISNULL(@DataContextUpdated, 0)
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwReportVersions] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJReportVersion] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Report Versions */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJReportVersion] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Report Versions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Report Versions
-- Item: spUpdateMJReportVersion
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR ReportVersion
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJReportVersion]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJReportVersion];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJReportVersion]
    @ID uniqueidentifier,
    @ReportID uniqueidentifier,
    @VersionNumber int,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @Configuration nvarchar(MAX),
    @DataContextUpdated bit
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ReportVersion]
    SET
        [ReportID] = @ReportID,
        [VersionNumber] = @VersionNumber,
        [Name] = @Name,
        [Description] = @Description,
        [Configuration] = @Configuration,
        [DataContextUpdated] = @DataContextUpdated
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwReportVersions] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwReportVersions]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJReportVersion] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the ReportVersion table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJReportVersion]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJReportVersion];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJReportVersion
ON [${flyway:defaultSchema}].[ReportVersion]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ReportVersion]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[ReportVersion] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Report Versions */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJReportVersion] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Report Versions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Report Versions
-- Item: spDeleteMJReportVersion
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR ReportVersion
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJReportVersion]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJReportVersion];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJReportVersion]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[ReportVersion]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJReportVersion] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Report Versions */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJReportVersion] TO [cdp_Integration]



/* Base View SQL for MJ: Resource Links */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Resource Links
-- Item: vwResourceLinks
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Resource Links
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  ResourceLink
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwResourceLinks]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwResourceLinks];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwResourceLinks]
AS
SELECT
    m.*,
    MJUsers_UserID.[Name] AS [User],
    MJResourceTypes_ResourceTypeID.[Name] AS [ResourceType]
FROM
    [${flyway:defaultSchema}].[ResourceLink] AS m
INNER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_UserID
  ON
    [m].[UserID] = MJUsers_UserID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[ResourceType] AS MJResourceTypes_ResourceTypeID
  ON
    [m].[ResourceTypeID] = MJResourceTypes_ResourceTypeID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwResourceLinks] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Resource Links */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Resource Links
-- Item: Permissions for vwResourceLinks
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwResourceLinks] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Resource Links */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Resource Links
-- Item: spCreateMJResourceLink
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR ResourceLink
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJResourceLink]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJResourceLink];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJResourceLink]
    @ID uniqueidentifier = NULL,
    @UserID uniqueidentifier,
    @ResourceTypeID uniqueidentifier,
    @ResourceRecordID nvarchar(255),
    @FolderID nvarchar(255)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[ResourceLink]
            (
                [ID],
                [UserID],
                [ResourceTypeID],
                [ResourceRecordID],
                [FolderID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @UserID,
                @ResourceTypeID,
                @ResourceRecordID,
                @FolderID
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[ResourceLink]
            (
                [UserID],
                [ResourceTypeID],
                [ResourceRecordID],
                [FolderID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @UserID,
                @ResourceTypeID,
                @ResourceRecordID,
                @FolderID
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwResourceLinks] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJResourceLink] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Resource Links */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJResourceLink] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Resource Links */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Resource Links
-- Item: spUpdateMJResourceLink
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR ResourceLink
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJResourceLink]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJResourceLink];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJResourceLink]
    @ID uniqueidentifier,
    @UserID uniqueidentifier,
    @ResourceTypeID uniqueidentifier,
    @ResourceRecordID nvarchar(255),
    @FolderID nvarchar(255)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ResourceLink]
    SET
        [UserID] = @UserID,
        [ResourceTypeID] = @ResourceTypeID,
        [ResourceRecordID] = @ResourceRecordID,
        [FolderID] = @FolderID
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwResourceLinks] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwResourceLinks]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJResourceLink] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the ResourceLink table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJResourceLink]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJResourceLink];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJResourceLink
ON [${flyway:defaultSchema}].[ResourceLink]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ResourceLink]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[ResourceLink] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Resource Links */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJResourceLink] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Resource Links */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Resource Links
-- Item: spDeleteMJResourceLink
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR ResourceLink
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJResourceLink]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJResourceLink];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJResourceLink]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[ResourceLink]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJResourceLink] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Resource Links */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJResourceLink] TO [cdp_Integration]



/* Base View SQL for MJ: Reports */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Reports
-- Item: vwReports
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Reports
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  Report
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwReports]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwReports];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwReports]
AS
SELECT
    m.*,
    MJReportCategories_CategoryID.[Name] AS [Category],
    MJUsers_UserID.[Name] AS [User],
    MJConversations_ConversationID.[Name] AS [Conversation],
    MJConversationDetails_ConversationDetailID.[Message] AS [ConversationDetail],
    MJDataContexts_DataContextID.[Name] AS [DataContext],
    MJOutputTriggerTypes_OutputTriggerTypeID.[Name] AS [OutputTriggerType],
    MJOutputFormatTypes_OutputFormatTypeID.[Name] AS [OutputFormatType],
    MJOutputDeliveryTypes_OutputDeliveryTypeID.[Name] AS [OutputDeliveryType],
    MJWorkflows_OutputWorkflowID.[Name] AS [OutputWorkflow],
    MJEnvironments_EnvironmentID.[Name] AS [Environment]
FROM
    [${flyway:defaultSchema}].[Report] AS m
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[ReportCategory] AS MJReportCategories_CategoryID
  ON
    [m].[CategoryID] = MJReportCategories_CategoryID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_UserID
  ON
    [m].[UserID] = MJUsers_UserID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[Conversation] AS MJConversations_ConversationID
  ON
    [m].[ConversationID] = MJConversations_ConversationID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[ConversationDetail] AS MJConversationDetails_ConversationDetailID
  ON
    [m].[ConversationDetailID] = MJConversationDetails_ConversationDetailID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[DataContext] AS MJDataContexts_DataContextID
  ON
    [m].[DataContextID] = MJDataContexts_DataContextID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[OutputTriggerType] AS MJOutputTriggerTypes_OutputTriggerTypeID
  ON
    [m].[OutputTriggerTypeID] = MJOutputTriggerTypes_OutputTriggerTypeID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[OutputFormatType] AS MJOutputFormatTypes_OutputFormatTypeID
  ON
    [m].[OutputFormatTypeID] = MJOutputFormatTypes_OutputFormatTypeID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[OutputDeliveryType] AS MJOutputDeliveryTypes_OutputDeliveryTypeID
  ON
    [m].[OutputDeliveryTypeID] = MJOutputDeliveryTypes_OutputDeliveryTypeID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[Workflow] AS MJWorkflows_OutputWorkflowID
  ON
    [m].[OutputWorkflowID] = MJWorkflows_OutputWorkflowID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[Environment] AS MJEnvironments_EnvironmentID
  ON
    [m].[EnvironmentID] = MJEnvironments_EnvironmentID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwReports] TO [cdp_Developer], [cdp_UI]
    

/* Base View Permissions SQL for MJ: Reports */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Reports
-- Item: Permissions for vwReports
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwReports] TO [cdp_Developer], [cdp_UI]

/* spCreate SQL for MJ: Reports */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Reports
-- Item: spCreateMJReport
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR Report
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJReport]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJReport];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJReport]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @CategoryID uniqueidentifier,
    @UserID uniqueidentifier,
    @SharingScope nvarchar(20) = NULL,
    @ConversationID uniqueidentifier,
    @ConversationDetailID uniqueidentifier,
    @DataContextID uniqueidentifier,
    @Configuration nvarchar(MAX),
    @OutputTriggerTypeID uniqueidentifier,
    @OutputFormatTypeID uniqueidentifier,
    @OutputDeliveryTypeID uniqueidentifier,
    @OutputFrequency nvarchar(50),
    @OutputTargetEmail nvarchar(255),
    @OutputWorkflowID uniqueidentifier,
    @Thumbnail nvarchar(MAX),
    @EnvironmentID uniqueidentifier = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[Report]
            (
                [ID],
                [Name],
                [Description],
                [CategoryID],
                [UserID],
                [SharingScope],
                [ConversationID],
                [ConversationDetailID],
                [DataContextID],
                [Configuration],
                [OutputTriggerTypeID],
                [OutputFormatTypeID],
                [OutputDeliveryTypeID],
                [OutputFrequency],
                [OutputTargetEmail],
                [OutputWorkflowID],
                [Thumbnail],
                [EnvironmentID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description,
                @CategoryID,
                @UserID,
                ISNULL(@SharingScope, 'Personal'),
                @ConversationID,
                @ConversationDetailID,
                @DataContextID,
                @Configuration,
                @OutputTriggerTypeID,
                @OutputFormatTypeID,
                @OutputDeliveryTypeID,
                @OutputFrequency,
                @OutputTargetEmail,
                @OutputWorkflowID,
                @Thumbnail,
                CASE @EnvironmentID WHEN '00000000-0000-0000-0000-000000000000' THEN 'F51358F3-9447-4176-B313-BF8025FD8D09' ELSE ISNULL(@EnvironmentID, 'F51358F3-9447-4176-B313-BF8025FD8D09') END
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[Report]
            (
                [Name],
                [Description],
                [CategoryID],
                [UserID],
                [SharingScope],
                [ConversationID],
                [ConversationDetailID],
                [DataContextID],
                [Configuration],
                [OutputTriggerTypeID],
                [OutputFormatTypeID],
                [OutputDeliveryTypeID],
                [OutputFrequency],
                [OutputTargetEmail],
                [OutputWorkflowID],
                [Thumbnail],
                [EnvironmentID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description,
                @CategoryID,
                @UserID,
                ISNULL(@SharingScope, 'Personal'),
                @ConversationID,
                @ConversationDetailID,
                @DataContextID,
                @Configuration,
                @OutputTriggerTypeID,
                @OutputFormatTypeID,
                @OutputDeliveryTypeID,
                @OutputFrequency,
                @OutputTargetEmail,
                @OutputWorkflowID,
                @Thumbnail,
                CASE @EnvironmentID WHEN '00000000-0000-0000-0000-000000000000' THEN 'F51358F3-9447-4176-B313-BF8025FD8D09' ELSE ISNULL(@EnvironmentID, 'F51358F3-9447-4176-B313-BF8025FD8D09') END
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwReports] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJReport] TO [cdp_Developer], [cdp_UI]
    

/* spCreate Permissions for MJ: Reports */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJReport] TO [cdp_Developer], [cdp_UI]



/* spUpdate SQL for MJ: Reports */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Reports
-- Item: spUpdateMJReport
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR Report
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJReport]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJReport];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJReport]
    @ID uniqueidentifier,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @CategoryID uniqueidentifier,
    @UserID uniqueidentifier,
    @SharingScope nvarchar(20),
    @ConversationID uniqueidentifier,
    @ConversationDetailID uniqueidentifier,
    @DataContextID uniqueidentifier,
    @Configuration nvarchar(MAX),
    @OutputTriggerTypeID uniqueidentifier,
    @OutputFormatTypeID uniqueidentifier,
    @OutputDeliveryTypeID uniqueidentifier,
    @OutputFrequency nvarchar(50),
    @OutputTargetEmail nvarchar(255),
    @OutputWorkflowID uniqueidentifier,
    @Thumbnail nvarchar(MAX),
    @EnvironmentID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[Report]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [CategoryID] = @CategoryID,
        [UserID] = @UserID,
        [SharingScope] = @SharingScope,
        [ConversationID] = @ConversationID,
        [ConversationDetailID] = @ConversationDetailID,
        [DataContextID] = @DataContextID,
        [Configuration] = @Configuration,
        [OutputTriggerTypeID] = @OutputTriggerTypeID,
        [OutputFormatTypeID] = @OutputFormatTypeID,
        [OutputDeliveryTypeID] = @OutputDeliveryTypeID,
        [OutputFrequency] = @OutputFrequency,
        [OutputTargetEmail] = @OutputTargetEmail,
        [OutputWorkflowID] = @OutputWorkflowID,
        [Thumbnail] = @Thumbnail,
        [EnvironmentID] = @EnvironmentID
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwReports] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwReports]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJReport] TO [cdp_Developer], [cdp_UI]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the Report table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJReport]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJReport];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJReport
ON [${flyway:defaultSchema}].[Report]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[Report]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[Report] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Reports */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJReport] TO [cdp_Developer], [cdp_UI]



/* spDelete SQL for MJ: Reports */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Reports
-- Item: spDeleteMJReport
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR Report
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJReport]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJReport];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJReport]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    -- Cascade delete from ReportSnapshot using cursor to call spDeleteMJReportSnapshot
    DECLARE @false_ReportIDID uniqueidentifier
    DECLARE cascade_delete_false_ReportID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[ReportSnapshot]
        WHERE [ReportID] = @ID
    
    OPEN cascade_delete_false_ReportID_cursor
    FETCH NEXT FROM cascade_delete_false_ReportID_cursor INTO @false_ReportIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteMJReportSnapshot] @ID = @false_ReportIDID
        
        FETCH NEXT FROM cascade_delete_false_ReportID_cursor INTO @false_ReportIDID
    END
    
    CLOSE cascade_delete_false_ReportID_cursor
    DEALLOCATE cascade_delete_false_ReportID_cursor
    
    -- Cascade delete from ReportUserState using cursor to call spDeleteMJReportUserState
    DECLARE @false_ReportIDID uniqueidentifier
    DECLARE cascade_delete_false_ReportID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[ReportUserState]
        WHERE [ReportID] = @ID
    
    OPEN cascade_delete_false_ReportID_cursor
    FETCH NEXT FROM cascade_delete_false_ReportID_cursor INTO @false_ReportIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteMJReportUserState] @ID = @false_ReportIDID
        
        FETCH NEXT FROM cascade_delete_false_ReportID_cursor INTO @false_ReportIDID
    END
    
    CLOSE cascade_delete_false_ReportID_cursor
    DEALLOCATE cascade_delete_false_ReportID_cursor
    
    -- Cascade delete from ReportVersion using cursor to call spDeleteMJReportVersion
    DECLARE @false_ReportIDID uniqueidentifier
    DECLARE cascade_delete_false_ReportID_cursor CURSOR FOR 
        SELECT [ID]
        FROM [${flyway:defaultSchema}].[ReportVersion]
        WHERE [ReportID] = @ID
    
    OPEN cascade_delete_false_ReportID_cursor
    FETCH NEXT FROM cascade_delete_false_ReportID_cursor INTO @false_ReportIDID
    
    WHILE @@FETCH_STATUS = 0
    BEGIN
        -- Call the delete SP for the related entity, which handles its own cascades
        EXEC [${flyway:defaultSchema}].[spDeleteMJReportVersion] @ID = @false_ReportIDID
        
        FETCH NEXT FROM cascade_delete_false_ReportID_cursor INTO @false_ReportIDID
    END
    
    CLOSE cascade_delete_false_ReportID_cursor
    DEALLOCATE cascade_delete_false_ReportID_cursor
    

    DELETE FROM
        [${flyway:defaultSchema}].[Report]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJReport] TO [cdp_Developer], [cdp_UI]
    

/* spDelete Permissions for MJ: Reports */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJReport] TO [cdp_Developer], [cdp_UI]



/* Base View SQL for MJ: Resource Permissions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Resource Permissions
-- Item: vwResourcePermissions
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Resource Permissions
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  ResourcePermission
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwResourcePermissions]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwResourcePermissions];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwResourcePermissions]
AS
SELECT
    m.*,
    MJResourceTypes_ResourceTypeID.[Name] AS [ResourceType],
    MJRoles_RoleID.[Name] AS [Role],
    MJUsers_UserID.[Name] AS [User]
FROM
    [${flyway:defaultSchema}].[ResourcePermission] AS m
INNER JOIN
    [${flyway:defaultSchema}].[ResourceType] AS MJResourceTypes_ResourceTypeID
  ON
    [m].[ResourceTypeID] = MJResourceTypes_ResourceTypeID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[Role] AS MJRoles_RoleID
  ON
    [m].[RoleID] = MJRoles_RoleID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_UserID
  ON
    [m].[UserID] = MJUsers_UserID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwResourcePermissions] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Resource Permissions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Resource Permissions
-- Item: Permissions for vwResourcePermissions
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwResourcePermissions] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Resource Permissions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Resource Permissions
-- Item: spCreateMJResourcePermission
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR ResourcePermission
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJResourcePermission]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJResourcePermission];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJResourcePermission]
    @ID uniqueidentifier = NULL,
    @ResourceTypeID uniqueidentifier,
    @ResourceRecordID nvarchar(255),
    @Type nvarchar(10),
    @StartSharingAt datetimeoffset,
    @EndSharingAt datetimeoffset,
    @RoleID uniqueidentifier,
    @UserID uniqueidentifier,
    @PermissionLevel nvarchar(20),
    @Status nvarchar(20) = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[ResourcePermission]
            (
                [ID],
                [ResourceTypeID],
                [ResourceRecordID],
                [Type],
                [StartSharingAt],
                [EndSharingAt],
                [RoleID],
                [UserID],
                [PermissionLevel],
                [Status]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @ResourceTypeID,
                @ResourceRecordID,
                @Type,
                @StartSharingAt,
                @EndSharingAt,
                @RoleID,
                @UserID,
                @PermissionLevel,
                ISNULL(@Status, 'Requested')
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[ResourcePermission]
            (
                [ResourceTypeID],
                [ResourceRecordID],
                [Type],
                [StartSharingAt],
                [EndSharingAt],
                [RoleID],
                [UserID],
                [PermissionLevel],
                [Status]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ResourceTypeID,
                @ResourceRecordID,
                @Type,
                @StartSharingAt,
                @EndSharingAt,
                @RoleID,
                @UserID,
                @PermissionLevel,
                ISNULL(@Status, 'Requested')
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwResourcePermissions] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJResourcePermission] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Resource Permissions */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJResourcePermission] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Resource Permissions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Resource Permissions
-- Item: spUpdateMJResourcePermission
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR ResourcePermission
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJResourcePermission]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJResourcePermission];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJResourcePermission]
    @ID uniqueidentifier,
    @ResourceTypeID uniqueidentifier,
    @ResourceRecordID nvarchar(255),
    @Type nvarchar(10),
    @StartSharingAt datetimeoffset,
    @EndSharingAt datetimeoffset,
    @RoleID uniqueidentifier,
    @UserID uniqueidentifier,
    @PermissionLevel nvarchar(20),
    @Status nvarchar(20)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ResourcePermission]
    SET
        [ResourceTypeID] = @ResourceTypeID,
        [ResourceRecordID] = @ResourceRecordID,
        [Type] = @Type,
        [StartSharingAt] = @StartSharingAt,
        [EndSharingAt] = @EndSharingAt,
        [RoleID] = @RoleID,
        [UserID] = @UserID,
        [PermissionLevel] = @PermissionLevel,
        [Status] = @Status
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwResourcePermissions] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwResourcePermissions]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJResourcePermission] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the ResourcePermission table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJResourcePermission]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJResourcePermission];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJResourcePermission
ON [${flyway:defaultSchema}].[ResourcePermission]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ResourcePermission]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[ResourcePermission] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Resource Permissions */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJResourcePermission] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Resource Permissions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Resource Permissions
-- Item: spDeleteMJResourcePermission
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR ResourcePermission
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJResourcePermission]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJResourcePermission];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJResourcePermission]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[ResourcePermission]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJResourcePermission] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Resource Permissions */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJResourcePermission] TO [cdp_Integration]



/* Base View SQL for MJ: Resource Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Resource Types
-- Item: vwResourceTypes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Resource Types
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  ResourceType
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwResourceTypes]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwResourceTypes];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwResourceTypes]
AS
SELECT
    m.*,
    MJEntities_EntityID.[Name] AS [Entity],
    MJEntities_CategoryEntityID.[Name] AS [CategoryEntity]
FROM
    [${flyway:defaultSchema}].[ResourceType] AS m
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[Entity] AS MJEntities_EntityID
  ON
    [m].[EntityID] = MJEntities_EntityID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[Entity] AS MJEntities_CategoryEntityID
  ON
    [m].[CategoryEntityID] = MJEntities_CategoryEntityID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwResourceTypes] TO [cdp_UI]
    

/* Base View Permissions SQL for MJ: Resource Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Resource Types
-- Item: Permissions for vwResourceTypes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwResourceTypes] TO [cdp_UI]

/* spCreate SQL for MJ: Resource Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Resource Types
-- Item: spCreateMJResourceType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR ResourceType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJResourceType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJResourceType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJResourceType]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(255),
    @DisplayName nvarchar(255),
    @Description nvarchar(MAX),
    @Icon nvarchar(100),
    @EntityID uniqueidentifier,
    @CategoryEntityID uniqueidentifier,
    @DriverClass nvarchar(255)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[ResourceType]
            (
                [ID],
                [Name],
                [DisplayName],
                [Description],
                [Icon],
                [EntityID],
                [CategoryEntityID],
                [DriverClass]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @DisplayName,
                @Description,
                @Icon,
                @EntityID,
                @CategoryEntityID,
                @DriverClass
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[ResourceType]
            (
                [Name],
                [DisplayName],
                [Description],
                [Icon],
                [EntityID],
                [CategoryEntityID],
                [DriverClass]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @DisplayName,
                @Description,
                @Icon,
                @EntityID,
                @CategoryEntityID,
                @DriverClass
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwResourceTypes] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJResourceType] TO [cdp_UI]
    

/* spCreate Permissions for MJ: Resource Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJResourceType] TO [cdp_UI]



/* spUpdate SQL for MJ: Resource Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Resource Types
-- Item: spUpdateMJResourceType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR ResourceType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJResourceType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJResourceType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJResourceType]
    @ID uniqueidentifier,
    @Name nvarchar(255),
    @DisplayName nvarchar(255),
    @Description nvarchar(MAX),
    @Icon nvarchar(100),
    @EntityID uniqueidentifier,
    @CategoryEntityID uniqueidentifier,
    @DriverClass nvarchar(255)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ResourceType]
    SET
        [Name] = @Name,
        [DisplayName] = @DisplayName,
        [Description] = @Description,
        [Icon] = @Icon,
        [EntityID] = @EntityID,
        [CategoryEntityID] = @CategoryEntityID,
        [DriverClass] = @DriverClass
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwResourceTypes] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwResourceTypes]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJResourceType] TO [cdp_UI]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the ResourceType table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJResourceType]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJResourceType];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJResourceType
ON [${flyway:defaultSchema}].[ResourceType]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ResourceType]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[ResourceType] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Resource Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJResourceType] TO [cdp_UI]



/* spDelete SQL for MJ: Resource Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Resource Types
-- Item: spDeleteMJResourceType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR ResourceType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJResourceType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJResourceType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJResourceType]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[ResourceType]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJResourceType] TO [cdp_UI]
    

/* spDelete Permissions for MJ: Resource Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJResourceType] TO [cdp_UI]



/* Base View SQL for MJ: Scheduled Action Params */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Scheduled Action Params
-- Item: vwScheduledActionParams
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Scheduled Action Params
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  ScheduledActionParam
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwScheduledActionParams]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwScheduledActionParams];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwScheduledActionParams]
AS
SELECT
    m.*,
    MJScheduledActions_ScheduledActionID.[Name] AS [ScheduledAction],
    MJActionParams_ActionParamID.[Name] AS [ActionParam]
FROM
    [${flyway:defaultSchema}].[ScheduledActionParam] AS m
INNER JOIN
    [${flyway:defaultSchema}].[ScheduledAction] AS MJScheduledActions_ScheduledActionID
  ON
    [m].[ScheduledActionID] = MJScheduledActions_ScheduledActionID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[ActionParam] AS MJActionParams_ActionParamID
  ON
    [m].[ActionParamID] = MJActionParams_ActionParamID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwScheduledActionParams] TO [cdp_Developer], [cdp_Integration], [cdp_UI]
    

/* Base View Permissions SQL for MJ: Scheduled Action Params */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Scheduled Action Params
-- Item: Permissions for vwScheduledActionParams
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwScheduledActionParams] TO [cdp_Developer], [cdp_Integration], [cdp_UI]

/* spCreate SQL for MJ: Scheduled Action Params */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Scheduled Action Params
-- Item: spCreateMJScheduledActionParam
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR ScheduledActionParam
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJScheduledActionParam]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJScheduledActionParam];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJScheduledActionParam]
    @ID uniqueidentifier = NULL,
    @ScheduledActionID uniqueidentifier,
    @ActionParamID uniqueidentifier,
    @ValueType nvarchar(20),
    @Value nvarchar(MAX),
    @Comments nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[ScheduledActionParam]
            (
                [ID],
                [ScheduledActionID],
                [ActionParamID],
                [ValueType],
                [Value],
                [Comments]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @ScheduledActionID,
                @ActionParamID,
                @ValueType,
                @Value,
                @Comments
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[ScheduledActionParam]
            (
                [ScheduledActionID],
                [ActionParamID],
                [ValueType],
                [Value],
                [Comments]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ScheduledActionID,
                @ActionParamID,
                @ValueType,
                @Value,
                @Comments
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwScheduledActionParams] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJScheduledActionParam] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Scheduled Action Params */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJScheduledActionParam] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Scheduled Action Params */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Scheduled Action Params
-- Item: spUpdateMJScheduledActionParam
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR ScheduledActionParam
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJScheduledActionParam]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJScheduledActionParam];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJScheduledActionParam]
    @ID uniqueidentifier,
    @ScheduledActionID uniqueidentifier,
    @ActionParamID uniqueidentifier,
    @ValueType nvarchar(20),
    @Value nvarchar(MAX),
    @Comments nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ScheduledActionParam]
    SET
        [ScheduledActionID] = @ScheduledActionID,
        [ActionParamID] = @ActionParamID,
        [ValueType] = @ValueType,
        [Value] = @Value,
        [Comments] = @Comments
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwScheduledActionParams] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwScheduledActionParams]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJScheduledActionParam] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the ScheduledActionParam table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJScheduledActionParam]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJScheduledActionParam];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJScheduledActionParam
ON [${flyway:defaultSchema}].[ScheduledActionParam]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ScheduledActionParam]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[ScheduledActionParam] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Scheduled Action Params */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJScheduledActionParam] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Scheduled Action Params */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Scheduled Action Params
-- Item: spDeleteMJScheduledActionParam
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR ScheduledActionParam
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJScheduledActionParam]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJScheduledActionParam];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJScheduledActionParam]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[ScheduledActionParam]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJScheduledActionParam] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Scheduled Action Params */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJScheduledActionParam] TO [cdp_Integration]



/* Base View SQL for MJ: Scheduled Actions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Scheduled Actions
-- Item: vwScheduledActions
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Scheduled Actions
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  ScheduledAction
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwScheduledActions]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwScheduledActions];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwScheduledActions]
AS
SELECT
    m.*,
    MJUsers_CreatedByUserID.[Name] AS [CreatedByUser],
    MJActions_ActionID.[Name] AS [Action]
FROM
    [${flyway:defaultSchema}].[ScheduledAction] AS m
INNER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_CreatedByUserID
  ON
    [m].[CreatedByUserID] = MJUsers_CreatedByUserID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[Action] AS MJActions_ActionID
  ON
    [m].[ActionID] = MJActions_ActionID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwScheduledActions] TO [cdp_UI], [cdp_Integration], [cdp_Developer]
    

/* Base View Permissions SQL for MJ: Scheduled Actions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Scheduled Actions
-- Item: Permissions for vwScheduledActions
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwScheduledActions] TO [cdp_UI], [cdp_Integration], [cdp_Developer]

/* spCreate SQL for MJ: Scheduled Actions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Scheduled Actions
-- Item: spCreateMJScheduledAction
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR ScheduledAction
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJScheduledAction]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJScheduledAction];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJScheduledAction]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @CreatedByUserID uniqueidentifier,
    @ActionID uniqueidentifier,
    @Type nvarchar(20),
    @CronExpression nvarchar(100),
    @Timezone nvarchar(100),
    @Status nvarchar(20) = NULL,
    @IntervalDays int,
    @DayOfWeek nvarchar(20),
    @DayOfMonth int,
    @Month nvarchar(20),
    @CustomCronExpression nvarchar(255)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[ScheduledAction]
            (
                [ID],
                [Name],
                [Description],
                [CreatedByUserID],
                [ActionID],
                [Type],
                [CronExpression],
                [Timezone],
                [Status],
                [IntervalDays],
                [DayOfWeek],
                [DayOfMonth],
                [Month],
                [CustomCronExpression]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description,
                @CreatedByUserID,
                @ActionID,
                @Type,
                @CronExpression,
                @Timezone,
                ISNULL(@Status, 'Pending'),
                @IntervalDays,
                @DayOfWeek,
                @DayOfMonth,
                @Month,
                @CustomCronExpression
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[ScheduledAction]
            (
                [Name],
                [Description],
                [CreatedByUserID],
                [ActionID],
                [Type],
                [CronExpression],
                [Timezone],
                [Status],
                [IntervalDays],
                [DayOfWeek],
                [DayOfMonth],
                [Month],
                [CustomCronExpression]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description,
                @CreatedByUserID,
                @ActionID,
                @Type,
                @CronExpression,
                @Timezone,
                ISNULL(@Status, 'Pending'),
                @IntervalDays,
                @DayOfWeek,
                @DayOfMonth,
                @Month,
                @CustomCronExpression
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwScheduledActions] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJScheduledAction] TO [cdp_Integration], [cdp_Developer]
    

/* spCreate Permissions for MJ: Scheduled Actions */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJScheduledAction] TO [cdp_Integration], [cdp_Developer]



/* spUpdate SQL for MJ: Scheduled Actions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Scheduled Actions
-- Item: spUpdateMJScheduledAction
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR ScheduledAction
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJScheduledAction]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJScheduledAction];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJScheduledAction]
    @ID uniqueidentifier,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @CreatedByUserID uniqueidentifier,
    @ActionID uniqueidentifier,
    @Type nvarchar(20),
    @CronExpression nvarchar(100),
    @Timezone nvarchar(100),
    @Status nvarchar(20),
    @IntervalDays int,
    @DayOfWeek nvarchar(20),
    @DayOfMonth int,
    @Month nvarchar(20),
    @CustomCronExpression nvarchar(255)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ScheduledAction]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [CreatedByUserID] = @CreatedByUserID,
        [ActionID] = @ActionID,
        [Type] = @Type,
        [CronExpression] = @CronExpression,
        [Timezone] = @Timezone,
        [Status] = @Status,
        [IntervalDays] = @IntervalDays,
        [DayOfWeek] = @DayOfWeek,
        [DayOfMonth] = @DayOfMonth,
        [Month] = @Month,
        [CustomCronExpression] = @CustomCronExpression
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwScheduledActions] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwScheduledActions]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJScheduledAction] TO [cdp_Integration], [cdp_Developer]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the ScheduledAction table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJScheduledAction]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJScheduledAction];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJScheduledAction
ON [${flyway:defaultSchema}].[ScheduledAction]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ScheduledAction]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[ScheduledAction] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Scheduled Actions */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJScheduledAction] TO [cdp_Integration], [cdp_Developer]



/* spDelete SQL for MJ: Scheduled Actions */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Scheduled Actions
-- Item: spDeleteMJScheduledAction
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR ScheduledAction
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJScheduledAction]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJScheduledAction];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJScheduledAction]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[ScheduledAction]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJScheduledAction] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Scheduled Actions */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJScheduledAction] TO [cdp_Integration]



/* Base View SQL for MJ: Row Level Security Filters */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Row Level Security Filters
-- Item: vwRowLevelSecurityFilters
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Row Level Security Filters
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  RowLevelSecurityFilter
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwRowLevelSecurityFilters]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwRowLevelSecurityFilters];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwRowLevelSecurityFilters]
AS
SELECT
    m.*
FROM
    [${flyway:defaultSchema}].[RowLevelSecurityFilter] AS m
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwRowLevelSecurityFilters] TO [cdp_Integration], [cdp_UI], [cdp_Developer]
    

/* Base View Permissions SQL for MJ: Row Level Security Filters */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Row Level Security Filters
-- Item: Permissions for vwRowLevelSecurityFilters
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwRowLevelSecurityFilters] TO [cdp_Integration], [cdp_UI], [cdp_Developer]

/* spCreate SQL for MJ: Row Level Security Filters */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Row Level Security Filters
-- Item: spCreateMJRowLevelSecurityFilter
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR RowLevelSecurityFilter
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJRowLevelSecurityFilter]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJRowLevelSecurityFilter];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJRowLevelSecurityFilter]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(100),
    @Description nvarchar(MAX),
    @FilterText nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[RowLevelSecurityFilter]
            (
                [ID],
                [Name],
                [Description],
                [FilterText]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description,
                @FilterText
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[RowLevelSecurityFilter]
            (
                [Name],
                [Description],
                [FilterText]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description,
                @FilterText
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwRowLevelSecurityFilters] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
    

/* spCreate Permissions for MJ: Row Level Security Filters */




/* spUpdate SQL for MJ: Row Level Security Filters */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Row Level Security Filters
-- Item: spUpdateMJRowLevelSecurityFilter
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR RowLevelSecurityFilter
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJRowLevelSecurityFilter]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJRowLevelSecurityFilter];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJRowLevelSecurityFilter]
    @ID uniqueidentifier,
    @Name nvarchar(100),
    @Description nvarchar(MAX),
    @FilterText nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[RowLevelSecurityFilter]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [FilterText] = @FilterText
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwRowLevelSecurityFilters] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwRowLevelSecurityFilters]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the RowLevelSecurityFilter table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJRowLevelSecurityFilter]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJRowLevelSecurityFilter];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJRowLevelSecurityFilter
ON [${flyway:defaultSchema}].[RowLevelSecurityFilter]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[RowLevelSecurityFilter]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[RowLevelSecurityFilter] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Row Level Security Filters */




/* spDelete SQL for MJ: Row Level Security Filters */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Row Level Security Filters
-- Item: spDeleteMJRowLevelSecurityFilter
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR RowLevelSecurityFilter
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJRowLevelSecurityFilter]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJRowLevelSecurityFilter];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJRowLevelSecurityFilter]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[RowLevelSecurityFilter]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
    

/* spDelete Permissions for MJ: Row Level Security Filters */




/* Base View SQL for MJ: Roles */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Roles
-- Item: vwRoles
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Roles
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  Role
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwRoles]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwRoles];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwRoles]
AS
SELECT
    m.*
FROM
    [${flyway:defaultSchema}].[Role] AS m
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwRoles] TO [cdp_Developer], [cdp_UI], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Roles */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Roles
-- Item: Permissions for vwRoles
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwRoles] TO [cdp_Developer], [cdp_UI], [cdp_Integration]

/* spCreate SQL for MJ: Roles */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Roles
-- Item: spCreateMJRole
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR Role
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJRole]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJRole];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJRole]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(50),
    @Description nvarchar(MAX),
    @DirectoryID nvarchar(250),
    @SQLName nvarchar(250)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[Role]
            (
                [ID],
                [Name],
                [Description],
                [DirectoryID],
                [SQLName]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description,
                @DirectoryID,
                @SQLName
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[Role]
            (
                [Name],
                [Description],
                [DirectoryID],
                [SQLName]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description,
                @DirectoryID,
                @SQLName
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwRoles] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJRole] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Roles */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJRole] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Roles */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Roles
-- Item: spUpdateMJRole
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR Role
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJRole]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJRole];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJRole]
    @ID uniqueidentifier,
    @Name nvarchar(50),
    @Description nvarchar(MAX),
    @DirectoryID nvarchar(250),
    @SQLName nvarchar(250)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[Role]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [DirectoryID] = @DirectoryID,
        [SQLName] = @SQLName
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwRoles] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwRoles]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJRole] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the Role table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJRole]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJRole];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJRole
ON [${flyway:defaultSchema}].[Role]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[Role]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[Role] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Roles */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJRole] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Roles */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Roles
-- Item: spDeleteMJRole
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR Role
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJRole]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJRole];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJRole]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[Role]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJRole] TO [cdp_Developer], [cdp_Integration]
    

/* spDelete Permissions for MJ: Roles */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJRole] TO [cdp_Developer], [cdp_Integration]



/* Base View SQL for MJ: Scheduled Job Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Scheduled Job Types
-- Item: vwScheduledJobTypes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Scheduled Job Types
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  ScheduledJobType
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwScheduledJobTypes]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwScheduledJobTypes];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwScheduledJobTypes]
AS
SELECT
    m.*
FROM
    [${flyway:defaultSchema}].[ScheduledJobType] AS m
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwScheduledJobTypes] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Scheduled Job Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Scheduled Job Types
-- Item: Permissions for vwScheduledJobTypes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwScheduledJobTypes] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Scheduled Job Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Scheduled Job Types
-- Item: spCreateMJScheduledJobType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR ScheduledJobType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJScheduledJobType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJScheduledJobType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJScheduledJobType]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(100),
    @Description nvarchar(MAX),
    @DriverClass nvarchar(255),
    @DomainRunEntity nvarchar(255),
    @DomainRunEntityFKey nvarchar(100),
    @NotificationsAvailable bit = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[ScheduledJobType]
            (
                [ID],
                [Name],
                [Description],
                [DriverClass],
                [DomainRunEntity],
                [DomainRunEntityFKey],
                [NotificationsAvailable]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description,
                @DriverClass,
                @DomainRunEntity,
                @DomainRunEntityFKey,
                ISNULL(@NotificationsAvailable, 1)
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[ScheduledJobType]
            (
                [Name],
                [Description],
                [DriverClass],
                [DomainRunEntity],
                [DomainRunEntityFKey],
                [NotificationsAvailable]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description,
                @DriverClass,
                @DomainRunEntity,
                @DomainRunEntityFKey,
                ISNULL(@NotificationsAvailable, 1)
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwScheduledJobTypes] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJScheduledJobType] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Scheduled Job Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJScheduledJobType] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Scheduled Job Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Scheduled Job Types
-- Item: spUpdateMJScheduledJobType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR ScheduledJobType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJScheduledJobType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJScheduledJobType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJScheduledJobType]
    @ID uniqueidentifier,
    @Name nvarchar(100),
    @Description nvarchar(MAX),
    @DriverClass nvarchar(255),
    @DomainRunEntity nvarchar(255),
    @DomainRunEntityFKey nvarchar(100),
    @NotificationsAvailable bit
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ScheduledJobType]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [DriverClass] = @DriverClass,
        [DomainRunEntity] = @DomainRunEntity,
        [DomainRunEntityFKey] = @DomainRunEntityFKey,
        [NotificationsAvailable] = @NotificationsAvailable
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwScheduledJobTypes] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwScheduledJobTypes]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJScheduledJobType] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the ScheduledJobType table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJScheduledJobType]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJScheduledJobType];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJScheduledJobType
ON [${flyway:defaultSchema}].[ScheduledJobType]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ScheduledJobType]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[ScheduledJobType] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Scheduled Job Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJScheduledJobType] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Scheduled Job Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Scheduled Job Types
-- Item: spDeleteMJScheduledJobType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR ScheduledJobType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJScheduledJobType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJScheduledJobType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJScheduledJobType]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[ScheduledJobType]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJScheduledJobType] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Scheduled Job Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJScheduledJobType] TO [cdp_Integration]



/* Base View SQL for MJ: Scheduled Jobs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Scheduled Jobs
-- Item: vwScheduledJobs
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Scheduled Jobs
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  ScheduledJob
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwScheduledJobs]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwScheduledJobs];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwScheduledJobs]
AS
SELECT
    m.*,
    MJScheduledJobTypes_JobTypeID.[Name] AS [JobType],
    MJUsers_OwnerUserID.[Name] AS [OwnerUser],
    MJUsers_NotifyUserID.[Name] AS [NotifyUser]
FROM
    [${flyway:defaultSchema}].[ScheduledJob] AS m
INNER JOIN
    [${flyway:defaultSchema}].[ScheduledJobType] AS MJScheduledJobTypes_JobTypeID
  ON
    [m].[JobTypeID] = MJScheduledJobTypes_JobTypeID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_OwnerUserID
  ON
    [m].[OwnerUserID] = MJUsers_OwnerUserID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_NotifyUserID
  ON
    [m].[NotifyUserID] = MJUsers_NotifyUserID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwScheduledJobs] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Scheduled Jobs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Scheduled Jobs
-- Item: Permissions for vwScheduledJobs
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwScheduledJobs] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Scheduled Jobs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Scheduled Jobs
-- Item: spCreateMJScheduledJob
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR ScheduledJob
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJScheduledJob]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJScheduledJob];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJScheduledJob]
    @ID uniqueidentifier = NULL,
    @JobTypeID uniqueidentifier,
    @Name nvarchar(200),
    @Description nvarchar(MAX),
    @CronExpression nvarchar(120),
    @Timezone nvarchar(64) = NULL,
    @StartAt datetimeoffset,
    @EndAt datetimeoffset,
    @Status nvarchar(20) = NULL,
    @Configuration nvarchar(MAX),
    @OwnerUserID uniqueidentifier,
    @LastRunAt datetimeoffset,
    @NextRunAt datetimeoffset,
    @RunCount int = NULL,
    @SuccessCount int = NULL,
    @FailureCount int = NULL,
    @NotifyOnSuccess bit = NULL,
    @NotifyOnFailure bit = NULL,
    @NotifyUserID uniqueidentifier,
    @NotifyViaEmail bit = NULL,
    @NotifyViaInApp bit = NULL,
    @LockToken uniqueidentifier,
    @LockedAt datetimeoffset,
    @LockedByInstance nvarchar(255),
    @ExpectedCompletionAt datetimeoffset,
    @ConcurrencyMode nvarchar(20) = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[ScheduledJob]
            (
                [ID],
                [JobTypeID],
                [Name],
                [Description],
                [CronExpression],
                [Timezone],
                [StartAt],
                [EndAt],
                [Status],
                [Configuration],
                [OwnerUserID],
                [LastRunAt],
                [NextRunAt],
                [RunCount],
                [SuccessCount],
                [FailureCount],
                [NotifyOnSuccess],
                [NotifyOnFailure],
                [NotifyUserID],
                [NotifyViaEmail],
                [NotifyViaInApp],
                [LockToken],
                [LockedAt],
                [LockedByInstance],
                [ExpectedCompletionAt],
                [ConcurrencyMode]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @JobTypeID,
                @Name,
                @Description,
                @CronExpression,
                ISNULL(@Timezone, 'UTC'),
                @StartAt,
                @EndAt,
                ISNULL(@Status, 'Pending'),
                @Configuration,
                @OwnerUserID,
                @LastRunAt,
                @NextRunAt,
                ISNULL(@RunCount, 0),
                ISNULL(@SuccessCount, 0),
                ISNULL(@FailureCount, 0),
                ISNULL(@NotifyOnSuccess, 0),
                ISNULL(@NotifyOnFailure, 1),
                @NotifyUserID,
                ISNULL(@NotifyViaEmail, 0),
                ISNULL(@NotifyViaInApp, 1),
                @LockToken,
                @LockedAt,
                @LockedByInstance,
                @ExpectedCompletionAt,
                ISNULL(@ConcurrencyMode, 'Skip')
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[ScheduledJob]
            (
                [JobTypeID],
                [Name],
                [Description],
                [CronExpression],
                [Timezone],
                [StartAt],
                [EndAt],
                [Status],
                [Configuration],
                [OwnerUserID],
                [LastRunAt],
                [NextRunAt],
                [RunCount],
                [SuccessCount],
                [FailureCount],
                [NotifyOnSuccess],
                [NotifyOnFailure],
                [NotifyUserID],
                [NotifyViaEmail],
                [NotifyViaInApp],
                [LockToken],
                [LockedAt],
                [LockedByInstance],
                [ExpectedCompletionAt],
                [ConcurrencyMode]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @JobTypeID,
                @Name,
                @Description,
                @CronExpression,
                ISNULL(@Timezone, 'UTC'),
                @StartAt,
                @EndAt,
                ISNULL(@Status, 'Pending'),
                @Configuration,
                @OwnerUserID,
                @LastRunAt,
                @NextRunAt,
                ISNULL(@RunCount, 0),
                ISNULL(@SuccessCount, 0),
                ISNULL(@FailureCount, 0),
                ISNULL(@NotifyOnSuccess, 0),
                ISNULL(@NotifyOnFailure, 1),
                @NotifyUserID,
                ISNULL(@NotifyViaEmail, 0),
                ISNULL(@NotifyViaInApp, 1),
                @LockToken,
                @LockedAt,
                @LockedByInstance,
                @ExpectedCompletionAt,
                ISNULL(@ConcurrencyMode, 'Skip')
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwScheduledJobs] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJScheduledJob] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Scheduled Jobs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJScheduledJob] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Scheduled Jobs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Scheduled Jobs
-- Item: spUpdateMJScheduledJob
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR ScheduledJob
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJScheduledJob]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJScheduledJob];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJScheduledJob]
    @ID uniqueidentifier,
    @JobTypeID uniqueidentifier,
    @Name nvarchar(200),
    @Description nvarchar(MAX),
    @CronExpression nvarchar(120),
    @Timezone nvarchar(64),
    @StartAt datetimeoffset,
    @EndAt datetimeoffset,
    @Status nvarchar(20),
    @Configuration nvarchar(MAX),
    @OwnerUserID uniqueidentifier,
    @LastRunAt datetimeoffset,
    @NextRunAt datetimeoffset,
    @RunCount int,
    @SuccessCount int,
    @FailureCount int,
    @NotifyOnSuccess bit,
    @NotifyOnFailure bit,
    @NotifyUserID uniqueidentifier,
    @NotifyViaEmail bit,
    @NotifyViaInApp bit,
    @LockToken uniqueidentifier,
    @LockedAt datetimeoffset,
    @LockedByInstance nvarchar(255),
    @ExpectedCompletionAt datetimeoffset,
    @ConcurrencyMode nvarchar(20)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ScheduledJob]
    SET
        [JobTypeID] = @JobTypeID,
        [Name] = @Name,
        [Description] = @Description,
        [CronExpression] = @CronExpression,
        [Timezone] = @Timezone,
        [StartAt] = @StartAt,
        [EndAt] = @EndAt,
        [Status] = @Status,
        [Configuration] = @Configuration,
        [OwnerUserID] = @OwnerUserID,
        [LastRunAt] = @LastRunAt,
        [NextRunAt] = @NextRunAt,
        [RunCount] = @RunCount,
        [SuccessCount] = @SuccessCount,
        [FailureCount] = @FailureCount,
        [NotifyOnSuccess] = @NotifyOnSuccess,
        [NotifyOnFailure] = @NotifyOnFailure,
        [NotifyUserID] = @NotifyUserID,
        [NotifyViaEmail] = @NotifyViaEmail,
        [NotifyViaInApp] = @NotifyViaInApp,
        [LockToken] = @LockToken,
        [LockedAt] = @LockedAt,
        [LockedByInstance] = @LockedByInstance,
        [ExpectedCompletionAt] = @ExpectedCompletionAt,
        [ConcurrencyMode] = @ConcurrencyMode
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwScheduledJobs] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwScheduledJobs]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJScheduledJob] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the ScheduledJob table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJScheduledJob]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJScheduledJob];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJScheduledJob
ON [${flyway:defaultSchema}].[ScheduledJob]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ScheduledJob]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[ScheduledJob] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Scheduled Jobs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJScheduledJob] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Scheduled Jobs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Scheduled Jobs
-- Item: spDeleteMJScheduledJob
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR ScheduledJob
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJScheduledJob]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJScheduledJob];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJScheduledJob]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[ScheduledJob]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJScheduledJob] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Scheduled Jobs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJScheduledJob] TO [cdp_Integration]



/* Base View SQL for MJ: Schema Info */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Schema Info
-- Item: vwSchemaInfos
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Schema Info
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  SchemaInfo
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwSchemaInfos]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwSchemaInfos];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwSchemaInfos]
AS
SELECT
    m.*
FROM
    [${flyway:defaultSchema}].[SchemaInfo] AS m
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwSchemaInfos] TO [cdp_Developer], [cdp_UI], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Schema Info */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Schema Info
-- Item: Permissions for vwSchemaInfos
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwSchemaInfos] TO [cdp_Developer], [cdp_UI], [cdp_Integration]

/* spCreate SQL for MJ: Schema Info */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Schema Info
-- Item: spCreateMJSchemaInfo
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR SchemaInfo
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJSchemaInfo]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJSchemaInfo];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJSchemaInfo]
    @ID uniqueidentifier = NULL,
    @SchemaName nvarchar(50),
    @EntityIDMin int,
    @EntityIDMax int,
    @Comments nvarchar(MAX),
    @Description nvarchar(MAX),
    @EntityNamePrefix nvarchar(25),
    @EntityNameSuffix nvarchar(25)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[SchemaInfo]
            (
                [ID],
                [SchemaName],
                [EntityIDMin],
                [EntityIDMax],
                [Comments],
                [Description],
                [EntityNamePrefix],
                [EntityNameSuffix]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @SchemaName,
                @EntityIDMin,
                @EntityIDMax,
                @Comments,
                @Description,
                @EntityNamePrefix,
                @EntityNameSuffix
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[SchemaInfo]
            (
                [SchemaName],
                [EntityIDMin],
                [EntityIDMax],
                [Comments],
                [Description],
                [EntityNamePrefix],
                [EntityNameSuffix]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @SchemaName,
                @EntityIDMin,
                @EntityIDMax,
                @Comments,
                @Description,
                @EntityNamePrefix,
                @EntityNameSuffix
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwSchemaInfos] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJSchemaInfo] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Schema Info */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJSchemaInfo] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Schema Info */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Schema Info
-- Item: spUpdateMJSchemaInfo
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR SchemaInfo
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJSchemaInfo]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJSchemaInfo];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJSchemaInfo]
    @ID uniqueidentifier,
    @SchemaName nvarchar(50),
    @EntityIDMin int,
    @EntityIDMax int,
    @Comments nvarchar(MAX),
    @Description nvarchar(MAX),
    @EntityNamePrefix nvarchar(25),
    @EntityNameSuffix nvarchar(25)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[SchemaInfo]
    SET
        [SchemaName] = @SchemaName,
        [EntityIDMin] = @EntityIDMin,
        [EntityIDMax] = @EntityIDMax,
        [Comments] = @Comments,
        [Description] = @Description,
        [EntityNamePrefix] = @EntityNamePrefix,
        [EntityNameSuffix] = @EntityNameSuffix
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwSchemaInfos] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwSchemaInfos]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJSchemaInfo] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the SchemaInfo table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJSchemaInfo]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJSchemaInfo];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJSchemaInfo
ON [${flyway:defaultSchema}].[SchemaInfo]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[SchemaInfo]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[SchemaInfo] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Schema Info */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJSchemaInfo] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Schema Info */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Schema Info
-- Item: spDeleteMJSchemaInfo
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR SchemaInfo
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJSchemaInfo]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJSchemaInfo];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJSchemaInfo]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[SchemaInfo]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJSchemaInfo] TO [cdp_Developer], [cdp_Integration]
    

/* spDelete Permissions for MJ: Schema Info */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJSchemaInfo] TO [cdp_Developer], [cdp_Integration]



/* Base View SQL for MJ: Scheduled Job Runs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Scheduled Job Runs
-- Item: vwScheduledJobRuns
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Scheduled Job Runs
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  ScheduledJobRun
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwScheduledJobRuns]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwScheduledJobRuns];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwScheduledJobRuns]
AS
SELECT
    m.*,
    MJScheduledJobs_ScheduledJobID.[Name] AS [ScheduledJob],
    MJUsers_ExecutedByUserID.[Name] AS [ExecutedByUser]
FROM
    [${flyway:defaultSchema}].[ScheduledJobRun] AS m
INNER JOIN
    [${flyway:defaultSchema}].[ScheduledJob] AS MJScheduledJobs_ScheduledJobID
  ON
    [m].[ScheduledJobID] = MJScheduledJobs_ScheduledJobID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_ExecutedByUserID
  ON
    [m].[ExecutedByUserID] = MJUsers_ExecutedByUserID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwScheduledJobRuns] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Scheduled Job Runs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Scheduled Job Runs
-- Item: Permissions for vwScheduledJobRuns
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwScheduledJobRuns] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Scheduled Job Runs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Scheduled Job Runs
-- Item: spCreateMJScheduledJobRun
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR ScheduledJobRun
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJScheduledJobRun]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJScheduledJobRun];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJScheduledJobRun]
    @ID uniqueidentifier = NULL,
    @ScheduledJobID uniqueidentifier,
    @StartedAt datetimeoffset = NULL,
    @CompletedAt datetimeoffset,
    @Status nvarchar(20) = NULL,
    @Success bit,
    @ErrorMessage nvarchar(MAX),
    @Details nvarchar(MAX),
    @ExecutedByUserID uniqueidentifier,
    @QueuedAt datetimeoffset
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[ScheduledJobRun]
            (
                [ID],
                [ScheduledJobID],
                [StartedAt],
                [CompletedAt],
                [Status],
                [Success],
                [ErrorMessage],
                [Details],
                [ExecutedByUserID],
                [QueuedAt]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @ScheduledJobID,
                ISNULL(@StartedAt, sysdatetimeoffset()),
                @CompletedAt,
                ISNULL(@Status, 'Running'),
                @Success,
                @ErrorMessage,
                @Details,
                @ExecutedByUserID,
                @QueuedAt
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[ScheduledJobRun]
            (
                [ScheduledJobID],
                [StartedAt],
                [CompletedAt],
                [Status],
                [Success],
                [ErrorMessage],
                [Details],
                [ExecutedByUserID],
                [QueuedAt]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ScheduledJobID,
                ISNULL(@StartedAt, sysdatetimeoffset()),
                @CompletedAt,
                ISNULL(@Status, 'Running'),
                @Success,
                @ErrorMessage,
                @Details,
                @ExecutedByUserID,
                @QueuedAt
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwScheduledJobRuns] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJScheduledJobRun] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Scheduled Job Runs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJScheduledJobRun] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Scheduled Job Runs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Scheduled Job Runs
-- Item: spUpdateMJScheduledJobRun
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR ScheduledJobRun
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJScheduledJobRun]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJScheduledJobRun];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJScheduledJobRun]
    @ID uniqueidentifier,
    @ScheduledJobID uniqueidentifier,
    @StartedAt datetimeoffset,
    @CompletedAt datetimeoffset,
    @Status nvarchar(20),
    @Success bit,
    @ErrorMessage nvarchar(MAX),
    @Details nvarchar(MAX),
    @ExecutedByUserID uniqueidentifier,
    @QueuedAt datetimeoffset
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ScheduledJobRun]
    SET
        [ScheduledJobID] = @ScheduledJobID,
        [StartedAt] = @StartedAt,
        [CompletedAt] = @CompletedAt,
        [Status] = @Status,
        [Success] = @Success,
        [ErrorMessage] = @ErrorMessage,
        [Details] = @Details,
        [ExecutedByUserID] = @ExecutedByUserID,
        [QueuedAt] = @QueuedAt
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwScheduledJobRuns] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwScheduledJobRuns]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJScheduledJobRun] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the ScheduledJobRun table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJScheduledJobRun]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJScheduledJobRun];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJScheduledJobRun
ON [${flyway:defaultSchema}].[ScheduledJobRun]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[ScheduledJobRun]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[ScheduledJobRun] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Scheduled Job Runs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJScheduledJobRun] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Scheduled Job Runs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Scheduled Job Runs
-- Item: spDeleteMJScheduledJobRun
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR ScheduledJobRun
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJScheduledJobRun]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJScheduledJobRun];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJScheduledJobRun]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[ScheduledJobRun]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJScheduledJobRun] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Scheduled Job Runs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJScheduledJobRun] TO [cdp_Integration]



/* Base View SQL for MJ: Skills */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Skills
-- Item: vwSkills
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Skills
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  Skill
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwSkills]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwSkills];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwSkills]
AS
SELECT
    m.*,
    MJSkills_ParentID.[Name] AS [Parent],
    root_ParentID.RootID AS [RootParentID]
FROM
    [${flyway:defaultSchema}].[Skill] AS m
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[Skill] AS MJSkills_ParentID
  ON
    [m].[ParentID] = MJSkills_ParentID.[ID]
OUTER APPLY
    [${flyway:defaultSchema}].[fnSkillParentID_GetRootID]([m].[ID], [m].[ParentID]) AS root_ParentID
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwSkills] TO [cdp_Developer], [cdp_Integration], [cdp_UI]
    

/* Base View Permissions SQL for MJ: Skills */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Skills
-- Item: Permissions for vwSkills
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwSkills] TO [cdp_Developer], [cdp_Integration], [cdp_UI]

/* spCreate SQL for MJ: Skills */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Skills
-- Item: spCreateMJSkill
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR Skill
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJSkill]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJSkill];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJSkill]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(50),
    @ParentID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[Skill]
            (
                [ID],
                [Name],
                [ParentID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @ParentID
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[Skill]
            (
                [Name],
                [ParentID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @ParentID
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwSkills] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJSkill] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Skills */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJSkill] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Skills */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Skills
-- Item: spUpdateMJSkill
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR Skill
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJSkill]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJSkill];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJSkill]
    @ID uniqueidentifier,
    @Name nvarchar(50),
    @ParentID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[Skill]
    SET
        [Name] = @Name,
        [ParentID] = @ParentID
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwSkills] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwSkills]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJSkill] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the Skill table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJSkill]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJSkill];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJSkill
ON [${flyway:defaultSchema}].[Skill]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[Skill]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[Skill] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Skills */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJSkill] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Skills */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Skills
-- Item: spDeleteMJSkill
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR Skill
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJSkill]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJSkill];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJSkill]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[Skill]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJSkill] TO [cdp_Developer], [cdp_Integration]
    

/* spDelete Permissions for MJ: Skills */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJSkill] TO [cdp_Developer], [cdp_Integration]



/* Base View SQL for MJ: Task Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Task Types
-- Item: vwTaskTypes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Task Types
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  TaskType
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwTaskTypes]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwTaskTypes];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwTaskTypes]
AS
SELECT
    m.*
FROM
    [${flyway:defaultSchema}].[TaskType] AS m
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwTaskTypes] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Task Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Task Types
-- Item: Permissions for vwTaskTypes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwTaskTypes] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Task Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Task Types
-- Item: spCreateMJTaskType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR TaskType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJTaskType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJTaskType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJTaskType]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(255),
    @Description nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[TaskType]
            (
                [ID],
                [Name],
                [Description]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[TaskType]
            (
                [Name],
                [Description]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwTaskTypes] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJTaskType] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Task Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJTaskType] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Task Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Task Types
-- Item: spUpdateMJTaskType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR TaskType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJTaskType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJTaskType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJTaskType]
    @ID uniqueidentifier,
    @Name nvarchar(255),
    @Description nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[TaskType]
    SET
        [Name] = @Name,
        [Description] = @Description
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwTaskTypes] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwTaskTypes]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJTaskType] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the TaskType table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJTaskType]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJTaskType];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJTaskType
ON [${flyway:defaultSchema}].[TaskType]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[TaskType]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[TaskType] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Task Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJTaskType] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Task Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Task Types
-- Item: spDeleteMJTaskType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR TaskType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJTaskType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJTaskType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJTaskType]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[TaskType]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJTaskType] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Task Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJTaskType] TO [cdp_Integration]



/* Base View SQL for MJ: Task Dependencies */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Task Dependencies
-- Item: vwTaskDependencies
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Task Dependencies
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  TaskDependency
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwTaskDependencies]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwTaskDependencies];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwTaskDependencies]
AS
SELECT
    m.*,
    MJTasks_TaskID.[Name] AS [Task],
    MJTasks_DependsOnTaskID.[Name] AS [DependsOnTask]
FROM
    [${flyway:defaultSchema}].[TaskDependency] AS m
INNER JOIN
    [${flyway:defaultSchema}].[Task] AS MJTasks_TaskID
  ON
    [m].[TaskID] = MJTasks_TaskID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[Task] AS MJTasks_DependsOnTaskID
  ON
    [m].[DependsOnTaskID] = MJTasks_DependsOnTaskID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwTaskDependencies] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Task Dependencies */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Task Dependencies
-- Item: Permissions for vwTaskDependencies
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwTaskDependencies] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Task Dependencies */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Task Dependencies
-- Item: spCreateMJTaskDependency
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR TaskDependency
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJTaskDependency]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJTaskDependency];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJTaskDependency]
    @ID uniqueidentifier = NULL,
    @TaskID uniqueidentifier,
    @DependsOnTaskID uniqueidentifier,
    @DependencyType nvarchar(50) = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[TaskDependency]
            (
                [ID],
                [TaskID],
                [DependsOnTaskID],
                [DependencyType]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @TaskID,
                @DependsOnTaskID,
                ISNULL(@DependencyType, 'Prerequisite')
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[TaskDependency]
            (
                [TaskID],
                [DependsOnTaskID],
                [DependencyType]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @TaskID,
                @DependsOnTaskID,
                ISNULL(@DependencyType, 'Prerequisite')
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwTaskDependencies] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJTaskDependency] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Task Dependencies */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJTaskDependency] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Task Dependencies */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Task Dependencies
-- Item: spUpdateMJTaskDependency
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR TaskDependency
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJTaskDependency]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJTaskDependency];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJTaskDependency]
    @ID uniqueidentifier,
    @TaskID uniqueidentifier,
    @DependsOnTaskID uniqueidentifier,
    @DependencyType nvarchar(50)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[TaskDependency]
    SET
        [TaskID] = @TaskID,
        [DependsOnTaskID] = @DependsOnTaskID,
        [DependencyType] = @DependencyType
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwTaskDependencies] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwTaskDependencies]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJTaskDependency] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the TaskDependency table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJTaskDependency]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJTaskDependency];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJTaskDependency
ON [${flyway:defaultSchema}].[TaskDependency]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[TaskDependency]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[TaskDependency] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Task Dependencies */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJTaskDependency] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Task Dependencies */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Task Dependencies
-- Item: spDeleteMJTaskDependency
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR TaskDependency
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJTaskDependency]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJTaskDependency];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJTaskDependency]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[TaskDependency]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJTaskDependency] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Task Dependencies */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJTaskDependency] TO [cdp_Integration]



/* Base View SQL for MJ: Tags */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Tags
-- Item: vwTags
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Tags
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  Tag
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwTags]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwTags];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwTags]
AS
SELECT
    m.*,
    MJTags_ParentID.[Name] AS [Parent],
    root_ParentID.RootID AS [RootParentID]
FROM
    [${flyway:defaultSchema}].[Tag] AS m
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[Tag] AS MJTags_ParentID
  ON
    [m].[ParentID] = MJTags_ParentID.[ID]
OUTER APPLY
    [${flyway:defaultSchema}].[fnTagParentID_GetRootID]([m].[ID], [m].[ParentID]) AS root_ParentID
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwTags] TO [cdp_UI]
    

/* Base View Permissions SQL for MJ: Tags */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Tags
-- Item: Permissions for vwTags
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwTags] TO [cdp_UI]

/* spCreate SQL for MJ: Tags */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Tags
-- Item: spCreateMJTag
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR Tag
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJTag]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJTag];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJTag]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(255),
    @ParentID uniqueidentifier,
    @DisplayName nvarchar(255),
    @Description nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[Tag]
            (
                [ID],
                [Name],
                [ParentID],
                [DisplayName],
                [Description]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @ParentID,
                @DisplayName,
                @Description
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[Tag]
            (
                [Name],
                [ParentID],
                [DisplayName],
                [Description]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @ParentID,
                @DisplayName,
                @Description
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwTags] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJTag] TO [cdp_UI]
    

/* spCreate Permissions for MJ: Tags */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJTag] TO [cdp_UI]



/* spUpdate SQL for MJ: Tags */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Tags
-- Item: spUpdateMJTag
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR Tag
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJTag]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJTag];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJTag]
    @ID uniqueidentifier,
    @Name nvarchar(255),
    @ParentID uniqueidentifier,
    @DisplayName nvarchar(255),
    @Description nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[Tag]
    SET
        [Name] = @Name,
        [ParentID] = @ParentID,
        [DisplayName] = @DisplayName,
        [Description] = @Description
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwTags] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwTags]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJTag] TO [cdp_UI]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the Tag table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJTag]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJTag];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJTag
ON [${flyway:defaultSchema}].[Tag]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[Tag]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[Tag] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Tags */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJTag] TO [cdp_UI]



/* spDelete SQL for MJ: Tags */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Tags
-- Item: spDeleteMJTag
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR Tag
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJTag]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJTag];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJTag]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[Tag]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJTag] TO [cdp_UI]
    

/* spDelete Permissions for MJ: Tags */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJTag] TO [cdp_UI]



/* Base View SQL for MJ: Tagged Items */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Tagged Items
-- Item: vwTaggedItems
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Tagged Items
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  TaggedItem
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwTaggedItems]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwTaggedItems];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwTaggedItems]
AS
SELECT
    m.*,
    MJTags_TagID.[Name] AS [Tag],
    MJEntities_EntityID.[Name] AS [Entity]
FROM
    [${flyway:defaultSchema}].[TaggedItem] AS m
INNER JOIN
    [${flyway:defaultSchema}].[Tag] AS MJTags_TagID
  ON
    [m].[TagID] = MJTags_TagID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[Entity] AS MJEntities_EntityID
  ON
    [m].[EntityID] = MJEntities_EntityID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwTaggedItems] TO [cdp_UI]
    

/* Base View Permissions SQL for MJ: Tagged Items */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Tagged Items
-- Item: Permissions for vwTaggedItems
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwTaggedItems] TO [cdp_UI]

/* spCreate SQL for MJ: Tagged Items */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Tagged Items
-- Item: spCreateMJTaggedItem
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR TaggedItem
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJTaggedItem]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJTaggedItem];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJTaggedItem]
    @ID uniqueidentifier = NULL,
    @TagID uniqueidentifier,
    @EntityID uniqueidentifier,
    @RecordID nvarchar(450)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[TaggedItem]
            (
                [ID],
                [TagID],
                [EntityID],
                [RecordID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @TagID,
                @EntityID,
                @RecordID
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[TaggedItem]
            (
                [TagID],
                [EntityID],
                [RecordID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @TagID,
                @EntityID,
                @RecordID
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwTaggedItems] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJTaggedItem] TO [cdp_UI]
    

/* spCreate Permissions for MJ: Tagged Items */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJTaggedItem] TO [cdp_UI]



/* spUpdate SQL for MJ: Tagged Items */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Tagged Items
-- Item: spUpdateMJTaggedItem
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR TaggedItem
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJTaggedItem]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJTaggedItem];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJTaggedItem]
    @ID uniqueidentifier,
    @TagID uniqueidentifier,
    @EntityID uniqueidentifier,
    @RecordID nvarchar(450)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[TaggedItem]
    SET
        [TagID] = @TagID,
        [EntityID] = @EntityID,
        [RecordID] = @RecordID
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwTaggedItems] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwTaggedItems]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJTaggedItem] TO [cdp_UI]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the TaggedItem table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJTaggedItem]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJTaggedItem];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJTaggedItem
ON [${flyway:defaultSchema}].[TaggedItem]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[TaggedItem]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[TaggedItem] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Tagged Items */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJTaggedItem] TO [cdp_UI]



/* spDelete SQL for MJ: Tagged Items */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Tagged Items
-- Item: spDeleteMJTaggedItem
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR TaggedItem
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJTaggedItem]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJTaggedItem];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJTaggedItem]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[TaggedItem]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJTaggedItem] TO [cdp_UI]
    

/* spDelete Permissions for MJ: Tagged Items */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJTaggedItem] TO [cdp_UI]



/* Base View SQL for MJ: Tasks */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Tasks
-- Item: vwTasks
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Tasks
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  Task
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwTasks]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwTasks];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwTasks]
AS
SELECT
    m.*,
    MJTasks_ParentID.[Name] AS [Parent],
    MJTaskTypes_TypeID.[Name] AS [Type],
    MJEnvironments_EnvironmentID.[Name] AS [Environment],
    MJProjects_ProjectID.[Name] AS [Project],
    MJConversationDetails_ConversationDetailID.[Message] AS [ConversationDetail],
    MJUsers_UserID.[Name] AS [User],
    MJAIAgents_AgentID.[Name] AS [Agent],
    root_ParentID.RootID AS [RootParentID]
FROM
    [${flyway:defaultSchema}].[Task] AS m
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[Task] AS MJTasks_ParentID
  ON
    [m].[ParentID] = MJTasks_ParentID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[TaskType] AS MJTaskTypes_TypeID
  ON
    [m].[TypeID] = MJTaskTypes_TypeID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[Environment] AS MJEnvironments_EnvironmentID
  ON
    [m].[EnvironmentID] = MJEnvironments_EnvironmentID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[Project] AS MJProjects_ProjectID
  ON
    [m].[ProjectID] = MJProjects_ProjectID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[ConversationDetail] AS MJConversationDetails_ConversationDetailID
  ON
    [m].[ConversationDetailID] = MJConversationDetails_ConversationDetailID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_UserID
  ON
    [m].[UserID] = MJUsers_UserID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[AIAgent] AS MJAIAgents_AgentID
  ON
    [m].[AgentID] = MJAIAgents_AgentID.[ID]
OUTER APPLY
    [${flyway:defaultSchema}].[fnTaskParentID_GetRootID]([m].[ID], [m].[ParentID]) AS root_ParentID
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwTasks] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Tasks */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Tasks
-- Item: Permissions for vwTasks
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwTasks] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Tasks */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Tasks
-- Item: spCreateMJTask
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR Task
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJTask]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJTask];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJTask]
    @ID uniqueidentifier = NULL,
    @ParentID uniqueidentifier,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @TypeID uniqueidentifier,
    @EnvironmentID uniqueidentifier = NULL,
    @ProjectID uniqueidentifier,
    @ConversationDetailID uniqueidentifier,
    @UserID uniqueidentifier,
    @AgentID uniqueidentifier,
    @Status nvarchar(50) = NULL,
    @PercentComplete int,
    @DueAt datetimeoffset,
    @StartedAt datetimeoffset,
    @CompletedAt datetimeoffset
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[Task]
            (
                [ID],
                [ParentID],
                [Name],
                [Description],
                [TypeID],
                [EnvironmentID],
                [ProjectID],
                [ConversationDetailID],
                [UserID],
                [AgentID],
                [Status],
                [PercentComplete],
                [DueAt],
                [StartedAt],
                [CompletedAt]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @ParentID,
                @Name,
                @Description,
                @TypeID,
                CASE @EnvironmentID WHEN '00000000-0000-0000-0000-000000000000' THEN 'F51358F3-9447-4176-B313-BF8025FD8D09' ELSE ISNULL(@EnvironmentID, 'F51358F3-9447-4176-B313-BF8025FD8D09') END,
                @ProjectID,
                @ConversationDetailID,
                @UserID,
                @AgentID,
                ISNULL(@Status, 'Pending'),
                @PercentComplete,
                @DueAt,
                @StartedAt,
                @CompletedAt
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[Task]
            (
                [ParentID],
                [Name],
                [Description],
                [TypeID],
                [EnvironmentID],
                [ProjectID],
                [ConversationDetailID],
                [UserID],
                [AgentID],
                [Status],
                [PercentComplete],
                [DueAt],
                [StartedAt],
                [CompletedAt]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ParentID,
                @Name,
                @Description,
                @TypeID,
                CASE @EnvironmentID WHEN '00000000-0000-0000-0000-000000000000' THEN 'F51358F3-9447-4176-B313-BF8025FD8D09' ELSE ISNULL(@EnvironmentID, 'F51358F3-9447-4176-B313-BF8025FD8D09') END,
                @ProjectID,
                @ConversationDetailID,
                @UserID,
                @AgentID,
                ISNULL(@Status, 'Pending'),
                @PercentComplete,
                @DueAt,
                @StartedAt,
                @CompletedAt
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwTasks] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJTask] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Tasks */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJTask] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Tasks */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Tasks
-- Item: spUpdateMJTask
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR Task
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJTask]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJTask];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJTask]
    @ID uniqueidentifier,
    @ParentID uniqueidentifier,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @TypeID uniqueidentifier,
    @EnvironmentID uniqueidentifier,
    @ProjectID uniqueidentifier,
    @ConversationDetailID uniqueidentifier,
    @UserID uniqueidentifier,
    @AgentID uniqueidentifier,
    @Status nvarchar(50),
    @PercentComplete int,
    @DueAt datetimeoffset,
    @StartedAt datetimeoffset,
    @CompletedAt datetimeoffset
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[Task]
    SET
        [ParentID] = @ParentID,
        [Name] = @Name,
        [Description] = @Description,
        [TypeID] = @TypeID,
        [EnvironmentID] = @EnvironmentID,
        [ProjectID] = @ProjectID,
        [ConversationDetailID] = @ConversationDetailID,
        [UserID] = @UserID,
        [AgentID] = @AgentID,
        [Status] = @Status,
        [PercentComplete] = @PercentComplete,
        [DueAt] = @DueAt,
        [StartedAt] = @StartedAt,
        [CompletedAt] = @CompletedAt
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwTasks] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwTasks]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJTask] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the Task table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJTask]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJTask];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJTask
ON [${flyway:defaultSchema}].[Task]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[Task]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[Task] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Tasks */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJTask] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Tasks */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Tasks
-- Item: spDeleteMJTask
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR Task
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJTask]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJTask];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJTask]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[Task]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJTask] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Tasks */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJTask] TO [cdp_Integration]



/* Base View SQL for MJ: Templates */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Templates
-- Item: vwTemplates
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Templates
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  Template
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwTemplates]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwTemplates];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwTemplates]
AS
SELECT
    m.*,
    MJTemplateCategories_CategoryID.[Name] AS [Category],
    MJUsers_UserID.[Name] AS [User]
FROM
    [${flyway:defaultSchema}].[Template] AS m
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[TemplateCategory] AS MJTemplateCategories_CategoryID
  ON
    [m].[CategoryID] = MJTemplateCategories_CategoryID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_UserID
  ON
    [m].[UserID] = MJUsers_UserID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwTemplates] TO [cdp_Developer], [cdp_UI], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Templates */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Templates
-- Item: Permissions for vwTemplates
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwTemplates] TO [cdp_Developer], [cdp_UI], [cdp_Integration]

/* spCreate SQL for MJ: Templates */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Templates
-- Item: spCreateMJTemplate
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR Template
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJTemplate]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJTemplate];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJTemplate]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @CategoryID uniqueidentifier,
    @UserPrompt nvarchar(MAX),
    @UserID uniqueidentifier,
    @ActiveAt datetimeoffset,
    @DisabledAt datetimeoffset,
    @IsActive bit = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[Template]
            (
                [ID],
                [Name],
                [Description],
                [CategoryID],
                [UserPrompt],
                [UserID],
                [ActiveAt],
                [DisabledAt],
                [IsActive]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description,
                @CategoryID,
                @UserPrompt,
                @UserID,
                @ActiveAt,
                @DisabledAt,
                ISNULL(@IsActive, 1)
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[Template]
            (
                [Name],
                [Description],
                [CategoryID],
                [UserPrompt],
                [UserID],
                [ActiveAt],
                [DisabledAt],
                [IsActive]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description,
                @CategoryID,
                @UserPrompt,
                @UserID,
                @ActiveAt,
                @DisabledAt,
                ISNULL(@IsActive, 1)
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwTemplates] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJTemplate] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Templates */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJTemplate] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Templates */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Templates
-- Item: spUpdateMJTemplate
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR Template
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJTemplate]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJTemplate];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJTemplate]
    @ID uniqueidentifier,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @CategoryID uniqueidentifier,
    @UserPrompt nvarchar(MAX),
    @UserID uniqueidentifier,
    @ActiveAt datetimeoffset,
    @DisabledAt datetimeoffset,
    @IsActive bit
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[Template]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [CategoryID] = @CategoryID,
        [UserPrompt] = @UserPrompt,
        [UserID] = @UserID,
        [ActiveAt] = @ActiveAt,
        [DisabledAt] = @DisabledAt,
        [IsActive] = @IsActive
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwTemplates] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwTemplates]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJTemplate] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the Template table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJTemplate]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJTemplate];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJTemplate
ON [${flyway:defaultSchema}].[Template]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[Template]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[Template] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Templates */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJTemplate] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Templates */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Templates
-- Item: spDeleteMJTemplate
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR Template
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJTemplate]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJTemplate];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJTemplate]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[Template]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJTemplate] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Templates */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJTemplate] TO [cdp_Integration]



/* Base View SQL for MJ: Template Content Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Template Content Types
-- Item: vwTemplateContentTypes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Template Content Types
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  TemplateContentType
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwTemplateContentTypes]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwTemplateContentTypes];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwTemplateContentTypes]
AS
SELECT
    m.*
FROM
    [${flyway:defaultSchema}].[TemplateContentType] AS m
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwTemplateContentTypes] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Template Content Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Template Content Types
-- Item: Permissions for vwTemplateContentTypes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwTemplateContentTypes] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Template Content Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Template Content Types
-- Item: spCreateMJTemplateContentType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR TemplateContentType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJTemplateContentType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJTemplateContentType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJTemplateContentType]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @CodeType nvarchar(25) = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[TemplateContentType]
            (
                [ID],
                [Name],
                [Description],
                [CodeType]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description,
                ISNULL(@CodeType, 'Other')
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[TemplateContentType]
            (
                [Name],
                [Description],
                [CodeType]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description,
                ISNULL(@CodeType, 'Other')
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwTemplateContentTypes] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJTemplateContentType] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Template Content Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJTemplateContentType] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Template Content Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Template Content Types
-- Item: spUpdateMJTemplateContentType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR TemplateContentType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJTemplateContentType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJTemplateContentType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJTemplateContentType]
    @ID uniqueidentifier,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @CodeType nvarchar(25)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[TemplateContentType]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [CodeType] = @CodeType
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwTemplateContentTypes] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwTemplateContentTypes]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJTemplateContentType] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the TemplateContentType table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJTemplateContentType]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJTemplateContentType];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJTemplateContentType
ON [${flyway:defaultSchema}].[TemplateContentType]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[TemplateContentType]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[TemplateContentType] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Template Content Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJTemplateContentType] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Template Content Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Template Content Types
-- Item: spDeleteMJTemplateContentType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR TemplateContentType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJTemplateContentType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJTemplateContentType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJTemplateContentType]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[TemplateContentType]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJTemplateContentType] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Template Content Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJTemplateContentType] TO [cdp_Integration]



/* Base View SQL for MJ: Template Params */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Template Params
-- Item: vwTemplateParams
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Template Params
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  TemplateParam
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwTemplateParams]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwTemplateParams];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwTemplateParams]
AS
SELECT
    m.*,
    MJTemplates_TemplateID.[Name] AS [Template],
    MJEntities_EntityID.[Name] AS [Entity],
    MJTemplateContents_TemplateContentID.[Template] AS [TemplateContent]
FROM
    [${flyway:defaultSchema}].[TemplateParam] AS m
INNER JOIN
    [${flyway:defaultSchema}].[Template] AS MJTemplates_TemplateID
  ON
    [m].[TemplateID] = MJTemplates_TemplateID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[Entity] AS MJEntities_EntityID
  ON
    [m].[EntityID] = MJEntities_EntityID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[vwTemplateContents] AS MJTemplateContents_TemplateContentID
  ON
    [m].[TemplateContentID] = MJTemplateContents_TemplateContentID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwTemplateParams] TO [cdp_UI], [cdp_Integration], [cdp_Developer]
    

/* Base View Permissions SQL for MJ: Template Params */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Template Params
-- Item: Permissions for vwTemplateParams
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwTemplateParams] TO [cdp_UI], [cdp_Integration], [cdp_Developer]

/* spCreate SQL for MJ: Template Params */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Template Params
-- Item: spCreateMJTemplateParam
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR TemplateParam
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJTemplateParam]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJTemplateParam];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJTemplateParam]
    @ID uniqueidentifier = NULL,
    @TemplateID uniqueidentifier,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @Type nvarchar(20) = NULL,
    @DefaultValue nvarchar(MAX),
    @IsRequired bit = NULL,
    @LinkedParameterName nvarchar(255),
    @LinkedParameterField nvarchar(500),
    @ExtraFilter nvarchar(MAX),
    @EntityID uniqueidentifier,
    @RecordID nvarchar(2000),
    @OrderBy nvarchar(MAX),
    @TemplateContentID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[TemplateParam]
            (
                [ID],
                [TemplateID],
                [Name],
                [Description],
                [Type],
                [DefaultValue],
                [IsRequired],
                [LinkedParameterName],
                [LinkedParameterField],
                [ExtraFilter],
                [EntityID],
                [RecordID],
                [OrderBy],
                [TemplateContentID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @TemplateID,
                @Name,
                @Description,
                ISNULL(@Type, 'Scalar'),
                @DefaultValue,
                ISNULL(@IsRequired, 0),
                @LinkedParameterName,
                @LinkedParameterField,
                @ExtraFilter,
                @EntityID,
                @RecordID,
                @OrderBy,
                @TemplateContentID
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[TemplateParam]
            (
                [TemplateID],
                [Name],
                [Description],
                [Type],
                [DefaultValue],
                [IsRequired],
                [LinkedParameterName],
                [LinkedParameterField],
                [ExtraFilter],
                [EntityID],
                [RecordID],
                [OrderBy],
                [TemplateContentID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @TemplateID,
                @Name,
                @Description,
                ISNULL(@Type, 'Scalar'),
                @DefaultValue,
                ISNULL(@IsRequired, 0),
                @LinkedParameterName,
                @LinkedParameterField,
                @ExtraFilter,
                @EntityID,
                @RecordID,
                @OrderBy,
                @TemplateContentID
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwTemplateParams] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJTemplateParam] TO [cdp_Integration], [cdp_Developer]
    

/* spCreate Permissions for MJ: Template Params */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJTemplateParam] TO [cdp_Integration], [cdp_Developer]



/* spUpdate SQL for MJ: Template Params */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Template Params
-- Item: spUpdateMJTemplateParam
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR TemplateParam
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJTemplateParam]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJTemplateParam];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJTemplateParam]
    @ID uniqueidentifier,
    @TemplateID uniqueidentifier,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @Type nvarchar(20),
    @DefaultValue nvarchar(MAX),
    @IsRequired bit,
    @LinkedParameterName nvarchar(255),
    @LinkedParameterField nvarchar(500),
    @ExtraFilter nvarchar(MAX),
    @EntityID uniqueidentifier,
    @RecordID nvarchar(2000),
    @OrderBy nvarchar(MAX),
    @TemplateContentID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[TemplateParam]
    SET
        [TemplateID] = @TemplateID,
        [Name] = @Name,
        [Description] = @Description,
        [Type] = @Type,
        [DefaultValue] = @DefaultValue,
        [IsRequired] = @IsRequired,
        [LinkedParameterName] = @LinkedParameterName,
        [LinkedParameterField] = @LinkedParameterField,
        [ExtraFilter] = @ExtraFilter,
        [EntityID] = @EntityID,
        [RecordID] = @RecordID,
        [OrderBy] = @OrderBy,
        [TemplateContentID] = @TemplateContentID
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwTemplateParams] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwTemplateParams]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJTemplateParam] TO [cdp_Integration], [cdp_Developer]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the TemplateParam table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJTemplateParam]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJTemplateParam];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJTemplateParam
ON [${flyway:defaultSchema}].[TemplateParam]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[TemplateParam]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[TemplateParam] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Template Params */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJTemplateParam] TO [cdp_Integration], [cdp_Developer]



/* spDelete SQL for MJ: Template Params */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Template Params
-- Item: spDeleteMJTemplateParam
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR TemplateParam
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJTemplateParam]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJTemplateParam];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJTemplateParam]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[TemplateParam]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJTemplateParam] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Template Params */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJTemplateParam] TO [cdp_Integration]



/* Base View SQL for MJ: Template Contents */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Template Contents
-- Item: vwTemplateContents
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Template Contents
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  TemplateContent
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwTemplateContents]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwTemplateContents];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwTemplateContents]
AS
SELECT
    m.*,
    MJTemplates_TemplateID.[Name] AS [Template],
    MJTemplateContentTypes_TypeID.[Name] AS [Type]
FROM
    [${flyway:defaultSchema}].[TemplateContent] AS m
INNER JOIN
    [${flyway:defaultSchema}].[Template] AS MJTemplates_TemplateID
  ON
    [m].[TemplateID] = MJTemplates_TemplateID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[TemplateContentType] AS MJTemplateContentTypes_TypeID
  ON
    [m].[TypeID] = MJTemplateContentTypes_TypeID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwTemplateContents] TO [cdp_Integration], [cdp_UI], [cdp_Developer]
    

/* Base View Permissions SQL for MJ: Template Contents */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Template Contents
-- Item: Permissions for vwTemplateContents
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwTemplateContents] TO [cdp_Integration], [cdp_UI], [cdp_Developer]

/* spCreate SQL for MJ: Template Contents */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Template Contents
-- Item: spCreateMJTemplateContent
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR TemplateContent
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJTemplateContent]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJTemplateContent];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJTemplateContent]
    @ID uniqueidentifier = NULL,
    @TemplateID uniqueidentifier,
    @TypeID uniqueidentifier,
    @TemplateText nvarchar(MAX),
    @Priority int,
    @IsActive bit = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[TemplateContent]
            (
                [ID],
                [TemplateID],
                [TypeID],
                [TemplateText],
                [Priority],
                [IsActive]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @TemplateID,
                @TypeID,
                @TemplateText,
                @Priority,
                ISNULL(@IsActive, 1)
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[TemplateContent]
            (
                [TemplateID],
                [TypeID],
                [TemplateText],
                [Priority],
                [IsActive]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @TemplateID,
                @TypeID,
                @TemplateText,
                @Priority,
                ISNULL(@IsActive, 1)
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwTemplateContents] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJTemplateContent] TO [cdp_Integration], [cdp_Developer]
    

/* spCreate Permissions for MJ: Template Contents */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJTemplateContent] TO [cdp_Integration], [cdp_Developer]



/* spUpdate SQL for MJ: Template Contents */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Template Contents
-- Item: spUpdateMJTemplateContent
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR TemplateContent
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJTemplateContent]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJTemplateContent];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJTemplateContent]
    @ID uniqueidentifier,
    @TemplateID uniqueidentifier,
    @TypeID uniqueidentifier,
    @TemplateText nvarchar(MAX),
    @Priority int,
    @IsActive bit
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[TemplateContent]
    SET
        [TemplateID] = @TemplateID,
        [TypeID] = @TypeID,
        [TemplateText] = @TemplateText,
        [Priority] = @Priority,
        [IsActive] = @IsActive
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwTemplateContents] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwTemplateContents]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJTemplateContent] TO [cdp_Integration], [cdp_UI], [cdp_Developer]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the TemplateContent table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJTemplateContent]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJTemplateContent];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJTemplateContent
ON [${flyway:defaultSchema}].[TemplateContent]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[TemplateContent]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[TemplateContent] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Template Contents */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJTemplateContent] TO [cdp_Integration], [cdp_UI], [cdp_Developer]



/* spDelete SQL for MJ: Template Contents */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Template Contents
-- Item: spDeleteMJTemplateContent
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR TemplateContent
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJTemplateContent]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJTemplateContent];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJTemplateContent]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[TemplateContent]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJTemplateContent] TO [cdp_Integration], [cdp_UI], [cdp_Developer]
    

/* spDelete Permissions for MJ: Template Contents */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJTemplateContent] TO [cdp_Integration], [cdp_UI], [cdp_Developer]



/* Base View SQL for MJ: Template Categories */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Template Categories
-- Item: vwTemplateCategories
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Template Categories
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  TemplateCategory
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwTemplateCategories]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwTemplateCategories];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwTemplateCategories]
AS
SELECT
    m.*,
    MJTemplateCategories_ParentID.[Name] AS [Parent],
    MJUsers_UserID.[Name] AS [User],
    root_ParentID.RootID AS [RootParentID]
FROM
    [${flyway:defaultSchema}].[TemplateCategory] AS m
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[TemplateCategory] AS MJTemplateCategories_ParentID
  ON
    [m].[ParentID] = MJTemplateCategories_ParentID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_UserID
  ON
    [m].[UserID] = MJUsers_UserID.[ID]
OUTER APPLY
    [${flyway:defaultSchema}].[fnTemplateCategoryParentID_GetRootID]([m].[ID], [m].[ParentID]) AS root_ParentID
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwTemplateCategories] TO [cdp_Integration], [cdp_UI], [cdp_Developer]
    

/* Base View Permissions SQL for MJ: Template Categories */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Template Categories
-- Item: Permissions for vwTemplateCategories
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwTemplateCategories] TO [cdp_Integration], [cdp_UI], [cdp_Developer]

/* spCreate SQL for MJ: Template Categories */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Template Categories
-- Item: spCreateMJTemplateCategory
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR TemplateCategory
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJTemplateCategory]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJTemplateCategory];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJTemplateCategory]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @ParentID uniqueidentifier,
    @UserID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[TemplateCategory]
            (
                [ID],
                [Name],
                [Description],
                [ParentID],
                [UserID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description,
                @ParentID,
                @UserID
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[TemplateCategory]
            (
                [Name],
                [Description],
                [ParentID],
                [UserID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description,
                @ParentID,
                @UserID
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwTemplateCategories] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJTemplateCategory] TO [cdp_Integration], [cdp_Developer]
    

/* spCreate Permissions for MJ: Template Categories */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJTemplateCategory] TO [cdp_Integration], [cdp_Developer]



/* spUpdate SQL for MJ: Template Categories */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Template Categories
-- Item: spUpdateMJTemplateCategory
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR TemplateCategory
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJTemplateCategory]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJTemplateCategory];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJTemplateCategory]
    @ID uniqueidentifier,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @ParentID uniqueidentifier,
    @UserID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[TemplateCategory]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [ParentID] = @ParentID,
        [UserID] = @UserID
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwTemplateCategories] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwTemplateCategories]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJTemplateCategory] TO [cdp_Integration], [cdp_Developer]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the TemplateCategory table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJTemplateCategory]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJTemplateCategory];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJTemplateCategory
ON [${flyway:defaultSchema}].[TemplateCategory]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[TemplateCategory]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[TemplateCategory] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Template Categories */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJTemplateCategory] TO [cdp_Integration], [cdp_Developer]



/* spDelete SQL for MJ: Template Categories */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Template Categories
-- Item: spDeleteMJTemplateCategory
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR TemplateCategory
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJTemplateCategory]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJTemplateCategory];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJTemplateCategory]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[TemplateCategory]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJTemplateCategory] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Template Categories */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJTemplateCategory] TO [cdp_Integration]



/* Base View SQL for MJ: Test Suite Runs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Test Suite Runs
-- Item: vwTestSuiteRuns
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Test Suite Runs
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  TestSuiteRun
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwTestSuiteRuns]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwTestSuiteRuns];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwTestSuiteRuns]
AS
SELECT
    m.*,
    MJTestSuites_SuiteID.[Name] AS [Suite],
    MJUsers_RunByUserID.[Name] AS [RunByUser]
FROM
    [${flyway:defaultSchema}].[TestSuiteRun] AS m
INNER JOIN
    [${flyway:defaultSchema}].[TestSuite] AS MJTestSuites_SuiteID
  ON
    [m].[SuiteID] = MJTestSuites_SuiteID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_RunByUserID
  ON
    [m].[RunByUserID] = MJUsers_RunByUserID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwTestSuiteRuns] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Test Suite Runs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Test Suite Runs
-- Item: Permissions for vwTestSuiteRuns
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwTestSuiteRuns] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Test Suite Runs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Test Suite Runs
-- Item: spCreateMJTestSuiteRun
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR TestSuiteRun
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJTestSuiteRun]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJTestSuiteRun];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJTestSuiteRun]
    @ID uniqueidentifier = NULL,
    @SuiteID uniqueidentifier,
    @RunByUserID uniqueidentifier,
    @Environment nvarchar(50),
    @TriggerType nvarchar(50),
    @GitCommit nvarchar(100),
    @AgentVersion nvarchar(100),
    @Status nvarchar(20) = NULL,
    @StartedAt datetimeoffset,
    @CompletedAt datetimeoffset,
    @TotalTests int,
    @PassedTests int,
    @FailedTests int,
    @SkippedTests int,
    @ErrorTests int,
    @TotalDurationSeconds decimal(10, 3),
    @TotalCostUSD decimal(10, 6),
    @Configuration nvarchar(MAX),
    @ResultSummary nvarchar(MAX),
    @ErrorMessage nvarchar(MAX),
    @Tags nvarchar(MAX),
    @MachineName nvarchar(255),
    @MachineID nvarchar(255),
    @RunByUserName nvarchar(255),
    @RunByUserEmail nvarchar(255),
    @RunContextDetails nvarchar(MAX),
    @ResolvedVariables nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[TestSuiteRun]
            (
                [ID],
                [SuiteID],
                [RunByUserID],
                [Environment],
                [TriggerType],
                [GitCommit],
                [AgentVersion],
                [Status],
                [StartedAt],
                [CompletedAt],
                [TotalTests],
                [PassedTests],
                [FailedTests],
                [SkippedTests],
                [ErrorTests],
                [TotalDurationSeconds],
                [TotalCostUSD],
                [Configuration],
                [ResultSummary],
                [ErrorMessage],
                [Tags],
                [MachineName],
                [MachineID],
                [RunByUserName],
                [RunByUserEmail],
                [RunContextDetails],
                [ResolvedVariables]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @SuiteID,
                @RunByUserID,
                @Environment,
                @TriggerType,
                @GitCommit,
                @AgentVersion,
                ISNULL(@Status, 'Pending'),
                @StartedAt,
                @CompletedAt,
                @TotalTests,
                @PassedTests,
                @FailedTests,
                @SkippedTests,
                @ErrorTests,
                @TotalDurationSeconds,
                @TotalCostUSD,
                @Configuration,
                @ResultSummary,
                @ErrorMessage,
                @Tags,
                @MachineName,
                @MachineID,
                @RunByUserName,
                @RunByUserEmail,
                @RunContextDetails,
                @ResolvedVariables
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[TestSuiteRun]
            (
                [SuiteID],
                [RunByUserID],
                [Environment],
                [TriggerType],
                [GitCommit],
                [AgentVersion],
                [Status],
                [StartedAt],
                [CompletedAt],
                [TotalTests],
                [PassedTests],
                [FailedTests],
                [SkippedTests],
                [ErrorTests],
                [TotalDurationSeconds],
                [TotalCostUSD],
                [Configuration],
                [ResultSummary],
                [ErrorMessage],
                [Tags],
                [MachineName],
                [MachineID],
                [RunByUserName],
                [RunByUserEmail],
                [RunContextDetails],
                [ResolvedVariables]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @SuiteID,
                @RunByUserID,
                @Environment,
                @TriggerType,
                @GitCommit,
                @AgentVersion,
                ISNULL(@Status, 'Pending'),
                @StartedAt,
                @CompletedAt,
                @TotalTests,
                @PassedTests,
                @FailedTests,
                @SkippedTests,
                @ErrorTests,
                @TotalDurationSeconds,
                @TotalCostUSD,
                @Configuration,
                @ResultSummary,
                @ErrorMessage,
                @Tags,
                @MachineName,
                @MachineID,
                @RunByUserName,
                @RunByUserEmail,
                @RunContextDetails,
                @ResolvedVariables
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwTestSuiteRuns] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJTestSuiteRun] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Test Suite Runs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJTestSuiteRun] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Test Suite Runs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Test Suite Runs
-- Item: spUpdateMJTestSuiteRun
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR TestSuiteRun
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJTestSuiteRun]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJTestSuiteRun];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJTestSuiteRun]
    @ID uniqueidentifier,
    @SuiteID uniqueidentifier,
    @RunByUserID uniqueidentifier,
    @Environment nvarchar(50),
    @TriggerType nvarchar(50),
    @GitCommit nvarchar(100),
    @AgentVersion nvarchar(100),
    @Status nvarchar(20),
    @StartedAt datetimeoffset,
    @CompletedAt datetimeoffset,
    @TotalTests int,
    @PassedTests int,
    @FailedTests int,
    @SkippedTests int,
    @ErrorTests int,
    @TotalDurationSeconds decimal(10, 3),
    @TotalCostUSD decimal(10, 6),
    @Configuration nvarchar(MAX),
    @ResultSummary nvarchar(MAX),
    @ErrorMessage nvarchar(MAX),
    @Tags nvarchar(MAX),
    @MachineName nvarchar(255),
    @MachineID nvarchar(255),
    @RunByUserName nvarchar(255),
    @RunByUserEmail nvarchar(255),
    @RunContextDetails nvarchar(MAX),
    @ResolvedVariables nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[TestSuiteRun]
    SET
        [SuiteID] = @SuiteID,
        [RunByUserID] = @RunByUserID,
        [Environment] = @Environment,
        [TriggerType] = @TriggerType,
        [GitCommit] = @GitCommit,
        [AgentVersion] = @AgentVersion,
        [Status] = @Status,
        [StartedAt] = @StartedAt,
        [CompletedAt] = @CompletedAt,
        [TotalTests] = @TotalTests,
        [PassedTests] = @PassedTests,
        [FailedTests] = @FailedTests,
        [SkippedTests] = @SkippedTests,
        [ErrorTests] = @ErrorTests,
        [TotalDurationSeconds] = @TotalDurationSeconds,
        [TotalCostUSD] = @TotalCostUSD,
        [Configuration] = @Configuration,
        [ResultSummary] = @ResultSummary,
        [ErrorMessage] = @ErrorMessage,
        [Tags] = @Tags,
        [MachineName] = @MachineName,
        [MachineID] = @MachineID,
        [RunByUserName] = @RunByUserName,
        [RunByUserEmail] = @RunByUserEmail,
        [RunContextDetails] = @RunContextDetails,
        [ResolvedVariables] = @ResolvedVariables
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwTestSuiteRuns] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwTestSuiteRuns]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJTestSuiteRun] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the TestSuiteRun table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJTestSuiteRun]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJTestSuiteRun];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJTestSuiteRun
ON [${flyway:defaultSchema}].[TestSuiteRun]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[TestSuiteRun]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[TestSuiteRun] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Test Suite Runs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJTestSuiteRun] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Test Suite Runs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Test Suite Runs
-- Item: spDeleteMJTestSuiteRun
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR TestSuiteRun
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJTestSuiteRun]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJTestSuiteRun];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJTestSuiteRun]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[TestSuiteRun]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJTestSuiteRun] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Test Suite Runs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJTestSuiteRun] TO [cdp_Integration]



/* Base View SQL for MJ: Test Rubrics */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Test Rubrics
-- Item: vwTestRubrics
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Test Rubrics
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  TestRubric
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwTestRubrics]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwTestRubrics];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwTestRubrics]
AS
SELECT
    m.*,
    MJTestTypes_TypeID.[Name] AS [Type]
FROM
    [${flyway:defaultSchema}].[TestRubric] AS m
INNER JOIN
    [${flyway:defaultSchema}].[TestType] AS MJTestTypes_TypeID
  ON
    [m].[TypeID] = MJTestTypes_TypeID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwTestRubrics] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Test Rubrics */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Test Rubrics
-- Item: Permissions for vwTestRubrics
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwTestRubrics] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Test Rubrics */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Test Rubrics
-- Item: spCreateMJTestRubric
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR TestRubric
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJTestRubric]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJTestRubric];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJTestRubric]
    @ID uniqueidentifier = NULL,
    @TypeID uniqueidentifier,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @PromptTemplate nvarchar(MAX),
    @Criteria nvarchar(MAX),
    @Version nvarchar(50),
    @Status nvarchar(20) = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[TestRubric]
            (
                [ID],
                [TypeID],
                [Name],
                [Description],
                [PromptTemplate],
                [Criteria],
                [Version],
                [Status]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @TypeID,
                @Name,
                @Description,
                @PromptTemplate,
                @Criteria,
                @Version,
                ISNULL(@Status, 'Active')
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[TestRubric]
            (
                [TypeID],
                [Name],
                [Description],
                [PromptTemplate],
                [Criteria],
                [Version],
                [Status]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @TypeID,
                @Name,
                @Description,
                @PromptTemplate,
                @Criteria,
                @Version,
                ISNULL(@Status, 'Active')
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwTestRubrics] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJTestRubric] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Test Rubrics */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJTestRubric] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Test Rubrics */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Test Rubrics
-- Item: spUpdateMJTestRubric
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR TestRubric
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJTestRubric]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJTestRubric];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJTestRubric]
    @ID uniqueidentifier,
    @TypeID uniqueidentifier,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @PromptTemplate nvarchar(MAX),
    @Criteria nvarchar(MAX),
    @Version nvarchar(50),
    @Status nvarchar(20)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[TestRubric]
    SET
        [TypeID] = @TypeID,
        [Name] = @Name,
        [Description] = @Description,
        [PromptTemplate] = @PromptTemplate,
        [Criteria] = @Criteria,
        [Version] = @Version,
        [Status] = @Status
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwTestRubrics] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwTestRubrics]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJTestRubric] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the TestRubric table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJTestRubric]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJTestRubric];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJTestRubric
ON [${flyway:defaultSchema}].[TestRubric]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[TestRubric]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[TestRubric] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Test Rubrics */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJTestRubric] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Test Rubrics */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Test Rubrics
-- Item: spDeleteMJTestRubric
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR TestRubric
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJTestRubric]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJTestRubric];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJTestRubric]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[TestRubric]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJTestRubric] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Test Rubrics */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJTestRubric] TO [cdp_Integration]



/* Base View SQL for MJ: Test Runs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Test Runs
-- Item: vwTestRuns
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Test Runs
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  TestRun
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwTestRuns]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwTestRuns];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwTestRuns]
AS
SELECT
    m.*,
    MJTests_TestID.[Name] AS [Test],
    MJTestSuiteRuns_TestSuiteRunID.[Suite] AS [TestSuiteRun],
    MJUsers_RunByUserID.[Name] AS [RunByUser],
    MJEntities_TargetLogEntityID.[Name] AS [TargetLogEntity]
FROM
    [${flyway:defaultSchema}].[TestRun] AS m
INNER JOIN
    [${flyway:defaultSchema}].[Test] AS MJTests_TestID
  ON
    [m].[TestID] = MJTests_TestID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[vwTestSuiteRuns] AS MJTestSuiteRuns_TestSuiteRunID
  ON
    [m].[TestSuiteRunID] = MJTestSuiteRuns_TestSuiteRunID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_RunByUserID
  ON
    [m].[RunByUserID] = MJUsers_RunByUserID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[Entity] AS MJEntities_TargetLogEntityID
  ON
    [m].[TargetLogEntityID] = MJEntities_TargetLogEntityID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwTestRuns] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Test Runs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Test Runs
-- Item: Permissions for vwTestRuns
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwTestRuns] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Test Runs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Test Runs
-- Item: spCreateMJTestRun
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR TestRun
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJTestRun]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJTestRun];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJTestRun]
    @ID uniqueidentifier = NULL,
    @TestID uniqueidentifier,
    @TestSuiteRunID uniqueidentifier,
    @RunByUserID uniqueidentifier,
    @Sequence int,
    @TargetType nvarchar(100),
    @TargetLogID uniqueidentifier,
    @Status nvarchar(20) = NULL,
    @StartedAt datetimeoffset,
    @CompletedAt datetimeoffset,
    @DurationSeconds decimal(10, 3),
    @InputData nvarchar(MAX),
    @ExpectedOutputData nvarchar(MAX),
    @ActualOutputData nvarchar(MAX),
    @PassedChecks int,
    @FailedChecks int,
    @TotalChecks int,
    @Score decimal(5, 4),
    @CostUSD decimal(10, 6),
    @ErrorMessage nvarchar(MAX),
    @ResultDetails nvarchar(MAX),
    @Log nvarchar(MAX),
    @Tags nvarchar(MAX),
    @MachineName nvarchar(255),
    @MachineID nvarchar(255),
    @RunByUserName nvarchar(255),
    @RunByUserEmail nvarchar(255),
    @RunContextDetails nvarchar(MAX),
    @TargetLogEntityID uniqueidentifier,
    @ResolvedVariables nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[TestRun]
            (
                [ID],
                [TestID],
                [TestSuiteRunID],
                [RunByUserID],
                [Sequence],
                [TargetType],
                [TargetLogID],
                [Status],
                [StartedAt],
                [CompletedAt],
                [DurationSeconds],
                [InputData],
                [ExpectedOutputData],
                [ActualOutputData],
                [PassedChecks],
                [FailedChecks],
                [TotalChecks],
                [Score],
                [CostUSD],
                [ErrorMessage],
                [ResultDetails],
                [Log],
                [Tags],
                [MachineName],
                [MachineID],
                [RunByUserName],
                [RunByUserEmail],
                [RunContextDetails],
                [TargetLogEntityID],
                [ResolvedVariables]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @TestID,
                @TestSuiteRunID,
                @RunByUserID,
                @Sequence,
                @TargetType,
                @TargetLogID,
                ISNULL(@Status, 'Pending'),
                @StartedAt,
                @CompletedAt,
                @DurationSeconds,
                @InputData,
                @ExpectedOutputData,
                @ActualOutputData,
                @PassedChecks,
                @FailedChecks,
                @TotalChecks,
                @Score,
                @CostUSD,
                @ErrorMessage,
                @ResultDetails,
                @Log,
                @Tags,
                @MachineName,
                @MachineID,
                @RunByUserName,
                @RunByUserEmail,
                @RunContextDetails,
                @TargetLogEntityID,
                @ResolvedVariables
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[TestRun]
            (
                [TestID],
                [TestSuiteRunID],
                [RunByUserID],
                [Sequence],
                [TargetType],
                [TargetLogID],
                [Status],
                [StartedAt],
                [CompletedAt],
                [DurationSeconds],
                [InputData],
                [ExpectedOutputData],
                [ActualOutputData],
                [PassedChecks],
                [FailedChecks],
                [TotalChecks],
                [Score],
                [CostUSD],
                [ErrorMessage],
                [ResultDetails],
                [Log],
                [Tags],
                [MachineName],
                [MachineID],
                [RunByUserName],
                [RunByUserEmail],
                [RunContextDetails],
                [TargetLogEntityID],
                [ResolvedVariables]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @TestID,
                @TestSuiteRunID,
                @RunByUserID,
                @Sequence,
                @TargetType,
                @TargetLogID,
                ISNULL(@Status, 'Pending'),
                @StartedAt,
                @CompletedAt,
                @DurationSeconds,
                @InputData,
                @ExpectedOutputData,
                @ActualOutputData,
                @PassedChecks,
                @FailedChecks,
                @TotalChecks,
                @Score,
                @CostUSD,
                @ErrorMessage,
                @ResultDetails,
                @Log,
                @Tags,
                @MachineName,
                @MachineID,
                @RunByUserName,
                @RunByUserEmail,
                @RunContextDetails,
                @TargetLogEntityID,
                @ResolvedVariables
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwTestRuns] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJTestRun] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Test Runs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJTestRun] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Test Runs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Test Runs
-- Item: spUpdateMJTestRun
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR TestRun
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJTestRun]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJTestRun];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJTestRun]
    @ID uniqueidentifier,
    @TestID uniqueidentifier,
    @TestSuiteRunID uniqueidentifier,
    @RunByUserID uniqueidentifier,
    @Sequence int,
    @TargetType nvarchar(100),
    @TargetLogID uniqueidentifier,
    @Status nvarchar(20),
    @StartedAt datetimeoffset,
    @CompletedAt datetimeoffset,
    @DurationSeconds decimal(10, 3),
    @InputData nvarchar(MAX),
    @ExpectedOutputData nvarchar(MAX),
    @ActualOutputData nvarchar(MAX),
    @PassedChecks int,
    @FailedChecks int,
    @TotalChecks int,
    @Score decimal(5, 4),
    @CostUSD decimal(10, 6),
    @ErrorMessage nvarchar(MAX),
    @ResultDetails nvarchar(MAX),
    @Log nvarchar(MAX),
    @Tags nvarchar(MAX),
    @MachineName nvarchar(255),
    @MachineID nvarchar(255),
    @RunByUserName nvarchar(255),
    @RunByUserEmail nvarchar(255),
    @RunContextDetails nvarchar(MAX),
    @TargetLogEntityID uniqueidentifier,
    @ResolvedVariables nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[TestRun]
    SET
        [TestID] = @TestID,
        [TestSuiteRunID] = @TestSuiteRunID,
        [RunByUserID] = @RunByUserID,
        [Sequence] = @Sequence,
        [TargetType] = @TargetType,
        [TargetLogID] = @TargetLogID,
        [Status] = @Status,
        [StartedAt] = @StartedAt,
        [CompletedAt] = @CompletedAt,
        [DurationSeconds] = @DurationSeconds,
        [InputData] = @InputData,
        [ExpectedOutputData] = @ExpectedOutputData,
        [ActualOutputData] = @ActualOutputData,
        [PassedChecks] = @PassedChecks,
        [FailedChecks] = @FailedChecks,
        [TotalChecks] = @TotalChecks,
        [Score] = @Score,
        [CostUSD] = @CostUSD,
        [ErrorMessage] = @ErrorMessage,
        [ResultDetails] = @ResultDetails,
        [Log] = @Log,
        [Tags] = @Tags,
        [MachineName] = @MachineName,
        [MachineID] = @MachineID,
        [RunByUserName] = @RunByUserName,
        [RunByUserEmail] = @RunByUserEmail,
        [RunContextDetails] = @RunContextDetails,
        [TargetLogEntityID] = @TargetLogEntityID,
        [ResolvedVariables] = @ResolvedVariables
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwTestRuns] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwTestRuns]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJTestRun] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the TestRun table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJTestRun]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJTestRun];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJTestRun
ON [${flyway:defaultSchema}].[TestRun]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[TestRun]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[TestRun] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Test Runs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJTestRun] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Test Runs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Test Runs
-- Item: spDeleteMJTestRun
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR TestRun
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJTestRun]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJTestRun];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJTestRun]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[TestRun]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJTestRun] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Test Runs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJTestRun] TO [cdp_Integration]



/* Base View SQL for MJ: Test Run Feedbacks */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Test Run Feedbacks
-- Item: vwTestRunFeedbacks
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Test Run Feedbacks
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  TestRunFeedback
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwTestRunFeedbacks]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwTestRunFeedbacks];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwTestRunFeedbacks]
AS
SELECT
    m.*,
    MJTestRuns_TestRunID.[Test] AS [TestRun],
    MJUsers_ReviewerUserID.[Name] AS [ReviewerUser]
FROM
    [${flyway:defaultSchema}].[TestRunFeedback] AS m
INNER JOIN
    [${flyway:defaultSchema}].[vwTestRuns] AS MJTestRuns_TestRunID
  ON
    [m].[TestRunID] = MJTestRuns_TestRunID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_ReviewerUserID
  ON
    [m].[ReviewerUserID] = MJUsers_ReviewerUserID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwTestRunFeedbacks] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Test Run Feedbacks */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Test Run Feedbacks
-- Item: Permissions for vwTestRunFeedbacks
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwTestRunFeedbacks] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Test Run Feedbacks */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Test Run Feedbacks
-- Item: spCreateMJTestRunFeedback
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR TestRunFeedback
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJTestRunFeedback]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJTestRunFeedback];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJTestRunFeedback]
    @ID uniqueidentifier = NULL,
    @TestRunID uniqueidentifier,
    @ReviewerUserID uniqueidentifier,
    @Rating int,
    @IsCorrect bit,
    @CorrectionSummary nvarchar(MAX),
    @Comments nvarchar(MAX),
    @ReviewedAt datetimeoffset = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[TestRunFeedback]
            (
                [ID],
                [TestRunID],
                [ReviewerUserID],
                [Rating],
                [IsCorrect],
                [CorrectionSummary],
                [Comments],
                [ReviewedAt]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @TestRunID,
                @ReviewerUserID,
                @Rating,
                @IsCorrect,
                @CorrectionSummary,
                @Comments,
                ISNULL(@ReviewedAt, sysdatetimeoffset())
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[TestRunFeedback]
            (
                [TestRunID],
                [ReviewerUserID],
                [Rating],
                [IsCorrect],
                [CorrectionSummary],
                [Comments],
                [ReviewedAt]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @TestRunID,
                @ReviewerUserID,
                @Rating,
                @IsCorrect,
                @CorrectionSummary,
                @Comments,
                ISNULL(@ReviewedAt, sysdatetimeoffset())
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwTestRunFeedbacks] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJTestRunFeedback] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Test Run Feedbacks */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJTestRunFeedback] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Test Run Feedbacks */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Test Run Feedbacks
-- Item: spUpdateMJTestRunFeedback
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR TestRunFeedback
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJTestRunFeedback]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJTestRunFeedback];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJTestRunFeedback]
    @ID uniqueidentifier,
    @TestRunID uniqueidentifier,
    @ReviewerUserID uniqueidentifier,
    @Rating int,
    @IsCorrect bit,
    @CorrectionSummary nvarchar(MAX),
    @Comments nvarchar(MAX),
    @ReviewedAt datetimeoffset
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[TestRunFeedback]
    SET
        [TestRunID] = @TestRunID,
        [ReviewerUserID] = @ReviewerUserID,
        [Rating] = @Rating,
        [IsCorrect] = @IsCorrect,
        [CorrectionSummary] = @CorrectionSummary,
        [Comments] = @Comments,
        [ReviewedAt] = @ReviewedAt
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwTestRunFeedbacks] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwTestRunFeedbacks]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJTestRunFeedback] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the TestRunFeedback table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJTestRunFeedback]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJTestRunFeedback];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJTestRunFeedback
ON [${flyway:defaultSchema}].[TestRunFeedback]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[TestRunFeedback]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[TestRunFeedback] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Test Run Feedbacks */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJTestRunFeedback] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Test Run Feedbacks */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Test Run Feedbacks
-- Item: spDeleteMJTestRunFeedback
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR TestRunFeedback
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJTestRunFeedback]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJTestRunFeedback];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJTestRunFeedback]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[TestRunFeedback]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJTestRunFeedback] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Test Run Feedbacks */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJTestRunFeedback] TO [cdp_Integration]



/* Base View SQL for MJ: Test Suite Tests */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Test Suite Tests
-- Item: vwTestSuiteTests
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Test Suite Tests
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  TestSuiteTest
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwTestSuiteTests]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwTestSuiteTests];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwTestSuiteTests]
AS
SELECT
    m.*,
    MJTestSuites_SuiteID.[Name] AS [Suite],
    MJTests_TestID.[Name] AS [Test]
FROM
    [${flyway:defaultSchema}].[TestSuiteTest] AS m
INNER JOIN
    [${flyway:defaultSchema}].[TestSuite] AS MJTestSuites_SuiteID
  ON
    [m].[SuiteID] = MJTestSuites_SuiteID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[Test] AS MJTests_TestID
  ON
    [m].[TestID] = MJTests_TestID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwTestSuiteTests] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Test Suite Tests */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Test Suite Tests
-- Item: Permissions for vwTestSuiteTests
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwTestSuiteTests] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Test Suite Tests */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Test Suite Tests
-- Item: spCreateMJTestSuiteTest
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR TestSuiteTest
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJTestSuiteTest]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJTestSuiteTest];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJTestSuiteTest]
    @ID uniqueidentifier = NULL,
    @SuiteID uniqueidentifier,
    @TestID uniqueidentifier,
    @Sequence int = NULL,
    @Status nvarchar(20) = NULL,
    @Configuration nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[TestSuiteTest]
            (
                [ID],
                [SuiteID],
                [TestID],
                [Sequence],
                [Status],
                [Configuration]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @SuiteID,
                @TestID,
                ISNULL(@Sequence, 0),
                ISNULL(@Status, 'Active'),
                @Configuration
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[TestSuiteTest]
            (
                [SuiteID],
                [TestID],
                [Sequence],
                [Status],
                [Configuration]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @SuiteID,
                @TestID,
                ISNULL(@Sequence, 0),
                ISNULL(@Status, 'Active'),
                @Configuration
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwTestSuiteTests] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJTestSuiteTest] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Test Suite Tests */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJTestSuiteTest] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Test Suite Tests */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Test Suite Tests
-- Item: spUpdateMJTestSuiteTest
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR TestSuiteTest
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJTestSuiteTest]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJTestSuiteTest];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJTestSuiteTest]
    @ID uniqueidentifier,
    @SuiteID uniqueidentifier,
    @TestID uniqueidentifier,
    @Sequence int,
    @Status nvarchar(20),
    @Configuration nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[TestSuiteTest]
    SET
        [SuiteID] = @SuiteID,
        [TestID] = @TestID,
        [Sequence] = @Sequence,
        [Status] = @Status,
        [Configuration] = @Configuration
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwTestSuiteTests] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwTestSuiteTests]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJTestSuiteTest] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the TestSuiteTest table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJTestSuiteTest]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJTestSuiteTest];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJTestSuiteTest
ON [${flyway:defaultSchema}].[TestSuiteTest]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[TestSuiteTest]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[TestSuiteTest] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Test Suite Tests */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJTestSuiteTest] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Test Suite Tests */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Test Suite Tests
-- Item: spDeleteMJTestSuiteTest
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR TestSuiteTest
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJTestSuiteTest]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJTestSuiteTest];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJTestSuiteTest]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[TestSuiteTest]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJTestSuiteTest] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Test Suite Tests */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJTestSuiteTest] TO [cdp_Integration]



/* Base View SQL for MJ: Test Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Test Types
-- Item: vwTestTypes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Test Types
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  TestType
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwTestTypes]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwTestTypes];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwTestTypes]
AS
SELECT
    m.*
FROM
    [${flyway:defaultSchema}].[TestType] AS m
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwTestTypes] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Test Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Test Types
-- Item: Permissions for vwTestTypes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwTestTypes] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Test Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Test Types
-- Item: spCreateMJTestType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR TestType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJTestType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJTestType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJTestType]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(100),
    @Description nvarchar(MAX),
    @DriverClass nvarchar(255),
    @Status nvarchar(20) = NULL,
    @VariablesSchema nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[TestType]
            (
                [ID],
                [Name],
                [Description],
                [DriverClass],
                [Status],
                [VariablesSchema]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description,
                @DriverClass,
                ISNULL(@Status, 'Active'),
                @VariablesSchema
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[TestType]
            (
                [Name],
                [Description],
                [DriverClass],
                [Status],
                [VariablesSchema]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description,
                @DriverClass,
                ISNULL(@Status, 'Active'),
                @VariablesSchema
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwTestTypes] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJTestType] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Test Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJTestType] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Test Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Test Types
-- Item: spUpdateMJTestType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR TestType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJTestType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJTestType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJTestType]
    @ID uniqueidentifier,
    @Name nvarchar(100),
    @Description nvarchar(MAX),
    @DriverClass nvarchar(255),
    @Status nvarchar(20),
    @VariablesSchema nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[TestType]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [DriverClass] = @DriverClass,
        [Status] = @Status,
        [VariablesSchema] = @VariablesSchema
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwTestTypes] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwTestTypes]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJTestType] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the TestType table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJTestType]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJTestType];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJTestType
ON [${flyway:defaultSchema}].[TestType]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[TestType]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[TestType] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Test Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJTestType] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Test Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Test Types
-- Item: spDeleteMJTestType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR TestType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJTestType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJTestType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJTestType]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[TestType]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJTestType] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Test Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJTestType] TO [cdp_Integration]



/* Base View SQL for MJ: Test Suites */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Test Suites
-- Item: vwTestSuites
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Test Suites
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  TestSuite
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwTestSuites]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwTestSuites];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwTestSuites]
AS
SELECT
    m.*,
    MJTestSuites_ParentID.[Name] AS [Parent],
    root_ParentID.RootID AS [RootParentID]
FROM
    [${flyway:defaultSchema}].[TestSuite] AS m
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[TestSuite] AS MJTestSuites_ParentID
  ON
    [m].[ParentID] = MJTestSuites_ParentID.[ID]
OUTER APPLY
    [${flyway:defaultSchema}].[fnTestSuiteParentID_GetRootID]([m].[ID], [m].[ParentID]) AS root_ParentID
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwTestSuites] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Test Suites */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Test Suites
-- Item: Permissions for vwTestSuites
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwTestSuites] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Test Suites */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Test Suites
-- Item: spCreateMJTestSuite
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR TestSuite
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJTestSuite]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJTestSuite];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJTestSuite]
    @ID uniqueidentifier = NULL,
    @ParentID uniqueidentifier,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @Status nvarchar(20) = NULL,
    @Tags nvarchar(MAX),
    @Configuration nvarchar(MAX),
    @MaxExecutionTimeMS int,
    @Variables nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[TestSuite]
            (
                [ID],
                [ParentID],
                [Name],
                [Description],
                [Status],
                [Tags],
                [Configuration],
                [MaxExecutionTimeMS],
                [Variables]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @ParentID,
                @Name,
                @Description,
                ISNULL(@Status, 'Active'),
                @Tags,
                @Configuration,
                @MaxExecutionTimeMS,
                @Variables
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[TestSuite]
            (
                [ParentID],
                [Name],
                [Description],
                [Status],
                [Tags],
                [Configuration],
                [MaxExecutionTimeMS],
                [Variables]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ParentID,
                @Name,
                @Description,
                ISNULL(@Status, 'Active'),
                @Tags,
                @Configuration,
                @MaxExecutionTimeMS,
                @Variables
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwTestSuites] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJTestSuite] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Test Suites */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJTestSuite] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Test Suites */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Test Suites
-- Item: spUpdateMJTestSuite
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR TestSuite
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJTestSuite]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJTestSuite];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJTestSuite]
    @ID uniqueidentifier,
    @ParentID uniqueidentifier,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @Status nvarchar(20),
    @Tags nvarchar(MAX),
    @Configuration nvarchar(MAX),
    @MaxExecutionTimeMS int,
    @Variables nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[TestSuite]
    SET
        [ParentID] = @ParentID,
        [Name] = @Name,
        [Description] = @Description,
        [Status] = @Status,
        [Tags] = @Tags,
        [Configuration] = @Configuration,
        [MaxExecutionTimeMS] = @MaxExecutionTimeMS,
        [Variables] = @Variables
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwTestSuites] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwTestSuites]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJTestSuite] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the TestSuite table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJTestSuite]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJTestSuite];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJTestSuite
ON [${flyway:defaultSchema}].[TestSuite]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[TestSuite]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[TestSuite] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Test Suites */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJTestSuite] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Test Suites */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Test Suites
-- Item: spDeleteMJTestSuite
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR TestSuite
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJTestSuite]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJTestSuite];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJTestSuite]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[TestSuite]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJTestSuite] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Test Suites */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJTestSuite] TO [cdp_Integration]



/* Base View SQL for MJ: User Applications */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: User Applications
-- Item: vwUserApplications
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: User Applications
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  UserApplication
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwUserApplications]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwUserApplications];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwUserApplications]
AS
SELECT
    m.*,
    MJUsers_UserID.[Name] AS [User],
    MJApplications_ApplicationID.[Name] AS [Application]
FROM
    [${flyway:defaultSchema}].[UserApplication] AS m
INNER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_UserID
  ON
    [m].[UserID] = MJUsers_UserID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[Application] AS MJApplications_ApplicationID
  ON
    [m].[ApplicationID] = MJApplications_ApplicationID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwUserApplications] TO [cdp_Integration], [cdp_UI], [cdp_Developer]
    

/* Base View Permissions SQL for MJ: User Applications */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: User Applications
-- Item: Permissions for vwUserApplications
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwUserApplications] TO [cdp_Integration], [cdp_UI], [cdp_Developer]

/* spCreate SQL for MJ: User Applications */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: User Applications
-- Item: spCreateMJUserApplication
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR UserApplication
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJUserApplication]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJUserApplication];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJUserApplication]
    @ID uniqueidentifier = NULL,
    @UserID uniqueidentifier,
    @ApplicationID uniqueidentifier,
    @Sequence int = NULL,
    @IsActive bit = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[UserApplication]
            (
                [ID],
                [UserID],
                [ApplicationID],
                [Sequence],
                [IsActive]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @UserID,
                @ApplicationID,
                ISNULL(@Sequence, 0),
                ISNULL(@IsActive, 1)
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[UserApplication]
            (
                [UserID],
                [ApplicationID],
                [Sequence],
                [IsActive]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @UserID,
                @ApplicationID,
                ISNULL(@Sequence, 0),
                ISNULL(@IsActive, 1)
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwUserApplications] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJUserApplication] TO [cdp_Integration], [cdp_UI], [cdp_Developer]
    

/* spCreate Permissions for MJ: User Applications */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJUserApplication] TO [cdp_Integration], [cdp_UI], [cdp_Developer]



/* spUpdate SQL for MJ: User Applications */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: User Applications
-- Item: spUpdateMJUserApplication
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR UserApplication
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJUserApplication]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJUserApplication];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJUserApplication]
    @ID uniqueidentifier,
    @UserID uniqueidentifier,
    @ApplicationID uniqueidentifier,
    @Sequence int,
    @IsActive bit
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[UserApplication]
    SET
        [UserID] = @UserID,
        [ApplicationID] = @ApplicationID,
        [Sequence] = @Sequence,
        [IsActive] = @IsActive
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwUserApplications] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwUserApplications]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJUserApplication] TO [cdp_Integration], [cdp_UI], [cdp_Developer]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the UserApplication table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJUserApplication]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJUserApplication];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJUserApplication
ON [${flyway:defaultSchema}].[UserApplication]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[UserApplication]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[UserApplication] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: User Applications */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJUserApplication] TO [cdp_Integration], [cdp_UI], [cdp_Developer]



/* spDelete SQL for MJ: User Applications */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: User Applications
-- Item: spDeleteMJUserApplication
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR UserApplication
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJUserApplication]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJUserApplication];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJUserApplication]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[UserApplication]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJUserApplication] TO [cdp_Integration], [cdp_UI], [cdp_Developer]
    

/* spDelete Permissions for MJ: User Applications */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJUserApplication] TO [cdp_Integration], [cdp_UI], [cdp_Developer]



/* Base View SQL for MJ: Tests */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Tests
-- Item: vwTests
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Tests
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  Test
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwTests]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwTests];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwTests]
AS
SELECT
    m.*,
    MJTestTypes_TypeID.[Name] AS [Type]
FROM
    [${flyway:defaultSchema}].[Test] AS m
INNER JOIN
    [${flyway:defaultSchema}].[TestType] AS MJTestTypes_TypeID
  ON
    [m].[TypeID] = MJTestTypes_TypeID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwTests] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Tests */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Tests
-- Item: Permissions for vwTests
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwTests] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Tests */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Tests
-- Item: spCreateMJTest
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR Test
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJTest]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJTest];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJTest]
    @ID uniqueidentifier = NULL,
    @TypeID uniqueidentifier,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @Status nvarchar(20) = NULL,
    @InputDefinition nvarchar(MAX),
    @ExpectedOutcomes nvarchar(MAX),
    @Configuration nvarchar(MAX),
    @Tags nvarchar(MAX),
    @Priority int,
    @EstimatedDurationSeconds int,
    @EstimatedCostUSD decimal(10, 6),
    @RepeatCount int,
    @MaxExecutionTimeMS int,
    @Variables nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[Test]
            (
                [ID],
                [TypeID],
                [Name],
                [Description],
                [Status],
                [InputDefinition],
                [ExpectedOutcomes],
                [Configuration],
                [Tags],
                [Priority],
                [EstimatedDurationSeconds],
                [EstimatedCostUSD],
                [RepeatCount],
                [MaxExecutionTimeMS],
                [Variables]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @TypeID,
                @Name,
                @Description,
                ISNULL(@Status, 'Active'),
                @InputDefinition,
                @ExpectedOutcomes,
                @Configuration,
                @Tags,
                @Priority,
                @EstimatedDurationSeconds,
                @EstimatedCostUSD,
                @RepeatCount,
                @MaxExecutionTimeMS,
                @Variables
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[Test]
            (
                [TypeID],
                [Name],
                [Description],
                [Status],
                [InputDefinition],
                [ExpectedOutcomes],
                [Configuration],
                [Tags],
                [Priority],
                [EstimatedDurationSeconds],
                [EstimatedCostUSD],
                [RepeatCount],
                [MaxExecutionTimeMS],
                [Variables]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @TypeID,
                @Name,
                @Description,
                ISNULL(@Status, 'Active'),
                @InputDefinition,
                @ExpectedOutcomes,
                @Configuration,
                @Tags,
                @Priority,
                @EstimatedDurationSeconds,
                @EstimatedCostUSD,
                @RepeatCount,
                @MaxExecutionTimeMS,
                @Variables
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwTests] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJTest] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Tests */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJTest] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Tests */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Tests
-- Item: spUpdateMJTest
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR Test
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJTest]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJTest];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJTest]
    @ID uniqueidentifier,
    @TypeID uniqueidentifier,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @Status nvarchar(20),
    @InputDefinition nvarchar(MAX),
    @ExpectedOutcomes nvarchar(MAX),
    @Configuration nvarchar(MAX),
    @Tags nvarchar(MAX),
    @Priority int,
    @EstimatedDurationSeconds int,
    @EstimatedCostUSD decimal(10, 6),
    @RepeatCount int,
    @MaxExecutionTimeMS int,
    @Variables nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[Test]
    SET
        [TypeID] = @TypeID,
        [Name] = @Name,
        [Description] = @Description,
        [Status] = @Status,
        [InputDefinition] = @InputDefinition,
        [ExpectedOutcomes] = @ExpectedOutcomes,
        [Configuration] = @Configuration,
        [Tags] = @Tags,
        [Priority] = @Priority,
        [EstimatedDurationSeconds] = @EstimatedDurationSeconds,
        [EstimatedCostUSD] = @EstimatedCostUSD,
        [RepeatCount] = @RepeatCount,
        [MaxExecutionTimeMS] = @MaxExecutionTimeMS,
        [Variables] = @Variables
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwTests] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwTests]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJTest] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the Test table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJTest]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJTest];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJTest
ON [${flyway:defaultSchema}].[Test]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[Test]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[Test] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Tests */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJTest] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Tests */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Tests
-- Item: spDeleteMJTest
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR Test
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJTest]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJTest];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJTest]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[Test]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJTest] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Tests */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJTest] TO [cdp_Integration]



/* Base View SQL for MJ: User Notification Preferences */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: User Notification Preferences
-- Item: vwUserNotificationPreferences
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: User Notification Preferences
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  UserNotificationPreference
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwUserNotificationPreferences]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwUserNotificationPreferences];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwUserNotificationPreferences]
AS
SELECT
    m.*,
    MJUsers_UserID.[Name] AS [User],
    MJUserNotificationTypes_NotificationTypeID.[Name] AS [NotificationType]
FROM
    [${flyway:defaultSchema}].[UserNotificationPreference] AS m
INNER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_UserID
  ON
    [m].[UserID] = MJUsers_UserID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[UserNotificationType] AS MJUserNotificationTypes_NotificationTypeID
  ON
    [m].[NotificationTypeID] = MJUserNotificationTypes_NotificationTypeID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwUserNotificationPreferences] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: User Notification Preferences */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: User Notification Preferences
-- Item: Permissions for vwUserNotificationPreferences
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwUserNotificationPreferences] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: User Notification Preferences */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: User Notification Preferences
-- Item: spCreateMJUserNotificationPreference
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR UserNotificationPreference
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJUserNotificationPreference]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJUserNotificationPreference];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJUserNotificationPreference]
    @ID uniqueidentifier = NULL,
    @UserID uniqueidentifier,
    @NotificationTypeID uniqueidentifier,
    @InAppEnabled bit,
    @EmailEnabled bit,
    @SMSEnabled bit,
    @Enabled bit
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[UserNotificationPreference]
            (
                [ID],
                [UserID],
                [NotificationTypeID],
                [InAppEnabled],
                [EmailEnabled],
                [SMSEnabled],
                [Enabled]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @UserID,
                @NotificationTypeID,
                @InAppEnabled,
                @EmailEnabled,
                @SMSEnabled,
                @Enabled
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[UserNotificationPreference]
            (
                [UserID],
                [NotificationTypeID],
                [InAppEnabled],
                [EmailEnabled],
                [SMSEnabled],
                [Enabled]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @UserID,
                @NotificationTypeID,
                @InAppEnabled,
                @EmailEnabled,
                @SMSEnabled,
                @Enabled
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwUserNotificationPreferences] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJUserNotificationPreference] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: User Notification Preferences */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJUserNotificationPreference] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: User Notification Preferences */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: User Notification Preferences
-- Item: spUpdateMJUserNotificationPreference
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR UserNotificationPreference
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJUserNotificationPreference]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJUserNotificationPreference];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJUserNotificationPreference]
    @ID uniqueidentifier,
    @UserID uniqueidentifier,
    @NotificationTypeID uniqueidentifier,
    @InAppEnabled bit,
    @EmailEnabled bit,
    @SMSEnabled bit,
    @Enabled bit
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[UserNotificationPreference]
    SET
        [UserID] = @UserID,
        [NotificationTypeID] = @NotificationTypeID,
        [InAppEnabled] = @InAppEnabled,
        [EmailEnabled] = @EmailEnabled,
        [SMSEnabled] = @SMSEnabled,
        [Enabled] = @Enabled
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwUserNotificationPreferences] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwUserNotificationPreferences]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJUserNotificationPreference] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the UserNotificationPreference table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJUserNotificationPreference]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJUserNotificationPreference];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJUserNotificationPreference
ON [${flyway:defaultSchema}].[UserNotificationPreference]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[UserNotificationPreference]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[UserNotificationPreference] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: User Notification Preferences */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJUserNotificationPreference] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: User Notification Preferences */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: User Notification Preferences
-- Item: spDeleteMJUserNotificationPreference
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR UserNotificationPreference
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJUserNotificationPreference]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJUserNotificationPreference];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJUserNotificationPreference]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[UserNotificationPreference]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJUserNotificationPreference] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: User Notification Preferences */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJUserNotificationPreference] TO [cdp_Integration]



/* Base View SQL for MJ: User Notifications */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: User Notifications
-- Item: vwUserNotifications
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: User Notifications
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  UserNotification
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwUserNotifications]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwUserNotifications];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwUserNotifications]
AS
SELECT
    m.*,
    MJUsers_UserID.[Name] AS [User],
    MJResourceTypes_ResourceTypeID.[Name] AS [ResourceType],
    MJUserNotificationTypes_NotificationTypeID.[Name] AS [NotificationType]
FROM
    [${flyway:defaultSchema}].[UserNotification] AS m
INNER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_UserID
  ON
    [m].[UserID] = MJUsers_UserID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[ResourceType] AS MJResourceTypes_ResourceTypeID
  ON
    [m].[ResourceTypeID] = MJResourceTypes_ResourceTypeID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[UserNotificationType] AS MJUserNotificationTypes_NotificationTypeID
  ON
    [m].[NotificationTypeID] = MJUserNotificationTypes_NotificationTypeID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwUserNotifications] TO [cdp_Integration], [cdp_Developer], [cdp_UI]
    

/* Base View Permissions SQL for MJ: User Notifications */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: User Notifications
-- Item: Permissions for vwUserNotifications
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwUserNotifications] TO [cdp_Integration], [cdp_Developer], [cdp_UI]

/* spCreate SQL for MJ: User Notifications */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: User Notifications
-- Item: spCreateMJUserNotification
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR UserNotification
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJUserNotification]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJUserNotification];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJUserNotification]
    @ID uniqueidentifier = NULL,
    @UserID uniqueidentifier,
    @Title nvarchar(255),
    @Message nvarchar(MAX),
    @ResourceTypeID uniqueidentifier,
    @ResourceConfiguration nvarchar(MAX),
    @Unread bit = NULL,
    @ReadAt datetimeoffset,
    @ResourceRecordID uniqueidentifier,
    @NotificationTypeID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[UserNotification]
            (
                [ID],
                [UserID],
                [Title],
                [Message],
                [ResourceTypeID],
                [ResourceConfiguration],
                [Unread],
                [ReadAt],
                [ResourceRecordID],
                [NotificationTypeID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @UserID,
                @Title,
                @Message,
                @ResourceTypeID,
                @ResourceConfiguration,
                ISNULL(@Unread, 1),
                @ReadAt,
                @ResourceRecordID,
                @NotificationTypeID
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[UserNotification]
            (
                [UserID],
                [Title],
                [Message],
                [ResourceTypeID],
                [ResourceConfiguration],
                [Unread],
                [ReadAt],
                [ResourceRecordID],
                [NotificationTypeID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @UserID,
                @Title,
                @Message,
                @ResourceTypeID,
                @ResourceConfiguration,
                ISNULL(@Unread, 1),
                @ReadAt,
                @ResourceRecordID,
                @NotificationTypeID
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwUserNotifications] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJUserNotification] TO [cdp_Integration], [cdp_Developer], [cdp_UI]
    

/* spCreate Permissions for MJ: User Notifications */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJUserNotification] TO [cdp_Integration], [cdp_Developer], [cdp_UI]



/* spUpdate SQL for MJ: User Notifications */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: User Notifications
-- Item: spUpdateMJUserNotification
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR UserNotification
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJUserNotification]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJUserNotification];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJUserNotification]
    @ID uniqueidentifier,
    @UserID uniqueidentifier,
    @Title nvarchar(255),
    @Message nvarchar(MAX),
    @ResourceTypeID uniqueidentifier,
    @ResourceConfiguration nvarchar(MAX),
    @Unread bit,
    @ReadAt datetimeoffset,
    @ResourceRecordID uniqueidentifier,
    @NotificationTypeID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[UserNotification]
    SET
        [UserID] = @UserID,
        [Title] = @Title,
        [Message] = @Message,
        [ResourceTypeID] = @ResourceTypeID,
        [ResourceConfiguration] = @ResourceConfiguration,
        [Unread] = @Unread,
        [ReadAt] = @ReadAt,
        [ResourceRecordID] = @ResourceRecordID,
        [NotificationTypeID] = @NotificationTypeID
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwUserNotifications] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwUserNotifications]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJUserNotification] TO [cdp_Integration], [cdp_Developer], [cdp_UI]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the UserNotification table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJUserNotification]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJUserNotification];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJUserNotification
ON [${flyway:defaultSchema}].[UserNotification]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[UserNotification]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[UserNotification] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: User Notifications */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJUserNotification] TO [cdp_Integration], [cdp_Developer], [cdp_UI]



/* spDelete SQL for MJ: User Notifications */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: User Notifications
-- Item: spDeleteMJUserNotification
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR UserNotification
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJUserNotification]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJUserNotification];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJUserNotification]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[UserNotification]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
    

/* spDelete Permissions for MJ: User Notifications */




/* Base View SQL for MJ: User Notification Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: User Notification Types
-- Item: vwUserNotificationTypes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: User Notification Types
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  UserNotificationType
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwUserNotificationTypes]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwUserNotificationTypes];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwUserNotificationTypes]
AS
SELECT
    m.*,
    MJTemplates_EmailTemplateID.[Name] AS [EmailTemplate],
    MJTemplates_SMSTemplateID.[Name] AS [SMSTemplate]
FROM
    [${flyway:defaultSchema}].[UserNotificationType] AS m
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[Template] AS MJTemplates_EmailTemplateID
  ON
    [m].[EmailTemplateID] = MJTemplates_EmailTemplateID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[Template] AS MJTemplates_SMSTemplateID
  ON
    [m].[SMSTemplateID] = MJTemplates_SMSTemplateID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwUserNotificationTypes] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: User Notification Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: User Notification Types
-- Item: Permissions for vwUserNotificationTypes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwUserNotificationTypes] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: User Notification Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: User Notification Types
-- Item: spCreateMJUserNotificationType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR UserNotificationType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJUserNotificationType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJUserNotificationType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJUserNotificationType]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(100),
    @Description nvarchar(500),
    @DefaultInApp bit = NULL,
    @DefaultEmail bit = NULL,
    @DefaultSMS bit = NULL,
    @AllowUserPreference bit,
    @EmailTemplateID uniqueidentifier,
    @SMSTemplateID uniqueidentifier,
    @Icon nvarchar(100),
    @Color nvarchar(50),
    @AutoExpireDays int,
    @Priority int
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[UserNotificationType]
            (
                [ID],
                [Name],
                [Description],
                [DefaultInApp],
                [DefaultEmail],
                [DefaultSMS],
                [AllowUserPreference],
                [EmailTemplateID],
                [SMSTemplateID],
                [Icon],
                [Color],
                [AutoExpireDays],
                [Priority]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description,
                ISNULL(@DefaultInApp, 1),
                ISNULL(@DefaultEmail, 0),
                ISNULL(@DefaultSMS, 0),
                @AllowUserPreference,
                @EmailTemplateID,
                @SMSTemplateID,
                @Icon,
                @Color,
                @AutoExpireDays,
                @Priority
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[UserNotificationType]
            (
                [Name],
                [Description],
                [DefaultInApp],
                [DefaultEmail],
                [DefaultSMS],
                [AllowUserPreference],
                [EmailTemplateID],
                [SMSTemplateID],
                [Icon],
                [Color],
                [AutoExpireDays],
                [Priority]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description,
                ISNULL(@DefaultInApp, 1),
                ISNULL(@DefaultEmail, 0),
                ISNULL(@DefaultSMS, 0),
                @AllowUserPreference,
                @EmailTemplateID,
                @SMSTemplateID,
                @Icon,
                @Color,
                @AutoExpireDays,
                @Priority
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwUserNotificationTypes] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJUserNotificationType] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: User Notification Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJUserNotificationType] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: User Notification Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: User Notification Types
-- Item: spUpdateMJUserNotificationType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR UserNotificationType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJUserNotificationType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJUserNotificationType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJUserNotificationType]
    @ID uniqueidentifier,
    @Name nvarchar(100),
    @Description nvarchar(500),
    @DefaultInApp bit,
    @DefaultEmail bit,
    @DefaultSMS bit,
    @AllowUserPreference bit,
    @EmailTemplateID uniqueidentifier,
    @SMSTemplateID uniqueidentifier,
    @Icon nvarchar(100),
    @Color nvarchar(50),
    @AutoExpireDays int,
    @Priority int
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[UserNotificationType]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [DefaultInApp] = @DefaultInApp,
        [DefaultEmail] = @DefaultEmail,
        [DefaultSMS] = @DefaultSMS,
        [AllowUserPreference] = @AllowUserPreference,
        [EmailTemplateID] = @EmailTemplateID,
        [SMSTemplateID] = @SMSTemplateID,
        [Icon] = @Icon,
        [Color] = @Color,
        [AutoExpireDays] = @AutoExpireDays,
        [Priority] = @Priority
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwUserNotificationTypes] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwUserNotificationTypes]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJUserNotificationType] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the UserNotificationType table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJUserNotificationType]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJUserNotificationType];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJUserNotificationType
ON [${flyway:defaultSchema}].[UserNotificationType]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[UserNotificationType]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[UserNotificationType] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: User Notification Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJUserNotificationType] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: User Notification Types */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: User Notification Types
-- Item: spDeleteMJUserNotificationType
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR UserNotificationType
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJUserNotificationType]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJUserNotificationType];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJUserNotificationType]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[UserNotificationType]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJUserNotificationType] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: User Notification Types */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJUserNotificationType] TO [cdp_Integration]



/* Base View SQL for MJ: User Roles */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: User Roles
-- Item: vwUserRoles
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: User Roles
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  UserRole
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwUserRoles]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwUserRoles];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwUserRoles]
AS
SELECT
    m.*,
    MJUsers_UserID.[Name] AS [User],
    MJRoles_RoleID.[Name] AS [Role]
FROM
    [${flyway:defaultSchema}].[UserRole] AS m
INNER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_UserID
  ON
    [m].[UserID] = MJUsers_UserID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[Role] AS MJRoles_RoleID
  ON
    [m].[RoleID] = MJRoles_RoleID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwUserRoles] TO [cdp_Developer], [cdp_UI], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: User Roles */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: User Roles
-- Item: Permissions for vwUserRoles
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwUserRoles] TO [cdp_Developer], [cdp_UI], [cdp_Integration]

/* spCreate SQL for MJ: User Roles */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: User Roles
-- Item: spCreateMJUserRole
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR UserRole
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJUserRole]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJUserRole];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJUserRole]
    @ID uniqueidentifier = NULL,
    @UserID uniqueidentifier,
    @RoleID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[UserRole]
            (
                [ID],
                [UserID],
                [RoleID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @UserID,
                @RoleID
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[UserRole]
            (
                [UserID],
                [RoleID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @UserID,
                @RoleID
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwUserRoles] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJUserRole] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: User Roles */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJUserRole] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: User Roles */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: User Roles
-- Item: spUpdateMJUserRole
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR UserRole
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJUserRole]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJUserRole];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJUserRole]
    @ID uniqueidentifier,
    @UserID uniqueidentifier,
    @RoleID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[UserRole]
    SET
        [UserID] = @UserID,
        [RoleID] = @RoleID
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwUserRoles] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwUserRoles]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJUserRole] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the UserRole table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJUserRole]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJUserRole];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJUserRole
ON [${flyway:defaultSchema}].[UserRole]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[UserRole]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[UserRole] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: User Roles */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJUserRole] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: User Roles */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: User Roles
-- Item: spDeleteMJUserRole
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR UserRole
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJUserRole]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJUserRole];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJUserRole]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[UserRole]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJUserRole] TO [cdp_Developer], [cdp_Integration]
    

/* spDelete Permissions for MJ: User Roles */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJUserRole] TO [cdp_Developer], [cdp_Integration]



/* Base View SQL for MJ: User View Categories */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: User View Categories
-- Item: vwUserViewCategories
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: User View Categories
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  UserViewCategory
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwUserViewCategories]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwUserViewCategories];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwUserViewCategories]
AS
SELECT
    m.*,
    MJUserViewCategories_ParentID.[Name] AS [Parent],
    MJEntities_EntityID.[Name] AS [Entity],
    MJUsers_UserID.[Name] AS [User],
    root_ParentID.RootID AS [RootParentID]
FROM
    [${flyway:defaultSchema}].[UserViewCategory] AS m
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[UserViewCategory] AS MJUserViewCategories_ParentID
  ON
    [m].[ParentID] = MJUserViewCategories_ParentID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[Entity] AS MJEntities_EntityID
  ON
    [m].[EntityID] = MJEntities_EntityID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_UserID
  ON
    [m].[UserID] = MJUsers_UserID.[ID]
OUTER APPLY
    [${flyway:defaultSchema}].[fnUserViewCategoryParentID_GetRootID]([m].[ID], [m].[ParentID]) AS root_ParentID
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwUserViewCategories] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: User View Categories */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: User View Categories
-- Item: Permissions for vwUserViewCategories
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwUserViewCategories] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: User View Categories */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: User View Categories
-- Item: spCreateMJUserViewCategory
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR UserViewCategory
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJUserViewCategory]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJUserViewCategory];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJUserViewCategory]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(100),
    @Description nvarchar(MAX),
    @ParentID uniqueidentifier,
    @EntityID uniqueidentifier,
    @UserID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[UserViewCategory]
            (
                [ID],
                [Name],
                [Description],
                [ParentID],
                [EntityID],
                [UserID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description,
                @ParentID,
                @EntityID,
                @UserID
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[UserViewCategory]
            (
                [Name],
                [Description],
                [ParentID],
                [EntityID],
                [UserID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description,
                @ParentID,
                @EntityID,
                @UserID
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwUserViewCategories] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJUserViewCategory] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: User View Categories */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJUserViewCategory] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: User View Categories */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: User View Categories
-- Item: spUpdateMJUserViewCategory
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR UserViewCategory
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJUserViewCategory]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJUserViewCategory];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJUserViewCategory]
    @ID uniqueidentifier,
    @Name nvarchar(100),
    @Description nvarchar(MAX),
    @ParentID uniqueidentifier,
    @EntityID uniqueidentifier,
    @UserID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[UserViewCategory]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [ParentID] = @ParentID,
        [EntityID] = @EntityID,
        [UserID] = @UserID
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwUserViewCategories] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwUserViewCategories]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJUserViewCategory] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the UserViewCategory table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJUserViewCategory]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJUserViewCategory];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJUserViewCategory
ON [${flyway:defaultSchema}].[UserViewCategory]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[UserViewCategory]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[UserViewCategory] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: User View Categories */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJUserViewCategory] TO [cdp_UI], [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: User View Categories */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: User View Categories
-- Item: spDeleteMJUserViewCategory
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR UserViewCategory
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJUserViewCategory]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJUserViewCategory];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJUserViewCategory]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[UserViewCategory]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJUserViewCategory] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* spDelete Permissions for MJ: User View Categories */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJUserViewCategory] TO [cdp_UI], [cdp_Developer], [cdp_Integration]



/* Base View SQL for MJ: User View Runs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: User View Runs
-- Item: vwUserViewRuns
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: User View Runs
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  UserViewRun
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwUserViewRuns]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwUserViewRuns];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwUserViewRuns]
AS
SELECT
    m.*,
    MJUserViews_UserViewID.[Name] AS [UserView],
    MJUsers_RunByUserID.[Name] AS [RunByUser]
FROM
    [${flyway:defaultSchema}].[UserViewRun] AS m
INNER JOIN
    [${flyway:defaultSchema}].[UserView] AS MJUserViews_UserViewID
  ON
    [m].[UserViewID] = MJUserViews_UserViewID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_RunByUserID
  ON
    [m].[RunByUserID] = MJUsers_RunByUserID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwUserViewRuns] TO [cdp_Developer], [cdp_UI], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: User View Runs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: User View Runs
-- Item: Permissions for vwUserViewRuns
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwUserViewRuns] TO [cdp_Developer], [cdp_UI], [cdp_Integration]

/* spCreate SQL for MJ: User View Runs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: User View Runs
-- Item: spCreateMJUserViewRun
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR UserViewRun
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJUserViewRun]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJUserViewRun];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJUserViewRun]
    @ID uniqueidentifier = NULL,
    @UserViewID uniqueidentifier,
    @RunAt datetimeoffset,
    @RunByUserID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[UserViewRun]
            (
                [ID],
                [UserViewID],
                [RunAt],
                [RunByUserID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @UserViewID,
                @RunAt,
                @RunByUserID
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[UserViewRun]
            (
                [UserViewID],
                [RunAt],
                [RunByUserID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @UserViewID,
                @RunAt,
                @RunByUserID
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwUserViewRuns] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJUserViewRun] TO [cdp_Developer], [cdp_UI], [cdp_Integration]
    

/* spCreate Permissions for MJ: User View Runs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJUserViewRun] TO [cdp_Developer], [cdp_UI], [cdp_Integration]



/* spUpdate SQL for MJ: User View Runs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: User View Runs
-- Item: spUpdateMJUserViewRun
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR UserViewRun
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJUserViewRun]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJUserViewRun];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJUserViewRun]
    @ID uniqueidentifier,
    @UserViewID uniqueidentifier,
    @RunAt datetimeoffset,
    @RunByUserID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[UserViewRun]
    SET
        [UserViewID] = @UserViewID,
        [RunAt] = @RunAt,
        [RunByUserID] = @RunByUserID
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwUserViewRuns] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwUserViewRuns]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJUserViewRun] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the UserViewRun table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJUserViewRun]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJUserViewRun];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJUserViewRun
ON [${flyway:defaultSchema}].[UserViewRun]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[UserViewRun]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[UserViewRun] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: User View Runs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJUserViewRun] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: User View Runs */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: User View Runs
-- Item: spDeleteMJUserViewRun
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR UserViewRun
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJUserViewRun]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJUserViewRun];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJUserViewRun]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[UserViewRun]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJUserViewRun] TO [cdp_Developer], [cdp_Integration]
    

/* spDelete Permissions for MJ: User View Runs */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJUserViewRun] TO [cdp_Developer], [cdp_Integration]



/* Base View SQL for MJ: User Settings */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: User Settings
-- Item: vwUserSettings
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: User Settings
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  UserSetting
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwUserSettings]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwUserSettings];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwUserSettings]
AS
SELECT
    m.*,
    MJUsers_UserID.[Name] AS [User]
FROM
    [${flyway:defaultSchema}].[UserSetting] AS m
INNER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_UserID
  ON
    [m].[UserID] = MJUsers_UserID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwUserSettings] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: User Settings */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: User Settings
-- Item: Permissions for vwUserSettings
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwUserSettings] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: User Settings */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: User Settings
-- Item: spCreateMJUserSetting
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR UserSetting
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJUserSetting]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJUserSetting];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJUserSetting]
    @ID uniqueidentifier = NULL,
    @UserID uniqueidentifier,
    @Setting nvarchar(255),
    @Value nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[UserSetting]
            (
                [ID],
                [UserID],
                [Setting],
                [Value]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @UserID,
                @Setting,
                @Value
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[UserSetting]
            (
                [UserID],
                [Setting],
                [Value]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @UserID,
                @Setting,
                @Value
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwUserSettings] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJUserSetting] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: User Settings */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJUserSetting] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: User Settings */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: User Settings
-- Item: spUpdateMJUserSetting
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR UserSetting
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJUserSetting]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJUserSetting];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJUserSetting]
    @ID uniqueidentifier,
    @UserID uniqueidentifier,
    @Setting nvarchar(255),
    @Value nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[UserSetting]
    SET
        [UserID] = @UserID,
        [Setting] = @Setting,
        [Value] = @Value
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwUserSettings] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwUserSettings]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJUserSetting] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the UserSetting table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJUserSetting]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJUserSetting];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJUserSetting
ON [${flyway:defaultSchema}].[UserSetting]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[UserSetting]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[UserSetting] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: User Settings */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJUserSetting] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: User Settings */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: User Settings
-- Item: spDeleteMJUserSetting
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR UserSetting
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJUserSetting]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJUserSetting];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJUserSetting]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[UserSetting]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJUserSetting] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: User Settings */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJUserSetting] TO [cdp_Integration]



/* Base View SQL for MJ: Vector Databases */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Vector Databases
-- Item: vwVectorDatabases
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Vector Databases
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  VectorDatabase
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwVectorDatabases]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwVectorDatabases];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwVectorDatabases]
AS
SELECT
    m.*
FROM
    [${flyway:defaultSchema}].[VectorDatabase] AS m
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwVectorDatabases] TO [cdp_Integration], [cdp_UI], [cdp_Developer]
    

/* Base View Permissions SQL for MJ: Vector Databases */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Vector Databases
-- Item: Permissions for vwVectorDatabases
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwVectorDatabases] TO [cdp_Integration], [cdp_UI], [cdp_Developer]

/* spCreate SQL for MJ: Vector Databases */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Vector Databases
-- Item: spCreateMJVectorDatabase
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR VectorDatabase
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJVectorDatabase]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJVectorDatabase];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJVectorDatabase]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(100),
    @Description nvarchar(MAX),
    @DefaultURL nvarchar(255),
    @ClassKey nvarchar(100)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[VectorDatabase]
            (
                [ID],
                [Name],
                [Description],
                [DefaultURL],
                [ClassKey]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description,
                @DefaultURL,
                @ClassKey
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[VectorDatabase]
            (
                [Name],
                [Description],
                [DefaultURL],
                [ClassKey]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description,
                @DefaultURL,
                @ClassKey
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwVectorDatabases] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJVectorDatabase] TO [cdp_Integration], [cdp_Developer]
    

/* spCreate Permissions for MJ: Vector Databases */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJVectorDatabase] TO [cdp_Integration], [cdp_Developer]



/* spUpdate SQL for MJ: Vector Databases */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Vector Databases
-- Item: spUpdateMJVectorDatabase
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR VectorDatabase
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJVectorDatabase]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJVectorDatabase];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJVectorDatabase]
    @ID uniqueidentifier,
    @Name nvarchar(100),
    @Description nvarchar(MAX),
    @DefaultURL nvarchar(255),
    @ClassKey nvarchar(100)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[VectorDatabase]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [DefaultURL] = @DefaultURL,
        [ClassKey] = @ClassKey
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwVectorDatabases] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwVectorDatabases]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJVectorDatabase] TO [cdp_Integration], [cdp_Developer]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the VectorDatabase table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJVectorDatabase]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJVectorDatabase];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJVectorDatabase
ON [${flyway:defaultSchema}].[VectorDatabase]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[VectorDatabase]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[VectorDatabase] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Vector Databases */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJVectorDatabase] TO [cdp_Integration], [cdp_Developer]



/* spDelete SQL for MJ: Vector Databases */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Vector Databases
-- Item: spDeleteMJVectorDatabase
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR VectorDatabase
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJVectorDatabase]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJVectorDatabase];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJVectorDatabase]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[VectorDatabase]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJVectorDatabase] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Vector Databases */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJVectorDatabase] TO [cdp_Integration]



/* Base View SQL for MJ: Vector Indexes */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Vector Indexes
-- Item: vwVectorIndexes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Vector Indexes
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  VectorIndex
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwVectorIndexes]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwVectorIndexes];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwVectorIndexes]
AS
SELECT
    m.*,
    MJVectorDatabases_VectorDatabaseID.[Name] AS [VectorDatabase],
    MJAIModels_EmbeddingModelID.[Name] AS [EmbeddingModel]
FROM
    [${flyway:defaultSchema}].[VectorIndex] AS m
INNER JOIN
    [${flyway:defaultSchema}].[VectorDatabase] AS MJVectorDatabases_VectorDatabaseID
  ON
    [m].[VectorDatabaseID] = MJVectorDatabases_VectorDatabaseID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[AIModel] AS MJAIModels_EmbeddingModelID
  ON
    [m].[EmbeddingModelID] = MJAIModels_EmbeddingModelID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwVectorIndexes] TO [cdp_Integration], [cdp_UI], [cdp_Developer]
    

/* Base View Permissions SQL for MJ: Vector Indexes */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Vector Indexes
-- Item: Permissions for vwVectorIndexes
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwVectorIndexes] TO [cdp_Integration], [cdp_UI], [cdp_Developer]

/* spCreate SQL for MJ: Vector Indexes */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Vector Indexes
-- Item: spCreateMJVectorIndex
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR VectorIndex
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJVectorIndex]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJVectorIndex];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJVectorIndex]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @VectorDatabaseID uniqueidentifier,
    @EmbeddingModelID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[VectorIndex]
            (
                [ID],
                [Name],
                [Description],
                [VectorDatabaseID],
                [EmbeddingModelID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description,
                @VectorDatabaseID,
                @EmbeddingModelID
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[VectorIndex]
            (
                [Name],
                [Description],
                [VectorDatabaseID],
                [EmbeddingModelID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description,
                @VectorDatabaseID,
                @EmbeddingModelID
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwVectorIndexes] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJVectorIndex] TO [cdp_Integration], [cdp_Developer]
    

/* spCreate Permissions for MJ: Vector Indexes */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJVectorIndex] TO [cdp_Integration], [cdp_Developer]



/* spUpdate SQL for MJ: Vector Indexes */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Vector Indexes
-- Item: spUpdateMJVectorIndex
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR VectorIndex
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJVectorIndex]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJVectorIndex];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJVectorIndex]
    @ID uniqueidentifier,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @VectorDatabaseID uniqueidentifier,
    @EmbeddingModelID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[VectorIndex]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [VectorDatabaseID] = @VectorDatabaseID,
        [EmbeddingModelID] = @EmbeddingModelID
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwVectorIndexes] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwVectorIndexes]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJVectorIndex] TO [cdp_Integration], [cdp_Developer]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the VectorIndex table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJVectorIndex]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJVectorIndex];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJVectorIndex
ON [${flyway:defaultSchema}].[VectorIndex]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[VectorIndex]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[VectorIndex] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Vector Indexes */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJVectorIndex] TO [cdp_Integration], [cdp_Developer]



/* spDelete SQL for MJ: Vector Indexes */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Vector Indexes
-- Item: spDeleteMJVectorIndex
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR VectorIndex
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJVectorIndex]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJVectorIndex];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJVectorIndex]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[VectorIndex]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJVectorIndex] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Vector Indexes */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJVectorIndex] TO [cdp_Integration]



/* Base View SQL for MJ: Version Label Items */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Version Label Items
-- Item: vwVersionLabelItems
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Version Label Items
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  VersionLabelItem
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwVersionLabelItems]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwVersionLabelItems];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwVersionLabelItems]
AS
SELECT
    m.*,
    MJVersionLabels_VersionLabelID.[Name] AS [VersionLabel],
    MJRecordChanges_RecordChangeID.[ChangesDescription] AS [RecordChange],
    MJEntities_EntityID.[Name] AS [Entity]
FROM
    [${flyway:defaultSchema}].[VersionLabelItem] AS m
INNER JOIN
    [${flyway:defaultSchema}].[VersionLabel] AS MJVersionLabels_VersionLabelID
  ON
    [m].[VersionLabelID] = MJVersionLabels_VersionLabelID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[RecordChange] AS MJRecordChanges_RecordChangeID
  ON
    [m].[RecordChangeID] = MJRecordChanges_RecordChangeID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[Entity] AS MJEntities_EntityID
  ON
    [m].[EntityID] = MJEntities_EntityID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwVersionLabelItems] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Version Label Items */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Version Label Items
-- Item: Permissions for vwVersionLabelItems
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwVersionLabelItems] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Version Label Items */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Version Label Items
-- Item: spCreateMJVersionLabelItem
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR VersionLabelItem
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJVersionLabelItem]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJVersionLabelItem];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJVersionLabelItem]
    @ID uniqueidentifier = NULL,
    @VersionLabelID uniqueidentifier,
    @RecordChangeID uniqueidentifier,
    @EntityID uniqueidentifier,
    @RecordID nvarchar(750)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[VersionLabelItem]
            (
                [ID],
                [VersionLabelID],
                [RecordChangeID],
                [EntityID],
                [RecordID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @VersionLabelID,
                @RecordChangeID,
                @EntityID,
                @RecordID
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[VersionLabelItem]
            (
                [VersionLabelID],
                [RecordChangeID],
                [EntityID],
                [RecordID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @VersionLabelID,
                @RecordChangeID,
                @EntityID,
                @RecordID
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwVersionLabelItems] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJVersionLabelItem] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Version Label Items */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJVersionLabelItem] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Version Label Items */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Version Label Items
-- Item: spUpdateMJVersionLabelItem
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR VersionLabelItem
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJVersionLabelItem]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJVersionLabelItem];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJVersionLabelItem]
    @ID uniqueidentifier,
    @VersionLabelID uniqueidentifier,
    @RecordChangeID uniqueidentifier,
    @EntityID uniqueidentifier,
    @RecordID nvarchar(750)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[VersionLabelItem]
    SET
        [VersionLabelID] = @VersionLabelID,
        [RecordChangeID] = @RecordChangeID,
        [EntityID] = @EntityID,
        [RecordID] = @RecordID
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwVersionLabelItems] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwVersionLabelItems]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJVersionLabelItem] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the VersionLabelItem table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJVersionLabelItem]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJVersionLabelItem];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJVersionLabelItem
ON [${flyway:defaultSchema}].[VersionLabelItem]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[VersionLabelItem]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[VersionLabelItem] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Version Label Items */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJVersionLabelItem] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Version Label Items */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Version Label Items
-- Item: spDeleteMJVersionLabelItem
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR VersionLabelItem
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJVersionLabelItem]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJVersionLabelItem];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJVersionLabelItem]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[VersionLabelItem]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJVersionLabelItem] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Version Label Items */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJVersionLabelItem] TO [cdp_Integration]



/* Base View SQL for MJ: Version Labels */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Version Labels
-- Item: vwVersionLabels
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Version Labels
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  VersionLabel
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwVersionLabels]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwVersionLabels];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwVersionLabels]
AS
SELECT
    m.*,
    MJEntities_EntityID.[Name] AS [Entity],
    MJVersionLabels_ParentID.[Name] AS [Parent],
    MJUsers_CreatedByUserID.[Name] AS [CreatedByUser],
    root_ParentID.RootID AS [RootParentID]
FROM
    [${flyway:defaultSchema}].[VersionLabel] AS m
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[Entity] AS MJEntities_EntityID
  ON
    [m].[EntityID] = MJEntities_EntityID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[VersionLabel] AS MJVersionLabels_ParentID
  ON
    [m].[ParentID] = MJVersionLabels_ParentID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_CreatedByUserID
  ON
    [m].[CreatedByUserID] = MJUsers_CreatedByUserID.[ID]
OUTER APPLY
    [${flyway:defaultSchema}].[fnVersionLabelParentID_GetRootID]([m].[ID], [m].[ParentID]) AS root_ParentID
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwVersionLabels] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Version Labels */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Version Labels
-- Item: Permissions for vwVersionLabels
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwVersionLabels] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Version Labels */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Version Labels
-- Item: spCreateMJVersionLabel
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR VersionLabel
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJVersionLabel]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJVersionLabel];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJVersionLabel]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(200),
    @Description nvarchar(MAX),
    @Scope nvarchar(50) = NULL,
    @EntityID uniqueidentifier,
    @RecordID nvarchar(750),
    @ParentID uniqueidentifier,
    @Status nvarchar(50) = NULL,
    @CreatedByUserID uniqueidentifier,
    @ExternalSystemID nvarchar(200),
    @ItemCount int = NULL,
    @CreationDurationMS int = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[VersionLabel]
            (
                [ID],
                [Name],
                [Description],
                [Scope],
                [EntityID],
                [RecordID],
                [ParentID],
                [Status],
                [CreatedByUserID],
                [ExternalSystemID],
                [ItemCount],
                [CreationDurationMS]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description,
                ISNULL(@Scope, 'Record'),
                @EntityID,
                @RecordID,
                @ParentID,
                ISNULL(@Status, 'Active'),
                @CreatedByUserID,
                @ExternalSystemID,
                ISNULL(@ItemCount, 0),
                ISNULL(@CreationDurationMS, 0)
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[VersionLabel]
            (
                [Name],
                [Description],
                [Scope],
                [EntityID],
                [RecordID],
                [ParentID],
                [Status],
                [CreatedByUserID],
                [ExternalSystemID],
                [ItemCount],
                [CreationDurationMS]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description,
                ISNULL(@Scope, 'Record'),
                @EntityID,
                @RecordID,
                @ParentID,
                ISNULL(@Status, 'Active'),
                @CreatedByUserID,
                @ExternalSystemID,
                ISNULL(@ItemCount, 0),
                ISNULL(@CreationDurationMS, 0)
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwVersionLabels] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJVersionLabel] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Version Labels */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJVersionLabel] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Version Labels */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Version Labels
-- Item: spUpdateMJVersionLabel
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR VersionLabel
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJVersionLabel]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJVersionLabel];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJVersionLabel]
    @ID uniqueidentifier,
    @Name nvarchar(200),
    @Description nvarchar(MAX),
    @Scope nvarchar(50),
    @EntityID uniqueidentifier,
    @RecordID nvarchar(750),
    @ParentID uniqueidentifier,
    @Status nvarchar(50),
    @CreatedByUserID uniqueidentifier,
    @ExternalSystemID nvarchar(200),
    @ItemCount int,
    @CreationDurationMS int
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[VersionLabel]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [Scope] = @Scope,
        [EntityID] = @EntityID,
        [RecordID] = @RecordID,
        [ParentID] = @ParentID,
        [Status] = @Status,
        [CreatedByUserID] = @CreatedByUserID,
        [ExternalSystemID] = @ExternalSystemID,
        [ItemCount] = @ItemCount,
        [CreationDurationMS] = @CreationDurationMS
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwVersionLabels] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwVersionLabels]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJVersionLabel] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the VersionLabel table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJVersionLabel]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJVersionLabel];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJVersionLabel
ON [${flyway:defaultSchema}].[VersionLabel]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[VersionLabel]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[VersionLabel] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Version Labels */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJVersionLabel] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Version Labels */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Version Labels
-- Item: spDeleteMJVersionLabel
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR VersionLabel
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJVersionLabel]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJVersionLabel];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJVersionLabel]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[VersionLabel]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJVersionLabel] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Version Labels */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJVersionLabel] TO [cdp_Integration]



/* Base View SQL for MJ: Version Label Restores */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Version Label Restores
-- Item: vwVersionLabelRestores
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Version Label Restores
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  VersionLabelRestore
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwVersionLabelRestores]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwVersionLabelRestores];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwVersionLabelRestores]
AS
SELECT
    m.*,
    MJVersionLabels_VersionLabelID.[Name] AS [VersionLabel],
    MJUsers_UserID.[Name] AS [User],
    MJVersionLabels_PreRestoreLabelID.[Name] AS [PreRestoreLabel]
FROM
    [${flyway:defaultSchema}].[VersionLabelRestore] AS m
INNER JOIN
    [${flyway:defaultSchema}].[VersionLabel] AS MJVersionLabels_VersionLabelID
  ON
    [m].[VersionLabelID] = MJVersionLabels_VersionLabelID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_UserID
  ON
    [m].[UserID] = MJUsers_UserID.[ID]
LEFT OUTER JOIN
    [${flyway:defaultSchema}].[VersionLabel] AS MJVersionLabels_PreRestoreLabelID
  ON
    [m].[PreRestoreLabelID] = MJVersionLabels_PreRestoreLabelID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwVersionLabelRestores] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Version Label Restores */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Version Label Restores
-- Item: Permissions for vwVersionLabelRestores
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwVersionLabelRestores] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Version Label Restores */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Version Label Restores
-- Item: spCreateMJVersionLabelRestore
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR VersionLabelRestore
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJVersionLabelRestore]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJVersionLabelRestore];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJVersionLabelRestore]
    @ID uniqueidentifier = NULL,
    @VersionLabelID uniqueidentifier,
    @Status nvarchar(50) = NULL,
    @StartedAt datetimeoffset = NULL,
    @EndedAt datetimeoffset,
    @UserID uniqueidentifier,
    @TotalItems int = NULL,
    @CompletedItems int = NULL,
    @FailedItems int = NULL,
    @ErrorLog nvarchar(MAX),
    @PreRestoreLabelID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[VersionLabelRestore]
            (
                [ID],
                [VersionLabelID],
                [Status],
                [StartedAt],
                [EndedAt],
                [UserID],
                [TotalItems],
                [CompletedItems],
                [FailedItems],
                [ErrorLog],
                [PreRestoreLabelID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @VersionLabelID,
                ISNULL(@Status, 'Pending'),
                ISNULL(@StartedAt, getutcdate()),
                @EndedAt,
                @UserID,
                ISNULL(@TotalItems, 0),
                ISNULL(@CompletedItems, 0),
                ISNULL(@FailedItems, 0),
                @ErrorLog,
                @PreRestoreLabelID
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[VersionLabelRestore]
            (
                [VersionLabelID],
                [Status],
                [StartedAt],
                [EndedAt],
                [UserID],
                [TotalItems],
                [CompletedItems],
                [FailedItems],
                [ErrorLog],
                [PreRestoreLabelID]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @VersionLabelID,
                ISNULL(@Status, 'Pending'),
                ISNULL(@StartedAt, getutcdate()),
                @EndedAt,
                @UserID,
                ISNULL(@TotalItems, 0),
                ISNULL(@CompletedItems, 0),
                ISNULL(@FailedItems, 0),
                @ErrorLog,
                @PreRestoreLabelID
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwVersionLabelRestores] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJVersionLabelRestore] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Version Label Restores */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJVersionLabelRestore] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Version Label Restores */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Version Label Restores
-- Item: spUpdateMJVersionLabelRestore
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR VersionLabelRestore
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJVersionLabelRestore]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJVersionLabelRestore];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJVersionLabelRestore]
    @ID uniqueidentifier,
    @VersionLabelID uniqueidentifier,
    @Status nvarchar(50),
    @StartedAt datetimeoffset,
    @EndedAt datetimeoffset,
    @UserID uniqueidentifier,
    @TotalItems int,
    @CompletedItems int,
    @FailedItems int,
    @ErrorLog nvarchar(MAX),
    @PreRestoreLabelID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[VersionLabelRestore]
    SET
        [VersionLabelID] = @VersionLabelID,
        [Status] = @Status,
        [StartedAt] = @StartedAt,
        [EndedAt] = @EndedAt,
        [UserID] = @UserID,
        [TotalItems] = @TotalItems,
        [CompletedItems] = @CompletedItems,
        [FailedItems] = @FailedItems,
        [ErrorLog] = @ErrorLog,
        [PreRestoreLabelID] = @PreRestoreLabelID
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwVersionLabelRestores] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwVersionLabelRestores]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJVersionLabelRestore] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the VersionLabelRestore table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJVersionLabelRestore]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJVersionLabelRestore];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJVersionLabelRestore
ON [${flyway:defaultSchema}].[VersionLabelRestore]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[VersionLabelRestore]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[VersionLabelRestore] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Version Label Restores */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJVersionLabelRestore] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Version Label Restores */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Version Label Restores
-- Item: spDeleteMJVersionLabelRestore
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR VersionLabelRestore
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJVersionLabelRestore]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJVersionLabelRestore];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJVersionLabelRestore]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[VersionLabelRestore]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJVersionLabelRestore] TO [cdp_Integration]
    

/* spDelete Permissions for MJ: Version Label Restores */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJVersionLabelRestore] TO [cdp_Integration]



/* Base View SQL for MJ: Workflow Engines */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Workflow Engines
-- Item: vwWorkflowEngines
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Workflow Engines
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  WorkflowEngine
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwWorkflowEngines]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwWorkflowEngines];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwWorkflowEngines]
AS
SELECT
    m.*
FROM
    [${flyway:defaultSchema}].[WorkflowEngine] AS m
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwWorkflowEngines] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Workflow Engines */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Workflow Engines
-- Item: Permissions for vwWorkflowEngines
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwWorkflowEngines] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Workflow Engines */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Workflow Engines
-- Item: spCreateMJWorkflowEngine
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR WorkflowEngine
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJWorkflowEngine]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJWorkflowEngine];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJWorkflowEngine]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(100),
    @Description nvarchar(MAX),
    @DriverPath nvarchar(500),
    @DriverClass nvarchar(100)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[WorkflowEngine]
            (
                [ID],
                [Name],
                [Description],
                [DriverPath],
                [DriverClass]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description,
                @DriverPath,
                @DriverClass
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[WorkflowEngine]
            (
                [Name],
                [Description],
                [DriverPath],
                [DriverClass]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description,
                @DriverPath,
                @DriverClass
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwWorkflowEngines] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJWorkflowEngine] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Workflow Engines */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJWorkflowEngine] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Workflow Engines */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Workflow Engines
-- Item: spUpdateMJWorkflowEngine
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR WorkflowEngine
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJWorkflowEngine]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJWorkflowEngine];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJWorkflowEngine]
    @ID uniqueidentifier,
    @Name nvarchar(100),
    @Description nvarchar(MAX),
    @DriverPath nvarchar(500),
    @DriverClass nvarchar(100)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[WorkflowEngine]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [DriverPath] = @DriverPath,
        [DriverClass] = @DriverClass
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwWorkflowEngines] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwWorkflowEngines]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJWorkflowEngine] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the WorkflowEngine table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJWorkflowEngine]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJWorkflowEngine];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJWorkflowEngine
ON [${flyway:defaultSchema}].[WorkflowEngine]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[WorkflowEngine]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[WorkflowEngine] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Workflow Engines */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJWorkflowEngine] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Workflow Engines */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Workflow Engines
-- Item: spDeleteMJWorkflowEngine
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR WorkflowEngine
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJWorkflowEngine]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJWorkflowEngine];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJWorkflowEngine]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[WorkflowEngine]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJWorkflowEngine] TO [cdp_Developer], [cdp_Integration]
    

/* spDelete Permissions for MJ: Workflow Engines */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJWorkflowEngine] TO [cdp_Developer], [cdp_Integration]



/* Index for Foreign Keys for PipelineStage */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Pipeline Stages
-- Item: Index for Foreign Keys
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------
-- Index for foreign key PipelineID in table PipelineStage
IF NOT EXISTS (
    SELECT 1
    FROM sys.indexes
    WHERE name = 'IDX_AUTO_MJ_FKEY_PipelineStage_PipelineID' 
    AND object_id = OBJECT_ID('[sample_crm].[PipelineStage]')
)
CREATE INDEX IDX_AUTO_MJ_FKEY_PipelineStage_PipelineID ON [sample_crm].[PipelineStage] ([PipelineID]);

/* SQL text to update entity field related entity name field map for entity field ID 5250FF72-C47E-4C12-9C4D-68B6A320C408 */
EXEC [${flyway:defaultSchema}].spUpdateEntityFieldRelatedEntityNameFieldMap
         @EntityFieldID='5250FF72-C47E-4C12-9C4D-68B6A320C408',
         @RelatedEntityNameFieldMap='Pipeline'

/* Index for Foreign Keys for Pipeline */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Pipelines
-- Item: Index for Foreign Keys
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------


/* Base View SQL for Pipelines */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Pipelines
-- Item: vwPipelines
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      Pipelines
-----               SCHEMA:      sample_crm
-----               BASE TABLE:  Pipeline
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[sample_crm].[vwPipelines]', 'V') IS NOT NULL
    DROP VIEW [sample_crm].[vwPipelines];
GO

CREATE VIEW [sample_crm].[vwPipelines]
AS
SELECT
    p.*
FROM
    [sample_crm].[Pipeline] AS p
GO
GRANT SELECT ON [sample_crm].[vwPipelines] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for Pipelines */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Pipelines
-- Item: Permissions for vwPipelines
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [sample_crm].[vwPipelines] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for Pipelines */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Pipelines
-- Item: spCreatePipeline
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR Pipeline
------------------------------------------------------------
IF OBJECT_ID('[sample_crm].[spCreatePipeline]', 'P') IS NOT NULL
    DROP PROCEDURE [sample_crm].[spCreatePipeline];
GO

CREATE PROCEDURE [sample_crm].[spCreatePipeline]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(200),
    @Description nvarchar(MAX),
    @IsDefault bit = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [sample_crm].[Pipeline]
            (
                [ID],
                [Name],
                [Description],
                [IsDefault]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description,
                ISNULL(@IsDefault, 0)
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [sample_crm].[Pipeline]
            (
                [Name],
                [Description],
                [IsDefault]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description,
                ISNULL(@IsDefault, 0)
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [sample_crm].[vwPipelines] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [sample_crm].[spCreatePipeline] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for Pipelines */

GRANT EXECUTE ON [sample_crm].[spCreatePipeline] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for Pipelines */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Pipelines
-- Item: spUpdatePipeline
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR Pipeline
------------------------------------------------------------
IF OBJECT_ID('[sample_crm].[spUpdatePipeline]', 'P') IS NOT NULL
    DROP PROCEDURE [sample_crm].[spUpdatePipeline];
GO

CREATE PROCEDURE [sample_crm].[spUpdatePipeline]
    @ID uniqueidentifier,
    @Name nvarchar(200),
    @Description nvarchar(MAX),
    @IsDefault bit
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [sample_crm].[Pipeline]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [IsDefault] = @IsDefault
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [sample_crm].[vwPipelines] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [sample_crm].[vwPipelines]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [sample_crm].[spUpdatePipeline] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the Pipeline table
------------------------------------------------------------
IF OBJECT_ID('[sample_crm].[trgUpdatePipeline]', 'TR') IS NOT NULL
    DROP TRIGGER [sample_crm].[trgUpdatePipeline];
GO
CREATE TRIGGER [sample_crm].trgUpdatePipeline
ON [sample_crm].[Pipeline]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [sample_crm].[Pipeline]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [sample_crm].[Pipeline] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for Pipelines */

GRANT EXECUTE ON [sample_crm].[spUpdatePipeline] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for Pipelines */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Pipelines
-- Item: spDeletePipeline
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR Pipeline
------------------------------------------------------------
IF OBJECT_ID('[sample_crm].[spDeletePipeline]', 'P') IS NOT NULL
    DROP PROCEDURE [sample_crm].[spDeletePipeline];
GO

CREATE PROCEDURE [sample_crm].[spDeletePipeline]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [sample_crm].[Pipeline]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [sample_crm].[spDeletePipeline] TO [cdp_Integration]
    

/* spDelete Permissions for Pipelines */

GRANT EXECUTE ON [sample_crm].[spDeletePipeline] TO [cdp_Integration]



/* Base View SQL for MJ: Workspaces */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Workspaces
-- Item: vwWorkspaces
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Workspaces
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  Workspace
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwWorkspaces]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwWorkspaces];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwWorkspaces]
AS
SELECT
    m.*,
    MJUsers_UserID.[Name] AS [User]
FROM
    [${flyway:defaultSchema}].[Workspace] AS m
INNER JOIN
    [${flyway:defaultSchema}].[User] AS MJUsers_UserID
  ON
    [m].[UserID] = MJUsers_UserID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwWorkspaces] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Workspaces */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Workspaces
-- Item: Permissions for vwWorkspaces
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwWorkspaces] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Workspaces */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Workspaces
-- Item: spCreateMJWorkspace
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR Workspace
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJWorkspace]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJWorkspace];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJWorkspace]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @UserID uniqueidentifier,
    @Configuration nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[Workspace]
            (
                [ID],
                [Name],
                [Description],
                [UserID],
                [Configuration]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description,
                @UserID,
                @Configuration
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[Workspace]
            (
                [Name],
                [Description],
                [UserID],
                [Configuration]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description,
                @UserID,
                @Configuration
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwWorkspaces] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJWorkspace] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Workspaces */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJWorkspace] TO [cdp_UI], [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Workspaces */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Workspaces
-- Item: spUpdateMJWorkspace
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR Workspace
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJWorkspace]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJWorkspace];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJWorkspace]
    @ID uniqueidentifier,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @UserID uniqueidentifier,
    @Configuration nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[Workspace]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [UserID] = @UserID,
        [Configuration] = @Configuration
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwWorkspaces] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwWorkspaces]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJWorkspace] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the Workspace table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJWorkspace]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJWorkspace];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJWorkspace
ON [${flyway:defaultSchema}].[Workspace]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[Workspace]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[Workspace] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Workspaces */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJWorkspace] TO [cdp_UI], [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Workspaces */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Workspaces
-- Item: spDeleteMJWorkspace
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR Workspace
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJWorkspace]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJWorkspace];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJWorkspace]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[Workspace]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJWorkspace] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* spDelete Permissions for MJ: Workspaces */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJWorkspace] TO [cdp_UI], [cdp_Developer], [cdp_Integration]



/* Base View SQL for MJ: Workspace Items */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Workspace Items
-- Item: vwWorkspaceItems
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      MJ: Workspace Items
-----               SCHEMA:      ${flyway:defaultSchema}
-----               BASE TABLE:  WorkspaceItem
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[vwWorkspaceItems]', 'V') IS NOT NULL
    DROP VIEW [${flyway:defaultSchema}].[vwWorkspaceItems];
GO

CREATE VIEW [${flyway:defaultSchema}].[vwWorkspaceItems]
AS
SELECT
    m.*,
    MJWorkspaces_WorkspaceID.[Name] AS [Workspace],
    MJResourceTypes_ResourceTypeID.[Name] AS [ResourceType]
FROM
    [${flyway:defaultSchema}].[WorkspaceItem] AS m
INNER JOIN
    [${flyway:defaultSchema}].[Workspace] AS MJWorkspaces_WorkspaceID
  ON
    [m].[WorkspaceID] = MJWorkspaces_WorkspaceID.[ID]
INNER JOIN
    [${flyway:defaultSchema}].[ResourceType] AS MJResourceTypes_ResourceTypeID
  ON
    [m].[ResourceTypeID] = MJResourceTypes_ResourceTypeID.[ID]
GO
GRANT SELECT ON [${flyway:defaultSchema}].[vwWorkspaceItems] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for MJ: Workspace Items */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Workspace Items
-- Item: Permissions for vwWorkspaceItems
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [${flyway:defaultSchema}].[vwWorkspaceItems] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for MJ: Workspace Items */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Workspace Items
-- Item: spCreateMJWorkspaceItem
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR WorkspaceItem
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spCreateMJWorkspaceItem]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spCreateMJWorkspaceItem];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spCreateMJWorkspaceItem]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @WorkspaceID uniqueidentifier,
    @ResourceTypeID uniqueidentifier,
    @ResourceRecordID nvarchar(2000),
    @Sequence int,
    @Configuration nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [${flyway:defaultSchema}].[WorkspaceItem]
            (
                [ID],
                [Name],
                [Description],
                [WorkspaceID],
                [ResourceTypeID],
                [ResourceRecordID],
                [Sequence],
                [Configuration]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Description,
                @WorkspaceID,
                @ResourceTypeID,
                @ResourceRecordID,
                @Sequence,
                @Configuration
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [${flyway:defaultSchema}].[WorkspaceItem]
            (
                [Name],
                [Description],
                [WorkspaceID],
                [ResourceTypeID],
                [ResourceRecordID],
                [Sequence],
                [Configuration]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Description,
                @WorkspaceID,
                @ResourceTypeID,
                @ResourceRecordID,
                @Sequence,
                @Configuration
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [${flyway:defaultSchema}].[vwWorkspaceItems] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJWorkspaceItem] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for MJ: Workspace Items */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spCreateMJWorkspaceItem] TO [cdp_UI], [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for MJ: Workspace Items */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Workspace Items
-- Item: spUpdateMJWorkspaceItem
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR WorkspaceItem
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spUpdateMJWorkspaceItem]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spUpdateMJWorkspaceItem];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spUpdateMJWorkspaceItem]
    @ID uniqueidentifier,
    @Name nvarchar(255),
    @Description nvarchar(MAX),
    @WorkspaceID uniqueidentifier,
    @ResourceTypeID uniqueidentifier,
    @ResourceRecordID nvarchar(2000),
    @Sequence int,
    @Configuration nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[WorkspaceItem]
    SET
        [Name] = @Name,
        [Description] = @Description,
        [WorkspaceID] = @WorkspaceID,
        [ResourceTypeID] = @ResourceTypeID,
        [ResourceRecordID] = @ResourceRecordID,
        [Sequence] = @Sequence,
        [Configuration] = @Configuration
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [${flyway:defaultSchema}].[vwWorkspaceItems] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [${flyway:defaultSchema}].[vwWorkspaceItems]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJWorkspaceItem] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the WorkspaceItem table
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[trgUpdateMJWorkspaceItem]', 'TR') IS NOT NULL
    DROP TRIGGER [${flyway:defaultSchema}].[trgUpdateMJWorkspaceItem];
GO
CREATE TRIGGER [${flyway:defaultSchema}].trgUpdateMJWorkspaceItem
ON [${flyway:defaultSchema}].[WorkspaceItem]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [${flyway:defaultSchema}].[WorkspaceItem]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [${flyway:defaultSchema}].[WorkspaceItem] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for MJ: Workspace Items */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spUpdateMJWorkspaceItem] TO [cdp_UI], [cdp_Developer], [cdp_Integration]



/* spDelete SQL for MJ: Workspace Items */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: MJ: Workspace Items
-- Item: spDeleteMJWorkspaceItem
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR WorkspaceItem
------------------------------------------------------------
IF OBJECT_ID('[${flyway:defaultSchema}].[spDeleteMJWorkspaceItem]', 'P') IS NOT NULL
    DROP PROCEDURE [${flyway:defaultSchema}].[spDeleteMJWorkspaceItem];
GO

CREATE PROCEDURE [${flyway:defaultSchema}].[spDeleteMJWorkspaceItem]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [${flyway:defaultSchema}].[WorkspaceItem]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJWorkspaceItem] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* spDelete Permissions for MJ: Workspace Items */

GRANT EXECUTE ON [${flyway:defaultSchema}].[spDeleteMJWorkspaceItem] TO [cdp_UI], [cdp_Developer], [cdp_Integration]



/* Base View SQL for Pipeline Stages */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Pipeline Stages
-- Item: vwPipelineStages
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      Pipeline Stages
-----               SCHEMA:      sample_crm
-----               BASE TABLE:  PipelineStage
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[sample_crm].[vwPipelineStages]', 'V') IS NOT NULL
    DROP VIEW [sample_crm].[vwPipelineStages];
GO

CREATE VIEW [sample_crm].[vwPipelineStages]
AS
SELECT
    p.*,
    Pipelines_PipelineID.[Name] AS [Pipeline]
FROM
    [sample_crm].[PipelineStage] AS p
INNER JOIN
    [sample_crm].[Pipeline] AS Pipelines_PipelineID
  ON
    [p].[PipelineID] = Pipelines_PipelineID.[ID]
GO
GRANT SELECT ON [sample_crm].[vwPipelineStages] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for Pipeline Stages */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Pipeline Stages
-- Item: Permissions for vwPipelineStages
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [sample_crm].[vwPipelineStages] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for Pipeline Stages */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Pipeline Stages
-- Item: spCreatePipelineStage
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR PipelineStage
------------------------------------------------------------
IF OBJECT_ID('[sample_crm].[spCreatePipelineStage]', 'P') IS NOT NULL
    DROP PROCEDURE [sample_crm].[spCreatePipelineStage];
GO

CREATE PROCEDURE [sample_crm].[spCreatePipelineStage]
    @ID uniqueidentifier = NULL,
    @PipelineID uniqueidentifier,
    @Name nvarchar(100),
    @DisplayOrder int,
    @Probability int = NULL
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [sample_crm].[PipelineStage]
            (
                [ID],
                [PipelineID],
                [Name],
                [DisplayOrder],
                [Probability]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @PipelineID,
                @Name,
                @DisplayOrder,
                ISNULL(@Probability, 0)
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [sample_crm].[PipelineStage]
            (
                [PipelineID],
                [Name],
                [DisplayOrder],
                [Probability]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @PipelineID,
                @Name,
                @DisplayOrder,
                ISNULL(@Probability, 0)
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [sample_crm].[vwPipelineStages] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [sample_crm].[spCreatePipelineStage] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for Pipeline Stages */

GRANT EXECUTE ON [sample_crm].[spCreatePipelineStage] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for Pipeline Stages */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Pipeline Stages
-- Item: spUpdatePipelineStage
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR PipelineStage
------------------------------------------------------------
IF OBJECT_ID('[sample_crm].[spUpdatePipelineStage]', 'P') IS NOT NULL
    DROP PROCEDURE [sample_crm].[spUpdatePipelineStage];
GO

CREATE PROCEDURE [sample_crm].[spUpdatePipelineStage]
    @ID uniqueidentifier,
    @PipelineID uniqueidentifier,
    @Name nvarchar(100),
    @DisplayOrder int,
    @Probability int
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [sample_crm].[PipelineStage]
    SET
        [PipelineID] = @PipelineID,
        [Name] = @Name,
        [DisplayOrder] = @DisplayOrder,
        [Probability] = @Probability
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [sample_crm].[vwPipelineStages] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [sample_crm].[vwPipelineStages]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [sample_crm].[spUpdatePipelineStage] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the PipelineStage table
------------------------------------------------------------
IF OBJECT_ID('[sample_crm].[trgUpdatePipelineStage]', 'TR') IS NOT NULL
    DROP TRIGGER [sample_crm].[trgUpdatePipelineStage];
GO
CREATE TRIGGER [sample_crm].trgUpdatePipelineStage
ON [sample_crm].[PipelineStage]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [sample_crm].[PipelineStage]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [sample_crm].[PipelineStage] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for Pipeline Stages */

GRANT EXECUTE ON [sample_crm].[spUpdatePipelineStage] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for Pipeline Stages */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Pipeline Stages
-- Item: spDeletePipelineStage
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR PipelineStage
------------------------------------------------------------
IF OBJECT_ID('[sample_crm].[spDeletePipelineStage]', 'P') IS NOT NULL
    DROP PROCEDURE [sample_crm].[spDeletePipelineStage];
GO

CREATE PROCEDURE [sample_crm].[spDeletePipelineStage]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [sample_crm].[PipelineStage]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [sample_crm].[spDeletePipelineStage] TO [cdp_Integration]
    

/* spDelete Permissions for Pipeline Stages */

GRANT EXECUTE ON [sample_crm].[spDeletePipelineStage] TO [cdp_Integration]



/* Index for Foreign Keys for Product */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Products
-- Item: Index for Foreign Keys
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------


/* Index for Foreign Keys for Tag */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Tags
-- Item: Index for Foreign Keys
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------


/* Base View SQL for Products */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Products
-- Item: vwProducts
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      Products
-----               SCHEMA:      sample_crm
-----               BASE TABLE:  Product
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[sample_crm].[vwProducts]', 'V') IS NOT NULL
    DROP VIEW [sample_crm].[vwProducts];
GO

CREATE VIEW [sample_crm].[vwProducts]
AS
SELECT
    p.*
FROM
    [sample_crm].[Product] AS p
GO
GRANT SELECT ON [sample_crm].[vwProducts] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for Products */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Products
-- Item: Permissions for vwProducts
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [sample_crm].[vwProducts] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for Products */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Products
-- Item: spCreateProduct
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR Product
------------------------------------------------------------
IF OBJECT_ID('[sample_crm].[spCreateProduct]', 'P') IS NOT NULL
    DROP PROCEDURE [sample_crm].[spCreateProduct];
GO

CREATE PROCEDURE [sample_crm].[spCreateProduct]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(200),
    @SKU nvarchar(50),
    @Description nvarchar(MAX),
    @UnitPrice decimal(18, 2),
    @IsActive bit = NULL,
    @Category nvarchar(100)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [sample_crm].[Product]
            (
                [ID],
                [Name],
                [SKU],
                [Description],
                [UnitPrice],
                [IsActive],
                [Category]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @SKU,
                @Description,
                @UnitPrice,
                ISNULL(@IsActive, 1),
                @Category
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [sample_crm].[Product]
            (
                [Name],
                [SKU],
                [Description],
                [UnitPrice],
                [IsActive],
                [Category]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @SKU,
                @Description,
                @UnitPrice,
                ISNULL(@IsActive, 1),
                @Category
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [sample_crm].[vwProducts] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [sample_crm].[spCreateProduct] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for Products */

GRANT EXECUTE ON [sample_crm].[spCreateProduct] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for Products */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Products
-- Item: spUpdateProduct
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR Product
------------------------------------------------------------
IF OBJECT_ID('[sample_crm].[spUpdateProduct]', 'P') IS NOT NULL
    DROP PROCEDURE [sample_crm].[spUpdateProduct];
GO

CREATE PROCEDURE [sample_crm].[spUpdateProduct]
    @ID uniqueidentifier,
    @Name nvarchar(200),
    @SKU nvarchar(50),
    @Description nvarchar(MAX),
    @UnitPrice decimal(18, 2),
    @IsActive bit,
    @Category nvarchar(100)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [sample_crm].[Product]
    SET
        [Name] = @Name,
        [SKU] = @SKU,
        [Description] = @Description,
        [UnitPrice] = @UnitPrice,
        [IsActive] = @IsActive,
        [Category] = @Category
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [sample_crm].[vwProducts] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [sample_crm].[vwProducts]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [sample_crm].[spUpdateProduct] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the Product table
------------------------------------------------------------
IF OBJECT_ID('[sample_crm].[trgUpdateProduct]', 'TR') IS NOT NULL
    DROP TRIGGER [sample_crm].[trgUpdateProduct];
GO
CREATE TRIGGER [sample_crm].trgUpdateProduct
ON [sample_crm].[Product]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [sample_crm].[Product]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [sample_crm].[Product] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for Products */

GRANT EXECUTE ON [sample_crm].[spUpdateProduct] TO [cdp_Developer], [cdp_Integration]



/* Base View SQL for Tags */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Tags
-- Item: vwTags
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- BASE VIEW FOR ENTITY:      Tags
-----               SCHEMA:      sample_crm
-----               BASE TABLE:  Tag
-----               PRIMARY KEY: ID
------------------------------------------------------------
IF OBJECT_ID('[sample_crm].[vwTags]', 'V') IS NOT NULL
    DROP VIEW [sample_crm].[vwTags];
GO

CREATE VIEW [sample_crm].[vwTags]
AS
SELECT
    t.*
FROM
    [sample_crm].[Tag] AS t
GO
GRANT SELECT ON [sample_crm].[vwTags] TO [cdp_UI], [cdp_Developer], [cdp_Integration]
    

/* Base View Permissions SQL for Tags */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Tags
-- Item: Permissions for vwTags
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

GRANT SELECT ON [sample_crm].[vwTags] TO [cdp_UI], [cdp_Developer], [cdp_Integration]

/* spCreate SQL for Tags */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Tags
-- Item: spCreateTag
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- CREATE PROCEDURE FOR Tag
------------------------------------------------------------
IF OBJECT_ID('[sample_crm].[spCreateTag]', 'P') IS NOT NULL
    DROP PROCEDURE [sample_crm].[spCreateTag];
GO

CREATE PROCEDURE [sample_crm].[spCreateTag]
    @ID uniqueidentifier = NULL,
    @Name nvarchar(100),
    @Color nvarchar(7)
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @InsertedRow TABLE ([ID] UNIQUEIDENTIFIER)
    
    IF @ID IS NOT NULL
    BEGIN
        -- User provided a value, use it
        INSERT INTO [sample_crm].[Tag]
            (
                [ID],
                [Name],
                [Color]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @ID,
                @Name,
                @Color
            )
    END
    ELSE
    BEGIN
        -- No value provided, let database use its default (e.g., NEWSEQUENTIALID())
        INSERT INTO [sample_crm].[Tag]
            (
                [Name],
                [Color]
            )
        OUTPUT INSERTED.[ID] INTO @InsertedRow
        VALUES
            (
                @Name,
                @Color
            )
    END
    -- return the new record from the base view, which might have some calculated fields
    SELECT * FROM [sample_crm].[vwTags] WHERE [ID] = (SELECT [ID] FROM @InsertedRow)
END
GO
GRANT EXECUTE ON [sample_crm].[spCreateTag] TO [cdp_Developer], [cdp_Integration]
    

/* spCreate Permissions for Tags */

GRANT EXECUTE ON [sample_crm].[spCreateTag] TO [cdp_Developer], [cdp_Integration]



/* spUpdate SQL for Tags */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Tags
-- Item: spUpdateTag
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR Tag
------------------------------------------------------------
IF OBJECT_ID('[sample_crm].[spUpdateTag]', 'P') IS NOT NULL
    DROP PROCEDURE [sample_crm].[spUpdateTag];
GO

CREATE PROCEDURE [sample_crm].[spUpdateTag]
    @ID uniqueidentifier,
    @Name nvarchar(100),
    @Color nvarchar(7)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [sample_crm].[Tag]
    SET
        [Name] = @Name,
        [Color] = @Color
    WHERE
        [ID] = @ID

    -- Check if the update was successful
    IF @@ROWCOUNT = 0
        -- Nothing was updated, return no rows, but column structure from base view intact, semantically correct this way.
        SELECT TOP 0 * FROM [sample_crm].[vwTags] WHERE 1=0
    ELSE
        -- Return the updated record so the caller can see the updated values and any calculated fields
        SELECT
                                        *
                                    FROM
                                        [sample_crm].[vwTags]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [sample_crm].[spUpdateTag] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the Tag table
------------------------------------------------------------
IF OBJECT_ID('[sample_crm].[trgUpdateTag]', 'TR') IS NOT NULL
    DROP TRIGGER [sample_crm].[trgUpdateTag];
GO
CREATE TRIGGER [sample_crm].trgUpdateTag
ON [sample_crm].[Tag]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [sample_crm].[Tag]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [sample_crm].[Tag] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        

/* spUpdate Permissions for Tags */

GRANT EXECUTE ON [sample_crm].[spUpdateTag] TO [cdp_Developer], [cdp_Integration]



/* spDelete SQL for Products */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Products
-- Item: spDeleteProduct
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR Product
------------------------------------------------------------
IF OBJECT_ID('[sample_crm].[spDeleteProduct]', 'P') IS NOT NULL
    DROP PROCEDURE [sample_crm].[spDeleteProduct];
GO

CREATE PROCEDURE [sample_crm].[spDeleteProduct]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [sample_crm].[Product]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [sample_crm].[spDeleteProduct] TO [cdp_Integration]
    

/* spDelete Permissions for Products */

GRANT EXECUTE ON [sample_crm].[spDeleteProduct] TO [cdp_Integration]



/* spDelete SQL for Tags */
-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Tags
-- Item: spDeleteTag
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- DELETE PROCEDURE FOR Tag
------------------------------------------------------------
IF OBJECT_ID('[sample_crm].[spDeleteTag]', 'P') IS NOT NULL
    DROP PROCEDURE [sample_crm].[spDeleteTag];
GO

CREATE PROCEDURE [sample_crm].[spDeleteTag]
    @ID uniqueidentifier
AS
BEGIN
    SET NOCOUNT ON;

    DELETE FROM
        [sample_crm].[Tag]
    WHERE
        [ID] = @ID


    -- Check if the delete was successful
    IF @@ROWCOUNT = 0
        SELECT NULL AS [ID] -- Return NULL for all primary key fields to indicate no record was deleted
    ELSE
        SELECT @ID AS [ID] -- Return the primary key values to indicate we successfully deleted the record
END
GO
GRANT EXECUTE ON [sample_crm].[spDeleteTag] TO [cdp_Integration]
    

/* spDelete Permissions for Tags */

GRANT EXECUTE ON [sample_crm].[spDeleteTag] TO [cdp_Integration]



/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'a8afdf83-cf16-4729-b416-84e750df964c'  OR 
               (EntityID = 'EFC8B3F3-69E7-48EB-BD3D-0373D6C6DD55' AND Name = 'Company')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'a8afdf83-cf16-4729-b416-84e750df964c',
            'EFC8B3F3-69E7-48EB-BD3D-0373D6C6DD55', -- Entity: Deals
            100029,
            'Company',
            'Company',
            NULL,
            'nvarchar',
            400,
            0,
            0,
            0,
            'null',
            0,
            0,
            1,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'f0ded1e1-74c2-4206-9cf4-90c9ffc51de0'  OR 
               (EntityID = 'EFC8B3F3-69E7-48EB-BD3D-0373D6C6DD55' AND Name = 'AssignedToUser')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'f0ded1e1-74c2-4206-9cf4-90c9ffc51de0',
            'EFC8B3F3-69E7-48EB-BD3D-0373D6C6DD55', -- Entity: Deals
            100030,
            'AssignedToUser',
            'Assigned To User',
            NULL,
            'nvarchar',
            200,
            0,
            0,
            1,
            'null',
            0,
            0,
            1,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'f1132c46-e563-472b-accf-f031be037f48'  OR 
               (EntityID = 'EFC8B3F3-69E7-48EB-BD3D-0373D6C6DD55' AND Name = 'CreatedByUser')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'f1132c46-e563-472b-accf-f031be037f48',
            'EFC8B3F3-69E7-48EB-BD3D-0373D6C6DD55', -- Entity: Deals
            100031,
            'CreatedByUser',
            'Created By User',
            NULL,
            'nvarchar',
            200,
            0,
            0,
            1,
            'null',
            0,
            0,
            1,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '7f889270-4d93-4bc1-83c4-6c6111194946'  OR 
               (EntityID = 'BBCCE24D-C17B-4CC2-992D-0DF2CC14D210' AND Name = 'Deal')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '7f889270-4d93-4bc1-83c4-6c6111194946',
            'BBCCE24D-C17B-4CC2-992D-0DF2CC14D210', -- Entity: Deal Tags
            100011,
            'Deal',
            'Deal',
            NULL,
            'nvarchar',
            400,
            0,
            0,
            0,
            'null',
            0,
            0,
            1,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '4929b7d4-2ff4-4ae1-9da9-a8038056f068'  OR 
               (EntityID = 'BBCCE24D-C17B-4CC2-992D-0DF2CC14D210' AND Name = 'Tag')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '4929b7d4-2ff4-4ae1-9da9-a8038056f068',
            'BBCCE24D-C17B-4CC2-992D-0DF2CC14D210', -- Entity: Deal Tags
            100012,
            'Tag',
            'Tag',
            NULL,
            'nvarchar',
            200,
            0,
            0,
            0,
            'null',
            0,
            0,
            1,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'f13827a1-2076-48e2-b404-92cbae40ad51'  OR 
               (EntityID = 'E1BF8043-C521-444A-8446-339FF0FA032B' AND Name = 'CreatedByUser')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'f13827a1-2076-48e2-b404-92cbae40ad51',
            'E1BF8043-C521-444A-8446-339FF0FA032B', -- Entity: Companies
            100025,
            'CreatedByUser',
            'Created By User',
            NULL,
            'nvarchar',
            200,
            0,
            0,
            1,
            'null',
            0,
            0,
            1,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '88cb11c4-e650-45d4-a154-f1d3e972c803'  OR 
               (EntityID = '2FAF06FC-BBB0-4F84-8D11-3981DFC4BD37' AND Name = 'Deal')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '88cb11c4-e650-45d4-a154-f1d3e972c803',
            '2FAF06FC-BBB0-4F84-8D11-3981DFC4BD37', -- Entity: Deal Products
            100017,
            'Deal',
            'Deal',
            NULL,
            'nvarchar',
            400,
            0,
            0,
            0,
            'null',
            0,
            0,
            1,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'd77c71d6-dafb-41f0-b52a-c631788ddd53'  OR 
               (EntityID = '2FAF06FC-BBB0-4F84-8D11-3981DFC4BD37' AND Name = 'Product')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'd77c71d6-dafb-41f0-b52a-c631788ddd53',
            '2FAF06FC-BBB0-4F84-8D11-3981DFC4BD37', -- Entity: Deal Products
            100018,
            'Product',
            'Product',
            NULL,
            'nvarchar',
            400,
            0,
            0,
            0,
            'null',
            0,
            0,
            1,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '719a3d7d-8f56-49fd-b8f0-e1d2da34f087'  OR 
               (EntityID = 'FBE2251E-61B7-457D-B788-407B4A079C13' AND Name = 'Tag')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '719a3d7d-8f56-49fd-b8f0-e1d2da34f087',
            'FBE2251E-61B7-457D-B788-407B4A079C13', -- Entity: Contact Tags
            100011,
            'Tag',
            'Tag',
            NULL,
            'nvarchar',
            200,
            0,
            0,
            0,
            'null',
            0,
            0,
            1,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '3538d45b-0a3f-46b8-abaf-6f76aac1e4ff'  OR 
               (EntityID = 'A75F1DD8-2146-4D03-AA7F-50D048E44D11' AND Name = 'MCPServerTool')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '3538d45b-0a3f-46b8-abaf-6f76aac1e4ff',
            'A75F1DD8-2146-4D03-AA7F-50D048E44D11', -- Entity: MJ: MCP Server Connection Tools
            100019,
            'MCPServerTool',
            'MCP Server Tool',
            NULL,
            'nvarchar',
            510,
            0,
            0,
            1,
            'null',
            0,
            0,
            1,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '6ac8f1aa-bcb8-4e55-a3e2-0b9cf98e3cb2'  OR 
               (EntityID = '78AD0238-8B56-EF11-991A-6045BDEBA539' AND Name = 'PromptRun')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '6ac8f1aa-bcb8-4e55-a3e2-0b9cf98e3cb2',
            '78AD0238-8B56-EF11-991A-6045BDEBA539', -- Entity: MJ: AI Result Cache
            100041,
            'PromptRun',
            'Prompt Run',
            NULL,
            'nvarchar',
            510,
            0,
            0,
            1,
            'null',
            0,
            0,
            1,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '99fcfd40-2e14-4262-8e1e-30b2f0545a5e'  OR 
               (EntityID = 'D7238F34-2837-EF11-86D4-6045BDEE16E6' AND Name = 'Employee')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '99fcfd40-2e14-4262-8e1e-30b2f0545a5e',
            'D7238F34-2837-EF11-86D4-6045BDEE16E6', -- Entity: MJ: Employee Company Integrations
            100016,
            'Employee',
            'Employee',
            NULL,
            'nvarchar',
            162,
            0,
            0,
            1,
            'null',
            0,
            0,
            1,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '249eaa8a-3cda-427c-a663-21f9311aa8e9'  OR 
               (EntityID = 'D8238F34-2837-EF11-86D4-6045BDEE16E6' AND Name = 'Employee')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '249eaa8a-3cda-427c-a663-21f9311aa8e9',
            'D8238F34-2837-EF11-86D4-6045BDEE16E6', -- Entity: MJ: Employee Roles
            100012,
            'Employee',
            'Employee',
            NULL,
            'nvarchar',
            162,
            0,
            0,
            1,
            'null',
            0,
            0,
            1,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'f7b93f3a-20ce-41a6-96b0-822aa67909c8'  OR 
               (EntityID = 'D9238F34-2837-EF11-86D4-6045BDEE16E6' AND Name = 'Employee')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'f7b93f3a-20ce-41a6-96b0-822aa67909c8',
            'D9238F34-2837-EF11-86D4-6045BDEE16E6', -- Entity: MJ: Employee Skills
            100012,
            'Employee',
            'Employee',
            NULL,
            'nvarchar',
            162,
            0,
            0,
            1,
            'null',
            0,
            0,
            1,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '8230a633-f15e-49e8-b490-bd009eab1706'  OR 
               (EntityID = 'E7238F34-2837-EF11-86D4-6045BDEE16E6' AND Name = 'CompanyIntegrationRun')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '8230a633-f15e-49e8-b490-bd009eab1706',
            'E7238F34-2837-EF11-86D4-6045BDEE16E6', -- Entity: MJ: Error Logs
            100023,
            'CompanyIntegrationRun',
            'Company Integration Run',
            NULL,
            'nvarchar',
            200,
            0,
            0,
            1,
            'null',
            0,
            0,
            1,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'c3c8a723-7e7f-465b-8561-b2542b966742'  OR 
               (EntityID = 'E7238F34-2837-EF11-86D4-6045BDEE16E6' AND Name = 'CompanyIntegrationRunDetail')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'c3c8a723-7e7f-465b-8561-b2542b966742',
            'E7238F34-2837-EF11-86D4-6045BDEE16E6', -- Entity: MJ: Error Logs
            100024,
            'CompanyIntegrationRunDetail',
            'Company Integration Run Detail',
            NULL,
            'nvarchar',
            900,
            0,
            0,
            1,
            'null',
            0,
            0,
            1,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '5857edd6-a95f-4ff4-af2b-c7dcba3d8cf7'  OR 
               (EntityID = 'F5238F34-2837-EF11-86D4-6045BDEE16E6' AND Name = 'ReplayRun')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '5857edd6-a95f-4ff4-af2b-c7dcba3d8cf7',
            'F5238F34-2837-EF11-86D4-6045BDEE16E6', -- Entity: MJ: Record Changes
            100040,
            'ReplayRun',
            'Replay Run',
            NULL,
            'nvarchar',
            200,
            0,
            0,
            1,
            'null',
            0,
            0,
            1,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '21ee033d-95ab-463b-87f7-471c1b50163d'  OR 
               (EntityID = 'F7238F34-2837-EF11-86D4-6045BDEE16E6' AND Name = 'PlatformVariants')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '21ee033d-95ab-463b-87f7-471c1b50163d',
            'F7238F34-2837-EF11-86D4-6045BDEE16E6', -- Entity: MJ: Row Level Security Filters
            100013,
            'PlatformVariants',
            'Platform Variants',
            NULL,
            'nvarchar',
            -1,
            0,
            0,
            1,
            'null',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'd70dd636-6b71-427d-addb-35c9999578a9'  OR 
               (EntityID = '09248F34-2837-EF11-86D4-6045BDEE16E6' AND Name = 'ConversationDetail')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'd70dd636-6b71-427d-addb-35c9999578a9',
            '09248F34-2837-EF11-86D4-6045BDEE16E6', -- Entity: MJ: Reports
            100053,
            'ConversationDetail',
            'Conversation Detail',
            NULL,
            'nvarchar',
            -1,
            0,
            0,
            1,
            'null',
            0,
            0,
            1,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'da6d6064-a123-4303-bb65-eded1b80fd15'  OR 
               (EntityID = '13248F34-2837-EF11-86D4-6045BDEE16E6' AND Name = 'TestRun')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'da6d6064-a123-4303-bb65-eded1b80fd15',
            '13248F34-2837-EF11-86D4-6045BDEE16E6', -- Entity: MJ: Conversations
            100045,
            'TestRun',
            'Test Run',
            NULL,
            'nvarchar',
            510,
            0,
            0,
            1,
            'null',
            0,
            0,
            1,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'a4ce84b5-130f-43f0-8ac2-83b3799db076'  OR 
               (EntityID = '18248F34-2837-EF11-86D4-6045BDEE16E6' AND Name = 'RecordMergeLog')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'a4ce84b5-130f-43f0-8ac2-83b3799db076',
            '18248F34-2837-EF11-86D4-6045BDEE16E6', -- Entity: MJ: Record Merge Deletion Logs
            100015,
            'RecordMergeLog',
            'Record Merge Log',
            NULL,
            'nvarchar',
            900,
            0,
            0,
            0,
            'null',
            0,
            0,
            1,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '07c7cb4f-7292-47e0-bb12-d58e115f091a'  OR 
               (EntityID = '1B248F34-2837-EF11-86D4-6045BDEE16E6' AND Name = 'PlatformVariants')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '07c7cb4f-7292-47e0-bb12-d58e115f091a',
            '1B248F34-2837-EF11-86D4-6045BDEE16E6', -- Entity: MJ: Queries
            100047,
            'PlatformVariants',
            'Platform Variants',
            NULL,
            'nvarchar',
            -1,
            0,
            0,
            1,
            'null',
            0,
            1,
            0,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '78534e4e-5109-4544-8cca-0f52239c51f7'  OR 
               (EntityID = '31248F34-2837-EF11-86D4-6045BDEE16E6' AND Name = 'DuplicateRun')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '78534e4e-5109-4544-8cca-0f52239c51f7',
            '31248F34-2837-EF11-86D4-6045BDEE16E6', -- Entity: MJ: Duplicate Run Details
            100021,
            'DuplicateRun',
            'Duplicate Run',
            NULL,
            'nvarchar',
            510,
            0,
            0,
            0,
            'null',
            0,
            0,
            1,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'e62b59a7-c0a9-4ce4-a135-5697ce9d906b'  OR 
               (EntityID = '35248F34-2837-EF11-86D4-6045BDEE16E6' AND Name = 'EntityAction')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'e62b59a7-c0a9-4ce4-a135-5697ce9d906b',
            '35248F34-2837-EF11-86D4-6045BDEE16E6', -- Entity: MJ: Entity Action Invocations
            100014,
            'EntityAction',
            'Entity Action',
            NULL,
            'nvarchar',
            850,
            0,
            0,
            0,
            'null',
            0,
            0,
            1,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '28e72e38-3ea5-4caf-b23e-d85f9486c336'  OR 
               (EntityID = '39248F34-2837-EF11-86D4-6045BDEE16E6' AND Name = 'EntityAction')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '28e72e38-3ea5-4caf-b23e-d85f9486c336',
            '39248F34-2837-EF11-86D4-6045BDEE16E6', -- Entity: MJ: Entity Action Filters
            100015,
            'EntityAction',
            'Entity Action',
            NULL,
            'nvarchar',
            850,
            0,
            0,
            0,
            'null',
            0,
            0,
            1,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '8e2c42bc-a6df-4e70-85b5-09ab08211059'  OR 
               (EntityID = '39248F34-2837-EF11-86D4-6045BDEE16E6' AND Name = 'ActionFilter')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '8e2c42bc-a6df-4e70-85b5-09ab08211059',
            '39248F34-2837-EF11-86D4-6045BDEE16E6', -- Entity: MJ: Entity Action Filters
            100016,
            'ActionFilter',
            'Action Filter',
            NULL,
            'nvarchar',
            -1,
            0,
            0,
            0,
            'null',
            0,
            0,
            1,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '3eda0980-978b-4379-b7e9-720b69e556d0'  OR 
               (EntityID = '4B248F34-2837-EF11-86D4-6045BDEE16E6' AND Name = 'TemplateContent')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '3eda0980-978b-4379-b7e9-720b69e556d0',
            '4B248F34-2837-EF11-86D4-6045BDEE16E6', -- Entity: MJ: Template Params
            100037,
            'TemplateContent',
            'Template Content',
            NULL,
            'nvarchar',
            510,
            0,
            0,
            1,
            'null',
            0,
            0,
            1,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '2f8157e9-53b6-45ac-954c-129c2eb67cdb'  OR 
               (EntityID = '4D248F34-2837-EF11-86D4-6045BDEE16E6' AND Name = 'RecommendationRun')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '2f8157e9-53b6-45ac-954c-129c2eb67cdb',
            '4D248F34-2837-EF11-86D4-6045BDEE16E6', -- Entity: MJ: Recommendations
            100014,
            'RecommendationRun',
            'Recommendation Run',
            NULL,
            'nvarchar',
            510,
            0,
            0,
            0,
            'null',
            0,
            0,
            1,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'f85f03f0-e6bc-406f-91c8-34821d1d2951'  OR 
               (EntityID = '50248F34-2837-EF11-86D4-6045BDEE16E6' AND Name = 'Recommendation')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'f85f03f0-e6bc-406f-91c8-34821d1d2951',
            '50248F34-2837-EF11-86D4-6045BDEE16E6', -- Entity: MJ: Recommendation Items
            100016,
            'Recommendation',
            'Recommendation',
            NULL,
            'nvarchar',
            -1,
            0,
            0,
            0,
            'null',
            0,
            0,
            1,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '8478d0af-f906-43ff-9ec3-3bb0b1e5a1f3'  OR 
               (EntityID = '52248F34-2837-EF11-86D4-6045BDEE16E6' AND Name = 'EntityCommunicationMessageType')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '8478d0af-f906-43ff-9ec3-3bb0b1e5a1f3',
            '52248F34-2837-EF11-86D4-6045BDEE16E6', -- Entity: MJ: Entity Communication Fields
            100013,
            'EntityCommunicationMessageType',
            'Entity Communication Message Type',
            NULL,
            'nvarchar',
            200,
            0,
            0,
            0,
            'null',
            0,
            0,
            1,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'a2a3c26b-1412-49a7-9469-0eb74b57ee70'  OR 
               (EntityID = '56248F34-2837-EF11-86D4-6045BDEE16E6' AND Name = 'EntityAction')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'a2a3c26b-1412-49a7-9469-0eb74b57ee70',
            '56248F34-2837-EF11-86D4-6045BDEE16E6', -- Entity: MJ: Entity Action Params
            100018,
            'EntityAction',
            'Entity Action',
            NULL,
            'nvarchar',
            850,
            0,
            0,
            0,
            'null',
            0,
            0,
            1,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '3cf525d2-94c5-4e62-aa1a-25298fc04caf'  OR 
               (EntityID = '5460CFA8-0B07-4FAD-8F84-6F9D1186AD05' AND Name = 'Company')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '3cf525d2-94c5-4e62-aa1a-25298fc04caf',
            '5460CFA8-0B07-4FAD-8F84-6F9D1186AD05', -- Entity: Activities
            100027,
            'Company',
            'Company',
            NULL,
            'nvarchar',
            400,
            0,
            0,
            1,
            'null',
            0,
            0,
            1,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'ffc2cbed-9b4c-4001-9a47-aa9f15004b2f'  OR 
               (EntityID = '5460CFA8-0B07-4FAD-8F84-6F9D1186AD05' AND Name = 'Deal')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'ffc2cbed-9b4c-4001-9a47-aa9f15004b2f',
            '5460CFA8-0B07-4FAD-8F84-6F9D1186AD05', -- Entity: Activities
            100028,
            'Deal',
            'Deal',
            NULL,
            'nvarchar',
            400,
            0,
            0,
            1,
            'null',
            0,
            0,
            1,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'd31b436c-bde4-4228-99a8-b1f4e7997a88'  OR 
               (EntityID = '5460CFA8-0B07-4FAD-8F84-6F9D1186AD05' AND Name = 'CreatedByUser')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'd31b436c-bde4-4228-99a8-b1f4e7997a88',
            '5460CFA8-0B07-4FAD-8F84-6F9D1186AD05', -- Entity: Activities
            100029,
            'CreatedByUser',
            'Created By User',
            NULL,
            'nvarchar',
            200,
            0,
            0,
            1,
            'null',
            0,
            0,
            1,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'de6a4556-be68-417c-90d2-8d010e4a0fd7'  OR 
               (EntityID = 'B39A8C3C-4F32-4FD7-AF70-762FD92A5C56' AND Name = 'Pipeline')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'de6a4556-be68-417c-90d2-8d010e4a0fd7',
            'B39A8C3C-4F32-4FD7-AF70-762FD92A5C56', -- Entity: Pipeline Stages
            100015,
            'Pipeline',
            'Pipeline',
            NULL,
            'nvarchar',
            400,
            0,
            0,
            0,
            'null',
            0,
            0,
            1,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'd89823ce-5391-408f-aa19-b7d06eb26a8a'  OR 
               (EntityID = 'DE8EE300-B423-4B86-9E92-B06CAF7F0C3E' AND Name = 'ConversationDetail')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'd89823ce-5391-408f-aa19-b7d06eb26a8a',
            'DE8EE300-B423-4B86-9E92-B06CAF7F0C3E', -- Entity: MJ: Conversation Detail Ratings
            100016,
            'ConversationDetail',
            'Conversation Detail',
            NULL,
            'nvarchar',
            -1,
            0,
            0,
            0,
            'null',
            0,
            0,
            1,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '6ead1b89-374f-4421-a2b0-044a78a0b5d6'  OR 
               (EntityID = '0862DE5E-379E-453B-8CDD-C097DD82814B' AND Name = 'Company')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '6ead1b89-374f-4421-a2b0-044a78a0b5d6',
            '0862DE5E-379E-453B-8CDD-C097DD82814B', -- Entity: Company Tags
            100011,
            'Company',
            'Company',
            NULL,
            'nvarchar',
            400,
            0,
            0,
            0,
            'null',
            0,
            0,
            1,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '2be61a0a-304c-42b6-ae70-0c4a9fbf0197'  OR 
               (EntityID = '0862DE5E-379E-453B-8CDD-C097DD82814B' AND Name = 'Tag')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '2be61a0a-304c-42b6-ae70-0c4a9fbf0197',
            '0862DE5E-379E-453B-8CDD-C097DD82814B', -- Entity: Company Tags
            100012,
            'Tag',
            'Tag',
            NULL,
            'nvarchar',
            200,
            0,
            0,
            0,
            'null',
            0,
            0,
            1,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '3ff89256-cac9-4052-9003-873a13387dc4'  OR 
               (EntityID = '99273DAD-560E-4ABC-8332-C97AB58B7463' AND Name = 'AgentRun')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '3ff89256-cac9-4052-9003-873a13387dc4',
            '99273DAD-560E-4ABC-8332-C97AB58B7463', -- Entity: MJ: AI Agent Run Steps
            100046,
            'AgentRun',
            'Agent Run',
            NULL,
            'nvarchar',
            510,
            0,
            0,
            1,
            'null',
            0,
            0,
            1,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '519cd92b-4442-4a18-8559-63fde1fdbce8'  OR 
               (EntityID = '99273DAD-560E-4ABC-8332-C97AB58B7463' AND Name = 'Parent')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '519cd92b-4442-4a18-8559-63fde1fdbce8',
            '99273DAD-560E-4ABC-8332-C97AB58B7463', -- Entity: MJ: AI Agent Run Steps
            100047,
            'Parent',
            'Parent',
            NULL,
            'nvarchar',
            510,
            0,
            0,
            1,
            'null',
            0,
            0,
            1,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '6bcba9e5-71a2-4b0b-891c-01d1087cf365'  OR 
               (EntityID = '0B09F0BF-F617-4851-A15E-CB839A095BD6' AND Name = 'Company')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '6bcba9e5-71a2-4b0b-891c-01d1087cf365',
            '0B09F0BF-F617-4851-A15E-CB839A095BD6', -- Entity: Contacts
            100031,
            'Company',
            'Company',
            NULL,
            'nvarchar',
            400,
            0,
            0,
            0,
            'null',
            0,
            0,
            1,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '2a3bdce6-2caa-4e8a-8a84-602333040823'  OR 
               (EntityID = '0B09F0BF-F617-4851-A15E-CB839A095BD6' AND Name = 'CreatedByUser')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '2a3bdce6-2caa-4e8a-8a84-602333040823',
            '0B09F0BF-F617-4851-A15E-CB839A095BD6', -- Entity: Contacts
            100032,
            'CreatedByUser',
            'Created By User',
            NULL,
            'nvarchar',
            200,
            0,
            0,
            1,
            'null',
            0,
            0,
            1,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '66f8d80b-e001-44cc-ab07-b2276977d800'  OR 
               (EntityID = '0B09F0BF-F617-4851-A15E-CB839A095BD6' AND Name = 'RootReportsToContactID')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '66f8d80b-e001-44cc-ab07-b2276977d800',
            '0B09F0BF-F617-4851-A15E-CB839A095BD6', -- Entity: Contacts
            100033,
            'RootReportsToContactID',
            'Root Reports To Contact ID',
            NULL,
            'uniqueidentifier',
            16,
            0,
            0,
            1,
            'null',
            0,
            0,
            1,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = '8d04ca67-f156-4cf8-bc0e-de6a9ad76f48'  OR 
               (EntityID = '16AB21D1-8047-41B9-8AEA-CD253DED9743' AND Name = 'ConversationDetail')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            '8d04ca67-f156-4cf8-bc0e-de6a9ad76f48',
            '16AB21D1-8047-41B9-8AEA-CD253DED9743', -- Entity: MJ: Conversation Detail Artifacts
            100014,
            'ConversationDetail',
            'Conversation Detail',
            NULL,
            'nvarchar',
            -1,
            0,
            0,
            0,
            'null',
            0,
            0,
            1,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'a0159203-9cfb-41d5-b2bb-5a64af15c55b'  OR 
               (EntityID = '64AD3C8D-0570-48AF-AF4C-D0A2B173FDE1' AND Name = 'ConversationDetail')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'a0159203-9cfb-41d5-b2bb-5a64af15c55b',
            '64AD3C8D-0570-48AF-AF4C-D0A2B173FDE1', -- Entity: MJ: Tasks
            100046,
            'ConversationDetail',
            'Conversation Detail',
            NULL,
            'nvarchar',
            -1,
            0,
            0,
            1,
            'null',
            0,
            0,
            1,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

/* SQL text to insert new entity field */

      IF NOT EXISTS (
         SELECT 1 FROM [${flyway:defaultSchema}].EntityField 
         WHERE ID = 'e62bf3bc-d7d6-43d2-98b7-49048b5896ef'  OR 
               (EntityID = 'BA51038B-121F-48DC-8B9B-D75E61FD91CA' AND Name = 'MCPServerTool')
         -- check to make sure we're not inserting a duplicate entity field metadata record
      )
      BEGIN
         INSERT INTO [${flyway:defaultSchema}].EntityField
         (
            ID,
            EntityID,
            Sequence,
            Name,
            DisplayName,
            Description,
            Type,
            Length,
            Precision,
            Scale,
            AllowsNull,
            DefaultValue,
            AutoIncrement,
            AllowUpdateAPI,
            IsVirtual,
            RelatedEntityID,
            RelatedEntityFieldName,
            IsNameField,
            IncludeInUserSearchAPI,
            IncludeRelatedEntityNameFieldInBaseView,
            DefaultInView,
            IsPrimaryKey,
            IsUnique,
            RelatedEntityDisplayType
         )
         VALUES
         (
            'e62bf3bc-d7d6-43d2-98b7-49048b5896ef',
            'BA51038B-121F-48DC-8B9B-D75E61FD91CA', -- Entity: MJ: MCP Tool Execution Logs
            100034,
            'MCPServerTool',
            'MCP Server Tool',
            NULL,
            'nvarchar',
            510,
            0,
            0,
            1,
            'null',
            0,
            0,
            1,
            NULL,
            NULL,
            0,
            0,
            0,
            0,
            0,
            0,
            'Search'
         )
      END

